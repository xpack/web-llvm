---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/ir/safepointirverifier-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import EnumerationList from '@xpack/docusaurus-plugin-doxygen/components/EnumerationList'
import EnumerationListItem from '@xpack/docusaurus-plugin-doxygen/components/EnumerationListItem'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `SafepointIRVerifier.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/IR/SafepointIRVerifier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/safepointirverifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/denseset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PostOrderIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/postorderiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetOperations.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setoperations-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Statepoint.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Allocator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/allocator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-safepointirverifier-cpp-">anonymous&#123;SafepointIRVerifier.cpp&#125;</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness">CFGDeadness</a></>}>
This CFG Deadness finds dead blocks and edges. <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier">SafepointIRVerifier</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a></>}>
State we compute and track per basic block. <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker">GCPtrTracker</a></>}>
Builds <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> for each BB of the function. <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier">InstructionVerifier</a></>}>
It is a visitor for <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#aaaee927f8ed0e14bcb32091411cffe66">GCPtrTracker::verifyFunction</a>. <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> = <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt;</>}>
The verifier algorithm is phrased in terms of availability. <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">More...</a>
</MembersIndexItem>

</MembersIndex>

## Enumerations Index

<MembersIndex>

<MembersIndexItem
  type="enum"
  name={<>:  &#123; <a href="#ae96315ee246bd4a509133af84c88c5e1">...</a> &#125;</>}>
A given derived pointer can have multiple base pointers through phi/selects. <a href="#ae96315ee246bd4a509133af84c88c5e1">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a> (Type &#42;Ty)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>enum <a href="#ae96315ee246bd4a509133af84c88c5e1">BaseType</a></>}
  name={<><a href="#aa831f0a1520a405a32196cb32ec24084">getBaseType</a> (const Value &#42;Val)</>}>
Return the baseType for Val which states whether Val is exclusively derived from constant/null, or not exclusively derived from constant. <a href="#aa831f0a1520a405a32196cb32ec24084">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af3163a4fcb7dbce7f61ad71c82d7dbbd">INITIALIZE&#95;PASS&#95;BEGIN</a> (SafepointIRVerifier, &quot;verify-safepoint-ir&quot;, &quot;Safepoint IR Verifier&quot;, false, false) INITIALIZE&#95;PASS&#95;END(SafepointIRVerifier</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a> safepoint Safepoint <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a> static false bool</>}
  name={<><a href="#a634101ee948022445f693b009340b7d6">isGCPointerType</a> (Type &#42;T)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7bfcdb3f625a42ad35922eb75744c927">isNotExclusivelyConstantDerived</a> (const Value &#42;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  template={<>template &lt;typename IteratorTy&gt;</>}
  type="void"
  name={<><a href="#adceaefa2bc030480450592cf20fb6faf">PrintValueSet</a> (raw&#95;ostream &amp;OS, IteratorTy Begin, IteratorTy End)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae3cddd13e523553c3411ddd9b91486b9">Verify</a> (const Function &amp;F, const DominatorTree &amp;DT, const CFGDeadness &amp;CD)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a> safepoint Safepoint <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a></>}
  name={<><a href="#aac1bfb2978d9a6d8b7a4ad3ffb33a145">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a> safepoint</>}
  name={<><a href="#a3d3459f5796b9b9f0253f71d5620e958">ir</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a531b15038148d89c163c324395ef7016">PrintOnly</a></>}>
This option is used for writing test cases. <a href="#a531b15038148d89c163c324395ef7016">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a> safepoint Safepoint <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a></>}
  name={<><a href="#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;safepoint-<a href="#a3d3459f5796b9b9f0253f71d5620e958">ir</a>-verifier&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### AvailableValueSet {#ad7ed294f6046a4e90a60bc99d532bf2f}

<MemberDefinition
  prototype={<>using AvailableValueSet =  DenseSet&lt;const Value &#42;&gt;</>}>
The verifier algorithm is phrased in terms of availability.

The set of values &quot;available&quot; at a given point in the control flow graph is the set of correctly relocated value at that point, and is a subset of the set of definitions dominating that point.

Definition at line <a href="#l00290">290</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Enumerations

### enum  {#ae96315ee246bd4a509133af84c88c5e1}

<MemberDefinition
  prototype="enum BaseType ">
A given derived pointer can have multiple base pointers through phi/selects.

<EnumerationList title="Enumeration values">

<Link id="ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2" />
<EnumerationListItem name="NonConstant">
 (= 1)
</EnumerationListItem>

<Link id="ae96315ee246bd4a509133af84c88c5e1af3714ee13290f49c4370c3b604363523" />
<EnumerationListItem name="ExclusivelyNull">

</EnumerationListItem>

<Link id="ae96315ee246bd4a509133af84c88c5e1a9e36aac8b3cea176f11fb1e2bd20db2b" />
<EnumerationListItem name="ExclusivelySomeConstant">

</EnumerationListItem>

</EnumerationList>

This type indicates when the base pointer is exclusively constant (ExclusivelySomeConstant), and if that constant is proven to be exclusively null, we record that as ExclusivelyNull. In all other cases, the <a href="/docs/api/classes/basetype">BaseType</a> is NonConstant.

Definition at line <a href="#l00316">316</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### containsGCPtrType() {#ab800ba52a9007ccc8b175c3c6e77f71e}

<MemberDefinition
  prototype={<>static bool containsGCPtrType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>

Definition at line <a href="#l00262">262</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### getBaseType() {#aa831f0a1520a405a32196cb32ec24084}

<MemberDefinition
  prototype={<>static enum BaseType getBaseType (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val)</>}
  labels = {["static"]}>
Return the baseType for Val which states whether Val is exclusively derived from constant/null, or not exclusively derived from constant.

Val is exclusively derived off a constant base when all operands of phi and selects are derived off a constant base.

Definition at line <a href="#l00328">328</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#af3163a4fcb7dbce7f61ad71c82d7dbbd}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (SafepointIRVerifier, &quot;verify-safepoint-ir&quot;, &quot;Safepoint <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a> Verifier&quot;, false, false)</>}>

Definition at line <a href="#l00247">247</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### isGCPointerType() {#a634101ee948022445f693b009340b7d6}

<MemberDefinition
  prototype={<>verify safepoint Safepoint IR static false bool isGCPointerType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; T)</>}
  labels = {["static"]}>

Definition at line <a href="#l00253">253</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### isNotExclusivelyConstantDerived() {#a7bfcdb3f625a42ad35922eb75744c927}

<MemberDefinition
  prototype={<>static bool isNotExclusivelyConstantDerived (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l00392">392</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### PrintValueSet() {#adceaefa2bc030480450592cf20fb6faf}

<MemberDefinition
  template={<>template &lt;typename IteratorTy&gt;</>}
  prototype={<>static void PrintValueSet (<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp; OS, IteratorTy Begin, IteratorTy End)</>}
  labels = {["static"]}>

Definition at line <a href="#l00276">276</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### Verify() {#ae3cddd13e523553c3411ddd9b91486b9}

<MemberDefinition
  prototype={<>static void Verify (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> CFGDeadness &amp; CD)</>}
  labels = {["static"]}>

Definition at line <a href="#l00892">892</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### false {#aac1bfb2978d9a6d8b7a4ad3ffb33a145}

<MemberDefinition
  prototype="verify safepoint Safepoint IR false">

Definition at line <a href="#l00251">251</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### ir {#a3d3459f5796b9b9f0253f71d5620e958}

<MemberDefinition
  prototype="verify safepoint ir">

Definition at line <a href="#l00250">250</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### PrintOnly {#a531b15038148d89c163c324395ef7016}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; PrintOnly(&quot;safepoint-ir-verifier-print-only&quot;, cl::init(false))</>}
  labels = {["static"]}>
This option is used for writing test cases.

Instead of crashing the program when verification fails, report a message to the console (for <a href="/docs/api/classes/llvm/filecheck">FileCheck</a> usage) and continue execution as if nothing happened.

Definition at line <a href="#l00058">58</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

### Verifier {#ae91b89e3dbb8e36d143a6efcc4d5d85a}

<MemberDefinition
  prototype="verify safepoint Safepoint IR Verifier">

Definition at line <a href="#l00251">251</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;safepoint-<a href="#a3d3459f5796b9b9f0253f71d5620e958">ir</a>-verifier&quot;</>}>

Definition at line <a href="#l00051">51</a> of file <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp">SafepointIRVerifier.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===-- SafepointIRVerifier.cpp - Verify gc.statepoint invariants ---------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// Run a basic correctness check on the IR to ensure that Safepoints - if</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// they&#39;ve been inserted - were inserted correctly.  In particular, look for use</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// of non-relocated values after a safepoint.  It&#39;s primary use is to check the</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// correctness of safepoint insertion immediately after insertion, but it can</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// also be used to verify that later transforms have not found a way to break</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// safepoint semenatics.</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">// In its current form, this verify checks a property which is sufficient, but</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">// not neccessary for correctness.  There are some cases where an unrelocated</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">// pointer can be used after the safepoint.  Consider this example:</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">//    a = ...</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">//    b = ...</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">//    (a&#39;,b&#39;) = safepoint(a,b)</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">//    c = cmp eq a b</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">//    br c, ..., ....</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">// Because it is valid to reorder &#39;c&#39; above the safepoint, this is legal.  In</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">// practice, this is a somewhat uncommon transform, but CodeGenPrep does create</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">// idioms like this.  The verifier knows about these cases and avoids reporting</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">// false positives.</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/safepointirverifier-h">llvm/IR/SafepointIRVerifier.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/denseset-h">llvm/ADT/DenseSet.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/postorderiterator-h">llvm/ADT/PostOrderIterator.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setoperations-h">llvm/ADT/SetOperations.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h">llvm/IR/Statepoint.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/allocator-h">llvm/Support/Allocator.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;safepoint-ir-verifier&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightComment">/// This option is used for writing test cases.  Instead of crashing the program</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightComment">/// when verification fails, report a message to the console (for FileCheck</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightComment">/// usage) and continue execution as if nothing happened.</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58" lineLink="#a531b15038148d89c163c324395ef7016"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a531b15038148d89c163c324395ef7016">PrintOnly</a>(</span><span class="doxyHighlightStringLiteral">&quot;safepoint-ir-verifier-print-only&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61" lineLink="/docs/api/namespaces/anonymous-safepointirverifier-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightComment">/// This CFG Deadness finds dead blocks and edges. Algorithm starts with a set</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightComment">/// of blocks unreachable from entry then propagates deadness using foldable</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightComment">/// conditional branches without modifying CFG. So GVN does but it changes CFG</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightComment">/// by splitting critical edges. In most cases passes rely on SimplifyCFG to</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightComment">/// clean up dead blocks, but in some cases, like verification or loop passes</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightComment">/// it&#39;s not possible.</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness">CFGDeadness</a> &#123;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;const BasicBlock &#42;&gt;</a> DeadBlocks;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;const Use &#42;&gt;</a> DeadEdges; </span><span class="doxyHighlightComment">// Contains all dead edges from live blocks.</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightComment">  /// Return the edge that coresponds to the predecessor.</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a7839b6e2958308f5941b95e49c69b1e8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a>&amp; <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a7839b6e2958308f5941b95e49c69b1e8">getEdge</a>(<a href="/docs/api/namespaces/llvm/#a5568275af3fe55618f226b717d6a11f8">const&#95;pred&#95;iterator</a> &amp;PredIt) &#123;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PU = PredIt.<a href="/docs/api/classes/llvm/prediterator/#aed7713c96d3d1534258f619d2210d361">getUse</a>();</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PU.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>()-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(PU.getOperandNo());</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightComment">  /// Return true if there is at least one live edge that corresponds to the</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightComment">  /// basic block InBB listed in the phi node.</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#aedbbc231c87194d27b5394875b361ec8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#aedbbc231c87194d27b5394875b361ec8">hasLiveIncomingEdge</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#afb9f7daf71e2f4c35f5444fe6a21fe93">isDeadBlock</a>(InBB) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;block must be live&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>&#42; BB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Listed = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a5568275af3fe55618f226b717d6a11f8">const&#95;pred&#95;iterator</a> PredIt(BB), End(BB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">); PredIt != End; ++PredIt) &#123;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InBB == &#42;PredIt) &#123;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#adf6c0d4d73afe15f3125e0b53cbbd141">isDeadEdge</a>(&amp;<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a7839b6e2958308f5941b95e49c69b1e8">getEdge</a>(PredIt)))</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">        Listed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    (void)Listed;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Listed &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;basic block is not found among incoming blocks&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#afb9f7daf71e2f4c35f5444fe6a21fe93"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#afb9f7daf71e2f4c35f5444fe6a21fe93">isDeadBlock</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DeadBlocks.count(BB);</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#adf6c0d4d73afe15f3125e0b53cbbd141"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#adf6c0d4d73afe15f3125e0b53cbbd141">isDeadEdge</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &#42;U)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U-&gt;getUser())-&gt;isTerminator() &amp;&amp;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;edge must be operand of terminator&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(U-&gt;get()) &amp;&amp;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;edge must refer to basic block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#afb9f7daf71e2f4c35f5444fe6a21fe93">isDeadBlock</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U-&gt;getUser())-&gt;getParent()) &amp;&amp;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;isDeadEdge() must be applied to edge from live block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DeadEdges.count(U);</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#abafc68a948c0a4deac7648103a979a70"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#abafc68a948c0a4deac7648103a979a70">hasLiveIncomingEdges</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if all incoming edges are dead.</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a5568275af3fe55618f226b717d6a11f8">const&#95;pred&#95;iterator</a> PredIt(BB), End(BB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">); PredIt != End; ++PredIt) &#123;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PU = PredIt.getUse();</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;U = PU.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>()-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(PU.getOperandNo());</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#afb9f7daf71e2f4c35f5444fe6a21fe93">isDeadBlock</a>(&#42;PredIt) &amp;&amp; !<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#adf6c0d4d73afe15f3125e0b53cbbd141">isDeadEdge</a>(&amp;U))</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Found a live edge.</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a9bcd938340c81deac2844875dfd6086e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a9bcd938340c81deac2844875dfd6086e">processFunction</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT) &#123;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">    this-&gt;DT = &amp;DT;</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Start with all blocks unreachable from entry.</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT.isReachableFromEntry(&amp;BB))</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">        DeadBlocks.insert(&amp;BB);</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Top-down walk of the dominator tree</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;const Function &#42;&gt;</a> RPOT(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : RPOT) &#123;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = BB-&gt;getTerminator();</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;blocks must be well formed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For conditional branches, we can perform simple conditional propagation on</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the condition value itself.</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI);</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()))</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If a branch has two identical successors, we cannot declare either dead.</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a755df7966331f81ed038b727d99b8ddc">addDeadEdge</a>(BI-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getZExtValue() ? 1 : 2));</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightKeyword">protected</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a9b52ca5c1374c43bc1800b838514562a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a9b52ca5c1374c43bc1800b838514562a">addDeadBlock</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const BasicBlock &#42;, 4&gt;</a> NewDead;</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;const BasicBlock &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/debugify-cpp/#a9e8fa29f7cb6a03aa586afae7591f6cc">DF</a>;</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">    NewDead.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(BB);</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!NewDead.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = NewDead.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#afb9f7daf71e2f4c35f5444fe6a21fe93">isDeadBlock</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>))</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// All blocks dominated by D are dead.</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> Dom;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">      DT-&gt;getDescendants(</span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>&#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>), Dom);</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Do not need to mark all in and out edges dead</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// because BB is marked dead and this is enough</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to run further.</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">      DeadBlocks.<a href="/docs/api/classes/llvm/smallvectorimpl/#a94d23373106467003722f7d6c17b1528">insert</a>(Dom.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Dom.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Figure out the dominance-frontier(D).</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : Dom)</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;S : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#afb9f7daf71e2f4c35f5444fe6a21fe93">isDeadBlock</a>(S) &amp;&amp; !<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#abafc68a948c0a4deac7648103a979a70">hasLiveIncomingEdges</a>(S))</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">            NewDead.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(S);</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a755df7966331f81ed038b727d99b8ddc"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a755df7966331f81ed038b727d99b8ddc">addDeadEdge</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;DeadEdge) &#123;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DeadEdges.insert(&amp;DeadEdge))</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;BasicBlock&gt;</a>(DeadEdge.<a href="/docs/api/classes/llvm/use/#ad77c21b5dd2c8765f87e3fb054d68def">get</a>());</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#abafc68a948c0a4deac7648103a979a70">hasLiveIncomingEdges</a>(BB))</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a9b52ca5c1374c43bc1800b838514562a">addDeadBlock</a>(BB);</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a345bd69760b9ee32b3f49d4fc04120fb">Verify</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT,</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> CFGDeadness &amp;CD);</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201" lineLink="/docs/api/classes/llvm/safepointirverifierpass/#af94bb71714afbf2f143e6535c8264e56"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/safepointirverifierpass/#af94bb71714afbf2f143e6535c8264e56">SafepointIRVerifierPass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">                                               <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DT = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  CFGDeadness CD;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">  CD.processFunction(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT);</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a345bd69760b9ee32b3f49d4fc04120fb">Verify</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, CD);</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace llvm</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a5beee4a1a85167028539ae678e3b9d8c">SafepointIRVerifier</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a> &#123;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a80ad2a6474f19d497fff211d8e905f7a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a80ad2a6474f19d497fff211d8e905f7a">ID</a>; </span><span class="doxyHighlightComment">// Pass identification, replacement for typeid</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a5beee4a1a85167028539ae678e3b9d8c"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a5beee4a1a85167028539ae678e3b9d8c">SafepointIRVerifier</a>() : <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a>(<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a80ad2a6474f19d497fff211d8e905f7a">ID</a>) &#123;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a0c474ff1df56554bb1ecfa68b65649e3">initializeSafepointIRVerifierPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#abd707c03eccdccbcdbb0c4844bd66852"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#abd707c03eccdccbcdbb0c4844bd66852">runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DT = <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;DominatorTreeWrapperPass&gt;</a>().getDomTree();</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness">CFGDeadness</a> CD;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">    CD.<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a9bcd938340c81deac2844875dfd6086e">processFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT);</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a345bd69760b9ee32b3f49d4fc04120fb">Verify</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, CD);</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// no modifications</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#ae76cdbccee1d4895823600a0135d5cab"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#ae76cdbccee1d4895823600a0135d5cab">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#a053677ebc731b47a534f841b11b5cf0c">addRequiredID</a>(<a href="/docs/api/classes/llvm/dominatortreewrapperpass/#ab473ee3cfb7e41e7435453aba045f45b">DominatorTreeWrapperPass::ID</a>);</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#af22b06a6a4f9df80454071685a0d6a02">setPreservesAll</a>();</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a2e68a39e3dcdb17603ff1c6f9c5842c2"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a2e68a39e3dcdb17603ff1c6f9c5842c2">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;safepoint verifier&quot;</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236" lineLink="/docs/api/namespaces/llvm/#a472430b7769b7485fc2cf25257508697"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a472430b7769b7485fc2cf25257508697">llvm::verifySafepointIR</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a5beee4a1a85167028539ae678e3b9d8c">SafepointIRVerifier</a> <a href="/docs/api/files/lib/lib/codegen/globalmergefunctions-cpp/#ab1172d7b7736569e908ce727bfb3e358">pass</a>;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/globalmergefunctions-cpp/#ab1172d7b7736569e908ce727bfb3e358">pass</a>.runOnFunction(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a80ad2a6474f19d497fff211d8e905f7a">SafepointIRVerifier::ID</a> = 0;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243" lineLink="/docs/api/namespaces/llvm/#a7d20858df126e13368dd5cf6e9630828"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm/#a7d20858df126e13368dd5cf6e9630828">llvm::createSafepointIRVerifierPass</a>() &#123;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a5beee4a1a85167028539ae678e3b9d8c">SafepointIRVerifier</a>();</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247" lineLink="#af3163a4fcb7dbce7f61ad71c82d7dbbd"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a5beee4a1a85167028539ae678e3b9d8c">SafepointIRVerifier</a>, </span><span class="doxyHighlightStringLiteral">&quot;verify-safepoint-ir&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;Safepoint IR Verifier&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>)</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250" lineLink="#a3d3459f5796b9b9f0253f71d5620e958"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/safepointirverifier/#a5beee4a1a85167028539ae678e3b9d8c">SafepointIRVerifier</a>, </span><span class="doxyHighlightStringLiteral">&quot;verify-safepoint-ir&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251" lineLink="#aac1bfb2978d9a6d8b7a4ad3ffb33a145"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;Safepoint IR Verifier&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253" lineLink="#a634101ee948022445f693b009340b7d6"><span class="doxyHighlight">static </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a634101ee948022445f693b009340b7d6">isGCPointerType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>) &#123;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PT = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PointerType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>))</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For the sake of this example GC, we arbitrarily pick addrspace(1) as our</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// GC managed heap.  We know that a pointer into this heap needs to be</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// updated and that no other pointer does.</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (1 == PT-&gt;getAddressSpace());</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262" lineLink="#ab800ba52a9007ccc8b175c3c6e77f71e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a634101ee948022445f693b009340b7d6">isGCPointerType</a>(Ty))</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/vectortype">VectorType</a> &#42;VT = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(Ty))</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a634101ee948022445f693b009340b7d6">isGCPointerType</a>(VT-&gt;getScalarType());</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/arraytype">ArrayType</a> &#42;AT = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ArrayType&gt;</a>(Ty))</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(AT-&gt;getElementType());</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;ST = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(Ty))</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">llvm::any&#95;of</a>(ST-&gt;elements(), <a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>);</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlightComment">// Debugging aid -- prints a &#91;Begin, End) range of values.</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight">&lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> IteratorTy&gt;</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276" lineLink="#adceaefa2bc030480450592cf20fb6faf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#adceaefa2bc030480450592cf20fb6faf">PrintValueSet</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, IteratorTy Begin, IteratorTy End) &#123;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#91; &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Begin != End) &#123;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">    OS &lt;&lt; &#42;&#42;Begin &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">    ++Begin;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlightComment">/// The verifier algorithm is phrased in terms of availability.  The set of</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlightComment">/// values &quot;available&quot; at a given point in the control flow graph is the set of</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlightComment">/// correctly relocated value at that point, and is a subset of the set of</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlightComment">/// definitions dominating that point.</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290" lineLink="#ad7ed294f6046a4e90a60bc99d532bf2f"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> = <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;const Value &#42;&gt;</a>;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlightComment">/// State we compute and track per basic block.</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#123;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set of values available coming in, before the phi nodes</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a25ec7ec23b7d24288b14427d35772a20"><span class="doxyHighlight">  <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a25ec7ec23b7d24288b14427d35772a20">AvailableIn</a>;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set of values available going out</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#aae4aa46ae04c638a851b15c0fb108c8d"><span class="doxyHighlight">  <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#aae4aa46ae04c638a851b15c0fb108c8d">AvailableOut</a>;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// AvailableOut minus AvailableIn.</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All elements are Instructions</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#ad54cb72f82ecbd438f5f47c7cfc4a9a8"><span class="doxyHighlight">  <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#ad54cb72f82ecbd438f5f47c7cfc4a9a8">Contribution</a>;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// True if this block contains a safepoint and thus AvailableIn does not</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// contribute to AvailableOut.</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307" lineLink="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a545d981ea1359b77c93ef93bf227e2ca"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a545d981ea1359b77c93ef93bf227e2ca">Cleared</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlightComment">/// A given derived pointer can have multiple base pointers through phi/selects.</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlightComment">/// This type indicates when the base pointer is exclusively constant</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlightComment">/// (ExclusivelySomeConstant), and if that constant is proven to be exclusively</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlightComment">/// null, we record that as ExclusivelyNull. In all other cases, the BaseType is</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlightComment">/// NonConstant.</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316" lineLink="#ae96315ee246bd4a509133af84c88c5e1"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="#ae96315ee246bd4a509133af84c88c5e1">BaseType</a> &#123;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317" lineLink="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2"><span class="doxyHighlight">  <a href="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2">NonConstant</a> = 1, </span><span class="doxyHighlightComment">// Base pointers is not exclusively constant.</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318" lineLink="#ae96315ee246bd4a509133af84c88c5e1af3714ee13290f49c4370c3b604363523"><span class="doxyHighlight">  <a href="#ae96315ee246bd4a509133af84c88c5e1af3714ee13290f49c4370c3b604363523">ExclusivelyNull</a>,</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319" lineLink="#ae96315ee246bd4a509133af84c88c5e1a9e36aac8b3cea176f11fb1e2bd20db2b"><span class="doxyHighlight">  <a href="#ae96315ee246bd4a509133af84c88c5e1a9e36aac8b3cea176f11fb1e2bd20db2b">ExclusivelySomeConstant</a> </span><span class="doxyHighlightComment">// Base pointers for a given derived pointer is from a</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">// set of constants, but they are not exclusively</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">// null.</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlightComment">/// Return the baseType for Val which states whether Val is exclusively</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlightComment">/// derived from constant/null, or not exclusively derived from constant.</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlightComment">/// Val is exclusively derived off a constant base when all operands of phi and</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightComment">/// selects are derived off a constant base.</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328" lineLink="#aa831f0a1520a405a32196cb32ec24084"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="#ae96315ee246bd4a509133af84c88c5e1">BaseType</a> <a href="#aa831f0a1520a405a32196cb32ec24084">getBaseType</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val) &#123;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 32&gt;</a> Worklist;</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;const Value &#42;&gt;</a> Visited;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isExclusivelyDerivedFromNull = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Val);</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Strip through all the bitcasts and geps to get base pointer. Also check for</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the exclusive value when there can be multiple base pointers (through phis</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or selects).</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight">(!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(V).second)</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI-&gt;stripPointerCasts());</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Push all the incoming values of phi node into the worklist for</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// processing.</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Worklist, PN-&gt;incoming&#95;values());</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Push in the true and false values</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue());</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue());</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GCRelocate = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCRelocateInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// GCRelocates do not change null-ness or constant-ness of the value.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// So we can continue with derived pointer this instruction relocates.</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(GCRelocate-&gt;getDerivedPtr());</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FreezeInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Freeze does not change null-ness or constant-ness of the value.</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FI-&gt;getOperand(0));</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We found at least one base pointer which is non-null, so this derived</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// pointer is not exclusively derived from null.</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V != <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(V-&gt;getType()))</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">        isExclusivelyDerivedFromNull = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Continue processing the remaining values to make sure it&#39;s exclusively</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// constant.</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// At this point, we know that the base pointer is not exclusively</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// constant.</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2">BaseType::NonConstant</a>;</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now, we know that the base pointer is exclusively constant, but we need to</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// differentiate between exclusive null constant and non-null constant.</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> isExclusivelyDerivedFromNull ? <a href="#ae96315ee246bd4a509133af84c88c5e1af3714ee13290f49c4370c3b604363523">BaseType::ExclusivelyNull</a></span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">                                      : <a href="#ae96315ee246bd4a509133af84c88c5e1a9e36aac8b3cea176f11fb1e2bd20db2b">BaseType::ExclusivelySomeConstant</a>;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392" lineLink="#a7bfcdb3f625a42ad35922eb75744c927"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7bfcdb3f625a42ad35922eb75744c927">isNotExclusivelyConstantDerived</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aa831f0a1520a405a32196cb32ec24084">getBaseType</a>(V) == <a href="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2">BaseType::NonConstant</a>;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">InstructionVerifier;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlightComment">/// Builds BasicBlockState for each BB of the function.</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlightComment">/// It can traverse function for verification and provides all required</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlightComment">/// information.</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlightComment">/// GC pointer may be in one of three states: relocated, unrelocated and</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlightComment">/// poisoned.</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlightComment">/// Relocated pointer may be used without any restrictions.</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlightComment">/// Unrelocated pointer cannot be dereferenced, passed as argument to any call</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlightComment">/// or returned. Unrelocated pointer may be safely compared against another</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlightComment">/// unrelocated pointer or against a pointer exclusively derived from null.</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlightComment">/// Poisoned pointers are produced when we somehow derive pointer from relocated</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlightComment">/// and unrelocated pointers (e.g. phi, select). This pointers may be safely</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlightComment">/// used in a very limited number of situations. Currently the only way to use</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlightComment">/// it is comparison against constant exclusively derived from null. All</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlightComment">/// limitations arise due to their undefined state: this pointers should be</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlightComment">/// treated as relocated and unrelocated simultaneously.</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlightComment">/// Rules of deriving:</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlightComment">/// R + U = P - that&#39;s where the poisoned pointers come from</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlightComment">/// P + X = P</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlightComment">/// U + U = U</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlightComment">/// R + R = R</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlightComment">/// X + C = X</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlightComment">/// Where &quot;+&quot; - any operation that somehow derive pointer, U - unrelocated,</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlightComment">/// R - relocated and P - poisoned, C - constant, X - U or R or P or C or</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlightComment">/// nothing (in case when &quot;+&quot; is unary operation).</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlightComment">/// Deriving of pointers by itself is always safe.</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlightComment">/// NOTE: when we are making decision on the status of instruction&#39;s result:</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlightComment">/// a) for phi we need to check status of each input &#42;at the end of</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlightComment">///    corresponding predecessor BB&#42;.</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlightComment">/// b) for other instructions we need to check status of each input &#42;at the</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlightComment">///    current point&#42;.</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlightComment">/// FIXME: This works fairly well except one case</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlightComment">///     bb1:</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlightComment">///     p = &#42;some GC-ptr def&#42;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlightComment">///     p1 = gep p, offset</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlightComment">///         /     |</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlightComment">///        /      |</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlightComment">///    bb2:       |</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlightComment">///    safepoint  |</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlightComment">///        \\      |</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlightComment">///         \\     |</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlightComment">///      bb3:</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlightComment">///      p2 = phi &#91;p, bb2&#93; &#91;p1, bb1&#93;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlightComment">///      p3 = phi &#91;p, bb2&#93; &#91;p, bb1&#93;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlightComment">///      here p and p1 is unrelocated</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlightComment">///           p2 and p3 is poisoned (though they shouldn&#39;t be)</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlightComment">/// This leads to some weird results:</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlightComment">///      cmp eq p, p2 - illegal instruction (false-positive)</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlightComment">///      cmp eq p1, p2 - illegal instruction (false-positive)</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlightComment">///      cmp eq p, p3 - illegal instruction (false-positive)</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlightComment">///      cmp eq p, p1 - ok</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlightComment">/// To fix this we need to introduce conception of generations and be able to</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlightComment">/// check if two values belong to one generation or not. This way p2 will be</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlightComment">/// considered to be unrelocated and no false alarm will happen.</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a9910e63c423b9ed6890d2b551142ef92">GCPtrTracker</a> &#123;</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;F;</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness">CFGDeadness</a> &amp;CD;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/specificbumpptrallocator">SpecificBumpPtrAllocator&lt;BasicBlockState&gt;</a> BSAllocator;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BasicBlockState &#42;&gt;</a> BlockMap;</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This set contains defs of unrelocated pointers that are proved to be legal</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and don&#39;t need verification.</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;const Instruction &#42;&gt;</a> ValidUnrelocatedDefs;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This set contains poisoned defs. They can be safely ignored during</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// verification too.</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;const Value &#42;&gt;</a> PoisonedDefs;</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a9910e63c423b9ed6890d2b551142ef92">GCPtrTracker</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;F, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT,</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness">CFGDeadness</a> &amp;CD);</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#aebfa3e7437c8b24b03d5ba8db4169ea9"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#aebfa3e7437c8b24b03d5ba8db4169ea9">hasLiveIncomingEdge</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CD.hasLiveIncomingEdge(PN, InBB);</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;getBasicBlockState(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB);</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;getBasicBlockState(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a8761236e4ec581fffafedc70194c3657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a8761236e4ec581fffafedc70194c3657">isValuePoisoned</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PoisonedDefs.count(V); &#125;</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlightComment">  /// Traverse each BB of the function and call</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlightComment">  /// InstructionVerifier::verifyInstruction for each possibly invalid</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlightComment">  /// instruction.</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlightComment">  /// It destructively modifies GCPtrTracker so it&#39;s passed via rvalue reference</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlightComment">  /// in order to prohibit further usages of GCPtrTracker as it&#39;ll be in</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlightComment">  /// inconsistent state.</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker">GCPtrTracker</a> &amp;&amp;Tracker,</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">                             <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier">InstructionVerifier</a> &amp;<a href="#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>);</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlightComment">  /// Returns true for reachable and live blocks.</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a3574e4de0521856572a711945fb89642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a3574e4de0521856572a711945fb89642">isMapped</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BlockMap.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(BB); &#125;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlightComment">  /// Returns true if the instruction may be safely skipped during verification.</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> instructionMayBeSkipped(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlightComment">  /// Iterates over all BBs from BlockMap and recalculates AvailableIn/Out for</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlightComment">  /// each of them until it converges.</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> recalculateBBsStates();</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlightComment">  /// Remove from Contribution all defs that legally produce unrelocated</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlightComment">  /// pointers and saves them to ValidUnrelocatedDefs.</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlightComment">  /// Though Contribution should belong to BBS it is passed separately with</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlightComment">  /// different const-modifier in order to emphasize (and guarantee) that only</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlightComment">  /// Contribution will be changed.</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlightComment">  /// Returns true if Contribution was changed otherwise false.</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> removeValidUnrelocatedDefs(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;BBS,</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">                                  <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;Contribution);</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlightComment">  /// Gather all the definitions dominating the start of BB into Result. This is</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlightComment">  /// simply the defs introduced by every dominating basic block and the</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlightComment">  /// function arguments.</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> gatherDominatingDefs(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;Result,</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT);</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlightComment">  /// Compute the AvailableOut set for BB, based on the BasicBlockState BBS,</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">  /// which is the BasicBlockState for BB.</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">  /// ContributionChanged is set when the verifier runs for the first time</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlightComment">  /// (in this case Contribution was changed from &#39;empty&#39; to its initial state)</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlightComment">  /// or when Contribution of this BB was changed since last computation.</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> transferBlock(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &amp;BBS,</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ContributionChanged);</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlightComment">  /// Model the effect of an instruction on the set of available values.</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> transferInstruction(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;Cleared,</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">                                  <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/gvn-cpp/#ae8ec32a9818e9fd7c653c86bc0c4dc7ea78945de8de090e90045d299651a68a9b">Available</a>);</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlightComment">/// It is a visitor for GCPtrTracker::verifyFunction. It decides if the</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlightComment">/// instruction (which uses heap reference) is legal or not, given our safepoint</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlightComment">/// semantics.</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier">InstructionVerifier</a> &#123;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyInvalidUses = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier/#a22267ade8efa0b7987130922b9ae3c2e">verifyInstruction</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker">GCPtrTracker</a> &#42;Tracker, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;AvailableSet);</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier/#aadb07100fa6da97f9626b004f04a6f51"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier/#aadb07100fa6da97f9626b004f04a6f51">hasAnyInvalidUses</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyInvalidUses; &#125;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> reportInvalidUse(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &amp;V, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a9910e63c423b9ed6890d2b551142ef92"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a9910e63c423b9ed6890d2b551142ef92">GCPtrTracker::GCPtrTracker</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;F, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT,</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness">CFGDeadness</a> &amp;CD) : F(F), CD(CD) &#123;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Calculate Contribution of each live BB.</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allocate BB states for live blocks.</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : F)</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CD.isDeadBlock(&amp;BB)) &#123;</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">      BasicBlockState &#42;BBS = new (BSAllocator.Allocate()) BasicBlockState;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">      for (const auto &amp;I : BB)</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">        transferInstruction(I, BBS-&gt;Cleared, BBS-&gt;Contribution);</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">      BlockMap&#91;&amp;BB&#93; = BBS;</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize AvailableIn/Out sets of each BB using only information about</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dominating BBs.</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BBI : BlockMap) &#123;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    gatherDominatingDefs(BBI.first, BBI.second-&gt;AvailableIn, DT);</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    transferBlock(BBI.first, &#42;BBI.second, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Simulate the flow of defs through the CFG and recalculate AvailableIn/Out</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sets of each BB until it converges. If any def is proved to be an</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unrelocated pointer, it will be removed from all BBSs.</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  recalculateBBsStates();</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29"><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29">GCPtrTracker::getBasicBlockState</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BlockMap.lookup(BB);</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#ad51872cd9e144bedf1e8d76384ec60de"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29">GCPtrTracker::getBasicBlockState</a>(</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a9910e63c423b9ed6890d2b551142ef92">GCPtrTracker</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)-&gt;<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29">getBasicBlockState</a>(BB);</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> GCPtrTracker::instructionMayBeSkipped(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Poisoned defs are skipped since they are always safe by itself by</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// definition (for details see comment to this class).</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ValidUnrelocatedDefs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || PoisonedDefs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#aaaee927f8ed0e14bcb32091411cffe66"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#aaaee927f8ed0e14bcb32091411cffe66">GCPtrTracker::verifyFunction</a>(<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a9910e63c423b9ed6890d2b551142ef92">GCPtrTracker</a> &amp;&amp;Tracker,</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">                                  <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier">InstructionVerifier</a> &amp;<a href="#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>) &#123;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need RPO here to a) report always the first error b) report errors in</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same order from run to run.</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;const Function &#42;&gt;</a> RPOT(&amp;Tracker.F);</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : RPOT) &#123;</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;BBS = Tracker.getBasicBlockState(BB);</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BBS)</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We destructively modify AvailableIn as we traverse the block instruction</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// by instruction.</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">    <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;AvailableSet = BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a25ec7ec23b7d24288b14427d35772a20">AvailableIn</a>;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Tracker.instructionMayBeSkipped(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// This instruction shouldn&#39;t be added to AvailableSet.</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">      <a href="#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>.verifyInstruction(&amp;Tracker, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, AvailableSet);</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Model the effect of current instruction on AvailableSet to keep the set</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// relevant at each point of BB.</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Cleared = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">      transferInstruction(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Cleared, AvailableSet);</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">      (void)Cleared;</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> GCPtrTracker::recalculateBBsStates() &#123;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;const BasicBlock &#42;&gt;</a> Worklist;</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: This order is suboptimal, it&#39;s better to replace it with priority</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// queue where priority is RPO number of BB.</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BBI : BlockMap)</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(BBI.first);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This loop iterates the AvailableIn/Out sets until it converges.</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The AvailableIn and AvailableOut sets decrease as we iterate.</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>()) &#123;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = Worklist.<a href="/docs/api/classes/llvm/setvector/#af9880d625c506aacc716ee1c9a29ff8b">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;BBS = <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29">getBasicBlockState</a>(BB);</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BBS)</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Ignore dead successors.</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> OldInCount = BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a25ec7ec23b7d24288b14427d35772a20">AvailableIn</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>();</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a5568275af3fe55618f226b717d6a11f8">const&#95;pred&#95;iterator</a> PredIt(BB), End(BB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">); PredIt != End; ++PredIt) &#123;</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PBB = &#42;PredIt;</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;PBBS = <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29">getBasicBlockState</a>(PBB);</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBBS &amp;&amp; !CD.<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#adf6c0d4d73afe15f3125e0b53cbbd141">isDeadEdge</a>(&amp;<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/cfgdeadness/#a7839b6e2958308f5941b95e49c69b1e8">CFGDeadness::getEdge</a>(PredIt)))</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a2162d123f222998300d308bdefdb38b9">set&#95;intersect</a>(BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a25ec7ec23b7d24288b14427d35772a20">AvailableIn</a>, PBBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#aae4aa46ae04c638a851b15c0fb108c8d">AvailableOut</a>);</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldInCount &gt;= BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a25ec7ec23b7d24288b14427d35772a20">AvailableIn</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;invariant!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InputsChanged = OldInCount != BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#a25ec7ec23b7d24288b14427d35772a20">AvailableIn</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>();</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ContributionChanged =</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">        removeValidUnrelocatedDefs(BB, BBS, BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#ad54cb72f82ecbd438f5f47c7cfc4a9a8">Contribution</a>);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InputsChanged &amp;&amp; !ContributionChanged)</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> OldOutCount = BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#aae4aa46ae04c638a851b15c0fb108c8d">AvailableOut</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>();</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">    transferBlock(BB, &#42;BBS, ContributionChanged);</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldOutCount != BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#aae4aa46ae04c638a851b15c0fb108c8d">AvailableOut</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>()) &#123;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldOutCount &gt; BBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#aae4aa46ae04c638a851b15c0fb108c8d">AvailableOut</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;invariant!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#aa5684e4976198c1b64b694d3972ddf78">succ&#95;end</a>(BB));</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> GCPtrTracker::removeValidUnrelocatedDefs(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> BasicBlock &#42;BB,</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">                                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;BBS,</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">                                              <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;Contribution) &#123;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;BBS-&gt;Contribution == &amp;Contribution &amp;&amp;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Passed Contribution should be from the passed BasicBlockState!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> AvailableSet = BBS-&gt;AvailableIn;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ContributionChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For explanation why instructions are processed this way see</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;Rules of deriving&quot; in the comment to this class.</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ValidUnrelocatedPointerDef = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PoisonedPointerDef = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: &#96;select&#96; instructions should be handled here too.</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> PHINode &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(PN-&gt;getType())) &#123;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If both is true, output is poisoned.</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasRelocatedInputs = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasUnrelocatedInputs = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;getNumIncomingValues(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;InBB = PN-&gt;getIncomingBlock(i);</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a3574e4de0521856572a711945fb89642">isMapped</a>(InBB) ||</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">              !CD.hasLiveIncomingEdge(PN, InBB))</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Skip dead block or dead edge.</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;InValue = PN-&gt;getIncomingValue(i);</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7bfcdb3f625a42ad35922eb75744c927">isNotExclusivelyConstantDerived</a>(InValue)) &#123;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a8761236e4ec581fffafedc70194c3657">isValuePoisoned</a>(InValue)) &#123;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// If any of inputs is poisoned, output is always poisoned too.</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">              HasRelocatedInputs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">              HasUnrelocatedInputs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BlockMap&#91;InBB&#93;-&gt;AvailableOut.count(InValue))</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">              HasRelocatedInputs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">              HasUnrelocatedInputs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasUnrelocatedInputs) &#123;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasRelocatedInputs)</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">            PoisonedPointerDef = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">            ValidUnrelocatedPointerDef = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">               <a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType())) &#123;</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// GEP/bitcast of unrelocated pointer is legal by itself but this def</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// shouldn&#39;t appear in any AvailableSet.</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands())</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()) &amp;&amp;</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">            <a href="#a7bfcdb3f625a42ad35922eb75744c927">isNotExclusivelyConstantDerived</a>(V) &amp;&amp; !AvailableSet.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(V)) &#123;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a8761236e4ec581fffafedc70194c3657">isValuePoisoned</a>(V))</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">            PoisonedPointerDef = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">            ValidUnrelocatedPointerDef = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!(ValidUnrelocatedPointerDef &amp;&amp; PoisonedPointerDef) &amp;&amp;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Value cannot be both unrelocated and poisoned!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ValidUnrelocatedPointerDef) &#123;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove def of unrelocated pointer from Contribution of this BB and</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trigger update of all its successors.</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">      Contribution.<a href="/docs/api/classes/llvm/detail/densesetimpl/#af972d87e15b5f6ed61bd5c3956c5213d">erase</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">      PoisonedDefs.erase(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">      ValidUnrelocatedDefs.insert(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Removing urelocated &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a></span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; from Contribution of &quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">      ContributionChanged = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PoisonedPointerDef) &#123;</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark pointer as poisoned, remove its def from Contribution and trigger</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// update of all successors.</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">      Contribution.<a href="/docs/api/classes/llvm/detail/densesetimpl/#af972d87e15b5f6ed61bd5c3956c5213d">erase</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">      PoisonedDefs.insert(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Removing poisoned &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; from Contribution of &quot;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">                        &lt;&lt; BB-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">      ContributionChanged = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Cleared = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">      transferInstruction(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Cleared, AvailableSet);</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">      (void)Cleared;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ContributionChanged;</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> GCPtrTracker::gatherDominatingDefs(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> BasicBlock &#42;BB,</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">                                        <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;Result,</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DominatorTree &amp;DT) &#123;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;DTN = DT&#91;</span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(BB)&#93;;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DTN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unreachable blocks are ignored&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (DTN-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#a453de62c2dadf7b4b8df04e89f6ab4e0">getIDom</a>()) &#123;</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">    DTN = DTN-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#a453de62c2dadf7b4b8df04e89f6ab4e0">getIDom</a>();</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBS = <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29">getBasicBlockState</a>(DTN-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#aab2bf365c9f4b976adc7479576dfd5bb">getBlock</a>());</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BBS &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;immediate dominator cannot be dead for a live block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Defs = BBS-&gt;Contribution;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.insert(Defs.begin(), Defs.end());</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this block is &#39;Cleared&#39;, then nothing LiveIn to this block can be</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// available after this block completes.  Note: This turns out to be</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// really important for reducing memory consuption of the initial available</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sets and thus peak memory usage by this verifier.</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBS-&gt;Cleared)</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Argument &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a49e6c89ce42a55a93ddf38d21bbd198e">args</a>())</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.getType()))</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.insert(&amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> GCPtrTracker::transferBlock(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> BasicBlock &#42;BB, <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &amp;BBS,</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ContributionChanged) &#123;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;AvailableIn = BBS.AvailableIn;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">  <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;AvailableOut = BBS.AvailableOut;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBS.Cleared) &#123;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AvailableOut will change only when Contribution changed.</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ContributionChanged)</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">      AvailableOut = BBS.Contribution;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, we need to reduce the AvailableOut set by things which are no</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// longer in our AvailableIn</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">    <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> Temp = BBS.Contribution;</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8b4f88b1fadc8f51a643e5faaa13afa6">set&#95;union</a>(Temp, AvailableIn);</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    AvailableOut = std::move(Temp);</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Transfered block &quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; from &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">             <a href="#adceaefa2bc030480450592cf20fb6faf">PrintValueSet</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), AvailableIn.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad7dc7318244359268414719e0959346e">begin</a>(), AvailableIn.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a8cd802dcaed35e1f28ea3cbe4af4eff5">end</a>());</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">             <a href="#adceaefa2bc030480450592cf20fb6faf">PrintValueSet</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), AvailableOut.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad7dc7318244359268414719e0959346e">begin</a>(), AvailableOut.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a8cd802dcaed35e1f28ea3cbe4af4eff5">end</a>());</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;);</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> GCPtrTracker::transferInstruction(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;Cleared,</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">                                       <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/gvn-cpp/#ae8ec32a9818e9fd7c653c86bc0c4dc7ea78945de8de090e90045d299651a68a9b">Available</a>) &#123;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GCStatepointInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    Cleared = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/gvn-cpp/#ae8ec32a9818e9fd7c653c86bc0c4dc7ea78945de8de090e90045d299651a68a9b">Available</a>.clear();</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()))</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/gvn-cpp/#ae8ec32a9818e9fd7c653c86bc0c4dc7ea78945de8de090e90045d299651a68a9b">Available</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800" lineLink="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier/#a22267ade8efa0b7987130922b9ae3c2e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/instructionverifier/#a22267ade8efa0b7987130922b9ae3c2e">InstructionVerifier::verifyInstruction</a>(</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker">GCPtrTracker</a> &#42;Tracker, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="#ad7ed294f6046a4e90a60bc99d532bf2f">AvailableValueSet</a> &amp;AvailableSet) &#123;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(PN-&gt;getType()))</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;getNumIncomingValues(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB = PN-&gt;getIncomingBlock(i);</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate">BasicBlockState</a> &#42;InBBS = Tracker-&gt;<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#a586fa10f05ad8a9dd13b494aa2687c29">getBasicBlockState</a>(InBB);</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InBBS ||</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">            !Tracker-&gt;<a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#aebfa3e7437c8b24b03d5ba8db4169ea9">hasLiveIncomingEdge</a>(PN, InBB))</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Skip dead block or dead edge.</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;InValue = PN-&gt;getIncomingValue(i);</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7bfcdb3f625a42ad35922eb75744c927">isNotExclusivelyConstantDerived</a>(InValue) &amp;&amp;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">            !InBBS-&gt;<a href="/docs/api/structs/anonymous-namespace-safepointirverifier-cpp-/basicblockstate/#aae4aa46ae04c638a851b15c0fb108c8d">AvailableOut</a>.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(InValue))</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">          reportInvalidUse(&#42;InValue, &#42;PN);</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">             <a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0)-&gt;getType())) &#123;</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), &#42;RHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/classes/basetype">BaseType</a> baseTyLHS = <a href="#aa831f0a1520a405a32196cb32ec24084">getBaseType</a>(LHS),</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">                  baseTyRHS = <a href="#aa831f0a1520a405a32196cb32ec24084">getBaseType</a>(RHS);</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Returns true if LHS and RHS are unrelocated pointers and they are</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// valid unrelocated uses.</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> hasValidUnrelocatedUse = &#91;&amp;AvailableSet, Tracker, baseTyLHS, baseTyRHS,</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">                                   &amp;LHS, &amp;RHS&#93; () &#123;</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// A cmp instruction has valid unrelocated pointer operands only if</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// both operands are unrelocated pointers.</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// In the comparison between two pointers, if one is an unrelocated</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// use, the other &#42;should be&#42; an unrelocated use, for this</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// instruction to contain valid unrelocated uses. This unrelocated</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// use can be a null constant as well, or another unrelocated</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// pointer.</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AvailableSet.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(LHS) || AvailableSet.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(RHS))</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Constant pointers (that are not exclusively null) may have</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// meaning in different VMs, so we cannot reorder the compare</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// against constant pointers before the safepoint. In other words,</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// comparison of an unrelocated use against a non-null constant</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// maybe invalid.</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((baseTyLHS == <a href="#ae96315ee246bd4a509133af84c88c5e1a9e36aac8b3cea176f11fb1e2bd20db2b">BaseType::ExclusivelySomeConstant</a> &amp;&amp;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">             baseTyRHS == <a href="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2">BaseType::NonConstant</a>) ||</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">            (baseTyLHS == <a href="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2">BaseType::NonConstant</a> &amp;&amp;</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">             baseTyRHS == <a href="#ae96315ee246bd4a509133af84c88c5e1a9e36aac8b3cea176f11fb1e2bd20db2b">BaseType::ExclusivelySomeConstant</a>))</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If one of pointers is poisoned and other is not exclusively derived</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// from null it is an invalid expression: it produces poisoned result</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// and unless we want to track all defs (not only gc pointers) the only</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// option is to prohibit such instructions.</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Tracker-&gt;isValuePoisoned(LHS) &amp;&amp; baseTyRHS != <a href="#ae96315ee246bd4a509133af84c88c5e1af3714ee13290f49c4370c3b604363523">ExclusivelyNull</a>) ||</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">            (Tracker-&gt;isValuePoisoned(RHS) &amp;&amp; baseTyLHS != <a href="#ae96315ee246bd4a509133af84c88c5e1af3714ee13290f49c4370c3b604363523">ExclusivelyNull</a>))</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// All other cases are valid cases enumerated below:</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// 1 Comparison between an exclusively derived null pointer and a</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// constant base pointer.</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// 2 Comparison between an exclusively derived null pointer and a</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// non-constant unrelocated base pointer.</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// 3 Comparison between 2 unrelocated pointers.</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// 4 Comparison between a pointer exclusively derived from null and a</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// non-constant poisoned pointer.</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!hasValidUnrelocatedUse()) &#123;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Print out all non-constant derived pointers that are unrelocated</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// uses, which are invalid.</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (baseTyLHS == <a href="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2">BaseType::NonConstant</a> &amp;&amp; !AvailableSet.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(LHS))</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">        reportInvalidUse(&#42;LHS, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (baseTyRHS == <a href="#ae96315ee246bd4a509133af84c88c5e1aec06ce126da684d1ae0a3dca04116ff2">BaseType::NonConstant</a> &amp;&amp; !AvailableSet.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(RHS))</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">        reportInvalidUse(&#42;RHS, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands())</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab800ba52a9007ccc8b175c3c6e77f71e">containsGCPtrType</a>(V-&gt;getType()) &amp;&amp;</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">          <a href="#a7bfcdb3f625a42ad35922eb75744c927">isNotExclusivelyConstantDerived</a>(V) &amp;&amp; !AvailableSet.<a href="/docs/api/classes/llvm/detail/densesetimpl/#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(V))</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">        reportInvalidUse(&#42;V, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> InstructionVerifier::reportInvalidUse(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &amp;V,</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Illegal use of unrelocated value found!\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Def: &quot;</span><span class="doxyHighlight"> &lt;&lt; V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Use: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a531b15038148d89c163c324395ef7016">PrintOnly</a>)</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">    abort();</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">  AnyInvalidUses = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892" lineLink="#ae3cddd13e523553c3411ddd9b91486b9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a345bd69760b9ee32b3f49d4fc04120fb">Verify</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT,</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> CFGDeadness &amp;CD) &#123;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Verifying gc pointers in function: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a531b15038148d89c163c324395ef7016">PrintOnly</a>)</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Verifying gc pointers in function: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  GCPtrTracker Tracker(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, CD);</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We now have all the information we need to decide if the use of a heap</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reference is legal or not, given our safepoint semantics.</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">  InstructionVerifier <a href="#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-safepointirverifier-cpp-/gcptrtracker/#aaaee927f8ed0e14bcb32091411cffe66">GCPtrTracker::verifyFunction</a>(std::move(Tracker), <a href="#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>);</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a531b15038148d89c163c324395ef7016">PrintOnly</a> &amp;&amp; !<a href="#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>.hasAnyInvalidUses()) &#123;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;No illegal uses found by SafepointIRVerifier in: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
