---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `InstCombineVectorOps.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="InstCombineInternal.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallBitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/InstCombine/InstCombiner.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombiner-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/binopelts">BinopElts</a></>}>
These are the ingredients in an alternate form binary operator as described below. <a href="/docs/api/structs/binopelts/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> = std::pair&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt;</>}>
We are building a shuffle to create V, which is a sequence of insertelement, extractelement pairs. <a href="#a5ef308f5547e4c1a6dfe646dd7ea7abc">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a8efa56ca3bfdd8c715939f9e0b24ccda">buildNew</a> (Instruction &#42;I, ArrayRef&lt; Value &#42; &gt; NewOps, IRBuilderBase &amp;Builder)</>}>
Rebuild a new instruction just like &#39;I&#39; but with the new operands given. <a href="#a8efa56ca3bfdd8c715939f9e0b24ccda">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a> (Value &#42;V, ArrayRef&lt; int &gt; Mask, unsigned Depth=5)</>}>
Return true if we can evaluate the specified expression tree if the vector elements were shuffled in a different order. <a href="#a95fd07ca61f35098e091aa2329f9c8a6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a6e6cf92e2cfe0eb48abec55606e0481e">canonicalizeInsertSplat</a> (ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</>}>
If we have an insert of a scalar to a non-zero element of an undefined vector and then shuffle that value, that&#39;s the same as inserting to the zero element and shuffling. <a href="#a6e6cf92e2cfe0eb48abec55606e0481e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a> (Value &#42;V, Value &#42;EI)</>}>
Return true if the value is cheaper to scalarize than it is to leave as a vector operation. <a href="#a89f5f0f536cc9b0bae261737f13786f7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a></>}
  name={<><a href="#a1e502a1ec39cc64d6b86e9e68b29be89">collectShuffleElements</a> (Value &#42;V, SmallVectorImpl&lt; int &gt; &amp;Mask, Value &#42;PermittedRHS, InstCombinerImpl &amp;IC, bool &amp;Rerun)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a> (Value &#42;V, Value &#42;LHS, Value &#42;RHS, SmallVectorImpl&lt; int &gt; &amp;Mask)</>}>
If V is a shuffle of values that ONLY returns elements from either LHS or RHS, return the shuffle mask and true. <a href="#a0f22159dceed07fd0d5d47915a80dc72">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a06358c30f3e98d9e57f4ae9162f33c72">evaluateInDifferentElementOrder</a> (Value &#42;V, ArrayRef&lt; int &gt; Mask, IRBuilderBase &amp;Builder)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/apint">APInt</a></>}
  name={<><a href="#a1e71f36e9936f126265e383fd67440f7">findDemandedEltsByAllUsers</a> (Value &#42;V)</>}>
Find union of elements of V demanded by all its users. <a href="#a1e71f36e9936f126265e383fd67440f7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/apint">APInt</a></>}
  name={<><a href="#aa5aa7648807905cd7b63153812029fe2">findDemandedEltsBySingleUser</a> (Value &#42;V, Instruction &#42;UserInstr)</>}>
Find elements of V demanded by UserInstr. <a href="#aa5aa7648807905cd7b63153812029fe2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#ab737e320d75547e2b43f6044fc3f3bcc">foldCastShuffle</a> (ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</>}>
Canonicalize casts after shuffle. <a href="#ab737e320d75547e2b43f6044fc3f3bcc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a01aa2c4724ae9bf421d1cfff3a1c7fa5">foldConstantInsEltIntoShuffle</a> (InsertElementInst &amp;InsElt)</>}>
insertelt (shufflevector X, CVec, Mask|insertelt X, C1, CIndex1), C, CIndex --&gt; shufflevector X, CVec&#39;, Mask&#39; <a href="#a01aa2c4724ae9bf421d1cfff3a1c7fa5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a42c33c78c903c369b359db824b70cb1b">foldIdentityExtractShuffle</a> (ShuffleVectorInst &amp;Shuf)</>}>
Try to fold an extract subvector operation. <a href="#a42c33c78c903c369b359db824b70cb1b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a332e7f93c5c4782c1a628a1b11ab5032">foldIdentityPaddedShuffles</a> (ShuffleVectorInst &amp;Shuf)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#ae13bc9134960231b8354f62cfa902782">foldInsEltIntoIdentityShuffle</a> (InsertElementInst &amp;InsElt)</>}>
Try to fold an extract+insert element into an existing identity shuffle by changing the shuffle&#39;s mask to include the index of this insert element. <a href="#ae13bc9134960231b8354f62cfa902782">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a542a88a5b133e2ac8bd9ceb3f8c77dc9">foldInsEltIntoSplat</a> (InsertElementInst &amp;InsElt)</>}>
Try to fold an insert element into an existing splat shuffle by changing the shuffle&#39;s mask to include the index of this insert element. <a href="#a542a88a5b133e2ac8bd9ceb3f8c77dc9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#ad3259dc4dae742caac6c6e4f577d1760">foldInsSequenceIntoSplat</a> (InsertElementInst &amp;InsElt)</>}>
Turn a chain of inserts that splats a value into an insert + shuffle: insertelt(insertelt(insertelt(insertelt X, k, 0), k, 1), k, 2) ... -&gt; shufflevector(insertelt(X, k, 0), poison, zero) <a href="#ad3259dc4dae742caac6c6e4f577d1760">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a98282716af42c878d4638603c6efb350">foldSelectShuffleOfSelectShuffle</a> (ShuffleVectorInst &amp;Shuf)</>}>
A select shuffle of a select shuffle with a shared operand can be reduced to a single select shuffle. <a href="#a98282716af42c878d4638603c6efb350">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a2c05df65ce7ce7ec1d78348be2452e8d">foldSelectShuffleWith1Binop</a> (ShuffleVectorInst &amp;Shuf, const SimplifyQuery &amp;SQ)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#aabcb01976dc50b78faed7491a6d43042">foldShuffleOfUnaryOps</a> (ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</>}>
Canonicalize FP negate/abs after shuffle. <a href="#aabcb01976dc50b78faed7491a6d43042">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a661440047dc1b2af077911d9cf92236a">foldShuffleWithInsert</a> (ShuffleVectorInst &amp;Shuf, InstCombinerImpl &amp;IC)</>}>
Try to replace a shuffle with an insertelement or try to replace a shuffle operand with the operand of an insertelement. <a href="#a661440047dc1b2af077911d9cf92236a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a1f6c8af64ed18f5f5810f78abf9b4f33">foldTruncInsEltPair</a> (InsertElementInst &amp;InsElt, bool IsBigEndian, InstCombiner::BuilderTy &amp;Builder)</>}>
If we are inserting 2 halves of a value into adjacent elements of a vector, try to convert to a single insert with appropriate bitcasts. <a href="#a1f6c8af64ed18f5f5810f78abf9b4f33">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a747cca8cf8e4c4e41b81bb1cbf146a11">foldTruncShuffle</a> (ShuffleVectorInst &amp;Shuf, bool IsBigEndian)</>}>
Convert a narrowing shuffle of a bitcasted vector into a vector truncate. <a href="#a747cca8cf8e4c4e41b81bb1cbf146a11">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/structs/binopelts">BinopElts</a></>}
  name={<><a href="#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a> (BinaryOperator &#42;BO, const DataLayout &amp;DL)</>}>
Binops may be transformed into binops with different opcodes and operands. <a href="#af7e7c9415c23ae336af651877798a377">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;</>}
  name={<><a href="#ae67d970cf80e86c5789e52f9d57d0c70">getPreferredVectorIndex</a> (ConstantInt &#42;IndexC)</>}>
Given a constant index for a extractelement or insertelement instruction, return it with the canonical type if it isn&#39;t already canonical. <a href="#ae67d970cf80e86c5789e52f9d57d0c70">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a9a97530480ce0284bb6dace4356e906c">hoistInsEltConst</a> (InsertElementInst &amp;InsElt2, InstCombiner::BuilderTy &amp;Builder)</>}>
If we have an insertelement instruction feeding into another insertelement and the 2nd is inserting a constant into the vector, canonicalize that constant insertion before the insertion of a variable: <a href="#a9a97530480ce0284bb6dace4356e906c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ace7029cdad3163ebfb8172d25e8a59e3">isShuffleEquivalentToSelect</a> (ShuffleVectorInst &amp;Shuf)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae8f4745a87bae0a614d6bda1cc55ab01">isShuffleExtractingFromLHS</a> (ShuffleVectorInst &amp;SVI, ArrayRef&lt; int &gt; Mask)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#acb762c0dfb2a90596163f59e2dfbd029">narrowInsElt</a> (InsertElementInst &amp;InsElt, InstCombiner::BuilderTy &amp;Builder)</>}>
If both the base vector and the inserted element are extended from the same type, do the insert element in the narrow source type followed by extend. <a href="#acb762c0dfb2a90596163f59e2dfbd029">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a746205e6d7f5c0bb265ecc8a911d5b82">narrowVectorSelect</a> (ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</>}>
Match a shuffle-select-shuffle pattern where the shuffles are widening and narrowing (concatenating with poison and extracting back to the original length). <a href="#a746205e6d7f5c0bb265ecc8a911d5b82">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a801d960feba2403acf8dbd07ee3f34b6">replaceExtractElements</a> (InsertElementInst &#42;InsElt, ExtractElementInst &#42;ExtElt, InstCombinerImpl &amp;IC)</>}>
If we have insertion into a vector that is wider than the vector that we are extracting from, try to widen the source vector to allow a single shufflevector to replace one or more insert/extract pairs. <a href="#a801d960feba2403acf8dbd07ee3f34b6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab245dabd64a95cc7914750e551aebafb">STATISTIC</a> (NumAggregateReconstructionsSimplified, &quot;Number of aggregate reconstructions turned into reuse of the &quot; &quot;original aggregate&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### ShuffleOps {#a5ef308f5547e4c1a6dfe646dd7ea7abc}

<MemberDefinition
  prototype={<>using ShuffleOps =  std::pair&lt;Value &#42;, Value &#42;&gt;</>}>
We are building a shuffle to create V, which is a sequence of insertelement, extractelement pairs.

If PermittedRHS is set, then we must either use it or not rely on the second vector source. Return a std::pair containing the left and right vectors of the proposed shuffle (or 0), and set the Mask parameter as required.

Note: we intentionally don&#39;t try to fold earlier shuffles since they have often been chosen carefully to be efficiently implementable on the target.

Definition at line <a href="#l00779">779</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### buildNew() {#a8efa56ca3bfdd8c715939f9e0b24ccda}

<MemberDefinition
  prototype={<>static Value &#42; buildNew (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; NewOps, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder)</>}
  labels = {["static"]}>
Rebuild a new instruction just like &#39;I&#39; but with the new operands given.

In the event of type mismatch, the type of the operands is correct.

Definition at line <a href="#l01915">1915</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### canEvaluateShuffled() {#a95fd07ca61f35098e091aa2329f9c8a6}

<MemberDefinition
  prototype={<>static bool canEvaluateShuffled (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int &gt; Mask, unsigned Depth=5)</>}
  labels = {["static"]}>
Return true if we can evaluate the specified expression tree if the vector elements were shuffled in a different order.

Definition at line <a href="#l01827">1827</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### canonicalizeInsertSplat() {#a6e6cf92e2cfe0eb48abec55606e0481e}

<MemberDefinition
  prototype={<>static Instruction &#42; canonicalizeInsertSplat (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
If we have an insert of a scalar to a non-zero element of an undefined vector and then shuffle that value, that&#39;s the same as inserting to the zero element and shuffling.

Splatting from the zero element is recognized as the canonical form of splat.

Definition at line <a href="#l02281">2281</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### cheapToScalarize() {#a89f5f0f536cc9b0bae261737f13786f7}

<MemberDefinition
  prototype={<>static bool cheapToScalarize (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/value">Value</a> &#42; EI)</>}
  labels = {["static"]}>
Return true if the value is cheaper to scalarize than it is to leave as a vector operation.

If the extract index <code>EI</code> is a constant integer then some operations may be cheap to scalarize.

FIXME: It&#39;s possible to create more instructions than previously existed.

Definition at line <a href="#l00058">58</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### collectShuffleElements() {#a1e502a1ec39cc64d6b86e9e68b29be89}

<MemberDefinition
  prototype={<>static ShuffleOps collectShuffleElements (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; int &gt; &amp; Mask, <a href="/docs/api/classes/llvm/value">Value</a> &#42; PermittedRHS, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC, bool &amp; Rerun)</>}
  labels = {["static"]}>

Definition at line <a href="#l00781">781</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### collectSingleShuffleElements() {#a0f22159dceed07fd0d5d47915a80dc72}

<MemberDefinition
  prototype={<>static bool collectSingleShuffleElements (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/value">Value</a> &#42; LHS, <a href="/docs/api/classes/llvm/value">Value</a> &#42; RHS, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; int &gt; &amp; Mask)</>}
  labels = {["static"]}>
If V is a shuffle of values that ONLY returns elements from either LHS or RHS, return the shuffle mask and true.

Otherwise, return false.

Definition at line <a href="#l00621">621</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### evaluateInDifferentElementOrder() {#a06358c30f3e98d9e57f4ae9162f33c72}

<MemberDefinition
  prototype={<>static Value &#42; evaluateInDifferentElementOrder (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int &gt; Mask, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder)</>}
  labels = {["static"]}>

Definition at line <a href="#l01991">1991</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### findDemandedEltsByAllUsers() {#a1e71f36e9936f126265e383fd67440f7}

<MemberDefinition
  prototype={<>static APInt findDemandedEltsByAllUsers (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>
Find union of elements of V demanded by all its users.

If it is known by querying findDemandedEltsBySingleUser that no user demands an element of V, then the corresponding bit remains unset in the returned value.

Definition at line <a href="#l00367">367</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### findDemandedEltsBySingleUser() {#aa5aa7648807905cd7b63153812029fe2}

<MemberDefinition
  prototype={<>static APInt findDemandedEltsBySingleUser (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; UserInstr)</>}
  labels = {["static"]}>
Find elements of V demanded by UserInstr.

Definition at line <a href="#l00323">323</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldCastShuffle() {#ab737e320d75547e2b43f6044fc3f3bcc}

<MemberDefinition
  prototype={<>static Instruction &#42; foldCastShuffle (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Canonicalize casts after shuffle.

Definition at line <a href="#l02574">2574</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldConstantInsEltIntoShuffle() {#a01aa2c4724ae9bf421d1cfff3a1c7fa5}

<MemberDefinition
  prototype={<>static Instruction &#42; foldConstantInsEltIntoShuffle (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp; InsElt)</>}
  labels = {["static"]}>
insertelt (shufflevector X, CVec, Mask|insertelt X, C1, CIndex1), C, CIndex --&gt; shufflevector X, CVec&#39;, Mask&#39;

Definition at line <a href="#l01472">1472</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldIdentityExtractShuffle() {#a42c33c78c903c369b359db824b70cb1b}

<MemberDefinition
  prototype={<>static Instruction &#42; foldIdentityExtractShuffle (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf)</>}
  labels = {["static"]}>
Try to fold an extract subvector operation.

Definition at line <a href="#l02623">2623</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldIdentityPaddedShuffles() {#a332e7f93c5c4782c1a628a1b11ab5032}

<MemberDefinition
  prototype={<>static Instruction &#42; foldIdentityPaddedShuffles (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf)</>}
  labels = {["static"]}>

Definition at line <a href="#l02761">2761</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldInsEltIntoIdentityShuffle() {#ae13bc9134960231b8354f62cfa902782}

<MemberDefinition
  prototype={<>static Instruction &#42; foldInsEltIntoIdentityShuffle (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp; InsElt)</>}
  labels = {["static"]}>
Try to fold an extract+insert element into an existing identity shuffle by changing the shuffle&#39;s mask to include the index of this insert element.

Definition at line <a href="#l01390">1390</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldInsEltIntoSplat() {#a542a88a5b133e2ac8bd9ceb3f8c77dc9}

<MemberDefinition
  prototype={<>static Instruction &#42; foldInsEltIntoSplat (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp; InsElt)</>}
  labels = {["static"]}>
Try to fold an insert element into an existing splat shuffle by changing the shuffle&#39;s mask to include the index of this insert element.

Definition at line <a href="#l01353">1353</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldInsSequenceIntoSplat() {#ad3259dc4dae742caac6c6e4f577d1760}

<MemberDefinition
  prototype={<>static Instruction &#42; foldInsSequenceIntoSplat (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp; InsElt)</>}
  labels = {["static"]}>
Turn a chain of inserts that splats a value into an insert + shuffle: insertelt(insertelt(insertelt(insertelt X, k, 0), k, 1), k, 2) ... -&gt; shufflevector(insertelt(X, k, 0), poison, zero)

Definition at line <a href="#l01279">1279</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldSelectShuffleOfSelectShuffle() {#a98282716af42c878d4638603c6efb350}

<MemberDefinition
  prototype={<>static Instruction &#42; foldSelectShuffleOfSelectShuffle (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf)</>}
  labels = {["static"]}>
A select shuffle of a select shuffle with a shared operand can be reduced to a single select shuffle.

This is an obvious improvement in IR, and the backend is expected to lower select shuffles efficiently.

Definition at line <a href="#l02165">2165</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldSelectShuffleWith1Binop() {#a2c05df65ce7ce7ec1d78348be2452e8d}

<MemberDefinition
  prototype={<>static Instruction &#42; foldSelectShuffleWith1Binop (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp; SQ)</>}
  labels = {["static"]}>

Definition at line <a href="#l02212">2212</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldShuffleOfUnaryOps() {#aabcb01976dc50b78faed7491a6d43042}

<MemberDefinition
  prototype={<>static Instruction &#42; foldShuffleOfUnaryOps (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Canonicalize FP negate/abs after shuffle.

Definition at line <a href="#l02527">2527</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldShuffleWithInsert() {#a661440047dc1b2af077911d9cf92236a}

<MemberDefinition
  prototype={<>static Instruction &#42; foldShuffleWithInsert (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
Try to replace a shuffle with an insertelement or try to replace a shuffle operand with the operand of an insertelement.

Definition at line <a href="#l02673">2673</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldTruncInsEltPair() {#a1f6c8af64ed18f5f5810f78abf9b4f33}

<MemberDefinition
  prototype={<>static Instruction &#42; foldTruncInsEltPair (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp; InsElt, bool IsBigEndian, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
If we are inserting 2 halves of a value into adjacent elements of a vector, try to convert to a single insert with appropriate bitcasts.

Definition at line <a href="#l01609">1609</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### foldTruncShuffle() {#a747cca8cf8e4c4e41b81bb1cbf146a11}

<MemberDefinition
  prototype={<>static Instruction &#42; foldTruncShuffle (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf, bool IsBigEndian)</>}
  labels = {["static"]}>
Convert a narrowing shuffle of a bitcasted vector into a vector truncate.

Example (little endian): shuf (bitcast &lt;4 x i16&gt; X to &lt;8 x i8&gt;), &lt;0, 2, 4, 6&gt; --&gt; trunc X to &lt;4 x i8&gt;

Definition at line <a href="#l02452">2452</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### getAlternateBinop() {#af7e7c9415c23ae336af651877798a377}

<MemberDefinition
  prototype={<>static BinopElts getAlternateBinop (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; BO, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Binops may be transformed into binops with different opcodes and operands.

Reverse the usual canonicalization to enable folds with the non-canonical form of the binop. If a transform is possible, return the elements of the new binop. If not, return invalid elements.

Definition at line <a href="#l02130">2130</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### getPreferredVectorIndex() {#ae67d970cf80e86c5789e52f9d57d0c70}

<MemberDefinition
  prototype={<>static ConstantInt &#42; getPreferredVectorIndex (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; IndexC)</>}
  labels = {["static"]}>
Given a constant index for a extractelement or insertelement instruction, return it with the canonical type if it isn&#39;t already canonical.

We arbitrarily pick 64 bit as our canonical type. The actual bitwidth doesn&#39;t matter, we just want a consistent type to simplify CSE.

Definition at line <a href="#l00390">390</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### hoistInsEltConst() {#a9a97530480ce0284bb6dace4356e906c}

<MemberDefinition
  prototype={<>static Instruction &#42; hoistInsEltConst (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp; InsElt2, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
If we have an insertelement instruction feeding into another insertelement and the 2nd is inserting a constant into the vector, canonicalize that constant insertion before the insertion of a variable:

insertelement (insertelement X, Y, IdxC1), ScalarC, IdxC2 --&gt; insertelement (insertelement X, ScalarC, IdxC2), Y, IdxC1

This has the potential of eliminating the 2nd insertelement instruction via constant folding of the scalar constant into a vector constant.

Definition at line <a href="#l01449">1449</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### isShuffleEquivalentToSelect() {#ace7029cdad3163ebfb8172d25e8a59e3}

<MemberDefinition
  prototype={<>static bool isShuffleEquivalentToSelect (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf)</>}
  labels = {["static"]}>

Definition at line <a href="#l01251">1251</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### isShuffleExtractingFromLHS() {#ae8f4745a87bae0a614d6bda1cc55ab01}

<MemberDefinition
  prototype={<>static bool isShuffleExtractingFromLHS (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; SVI, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int &gt; Mask)</>}
  labels = {["static"]}>

Definition at line <a href="#l02099">2099</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### narrowInsElt() {#acb762c0dfb2a90596163f59e2dfbd029}

<MemberDefinition
  prototype={<>static Instruction &#42; narrowInsElt (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp; InsElt, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
If both the base vector and the inserted element are extended from the same type, do the insert element in the narrow source type followed by extend.

TODO: This can be extended to include other cast opcodes, but particularly if we create a wider insertelement, make sure codegen is not harmed.

Definition at line <a href="#l01576">1576</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### narrowVectorSelect() {#a746205e6d7f5c0bb265ecc8a911d5b82}

<MemberDefinition
  prototype={<>static Instruction &#42; narrowVectorSelect (<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp; Shuf, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Match a shuffle-select-shuffle pattern where the shuffles are widening and narrowing (concatenating with poison and extracting back to the original length).

This allows replacing the wide select with a narrow select.

Definition at line <a href="#l02493">2493</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### replaceExtractElements() {#a801d960feba2403acf8dbd07ee3f34b6}

<MemberDefinition
  prototype={<>static bool replaceExtractElements (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &#42; InsElt, <a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &#42; ExtElt, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
If we have insertion into a vector that is wider than the vector that we are extracting from, try to widen the source vector to allow a single shufflevector to replace one or more insert/extract pairs.

Definition at line <a href="#l00694">694</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab245dabd64a95cc7914750e551aebafb}

<MemberDefinition
  prototype={<>STATISTIC (NumAggregateReconstructionsSimplified, &quot;Number of aggregate reconstructions turned into reuse of the &quot; &quot;original aggregate&quot;)</>}>

Definition at line <a href="#l00049">49</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>

Definition at line <a href="#l00044">44</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinevectorops-cpp">InstCombineVectorOps.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- InstCombineVectorOps.cpp -------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This file implements instcombine for ExtractElement, InsertElement and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ShuffleVector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h">InstCombineInternal.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h">llvm/ADT/SmallBitVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombiner-h">llvm/Transforms/InstCombine/InstCombiner.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;iterator&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;instcombine&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49" lineLink="#ab245dabd64a95cc7914750e551aebafb"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAggregateReconstructionsSimplified,</Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of aggregate reconstructions turned into reuse of the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;original aggregate&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="comment">/// Return true if the value is cheaper to scalarize than it is to leave as a</Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="comment">/// vector operation. If the extract index \\p EI is a constant integer then</Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="comment">/// some operations may be cheap to scalarize.</Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="comment">/// FIXME: It&#39;s possible to create more instructions than previously existed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58" lineLink="#a89f5f0f536cc9b0bae261737f13786f7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/value">Value</a> &#42;EI) &#123;</Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CEI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(EI);</Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we can pick a scalar constant value out of a vector, that is free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CEI || <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getSplatValue();</Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CEI &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::stepvector&gt;</a>())) &#123;</Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(V-&gt;getType())-&gt;getElementCount();</Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Index needs to be lower than the minimum size of the vector, because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for scalable vector, the vector size is known at run time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CEI-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(EC.getKnownMinValue());</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// An insertelement to the same constant index as our extract will simplify</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the scalar inserted element. An insertelement to a different constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// index is irrelevant to our extract.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>())))</Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CEI;</Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a6a512a71ae0746953ca6585669a4d47c">m&#95;Load</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))))</Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aa1610c81cbc4ec2f1499140e33de45d5">m&#95;UnOp</a>())))</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V0, &#42;V1;</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1)))))</Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V0, EI) || <a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V1, EI))</Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> UnusedPred;</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a7d9ab823fe85606fa795c0c6fc75aca6">m&#95;Cmp</a>(UnusedPred, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1)))))</Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V0, EI) || <a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V1, EI))</Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If we have a PHI node with a vector type that is only used to feed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight><Highlight kind="comment">// itself and be an operand of extractelement at a constant location,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="comment">// try to replace the PHI of the vector type with a PHI of a scalar type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::scalarizePHI(<a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &amp;EI,</Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123;</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal">  SmallVector&lt;Instruction &#42;, 2&gt; Extracts;</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The users we want the PHI to have are:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1) The EI ExtractElement (we already know this)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2) Possibly more ExtractElements with the same index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3) Another operand, which will feed back into the PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;PHIUser = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : PN-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtractElementInst &#42;EU = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractElementInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EI.<a href="/docs/api/classes/llvm/extractelementinst/#aba9478635b356d769c5f10f92515d24b">getIndexOperand</a>() == EU-&gt;getIndexOperand())</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal">        Extracts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(EU);</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PHIUser) &#123;</Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">      PHIUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PHIUser)</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Verify that this PHI user has one use, which is the PHI itself,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and that it is a binary operation which is cheap to scalarize.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// otherwise return nullptr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PHIUser-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || !(PHIUser-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>() == PN) ||</Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">      !(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(PHIUser)) ||</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal">      !<a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(PHIUser, EI.<a href="/docs/api/classes/llvm/extractelementinst/#aba9478635b356d769c5f10f92515d24b">getIndexOperand</a>()))</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a scalar PHI node that will replace the vector PHI node</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// just before the current PHI node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal">  PHINode &#42;scalarPHI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(EI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">), PN-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()));</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Scalarize each PHI operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i++) &#123;</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PHIInVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i);</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;inBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i);</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Elt = EI.<a href="/docs/api/classes/llvm/extractelementinst/#aba9478635b356d769c5f10f92515d24b">getIndexOperand</a>();</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the operand is the PHI induction variable:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHIInVal == PHIUser) &#123;</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Scalarize the binary operation. Its first operand is the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// scalar PHI, and the second operand is extracted from the other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// vector operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">      BinaryOperator &#42;B0 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(PHIUser);</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> opId = (B0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == PN) ? 1 : 0;</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(</Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(B0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(opId), Elt,</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">                                     B0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(opId)-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.Elt&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">          B0-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;newPHIUser = <a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/binaryoperator/#ac80f39cdc458ec63d7ff5f7490498230">BinaryOperator::CreateWithCopiedFlags</a>(B0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(),</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal">                                                scalarPHI, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, B0), B0-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">      scalarPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(newPHIUser, inBB);</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Scalarize PHI input:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;newEI = <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(PHIInVal, Elt, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Insert the new instruction into the predecessor basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;pos = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(PHIInVal);</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos;</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (pos &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(pos)) &#123;</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal">        InsertPos = ++pos-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">        InsertPos = inBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(newEI, InsertPos);</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">      scalarPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(newEI, inBB);</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : Extracts) &#123;</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>, scalarPHI);</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add old extract to worklist for DCE.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ab86d58ae73173328360a32cbbb0d5b14">addToWorklist</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>);</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;EI;</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::foldBitcastExtElt(<a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &amp;Ext) &#123;</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">  uint64&#95;t ExtIndexC;</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand(), <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) ||</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getIndexOperand(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(ExtIndexC)))</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">  ElementCount NumElts =</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperandType())-&gt;getElementCount();</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;DestTy = <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getType();</Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> DestWidth = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsBigEndian = <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isBigEndian();</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we are casting an integer to vector and extracting a portion, that is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a shift-right and truncate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;isIntegerTy()) &#123;</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FixedVectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;getType()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Expected fixed vector type for bitcast from scalar integer&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Big endian requires adjusting the extract index since MSB is at index 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// LittleEndian: extelt (bitcast i32 X to v4i8), 0 -&gt; trunc i32 X to i8</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// BigEndian: extelt (bitcast i32 X to v4i8), 0 -&gt; trunc i32 (X &gt;&gt; 24) to i8</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsBigEndian)</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">      ExtIndexC = NumElts.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1 - ExtIndexC;</Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ShiftAmountC = ExtIndexC &#42; DestWidth;</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((!ShiftAmountC ||</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">         isDesirableIntType(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;getPrimitiveSizeInBits())) &amp;&amp;</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShiftAmountC)</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLShr(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ShiftAmountC, </Highlight><Highlight kind="stringliteral">&quot;extelt.offset&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DestTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;DstIntTy = <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">IntegerType::getIntNTy</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getContext(), DestWidth);</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Trunc = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DstIntTy);</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> BitCastInst(Trunc, DestTy);</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> TruncInst(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DestTy);</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;isVectorTy())</Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this extractelement is using a bitcast from a vector of the same number</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of elements, see if we can find the source element from the source vector:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extelt (bitcast VecX), IndexC --&gt; bitcast X&#91;IndexC&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SrcTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">  ElementCount NumSrcElts = SrcTy-&gt;getElementCount();</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumSrcElts == NumElts)</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Elt = <a href="/docs/api/namespaces/llvm/#ab09fc7dee4f7e02c60f7a9c928dc1603">findScalarElement</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ExtIndexC))</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> BitCastInst(Elt, DestTy);</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumSrcElts.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() == NumElts.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Src and Dst must be the same sort of vector type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the source elements are wider than the destination, try to shift and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// truncate a subset of scalar bits of an insert op.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumSrcElts.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &lt; NumElts.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()) &#123;</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>;</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Vec;</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">    uint64&#95;t InsIndexC;</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Vec), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Scalar),</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">                              <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(InsIndexC))))</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The extract must be from the subset of vector elements that we inserted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// into. Example: if we inserted element 1 of a &lt;2 x i64&gt; and we are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extracting an i16 (narrowing ratio = 4), then this extract must be from 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of elements 4-7 of the bitcasted vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NarrowingRatio =</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">        NumElts.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() / NumSrcElts.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtIndexC / NarrowingRatio != InsIndexC) &#123;</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Remove insertelement, if we don&#39;t use the inserted element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// extractelement (bitcast (insertelement (Vec, b)), a) -&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// extractelement (bitcast (Vec), a)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// FIXME: this should be removed to SimplifyDemandedVectorElts,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// once scale vectors are supported.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewBC = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBitCast(Vec, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperandType());</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(NewBC, <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getIndexOperand());</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We are extracting part of the original scalar. How that scalar is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inserted into the vector depends on the endian-ness. Example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//              Vector Byte Elt Index:    0  1  2  3  4  5  6  7</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                                       +--+--+--+--+--+--+--+--+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inselt &lt;2 x i32&gt; V, &lt;i32&gt; S, 1:       |V0|V1|V2|V3|S0|S1|S2|S3|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extelt &lt;4 x i16&gt; V&#39;, 3:               |                 |S2|S3|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                                       +--+--+--+--+--+--+--+--+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is little-endian, S2|S3 are the MSB of the 32-bit &#39;S&#39; value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is big-endian, S2|S3 are the LSB of the 32-bit &#39;S&#39; value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In this example, we must right-shift little-endian. Big-endian is just a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// truncate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Chunk = ExtIndexC % NarrowingRatio;</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsBigEndian)</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal">      Chunk = NarrowingRatio - 1 - Chunk;</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Bail out if this is an FP vector to FP vector sequence. That would take</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// more instructions than we started with unless there is no shift, and it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// may not be handled as well in the backend.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedSrcBitcast = SrcTy-&gt;getScalarType()-&gt;isFloatingPointTy();</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedDestBitcast = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>();</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedSrcBitcast &amp;&amp; NeedDestBitcast)</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SrcWidth = SrcTy-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ShAmt = Chunk &#42; DestWidth;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: This limitation is more strict than necessary. We could sum the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// number of new instructions and subtract the number eliminated to know if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we can proceed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;hasOneUse() || !<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedSrcBitcast || NeedDestBitcast)</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedSrcBitcast) &#123;</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SrcIntTy = <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">IntegerType::getIntNTy</a>(<a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getContext(), SrcWidth);</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBitCast(Scalar, SrcIntTy);</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShAmt) &#123;</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Bail out if we could end with more instructions than we started with.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLShr(Scalar, ShAmt);</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedDestBitcast) &#123;</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;DestIntTy = <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">IntegerType::getIntNTy</a>(<a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getContext(), DestWidth);</Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> BitCastInst(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(Scalar, DestIntTy), DestTy);</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> TruncInst(Scalar, DestTy);</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="comment">/// Find elements of V demanded by UserInstr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323" lineLink="#aa5aa7648807905cd7b63153812029fe2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="#aa5aa7648807905cd7b63153812029fe2">findDemandedEltsBySingleUser</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserInstr) &#123;</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VWidth = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Conservatively assume that all elements are needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> UsedElts(<a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth));</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (UserInstr-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>()) &#123;</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ExtractElement: &#123;</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &#42;EEI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ExtractElementInst&gt;</a>(UserInstr);</Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EEI-&gt;<a href="/docs/api/classes/llvm/extractelementinst/#ab140abba7cc496d52d482be53d14ed6a">getVectorOperand</a>() == V);</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;EEIIndexC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(EEI-&gt;<a href="/docs/api/classes/llvm/extractelementinst/#aba9478635b356d769c5f10f92515d24b">getIndexOperand</a>());</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EEIIndexC &amp;&amp; EEIIndexC-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(VWidth)) &#123;</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">      UsedElts = <a href="/docs/api/classes/llvm/apint/#aec662ee6ab1490a4cabebf2812e5b9ca">APInt::getOneBitSet</a>(VWidth, EEIIndexC-&gt;<a href="/docs/api/classes/llvm/constantint/#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>());</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ShuffleVector: &#123;</Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &#42;Shuffle = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(UserInstr);</Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaskNumElts =</Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(UserInstr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">    UsedElts = <a href="/docs/api/classes/llvm/apint">APInt</a>(VWidth, 0);</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; MaskNumElts; i++) &#123;</Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaskVal = Shuffle-&gt;<a href="/docs/api/classes/llvm/shufflevectorinst/#a3fb8619f70f51242f81ef96da349c884">getMaskValue</a>(i);</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaskVal == -1u || MaskVal &gt;= 2 &#42; VWidth)</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Shuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == V &amp;&amp; (MaskVal &lt; VWidth))</Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">        UsedElts.<a href="/docs/api/classes/llvm/apint/#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(MaskVal);</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Shuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == V &amp;&amp;</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">          ((MaskVal &gt;= VWidth) &amp;&amp; (MaskVal &lt; 2 &#42; VWidth)))</Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">        UsedElts.<a href="/docs/api/classes/llvm/apint/#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(MaskVal - VWidth);</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UsedElts;</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="comment">/// Find union of elements of V demanded by all its users.</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="comment">/// If it is known by querying findDemandedEltsBySingleUser that</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="comment">/// no user demands an element of V, then the corresponding bit</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="comment">/// remains unset in the returned value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367" lineLink="#a1e71f36e9936f126265e383fd67440f7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="#a1e71f36e9936f126265e383fd67440f7">findDemandedEltsByAllUsers</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VWidth = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> UnionUsedElts(VWidth, 0);</Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;U : V-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.getUser())) &#123;</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">      UnionUsedElts |= <a href="#aa5aa7648807905cd7b63153812029fe2">findDemandedEltsBySingleUser</a>(V, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">      UnionUsedElts = <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth);</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UnionUsedElts.<a href="/docs/api/classes/llvm/apint/#a423e2c491de1408d54e35f0b47d076be">isAllOnes</a>())</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UnionUsedElts;</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="comment">/// Given a constant index for a extractelement or insertelement instruction,</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="comment">/// return it with the canonical type if it isn&#39;t already canonical.  We</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="comment">/// arbitrarily pick 64 bit as our canonical type.  The actual bitwidth doesn&#39;t</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="comment">/// matter, we just want a consistent type to simplify CSE.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390" lineLink="#ae67d970cf80e86c5789e52f9d57d0c70"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="#ae67d970cf80e86c5789e52f9d57d0c70">getPreferredVectorIndex</a>(<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;IndexC) &#123;</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IndexBW = IndexC-&gt;<a href="/docs/api/classes/llvm/constantint/#ab240d0d30dfa9b392ef9d813f3f9e4be">getBitWidth</a>();</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IndexBW == 64 || IndexC-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a3015474e70e59c0a3ed4f9f0e8644b75">getActiveBits</a>() &gt; 64)</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ConstantInt::get(IndexC-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(),</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">                          IndexC-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a2ed912a28808268e35bd58e8f11251aa">zextOrTrunc</a>(64));</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a71ef354bd1ea9e02d70146d7218a7d39"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a71ef354bd1ea9e02d70146d7218a7d39">InstCombinerImpl::visitExtractElementInst</a>(<a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &amp;EI) &#123;</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcVec = EI.<a href="/docs/api/classes/llvm/extractelementinst/#ab140abba7cc496d52d482be53d14ed6a">getVectorOperand</a>();</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Index = EI.<a href="/docs/api/classes/llvm/extractelementinst/#aba9478635b356d769c5f10f92515d24b">getIndexOperand</a>();</Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#aee89448981f9fbc0d97fe68f354a8e82">simplifyExtractElementInst</a>(SrcVec, Index,</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;EI)))</Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(EI, V);</Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extractelt (select %x, %vec1, %vec2), %const -&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// select %x, %vec1&#91;%const&#93;, %vec2&#91;%const&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Support constant folding of multiple select operands:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extractelt (select %x, %vec1, %vec2), (select %x, %c1, %c2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the extractelement will for instance try to do out of bounds accesses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// because of the values of %c1 and/or %c2, the sequence could be optimized</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// early. This is currently not possible because constant folding will reach</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// an unreachable assertion if it doesn&#39;t find a constant operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(EI.<a href="/docs/api/classes/llvm/extractelementinst/#ab140abba7cc496d52d482be53d14ed6a">getVectorOperand</a>()))</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()-&gt;getType()-&gt;isIntegerTy() &amp;&amp;</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(EI.<a href="/docs/api/classes/llvm/extractelementinst/#aba9478635b356d769c5f10f92515d24b">getIndexOperand</a>()))</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = <a href="/docs/api/classes/llvm/instcombinerimpl/#a039111728e11b1cdf25e60446ae17f2a">FoldOpIntoSelect</a>(EI, <a href="/docs/api/namespaces/llvm/si">SI</a>))</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R;</Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If extracting a specified index from the vector, see if we can recursively</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// find a previously computed scalar that was inserted into the vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndexC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Index);</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasKnownValidIndex = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IndexC) &#123;</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Canonicalize type of constant indices to i64 to simplify CSE</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewIdx = <a href="#ae67d970cf80e86c5789e52f9d57d0c70">getPreferredVectorIndex</a>(IndexC))</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(EI, 1, NewIdx);</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EC = EI.<a href="/docs/api/classes/llvm/extractelementinst/#acac09986a48f1f758f882cc7ba780c08">getVectorOperandType</a>()-&gt;<a href="/docs/api/classes/llvm/vectortype/#a59632c5deb0423a518ad984bdd04d41f">getElementCount</a>();</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = EC.getKnownMinValue();</Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">    HasKnownValidIndex = IndexC-&gt;getValue().ult(NumElts);</Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(SrcVec)) &#123;</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID();</Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Index needs to be lower than the minimum size of the vector, because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// for scalable vector, the vector size is known at run time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IID == Intrinsic::stepvector &amp;&amp; IndexC-&gt;getValue().ult(NumElts)) &#123;</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = EI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Ty-&gt;getIntegerBitWidth();</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Idx;</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Return index when its value does not exceed the allowed limit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// for the element type of the vector, otherwise return undefined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IndexC-&gt;getValue().getActiveBits() &lt;= <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">          Idx = ConstantInt::get(Ty, IndexC-&gt;getValue().zextOrTrunc(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>));</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">          Idx = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Ty);</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(EI, Idx);</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// InstSimplify should handle cases where the index is invalid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For fixed-length vector, it&#39;s invalid to extract out-of-range element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EC.isScalable() &amp;&amp; IndexC-&gt;getValue().uge(NumElts))</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = foldBitcastExtElt(EI))</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there&#39;s a vector PHI feeding a scalar use through this extractelement</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction, try to scalarize the PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(SrcVec))</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ScalarPHI = scalarizePHI(EI, Phi))</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ScalarPHI;</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO come up with a n-ary matcher that subsumes both unary and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// binary matchers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/unaryoperator">UnaryOperator</a> &#42;UO;</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SrcVec, <a href="/docs/api/namespaces/llvm/patternmatch/#aa1610c81cbc4ec2f1499140e33de45d5">m&#95;UnOp</a>(UO)) &amp;&amp; <a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(SrcVec, Index)) &#123;</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extelt (unop X), Index --&gt; unop (extelt X, Index)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = UO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;E = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Index);</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/unaryoperator/#a507eb6210c8a0ba429226156e43745a1">UnaryOperator::CreateWithCopiedFlags</a>(UO-&gt;<a href="/docs/api/classes/llvm/unaryoperator/#a7cece7ddf076c1dccc81f743e3b7bd36">getOpcode</a>(), E, UO);</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the binop is not speculatable, we cannot hoist the extractelement if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it may make the operand poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO;</Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SrcVec, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(BO)) &amp;&amp; <a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(SrcVec, Index) &amp;&amp;</Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">      (HasKnownValidIndex ||</Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">       <a href="/docs/api/namespaces/llvm/#a19ebaad52d11be3121c2bfcbd0f30193">isSafeToSpeculativelyExecuteWithVariableReplaced</a>(BO))) &#123;</Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extelt (binop X, Y), Index --&gt; binop (extelt X, Index), (extelt Y, Index)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;E0 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Index);</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;E1 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Index);</Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/binaryoperator/#ac80f39cdc458ec63d7ff5f7490498230">BinaryOperator::CreateWithCopiedFlags</a>(BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), E0, E1, BO);</Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SrcVec, <a href="/docs/api/namespaces/llvm/patternmatch/#a7d9ab823fe85606fa795c0c6fc75aca6">m&#95;Cmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">      <a href="#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(SrcVec, Index)) &#123;</Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extelt (cmp X, Y), Index --&gt; cmp (extelt X, Index), (extelt Y, Index)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;E0 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Index);</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;E1 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Index);</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;SrcCmpInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(SrcVec);</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cmpinst/#a6d0ee639690d0fa59e6c9e0af5adc5c2">CmpInst::CreateWithCopiedFlags</a>(SrcCmpInst-&gt;<a href="/docs/api/classes/llvm/cmpinst/#af4abe8e5b55577f35032131a6264fe4f">getOpcode</a>(), Pred, E0, E1,</Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">                                          SrcCmpInst);</Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(SrcVec)) &#123;</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// instsimplify already handled the case where the indices are constants</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// and equal by value, if both are constants, they must not be the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// value, extract from the pre-inserted value instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(IE-&gt;getOperand(2)) &amp;&amp; IndexC)</Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(EI, 0, IE-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VecType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EC = VecType-&gt;getElementCount();</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">      uint64&#95;t IdxVal = IndexC ? IndexC-&gt;getZExtValue() : 0;</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IndexC &amp;&amp; IdxVal &lt; EC.getKnownMinValue() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Find out why we have a vector result - these are a few examples:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//  1 We have a scalar pointer and a vector of indices, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//  2 We have a vector of pointers and a scalar index, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//  3 We have a vector of pointers and a vector of indices, etc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Here we only consider combining when there is exactly one vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// operand, since the optimization is less obviously a win due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// needing more than one extractelements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VectorOps =</Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">llvm::count&#95;if</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;operands(), &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">              return isa&lt;VectorType&gt;(V-&gt;getType());</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">            &#125;);</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorOps == 1) &#123;</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewPtr = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand();</Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(NewPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">            NewPtr = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(NewPtr, IndexC);</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> NewOps;</Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType()))</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">              NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, IndexC));</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">              NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;NewGEP = <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">              <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType(), NewPtr, NewOps);</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">          NewGEP-&gt;<a href="/docs/api/classes/llvm/getelementptrinst/#a837e9f272fd070a5f8fc79c07a951106">setIsInBounds</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;isInBounds());</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewGEP;</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is extracting an element from a shufflevector, figure out where</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// it came from and extract from the appropriate input element instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Restrict the following transformation to fixed-length vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FixedVectorType&gt;</a>(SVI-&gt;getType()) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Index)) &#123;</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> SrcIdx =</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">            SVI-&gt;getMaskValue(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(Index)-&gt;getZExtValue());</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src;</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LHSWidth = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SVI-&gt;getOperand(0)-&gt;getType())</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">                                -&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcIdx &lt; 0)</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(EI, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(EI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcIdx &lt; (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)LHSWidth)</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">          Src = SVI-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">          SrcIdx -= LHSWidth;</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">          Src = SVI-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;Int64Ty = <a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(EI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(</Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">            Src, ConstantInt::get(Int64Ty, SrcIdx, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Canonicalize extractelement(cast) -&gt; cast(extractelement).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Bitcasts can change the number of vector elements, and they cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// nothing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;hasOneUse() &amp;&amp; (CI-&gt;getOpcode() != Instruction::BitCast)) &#123;</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;EE = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(CI-&gt;getOperand(0), Index);</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(CI-&gt;getOpcode(), EE, EI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Run demanded elements after other transforms as this can drop flags on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// binops.  If there&#39;s two paths to the same final result, we prefer the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one which doesn&#39;t force us to drop flags.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IndexC) &#123;</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EC = EI.<a href="/docs/api/classes/llvm/extractelementinst/#acac09986a48f1f758f882cc7ba780c08">getVectorOperandType</a>()-&gt;<a href="/docs/api/classes/llvm/vectortype/#a59632c5deb0423a518ad984bdd04d41f">getElementCount</a>();</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = EC.getKnownMinValue();</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This instruction only demands the single element from the input vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip for scalable type, the number of elements is unknown at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// compile-time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EC.isScalable() &amp;&amp; NumElts != 1) &#123;</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the input vector has a single use, simplify it based on this use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// property.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcVec-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/apint">APInt</a> PoisonElts(NumElts, 0);</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/apint">APInt</a> DemandedElts(NumElts, 0);</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">        DemandedElts.<a href="/docs/api/classes/llvm/apint/#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(IndexC-&gt;getZExtValue());</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V =</Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">                <a href="/docs/api/classes/llvm/instcombinerimpl/#a37cce7aa1875173688e5971c5d6fa9e0">SimplifyDemandedVectorElts</a>(SrcVec, DemandedElts, PoisonElts))</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(EI, 0, V);</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the input vector has multiple uses, simplify it based on a union</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// of all elements used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/apint">APInt</a> DemandedElts = <a href="#a1e71f36e9936f126265e383fd67440f7">findDemandedEltsByAllUsers</a>(SrcVec);</Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DemandedElts.<a href="/docs/api/classes/llvm/apint/#a423e2c491de1408d54e35f0b47d076be">isAllOnes</a>()) &#123;</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/apint">APInt</a> PoisonElts(NumElts, 0);</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/instcombinerimpl/#a37cce7aa1875173688e5971c5d6fa9e0">SimplifyDemandedVectorElts</a>(</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">                  SrcVec, DemandedElts, PoisonElts, 0 </Highlight><Highlight kind="comment">/&#42; Depth &#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal">                  </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42; AllowMultipleUsers &#42;/</Highlight><Highlight kind="normal">)) &#123;</Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V != SrcVec) &#123;</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.addValue(SrcVec);</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">              SrcVec-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;EI;</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="comment">/// If V is a shuffle of values that ONLY returns elements from either LHS or</Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="comment">/// RHS, return the shuffle mask and true. Otherwise, return false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621" lineLink="#a0f22159dceed07fd0d5d47915a80dc72"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>,</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;int&gt;</a> &amp;Mask) &#123;</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getType() == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType() &amp;&amp;</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Invalid CollectSingleShuffleElements&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>())) &#123;</Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">    Mask.assign(NumElts, -1);</Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) &#123;</Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumElts; ++i)</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">      Mask.push&#95;back(i);</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumElts; ++i)</Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">      Mask.push&#95;back(i + NumElts);</Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &#42;IEI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is an insert of an extract from some other vector, include it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecOp    = IEI-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarOp = IEI-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IdxOp    = IEI-&gt;getOperand(2);</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(IdxOp))</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> InsertedIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(IdxOp)-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(ScalarOp)) &#123;  </Highlight><Highlight kind="comment">// inserting poison into vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We can handle this if the vector we are inserting into is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// transitively ok.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(VecOp, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Mask)) &#123;</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If so, update the mask to reflect the inserted poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">        Mask&#91;InsertedIdx&#93; = -1;</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &#42;EI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractElementInst&gt;</a>(ScalarOp))&#123;</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))) &#123;</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExtractedIdx =</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumLHSElts =</Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This must be extracting from either LHS or RHS.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> || EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We can handle this if the vector we are inserting into is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// transitively ok.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(VecOp, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Mask)) &#123;</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// If so, update the mask to reflect the inserted value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) &#123;</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">              Mask&#91;InsertedIdx % NumElts&#93; = ExtractedIdx;</Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">            &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">              <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">              Mask&#91;InsertedIdx % NumElts&#93; = ExtractedIdx + NumLHSElts;</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="comment">/// If we have insertion into a vector that is wider than the vector that we</Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="comment">/// are extracting from, try to widen the source vector to allow a single</Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="comment">/// shufflevector to replace one or more insert/extract pairs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694" lineLink="#a801d960feba2403acf8dbd07ee3f34b6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a801d960feba2403acf8dbd07ee3f34b6">replaceExtractElements</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &#42;InsElt,</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &#42;ExtElt,</Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InsVecType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(InsElt-&gt;<a href="/docs/api/classes/llvm/insertelementinst/#a49230ece74a48a27fb2bb1a4928b6e29">getType</a>());</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtVecType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(ExtElt-&gt;<a href="/docs/api/classes/llvm/extractelementinst/#acac09986a48f1f758f882cc7ba780c08">getVectorOperandType</a>());</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumInsElts = InsVecType-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumExtElts = ExtVecType-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The inserted-to vector must be wider than the extracted-from vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsVecType-&gt;getElementType() != ExtVecType-&gt;getElementType() ||</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">      NumExtElts &gt;= NumInsElts)</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a shuffle mask to widen the extended-from vector using poison</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// values. The mask selects all of the values of the original vector followed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// by as many poison values as needed to create a vector of the same length</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as the inserted-to vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> ExtendMask;</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; NumExtElts; ++i)</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">    ExtendMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(i);</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = NumExtElts; i &lt; NumInsElts; ++i)</Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">    ExtendMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(-1);</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtVecOp = ExtElt-&gt;<a href="/docs/api/classes/llvm/extractelementinst/#ab140abba7cc496d52d482be53d14ed6a">getVectorOperand</a>();</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtVecOpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(ExtVecOp);</Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertionBlock = (ExtVecOpInst &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ExtVecOpInst))</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">                                   ? ExtVecOpInst-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">                                   : ExtElt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This restriction matches the basic block check below when creating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// new extractelement instructions. If that limitation is removed, this one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// could also be removed. But for now, we just bail out to ensure that we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will replace the extractelement instruction that is feeding our</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// insertelement instruction. This allows the insertelement to then be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replaced by a shufflevector. If the insertelement is not replaced, we can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// induce infinite looping because there&#39;s an optimization for extractelement</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that will delete our widening shuffle. This would trigger another attempt</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// here to create that shuffle, and we spin forever.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsertionBlock != InsElt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This restriction matches the check in visitInsertElementInst() and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// prevents an infinite loop caused by not turning the extract/insert pair</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into a shuffle. We really should not need either check, but we&#39;re lacking</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// folds for shufflevectors because we&#39;re afraid to generate shuffle masks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that the backend can&#39;t handle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsElt-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InsertElementInst&gt;</a>(InsElt-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()))</Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideVec = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(ExtVecOp, ExtendMask);</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert the new shuffle after the vector operand of the extract is defined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (as long as it&#39;s not a PHI) or at the start of the basic block of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extract, so any subsequent extracts in the same basic block can use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Insert before the earliest ExtractElementInst that is replaced.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtVecOpInst &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ExtVecOpInst))</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal">    WideVec-&gt;insertAfter(ExtVecOpInst-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">    IC.<a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(WideVec, ExtElt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace extracts from the original narrow vector with extracts from the new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// wide vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : ExtVecOp-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &#42;OldExt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractElementInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OldExt || OldExt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != WideVec-&gt;getParent())</Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewExt = <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(WideVec, OldExt-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">    IC.<a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(NewExt, OldExt-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">    IC.<a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;OldExt, NewExt);</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add the old extracts to the worklist for DCE. We can&#39;t remove the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extracts directly, because they may still be used by the calling code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">    IC.<a href="/docs/api/classes/llvm/instcombiner/#ab86d58ae73173328360a32cbbb0d5b14">addToWorklist</a>(OldExt);</Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="comment">/// We are building a shuffle to create V, which is a sequence of insertelement,</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="comment">/// extractelement pairs. If PermittedRHS is set, then we must either use it or</Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="comment">/// not rely on the second vector source. Return a std::pair containing the</Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="comment">/// left and right vectors of the proposed shuffle (or 0), and set the Mask</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="comment">/// parameter as required.</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="comment">/// Note: we intentionally don&#39;t try to fold earlier shuffles since they have</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="comment">/// often been chosen carefully to be efficiently implementable on the target.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779" lineLink="#a5ef308f5547e4c1a6dfe646dd7ea7abc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> = std::pair&lt;Value &#42;, Value &#42;&gt;;</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781" lineLink="#a1e502a1ec39cc64d6b86e9e68b29be89"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> <a href="#a1e502a1ec39cc64d6b86e9e68b29be89">collectShuffleElements</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;int&gt;</a> &amp;Mask,</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/value">Value</a> &#42;PermittedRHS,</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &amp;Rerun) &#123;</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getType()-&gt;isVectorTy() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Invalid shuffle!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>())) &#123;</Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">    Mask.assign(NumElts, -1);</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">        PermittedRHS ? <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(PermittedRHS-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) : V, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantAggregateZero&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">    Mask.assign(NumElts, 0);</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(V, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &#42;IEI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is an insert of an extract from some other vector, include it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecOp    = IEI-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarOp = IEI-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IdxOp    = IEI-&gt;getOperand(2);</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/extractelementinst">ExtractElementInst</a> &#42;EI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractElementInst&gt;</a>(ScalarOp)) &#123;</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(IdxOp)) &#123;</Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExtractedIdx =</Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> InsertedIdx = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(IdxOp)-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Either the extracted from or inserted into vector must be RHSVec,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// otherwise we&#39;d end up with a shuffle of three inputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == PermittedRHS || PermittedRHS == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">          <a href="#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> LR = <a href="#a1e502a1ec39cc64d6b86e9e68b29be89">collectShuffleElements</a>(VecOp, Mask, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, IC, Rerun);</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LR.second == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> || LR.second == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LR.first-&gt;getType() != <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType()) &#123;</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Although we are giving up for now, see if we can create extracts</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// that match the inserts for another round of combining.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a801d960feba2403acf8dbd07ee3f34b6">replaceExtractElements</a>(IEI, EI, IC))</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">              Rerun = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// We tried our best, but we can&#39;t find anything compatible with RHS</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// further up the chain. Return a trivial shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; NumElts; ++i)</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">              Mask&#91;i&#93; = i;</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(V, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumLHSElts =</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">          Mask&#91;InsertedIdx % NumElts&#93; = NumLHSElts + ExtractedIdx;</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(LR.first, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VecOp == PermittedRHS) &#123;</Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We&#39;ve gone as far as we can: anything on the other side of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// extractelement will already have been converted into a shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumLHSElts =</Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">                  -&gt;getNumElements();</Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumElts; ++i)</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">            Mask.push&#95;back(i == InsertedIdx ? ExtractedIdx : NumLHSElts + i);</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), PermittedRHS);</Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If this insertelement is a chain that comes from exactly these two</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// vectors, return the vector and the effective shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == PermittedRHS-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">            <a href="#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(IEI, EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), PermittedRHS,</Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">                                         Mask))</Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(EI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), PermittedRHS);</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, we can&#39;t do anything fancy. Return an identity vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumElts; ++i)</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">    Mask.push&#95;back(i);</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(V, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="comment">/// Look for chain of insertvalue&#39;s that fully define an aggregate, and trace</Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="comment">/// back the values inserted, see if they are all were extractvalue&#39;d from</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="comment">/// the same source aggregate from the exact same element indexes.</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="comment">/// If they were, just reuse the source aggregate.</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="comment">/// This potentially deals with PHI indirections.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868" lineLink="/docs/api/classes/llvm/instcombinerimpl/#acad657182350311f85bc33387733e506"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#acad657182350311f85bc33387733e506">InstCombinerImpl::foldAggregateConstructionIntoAggregateReuse</a>(</Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/insertvalueinst">InsertValueInst</a> &amp;OrigIVI) &#123;</Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;AggTy = OrigIVI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumAggElts;</Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (AggTy-&gt;<a href="/docs/api/classes/llvm/type/#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>()) &#123;</Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156">Type::StructTyID</a>:</Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">    NumAggElts = AggTy-&gt;<a href="/docs/api/classes/llvm/type/#a58e54adaa7672bbf72091254a5391137">getStructNumElements</a>();</Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554">Type::ArrayTyID</a>:</Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">    NumAggElts = AggTy-&gt;<a href="/docs/api/classes/llvm/type/#a5cfdb1cd5ccaae5daa8e4b29b3bb6b82">getArrayNumElements</a>();</Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Unhandled aggregate type?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Arbitrary aggregate size cut-off. Motivation for limit of 2 is to be able</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to handle clang C++ exception struct (which is hardcoded as &#123;i8&#42;, i32&#125;),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: any interesting patterns to be caught with larger limit?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumAggElts &gt; 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Aggregate should have elements.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumAggElts &gt; 2)</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">constexpr</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NotFound = std::nullopt;</Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">constexpr</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FoundMismatch = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to find a value of each element of an aggregate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: deal with more complex, not one-dimensional, aggregate types</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::optional&lt;Instruction &#42;&gt;</a>, 2&gt; AggElts(NumAggElts, NotFound);</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do we know values for each element of the aggregate?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> KnowAllElts = &#91;&amp;AggElts&#93;() &#123;</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(AggElts, NotFound);</Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 0;</Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Arbitrary &#96;insertvalue&#96; visitation depth limit. Let&#39;s be okay with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// every element being overwritten twice, which should never happen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> DepthLimit = 2 &#42; NumAggElts;</Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Recurse up the chain of &#96;insertvalue&#96; aggregate operands until either we&#39;ve</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reconstructed full initializer or can&#39;t visit any more &#96;insertvalue&#96;&#39;s.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/insertvalueinst">InsertValueInst</a> &#42;CurrIVI = &amp;OrigIVI;</Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">       <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &lt; DepthLimit &amp;&amp; CurrIVI &amp;&amp; !KnowAllElts();</Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">       CurrIVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertValueInst&gt;</a>(CurrIVI-&gt;getAggregateOperand()),</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">                       ++<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) &#123;</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InsertedValue =</Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(CurrIVI-&gt;getInsertedValueOperand());</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsertedValue)</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Inserted value must be produced by an instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;unsigned int&gt;</a> Indices = CurrIVI-&gt;getIndices();</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t bother with more than single-level aggregates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Indices.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() != 1)</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// FIXME: deal with more complex aggregates?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now, we may have already previously recorded the value for this element</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of an aggregate. If we did, that means the CurrIVI will later be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// overwritten with the already-recorded value. But if not, let&#39;s record it!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">    std::optional&lt;Instruction &#42;&gt; &amp;Elt = AggElts&#91;Indices.<a href="/docs/api/classes/llvm/arrayref/#a721fc555cb3d8dc2a1a680dcc2ce69b2">front</a>()&#93;;</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">    Elt = Elt.value&#95;or(InsertedValue);</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: should we handle chain-terminating undef base operand?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Was that sufficient to deduce the full initializer for the aggregate?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!KnowAllElts())</Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Give up then.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We now want to find the source&#91;s&#93; of the aggregate elements we&#39;ve found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// And with &quot;source&quot; we mean the original aggregate&#91;s&#93; from which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the inserted elements were extracted. This may require PHI translation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">enum class</Highlight><Highlight kind="normal"> AggregateDescription &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="comment">    /// When analyzing the value that was inserted into an aggregate, we did</Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="comment">    /// not manage to find defining &#96;extractvalue&#96; instruction to analyze.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">    NotFound,</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="comment">    /// When analyzing the value that was inserted into an aggregate, we did</Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="comment">    /// manage to find defining &#96;extractvalue&#96; instruction&#91;s&#93;, and everything</Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="comment">    /// matched perfectly - aggregate type, element insertion/extraction index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">    Found,</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="comment">    /// When analyzing the value that was inserted into an aggregate, we did</Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="comment">    /// manage to find defining &#96;extractvalue&#96; instruction, but there was</Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="comment">    /// a mismatch: either the source type from which the extraction was didn&#39;t</Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="comment">    /// match the aggregate type into which the insertion was,</Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="comment">    /// or the extraction/insertion channels mismatched,</Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="comment">    /// or different elements had different source aggregates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">    FoundMismatch</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Describe = &#91;&#93;(std::optional&lt;Value &#42;&gt; SourceAggregate) &#123;</Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SourceAggregate == NotFound)</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AggregateDescription::NotFound;</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;SourceAggregate == FoundMismatch)</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AggregateDescription::FoundMismatch;</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AggregateDescription::Found;</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If an aggregate element is defined in UseBB, we can&#39;t use it in PredBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EltDefinedInUseBB = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Given the value \\p Elt that was being inserted into element \\p EltIdx of an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// aggregate AggTy, see if \\p Elt was originally defined by an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// appropriate extractvalue (same element index, same aggregate type).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If found, return the source aggregate from which the extraction was.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If \\p PredBB is provided, does PHI translation of an \\p Elt first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FindSourceAggregate =</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Elt, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EltIdx, std::optional&lt;BasicBlock &#42;&gt; UseBB,</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">          std::optional&lt;BasicBlock &#42;&gt; PredBB) -&gt; std::optional&lt;Value &#42;&gt; &#123;</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For now(?), only deal with, at most, a single level of PHI indirection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseBB &amp;&amp; PredBB) &#123;</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">      Elt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Elt-&gt;<a href="/docs/api/classes/llvm/value/#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(&#42;UseBB, &#42;PredBB));</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Elt &amp;&amp; Elt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == &#42;UseBB)</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">        EltDefinedInUseBB = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: deal with multiple levels of PHI indirection?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Did we find an extraction?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EVI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ExtractValueInst&gt;</a>(Elt);</Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EVI)</Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NotFound;</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;SourceAggregate = EVI-&gt;getAggregateOperand();</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Is the extraction from the same type into which the insertion was?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SourceAggregate-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != AggTy)</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FoundMismatch;</Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// And the element index doesn&#39;t change between extraction and insertion?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EVI-&gt;getNumIndices() != 1 || EltIdx != EVI-&gt;getIndices().front())</Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FoundMismatch;</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SourceAggregate; </Highlight><Highlight kind="comment">// AggregateDescription::Found</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Given elements AggElts that were constructing an aggregate OrigIVI,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// see if we can find appropriate source aggregate for each of the elements,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and see it&#39;s the same aggregate for each element. If so, return it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FindCommonSourceAggregate =</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">      &#91;&amp;&#93;(std::optional&lt;BasicBlock &#42;&gt; UseBB,</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">          std::optional&lt;BasicBlock &#42;&gt; PredBB) -&gt; std::optional&lt;Value &#42;&gt; &#123;</Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">    std::optional&lt;Value &#42;&gt; SourceAggregate;</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(AggElts)) &#123;</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Describe(SourceAggregate) != AggregateDescription::FoundMismatch &amp;&amp;</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;We don&#39;t store nullptr in SourceAggregate!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Describe(SourceAggregate) == AggregateDescription::Found) ==</Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal">                 (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.index() != 0) &amp;&amp;</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;SourceAggregate should be valid after the first element,&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For this element, is there a plausible source aggregate?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// FIXME: we could special-case undef element, IFF we know that in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//        source aggregate said element isn&#39;t poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">      std::optional&lt;Value &#42;&gt; SourceAggregateForElement =</Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal">          FindSourceAggregate(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.value(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.index(), UseBB, PredBB);</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Okay, what have we found? Does that correlate with previous findings?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Regardless of whether or not we have previously found source</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// aggregate for previous elements (if any), if we didn&#39;t find one for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// this element, passthrough whatever we have just found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Describe(SourceAggregateForElement) != AggregateDescription::Found)</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SourceAggregateForElement;</Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Okay, we have found source aggregate for this element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Let&#39;s see what we already know from previous elements, if any.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Describe(SourceAggregate)) &#123;</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> AggregateDescription::NotFound:</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This is apparently the first element that we have examined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">        SourceAggregate = SourceAggregateForElement; </Highlight><Highlight kind="comment">// Record the aggregate!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Great, now look at next element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> AggregateDescription::Found:</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We have previously already successfully examined other elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Is this the same source aggregate we&#39;ve found for other elements?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;SourceAggregateForElement != &#42;SourceAggregate)</Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FoundMismatch;</Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Still the same aggregate, look at next element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> AggregateDescription::FoundMismatch:</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Can&#39;t happen. We would have early-exited then.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">      &#125;;</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Describe(SourceAggregate) == AggregateDescription::Found &amp;&amp;</Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Must be a valid Value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;SourceAggregate;</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal">  std::optional&lt;Value &#42;&gt; SourceAggregate;</Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can we find the source aggregate without looking at predecessors?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal">  SourceAggregate = FindCommonSourceAggregate(</Highlight><Highlight kind="comment">/&#42;UseBB=&#42;/</Highlight><Highlight kind="normal">std::nullopt,</Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">                                              </Highlight><Highlight kind="comment">/&#42;PredBB=&#42;/</Highlight><Highlight kind="normal">std::nullopt);</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Describe(SourceAggregate) != AggregateDescription::NotFound) &#123;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Describe(SourceAggregate) == AggregateDescription::FoundMismatch)</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Conflicting source aggregates!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">    ++NumAggregateReconstructionsSimplified;</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(OrigIVI, &#42;SourceAggregate);</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Okay, apparently we need to look at predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We should be smart about picking the &quot;use&quot; basic block, which will be the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// merge point for aggregate, where we&#39;ll insert the final PHI that will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// used instead of OrigIVI. Basic block of OrigIVI is &#42;not&#42; the right choice.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We should look in which blocks each of the AggElts is being defined,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// they all should be defined in the same basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UseBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::optional&lt;Instruction &#42;&gt; &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AggElts) &#123;</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = (&#42;I)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If it&#39;s the first instruction we&#39;ve encountered, record the basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UseBB) &#123;</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal">      UseBB = BB;</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, this must be the same basic block we&#39;ve seen previously.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseBB != BB)</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If &#42;all&#42; of the elements are basic-block-independent, meaning they are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// either function arguments, or constant expressions, then if we didn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// handle them without predecessor-aware handling, we won&#39;t handle them now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UseBB)</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we didn&#39;t manage to find source aggregate without looking at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessors, and there are no predecessors to look at, then we&#39;re done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(UseBB))</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Arbitrary predecessor count limit.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> PredCountLimit = 64;</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cache the (non-uniqified!) list of predecessors in a vector,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checking the limit at the same time for efficiency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 4&gt;</a> Preds; </Highlight><Highlight kind="comment">// May have duplicates!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(UseBB)) &#123;</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t bother if there are too many predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Preds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt;= PredCountLimit) </Highlight><Highlight kind="comment">// FIXME: only count duplicates once?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">    Preds.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Pred);</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For each predecessor, what is the source aggregate,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from which all the elements were originally extracted from?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that we want for the map to have stable iteration order!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, Value &#42;, 4&gt;</a> SourceAggregates;</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FoundSrcAgg = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : Preds) &#123;</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">    std::pair&lt;</Highlight><Highlight kind="keyword">decltype</Highlight><Highlight kind="normal">(SourceAggregates)<a href="/docs/api/classes/llvm/iplist">::iterator</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal">&gt; <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> =</Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">        SourceAggregates.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;Pred, nullptr&#125;);</Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Did we already evaluate this predecessor?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>.second)</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Let&#39;s hope that when coming from predecessor Pred, all elements of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// aggregate produced by OrigIVI must have been originally extracted from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the same aggregate. Is that so? Can we find said original aggregate?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal">    SourceAggregate = FindCommonSourceAggregate(UseBB, Pred);</Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Describe(SourceAggregate) == AggregateDescription::Found) &#123;</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="normal">      FoundSrcAgg = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>.first-&gt;second = &#42;SourceAggregate;</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If UseBB is the single successor of Pred, we can add InsertValue to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Pred-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BI || !BI-&gt;isUnconditional())</Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FoundSrcAgg)</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do some sanity check if we need to add insertvalue into predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> OrigBB = OrigIVI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;It : SourceAggregates) &#123;</Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Describe(It.second) == AggregateDescription::Found)</Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Element is defined in UseBB, so it can&#39;t be used in predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EltDefinedInUseBB)</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do this transformation cross loop boundary may cause dead loop. So we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// should avoid this situation. But LoopInfo is not generally available, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// must be conservative here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If OrigIVI is in UseBB and it&#39;s the only successor of PredBB, PredBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// can&#39;t be in inner loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseBB != OrigBB)</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Avoid constructing constant aggregate because constant value may expose</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// more optimizations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ConstAgg = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Val : AggElts) &#123;</Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Elt = (&#42;Val)-&gt;<a href="/docs/api/classes/llvm/value/#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(UseBB, It.first);</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Elt)) &#123;</Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">        ConstAgg = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ConstAgg)</Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For predecessors without appropriate source aggregate, create one in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;It : SourceAggregates) &#123;</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Describe(It.second) == AggregateDescription::Found)</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = It.first;</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(Pred-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(AggTy);</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;Idx, Val&#93; : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(AggElts)) &#123;</Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Elt = (&#42;Val)-&gt;<a href="/docs/api/classes/llvm/value/#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(UseBB, Pred);</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">      V = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateInsertValue(V, Elt, Idx);</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">    It.second = V;</Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All good! Now we just need to thread the source aggregates here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that we have to insert the new PHI here, ourselves, because we can&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// rely on InstCombinerImpl::run() inserting it into the right basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that the same block can be a predecessor more than once,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and we need to preserve that invariant for the PHI node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilderbase/insertpointguard">BuilderTy::InsertPointGuard</a> Guard(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>);</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(UseBB, UseBB-&gt;getFirstNonPHIIt());</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> =</Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreatePHI(AggTy, Preds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(), OrigIVI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.merged&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : Preds)</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(SourceAggregates&#91;Pred&#93;, Pred);</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">  ++NumAggregateReconstructionsSimplified;</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(OrigIVI, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="comment">/// Try to find redundant insertvalue instructions, like the following ones:</Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="comment">///  %0 = insertvalue &#123; i8, i32 &#125; undef, i8 %x, 0</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="comment">///  %1 = insertvalue &#123; i8, i32 &#125; %0,    i8 %y, 0</Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="comment">/// Here the second instruction inserts values at the same indices, as the</Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="comment">/// first one, making the first one redundant.</Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="comment">/// It should be transformed to:</Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="comment">///  %0 = insertvalue &#123; i8, i32 &#125; undef, i8 %y, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a643f8d7ef849e1312c83906b4b27b4aa"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a643f8d7ef849e1312c83906b4b27b4aa">InstCombinerImpl::visitInsertValueInst</a>(<a href="/docs/api/classes/llvm/insertvalueinst">InsertValueInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a94b67449bc2ce740bcec33d149769fe0">simplifyInsertValueInst</a>(</Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getAggregateOperand(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getInsertedValueOperand(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIndices(),</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, V);</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsRedundant = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;unsigned int&gt;</a> FirstIndices = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIndices();</Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is a chain of insertvalue instructions (each of them except the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// last one has only one use and it&#39;s another insertvalue insn from this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// chain), check if any of the &#39;children&#39; uses the same indices as the first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction. In this case, the first one is redundant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 0;</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (V-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &lt; 10) &#123;</Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/user">User</a> &#42;U = V-&gt;<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>();</Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> UserInsInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertValueInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UserInsInst || U-&gt;getOperand(0) != V)</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserInsInst-&gt;getIndices() == FirstIndices) &#123;</Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">      IsRedundant = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">    V = UserInsInst;</Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>++;</Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsRedundant)</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0));</Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewI = <a href="/docs/api/classes/llvm/instcombinerimpl/#acad657182350311f85bc33387733e506">foldAggregateConstructionIntoAggregateReuse</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewI;</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251" lineLink="#ace7029cdad3163ebfb8172d25e8a59e3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ace7029cdad3163ebfb8172d25e8a59e3">isShuffleEquivalentToSelect</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf) &#123;</Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can not analyze scalable type, the number of elements is not a compile-time</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ScalableVectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> MaskSize = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>().size();</Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> VecSize =</Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A vector select does not change the size of the operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaskSize != VecSize)</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Each mask element must be undefined or choose a vector element from one of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the source operands without crossing vector lanes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> i = 0; i != MaskSize; ++i) &#123;</Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> Elt = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a3fb8619f70f51242f81ef96da349c884">getMaskValue</a>(i);</Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Elt != -1 &amp;&amp; Elt != i &amp;&amp; Elt != i + VecSize)</Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="comment">/// Turn a chain of inserts that splats a value into an insert + shuffle:</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="comment">/// insertelt(insertelt(insertelt(insertelt X, %k, 0), %k, 1), %k, 2) ... -&gt;</Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="comment">/// shufflevector(insertelt(X, %k, 0), poison, zero)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279" lineLink="#ad3259dc4dae742caac6c6e4f577d1760"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#ad3259dc4dae742caac6c6e4f577d1760">foldInsSequenceIntoSplat</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;InsElt) &#123;</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are interested in the last insert in a chain. So if this insert has a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// single user and that user is an insert, bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsElt.<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InsertElementInst&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()))</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;VecTy = InsElt.<a href="/docs/api/classes/llvm/insertelementinst/#a49230ece74a48a27fb2bb1a4928b6e29">getType</a>();</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can not handle scalable type, the number of elements is not a compile-time</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ScalableVectorType&gt;</a>(VecTy))</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElements = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not try to do this for a one-element vector, since that&#39;s a nop,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and will cause an inf-loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumElements == 1)</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SplatVal = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &#42;CurrIE = &amp;InsElt;</Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallbitvector">SmallBitVector</a> ElementPresent(NumElements, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &#42;FirstIE = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk the chain backwards, keeping track of which indices we inserted into,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// until we hit something that isn&#39;t an insert of the splatted value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (CurrIE) &#123;</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Idx = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(CurrIE-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2));</Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Idx || CurrIE-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) != SplatVal)</Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NextIE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(CurrIE-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check none of the intermediate steps have any additional uses, except</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for the root insertelement instruction, which can be re-used, if it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inserts at position 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrIE != &amp;InsElt &amp;&amp;</Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">        (!CurrIE-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; (NextIE != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> || !Idx-&gt;isZero())))</Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">    ElementPresent&#91;Idx-&gt;getZExtValue()&#93; = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">    FirstIE = CurrIE;</Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">    CurrIE = NextIE;</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is just a single insertelement (not a sequence), we are done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstIE == &amp;InsElt)</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we are not inserting into a poison vector, make sure we&#39;ve seen an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// insert into every element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: If the base vector is not undef, it might be better to create a splat</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       and then a select-shuffle (blend) with the base vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(FirstIE-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()))</Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ElementPresent.<a href="/docs/api/classes/llvm/smallbitvector/#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>())</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the insert + shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Int64Ty = <a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(InsElt.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/poisonvalue">PoisonValue</a> &#42;PoisonVec = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(VecTy);</Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Zero = ConstantInt::get(Int64Ty, 0);</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(FirstIE-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2))-&gt;isZero())</Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">    FirstIE = <a href="/docs/api/classes/llvm/insertelementinst/#a3c7d92166c1f18129c2727c9dc808b29">InsertElementInst::Create</a>(PoisonVec, SplatVal, Zero, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">                                        InsElt.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Splat from element 0, but replace absent elements with poison in the mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> Mask(NumElements, 0);</Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumElements; ++i)</Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ElementPresent&#91;i&#93;)</Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal">      Mask&#91;i&#93; = -1;</Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(FirstIE, Mask);</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="comment">/// Try to fold an insert element into an existing splat shuffle by changing</Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="comment">/// the shuffle&#39;s mask to include the index of this insert element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353" lineLink="#a542a88a5b133e2ac8bd9ceb3f8c77dc9"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a542a88a5b133e2ac8bd9ceb3f8c77dc9">foldInsEltIntoSplat</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;InsElt) &#123;</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the vector operand of this insert is a canonical splat shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Shuf = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Shuf || !Shuf-&gt;isZeroEltSplat())</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bail out early if shuffle is scalable type. The number of elements in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle mask is unknown at compile-time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ScalableVectorType&gt;</a>(Shuf-&gt;getType()))</Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check for a constant insertion index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal">  uint64&#95;t IdxC;</Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IdxC)))</Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the splat shuffle&#39;s input is the same as this insert&#39;s scalar op.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Shuf-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>())))</Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the shuffle mask element at the index of this insert with a zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inselt (shuf (inselt undef, X, 0), &#95;, &lt;0,undef,0,undef&gt;), X, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   --&gt; shuf (inselt undef, X, 0), poison, &lt;0,0,0,undef&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumMaskElts =</Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> NewMask(NumMaskElts);</Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumMaskElts; ++i)</Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">    NewMask&#91;i&#93; = i == IdxC ? 0 : Shuf-&gt;getMaskValue(i);</Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(Op0, NewMask);</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="comment">/// Try to fold an extract+insert element into an existing identity shuffle by</Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="comment">/// changing the shuffle&#39;s mask to include the index of this insert element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390" lineLink="#ae13bc9134960231b8354f62cfa902782"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#ae13bc9134960231b8354f62cfa902782">foldInsEltIntoIdentityShuffle</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;InsElt) &#123;</Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the vector operand of this insert is an identity shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Shuf = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Shuf || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) ||</Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal">      !(Shuf-&gt;isIdentityWithExtract() || Shuf-&gt;isIdentityWithPadding()))</Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bail out early if shuffle is scalable type. The number of elements in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle mask is unknown at compile-time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ScalableVectorType&gt;</a>(Shuf-&gt;getType()))</Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check for a constant insertion index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">  uint64&#95;t IdxC;</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IdxC)))</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if this insert&#39;s scalar op is extracted from the identity shuffle&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// input vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Scalar = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Shuf-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a href="/docs/api/namespaces/llvm/patternmatch/#a36633f71df7e81c6155619890e65a8b2">m&#95;ExtractElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(IdxC))))</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the shuffle mask element at the index of this extract+insert with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that same index value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inselt (shuf X, IdMask), (extelt X, IdxC), IdxC --&gt; shuf X, IdMask&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumMaskElts =</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> NewMask(NumMaskElts);</Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> OldMask = Shuf-&gt;getShuffleMask();</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumMaskElts; ++i) &#123;</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (i != IdxC) &#123;</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// All mask elements besides the inserted element remain the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal">      NewMask&#91;i&#93; = OldMask&#91;i&#93;;</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldMask&#91;i&#93; == (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)IdxC) &#123;</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the mask element was already set, there&#39;s nothing to do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// (demanded elements analysis may unset it later).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldMask&#91;i&#93; == <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Unexpected shuffle mask element for identity shuffle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal">      NewMask&#91;i&#93; = IdxC;</Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Shuf-&gt;getOperand(1), NewMask);</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="comment">/// If we have an insertelement instruction feeding into another insertelement</Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="comment">/// and the 2nd is inserting a constant into the vector, canonicalize that</Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="comment">/// constant insertion before the insertion of a variable:</Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="comment">/// insertelement (insertelement X, Y, IdxC1), ScalarC, IdxC2 --&gt;</Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="comment">/// insertelement (insertelement X, ScalarC, IdxC2), Y, IdxC1</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="comment">/// This has the potential of eliminating the 2nd insertelement instruction</Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="comment">/// via constant folding of the scalar constant into a vector constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449" lineLink="#a9a97530480ce0284bb6dace4356e906c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a9a97530480ce0284bb6dace4356e906c">hoistInsEltConst</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;InsElt2,</Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InsElt1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(InsElt2.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsElt1 || !InsElt1-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ScalarC;</Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;IdxC1, &#42;IdxC2;</Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt1-&gt;getOperand(0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt1-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt1-&gt;getOperand(2), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IdxC1)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt2.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(ScalarC)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt2.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IdxC2)) &amp;&amp; IdxC1 != IdxC2) &#123;</Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInsElt1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a17320ebd77e834577a5ebd1063039625">CreateInsertElement</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ScalarC, IdxC2);</Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/insertelementinst/#a3c7d92166c1f18129c2727c9dc808b29">InsertElementInst::Create</a>(NewInsElt1, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, IdxC1);</Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="comment">/// insertelt (shufflevector X, CVec, Mask|insertelt X, C1, CIndex1), C, CIndex</Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="comment">/// --&gt; shufflevector X, CVec&#39;, Mask&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472" lineLink="#a01aa2c4724ae9bf421d1cfff3a1c7fa5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a01aa2c4724ae9bf421d1cfff3a1c7fa5">foldConstantInsEltIntoShuffle</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;InsElt) &#123;</Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bail out if the parent has more than one use. In that case, we&#39;d be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replacing the insertelt with a shuffle, and that&#39;s not a clear win.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Inst || !Inst-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Shuf = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))) &#123;</Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The shuffle must have a constant vector operand. The insertelt must have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a constant scalar being inserted at a constant position in the vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ShufConstVec, &#42;InsEltScalar;</Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal">    uint64&#95;t InsEltIndex;</Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(ShufConstVec)) ||</Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(InsEltScalar)) ||</Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(InsEltIndex)))</Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Adding an element to an arbitrary shuffle could be expensive, but a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuffle that selects elements from vectors without crossing lanes is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// assumed cheap.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we&#39;re just adding a constant into that shuffle, it will still be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cheap.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ace7029cdad3163ebfb8172d25e8a59e3">isShuffleEquivalentToSelect</a>(&#42;Shuf))</Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// From the above &#39;select&#39; check, we know that the mask has the same number</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of elements as the vector input operands. We also know that each constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// input element is used in its lane and can not be used more than once by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the shuffle. Therefore, replace the constant in the shuffle&#39;s constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vector with the insertelt constant. Replace the constant in the shuffle&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// mask vector with the insertelt index plus the length of the vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (because the constant vector operand of a shuffle is always the 2nd</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// operand).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask = Shuf-&gt;getShuffleMask();</Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = Mask.size();</Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 16&gt;</a> NewShufElts(NumElts);</Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> NewMaskElts(NumElts);</Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != NumElts; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == InsEltIndex) &#123;</Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">        NewShufElts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = InsEltScalar;</Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal">        NewMaskElts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = InsEltIndex + NumElts;</Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Copy over the existing values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">        NewShufElts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = ShufConstVec-&gt;<a href="/docs/api/classes/llvm/constant/#acd530d0571f320d47d37e7ae51cf70ff">getAggregateElement</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal">        NewMaskElts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = Mask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Bail if we failed to find an element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewShufElts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;)</Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create new operands for a shuffle that includes the constant of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// original insertelt. The old shuffle will be dead now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(Shuf-&gt;getOperand(0),</Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/constantvector/#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(NewShufElts), NewMaskElts);</Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IEI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Transform sequences of insertelements ops with constant data/indexes into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a single shuffle op.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Can not handle scalable type, the number of elements needed to create</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuffle mask is not a compile-time constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ScalableVectorType&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/insertelementinst/#a49230ece74a48a27fb2bb1a4928b6e29">getType</a>()))</Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts =</Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/insertelementinst/#a49230ece74a48a27fb2bb1a4928b6e29">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal">    uint64&#95;t InsertIdx&#91;2&#93;;</Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Val&#91;2&#93;;</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(InsertIdx&#91;0&#93;)) ||</Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Val&#91;0&#93;)) ||</Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IEI-&gt;getOperand(2), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(InsertIdx&#91;1&#93;)) ||</Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IEI-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Val&#91;1&#93;)))</Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 16&gt;</a> Values(NumElts);</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> Mask(NumElts);</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ValI = std::begin(Val);</Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Generate new constant vector and mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We have 2 values/masks from the insertelements instructions. Insert them</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// into new value/mask vectors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (uint64&#95;t <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : InsertIdx) &#123;</Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Values&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;) &#123;</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal">        Values&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = &#42;ValI;</Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">        Mask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = NumElts + <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">      ++ValI;</Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remaining values are filled with &#39;poison&#39; values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumElts; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Values&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;) &#123;</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">        Values&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(InsElt.<a href="/docs/api/classes/llvm/insertelementinst/#a49230ece74a48a27fb2bb1a4928b6e29">getType</a>()-&gt;<a href="/docs/api/classes/llvm/vectortype/#afdce715c901d62e2c1367a0ff5248175">getElementType</a>());</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal">        Mask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create new operands for a shuffle that includes the constant of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// original insertelt.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(IEI-&gt;getOperand(0),</Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/constantvector/#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(Values), Mask);</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="comment">/// If both the base vector and the inserted element are extended from the same</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="comment">/// type, do the insert element in the narrow source type followed by extend.</Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="comment">/// TODO: This can be extended to include other cast opcodes, but particularly</Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="comment">///       if we create a wider insertelement, make sure codegen is not harmed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576" lineLink="#acb762c0dfb2a90596163f59e2dfbd029"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#acb762c0dfb2a90596163f59e2dfbd029">narrowInsElt</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;InsElt,</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are creating a vector extend. If the original vector extend has another</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// use, that would mean we end up with 2 vector extends, so avoid that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: We could ease the use-clause to &quot;if at least one op has one use&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       (assuming that the source types match - see next TODO comment).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Vec = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Vec-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Scalar = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">CastInst::CastOps</a> CastOpcode;</Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Vec, <a href="/docs/api/namespaces/llvm/patternmatch/#a66f6b638df59d75afc83d660a173f53d">m&#95;FPExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a href="/docs/api/namespaces/llvm/patternmatch/#a66f6b638df59d75afc83d660a173f53d">m&#95;FPExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))))</Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">    CastOpcode = Instruction::FPExt;</Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Vec, <a href="/docs/api/namespaces/llvm/patternmatch/#ae5cf2b09af0c75d08cf9e5e8f2818a66">m&#95;SExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a href="/docs/api/namespaces/llvm/patternmatch/#ae5cf2b09af0c75d08cf9e5e8f2818a66">m&#95;SExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))))</Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal">    CastOpcode = Instruction::SExt;</Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Vec, <a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))))</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal">    CastOpcode = Instruction::ZExt;</Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: We can allow mismatched types by creating an intermediate cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;getScalarType() != <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType())</Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inselt (ext X), (ext Y), Index --&gt; ext (inselt X, Y, Index)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInsElt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a17320ebd77e834577a5ebd1063039625">CreateInsertElement</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2));</Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(CastOpcode, NewInsElt, InsElt.<a href="/docs/api/classes/llvm/insertelementinst/#a49230ece74a48a27fb2bb1a4928b6e29">getType</a>());</Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="comment">/// If we are inserting 2 halves of a value into adjacent elements of a vector,</Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="comment">/// try to convert to a single insert with appropriate bitcasts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609" lineLink="#a1f6c8af64ed18f5f5810f78abf9b4f33"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a1f6c8af64ed18f5f5810f78abf9b4f33">foldTruncInsEltPair</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;InsElt,</Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsBigEndian,</Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecOp    = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarOp = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IndexOp  = InsElt.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2);</Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pattern depends on endian because we expect lower index is inserted first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Big endian:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inselt (inselt BaseVec, (trunc (lshr X, BW/2), Index0), (trunc X), Index1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Little endian:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inselt (inselt BaseVec, (trunc X), Index0), (trunc (lshr X, BW/2)), Index1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note: It is not safe to do this transform with an arbitrary base vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       because the bitcast of that vector to fewer/larger elements could</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       allow poison to spill into an element that was not poison before.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Detect smaller fractions of the scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: One-use checks are conservative.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(InsElt.<a href="/docs/api/classes/llvm/insertelementinst/#a49230ece74a48a27fb2bb1a4928b6e29">getType</a>());</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Scalar0, &#42;BaseVec;</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal">  uint64&#95;t Index0, Index1;</Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VTy || (VTy-&gt;getNumElements() &amp; 1) ||</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IndexOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(Index1)) ||</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(BaseVec), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Scalar0),</Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="normal">                                <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(Index0))) ||</Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BaseVec, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()))</Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The first insert must be to the index one less than this one, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the first insert must be to an even index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Index0 + 1 != Index1 || Index0 &amp; 1)</Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For big endian, the high half of the value should be inserted first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For little endian, the low half of the value should be inserted first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">  uint64&#95;t ShAmt;</Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsBigEndian) &#123;</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) ||</Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar0, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(ShAmt)))))</Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar0, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) ||</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(ShAmt)))))</Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ScalarWidth = SrcTy-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VecEltWidth = VTy-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarWidth != VecEltWidth &#42; 2 || ShAmt != VecEltWidth)</Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bitcast the base vector to a vector type with the source element type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CastTy = <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(SrcTy, VTy-&gt;getNumElements() / 2);</Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastBaseVec = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(BaseVec, CastTy);</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Scale the insert index for a vector with half as many elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bitcast (inselt (bitcast BaseVec), X, NewIndex)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal">  uint64&#95;t NewIndex = IsBigEndian ? Index1 / 2 : Index0 / 2;</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInsert = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a17320ebd77e834577a5ebd1063039625">CreateInsertElement</a>(CastBaseVec, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, NewIndex);</Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(NewInsert, VTy);</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a687fa4390149f0cb751d8ad89dca6a3c"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a687fa4390149f0cb751d8ad89dca6a3c">InstCombinerImpl::visitInsertElementInst</a>(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;IE) &#123;</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecOp    = IE.getOperand(0);</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarOp = IE.getOperand(1);</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IdxOp    = IE.getOperand(2);</Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V = <a href="/docs/api/namespaces/llvm/#abdf4b5f9e1dc6887cac393ee643c10b6">simplifyInsertElementInst</a>(</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="normal">          VecOp, ScalarOp, IdxOp, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;IE)))</Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(IE, V);</Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize type of constant indices to i64 to simplify CSE</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndexC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(IdxOp)) &#123;</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewIdx = <a href="#ae67d970cf80e86c5789e52f9d57d0c70">getPreferredVectorIndex</a>(IndexC))</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(IE, 2, NewIdx);</Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;BaseVec, &#42;OtherScalar;</Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal">    uint64&#95;t OtherIndexVal;</Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(BaseVec),</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">                                          <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(OtherScalar),</Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">                                          <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(OtherIndexVal)))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(OtherScalar) &amp;&amp; OtherIndexVal &gt; IndexC-&gt;getZExtValue()) &#123;</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewIns = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateInsertElement(BaseVec, ScalarOp, IdxOp);</Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/insertelementinst/#a3c7d92166c1f18129c2727c9dc808b29">InsertElementInst::Create</a>(NewIns, OtherScalar,</Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.getInt64(OtherIndexVal));</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the scalar is bitcast and inserted into undef, do the insert in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// source type followed by bitcast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Generalize for insert into any constant, not just undef?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarSrc;</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ScalarSrc)))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal">      (ScalarSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">       ScalarSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>())) &#123;</Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inselt undef, (bitcast ScalarSrc), IdxOp --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   bitcast (inselt undef, ScalarSrc, IdxOp)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy = ScalarSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;VecTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(ScalarTy, IE.getType()-&gt;getElementCount());</Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewUndef = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(VecOp) ? <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(VecTy)</Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal">                                                 : <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(VecTy);</Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInsElt = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateInsertElement(NewUndef, ScalarSrc, IdxOp);</Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(NewInsElt, IE.getType());</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the vector and scalar are both bitcast from the same element type, do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the insert in that source type followed by bitcast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecSrc;</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VecSrc))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ScalarSrc))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal">      (VecOp-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || ScalarOp-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">      VecSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; !ScalarSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(VecSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getElementType() ==</Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">          ScalarSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inselt (bitcast VecSrc), (bitcast ScalarSrc), IdxOp --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   bitcast (inselt VecSrc, ScalarSrc, IdxOp)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewInsElt = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateInsertElement(VecSrc, ScalarSrc, IdxOp);</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(NewInsElt, IE.getType());</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the inserted element was extracted from some other fixed-length vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and both indexes are valid constants, try to turn this into a shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can not handle scalable vector type, the number of elements needed to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// create shuffle mask is not a compile-time constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">  uint64&#95;t InsertedIdx, ExtractedIdx;</Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtVecOp;</Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FixedVectorType&gt;</a>(IE.getType()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IdxOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(InsertedIdx)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp,</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/patternmatch/#a36633f71df7e81c6155619890e65a8b2">m&#95;ExtractElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ExtVecOp), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(ExtractedIdx))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FixedVectorType&gt;</a>(ExtVecOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">      ExtractedIdx &lt;</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(ExtVecOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements()) &#123;</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Looking at the user(s) to determine if this insert is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// fold-to-shuffle opportunity does not match the usual instcombine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// constraints. We should decide if the transform is worthy based only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// on this instruction and its operands, but that may not work currently.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Here, we are trying to avoid creating shuffles before reaching</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the end of a chain of extract-insert pairs. This is complicated because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we do not generally form arbitrary shuffle masks in instcombine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (because those may codegen poorly), but collectShuffleElements() does</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// exactly that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The rules for determining what is an acceptable target-independent</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuffle mask are fuzzy because they evolve based on the backend&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// capabilities and real-world impact.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> isShuffleRootCandidate = &#91;&#93;(<a href="/docs/api/classes/llvm/insertelementinst">InsertElementInst</a> &amp;Insert) &#123;</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Insert.hasOneUse())</Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InsertUser = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(Insert.user&#95;back());</Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InsertUser)</Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to form a shuffle from a chain of extract-insert ops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isShuffleRootCandidate(IE)) &#123;</Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Rerun = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (Rerun) &#123;</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal">        Rerun = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> Mask;</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal">        <a href="#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> LR =</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal">            <a href="#a1e502a1ec39cc64d6b86e9e68b29be89">collectShuffleElements</a>(&amp;IE, Mask, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, Rerun);</Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The proposed shuffle may be trivial, in which case we shouldn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// perform the combine.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LR.first != &amp;IE &amp;&amp; LR.second != &amp;IE) &#123;</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We now have a shuffle of LHS, RHS, Mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LR.second == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="normal">            LR.second = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(LR.first-&gt;getType());</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(LR.first, LR.second, Mask);</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> VecTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(VecOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VWidth = VecTy-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> PoisonElts(VWidth, 0);</Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> AllOnesEltMask(<a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth));</Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/instcombinerimpl/#a37cce7aa1875173688e5971c5d6fa9e0">SimplifyDemandedVectorElts</a>(&amp;IE, AllOnesEltMask,</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="normal">                                              PoisonElts)) &#123;</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V != &amp;IE)</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(IE, V);</Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;IE;</Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Shuf = <a href="#a01aa2c4724ae9bf421d1cfff3a1c7fa5">foldConstantInsEltIntoShuffle</a>(IE))</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Shuf;</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewInsElt = <a href="#a9a97530480ce0284bb6dace4356e906c">hoistInsEltConst</a>(IE, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewInsElt;</Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Broadcast = <a href="#ad3259dc4dae742caac6c6e4f577d1760">foldInsSequenceIntoSplat</a>(IE))</Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Broadcast;</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a> = <a href="#a542a88a5b133e2ac8bd9ceb3f8c77dc9">foldInsEltIntoSplat</a>(IE))</Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a>;</Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IdentityShuf = <a href="#ae13bc9134960231b8354f62cfa902782">foldInsEltIntoIdentityShuffle</a>(IE))</Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IdentityShuf;</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext = <a href="#acb762c0dfb2a90596163f59e2dfbd029">narrowInsElt</a>(IE, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Ext;</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ext = <a href="#a1f6c8af64ed18f5f5810f78abf9b4f33">foldTruncInsEltPair</a>(IE, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isBigEndian(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Ext;</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="comment">/// Return true if we can evaluate the specified expression tree if the vector</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="comment">/// elements were shuffled in a different order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827" lineLink="#a95fd07ca61f35098e091aa2329f9c8a6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask,</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal">                                </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 5) &#123;</Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can always reorder the elements of a constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We won&#39;t reorder vector arguments. No IPO here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Two users may expect different orders of the elements. Don&#39;t try it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> == 0) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Propagating an undefined shuffle mask element to integer div/rem is not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// allowed because those opcodes can create immediate undefined behavior</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// from an undefined element in an operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(Mask, -1))</Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">      &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FAdd:</Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FSub:</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FMul:</Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FDiv:</Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FRem:</Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl:</Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::LShr:</Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AShr:</Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::And:</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Xor:</Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp:</Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FCmp:</Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Trunc:</Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ZExt:</Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SExt:</Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToUI:</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToSI:</Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UIToFP:</Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SIToFP:</Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPTrunc:</Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPExt:</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::GetElementPtr: &#123;</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Bail out if we would create longer vector ops. We could allow creating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// longer vector ops, but that may result in more expensive codegen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ITy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ITy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">          Mask.size() &gt; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(ITy)-&gt;getNumElements())</Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Operand : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) &#123;</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(Operand, Mask, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> - 1))</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::InsertElement: &#123;</Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2));</Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> ElementNumber = CI-&gt;<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>();</Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Verify that &#39;CI&#39; does not occur twice in Mask. A single &#39;insertelement&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// can&#39;t put an element into multiple indices.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> SeenOnce = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Mask) &#123;</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == ElementNumber) &#123;</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SeenOnce)</Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">          SeenOnce = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Mask, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> - 1);</Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="comment">/// Rebuild a new instruction just like &#39;I&#39; but with the new operands given.</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="comment">/// In the event of type mismatch, the type of the operands is correct.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915" lineLink="#a8efa56ca3bfdd8c715939f9e0b24ccda"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a8efa56ca3bfdd8c715939f9e0b24ccda">buildNew</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value&#42;&gt;</a> NewOps,</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">                       <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FAdd:</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FSub:</Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FMul:</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FDiv:</Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FRem:</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl:</Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::LShr:</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AShr:</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::And:</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Xor: &#123;</Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;binary operator with #ops != 2&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;New = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanslp-cpp/#a06b4f19004df11b338ccc7e73bf47ab4">getOpcode</a>(),</Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">                                       NewOps&#91;0&#93;, NewOps&#91;1&#93;);</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(New)) &#123;</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;OverflowingBinaryOperator&gt;</a>(BO)) &#123;</Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">          NewI-&gt;setHasNoUnsignedWrap(BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a100c666f9253331dd1d166a863248326">hasNoUnsignedWrap</a>());</Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">          NewI-&gt;setHasNoSignedWrap(BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a350f4fdc01c770b5cf6a8be2624ae3e5">hasNoSignedWrap</a>());</Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PossiblyExactOperator&gt;</a>(BO)) &#123;</Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">          NewI-&gt;setIsExact(BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a689a03df5b4ae094d6a3a1bd13dac574">isExact</a>());</Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPMathOperator&gt;</a>(BO))</Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">          NewI-&gt;copyFastMathFlags(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> New;</Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp:</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;icmp with #ops != 2&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getPredicate(), NewOps&#91;0&#93;,</Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">                                NewOps&#91;1&#93;);</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FCmp:</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;fcmp with #ops != 2&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a168f682d44a3697eba421b802787f6bf">CreateFCmp</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FCmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getPredicate(), NewOps&#91;0&#93;,</Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">                                NewOps&#91;1&#93;);</Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Trunc:</Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ZExt:</Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SExt:</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToUI:</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToSI:</Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UIToFP:</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SIToFP:</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPTrunc:</Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPExt: &#123;</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It&#39;s possible that the mask has a different number of elements from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the original cast. We recompute the destination type to match the mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(</Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;getScalarType(),</Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(NewOps&#91;0&#93;-&gt;getType())-&gt;getElementCount());</Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 1 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;cast with #ops != 1&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5b7f6dddc76bf7954b8df6abbd974436">CreateCast</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanslp-cpp/#a06b4f19004df11b338ccc7e73bf47ab4">getOpcode</a>(), NewOps&#91;0&#93;,</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">                                DestTy);</Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::GetElementPtr: &#123;</Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = NewOps&#91;0&#93;;</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value&#42;&gt;</a> Idx = NewOps.<a href="/docs/api/classes/llvm/arrayref/#aebf6ca7590d4f766b894044015a0fa31">slice</a>(1);</Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getSourceElementType(),</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">                               <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Idx, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">                               <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isInBounds());</Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;failed to rebuild vector instructions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991" lineLink="#a06358c30f3e98d9e57f4ae9162f33c72"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a06358c30f3e98d9e57f4ae9162f33c72">evaluateInDifferentElementOrder</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask,</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal">                                              <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Mask.size() does not need to be equal to the number of vector elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getType()-&gt;isVectorTy() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;can&#39;t reorder non-vector elements&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;EltTy = V-&gt;getType()-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(V))</Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(EltTy, Mask.size()));</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()))</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(<a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(EltTy, Mask.size()));</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantAggregateZero&gt;</a>(V))</Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantaggregatezero/#abfa1cf8b4348407b167f93bc7c01055f">ConstantAggregateZero::get</a>(<a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(EltTy, Mask.size()));</Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantexpr/#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()),</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal">                                          Mask);</Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FAdd:</Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FSub:</Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FMul:</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FDiv:</Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FRem:</Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl:</Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::LShr:</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AShr:</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::And:</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Xor:</Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp:</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FCmp:</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Trunc:</Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ZExt:</Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SExt:</Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToUI:</Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToSI:</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UIToFP:</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SIToFP:</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPTrunc:</Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPExt:</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Select:</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::GetElementPtr: &#123;</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;, 8&gt;</a> NewOps;</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedsRebuild =</Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">          (Mask.size() !=</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType())-&gt;getNumElements());</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> i = 0, e = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;V;</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Recursively call evaluateInDifferentElementOrder on vector arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// as well. E.g. GetElementPtr may have scalar operands even if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// return value is a vector, so we need to examine the operand type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(i)-&gt;getType()-&gt;isVectorTy())</Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="normal">          V = <a href="#a06358c30f3e98d9e57f4ae9162f33c72">evaluateInDifferentElementOrder</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(i), Mask, Builder);</Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal">          V = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(i);</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal">        NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(V);</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal">        NeedsRebuild |= (V != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(i));</Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedsRebuild)</Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a8efa56ca3bfdd8c715939f9e0b24ccda">buildNew</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NewOps, Builder);</Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::InsertElement: &#123;</Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> Element = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2))-&gt;getLimitedValue();</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The insertelement was inserting at Element. Figure out which element</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that becomes after shuffling. The answer is guaranteed to be unique</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// by CanEvaluateShuffled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Found = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> Index = 0;</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> e = Mask.size(); Index != e; ++Index) &#123;</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;Index&#93; == Element) &#123;</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal">          Found = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If element is not in Mask, no need to handle the operand 1 (element to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// be inserted). Just evaluate values in operand 0 according to Mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Found)</Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a06358c30f3e98d9e57f4ae9162f33c72">evaluateInDifferentElementOrder</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Mask, Builder);</Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="#a06358c30f3e98d9e57f4ae9162f33c72">evaluateInDifferentElementOrder</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Mask,</Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">                                                 Builder);</Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a17320ebd77e834577a5ebd1063039625">CreateInsertElement</a>(V, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Index);</Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;failed to reorder elements of vector instruction!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Returns true if the shuffle is extracting a contiguous range of values from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal"></Highlight><Highlight kind="comment">// LHS, for example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal"></Highlight><Highlight kind="comment">//                 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   Input:        |AA|BB|CC|DD|EE|FF|GG|HH|II|JJ|KK|LL|MM|NN|OO|PP|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   Shuffles to:  |EE|FF|GG|HH|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal"></Highlight><Highlight kind="comment">//                 +--+--+--+--+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099" lineLink="#ae8f4745a87bae0a614d6bda1cc55ab01"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ae8f4745a87bae0a614d6bda1cc55ab01">isShuffleExtractingFromLHS</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;SVI,</Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask) &#123;</Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LHSElems =</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SVI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaskElems = Mask.size();</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BegIdx = Mask.front();</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EndIdx = Mask.back();</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BegIdx &gt; EndIdx || EndIdx &gt;= LHSElems || EndIdx - BegIdx != MaskElems - 1)</Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != MaskElems; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(Mask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;) != BegIdx + <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="comment">/// These are the ingredients in an alternate form binary operator as described</Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="comment">/// below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116" lineLink="/docs/api/structs/binopelts"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/binopelts/#a085a4f7976730eeaeb8c7037fe8c7aab">BinopElts</a> &#123;</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117" lineLink="/docs/api/structs/binopelts/#a0b1dcc01090bf24bebc2584f6a17b0d8"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> <a href="/docs/api/structs/binopelts/#a0b1dcc01090bf24bebc2584f6a17b0d8">Opcode</a>;</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118" lineLink="/docs/api/structs/binopelts/#a7eb0f39f02b88e3c97ba994ee191f148"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/binopelts/#a7eb0f39f02b88e3c97ba994ee191f148">Op0</a>;</Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119" lineLink="/docs/api/structs/binopelts/#a507629db7779162187dcbdc907798b45"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/binopelts/#a507629db7779162187dcbdc907798b45">Op1</a>;</Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120" lineLink="/docs/api/structs/binopelts/#a085a4f7976730eeaeb8c7037fe8c7aab"><Highlight kind="normal">  <a href="/docs/api/structs/binopelts/#a085a4f7976730eeaeb8c7037fe8c7aab">BinopElts</a>(<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> Opc = (<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a>)0,</Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;V0 = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V1 = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) :</Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="normal">      <a href="/docs/api/structs/binopelts/#a0b1dcc01090bf24bebc2584f6a17b0d8">Opcode</a>(Opc), <a href="/docs/api/structs/binopelts/#a7eb0f39f02b88e3c97ba994ee191f148">Op0</a>(V0), <a href="/docs/api/structs/binopelts/#a507629db7779162187dcbdc907798b45">Op1</a>(V1) &#123;&#125;</Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123" lineLink="/docs/api/structs/binopelts/#a8865792409d2961bde1ac9c62bd75f93"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">operator</Highlight><Highlight kind="normal"> bool()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/binopelts/#a0b1dcc01090bf24bebc2584f6a17b0d8">Opcode</a> != 0; &#125;</Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="comment">/// Binops may be transformed into binops with different opcodes and operands.</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="comment">/// Reverse the usual canonicalization to enable folds with the non-canonical</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="comment">/// form of the binop. If a transform is possible, return the elements of the</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="comment">/// new binop. If not, return invalid elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130" lineLink="#af7e7c9415c23ae336af651877798a377"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/binopelts">BinopElts</a> <a href="#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;BO0 = BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;BO1 = BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = BO-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>()) &#123;</Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl: &#123;</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shl X, C --&gt; mul X, (1 &lt;&lt; C)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO1, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &#123;</Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ShlOne = <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(</Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">          Instruction::Shl, ConstantInt::get(Ty, 1), <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ShlOne &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Constant folding of immediate constants failed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;Instruction::Mul, BO0, ShlOne&#125;;</Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or: &#123;</Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// or disjoin X, C --&gt; add X, C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PossiblyDisjointInst&gt;</a>(BO)-&gt;isDisjoint())</Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;Instruction::Add, BO0, BO1&#125;;</Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// sub 0, X --&gt; mul X, -1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO0, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>()))</Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;Instruction::Mul, BO1, <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">ConstantInt::getAllOnesValue</a>(Ty)&#125;;</Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="comment">/// A select shuffle of a select shuffle with a shared operand can be reduced</Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="comment">/// to a single select shuffle. This is an obvious improvement in IR, and the</Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="comment">/// backend is expected to lower select shuffles efficiently.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165" lineLink="#a98282716af42c878d4638603c6efb350"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a98282716af42c878d4638603c6efb350">foldSelectShuffleOfSelectShuffle</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf) &#123;</Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a747673ac3ea44aadc3907c6b9fd86237">isSelect</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must have select-equivalent shuffle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;Op1 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> Mask;</Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal">  Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(Mask);</Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = Mask.size();</Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize a select shuffle with common operand as Op1.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ShufOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(Op0);</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShufOp &amp;&amp; ShufOp-&gt;isSelect() &amp;&amp;</Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal">      (ShufOp-&gt;getOperand(0) == Op1 || ShufOp-&gt;getOperand(1) == Op1)) &#123;</Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Op0, Op1);</Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/shufflevectorinst/#a9874bec83353914ed1e9309d5d9ccea0">ShuffleVectorInst::commuteShuffleMask</a>(Mask, NumElts);</Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="normal">  ShufOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(Op1);</Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ShufOp || !ShufOp-&gt;isSelect() ||</Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal">      (ShufOp-&gt;getOperand(0) != Op0 &amp;&amp; ShufOp-&gt;getOperand(1) != Op0))</Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = ShufOp-&gt;getOperand(0), &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = ShufOp-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> Mask1;</Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">  ShufOp-&gt;getShuffleMask(Mask1);</Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Mask1.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == NumElts &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Vector size changed with select shuffle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize common operand (Op0) as X (first operand of first shuffle).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> == Op0) &#123;</Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/shufflevectorinst/#a9874bec83353914ed1e9309d5d9ccea0">ShuffleVectorInst::commuteShuffleMask</a>(Mask1, NumElts);</Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the mask chooses from X (operand 0), it stays the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the mask chooses from the earlier shuffle, the other mask value is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// transferred to the combined select shuffle:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf X, (shuf X, Y, M1), M --&gt; shuf X, Y, M&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> NewMask(NumElts);</Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumElts; ++i)</Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="normal">    NewMask&#91;i&#93; = Mask&#91;i&#93; &lt; (</Highlight><Highlight kind="keywordtype">signed</Highlight><Highlight kind="normal">)NumElts ? Mask&#91;i&#93; : Mask1&#91;i&#93;;</Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A select mask with undef elements might look like an identity mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/shufflevectorinst/#a527e61685c56e6fab3cd424f74fa71ec">ShuffleVectorInst::isSelectMask</a>(NewMask, NumElts) ||</Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/shufflevectorinst/#a81aa4ff7f63f7988abea1abbe9eb0342">ShuffleVectorInst::isIdentityMask</a>(NewMask, NumElts)) &amp;&amp;</Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Unexpected shuffle mask&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, NewMask);</Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212" lineLink="#a2c05df65ce7ce7ec1d78348be2452e8d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a2c05df65ce7ce7ec1d78348be2452e8d">foldSelectShuffleWith1Binop</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf,</Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="normal">                                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;SQ) &#123;</Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a747673ac3ea44aadc3907c6b9fd86237">isSelect</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must have select-equivalent shuffle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Are we shuffling together some value and that same value after it has been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// modified by a binop with a constant?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;Op1 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Op0IsBinop;</Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))))</Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal">    Op0IsBinop = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))))</Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal">    Op0IsBinop = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The identity constant for a binop leaves a variable operand unchanged. For</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a vector, this is a splat of something like 0, -1, or 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there&#39;s no identity constant for this binop, we&#39;re done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BO = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(Op0IsBinop ? Op0 : Op1);</Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> BOpcode = BO-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;IdC = <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(BOpcode, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>(), </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IdC)</Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Op0IsBinop ? Op1 : Op0;</Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Prevent folding in the case the non-binop operand might have NaN values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If X can have NaN elements then we have that the floating point math</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operation in the transformed code may not preserve the exact NaN</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bit-pattern -- e.g. &#96;fadd sNaN, 0 -&gt; qNaN&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This makes the transformation incorrect since the original program would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// have preserved the exact NaN bit-pattern.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Avoid the folding if X can have NaN elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>()-&gt;<a href="/docs/api/classes/llvm/vectortype/#afdce715c901d62e2c1367a0ff5248175">getElementType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#adb004c066abda7e0738004a08bc1827f">isKnownNeverNaN</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, 0, SQ))</Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Shuffle identity constants into the lanes that return the original value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Example: shuf (mul X, &#123;-1,-2,-3,-4&#125;), X, &#123;0,5,6,3&#125; --&gt; mul X, &#123;-1,1,1,-4&#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Example: shuf X, (add X, &#123;-1,-2,-3,-4&#125;), &#123;0,1,6,7&#125; --&gt; add X, &#123;0,0,-3,-4&#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The existing binop constant vector remains in the same operand position.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewC = Op0IsBinop ? <a href="/docs/api/classes/llvm/constantexpr/#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, IdC, Mask) :</Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/constantexpr/#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(IdC, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, Mask);</Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MightCreatePoisonOrUB =</Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(Mask, <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal">      (<a href="/docs/api/classes/llvm/instruction/#af9c2825ab53adf1bf8c9fa19ec89d986">Instruction::isIntDivRem</a>(BOpcode) || <a href="/docs/api/classes/llvm/instruction/#ac5984d6827f6e6922bed00bf03ba9552">Instruction::isShift</a>(BOpcode));</Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MightCreatePoisonOrUB)</Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal">    NewC = <a href="/docs/api/classes/llvm/instcombiner/#acf9cbfcb493b0042022c94230e9350e2">InstCombiner::getSafeVectorConstantForBinop</a>(BOpcode, NewC, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf (bop X, C), X, M --&gt; bop X, C&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf X, (bop X, C), M --&gt; bop X, C&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewBO = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BOpcode, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, NewC);</Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal">  NewBO-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(BO);</Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// An undef shuffle mask element may propagate as an undef constant element in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the new binop. That would produce poison where the original code might not.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we already made a safe constant, then there&#39;s no danger.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(Mask, <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>) &amp;&amp; !MightCreatePoisonOrUB)</Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">    NewBO-&gt;<a href="/docs/api/classes/llvm/instruction/#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewBO;</Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><Highlight kind="comment">/// If we have an insert of a scalar to a non-zero element of an undefined</Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="comment">/// vector and then shuffle that value, that&#39;s the same as inserting to the zero</Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="comment">/// element and shuffling. Splatting from the zero element is recognized as the</Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="comment">/// canonical form of splat.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281" lineLink="#a6e6cf92e2cfe0eb48abec55606e0481e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a6e6cf92e2cfe0eb48abec55606e0481e">canonicalizeInsertSplat</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf,</Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;Op1 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal">  uint64&#95;t IndexC;</Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Match a shuffle that is a splat to a non-zero element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>),</Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal">                                       <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IndexC)))) ||</Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) || <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Mask, <a href="/docs/api/structs/llvm/patternmatch/m-zeromask">m&#95;ZeroMask</a>()) || IndexC == 0)</Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert into element 0 of a poison vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/poisonvalue">PoisonValue</a> &#42;PoisonVec = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewIns = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a17320ebd77e834577a5ebd1063039625">CreateInsertElement</a>(PoisonVec, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, (uint64&#95;t)0);</Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Splat from element 0 Any mask element that is poison remains poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf (inselt poison, X, 2), &#95;, &lt;2,2,undef&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   --&gt; shuf (inselt poison, X, 0), poison, &lt;0,0,undef&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumMaskElts =</Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> NewMask(NumMaskElts, 0);</Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumMaskElts; ++i)</Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; == <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>)</Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="normal">      NewMask&#91;i&#93; = Mask&#91;i&#93;;</Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(NewIns, NewMask);</Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="comment">/// Try to fold shuffles that are the equivalent of a vector select.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a3b73df3a995af9ca26c9d024c957c45a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a3b73df3a995af9ca26c9d024c957c45a">InstCombinerImpl::foldSelectShuffle</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf) &#123;</Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a747673ac3ea44aadc3907c6b9fd86237">isSelect</a>())</Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize to choose from operand 0 first unless operand 1 is undefined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Commuting undef to operand 0 conflicts with another canonicalization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="normal">      Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a3fb8619f70f51242f81ef96da349c884">getMaskValue</a>(0) &gt;= (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)NumElts) &#123;</Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Can we assert that both operands of a shuffle-select are not undef</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (otherwise, it would have been folded by instsimplify?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal">    Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#aa94c68d274d913e05b0423c7b2fded00">commute</a>();</Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;Shuf;</Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a98282716af42c878d4638603c6efb350">foldSelectShuffleOfSelectShuffle</a>(Shuf))</Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a2c05df65ce7ce7ec1d78348be2452e8d">foldSelectShuffleWith1Binop</a>(</Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><Highlight kind="normal">          Shuf, <a href="/docs/api/classes/llvm/instcombiner/#af56f7a148b00922368e55ab9c4948724">getSimplifyQuery</a>().getWithInstruction(&amp;Shuf)))</Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;B0, &#42;B1;</Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(B0)) ||</Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(B1)))</Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If one operand is &quot;0 - X&quot;, allow that to be viewed as &quot;X &#42; -1&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (ConstantsAreOp1) by getAlternateBinop below. If the neg is not paired</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with a multiply, we will exit because C0/C1 will not be set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;C0 = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;C1 = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ConstantsAreOp1;</Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B0, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B1, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))))</Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal">    ConstantsAreOp1 = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B0, <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C0)),</Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/patternmatch/#a5d295dcffba83c3c5a17d2fb3273b434">m&#95;Neg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B1, <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C1)),</Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/patternmatch/#a5d295dcffba83c3c5a17d2fb3273b434">m&#95;Neg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)))))</Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal">    ConstantsAreOp1 = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need matching binops to fold the lanes together.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> Opc0 = B0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> Opc1 = B1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> DropNSW = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ConstantsAreOp1 &amp;&amp; Opc0 != Opc1) &#123;</Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: We drop &quot;nsw&quot; if shift is converted into multiply because it may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// not be correct when the shift amount is BitWidth - 1 We could examine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// each vector element to determine if it is safe to keep that flag.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opc0 == Instruction::Shl || Opc1 == Instruction::Shl)</Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal">      DropNSW = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/binopelts">BinopElts</a> AltB0 = <a href="#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a>(B0, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(AltB0.Op1) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expecting constant with alt binop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal">      Opc0 = AltB0.Opcode;</Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal">      C0 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(AltB0.Op1);</Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/binopelts">BinopElts</a> AltB1 = <a href="#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a>(B1, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(AltB1.Op1) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expecting constant with alt binop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><Highlight kind="normal">      Opc1 = AltB1.Opcode;</Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal">      C1 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(AltB1.Op1);</Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opc0 != Opc1 || !C0 || !C1)</Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The opcodes must be the same. Use a new name to make that clear.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> BOpc = Opc0;</Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Select the constant elements needed for the single binop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewC = <a href="/docs/api/classes/llvm/constantexpr/#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(C0, C1, Mask);</Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are moving a binop after a shuffle. When a shuffle has an undefined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mask element, the result is undefined, but it is not poison or undefined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// behavior. That is not necessarily true for div/rem/shift.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MightCreatePoisonOrUB =</Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(Mask, <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal">      (<a href="/docs/api/classes/llvm/instruction/#af9c2825ab53adf1bf8c9fa19ec89d986">Instruction::isIntDivRem</a>(BOpc) || <a href="/docs/api/classes/llvm/instruction/#ac5984d6827f6e6922bed00bf03ba9552">Instruction::isShift</a>(BOpc));</Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MightCreatePoisonOrUB)</Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal">    NewC = <a href="/docs/api/classes/llvm/instcombiner/#acf9cbfcb493b0042022c94230e9350e2">InstCombiner::getSafeVectorConstantForBinop</a>(BOpc, NewC,</Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><Highlight kind="normal">                                                       ConstantsAreOp1);</Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V;</Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &#123;</Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove a binop and the shuffle by rearranging the constant:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuffle (op V, C0), (op V, C1), M --&gt; op V, C&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuffle (op C0, V), (op C1, V), M --&gt; op C&#39;, V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal">    V = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there are 2 different variable operands, we must create a new shuffle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (select) first, so check uses to ensure that we don&#39;t end up with more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions than we started with.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!B0-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; !B1-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we use the original shuffle mask and op1 is &#42;variable&#42;, we would be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// putting an undef into operand 1 of div/rem/shift. This is either UB or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// poison. We do not have to guard against UB when &#42;constants&#42; are op1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// because safe constants guarantee that we do not overflow sdiv/srem (and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// there&#39;s no danger for other opcodes).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: To allow this case, create a new shuffle mask with no undefs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MightCreatePoisonOrUB &amp;&amp; !ConstantsAreOp1)</Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: In general, we do not create new shuffles in InstCombine because we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// do not know if a target can lower an arbitrary shuffle optimally. In this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// case, the shuffle uses the existing mask, so there is no additional risk.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Select the variable vectors first, then perform the binop:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuffle (op X, C0), (op Y, C1), M --&gt; op (shuffle X, Y, M), C&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuffle (op C0, X), (op C1, Y), M --&gt; op C&#39;, (shuffle X, Y, M)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><Highlight kind="normal">    V = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShuffleVector(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Mask);</Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO = ConstantsAreOp1 ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(BOpc, V, NewC) :</Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(BOpc, NewC, V);</Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Flags are intersected from the 2 source binops. But there are 2 exceptions:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 If we changed an opcode, poison conditions might have changed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 If the shuffle had undef mask elements, the new binop might have undefs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    where the original code did not. But if we already made a safe constant,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    then there&#39;s no danger.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(NewBO)) &#123;</Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal">    NewI-&gt;copyIRFlags(B0);</Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal">    NewI-&gt;andIRFlags(B1);</Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DropNSW)</Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="normal">      NewI-&gt;setHasNoSignedWrap(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(Mask, <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>) &amp;&amp; !MightCreatePoisonOrUB)</Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="normal">      NewI-&gt;dropPoisonGeneratingFlags();</Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Shuf, NewBO);</Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="comment">/// Convert a narrowing shuffle of a bitcasted vector into a vector truncate.</Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="comment">/// Example (little endian):</Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="comment">/// shuf (bitcast &lt;4 x i16&gt; X to &lt;8 x i8&gt;), &lt;0, 2, 4, 6&gt; --&gt; trunc X to &lt;4 x i8&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452" lineLink="#a747cca8cf8e4c4e41b81bb1cbf146a11"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a747cca8cf8e4c4e41b81bb1cbf146a11">foldTruncShuffle</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf,</Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="normal">                                     </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsBigEndian) &#123;</Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This must be a bitcasted shuffle of 1 vector integer operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestType = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>();</Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) ||</Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) || !DestType-&gt;<a href="/docs/api/classes/llvm/type/#a34ee40bb2f4f5ece47ef19e5f1f57e3c">isIntOrIntVectorTy</a>())</Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The source type must have the same number of elements as the shuffle,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and the source element type must be larger than the shuffle element type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcType = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SrcType-&gt;isVectorTy() || !SrcType-&gt;isIntOrIntVectorTy() ||</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SrcType)-&gt;getNumElements() !=</Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(DestType)-&gt;getNumElements() ||</Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">      SrcType-&gt;getScalarSizeInBits() % DestType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() != 0)</Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a1552dc44fac81fb75a474feaa2ffdab8">changesLength</a>() &amp;&amp; !Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6315811e3cc527c8f1ab15ae0c789b93">increasesLength</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expected a shuffle that decreases length&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Last, check that the mask chooses the correct low bits for each narrow</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// element in the result.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">  uint64&#95;t TruncRatio =</Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal">      SrcType-&gt;getScalarSizeInBits() / DestType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = Mask.size(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; == <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>)</Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="normal">    uint64&#95;t LSBIndex = IsBigEndian ? (i + 1) &#42; TruncRatio - 1 : i &#42; TruncRatio;</Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LSBIndex &lt;= INT32&#95;MAX &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Overflowed 32-bits&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; != (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)LSBIndex)</Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/truncinst">TruncInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DestType);</Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="comment">/// Match a shuffle-select-shuffle pattern where the shuffles are widening and</Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="comment">/// narrowing (concatenating with poison and extracting back to the original</Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="comment">/// length). This allows replacing the wide select with a narrow select.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493" lineLink="#a746205e6d7f5c0bb265ecc8a911d5b82"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86isellowering-cpp/#a309d56d62904382ce197ab216f4ec43f">narrowVectorSelect</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf,</Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This must be a narrowing identity shuffle. It extracts the 1st N elements</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the 1st vector operand of a shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) || !Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a64a379276cb10c6cc61146d8a95cd1a7">isIdentityWithExtract</a>())</Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The vector being shuffled must be a vector select that we can eliminate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: The one-use requirement could be eased if X and/or Y are constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0),</Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)))))</Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need a narrow condition value. It must be extended with poison elements</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and have the same number of elements as this shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NarrowNumElts =</Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowCond;</Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(NarrowCond), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()))) ||</Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(NarrowCond-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements() !=</Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal">          NarrowNumElts ||</Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)-&gt;isIdentityWithPadding())</Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf (sel (shuf NarrowCond, poison, WideMask), X, Y), poison, NarrowMask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// sel NarrowCond, (shuf X, poison, NarrowMask), (shuf Y, poison, NarrowMask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowX = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa226d30eebf99ef84a0c2b1afcfc98b2">CreateShuffleVector</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowY = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa226d30eebf99ef84a0c2b1afcfc98b2">CreateShuffleVector</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(NarrowCond, NarrowX, NarrowY);</Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="comment">/// Canonicalize FP negate/abs after shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527" lineLink="#aabcb01976dc50b78faed7491a6d43042"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#aabcb01976dc50b78faed7491a6d43042">foldShuffleOfUnaryOps</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf,</Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;S0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!S0 || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(S0, <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aba7473bfa862dd9eadf04a6fefc6aa69">m&#95;FNeg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#af07397df05f8eb1838b6d79871791e38">m&#95;FAbs</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))))</Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsFNeg = S0-&gt;getOpcode() == Instruction::FNeg;</Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Match 1-input (unary) shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle (fneg/fabs X), Mask --&gt; fneg/fabs (shuffle X, Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (S0-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>())) &#123;</Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewShuf = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa226d30eebf99ef84a0c2b1afcfc98b2">CreateShuffleVector</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsFNeg)</Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/unaryoperator/#ab0b2c048acdd570e834bc51018589a2e">UnaryOperator::CreateFNegFMF</a>(NewShuf, S0);</Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;FAbs = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(</Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal">        Shuf.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), Intrinsic::fabs, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewF = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(FAbs, &#123;NewShuf&#125;);</Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">    NewF-&gt;<a href="/docs/api/classes/llvm/instruction/#a5ca8aa62fa8b3fe5bc0e8fbe5d8b8b7a">setFastMathFlags</a>(S0-&gt;getFastMathFlags());</Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewF;</Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Match 2-input (binary) shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulegalizerinfo-cpp/#a22eabd3566ae5f32cb6f594f4f343399">S1</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulegalizerinfo-cpp/#a22eabd3566ae5f32cb6f594f4f343399">S1</a> || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulegalizerinfo-cpp/#a22eabd3566ae5f32cb6f594f4f343399">S1</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aba7473bfa862dd9eadf04a6fefc6aa69">m&#95;FNeg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#af07397df05f8eb1838b6d79871791e38">m&#95;FAbs</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)))) ||</Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="normal">      S0-&gt;getOpcode() != <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulegalizerinfo-cpp/#a22eabd3566ae5f32cb6f594f4f343399">S1</a>-&gt;getOpcode() ||</Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="normal">      (!S0-&gt;hasOneUse() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulegalizerinfo-cpp/#a22eabd3566ae5f32cb6f594f4f343399">S1</a>-&gt;hasOneUse()))</Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf (fneg/fabs X), (fneg/fabs Y), Mask --&gt; fneg/fabs (shuf X, Y, Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewShuf = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa226d30eebf99ef84a0c2b1afcfc98b2">CreateShuffleVector</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewF;</Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsFNeg) &#123;</Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="normal">    NewF = UnaryOperator::CreateFNeg(NewShuf);</Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;FAbs = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(</Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal">        Shuf.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), Intrinsic::fabs, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal">    NewF = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(FAbs, &#123;NewShuf&#125;);</Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">  NewF-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(S0);</Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal">  NewF-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ea9acbe7fd20332ea6ccdb0183d6395">andIRFlags</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulegalizerinfo-cpp/#a22eabd3566ae5f32cb6f594f4f343399">S1</a>);</Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewF;</Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><Highlight kind="comment">/// Canonicalize casts after shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574" lineLink="#ab737e320d75547e2b43f6044fc3f3bcc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#ab737e320d75547e2b43f6044fc3f3bcc">foldCastShuffle</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf,</Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do we have 2 matching cast operands?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cast0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cast1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cast0 || !Cast1 || Cast0-&gt;getOpcode() != Cast1-&gt;getOpcode() ||</Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal">      Cast0-&gt;getSrcTy() != Cast1-&gt;getSrcTy())</Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Allow other opcodes? That would require easing the type restrictions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       below here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">CastInst::CastOps</a> CastOpcode = Cast0-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (CastOpcode) &#123;</Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToSI:</Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToUI:</Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SIToFP:</Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UIToFP:</Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;ShufTy = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>();</Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;ShufOpTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><Highlight kind="normal">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;CastSrcTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Cast0-&gt;getSrcTy());</Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Allow length-increasing shuffles?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShufTy-&gt;getElementCount().getKnownMinValue() &gt;</Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">      ShufOpTy-&gt;getElementCount().getKnownMinValue())</Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Allow element-size-decreasing casts (ex: fptosi float to i8)?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FixedVectorType&gt;</a>(CastSrcTy) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FixedVectorType&gt;</a>(ShufOpTy) &amp;&amp;</Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expected fixed vector operands for casts and binary shuffle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CastSrcTy-&gt;getPrimitiveSizeInBits() &gt; ShufOpTy-&gt;getPrimitiveSizeInBits())</Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// At least one of the operands must have only one use (the shuffle).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cast0-&gt;hasOneUse() &amp;&amp; !Cast1-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle (cast X), (cast Y), Mask --&gt; cast (shuffle X, Y, Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Cast0-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = Cast1-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewShuf = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa226d30eebf99ef84a0c2b1afcfc98b2">CreateShuffleVector</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(CastOpcode, NewShuf, ShufTy);</Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="comment">/// Try to fold an extract subvector operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623" lineLink="#a42c33c78c903c369b359db824b70cb1b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a42c33c78c903c369b359db824b70cb1b">foldIdentityExtractShuffle</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf) &#123;</Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;Op1 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a64a379276cb10c6cc61146d8a95cd1a7">isIdentityWithExtract</a>() || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()))</Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we are extracting all bits of an inserted scalar:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extract-subvec (bitcast (inselt ?, X, 0) --&gt; bitcast X to subvec type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>()))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;getPrimitiveSizeInBits() ==</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal">          Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>())</Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to combine 2 shuffles into 1 shuffle by concatenating a shuffle mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask;</Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>), <a href="/docs/api/structs/llvm/patternmatch/m-mask">m&#95;Mask</a>(Mask))))</Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Be conservative with shuffle transforms. If we can&#39;t kill the 1st shuffle,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// then combining may result in worse codegen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Op0-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are extracting a subvector from a shuffle. Remove excess elements from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the 1st shuffle mask to eliminate the extract.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This transform is conservatively limited to identity extracts because we do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not allow arbitrary shuffle mask creation as a target-independent transform</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (because we can&#39;t guarantee that will lower efficiently).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the extracting shuffle has an poison mask element, it transfers to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// new shuffle mask. Otherwise, copy the original mask element. Example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   shuf (shuf X, Y, &lt;C0, C1, C2, poison, C4&gt;), poison, &lt;0, poison, 2, 3&gt; --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   shuf X, Y, &lt;C0, poison, C2, poison&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> NewMask(NumElts);</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumElts &lt; Mask.size() &amp;&amp;</Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Identity with extract must have less elements than its inputs&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumElts; ++i) &#123;</Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> ExtractMaskElt = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a3fb8619f70f51242f81ef96da349c884">getMaskValue</a>(i);</Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> MaskElt = Mask&#91;i&#93;;</Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">    NewMask&#91;i&#93; = ExtractMaskElt == <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a> ? ExtractMaskElt : MaskElt;</Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, NewMask);</Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="comment">/// Try to replace a shuffle with an insertelement or try to replace a shuffle</Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="comment">/// operand with the operand of an insertelement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673" lineLink="#a661440047dc1b2af077911d9cf92236a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a661440047dc1b2af077911d9cf92236a">foldShuffleWithInsert</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf,</Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V0 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;V1 = Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> Mask;</Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="normal">  Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(Mask);</Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> NumElts = Mask.size();</Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> InpNumElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is a specialization of a fold in SimplifyDemandedVectorElts. We may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not be able to handle it there if the insertelement has &gt;1 use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the shuffle has an insertelement operand but does not choose the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inserted scalar element from that value, then we can replace that shuffle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operand with the source vector of the insertelement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal">  uint64&#95;t IdxC;</Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IdxC)))) &#123;</Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuf (inselt X, ?, IdxC), ?, Mask --&gt; shuf X, ?, Mask</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(Mask, (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)IdxC))</Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IC.<a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(Shuf, 0, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V1, <a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IdxC)))) &#123;</Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Offset the index constant by the vector width because we are checking for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// accesses to the 2nd vector input of the shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal">    IdxC += InpNumElts;</Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shuf ?, (inselt X, ?, IdxC), Mask --&gt; shuf ?, X, Mask</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(Mask, (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)IdxC))</Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IC.<a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(Shuf, 1, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For the rest of the transform, the shuffle must not change vector sizes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This restriction could be removed if the insert has only one use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       (because the transform would require a new length-changing shuffle).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumElts != InpNumElts)</Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle (insert ?, Scalar, IndexC), V1, Mask --&gt; insert V1, Scalar, IndexC&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> isShufflingScalarIntoOp1 = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;Scalar, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;&amp;IndexC) &#123;</Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We need an insertelement with a constant index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Scalar),</Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal">                               <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IndexC))))</Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Test the shuffle mask to see if it splices the inserted scalar into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// operand 1 vector of the shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> NewInsIndex = -1;</Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> i = 0; i != NumElts; ++i) &#123;</Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Ignore undef mask elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; == -1)</Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The shuffle takes elements of operand 1 without lane changes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; == NumElts + i)</Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The shuffle must choose the inserted scalar exactly once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewInsIndex != -1 || Mask&#91;i&#93; != IndexC-&gt;getSExtValue())</Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The shuffle is placing the inserted scalar into element i.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="normal">      NewInsIndex = i;</Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewInsIndex != -1 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Did not fold shuffle with unused operand?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Index is updated to the potentially translated insertion lane.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="normal">    IndexC = ConstantInt::get(IndexC-&gt;getIntegerType(), NewInsIndex);</Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the shuffle is unnecessary, insert the scalar operand directly into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operand 1 of the shuffle. Example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle (insert ?, S, 1), V1, &lt;1, 5, 6, 7&gt; --&gt; insert V1, S, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Scalar;</Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;IndexC;</Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isShufflingScalarIntoOp1(Scalar, IndexC))</Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/insertelementinst/#a3c7d92166c1f18129c2727c9dc808b29">InsertElementInst::Create</a>(V1, Scalar, IndexC);</Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try again after commuting shuffle. Example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle V0, (insert ?, S, 0), &lt;0, 1, 2, 4&gt; --&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle (insert ?, S, 0), V0, &lt;4, 5, 6, 0&gt; --&gt; insert V0, S, 3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="normal">  <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V0, V1);</Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/shufflevectorinst/#a9874bec83353914ed1e9309d5d9ccea0">ShuffleVectorInst::commuteShuffleMask</a>(Mask, NumElts);</Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isShufflingScalarIntoOp1(Scalar, IndexC))</Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/insertelementinst/#a3c7d92166c1f18129c2727c9dc808b29">InsertElementInst::Create</a>(V1, Scalar, IndexC);</Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761" lineLink="#a332e7f93c5c4782c1a628a1b11ab5032"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a332e7f93c5c4782c1a628a1b11ab5032">foldIdentityPaddedShuffles</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;Shuf) &#123;</Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Match the operands as identity with padding (also known as concatenation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with undef) shuffles of the same source type. The backend is expected to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// recreate these concatenations from a shuffle of narrow operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Shuffle0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Shuffle1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Shuffle0 || !Shuffle0-&gt;isIdentityWithPadding() ||</Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal">      !Shuffle1 || !Shuffle1-&gt;isIdentityWithPadding())</Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We limit this transform to power-of-2 types because we expect that the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// backend can convert the simplified IR patterns to identical nodes as the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// original IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: If we can verify the same behavior for arbitrary types, the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       power-of-2 checks can be removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = Shuffle0-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = Shuffle1-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() != <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType() ||</Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>())-&gt;getNumElements()) ||</Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(</Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuffle0-&gt;getType())-&gt;getNumElements()) ||</Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType())-&gt;getNumElements()) ||</Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) || <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()))</Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuffle0-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuffle1-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Unexpected operand for identity shuffle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is a shuffle of 2 widening shuffles. We can shuffle the narrow source</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operands directly by adjusting the shuffle mask to account for the narrower</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// types:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf (widen X), (widen Y), Mask --&gt; shuf X, Y, Mask&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> NarrowElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> WideElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Shuffle0-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideElts &gt; NarrowElts &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected types for identity with padding&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask = Shuf.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> NewMask(Mask.size(), -1);</Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> i = 0, e = Mask.size(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; == -1)</Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this shuffle is choosing an undef element from 1 of the sources, that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// element is undef.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; &lt; WideElts) &#123;</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Shuffle0-&gt;getMaskValue(Mask&#91;i&#93;) == -1)</Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Shuffle1-&gt;getMaskValue(Mask&#91;i&#93; - WideElts) == -1)</Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this shuffle is choosing from the 1st narrow op, the mask element is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the same. If this shuffle is choosing from the 2nd narrow op, the mask</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// element is offset down to adjust for the narrow vector widths.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; &lt; WideElts) &#123;</Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Mask&#91;i&#93; &lt; NarrowElts &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected shuffle mask&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal">      NewMask&#91;i&#93; = Mask&#91;i&#93;;</Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Mask&#91;i&#93; &lt; (WideElts + NarrowElts) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected shuffle mask&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">      NewMask&#91;i&#93; = Mask&#91;i&#93; - (WideElts - NarrowElts);</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, NewMask);</Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Splatting the first element of the result of a BinOp, where any of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal"></Highlight><Highlight kind="comment">// BinOp&#39;s operands are the result of a first element splat can be simplified to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal"></Highlight><Highlight kind="comment">// splatting the first element of the result of the BinOp</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ab18666f9305cc63df7009c9e4ec0e35a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#ab18666f9305cc63df7009c9e4ec0e35a">InstCombinerImpl::simplifyBinOpSplats</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;SVI) &#123;</Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) ||</Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-zeromask">m&#95;ZeroMask</a>()) ||</Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal">      !SVI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = SVI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-zeromask">m&#95;ZeroMask</a>()),</Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>),</Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-zeromask">m&#95;ZeroMask</a>()))))</Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() != <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType())</Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BinOp = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(Op0);</Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a19ebaad52d11be3121c2bfcbd0f30193">isSafeToSpeculativelyExecuteWithVariableReplaced</a>(BinOp))</Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(BinOp-&gt;getOpcode(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewBOI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(NewBO))</Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="normal">    NewBOI-&gt;copyIRFlags(BinOp);</Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(NewBO, SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ad31108b4f7156db7565eadba1285c93a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#ad31108b4f7156db7565eadba1285c93a">InstCombinerImpl::visitShuffleVectorInst</a>(<a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a> &amp;SVI) &#123;</Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = SVI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = SVI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> ShufQuery = <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;SVI);</Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V = <a href="/docs/api/namespaces/llvm/#a4e04471ed9ac60e70f5cf2d81f49b8c4">simplifyShuffleVectorInst</a>(LHS, RHS, SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(),</Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="normal">                                          SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>(), ShufQuery))</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(SVI, V);</Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab18666f9305cc63df7009c9e4ec0e35a">simplifyBinOpSplats</a>(SVI))</Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize splat shuffle to use poison RHS. Handle this explicitly in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// order to support scalable vectors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-zeromask">m&#95;ZeroMask</a>()) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(RHS))</Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(SVI, 1, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(RHS-&gt;getType()));</Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ScalableVectorType&gt;</a>(LHS-&gt;getType()))</Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VWidth = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LHSWidth = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(LHS-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle (bitcast X), (bitcast Y), Mask --&gt; bitcast (shuffle X, Y, Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if X and Y are of the same (vector) type, and the element size is not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// changed by the bitcasts, we can distribute the bitcasts through the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle, hopefully reducing the number of instructions. We make sure that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// at least one bitcast only has one use, so we don&#39;t &#42;increase&#42; the number of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;isVectorTy() &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType() &amp;&amp;</Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;getScalarSizeInBits() ==</Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal">          SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal">      (LHS-&gt;hasOneUse() || RHS-&gt;hasOneUse())) &#123;</Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShuffleVector(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(),</Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal">                                           SVI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.uncasted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(V, SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask = SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Peek through a bitcasted shuffle operand by scaling the mask. If the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// simulated shuffle can simplify, then this shuffle is unnecessary:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuf (bitcast X), undef, Mask --&gt; bitcast X&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This could be extended to allow length-changing shuffles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       The transform might also be obsoleted if we allowed canonicalization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       of bitcasted shuffles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;isVectorTy() &amp;&amp; VWidth == LHSWidth) &#123;</Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to create a scaled mask constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;XType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> XNumElts = XType-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> ScaledMask;</Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#afae6f658a8b4ed82cfac2bc1ada047d8">scaleShuffleMaskElts</a>(XNumElts, Mask, ScaledMask)) &#123;</Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the shuffled source vector simplifies, cast that value to this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// shuffle&#39;s type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V = <a href="/docs/api/namespaces/llvm/#a4e04471ed9ac60e70f5cf2d81f49b8c4">simplifyShuffleVectorInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(XType),</Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal">                                              ScaledMask, XType, ShufQuery))</Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">BitCastInst::Create</a>(Instruction::BitCast, V, SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#a59c34209e9206120edf7ce3c5da4f872">getType</a>());</Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle x, x, mask --&gt; shuffle x, undef, mask&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHS == RHS) &#123;</Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Shuffle with 2 undef ops not simplified?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(LHS, <a href="/docs/api/namespaces/llvm/#a2bea09503a438b76b5c9253327118af5">createUnaryMask</a>(Mask, LHSWidth));</Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle undef, x, mask --&gt; shuffle x, undef, mask&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>())) &#123;</Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">    SVI.<a href="/docs/api/classes/llvm/shufflevectorinst/#aa94c68d274d913e05b0423c7b2fded00">commute</a>();</Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;SVI;</Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a6e6cf92e2cfe0eb48abec55606e0481e">canonicalizeInsertSplat</a>(SVI, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a3b73df3a995af9ca26c9d024c957c45a">foldSelectShuffle</a>(SVI))</Highlight></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a747cca8cf8e4c4e41b81bb1cbf146a11">foldTruncShuffle</a>(SVI, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isBigEndian()))</Highlight></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86isellowering-cpp/#a309d56d62904382ce197ab216f4ec43f">narrowVectorSelect</a>(SVI, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#aabcb01976dc50b78faed7491a6d43042">foldShuffleOfUnaryOps</a>(SVI, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#ab737e320d75547e2b43f6044fc3f3bcc">foldCastShuffle</a>(SVI, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> PoisonElts(VWidth, 0);</Highlight></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> AllOnesEltMask(<a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth));</Highlight></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/instcombinerimpl/#a37cce7aa1875173688e5971c5d6fa9e0">SimplifyDemandedVectorElts</a>(&amp;SVI, AllOnesEltMask, PoisonElts)) &#123;</Highlight></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V != &amp;SVI)</Highlight></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(SVI, V);</Highlight></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;SVI;</Highlight></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a42c33c78c903c369b359db824b70cb1b">foldIdentityExtractShuffle</a>(SVI))</Highlight></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// These transforms have the potential to lose undef knowledge, so they are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// intentionally placed after SimplifyDemandedVectorElts().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a661440047dc1b2af077911d9cf92236a">foldShuffleWithInsert</a>(SVI, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a332e7f93c5c4782c1a628a1b11ab5032">foldIdentityPaddedShuffles</a>(SVI))</Highlight></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>())) &#123;</Highlight></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(LHS)) &#123;</Highlight></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We cannot do this fold for elementwise select since ShuffleVector is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// not elementwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()-&gt;getType()-&gt;isIntegerTy() &amp;&amp;</Highlight></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><Highlight kind="normal">          (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(RHS) ||</Highlight></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#ae058c4750de2c85f12a1f96841ac9ae3">isGuaranteedNotToBePoison</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()))) &#123;</Highlight></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a039111728e11b1cdf25e60446ae17f2a">FoldOpIntoSelect</a>(SVI, <a href="/docs/api/namespaces/llvm/si">SI</a>))</Highlight></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(LHS)) &#123;</Highlight></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a2fc50d227d302eb98914f04bcc6634e1">foldOpIntoPhi</a>(SVI, PN, </Highlight><Highlight kind="comment">/&#42;AllowMultipleUses=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) &amp;&amp; <a href="#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(LHS, Mask)) &#123;</Highlight></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="#a06358c30f3e98d9e57f4ae9162f33c72">evaluateInDifferentElementOrder</a>(LHS, Mask, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>);</Highlight></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(SVI, V);</Highlight></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// SROA generates shuffle+bitcast when the extracted sub-vector is bitcast to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a non-vector type. We can instead bitcast the original vector followed by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// an extract of the desired element:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   %sroa = shufflevector &lt;16 x i8&gt; %in, &lt;16 x i8&gt; undef,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                         &lt;4 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   %1 = bitcast &lt;4 x i8&gt; %sroa to i32</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Becomes:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   %bc = bitcast &lt;16 x i8&gt; %in to &lt;4 x i32&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   %ext = extractelement &lt;4 x i32&gt; %bc, i32 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the shuffle is extracting a contiguous range of values from the input</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vector then each use which is a bitcast of the extracted size can be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replaced. This will work if the vector types are compatible, and the begin</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// index is aligned to a value in the casted vector type. If the begin index</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// isn&#39;t aligned then we can shuffle the original vector (keeping the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vector type) before extracting.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This code will bail out if the target type is fundamentally incompatible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with vectors of the source type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Example of &lt;16 x i8&gt;, target type i32:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Index range &#91;4,8):         v-----------v Will work.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     &lt;16 x i8&gt;: |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     &lt;4 x i32&gt;: |           |           |           |           |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                +-----------+-----------+-----------+-----------+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Index range &#91;6,10):              ^-----------^ Needs an extra shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Target type i40:           ^--------------^ Won&#39;t work, bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ae8f4745a87bae0a614d6bda1cc55ab01">isShuffleExtractingFromLHS</a>(SVI, Mask)) &#123;</Highlight></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = LHS;</Highlight></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaskElems = Mask.size();</Highlight></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SrcTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V-&gt;getType());</Highlight></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VecBitWidth = SrcTy-&gt;getPrimitiveSizeInBits().getFixedValue();</Highlight></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SrcElemBitWidth = <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeSizeInBits(SrcTy-&gt;getElementType());</Highlight></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SrcElemBitWidth &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;vector elements must have a bitwidth&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SrcNumElems = SrcTy-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BitCastInst &#42;, 8&gt;</a> BCs;</Highlight></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Type &#42;, Value &#42;&gt;</a> NewBCs;</Highlight></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : SVI.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</Highlight></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Only visit bitcasts that weren&#39;t previously handled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BC-&gt;use&#95;empty())</Highlight></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Prefer to combine bitcasts of bitcasts before attempting this fold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BC-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BC2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(BC-&gt;user&#95;back());</Highlight></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BC2 &amp;&amp; isEliminableCastPair(BC, BC2))</Highlight></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><Highlight kind="normal">        BCs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(BC);</Highlight></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BC : BCs) &#123;</Highlight></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BegIdx = Mask.front();</Highlight></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;TgtTy = BC-&gt;getDestTy();</Highlight></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TgtElemBitWidth = <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeSizeInBits(TgtTy);</Highlight></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TgtElemBitWidth)</Highlight></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TgtNumElems = VecBitWidth / TgtElemBitWidth;</Highlight></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VecBitWidthsEqual = VecBitWidth == TgtNumElems &#42; TgtElemBitWidth;</Highlight></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> BegIsAligned = 0 == ((SrcElemBitWidth &#42; BegIdx) % TgtElemBitWidth);</Highlight></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VecBitWidthsEqual)</Highlight></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/vectortype/#aa6a2194fc011669faabe43322d7c6c5f">VectorType::isValidElementType</a>(TgtTy))</Highlight></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CastSrcTy = <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(TgtTy, TgtNumElems);</Highlight></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BegIsAligned) &#123;</Highlight></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Shuffle the input so &#91;0,NumElements) contains the output, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// &#91;NumElems,SrcNumElems) is undef.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> ShuffleMask(SrcNumElems, -1);</Highlight></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = MaskElems, Idx = BegIdx; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++Idx, ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><Highlight kind="normal">          ShuffleMask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = Idx;</Highlight></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><Highlight kind="normal">        V = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShuffleVector(V, ShuffleMask,</Highlight></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><Highlight kind="normal">                                        SVI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.extract&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><Highlight kind="normal">        BegIdx = 0;</Highlight></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SrcElemsPerTgtElem = TgtElemBitWidth / SrcElemBitWidth;</Highlight></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SrcElemsPerTgtElem);</Highlight></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><Highlight kind="normal">      BegIdx /= SrcElemsPerTgtElem;</Highlight></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;It, Inserted&#93; = NewBCs.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(CastSrcTy);</Highlight></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inserted)</Highlight></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><Highlight kind="normal">        It-&gt;second = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBitCast(V, CastSrcTy, SVI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.bc&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ext = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(It-&gt;second, BegIdx,</Highlight></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><Highlight kind="normal">                                               SVI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.extract&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The shufflevector isn&#39;t being replaced: the bitcast that used it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// is. InstCombine will visit the newly-created instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;BC, Ext);</Highlight></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><Highlight kind="normal">      MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the LHS is a shufflevector itself, see if we can combine it with this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one without producing an unusual shuffle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cases that might be simplified:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// x1=shuffle(v1,v2,mask1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(x1,undef,mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//        ==&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(v1,undef,newMask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// newMask&#91;i&#93; = (mask&#91;i&#93; &lt; x1.size()) ? mask1&#91;mask&#91;i&#93;&#93; : -1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// x1=shuffle(v1,undef,mask1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(x1,x2,mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// where v1.size() == mask1.size()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//        ==&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(v1,x2,newMask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// newMask&#91;i&#93; = (mask&#91;i&#93; &lt; x1.size()) ? mask1&#91;mask&#91;i&#93;&#93; : mask&#91;i&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// x2=shuffle(v2,undef,mask2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(x1,x2,mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// where v2.size() == mask2.size()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//        ==&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(x1,v2,newMask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// newMask&#91;i&#93; = (mask&#91;i&#93; &lt; x1.size())</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//              ? mask&#91;i&#93; : mask2&#91;mask&#91;i&#93;-x1.size()&#93;+x1.size()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// x1=shuffle(v1,undef,mask1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// x2=shuffle(v2,undef,mask2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(x1,x2,mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// where v1.size() == v2.size()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//        ==&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  x=shuffle(v1,v2,newMask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// newMask&#91;i&#93; = (mask&#91;i&#93; &lt; x1.size())</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//              ? mask1&#91;mask&#91;i&#93;&#93; : mask2&#91;mask&#91;i&#93;-x1.size()&#93;+v1.size()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Here we are really conservative:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we are absolutely afraid of producing a shuffle mask not in the input</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// program, because the code gen may not be smart enough to turn a merged</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shuffle into two specific shuffles: it may produce worse code.  As such,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we only merge two shuffles if the result is either a splat or one of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// input shuffle masks.  In this case, merging the shuffles just removes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one instruction, which we know is safe.  This is good for things like</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// turning: (splat(splat)) -&gt; splat, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// merge(V&#91;0..n&#93;, V&#91;n+1..2n&#93;) -&gt; V&#91;0..2n&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>&#42; LHSShuffle = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(LHS);</Highlight></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>&#42; RHSShuffle = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(RHS);</Highlight></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSShuffle)</Highlight></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHSShuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()))</Highlight></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><Highlight kind="normal">      LHSShuffle = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RHSShuffle)</Highlight></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHSShuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()))</Highlight></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><Highlight kind="normal">      RHSShuffle = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LHSShuffle &amp;&amp; !RHSShuffle)</Highlight></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange ? &amp;SVI : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a>&#42; LHSOp0 = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a>&#42; LHSOp1 = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a>&#42; RHSOp0 = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LHSOp0Width = 0;</Highlight></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> RHSOp0Width = 0;</Highlight></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSShuffle) &#123;</Highlight></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><Highlight kind="normal">    LHSOp0 = LHSShuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><Highlight kind="normal">    LHSOp1 = LHSShuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><Highlight kind="normal">    LHSOp0Width = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(LHSOp0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RHSShuffle) &#123;</Highlight></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><Highlight kind="normal">    RHSOp0 = RHSShuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><Highlight kind="normal">    RHSOp0Width = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(RHSOp0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a>&#42; newLHS = LHS;</Highlight></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a>&#42; newRHS = RHS;</Highlight></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSShuffle) &#123;</Highlight></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// case 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>())) &#123;</Highlight></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><Highlight kind="normal">      newLHS = LHSOp0;</Highlight></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><Highlight kind="normal">      newRHS = LHSOp1;</Highlight></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// case 2 or 4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSOp0Width == LHSWidth) &#123;</Highlight></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><Highlight kind="normal">      newLHS = LHSOp0;</Highlight></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case 3 or 4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RHSShuffle &amp;&amp; RHSOp0Width == LHSWidth) &#123;</Highlight></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><Highlight kind="normal">    newRHS = RHSOp0;</Highlight></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case 4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSOp0 == RHSOp0) &#123;</Highlight></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><Highlight kind="normal">    newLHS = LHSOp0;</Highlight></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><Highlight kind="normal">    newRHS = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (newLHS == LHS &amp;&amp; newRHS == RHS)</Highlight></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange ? &amp;SVI : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> LHSMask;</Highlight></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> RHSMask;</Highlight></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (newLHS != LHS)</Highlight></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><Highlight kind="normal">    LHSMask = LHSShuffle-&gt;<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RHSShuffle &amp;&amp; newRHS != RHS)</Highlight></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><Highlight kind="normal">    RHSMask = RHSShuffle-&gt;<a href="/docs/api/classes/llvm/shufflevectorinst/#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</Highlight></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> newLHSWidth = (newLHS != LHS) ? LHSOp0Width : LHSWidth;</Highlight></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 16&gt;</a> newMask;</Highlight></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#a6a2164e5aeea9c3e9a02eab3747efd8c">isSplat</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> SplatElt = -1;</Highlight></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a new mask for the new ShuffleVectorInst so that the new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ShuffleVectorInst is equivalent to the original one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; VWidth; ++i) &#123;</Highlight></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> eltMask;</Highlight></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; &lt; 0) &#123;</Highlight></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This element is a poison value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><Highlight kind="normal">      eltMask = -1;</Highlight></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask&#91;i&#93; &lt; (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)LHSWidth) &#123;</Highlight></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This element is from left hand side vector operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If LHS is going to be replaced (case 1, 2, or 4), calculate the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// new mask value for the element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (newLHS != LHS) &#123;</Highlight></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><Highlight kind="normal">        eltMask = LHSMask&#91;Mask&#91;i&#93;&#93;;</Highlight></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the value selected is an poison value, explicitly specify it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// with a -1 mask value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (eltMask &gt;= (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)LHSOp0Width &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(LHSOp1))</Highlight></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><Highlight kind="normal">          eltMask = -1;</Highlight></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><Highlight kind="normal">        eltMask = Mask&#91;i&#93;;</Highlight></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This element is from right hand side vector operand</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the value selected is a poison value, explicitly specify it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// with a -1 mask value. (case 1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()))</Highlight></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><Highlight kind="normal">        eltMask = -1;</Highlight></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If RHS is going to be replaced (case 3 or 4), calculate the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// new mask value for the element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (newRHS != RHS) &#123;</Highlight></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><Highlight kind="normal">        eltMask = RHSMask&#91;Mask&#91;i&#93;-LHSWidth&#93;;</Highlight></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the value selected is an poison value, explicitly specify it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// with a -1 mask value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (eltMask &gt;= (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)RHSOp0Width) &#123;</Highlight></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHSShuffle-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;should have been check above&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><Highlight kind="normal">          eltMask = -1;</Highlight></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><Highlight kind="normal">        eltMask = Mask&#91;i&#93;-LHSWidth;</Highlight></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If LHS&#39;s width is changed, shift the mask value accordingly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If newRHS == nullptr, i.e. LHSOp0 == RHSOp0, we want to remap any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// references from RHSOp0 to LHSOp0, so we don&#39;t need to shift the mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If newRHS == newLHS, we want to remap any references from newRHS to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// newLHS so that we can properly identify splats that may occur due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// obfuscation across the two vectors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (eltMask &gt;= 0 &amp;&amp; newRHS != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; newLHS != newRHS)</Highlight></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><Highlight kind="normal">        eltMask += newLHSWidth;</Highlight></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if this could still be a splat.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (eltMask &gt;= 0) &#123;</Highlight></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SplatElt &gt;= 0 &amp;&amp; SplatElt != eltMask)</Highlight></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#a6a2164e5aeea9c3e9a02eab3747efd8c">isSplat</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><Highlight kind="normal">      SplatElt = eltMask;</Highlight></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><Highlight kind="normal">    newMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(eltMask);</Highlight></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the result mask is equal to one of the original shuffle masks,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// or is a splat, do the replacement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#a6a2164e5aeea9c3e9a02eab3747efd8c">isSplat</a> || newMask == LHSMask || newMask == RHSMask || newMask == Mask) &#123;</Highlight></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!newRHS)</Highlight></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><Highlight kind="normal">      newRHS = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(newLHS-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(newLHS, newRHS, newMask);</Highlight></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange ? &amp;SVI : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
