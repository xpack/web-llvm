---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `X86FrameLowering.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="X86FrameLowering.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="MCTargetDesc/X86MCTargetDesc.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/x86/lib/target/x86/mctargetdesc/x86mctargetdesc-h"
  isLocal="true" />
<IncludesListItem
  filePath="X86InstrBuilder.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/x86/x86instrbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="X86InstrInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/x86/x86instrinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="X86MachineFunctionInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/x86/x86machinefunctioninfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="X86Subtarget.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/x86/x86subtarget-h"
  isLocal="true" />
<IncludesListItem
  filePath="X86TargetMachine.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/x86/x86targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/LivePhysRegs.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/livephysregs-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFrameInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineInstrBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstrbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineModuleInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinemoduleinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineRegisterInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineregisterinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/WinEHFuncInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/winehfuncinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/EHPersonalities.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/MCAsmInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/mcasminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/MCObjectFileInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/mcobjectfileinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/MCSymbol.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/mcsymbol-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/LEB128.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/leb128-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetOptions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h"
  isLocal="true" />
<IncludesListItem
  filePath="cstdlib"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-x86framelowering-cpp-">anonymous&#123;X86FrameLowering.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject">X86FrameSortingObject</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingcomparator">X86FrameSortingComparator</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae31fe0327c2bb8a7d5cfbc532825e5a3">blockEndIsUnreachable</a> (const MachineBasicBlock &amp;MBB, MachineBasicBlock::const&#95;iterator MBBI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a045c9bd8c547ec3f14eba7aedf55a044">calculateSetFPREG</a> (uint64&#95;t SPAdjust)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="int"
  name={<><a href="#a88b438423c0bb502e843c7dae099b7f4">computeFPBPAlignmentGap</a> (MachineFunction &amp;MF, const TargetRegisterClass &#42;RC, unsigned NumSpilledRegs)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a63bd353ca84282a830d803a6bf9e4c5e">flagsNeedToBePreservedBeforeTheTerminators</a> (const MachineBasicBlock &amp;MBB)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the flags need to be preserved before the terminators. <a href="#a63bd353ca84282a830d803a6bf9e4c5e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a1ecf75331d34e66af2a1ecb91a339090">getADDriOpcode</a> (bool IsLP64)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a9eeab7cb8d11a73a02d732d54f891239">getADDrrOpcode</a> (bool IsLP64)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a76608be3df4f82c18347d1680f3b0936">getANDriOpcode</a> (bool IsLP64, int64&#95;t Imm)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ae2c3c56fbe514f4a3ee837a4af0499a8">getHiPELiteral</a> (NamedMDNode &#42;HiPELiteralsMD, const StringRef LiteralName)</>}>
Lookup an ERTS parameter in the !hipe.literals named metadata node. <a href="#ae2c3c56fbe514f4a3ee837a4af0499a8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a48597b35dc2ab842232cc2a5c6047401">getLEArOpcode</a> (bool IsLP64)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a39d0dcc2605f63349a774a79927b2209">getMOVriOpcode</a> (bool Use64BitReg, int64&#95;t Imm)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ae299adbcf2ff9ecc484dc4b73d262eaa">getPOP2Opcode</a> (const X86Subtarget &amp;ST)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#abe688d8814460e4a62c6e50b82d1be9a">getPOPOpcode</a> (const X86Subtarget &amp;ST)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a2621d6b164bd8fb5ef4356154ea9b399">getPUSH2Opcode</a> (const X86Subtarget &amp;ST)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#aef1cc59e277ff82741aa24e3e170ee04">getPUSHOpcode</a> (const X86Subtarget &amp;ST)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a1021e45de682ea397f9aa6c529ac80be">GetScratchRegister</a> (bool Is64Bit, bool IsLP64, const MachineFunction &amp;MF, bool Primary)</>}>
GetScratchRegister - Get a temp register for performing work in the segmented stack and the Erlang/HiPE stack prologue. <a href="#a1021e45de682ea397f9aa6c529ac80be">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a5d39e675b72aafdb90b4ac24e229108d">getSUBriOpcode</a> (bool IsLP64)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ae47fe718044419c88efa13772780b920">getSUBrrOpcode</a> (bool IsLP64)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab29c5668ec7d2b12468b97aa33e5f87b">HasNestArgument</a> (const MachineFunction &#42;MF)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a833aa9ac03a9d223ea251585baaa5642">isEAXLiveIn</a> (MachineBasicBlock &amp;MBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a63e534b2d2892aadaa791d48b0397c74">isFPBPAccess</a> (const MachineInstr &amp;MI, Register FP, Register BP, const TargetRegisterInfo &#42;TRI, bool &amp;AccessFP, bool &amp;AccessBP)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a97265f2cad366f364b2bc884e589277e">isFuncletReturnInstr</a> (MachineInstr &amp;MI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#acc62a034274e2d51b819c39b96de48dd">isInvoke</a> (const MachineInstr &amp;MI, bool InsideEHLabels)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a74d57d95c26d07b86a63a501e1052739">isOpcodeRep</a> (unsigned Opcode)</>}>
Return true if an opcode is part of the REP group of instructions. <a href="#a74d57d95c26d07b86a63a501e1052739">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8485a5e7c82a6e2b65a859701c4a6cb8">isTailCallOpcode</a> (unsigned Opc)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a229334f08bdd0c4fa1cce6b0d7eea76c">STATISTIC</a> (NumFrameLoopProbe, &quot;Number of loop stack probes used in prologue&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a208873c01c7f73253725b44626536ea3">STATISTIC</a> (NumFrameExtraProbe, &quot;Number of extra stack probes generated in prologue&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3e97344639907cc30c662fb6aa1555a4">STATISTIC</a> (NumFunctionUsingPush2Pop2, &quot;Number of funtions using push2/pop2&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> uint64&#95;t</>}
  name={<><a href="#ad6f5455eb7ba6ed74cab551099d0a952">kSplitStackAvailable</a> = 256</>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;x86-fl&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### blockEndIsUnreachable() {#ae31fe0327c2bb8a7d5cfbc532825e5a3}

<MemberDefinition
  prototype={<>static bool blockEndIsUnreachable (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB, <a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> MBBI)</>}
  labels = {["static"]}>

Definition at line <a href="#l03523">3523</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### calculateSetFPREG() {#a045c9bd8c547ec3f14eba7aedf55a044}

<MemberDefinition
  prototype={<>static unsigned calculateSetFPREG (uint64&#95;t SPAdjust)</>}
  labels = {["static"]}>

Definition at line <a href="#l01245">1245</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### computeFPBPAlignmentGap() {#a88b438423c0bb502e843c7dae099b7f4}

<MemberDefinition
  prototype={<>static int computeFPBPAlignmentGap (<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; MF, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42; RC, unsigned NumSpilledRegs)</>}
  labels = {["static"]}>

Definition at line <a href="#l04269">4269</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### flagsNeedToBePreservedBeforeTheTerminators() {#a63bd353ca84282a830d803a6bf9e4c5e}

<MemberDefinition
  prototype={<>static bool flagsNeedToBePreservedBeforeTheTerminators (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the flags need to be preserved before the terminators.

This would be the case, if the eflags is live-in of the region composed by the terminators or live-out of that region, without being defined by a terminator.

Definition at line <a href="#l00192">192</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getADDriOpcode() {#a1ecf75331d34e66af2a1ecb91a339090}

<MemberDefinition
  prototype="static unsigned getADDriOpcode (bool IsLP64)"
  labels = {["static"]}>

Definition at line <a href="#l00112">112</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getADDrrOpcode() {#a9eeab7cb8d11a73a02d732d54f891239}

<MemberDefinition
  prototype="static unsigned getADDrrOpcode (bool IsLP64)"
  labels = {["static"]}>

Definition at line <a href="#l00120">120</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getANDriOpcode() {#a76608be3df4f82c18347d1680f3b0936}

<MemberDefinition
  prototype={<>static unsigned getANDriOpcode (bool IsLP64, int64&#95;t Imm)</>}
  labels = {["static"]}>

Definition at line <a href="#l00124">124</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getHiPELiteral() {#ae2c3c56fbe514f4a3ee837a4af0499a8}

<MemberDefinition
  prototype={<>static unsigned getHiPELiteral (<a href="/docs/api/classes/llvm/namedmdnode">NamedMDNode</a> &#42; HiPELiteralsMD, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/stringref">StringRef</a> LiteralName)</>}
  labels = {["static"]}>
Lookup an ERTS parameter in the !hipe.literals named metadata node.

HiPE provides Erlang Runtime System-internal parameters, such as PCB offsets to fields it needs, through a named metadata node &quot;hipe.literals&quot; containing name-value pairs.

Definition at line <a href="#l03501">3501</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getLEArOpcode() {#a48597b35dc2ab842232cc2a5c6047401}

<MemberDefinition
  prototype="static unsigned getLEArOpcode (bool IsLP64)"
  labels = {["static"]}>

Definition at line <a href="#l00128">128</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getMOVriOpcode() {#a39d0dcc2605f63349a774a79927b2209}

<MemberDefinition
  prototype={<>static unsigned getMOVriOpcode (bool Use64BitReg, int64&#95;t Imm)</>}
  labels = {["static"]}>

Definition at line <a href="#l00132">132</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getPOP2Opcode() {#ae299adbcf2ff9ecc484dc4b73d262eaa}

<MemberDefinition
  prototype={<>static unsigned getPOP2Opcode (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp; ST)</>}
  labels = {["static"]}>

Definition at line <a href="#l00171">171</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getPOPOpcode() {#abe688d8814460e4a62c6e50b82d1be9a}

<MemberDefinition
  prototype={<>static unsigned getPOPOpcode (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp; ST)</>}
  labels = {["static"]}>

Definition at line <a href="#l00164">164</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getPUSH2Opcode() {#a2621d6b164bd8fb5ef4356154ea9b399}

<MemberDefinition
  prototype={<>static unsigned getPUSH2Opcode (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp; ST)</>}
  labels = {["static"]}>

Definition at line <a href="#l00168">168</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getPUSHOpcode() {#aef1cc59e277ff82741aa24e3e170ee04}

<MemberDefinition
  prototype={<>static unsigned getPUSHOpcode (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp; ST)</>}
  labels = {["static"]}>

Definition at line <a href="#l00160">160</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### GetScratchRegister() {#a1021e45de682ea397f9aa6c529ac80be}

<MemberDefinition
  prototype={<>static unsigned GetScratchRegister (bool Is64Bit, bool IsLP64, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; MF, bool Primary)</>}
  labels = {["static"]}>
GetScratchRegister - Get a temp register for performing work in the segmented stack and the Erlang/HiPE stack prologue.

Depending on platform and the properties of the function either one or two registers will be needed. Set primary to true for the first register, false for the second.

Definition at line <a href="#l03202">3202</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getSUBriOpcode() {#a5d39e675b72aafdb90b4ac24e229108d}

<MemberDefinition
  prototype="static unsigned getSUBriOpcode (bool IsLP64)"
  labels = {["static"]}>

Definition at line <a href="#l00108">108</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### getSUBrrOpcode() {#ae47fe718044419c88efa13772780b920}

<MemberDefinition
  prototype="static unsigned getSUBrrOpcode (bool IsLP64)"
  labels = {["static"]}>

Definition at line <a href="#l00116">116</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### HasNestArgument() {#ab29c5668ec7d2b12468b97aa33e5f87b}

<MemberDefinition
  prototype={<>static bool HasNestArgument (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42; MF)</>}
  labels = {["static"]}>

Definition at line <a href="#l03188">3188</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### isEAXLiveIn() {#a833aa9ac03a9d223ea251585baaa5642}

<MemberDefinition
  prototype={<>static bool isEAXLiveIn (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l00175">175</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### isFPBPAccess() {#a63e534b2d2892aadaa791d48b0397c74}

<MemberDefinition
  prototype={<>static bool isFPBPAccess (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI, <a href="/docs/api/classes/llvm/register">Register</a> FP, <a href="/docs/api/classes/llvm/register">Register</a> BP, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI, bool &amp; AccessFP, bool &amp; AccessBP)</>}
  labels = {["static"]}>

Definition at line <a href="#l04431">4431</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### isFuncletReturnInstr() {#a97265f2cad366f364b2bc884e589277e}

<MemberDefinition
  prototype={<>static bool isFuncletReturnInstr (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02306">2306</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### isInvoke() {#acc62a034274e2d51b819c39b96de48dd}

<MemberDefinition
  prototype={<>static bool isInvoke (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI, bool InsideEHLabels)</>}
  labels = {["static"]}>

Definition at line <a href="#l04451">4451</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### isOpcodeRep() {#a74d57d95c26d07b86a63a501e1052739}

<MemberDefinition
  prototype="static bool isOpcodeRep (unsigned Opcode)"
  labels = {["static"]}>
Return true if an opcode is part of the REP group of instructions.

Definition at line <a href="#l01450">1450</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### isTailCallOpcode() {#a8485a5e7c82a6e2b65a859701c4a6cb8}

<MemberDefinition
  prototype="static bool isTailCallOpcode (unsigned Opc)"
  labels = {["static"]}>

Definition at line <a href="#l02372">2372</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a229334f08bdd0c4fa1cce6b0d7eea76c}

<MemberDefinition
  prototype={<>STATISTIC (NumFrameLoopProbe, &quot;Number of loop stack probes used in prologue&quot;)</>}>

Definition at line <a href="#l00041">41</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a208873c01c7f73253725b44626536ea3}

<MemberDefinition
  prototype={<>STATISTIC (NumFrameExtraProbe, &quot;Number of extra stack probes generated in prologue&quot;)</>}>

Definition at line <a href="#l00042">42</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3e97344639907cc30c662fb6aa1555a4}

<MemberDefinition
  prototype={<>STATISTIC (NumFunctionUsingPush2Pop2, &quot;Number of funtions using push2/pop2&quot;)</>}>

Definition at line <a href="#l00044">44</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### kSplitStackAvailable {#ad6f5455eb7ba6ed74cab551099d0a952}

<MemberDefinition
  prototype={<>const uint64&#95;t kSplitStackAvailable = 256</>}
  labels = {["static"]}>

Definition at line <a href="#l03238">3238</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;x86-fl&quot;</>}>

Definition at line <a href="#l00039">39</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-cpp">X86FrameLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===-- X86FrameLowering.cpp - X86 Frame Information ----------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file contains the X86 implementation of TargetFrameLowering class.</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86framelowering-h">X86FrameLowering.h</a>&quot;</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/x86/lib/target/x86/mctargetdesc/x86mctargetdesc-h">MCTargetDesc/X86MCTargetDesc.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86instrbuilder-h">X86InstrBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86instrinfo-h">X86InstrInfo.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86machinefunctioninfo-h">X86MachineFunctionInfo.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86subtarget-h">X86Subtarget.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86targetmachine-h">X86TargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/livephysregs-h">llvm/CodeGen/LivePhysRegs.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h">llvm/CodeGen/MachineFrameInfo.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstrbuilder-h">llvm/CodeGen/MachineInstrBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinemoduleinfo-h">llvm/CodeGen/MachineModuleInfo.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineregisterinfo-h">llvm/CodeGen/MachineRegisterInfo.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/winehfuncinfo-h">llvm/CodeGen/WinEHFuncInfo.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h">llvm/IR/EHPersonalities.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/mcasminfo-h">llvm/MC/MCAsmInfo.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/mcobjectfileinfo-h">llvm/MC/MCObjectFileInfo.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/mcsymbol-h">llvm/MC/MCSymbol.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/leb128-h">llvm/Support/LEB128.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h">llvm/Target/TargetOptions.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &lt;cstdlib&gt;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;x86-fl&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41" lineLink="#a229334f08bdd0c4fa1cce6b0d7eea76c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFrameLoopProbe, </span><span class="doxyHighlightStringLiteral">&quot;Number of loop stack probes used in prologue&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42" lineLink="#a208873c01c7f73253725b44626536ea3"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFrameExtraProbe,</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of extra stack probes generated in prologue&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44" lineLink="#a3e97344639907cc30c662fb6aa1555a4"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFunctionUsingPush2Pop2, </span><span class="doxyHighlightStringLiteral">&quot;Number of funtions using push2/pop2&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48" lineLink="/docs/api/classes/llvm/x86framelowering/#a116242916a44a6d4f5301270c6c4f05e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/x86framelowering/#a116242916a44a6d4f5301270c6c4f05e">X86FrameLowering::X86FrameLowering</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>,</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlight">                                   <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> StackAlignOverride)</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlight">    : <a href="/docs/api/classes/llvm/targetframelowering/#a6a6d31b2f1e5754f5824c5dec555eeac">TargetFrameLowering</a>(<a href="/docs/api/classes/llvm/targetframelowering/#a453c74e2daac0745b53f8b31c11fc50cad1fc7c9d0bae5bf76a67d2d26ce99c1a">StackGrowsDown</a>, StackAlignOverride.valueOrOne(),</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.<a href="/docs/api/files/lib/lib/target/lib/target/x86/lib/target/x86/disassembler/x86disassembler-cpp/#a652270ec0bdb03b5a7f934524412aa7f">is64Bit</a>() ? -8 : -4),</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>), <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>(&#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getInstrInfo()), <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getRegisterInfo()) &#123;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cache a bunch of frame-related predicates for this subtarget.</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getSlotSize();</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit();</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitLP64();</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// standard x86&#95;64 and NaCl use 64-bit frame/stack pointers, x32 - 32-bit.</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitLP64() || <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetNaCl64();</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getStackRegister();</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62" lineLink="/docs/api/classes/llvm/x86framelowering/#a6696e7a9f36d7983d3593e5f4a17831f"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a6696e7a9f36d7983d3593e5f4a17831f">X86FrameLowering::hasReservedCallFrame</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>().<a href="/docs/api/classes/llvm/machineframeinfo/#a0509430713d587eba74220a8375948a8">hasVarSizedObjects</a>() &amp;&amp;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlight">         !MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;getHasPushSequences() &amp;&amp;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">         !MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;hasPreallocatedCall();</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightComment">/// canSimplifyCallFramePseudos - If there is a reserved call frame, the</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightComment">/// call frame pseudos can be simplified.  Having a FP, as in the default</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightComment">/// implementation, is not sufficient here since we can&#39;t always use it.</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightComment">/// Use a more nuanced condition.</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72" lineLink="/docs/api/classes/llvm/x86framelowering/#a0c500b38e3912753a3b7354b88b10993"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a0c500b38e3912753a3b7354b88b10993">X86FrameLowering::canSimplifyCallFramePseudos</a>(</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a6696e7a9f36d7983d3593e5f4a17831f">hasReservedCallFrame</a>(MF) ||</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">         MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;hasPreallocatedCall() ||</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">         (<a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF) &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF)) ||</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasBasePointer(MF);</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightComment">// needsFrameIndexResolution - Do we need to perform FI resolution for</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightComment">// this function. Normally, this is required only when the function</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightComment">// has any stack objects. However, FI resolution actually has another job,</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightComment">// not apparent from the title - it resolves callframesetup/destroy</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightComment">// that were not simplified earlier.</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightComment">// So, this is required for x86 functions that have push sequences even</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightComment">// when there are no stack objects.</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="/docs/api/classes/llvm/x86framelowering/#a0d66887ade3ca46870e0921376f86fd1"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a0d66887ade3ca46870e0921376f86fd1">X86FrameLowering::needsFrameIndexResolution</a>(</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>().<a href="/docs/api/classes/llvm/machineframeinfo/#acb35f7f6a131a64e636d936246ebd37f">hasStackObjects</a>() ||</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">         MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;getHasPushSequences();</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightComment">/// hasFPImpl - Return true if the specified function should have a dedicated</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlightComment">/// frame pointer register.  This is true if the function has variable sized</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightComment">/// allocas or if frame pointer elimination is disabled.</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96" lineLink="/docs/api/classes/llvm/x86framelowering/#a493d9a8215b5ec117b32762217d66f80"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a493d9a8215b5ec117b32762217d66f80">X86FrameLowering::hasFPImpl</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#ab1fb67187fc37e569cc5171cbebba873">Options</a>.<a href="/docs/api/classes/llvm/targetoptions/#aad0fc1de8197ddf2c49346c5d92a2bec">DisableFramePointerElim</a>(MF) ||</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) || MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a0509430713d587eba74220a8375948a8">hasVarSizedObjects</a>() ||</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">          MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a32125253541ab2e7ec5bbe550ecc2d0c">isFrameAddressTaken</a>() || MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a51773b6c05f392988bf6395ccd1788ce">hasOpaqueSPAdjustment</a>() ||</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a046dd28b46bd584d050eca36d081c372">getForceFramePointer</a>() ||</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa136a47fd323997cfe9d1ac8419ede8f">hasPreallocatedCall</a>() ||</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#a6799fb8536b173a2078ef97e1f0d16ec">callsUnwindInit</a>() || MF.<a href="/docs/api/classes/llvm/machinefunction/#ad40522ac860df72189255e38782acc3f">hasEHFunclets</a>() || MF.<a href="/docs/api/classes/llvm/machinefunction/#a768ff6dfb15d23afedd7f07501afee9e">callsEHReturn</a>() ||</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">          MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#aa7d9e2f26e4c8b32f51c455b220ce13c">hasStackMap</a>() || MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a503a8cb169aa29ac907c218692087db3">hasPatchPoint</a>() ||</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">          (isWin64Prologue(MF) &amp;&amp; MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ac901643b9a98a52b1c323b79f28b8dcc">hasCopyImplyingStackAdjustment</a>()));</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108" lineLink="#a5d39e675b72aafdb90b4ac24e229108d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a5d39e675b72aafdb90b4ac24e229108d">getSUBriOpcode</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLP64) &#123;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsLP64 ? X86::SUB64ri32 : X86::SUB32ri;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112" lineLink="#a1ecf75331d34e66af2a1ecb91a339090"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a1ecf75331d34e66af2a1ecb91a339090">getADDriOpcode</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLP64) &#123;</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsLP64 ? X86::ADD64ri32 : X86::ADD32ri;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116" lineLink="#ae47fe718044419c88efa13772780b920"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#ae47fe718044419c88efa13772780b920">getSUBrrOpcode</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLP64) &#123;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsLP64 ? X86::SUB64rr : X86::SUB32rr;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120" lineLink="#a9eeab7cb8d11a73a02d732d54f891239"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a9eeab7cb8d11a73a02d732d54f891239">getADDrrOpcode</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLP64) &#123;</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsLP64 ? X86::ADD64rr : X86::ADD32rr;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124" lineLink="#a76608be3df4f82c18347d1680f3b0936"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a76608be3df4f82c18347d1680f3b0936">getANDriOpcode</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLP64, int64&#95;t Imm) &#123;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsLP64 ? X86::AND64ri32 : X86::AND32ri;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="#a48597b35dc2ab842232cc2a5c6047401"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a48597b35dc2ab842232cc2a5c6047401">getLEArOpcode</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLP64) &#123;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsLP64 ? X86::LEA64r : X86::LEA32r;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132" lineLink="#a39d0dcc2605f63349a774a79927b2209"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a39d0dcc2605f63349a774a79927b2209">getMOVriOpcode</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Use64BitReg, int64&#95;t Imm) &#123;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Use64BitReg) &#123;</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a87e65296f2a6d9570117a852af342764">isUInt&lt;32&gt;</a>(Imm))</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> X86::MOV32ri64;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a1a1e51a5952c3afa00875df90e7ae6f8">isInt&lt;32&gt;</a>(Imm))</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> X86::MOV64ri32;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> X86::MOV64ri;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> X86::MOV32ri;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlightComment">// Push-Pop Acceleration (PPX) hint is used to indicate that the POP reads the</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">// value written by the PUSH from the stack. The processor tracks these marked</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightComment">// instructions internally and fast-forwards register data between matching PUSH</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightComment">// and POP instructions, without going through memory or through the training</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlightComment">// loop of the Fast Store Forwarding Predictor (FSFP). Instead, a more efficient</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlightComment">// memory-renaming optimization can be used.</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightComment">// The PPX hint is purely a performance hint. Instructions with this hint have</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlightComment">// the same functional semantics as those without. PPX hints set by the</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlightComment">// compiler that violate the balancing rule may turn off the PPX optimization,</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">// but they will not affect program semantics.</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">// Hence, PPX is used for balanced spill/reloads (Exceptions and setjmp/longjmp</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightComment">// are not considered).</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlightComment">// PUSH2 and POP2 are instructions for (respectively) pushing/popping 2</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">// GPRs at a time to/from the stack.</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160" lineLink="#aef1cc59e277ff82741aa24e3e170ee04"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#aef1cc59e277ff82741aa24e3e170ee04">getPUSHOpcode</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;ST) &#123;</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ST.is64Bit() ? (ST.hasPPX() ? X86::PUSHP64r : X86::PUSH64r)</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">                      : X86::PUSH32r;</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164" lineLink="#abe688d8814460e4a62c6e50b82d1be9a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#abe688d8814460e4a62c6e50b82d1be9a">getPOPOpcode</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;ST) &#123;</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ST.is64Bit() ? (ST.hasPPX() ? X86::POPP64r : X86::POP64r)</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">                      : X86::POP32r;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168" lineLink="#a2621d6b164bd8fb5ef4356154ea9b399"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a2621d6b164bd8fb5ef4356154ea9b399">getPUSH2Opcode</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;ST) &#123;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ST.hasPPX() ? X86::PUSH2P : X86::PUSH2;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171" lineLink="#ae299adbcf2ff9ecc484dc4b73d262eaa"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#ae299adbcf2ff9ecc484dc4b73d262eaa">getPOP2Opcode</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;ST) &#123;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ST.hasPPX() ? X86::POP2P : X86::POP2;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175" lineLink="#a833aa9ac03a9d223ea251585baaa5642"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a833aa9ac03a9d223ea251585baaa5642">isEAXLiveIn</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/machinebasicblock/registermaskpair">MachineBasicBlock::RegisterMaskPair</a> RegMask : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.liveins()) &#123;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mcregister">MCRegister</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = RegMask.PhysReg;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == X86::RAX || <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == X86::EAX || <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == X86::AX ||</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == X86::AH || <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == X86::AL)</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightComment">/// Check if the flags need to be preserved before the terminators.</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlightComment">/// This would be the case, if the eflags is live-in of the region</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlightComment">/// composed by the terminators or live-out of that region, without</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlightComment">/// being defined by a terminator.</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192" lineLink="#a63bd353ca84282a830d803a6bf9e4c5e"><span class="doxyHighlight"><a href="#a63bd353ca84282a830d803a6bf9e4c5e">flagsNeedToBePreservedBeforeTheTerminators</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.terminators()) &#123;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BreakNext = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg())</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> != X86::EFLAGS)</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This terminator needs an eflags that is not defined</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// by a previous another terminator:</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// EFLAGS is live-in of the region composed by the terminators.</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isDef())</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This terminator defines the eflags, i.e., we don&#39;t need to preserve it.</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// However, we still need to check this specific terminator does not</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// read a live-in value.</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">      BreakNext = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We found a definition of the eflags, no need to preserve them.</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BreakNext)</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// None of the terminators use or define the eflags.</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if they are live-out, that would imply we need to preserve them.</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.successors())</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ-&gt;isLiveIn(X86::EFLAGS))</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlightComment">/// emitSPUpdate - Emit a series of instructions to increment / decrement the</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlightComment">/// stack pointer by a constant value.</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228" lineLink="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">X86FrameLowering::emitSPUpdate</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, int64&#95;t NumBytes,</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InEpilogue)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isSub = NumBytes &lt; 0;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = isSub ? -NumBytes : NumBytes;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518">MachineInstr::MIFlag</a> Flag =</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">      isSub ? <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a> : <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a87e65296f2a6d9570117a852af342764">isUInt&lt;32&gt;</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)) &#123;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;re being asked to adjust a 32-bit stack pointer by 4 GiB or more.</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This might be unreachable code, so don&#39;t complain now; just trap if</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it&#39;s reached at runtime.</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::TRAP));</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">  uint64&#95;t Chunk = (1LL &lt;&lt; 31) - 1;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;();</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86targetlowering">X86TargetLowering</a> &amp;TLI = &#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering();</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EmitInlineStackProbe = TLI.hasInlineStackProbe(MF);</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s ok to not take into account large chunks when probing, as the</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocation is split in smaller chunks anyway.</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EmitInlineStackProbe &amp;&amp; !InEpilogue) &#123;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This pseudo-instruction is going to be expanded, potentially using a</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop, by inlineStackProbe().</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::STACKALLOC&#95;W&#95;PROBING)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; Chunk) &#123;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Rather than emit a long series of instructions for large offsets,</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// load the offset into a register and do one sub/add</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Reg = 0;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Rax = (unsigned)(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::RAX : X86::EAX);</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isSub &amp;&amp; !<a href="#a833aa9ac03a9d223ea251585baaa5642">isEAXLiveIn</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>))</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">      Reg = Rax;</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">      Reg = <a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;findDeadCallerSavedReg(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>),</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? 64 : 32);</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AddSubRROpc = isSub ? <a href="#ae47fe718044419c88efa13772780b920">getSUBrrOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>)</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">                                 : <a href="#a9eeab7cb8d11a73a02d732d54f891239">getADDrrOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>);</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Reg) &#123;</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#a39d0dcc2605f63349a774a79927b2209">getMOVriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)),</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">              Reg)</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(Flag);</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(AddSubRROpc), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">                             .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">                             .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Reg);</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(3).setIsDead(); </span><span class="doxyHighlightComment">// The EFLAGS implicit def is dead.</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; 8 &#42; Chunk) &#123;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we would need more than 8 add or sub instructions (a &gt;16GB stack</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// frame), it&#39;s worth spilling RAX to materialize this immediate.</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   pushq %rax</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   movabsq +-$Offset+-SlotSize, %rax</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   addq %rsp, %rax</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   xchg %rax, (%rsp)</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   movq (%rsp), %rsp</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;can&#39;t have 32-bit 16GB stack frame&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH64r))</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Rax, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a9ddde91ef09476d28a088fe57f8e2921">RegState::Kill</a>)</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(Flag);</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Subtract is not commutative, so negate the offset and always use add.</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Subtract 8 less and add 8 more to account for the PUSH we just did.</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isSub)</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = -(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>);</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#a39d0dcc2605f63349a774a79927b2209">getMOVriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)),</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">              Rax)</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(Flag);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::ADD64rr), Rax)</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">                             .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Rax)</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">                             .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>);</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(3).setIsDead(); </span><span class="doxyHighlightComment">// The EFLAGS implicit def is dead.</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Exchange the new SP in RAX with the top of the stack.</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::XCHG64rm), Rax).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Rax),</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0);</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Load new SP from the top of the stack into RSP.</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rm), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>),</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0);</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &#123;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">    uint64&#95;t ThisVal = std::min(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, Chunk);</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThisVal == <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>) &#123;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Use push / pop for slot sized adjustments as a size optimization. We</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// need to find a dead register when using pop.</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Reg = isSub ? (unsigned)(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::RAX : X86::EAX)</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">                           : <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;findDeadCallerSavedReg(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Reg) &#123;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = isSub ? (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::PUSH64r : X86::PUSH32r)</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">                             : (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::POP64r : X86::POP32r);</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc))</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Reg, <a href="/docs/api/namespaces/llvm/#aa5e4d7acf58e87826a15b94d37144f2b">getDefRegState</a>(!isSub) | <a href="/docs/api/namespaces/llvm/#aa3a1f79eb5e89f41ad5a3d8e9b2a367a">getUndefRegState</a>(isSub))</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(Flag);</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> -= ThisVal;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">    BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, isSub ? -ThisVal : ThisVal, InEpilogue)</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">        .setMIFlag(Flag);</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> -= ThisVal;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> X86FrameLowering::BuildStackAdjustment(</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InEpilogue)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;zero offset stack adjustment requested&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// On Atom, using LEA to adjust SP is preferred, but using it in the epilogue</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is tricky.</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseLEA;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InEpilogue) &#123;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if inserting the prologue at the beginning</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of MBB would require to use LEA operations.</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to use LEA operations if EFLAGS is live in, because</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it means an instruction will read it before it gets defined.</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">    UseLEA = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.useLeaForSP() || <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isLiveIn(X86::EFLAGS);</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we can use LEA for SP but we shouldn&#39;t, check that none</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the terminators uses the eflags. Otherwise we will insert</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a ADD that will redefine the eflags and break the condition.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Alternatively, we could move the ADD, but this may not be possible</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and is an optimization anyway.</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">    UseLEA = <a href="/docs/api/classes/llvm/x86framelowering/#ad7e593e787ba6a94dbd287c32abe4006">canUseLEAForSPInEpilogue</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent());</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseLEA &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.useLeaForSP())</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">      UseLEA = <a href="#a63bd353ca84282a830d803a6bf9e4c5e">flagsNeedToBePreservedBeforeTheTerminators</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If that assert breaks, that means we do not do the right thing</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in canUseAsEpilogue.</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((UseLEA || !<a href="#a63bd353ca84282a830d803a6bf9e4c5e">flagsNeedToBePreservedBeforeTheTerminators</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &amp;&amp;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;We shouldn&#39;t have allowed this insertion point&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">  MachineInstrBuilder <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseLEA) &#123;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#a48597b35dc2ab842232cc2a5c6047401">getLEArOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>)),</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>),</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSub = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt; 0;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    uint64&#95;t AbsOffset = IsSub ? -<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> : <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = IsSub ? <a href="#a5d39e675b72aafdb90b4ac24e229108d">getSUBriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>)</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">                               : <a href="#a1ecf75331d34e66af2a1ecb91a339090">getADDriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>);</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">             .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">             .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(AbsOffset);</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(3).setIsDead(); </span><span class="doxyHighlightComment">// The EFLAGS implicit def is dead.</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394" lineLink="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4"><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4">X86FrameLowering::mergeSPUpdates</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> doMergeWithPrevious)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((doMergeWithPrevious &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin()) ||</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">      (!doMergeWithPrevious &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end()))</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> PI = doMergeWithPrevious ? std::prev(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  PI = <a href="/docs/api/namespaces/llvm/#a9256279285c60fce1b2eb1b928599461">skipDebugInstructionsBackward</a>(PI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin());</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is assumed that ADD/SUB/LEA instruction is succeded by one CFI</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction, and that there are no DBG&#95;VALUE or other instructions between</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ADD/SUB/LEA and its corresponding CFI instruction.</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">/&#42; TODO: Add support for the case where there are multiple CFI instructions</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlightComment">    below the ADD/SUB/LEA, e.g.:</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlightComment">    ...</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlightComment">    add</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlightComment">    cfi&#95;def&#95;cfa&#95;offset</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlightComment">    cfi&#95;offset</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlightComment">    ...</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlightComment">  &#42;/</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (doMergeWithPrevious &amp;&amp; PI != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin() &amp;&amp; PI-&gt;isCFIInstruction())</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">    PI = std::prev(PI);</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = PI-&gt;getOpcode();</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 0;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Opc == X86::ADD64ri32 || Opc == X86::ADD32ri) &amp;&amp;</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">      PI-&gt;getOperand(0).getReg() == <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>) &#123;</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PI-&gt;getOperand(1).getReg() == <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>);</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = PI-&gt;getOperand(2).getImm();</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Opc == X86::LEA32r || Opc == X86::LEA64&#95;32r) &amp;&amp;</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">             PI-&gt;getOperand(0).getReg() == <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a> &amp;&amp;</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">             PI-&gt;getOperand(1).getReg() == <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a> &amp;&amp;</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">             PI-&gt;getOperand(2).getImm() == 1 &amp;&amp;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">             PI-&gt;getOperand(3).getReg() == X86::NoRegister &amp;&amp;</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">             PI-&gt;getOperand(5).getReg() == X86::NoRegister) &#123;</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For LEAs we have: def = lea SP, FI, noreg, Offset, noreg.</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = PI-&gt;getOperand(4).getImm();</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Opc == X86::SUB64ri32 || Opc == X86::SUB32ri) &amp;&amp;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">             PI-&gt;getOperand(0).getReg() == <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>) &#123;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PI-&gt;getOperand(1).getReg() == <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>);</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = -PI-&gt;getOperand(2).getImm();</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">  PI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.erase(PI);</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PI != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end() &amp;&amp; PI-&gt;isCFIInstruction()) &#123;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CIs = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent()-&gt;getFrameInstructions();</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mccfiinstruction">MCCFIInstruction</a> CI = CIs&#91;PI-&gt;getOperand(0).getCFIIndex()&#93;;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI.<a href="/docs/api/classes/llvm/mccfiinstruction/#a9d7ee9c6eaabde95dd9695326a77f253">getOperation</a>() == <a href="/docs/api/classes/llvm/mccfiinstruction/#aaf905b9d7696f2b8da2e4c89c860f6eca5822faf65b27795cd48bd44712d48927">MCCFIInstruction::OpDefCfaOffset</a> ||</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">        CI.<a href="/docs/api/classes/llvm/mccfiinstruction/#a9d7ee9c6eaabde95dd9695326a77f253">getOperation</a>() == <a href="/docs/api/classes/llvm/mccfiinstruction/#aaf905b9d7696f2b8da2e4c89c860f6ecaea7047186e58e6304947fbe2b12963ca">MCCFIInstruction::OpAdjustCfaOffset</a>)</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">      PI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.erase(PI);</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!doMergeWithPrevious)</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a href="/docs/api/namespaces/llvm/#a5bacbbd03e9261f7b30dc174f26d680c">skipDebugInstructionsForward</a>(PI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end());</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454" lineLink="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">X86FrameLowering::BuildCFI</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mccfiinstruction">MCCFIInstruction</a> &amp;CFIInst,</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518">MachineInstr::MIFlag</a> Flag)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CFIIndex = MF.<a href="/docs/api/classes/llvm/machinefunction/#a247230f547064b27022d70c0aeb86682">addFrameInst</a>(CFIInst);</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CFIInst.<a href="/docs/api/classes/llvm/mccfiinstruction/#a9d7ee9c6eaabde95dd9695326a77f253">getOperation</a>() == <a href="/docs/api/classes/llvm/mccfiinstruction/#aaf905b9d7696f2b8da2e4c89c860f6ecaea7047186e58e6304947fbe2b12963ca">MCCFIInstruction::OpAdjustCfaOffset</a>)</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;setHasCFIAdjustCfa(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(TargetOpcode::CFI&#95;INSTRUCTION))</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a3e4e67777edb24fac492ef4ae15e69ba">addCFIIndex</a>(CFIIndex)</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(Flag);</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlightComment">/// Emits Dwarf Info specifying offsets of callee saved registers and</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlightComment">/// frame pointer. This is called only when basic block sections are enabled.</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472" lineLink="/docs/api/classes/llvm/x86framelowering/#acbd4fee4d18fa2066d758dff7168ef36"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#acbd4fee4d18fa2066d758dff7168ef36">X86FrameLowering::emitCalleeSavedFrameMovesFullCFA</a>(</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF)) &#123;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a6c1f3151b66ea2dfd6a8b9cef815d51c">emitCalleeSavedFrameMoves</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>&#123;&#125;, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mcregisterinfo">MCRegisterInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a752546c51633c140d9ca4ab98b4781b6">getContext</a>().<a href="/docs/api/classes/llvm/mccontext/#a7eff7fcbe27aa063e7dced4042ca3416">getRegisterInfo</a>();</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/register">Register</a> MachineFramePtr =</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32() ? <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, 64))</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">                               : <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfReg = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getDwarfRegNum(MachineFramePtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Offset = space for return address + size of the frame pointer itself.</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">  int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? 8 : 4) + (<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? 8 : 4);</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>&#123;&#125;,</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/mccfiinstruction/#a6a60a82f8cb445e9e7029e38733b2d30">MCCFIInstruction::createOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfReg, -<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>));</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86framelowering/#a6c1f3151b66ea2dfd6a8b9cef815d51c">emitCalleeSavedFrameMoves</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>&#123;&#125;, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492" lineLink="/docs/api/classes/llvm/x86framelowering/#a6c1f3151b66ea2dfd6a8b9cef815d51c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a6c1f3151b66ea2dfd6a8b9cef815d51c">X86FrameLowering::emitCalleeSavedFrameMoves</a>(</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPrologue)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mcregisterinfo">MCRegisterInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a752546c51633c140d9ca4ab98b4781b6">getContext</a>().<a href="/docs/api/classes/llvm/mccontext/#a7eff7fcbe27aa063e7dced4042ca3416">getRegisterInfo</a>();</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add callee saved registers to move list.</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::vector&lt;CalleeSavedInfo&gt; &amp;CSI = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#aad474502cac7b22b83e74de089f8c81d">getCalleeSavedInfo</a>();</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Calculate offsets.</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/calleesavedinfo">CalleeSavedInfo</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : CSI) &#123;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#adf98860d7f42290f873c82a981eb0ea6">getObjectOffset</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFrameIdx());</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getReg();</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfReg = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getDwarfRegNum(Reg, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsPrologue) &#123;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab35a2bbb33b7a14cf05c24b429e2f593">getStackPtrSaveMI</a>()) &#123;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// +2&#42;SlotSize because there is return address and ebp at the bottom</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// of the stack.</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// | retaddr |</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// | ebp     |</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// |         |&lt;--ebp</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += 2 &#42; <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;64&gt;</a> CfaExpr;</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">        CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(dwarf::DW&#95;CFA&#95;expression);</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">        uint8&#95;t buffer&#91;16&#93;;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">        CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ad0f8c0e82cde3bb0849fc59e3510f05a">encodeULEB128</a>(DwarfReg, buffer));</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">        CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(2);</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/register">Register</a> MachineFramePtr =</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32()</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">                ? <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, 64))</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">                : <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfFramePtr = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getDwarfRegNum(MachineFramePtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">        CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>((uint8&#95;t)(dwarf::DW&#95;OP&#95;breg0 + DwarfFramePtr));</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">        CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ac21006e81ffbbc79e8e51e44f7878053">encodeSLEB128</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, buffer));</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/mccfiinstruction/#ac6eb36207cf2c7ebbd9a67e63dcc5568">MCCFIInstruction::createEscape</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>()),</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/mccfiinstruction/#a6a60a82f8cb445e9e7029e38733b2d30">MCCFIInstruction::createOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfReg, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>));</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#a43cce47857fdb1dfec97aeba83ab82a3">MCCFIInstruction::createRestore</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfReg));</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab35a2bbb33b7a14cf05c24b429e2f593">getStackPtrSaveMI</a>()) &#123;</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(1).getIndex();</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">    int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#adf98860d7f42290f873c82a981eb0ea6">getObjectOffset</a>(FI) + 2 &#42; <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;64&gt;</a> CfaExpr;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/register">Register</a> MachineFramePtr =</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32()</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">            ? <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, 64))</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">            : <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>;</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfFramePtr = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>-&gt;getDwarfRegNum(MachineFramePtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>((uint8&#95;t)(dwarf::DW&#95;OP&#95;breg0 + DwarfFramePtr));</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">    uint8&#95;t buffer&#91;16&#93;;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ac21006e81ffbbc79e8e51e44f7878053">encodeSLEB128</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, buffer));</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(dwarf::DW&#95;OP&#95;deref);</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;64&gt;</a> DefCfaExpr;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">    DefCfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(dwarf::DW&#95;CFA&#95;def&#95;cfa&#95;expression);</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    DefCfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ac21006e81ffbbc79e8e51e44f7878053">encodeSLEB128</a>(CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(), buffer));</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    DefCfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>());</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// DW&#95;CFA&#95;def&#95;cfa&#95;expression: DW&#95;OP&#95;breg5 offset, DW&#95;OP&#95;deref</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/mccfiinstruction/#ac6eb36207cf2c7ebbd9a67e63dcc5568">MCCFIInstruction::createEscape</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DefCfaExpr.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>()),</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitZeroCallUsedRegs(<a href="/docs/api/classes/llvm/bitvector">BitVector</a> RegsToZero,</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insertion point.</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getFirstTerminator();</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fake a debug loc.</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end())</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Zero out FP stack if referenced. Do this outside of the loop below so that</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it&#39;s done only once.</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;ST = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;();</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mcregister">MCRegister</a> Reg : RegsToZero.<a href="/docs/api/classes/llvm/bitvector/#aa56c07cdb4f03ddef7dfdf460811d36e">set&#95;bits</a>()) &#123;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!X86::RFP80RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumFPRegs = ST.is64Bit() ? 8 : 7;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != NumFPRegs; ++i)</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>.get(X86::LD&#95;F0));</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != NumFPRegs; ++i)</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>.get(X86::ST&#95;FPrr)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::ST0);</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For GPRs, we only care to clear out the 32-bit register.</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitvector">BitVector</a> GPRsToZero(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;getNumRegs());</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mcregister">MCRegister</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> : RegsToZero.<a href="/docs/api/classes/llvm/bitvector/#aa56c07cdb4f03ddef7dfdf460811d36e">set&#95;bits</a>())</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isGeneralPurposeRegister(MF, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">      GPRsToZero.set(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, 32));</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">      RegsToZero.<a href="/docs/api/classes/llvm/bitvector/#a168122d6ac4ed2a8b722e01b592ad289">reset</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Zero out the GPRs first.</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MCRegister <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> : GPRsToZero.set&#95;bits())</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.buildClearRegister(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Zero out the remaining registers.</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MCRegister <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> : RegsToZero.<a href="/docs/api/classes/llvm/bitvector/#aa56c07cdb4f03ddef7dfdf460811d36e">set&#95;bits</a>())</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.buildClearRegister(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613" lineLink="/docs/api/classes/llvm/x86framelowering/#a6a6cb0d8b5d8e3b35dee29f5e752d31c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a6a6cb0d8b5d8e3b35dee29f5e752d31c">X86FrameLowering::emitStackProbe</a>(</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InProlog,</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">    std::optional&lt;MachineFunction::DebugInstrOperandPair&gt; InstrNum)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;();</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWindowsCoreCLR()) &#123;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog) &#123;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::STACKALLOC&#95;W&#95;PROBING))</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0 </span><span class="doxyHighlightComment">/&#42; no explicit stack size &#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">      emitStackProbeInline(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">    emitStackProbeCall(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, InProlog, InstrNum);</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630" lineLink="/docs/api/classes/llvm/x86framelowering/#ad88384d07e66c382b05f793848660d90"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#ad88384d07e66c382b05f793848660d90">X86FrameLowering::stackProbeFunctionModifiesSP</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isOSWindows() &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64();</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634" lineLink="/docs/api/classes/llvm/x86framelowering/#a91705445bd9fc240a0092580cab1d092"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a91705445bd9fc240a0092580cab1d092">X86FrameLowering::inlineStackProbe</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;PrologMBB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Where = <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">llvm::find&#95;if</a>(PrologMBB, &#91;&#93;(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == X86::STACKALLOC&#95;W&#95;PROBING;</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Where != PrologMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>()) &#123;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = PrologMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ab622d694b5fcb0edb99159f1ebdcdb6b">findDebugLoc</a>(Where);</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">    emitStackProbeInline(MF, PrologMBB, Where, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">    Where-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitStackProbeInline(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InProlog)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;();</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.<a href="/docs/api/classes/llvm/x86subtarget/#a7fa9b171fb4395bb4ac6eec96c47385d">isTargetWindowsCoreCLR</a>() &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit())</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">    emitStackProbeInlineWindowsCoreCLR64(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, InProlog);</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">    emitStackProbeInlineGeneric(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, InProlog);</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitStackProbeInlineGeneric(</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InProlog)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;AllocWithProbe = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = AllocWithProbe.<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(0).<a href="/docs/api/classes/llvm/machineoperand/#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>();</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;();</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86targetlowering">X86TargetLowering</a> &amp;TLI = &#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.<a href="/docs/api/classes/llvm/x86subtarget/#a3aaba3c88d1293bc7997de282b41c70f">getTargetLowering</a>();</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit() &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.<a href="/docs/api/classes/llvm/x86subtarget/#a7fa9b171fb4395bb4ac6eec96c47385d">isTargetWindowsCoreCLR</a>()) &amp;&amp;</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;different expansion expected for CoreCLR 64 bit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t StackProbeSize = TLI.getStackProbeSize(MF);</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">  uint64&#95;t ProbeChunk = StackProbeSize &#42; 8;</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">  uint64&#95;t MaxAlign =</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;hasStackRealignment(MF) ? calculateMaxStackAlign(MF) : 0;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Synthesize a loop or unroll it, depending on the number of iterations.</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BuildStackAlignAND ensures that only MaxAlign % StackProbeSize bits left</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// between the unaligned rsp and current rsp.</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; ProbeChunk) &#123;</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">    emitStackProbeInlineGenericLoop(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">                                    MaxAlign % StackProbeSize);</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">    emitStackProbeInlineGenericBlock(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">                                     MaxAlign % StackProbeSize);</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitStackProbeInlineGenericBlock(</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    uint64&#95;t AlignOffset)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsDwarfCFI = needsDwarfCFI(MF);</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/codeview/#a0cc2805b6b89a94c5b5983f95367168caf82a9de98dde777f8405bf54ed6fee23">HasFP</a> = <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF);</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86Subtarget &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;();</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86TargetLowering &amp;TLI = &#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering();</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MovMIOpc = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::MOV64mi32 : X86::MOV32mi;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t StackProbeSize = TLI.getStackProbeSize(MF);</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">  uint64&#95;t CurrentOffset = 0;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AlignOffset &lt; StackProbeSize);</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the offset is so small it fits within a page, there&#39;s nothing to do.</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StackProbeSize &lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + AlignOffset) &#123;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/namespaces/llvm/arm/wineh/#abbeb84a95402989ddf5e26b616f8d9b4">StackAdjustment</a> = StackProbeSize - AlignOffset;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -StackAdjustment, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">        .setMIFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/mccfiinstruction/#ad6a85756410e7929f561fc1454069563">MCCFIInstruction::createAdjustCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, StackAdjustment));</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MovMIOpc))</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">                     .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>),</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0)</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">    NumFrameExtraProbe++;</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    CurrentOffset = StackProbeSize - AlignOffset;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For the next N - 1 pages, just probe. I tried to take advantage of</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// natural probes but it implies much more logic and there was very few</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// interesting natural probes to interleave.</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CurrentOffset + StackProbeSize &lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &#123;</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">    BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -StackProbeSize, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">        .setMIFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/mccfiinstruction/#ad6a85756410e7929f561fc1454069563">MCCFIInstruction::createAdjustCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, StackProbeSize));</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MovMIOpc))</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">                     .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>),</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0)</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">    NumFrameExtraProbe++;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">    CurrentOffset += StackProbeSize;</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No need to probe the tail, it is smaller than a Page.</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">  uint64&#95;t ChunkSize = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - CurrentOffset;</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ChunkSize == <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>) &#123;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Use push for slot sized adjustments as a size optimization,</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// like emitSPUpdate does when not probing.</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::RAX : X86::EAX;</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::PUSH64r : X86::PUSH32r;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc))</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5ab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>)</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">    BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -ChunkSize, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">        .setMIFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No need to adjust Dwarf CFA offset here, the last position of the stack has</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// been defined</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitStackProbeInlineGenericLoop(</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    uint64&#95;t AlignOffset)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;null offset&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a7ebfe0cc2f78ae5f27e1944412606973">computeRegisterLiveness</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, X86::EFLAGS, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) !=</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/machinebasicblock/#af0288e181965a5ff9f0c7a75201fd142accc15fa5c7a27d461dc9a884cc9a2dc8">MachineBasicBlock::LQR&#95;Live</a> &amp;&amp;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Inline stack probe loop will clobber live EFLAGS.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsDwarfCFI = needsDwarfCFI(MF);</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/codeview/#a0cc2805b6b89a94c5b5983f95367168caf82a9de98dde777f8405bf54ed6fee23">HasFP</a> = <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF);</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86Subtarget &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;();</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86TargetLowering &amp;TLI = &#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering();</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MovMIOpc = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::MOV64mi32 : X86::MOV32mi;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t StackProbeSize = TLI.getStackProbeSize(MF);</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AlignOffset) &#123;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AlignOffset &lt; StackProbeSize) &#123;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Perform a first smaller allocation followed by a probe.</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">      BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -AlignOffset, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">          .setMIFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MovMIOpc))</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">                       .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>),</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0)</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">      NumFrameExtraProbe++;</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> -= AlignOffset;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Synthesize a loop</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">  NumFrameLoopProbe++;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;LLVM&#95;BB = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>();</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">  MachineBasicBlock &#42;testMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(LLVM&#95;BB);</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">  MachineBasicBlock &#42;tailMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(LLVM&#95;BB);</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> MBBIter = ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, testMBB);</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, tailMBB);</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> FinalStackProbed = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::R11</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">                              : <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>         ? X86::R11D</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">                                                : X86::EAX;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// save loop bound</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t BoundOffset = <a href="/docs/api/namespaces/llvm/#a41896492f62ee8d25cf8aaad70bd88aa">alignDown</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, StackProbeSize);</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can we calculate the loop bound using SUB with a 32-bit immediate?</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that the immediate gets sign-extended when used with a 64-bit</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// register, so in that case we only have 31 bits to work with.</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canUseSub =</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? <a href="/docs/api/namespaces/llvm/#a87e65296f2a6d9570117a852af342764">isUInt&lt;31&gt;</a>(BoundOffset) : <a href="/docs/api/namespaces/llvm/#a87e65296f2a6d9570117a852af342764">isUInt</a>&lt;32&gt;(BoundOffset);</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (canUseSub) &#123;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SUBOpc = <a href="#a5d39e675b72aafdb90b4ac24e229108d">getSUBriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>);</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(TargetOpcode::COPY), FinalStackProbed)</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(SUBOpc), FinalStackProbed)</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(BoundOffset)</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>) &#123;</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64ri), FinalStackProbed)</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(-BoundOffset)</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::ADD64rr), FinalStackProbed)</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Offset too large for 32-bit stack pointer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// while in the loop, use loop-invariant reg for CFI,</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instead of the stack pointer, which changes during the loop</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// x32 uses the same DWARF register numbers as x86-64,</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// so there isn&#39;t a register number for r11d, we must use r11 instead</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> DwarfFinalStackProbed =</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32()</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">              ? <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(FinalStackProbed, 64))</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">              : FinalStackProbed;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#a03445be1c81520587d5bb31b353f5558">MCCFIInstruction::createDefCfaRegister</a>(</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(DwarfFinalStackProbed, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)));</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#ad6a85756410e7929f561fc1454069563">MCCFIInstruction::createAdjustCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, BoundOffset));</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocate a page</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">  BuildStackAdjustment(&#42;testMBB, testMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -StackProbeSize,</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">                       </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      .setMIFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// touch the page</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(testMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MovMIOpc))</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">                   .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>),</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0)</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cmp with stack pointer bound</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(testMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::CMP64rr : X86::CMP32rr))</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// jump</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(testMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(testMBB)</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eacb2f86eaebe8b719f743d17a2d5a5f3d">X86::COND&#95;NE</a>)</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">  testMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(testMBB);</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  testMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(tailMBB);</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB management</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  tailMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(tailMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>());</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">  tailMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a046a35e36c4c1206711ea82ee9cb6d72">transferSuccessorsAndUpdatePHIs</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(testMBB);</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// handle tail</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t TailOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> % StackProbeSize;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> TailMBBIter = tailMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailOffset) &#123;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">    BuildStackAdjustment(&#42;tailMBB, TailMBBIter, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -TailOffset,</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">                         </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">        .setMIFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// after the loop, switch back to stack pointer for CFI</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x32 uses the same DWARF register numbers as x86-64,</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// so there isn&#39;t a register number for esp, we must use rsp instead</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> DwarfStackPtr =</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32()</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">            ? <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, 64))</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">            : <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>);</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(&#42;tailMBB, TailMBBIter, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/mccfiinstruction/#a03445be1c81520587d5bb31b353f5558">MCCFIInstruction::createDefCfaRegister</a>(</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(DwarfStackPtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)));</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update Live In information</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aee5f6b149b3f5ee5ed6ad7db9b58b148">fullyRecomputeLiveIns</a>(&#123;tailMBB, testMBB&#125;);</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitStackProbeInlineWindowsCoreCLR64(</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InProlog)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86Subtarget &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;();</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;different expansion needed for 32 bit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWindowsCoreCLR() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;custom expansion expects CoreCLR&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetInstrInfo &amp;<a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a> = &#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getInstrInfo();</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;LLVM&#95;BB = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>();</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a7ebfe0cc2f78ae5f27e1944412606973">computeRegisterLiveness</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, X86::EFLAGS, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) !=</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/machinebasicblock/#af0288e181965a5ff9f0c7a75201fd142accc15fa5c7a27d461dc9a884cc9a2dc8">MachineBasicBlock::LQR&#95;Live</a> &amp;&amp;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Inline stack probe loop will clobber live EFLAGS.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// RAX contains the number of bytes of desired stack adjustment.</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The handling here assumes this value has already been updated so as to</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// maintain stack alignment.</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to exit with RSP modified by this amount and execute suitable</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// page touches to notify the OS that we&#39;re growing the stack responsibly.</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All stack probing must be done without modifying RSP.</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// MBB:</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    SizeReg = RAX;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    ZeroReg = 0</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    CopyReg = RSP</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    Flags, TestReg = CopyReg - SizeReg</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    FinalReg = !Flags.Ovf ? TestReg : ZeroReg</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    LimitReg = gs magic thread env access</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    if FinalReg &gt;= LimitReg goto ContinueMBB</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// RoundBB:</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    RoundReg = page address of FinalReg</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LoopMBB:</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    LoopReg = PHI(LimitReg,ProbeReg)</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    ProbeReg = LoopReg - PageSize</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    &#91;ProbeReg&#93; = 0</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    if (ProbeReg &gt; RoundReg) goto LoopMBB</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ContinueMBB:</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    RSP = RSP - RAX</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    &#91;rest of original MBB&#93;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set up the new basic blocks</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">  MachineBasicBlock &#42;RoundMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(LLVM&#95;BB);</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">  MachineBasicBlock &#42;LoopMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(LLVM&#95;BB);</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  MachineBasicBlock &#42;ContinueMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(LLVM&#95;BB);</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> MBBIter = std::next(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, RoundMBB);</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, LoopMBB);</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, ContinueMBB);</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Split MBB and move the tail portion down to ContinueMBB.</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> BeforeMBBI = std::prev(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">  ContinueMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(ContinueMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>());</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">  ContinueMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a046a35e36c4c1206711ea82ee9cb6d72">transferSuccessorsAndUpdatePHIs</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Some useful constants</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> int64&#95;t ThreadEnvironmentStackLimit = 0x10;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> int64&#95;t <a href="/docs/api/files/lib/lib/codegen/implicitnullchecks-cpp/#a90146d35673da9e3e4a7f41f3b8c9b7e">PageSize</a> = 0x1000;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> int64&#95;t PageMask = ~(<a href="/docs/api/files/lib/lib/codegen/implicitnullchecks-cpp/#a90146d35673da9e3e4a7f41f3b8c9b7e">PageSize</a> - 1);</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Registers we need. For the normal case we use virtual</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// registers. For the prolog expansion we use RAX, RCX and RDX.</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">  MachineRegisterInfo &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>();</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetRegisterClass &#42;RegClass = &amp;X86::GR64RegClass;</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a></span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">      SizeReg = InProlog ? X86::RAX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">      ZeroReg = InProlog ? X86::RCX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">      CopyReg = InProlog ? X86::RDX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">      TestReg = InProlog ? X86::RDX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">      FinalReg = InProlog ? X86::RDX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">      RoundedReg = InProlog ? X86::RDX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">      LimitReg = InProlog ? X86::RCX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      JoinReg = InProlog ? X86::RCX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass),</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">      ProbeReg = InProlog ? X86::RCX : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.createVirtualRegister(RegClass);</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SP-relative offsets where we can save RCX and RDX.</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">  int64&#95;t RCXShadowSlot = 0;</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">  int64&#95;t RDXShadowSlot = 0;</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If inlining in the prolog, save RCX and RDX.</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog) &#123;</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the offsets. We need to account for things already</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pushed onto the stack at this point: return address, frame</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointer (if used), and callee saves.</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">    X86MachineFunctionInfo &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;X86MachineFunctionInfo&gt;();</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> int64&#95;t CalleeSaveSize = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad6e59a435273270b3ef84dc8a841c122">getCalleeSavedFrameSize</a>();</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/codeview/#a0cc2805b6b89a94c5b5983f95367168caf82a9de98dde777f8405bf54ed6fee23">HasFP</a> = <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF);</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if we need to spill RCX and/or RDX.</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Here we assume that no earlier prologue instruction changes RCX and/or</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// RDX, so checking the block live-ins is enough.</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsRCXLiveIn = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#af9745f59d6647bd43f9f7959ca1a9971">isLiveIn</a>(X86::RCX);</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsRDXLiveIn = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#af9745f59d6647bd43f9f7959ca1a9971">isLiveIn</a>(X86::RDX);</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">    int64&#95;t InitSlot = 8 + CalleeSaveSize + (<a href="/docs/api/namespaces/llvm/codeview/#a0cc2805b6b89a94c5b5983f95367168caf82a9de98dde777f8405bf54ed6fee23">HasFP</a> ? 8 : 0);</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Assign the initial slot to both registers, then change RDX&#39;s slot if both</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// need to be spilled.</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsRCXLiveIn)</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">      RCXShadowSlot = InitSlot;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsRDXLiveIn)</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">      RDXShadowSlot = InitSlot;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsRDXLiveIn &amp;&amp; IsRCXLiveIn)</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">      RDXShadowSlot += 8;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit the saves if needed.</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsRCXLiveIn)</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64mr)), X86::RSP, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">                   RCXShadowSlot)</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RCX);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsRDXLiveIn)</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64mr)), X86::RSP, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">                   RDXShadowSlot)</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RDX);</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Not in the prolog. Copy RAX to a virtual reg.</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rr), SizeReg).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RAX);</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add code to MBB to check for overflow and set the new target stack pointer</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to zero if so.</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::XOR64rr), ZeroReg)</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ZeroReg, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5ab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>)</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ZeroReg, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5ab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>);</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rr), CopyReg).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RSP);</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SUB64rr), TestReg)</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(CopyReg)</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SizeReg);</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CMOV64rr), FinalReg)</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(TestReg)</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ZeroReg)</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eac9ae7c779ffc6865536d9f164ebf09b9">X86::COND&#95;B</a>);</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FinalReg now holds final stack pointer value, or zero if</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocation would overflow. Compare against the current stack</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// limit from the thread environment block. Note this limit is the</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lowest touched page on the stack, not the point at which the OS</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will cause an overflow exception, so this is just an optimization</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to avoid unnecessarily touching pages that are below the current</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SP but already committed to the stack by the OS.</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rm), LimitReg)</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(ThreadEnvironmentStackLimit)</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::GS);</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CMP64rr)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalReg).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(LimitReg);</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Jump if the desired stack pointer is at or above the stack limit.</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(ContinueMBB)</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eafeeb44274a14a14010dc990daecb39a0">X86::COND&#95;AE</a>);</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add code to roundMBB to round the final stack pointer to a page boundary.</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog)</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">    RoundMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(FinalReg);</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(RoundMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::AND64ri32), RoundedReg)</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalReg)</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(PageMask);</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(RoundMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JMP&#95;1)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(LoopMBB);</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LimitReg now holds the current stack limit, RoundedReg page-rounded</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// final RSP value. Add code to loopMBB to decrement LimitReg page-by-page</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and probe until we reach RoundedReg.</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InProlog) &#123;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(LoopMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PHI), JoinReg)</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(LimitReg)</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(RoundMBB)</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ProbeReg)</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(LoopMBB);</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog)</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">    LoopMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(JoinReg);</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(LoopMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::LEA64r), ProbeReg), JoinReg,</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">               </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, -<a href="/docs/api/files/lib/lib/codegen/implicitnullchecks-cpp/#a90146d35673da9e3e4a7f41f3b8c9b7e">PageSize</a>);</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Probe by storing a byte onto the stack.</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(LoopMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV8mi))</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ProbeReg)</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0);</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog)</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">    LoopMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(RoundedReg);</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(LoopMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CMP64rr))</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(RoundedReg)</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ProbeReg);</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(LoopMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(LoopMBB)</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eacb2f86eaebe8b719f743d17a2d5a5f3d">X86::COND&#95;NE</a>);</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> ContinueMBBI = ContinueMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aa7dc7faaab4856b8f0014b8283e26c7b">getFirstNonPHI</a>();</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If in prolog, restore RDX and RCX.</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog) &#123;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RCXShadowSlot) </span><span class="doxyHighlightComment">// It means we spilled RCX in the prologue.</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;ContinueMBB, ContinueMBBI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rm), X86::RCX),</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">                   X86::RSP, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, RCXShadowSlot);</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RDXShadowSlot) </span><span class="doxyHighlightComment">// It means we spilled RDX in the prologue.</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;ContinueMBB, ContinueMBBI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rm), X86::RDX),</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">                   X86::RSP, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, RDXShadowSlot);</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that the probing is done, add code to continueMBB to update</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the stack pointer for real.</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;ContinueMBB, ContinueMBBI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SUB64rr), X86::RSP)</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RSP)</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SizeReg);</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the control flow edges we need.</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(ContinueMBB);</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(RoundMBB);</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">  RoundMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(LoopMBB);</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">  LoopMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(ContinueMBB);</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">  LoopMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(LoopMBB);</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog) &#123;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">    LivePhysRegs LiveRegs;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#acef857f72308ae9602dcf37ff032bc2f">computeAndAddLiveIns</a>(LiveRegs, &#42;ContinueMBB);</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark all the instructions added to the prolog as frame setup.</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog) &#123;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++BeforeMBBI; BeforeMBBI != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(); ++BeforeMBBI) &#123;</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">      BeforeMBBI-&gt;setFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineInstr &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;RoundMBB) &#123;</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.setFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineInstr &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;LoopMBB) &#123;</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.setFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineInstr &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> :</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">llvm::make&#95;range</a>(ContinueMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), ContinueMBBI)) &#123;</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.setFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitStackProbeCall(</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InProlog,</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">    std::optional&lt;MachineFunction::DebugInstrOperandPair&gt; InstrNum)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLargeCodeModel = MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#ae106f6c6362377b3016f0d174227e193">getCodeModel</a>() == <a href="/docs/api/namespaces/llvm/codemodel/#afc59396a9e5809fc92938e203d91a8dfa5208f558fccf9f63423fb5385bb3e75c">CodeModel::Large</a>;</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Add indirect thunk support and remove this.</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> &amp;&amp; IsLargeCodeModel &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.useIndirectThunkCalls())</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Emitting stack probe calls on 64-bit with the large &quot;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;code model and indirect thunks not yet implemented.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a7ebfe0cc2f78ae5f27e1944412606973">computeRegisterLiveness</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, X86::EFLAGS, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) !=</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/machinebasicblock/#af0288e181965a5ff9f0c7a75201fd142accc15fa5c7a27d461dc9a884cc9a2dc8">MachineBasicBlock::LQR&#95;Live</a> &amp;&amp;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Stack probe calls will clobber live EFLAGS.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CallOp;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>)</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">    CallOp = IsLargeCodeModel ? X86::CALL64r : X86::CALL64pcrel32;</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">    CallOp = X86::CALLpcrel32;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  StringRef <a href="/docs/api/namespaces/llvm/armbuildattrs/#aea10ca6bf098a425d51ac7fe65d30ed6aa10cda45fcbf7c8c9804e4e4d2e1bcdf">Symbol</a> = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering()-&gt;getStackProbeSymbolName(MF);</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  MachineInstrBuilder CI;</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> ExpansionMBBI = std::prev(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All current stack probes take AX and SP as input, clobber flags, and</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preserve all registers. x86&#95;64 probes leave RSP unmodified.</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#ae106f6c6362377b3016f0d174227e193">getCodeModel</a>() == <a href="/docs/api/namespaces/llvm/codemodel/#afc59396a9e5809fc92938e203d91a8dfa5208f558fccf9f63423fb5385bb3e75c">CodeModel::Large</a>) &#123;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For the large code model, we have to call through a register. Use R11,</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as it is scratch in all supported calling conventions.</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64ri), X86::R11)</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a6af779d02be6e05e3315887e58e8ec35">createExternalSymbolName</a>(Symbol));</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">    CI = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(CallOp)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::R11);</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">    CI = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(CallOp))</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">             .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a6af779d02be6e05e3315887e58e8ec35">createExternalSymbolName</a>(Symbol));</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AX = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::RAX : X86::EAX;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SP = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::RSP : X86::ESP;</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">  CI.<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(AX, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a0fec8ba6f4a4dc758b725205985eee99">RegState::Implicit</a>)</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SP, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a0fec8ba6f4a4dc758b725205985eee99">RegState::Implicit</a>)</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(AX, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a72c17e2ff2d5af62a30e56ac152aa8d5">RegState::Define</a> | <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a0fec8ba6f4a4dc758b725205985eee99">RegState::Implicit</a>)</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SP, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a72c17e2ff2d5af62a30e56ac152aa8d5">RegState::Define</a> | <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a0fec8ba6f4a4dc758b725205985eee99">RegState::Implicit</a>)</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::EFLAGS, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a72c17e2ff2d5af62a30e56ac152aa8d5">RegState::Define</a> | <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a0fec8ba6f4a4dc758b725205985eee99">RegState::Implicit</a>);</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  MachineInstr &#42;ModInst = CI;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64() || !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isOSWindows()) &#123;</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MSVC x32&#39;s &#95;chkstk and cygwin/mingw&#39;s &#95;alloca adjust %esp themselves.</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MSVC x64&#39;s &#95;&#95;chkstk and cygwin/mingw&#39;s &#95;&#95;&#95;chkstk&#95;ms do not adjust %rsp</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// themselves. They also does not clobber %rax so we can reuse it when</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// adjusting %rsp.</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All other platforms do not specify a particular ABI for the stack probe</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function, so we arbitrarily define it to not adjust %esp/%rsp itself.</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">    ModInst =</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#ae47fe718044419c88efa13772780b920">getSUBrrOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>)), SP)</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SP)</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(AX);</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DebugInfo variable locations -- if there&#39;s an instruction number for the</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocation (i.e., DYN&#95;ALLOC&#95;&#42;), substitute it for the instruction that</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// modifies SP.</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InstrNum) &#123;</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64() || !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isOSWindows()) &#123;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Label destination operand of the subtract.</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#a42d7a6aaee06630af49952b37ff1dbf7">makeDebugValueSubstitution</a>(&#42;InstrNum,</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">                                    &#123;ModInst-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad26a74fb0ad868f0867cce317269d721">getDebugInstrNum</a>(), 0&#125;);</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Label the call. The operand number is the penultimate operand, zero</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// based.</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SPDefOperand = ModInst-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a432824f0975bb863478bf4ef3a5df258">getNumOperands</a>() - 2;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#a42d7a6aaee06630af49952b37ff1dbf7">makeDebugValueSubstitution</a>(</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">          &#42;InstrNum, &#123;ModInst-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad26a74fb0ad868f0867cce317269d721">getDebugInstrNum</a>(), SPDefOperand&#125;);</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InProlog) &#123;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Apply the frame setup flag to all inserted instrs.</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++ExpansionMBBI; ExpansionMBBI != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>; ++ExpansionMBBI)</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">      ExpansionMBBI-&gt;setFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245" lineLink="#a045c9bd8c547ec3f14eba7aedf55a044"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a045c9bd8c547ec3f14eba7aedf55a044">calculateSetFPREG</a>(uint64&#95;t SPAdjust) &#123;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Win64 ABI has a less restrictive limitation of 240; 128 works equally well</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and might require smaller successive adjustments.</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t Win64MaxSEHOffset = 128;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">  uint64&#95;t SEHFrameOffset = std::min(SPAdjust, Win64MaxSEHOffset);</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Win64 ABI requires 16-byte alignment for the UWOP&#95;SET&#95;FPREG opcode.</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SEHFrameOffset &amp; -16;</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlightComment">// If we&#39;re forcing a stack realignment we can&#39;t rely on just the frame</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlightComment">// info, we need to know the ABI stack alignment as well in case we</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlightComment">// have a call out.  Otherwise just make sure we have some alignment - we&#39;ll</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlightComment">// go with the minimum SlotSize.</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">uint64&#95;t</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">X86FrameLowering::calculateMaxStackAlign(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MachineFrameInfo &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> MaxAlign = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a3836203fac855ac3c5718b701bd13ffd">getMaxAlign</a>(); </span><span class="doxyHighlightComment">// Desired stack alignment.</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> StackAlign = <a href="/docs/api/classes/llvm/targetframelowering/#a74d93035f53f5e8c2aaea5a8f307972d">getStackAlign</a>();</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasRealign = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;stackrealign&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasRealign) &#123;</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a2cc8bb867c8949943ca7d88f1db31fde">hasCalls</a>())</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">      MaxAlign = (StackAlign &gt; MaxAlign) ? StackAlign : MaxAlign;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxAlign &lt; <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>)</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">      MaxAlign = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>);</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>() == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca765508a953368531a7d69d1279e6cfb1">CallingConv::X86&#95;INTR</a>) &#123;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasRealign)</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">      MaxAlign = (MaxAlign &gt; 16) ? MaxAlign : <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(16);</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">      MaxAlign = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(16);</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxAlign.<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>();</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::BuildStackAlignAND(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>,</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">                                          uint64&#95;t MaxAlign)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">  uint64&#95;t Val = -MaxAlign;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AndOp = <a href="#a76608be3df4f82c18347d1680f3b0936">getANDriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>, Val);</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  MachineFunction &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86Subtarget &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;();</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86TargetLowering &amp;TLI = &#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering();</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t StackProbeSize = TLI.getStackProbeSize(MF);</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EmitInlineStackProbe = TLI.hasInlineStackProbe(MF);</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to make sure that (in worst case) less than StackProbeSize bytes</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are not probed after the AND. This assumption is used in</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// emitStackProbeInlineGeneric.</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a> &amp;&amp; EmitInlineStackProbe &amp;&amp; MaxAlign &gt;= StackProbeSize) &#123;</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">    &#123;</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">      NumFrameLoopProbe++;</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">      MachineBasicBlock &#42;entryMBB =</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>());</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">      MachineBasicBlock &#42;headMBB =</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>());</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">      MachineBasicBlock &#42;bodyMBB =</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>());</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">      MachineBasicBlock &#42;footMBB =</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>());</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> MBBIter = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, entryMBB);</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, headMBB);</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, bodyMBB);</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(MBBIter, footMBB);</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MovMIOpc = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::MOV64mi32 : X86::MOV32mi;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> FinalStackProbed = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::R11</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">                                  : <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>         ? X86::R11D</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">                                                    : X86::EAX;</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Setup entry block</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">      &#123;</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">        entryMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(entryMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(entryMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(TargetOpcode::COPY), FinalStackProbed)</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">        MachineInstr &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> =</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(entryMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(AndOp), FinalStackProbed)</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">                .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">                .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(Val)</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">                .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The EFLAGS implicit def is dead.</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(3).setIsDead();</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(entryMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::CMP64rr : X86::CMP32rr))</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(entryMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2ea80da60ed5c7b20653afe0b4b21a91ec1">X86::COND&#95;E</a>)</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">        entryMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(headMBB);</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">        entryMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Loop entry block</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">      &#123;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SUBOpc = <a href="#a5d39e675b72aafdb90b4ac24e229108d">getSUBriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>);</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(headMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(SUBOpc), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(StackProbeSize)</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(headMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::CMP64rr : X86::CMP32rr))</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// jump to the footer if StackPtr &lt; FinalStackProbed</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(headMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(footMBB)</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eac9ae7c779ffc6865536d9f164ebf09b9">X86::COND&#95;B</a>)</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">        headMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(bodyMBB);</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">        headMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(footMBB);</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// setup loop body</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">      &#123;</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(bodyMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MovMIOpc))</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">                         .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>),</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0)</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SUBOpc = <a href="#a5d39e675b72aafdb90b4ac24e229108d">getSUBriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>);</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(bodyMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(SUBOpc), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(StackProbeSize)</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// cmp with stack pointer bound</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(bodyMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::CMP64rr : X86::CMP32rr))</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// jump back while FinalStackProbed &lt; StackPtr</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(bodyMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(bodyMBB)</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eac9ae7c779ffc6865536d9f164ebf09b9">X86::COND&#95;B</a>)</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">        bodyMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(bodyMBB);</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">        bodyMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(footMBB);</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// setup loop footer</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">      &#123;</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(footMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(TargetOpcode::COPY), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(FinalStackProbed)</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(footMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MovMIOpc))</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">                         .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>),</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, 0)</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">        footMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aee5f6b149b3f5ee5ed6ad7db9b58b148">fullyRecomputeLiveIns</a>(&#123;footMBB, bodyMBB, headMBB, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#125;);</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">    MachineInstr &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(AndOp), <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">                           .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">                           .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(Val)</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">                           .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The EFLAGS implicit def is dead.</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(3).setIsDead();</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428" lineLink="/docs/api/classes/llvm/x86framelowering/#a009e40a8d70eae94c4dc32285c717732"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a009e40a8d70eae94c4dc32285c717732">X86FrameLowering::has128ByteRedZone</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// x86-64 (non Win64) has a 128 byte red zone which is guaranteed not to be</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// clobbered by any interrupt handler.</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> == &amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;() &amp;&amp;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;MF used frame lowering for wrong subtarget&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;Fn = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>();</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsWin64CC = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isCallingConvWin64(Fn.<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>());</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> &amp;&amp; !IsWin64CC &amp;&amp; !Fn.<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::NoRedZone);</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlightComment">/// Return true if we need to use the restricted Windows x64 prologue and</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlightComment">/// epilogue code patterns that can be described with WinCFI (.seh&#95;&#42;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlightComment">/// directives).</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> X86FrameLowering::isWin64Prologue(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afb72c5626afbc815284e2b26bb0663f8">getMCAsmInfo</a>()-&gt;<a href="/docs/api/classes/llvm/mcasminfo/#ac158349781823fe8ff9e02d3a3533d55">usesWindowsCFI</a>();</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> X86FrameLowering::needsDwarfCFI(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !isWin64Prologue(MF) &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#a4f117e439113383ea819a6f7beb8ff0b">needsFrameMoves</a>();</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlightComment">/// Return true if an opcode is part of the REP group of instructions</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450" lineLink="#a74d57d95c26d07b86a63a501e1052739"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a74d57d95c26d07b86a63a501e1052739">isOpcodeRep</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode) &#123;</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Opcode) &#123;</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REPNE&#95;PREFIX:</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSB&#95;32:</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSB&#95;64:</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSD&#95;32:</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSD&#95;64:</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSQ&#95;32:</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSQ&#95;64:</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSW&#95;32:</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;MOVSW&#95;64:</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;PREFIX:</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSB&#95;32:</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSB&#95;64:</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSD&#95;32:</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSD&#95;64:</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSQ&#95;32:</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSQ&#95;64:</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSW&#95;32:</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::REP&#95;STOSW&#95;64:</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlightComment">/// emitPrologue - Push callee-saved registers onto the stack, which</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlightComment">/// automatically adjust the stack pointer. Adjust the stack pointer to allocate</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlightComment">/// space for local variables. Also emit labels used by the exception handler to</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlightComment">/// generate the exception handling frames.</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlightComment">/&#42;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlightComment">  Here&#39;s a gist of what gets emitted:</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlightComment">  ; Establish frame pointer, if needed</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlightComment">  &#91;if needs FP&#93;</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlightComment">      push  %rbp</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlightComment">      .cfi&#95;def&#95;cfa&#95;offset 16</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlightComment">      .cfi&#95;offset %rbp, -16</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlightComment">      .seh&#95;pushreg %rpb</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlightComment">      mov  %rsp, %rbp</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlightComment">      .cfi&#95;def&#95;cfa&#95;register %rbp</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlightComment">  ; Spill general-purpose registers</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlightComment">  &#91;for all callee-saved GPRs&#93;</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlightComment">      pushq %&lt;reg&gt;</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlightComment">      &#91;if not needs FP&#93;</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlightComment">         .cfi&#95;def&#95;cfa&#95;offset (offset from RETADDR)</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlightComment">      .seh&#95;pushreg %&lt;reg&gt;</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlightComment">  ; If the required stack alignment &gt; default stack alignment</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlightComment">  ; rsp needs to be re-aligned.  This creates a &quot;re-alignment gap&quot;</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlightComment">  ; of unknown size in the stack frame.</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlightComment">  &#91;if stack needs re-alignment&#93;</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlightComment">      and  $MASK, %rsp</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlightComment">  ; Allocate space for locals</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlightComment">  &#91;if target is Windows and allocated space &gt; 4096 bytes&#93;</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlightComment">      ; Windows needs special care for allocations larger</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlightComment">      ; than one page.</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlightComment">      mov $NNN, %rax</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlightComment">      call &#95;&#95;&#95;chkstk&#95;ms/&#95;&#95;&#95;chkstk</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlightComment">      sub  %rax, %rsp</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlightComment">  &#91;else&#93;</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlightComment">      sub  $NNN, %rsp</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlightComment">  &#91;if needs FP&#93;</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlightComment">      .seh&#95;stackalloc (size of XMM spill slots)</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlightComment">      .seh&#95;setframe %rbp, SEHFrameOffset ; = size of all spill slots</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlightComment">  &#91;else&#93;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlightComment">      .seh&#95;stackalloc NNN</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlightComment">  ; Spill XMMs</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlightComment">  ; Note, that while only Windows 64 ABI specifies XMMs as callee-preserved,</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlightComment">  ; they may get spilled on any platform, if the current function</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlightComment">  ; calls @llvm.eh.unwind.init</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlightComment">  &#91;if needs FP&#93;</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlightComment">      &#91;for all callee-saved XMM registers&#93;</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlightComment">          movaps  %&lt;xmm reg&gt;, -MMM(%rbp)</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlightComment">      &#91;for all callee-saved XMM registers&#93;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlightComment">          .seh&#95;savexmm %&lt;xmm reg&gt;, (-MMM + SEHFrameOffset)</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlightComment">              ; i.e. the offset relative to (%rbp - SEHFrameOffset)</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlightComment">  &#91;else&#93;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlightComment">      &#91;for all callee-saved XMM registers&#93;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlightComment">          movaps  %&lt;xmm reg&gt;, KKK(%rsp)</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlightComment">      &#91;for all callee-saved XMM registers&#93;</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlightComment">          .seh&#95;savexmm %&lt;xmm reg&gt;, KKK</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlightComment">  .seh&#95;endprologue</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlightComment">  &#91;if needs base pointer&#93;</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlightComment">      mov  %rsp, %rbx</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlightComment">      &#91;if needs to restore base pointer&#93;</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlightComment">          mov %rsp, -MMM(%rbp)</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlightComment">  ; Emit CFI info</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlightComment">  &#91;if needs FP&#93;</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlightComment">      &#91;for all callee-saved registers&#93;</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlightComment">          .cfi&#95;offset %&lt;reg&gt;, (offset from %rbp)</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlightComment">  &#91;else&#93;</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlightComment">       .cfi&#95;def&#95;cfa&#95;offset (offset from RETADDR)</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlightComment">      &#91;for all callee-saved registers&#93;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlightComment">          .cfi&#95;offset %&lt;reg&gt;, (offset from %rsp)</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlightComment">  Notes:</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlightComment">  - .seh directives are emitted only for Windows 64 ABI</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlightComment">  - .cv&#95;fpo directives are emitted on win32 when emitting CodeView</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlightComment">  - .cfi directives are emitted for all other ABIs</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlightComment">  - for 32-bit code, substitute %e?? registers for %r??</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlightComment">&#42;/</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562" lineLink="/docs/api/classes/llvm/x86framelowering/#af2ab7cd691053c57c27e810c549a0300"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#af2ab7cd691053c57c27e810c549a0300">X86FrameLowering::emitPrologue</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> == &amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;() &amp;&amp;</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;MF used frame lowering for wrong subtarget&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin();</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;Fn = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>();</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">  uint64&#95;t MaxAlign = calculateMaxStackAlign(MF); </span><span class="doxyHighlightComment">// Desired stack alignment.</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">  uint64&#95;t StackSize = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a14c39a24bf6ebbe339ae8a453c7fdd11">getStackSize</a>(); </span><span class="doxyHighlightComment">// Number of bytes to allocate.</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFunclet = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEHFuncletEntry();</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6a">EHPersonality</a> Personality = <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa88183b946cc5f0e8c96b2e66e1c74a7e">EHPersonality::Unknown</a>;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Fn.<a href="/docs/api/classes/llvm/function/#a6a0f6312963ee6fb0969243607174949">hasPersonalityFn</a>())</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">    Personality = <a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(Fn.<a href="/docs/api/classes/llvm/function/#a6f77e4e800ba4dffd63e8ddb330062aa">getPersonalityFn</a>());</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FnHasClrFunclet =</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#ad40522ac860df72189255e38782acc3f">hasEHFunclets</a>() &amp;&amp; Personality == <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa05b0e25c98ba4300ca28989a35dab72a">EHPersonality::CoreCLR</a>;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsClrFunclet = IsFunclet &amp;&amp; FnHasClrFunclet;</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasFP = <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF);</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsWin64Prologue = isWin64Prologue(MF);</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsWin64CFI = IsWin64Prologue &amp;&amp; Fn.<a href="/docs/api/classes/llvm/function/#ad7332117b148c3f93c1d7e58306ee748">needsUnwindTableEntry</a>();</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Emit FPO data for EH funclets.</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsWinFPO = !IsFunclet &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin32() &amp;&amp;</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">                     MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/module/#a7133d921c103967178f1388c8f273da3">getCodeViewFlag</a>();</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsWinCFI = NeedsWin64CFI || NeedsWinFPO;</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsDwarfCFI = needsDwarfCFI(MF);</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/register">Register</a> MachineFramePtr =</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32() ? <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, 64))</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">                               : <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>;</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> BasePtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getBaseRegister();</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasWinCFI = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Debug location must be unknown since the first debug location is used</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to determine the end of the prologue.</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> ArgBaseReg;</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit extra prolog for argument stack slot reference.</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab35a2bbb33b7a14cf05c24b429e2f593">getStackPtrSaveMI</a>()) &#123;</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MI is lea instruction that created in X86ArgumentStackSlotPass.</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Creat extra prolog for stack realignment.</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">    ArgBaseReg = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(0).getReg();</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// leal    4(%esp), %basereg</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// .cfi&#95;def&#95;cfa %basereg, 0</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// andl    $-128, %esp</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pushl   -4(%basereg)</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::LEA64r : X86::LEA32r),</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">            ArgBaseReg)</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister)</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>)</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister)</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// .cfi&#95;def&#95;cfa %basereg, 0</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfStackPtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(ArgBaseReg, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#a64fe578753bb594671a8e440e32a2b95">MCCFIInstruction::cfiDefCfa</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfStackPtr, 0),</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">    BuildStackAlignAND(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, MaxAlign);</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">    int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = -(int64&#95;t)<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::PUSH64rmm : X86::PUSH32rmm))</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ArgBaseReg)</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::NoRegister)</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::NoRegister)</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Space reserved for stack-based arguments when making a (ABI-guaranteed)</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// tail call.</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TailCallArgReserveSize = -X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>();</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailCallArgReserveSize &amp;&amp; IsWin64Prologue)</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t handle guaranteed tail call under win64 yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EmitStackProbeCall =</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering()-&gt;hasStackProbeSymbol(MF);</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StackProbeSize = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering()-&gt;getStackProbeSize(MF);</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFP &amp;&amp; X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>()) &#123;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#ab1fb67187fc37e569cc5171cbebba873">Options</a>.<a href="/docs/api/classes/llvm/targetoptions/#a66a62a15c006f8bc55698e0bea465699">SwiftAsyncFramePointer</a>) &#123;</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a78637df2e0b9a5e2109af945b0baaf34ad21e9e46158e1ff1c0b2553c4d17cd1b">SwiftAsyncFramePointerMode::DeploymentBased</a>:</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.swiftAsyncContextIsDynamicallySet()) &#123;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The special symbol below is absolute and has a &#42;value&#42; suitable to be</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// combined with the frame pointer directly.</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::OR64rm), MachineFramePtr)</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(MachineFramePtr)</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::RIP)</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister)</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(</span><span class="doxyHighlightStringLiteral">&quot;swift&#95;async&#95;extendedFramePointerFlags&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/x86ii/#a45cdfdabb3963ec52b198ce5d3aabc84ae39565b585476b7142228e439e80372e">X86II::MO&#95;GOTPCREL</a>)</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister);</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">      &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a78637df2e0b9a5e2109af945b0baaf34a68eec46437c384d8dad18d5464ebc35c">SwiftAsyncFramePointerMode::Always</a>:</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">          !IsWin64Prologue &amp;&amp;</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;win64 prologue does not set the bit 60 in the saved frame pointer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::BTS64ri8), MachineFramePtr)</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(MachineFramePtr)</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(60)</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a78637df2e0b9a5e2109af945b0baaf34a6e7b34fa59e1bd229b207892956dc41c">SwiftAsyncFramePointerMode::Never</a>:</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Re-align the stack on 64-bit if the x86-interrupt calling convention is</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// used and an error code was pushed, since the x86-64 ABI requires a 16-byte</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack alignment.</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Fn.<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>() == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca765508a953368531a7d69d1279e6cfb1">CallingConv::X86&#95;INTR</a> &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> &amp;&amp;</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">      Fn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() == 2) &#123;</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">    StackSize += 8;</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">    MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ae4d51e9e70d6a7fb366f2a09d10a0945">setStackSize</a>(StackSize);</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update the stack pointer by pushing a register. This is the instruction</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// emitted that would be end up being emitted by a call to &#96;emitSPUpdate&#96;.</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Hard-coding the update to a push avoids emitting a second</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#96;STACKALLOC&#95;W&#95;PROBING&#96; instruction in the save block: We know that stack</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// probing isn&#39;t needed anyways for an 8-byte update.</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pushing a register leaves us in a similar situation to a regular</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function call where we know that the address at (rsp-8) is writeable.</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// That way we avoid any off-by-ones with stack probing for additional</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// stack pointer updates later on.</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH64r))</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RAX, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5ab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>)</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is x86-64 and the Red Zone is not disabled, if we are a leaf</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function, and use up to 128 bytes of stack space, don&#39;t have a frame</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointer, calls, or dynamic alloca then we do not need to adjust the</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack pointer (we fit in the Red Zone). We also check that we don&#39;t</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// push and pop from the stack.</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a009e40a8d70eae94c4dc32285c717732">has128ByteRedZone</a>(MF) &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) &amp;&amp;</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">      !MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a0509430713d587eba74220a8375948a8">hasVarSizedObjects</a>() &amp;&amp;             </span><span class="doxyHighlightComment">// No dynamic alloca.</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">      !MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a19e260b3bbf8fad8480d151e11919836">adjustsStack</a>() &amp;&amp;                   </span><span class="doxyHighlightComment">// No calls.</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">      !EmitStackProbeCall &amp;&amp;                   </span><span class="doxyHighlightComment">// No stack probes.</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">      !MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ac901643b9a98a52b1c323b79f28b8dcc">hasCopyImplyingStackAdjustment</a>() &amp;&amp; </span><span class="doxyHighlightComment">// Don&#39;t push and pop.</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">      !MF.<a href="/docs/api/classes/llvm/machinefunction/#ab499fb31e894a900402d0871eee39b75">shouldSplitStack</a>()) &#123;                </span><span class="doxyHighlightComment">// Regular stack</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">    uint64&#95;t MinSize =</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">        X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad6e59a435273270b3ef84dc8a841c122">getCalleeSavedFrameSize</a>() - X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>();</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFP)</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">      MinSize += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">    X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa0d5df8154c4118afbefc1b9e8c6ad02">setUsesRedZone</a>(MinSize &gt; 0 || StackSize &gt; 0);</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">    StackSize = std::max(MinSize, StackSize &gt; 128 ? StackSize - 128 : 0);</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">    MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ae4d51e9e70d6a7fb366f2a09d10a0945">setStackSize</a>(StackSize);</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert stack pointer adjustment for later moving of return addr.  Only</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// applies to tail call optimized functions where the callee argument stack</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size is bigger than the callers.</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailCallArgReserveSize != 0) &#123;</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -(</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)TailCallArgReserveSize,</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">                         </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">        .setMIFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mapping for machine moves:</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   DST: VirtualFP AND</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        SRC: VirtualFP              =&gt; DW&#95;CFA&#95;def&#95;cfa&#95;offset</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        ELSE                        =&gt; DW&#95;CFA&#95;def&#95;cfa</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   SRC: VirtualFP AND</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        DST: Register               =&gt; DW&#95;CFA&#95;def&#95;cfa&#95;register</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ELSE</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        OFFSET &lt; 0                  =&gt; DW&#95;CFA&#95;offset&#95;extended&#95;sf</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        REG &lt; 64                    =&gt; DW&#95;CFA&#95;offset + Reg</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        ELSE                        =&gt; DW&#95;CFA&#95;offset&#95;extended</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">  uint64&#95;t NumBytes = 0;</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> stackGrowth = -<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the funclet establisher parameter</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> Establisher = X86::NoRegister;</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsClrFunclet)</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">    Establisher = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::RCX : X86::ECX;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFunclet)</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">    Establisher = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::RDX : X86::EDX;</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsWin64Prologue &amp;&amp; IsFunclet &amp;&amp; !IsClrFunclet) &#123;</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Immediately spill establisher into the home slot.</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The runtime cares about this.</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MOV64mr %rdx, 16(%rsp)</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MOVmr = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::MOV64mr : X86::MOV32mr;</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MOVmr)), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, 16)</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Establisher)</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.addLiveIn(Establisher);</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFP) &#123;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>().<a href="/docs/api/classes/llvm/machineregisterinfo/#a53ca7cff9e929ba372da9780fdd44b02">isReserved</a>(MachineFramePtr) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;FP reserved&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Calculate required stack adjustment.</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">    uint64&#95;t FrameSize = StackSize - <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">    NumBytes =</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">        FrameSize - (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad6e59a435273270b3ef84dc8a841c122">getCalleeSavedFrameSize</a>() + TailCallArgReserveSize);</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Callee-saved registers are pushed on stack before the stack is realigned.</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) &amp;&amp; !IsWin64Prologue)</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">      NumBytes = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(NumBytes, MaxAlign);</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save EBP/RBP into the appropriate stack slot.</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#aef1cc59e277ff82741aa24e3e170ee04">getPUSHOpcode</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;())))</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(MachineFramePtr, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a9ddde91ef09476d28a088fe57f8e2921">RegState::Kill</a>)</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsDwarfCFI &amp;&amp; !ArgBaseReg.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark the place where EBP/RBP was saved.</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Define the current CFA rule to use the provided offset.</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StackSize);</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#abbe481ab35db0dcfa03f9f5bbabb9def">MCCFIInstruction::cfiDefCfaOffset</a>(</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, -2 &#42; stackGrowth + (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)TailCallArgReserveSize),</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Change the rule for the FramePtr to be an &quot;offset&quot; rule.</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfFramePtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(MachineFramePtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#a6a60a82f8cb445e9e7029e38733b2d30">MCCFIInstruction::createOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfFramePtr,</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">                                              2 &#42; stackGrowth -</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">                                                  (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)TailCallArgReserveSize),</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI) &#123;</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">      HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;PushReg))</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsFunclet) &#123;</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>()) &#123;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!IsWin64Prologue &amp;&amp;</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;win64 prologue does not store async context right below rbp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Attrs = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a7477aafbbe989ad35b96fac186d8e9fd">getAttributes</a>();</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Before we update the live frame pointer we have to ensure there&#39;s a</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// valid (or null) asynchronous context in its slot just before FP in</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the frame record, so store it now.</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Attrs.hasAttrSomewhere(Attribute::SwiftAsync)) &#123;</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// We have an initial context in r14, store it just before the frame</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// pointer.</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.addLiveIn(X86::R14);</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH64r))</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::R14)</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// No initial context, store null so that there&#39;s no pointer that</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// could be misused.</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH64i32))</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI) &#123;</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">          HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;PushReg))</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(X86::R14)</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::LEA64r), <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::RSP)</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister)</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(8)</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister)</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SUB64ri32), X86::RSP)</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::RSP)</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(8)</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsWin64Prologue &amp;&amp; !IsFunclet) &#123;</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update EBP with the new base value.</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>())</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::MOV64rr : X86::MOV32rr),</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">                  <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgBaseReg.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;64&gt;</a> CfaExpr;</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">            CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(dwarf::DW&#95;CFA&#95;expression);</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">            uint8&#95;t buffer&#91;16&#93;;</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfReg = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(MachineFramePtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">            CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ad0f8c0e82cde3bb0849fc59e3510f05a">encodeULEB128</a>(DwarfReg, buffer));</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">            CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(2);</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">            CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>((uint8&#95;t)(dwarf::DW&#95;OP&#95;breg0 + DwarfReg));</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">            CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(0);</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// DW&#95;CFA&#95;expression: reg5 DW&#95;OP&#95;breg5 +0</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/mccfiinstruction/#ac6eb36207cf2c7ebbd9a67e63dcc5568">MCCFIInstruction::createEscape</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>()),</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Mark effective beginning of when frame pointer becomes valid.</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Define the current CFA to use the EBP/RBP register.</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfFramePtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(MachineFramePtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/mccfiinstruction/#a03445be1c81520587d5bb31b353f5558">MCCFIInstruction::createDefCfaRegister</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfFramePtr),</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinFPO) &#123;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// .cv&#95;fpo&#95;setframe $FramePtr</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">          HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;SetFrame))</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!IsFunclet &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;funclets without FPs not yet implemented&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">    NumBytes =</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">        StackSize - (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad6e59a435273270b3ef84dc8a841c122">getCalleeSavedFrameSize</a>() + TailCallArgReserveSize);</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the offset adjustment, which is mainly used by codeview to translate</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from ESP to VFRAME relative local variable offsets.</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsFunclet) &#123;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFP &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF))</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">      MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#af941923e75bebb485321894b2ddbeb0a">setOffsetAdjustment</a>(-NumBytes);</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">      MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#af941923e75bebb485321894b2ddbeb0a">setOffsetAdjustment</a>(-StackSize);</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For EH funclets, only allocate enough space for outgoing calls. Save the</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NumBytes value that we would&#39;ve used for the parent frame.</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ParentFrameNumBytes = NumBytes;</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFunclet)</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">    NumBytes = getWinEHFuncletFrameSize(MF);</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip the callee-saved push instructions.</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PushedRegs = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stackoffset">StackOffset</a> = 2 &#42; stackGrowth;</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> LastCSPush = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsCSPush = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) &#123;</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end() || !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>))</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getOpcode();</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Opc == X86::PUSH32r || Opc == X86::PUSH64r || Opc == X86::PUSHP64r ||</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">           Opc == X86::PUSH2 || Opc == X86::PUSH2P;</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (IsCSPush(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>)) &#123;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">    PushedRegs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getOperand(0).getReg();</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">    LastCSPush = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">    ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = LastCSPush-&gt;getOpcode();</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark callee-saved push instruction.</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Define the current CFA rule to use the provided offset.</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StackSize);</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compared to push, push2 introduces more stack offset (one more</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// register).</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == X86::PUSH2 || Opc == X86::PUSH2P)</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/stackoffset">StackOffset</a> += stackGrowth;</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#abbe481ab35db0dcfa03f9f5bbabb9def">MCCFIInstruction::cfiDefCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, -<a href="/docs/api/classes/llvm/stackoffset">StackOffset</a>),</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/stackoffset">StackOffset</a> += stackGrowth;</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI) &#123;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">      HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;PushReg))</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(Reg)</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == X86::PUSH2 || Opc == X86::PUSH2P)</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;PushReg))</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(LastCSPush-&gt;getOperand(1).getReg())</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Realign stack after we pushed callee-saved registers (so that we&#39;ll be</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// able to calculate their offsets from the frame pointer).</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t do this for Win64, it needs to realign the stack after the prologue.</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsWin64Prologue &amp;&amp; !IsFunclet &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) &amp;&amp;</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">      !ArgBaseReg.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HasFP &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There should be a frame pointer if stack is realigned.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">    BuildStackAlignAND(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, MaxAlign);</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI) &#123;</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">      HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;StackAlign))</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(MaxAlign)</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is an SUB32ri of ESP immediately before this instruction, merge</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the two. This can be the case when tail call elimination is enabled and</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the callee has more arguments then the caller.</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">  NumBytes -= <a href="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4">mergeSPUpdates</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust stack pointer: ESP -= numbytes.</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Windows and cygwin/mingw require a prologue helper routine when allocating</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// more than 4K bytes on the stack.  Windows uses &#95;&#95;chkstk and cygwin/mingw</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// uses &#95;&#95;alloca.  &#95;&#95;alloca and the 32-bit version of &#95;&#95;chkstk will probe the</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack and adjust the stack pointer in one go.  The 64-bit version of</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;chkstk is only responsible for probing the stack.  The 64-bit prologue is</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// responsible for adjusting the stack pointer.  Touching the stack at 4K</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// increments is necessary to ensure that the guard pages used by the OS</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// virtual memory manager are allocated in correct sequence.</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">  uint64&#95;t AlignedNumBytes = NumBytes;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsWin64Prologue &amp;&amp; !IsFunclet &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF))</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">    AlignedNumBytes = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(AlignedNumBytes, MaxAlign);</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AlignedNumBytes &gt;= StackProbeSize &amp;&amp; EmitStackProbeCall) &#123;</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#af2f0359e40743109c0db7eeebf23c2e9">getUsesRedZone</a>() &amp;&amp;</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;The Red Zone is not accounted for in stack probes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check whether EAX is livein for this block.</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isEAXAlive = <a href="#a833aa9ac03a9d223ea251585baaa5642">isEAXLiveIn</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isEAXAlive) &#123;</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>) &#123;</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Save RAX</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH64r))</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RAX, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a9ddde91ef09476d28a088fe57f8e2921">RegState::Kill</a>)</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Save EAX</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH32r))</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::EAX, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a9ddde91ef09476d28a088fe57f8e2921">RegState::Kill</a>)</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>) &#123;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Handle the 64-bit Windows ABI case where we need to call &#95;&#95;chkstk.</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Function prologue is responsible for adjusting the stack pointer.</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">      int64&#95;t <a href="/docs/api/namespaces/llvm/#a264176188c0aadccd3ca5b6929b5a2e1aea571dc00aef155a16d4e7e1861e1682">Alloc</a> = isEAXAlive ? NumBytes - 8 : NumBytes;</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#a39d0dcc2605f63349a774a79927b2209">getMOVriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>, <a href="/docs/api/namespaces/llvm/#a264176188c0aadccd3ca5b6929b5a2e1aea571dc00aef155a16d4e7e1861e1682">Alloc</a>)), X86::RAX)</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/#a264176188c0aadccd3ca5b6929b5a2e1aea571dc00aef155a16d4e7e1861e1682">Alloc</a>)</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Allocate NumBytes-4 bytes on stack in case of isEAXAlive.</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We&#39;ll also use 4 already allocated bytes for EAX.</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV32ri), X86::EAX)</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(isEAXAlive ? NumBytes - 4 : NumBytes)</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Call &#95;&#95;chkstk, &#95;&#95;chkstk&#95;ms, or &#95;&#95;alloca.</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a6a6cb0d8b5d8e3b35dee29f5e752d31c">emitStackProbe</a>(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isEAXAlive) &#123;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Restore RAX/EAX</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>)</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rm), X86::RAX),</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, NumBytes - 8);</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(MF, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV32rm), X86::EAX),</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, NumBytes - 4);</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;setFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.insert(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumBytes) &#123;</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -(int64&#95;t)NumBytes, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI &amp;&amp; NumBytes) &#123;</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">    HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;StackAlloc))</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(NumBytes)</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SEHFrameOffset = 0;</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SPOrEstablisher;</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFunclet) &#123;</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsClrFunclet) &#123;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The establisher parameter passed to a CLR funclet is actually a pointer</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to the (mostly empty) frame of its nearest enclosing funclet; we have</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to find the root function establisher frame by loading the PSPSym from</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the intermediate frame.</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PSPSlotOffset = getPSPSlotOffsetFromSP(MF);</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/machinepointerinfo">MachinePointerInfo</a> NoInfo;</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.addLiveIn(Establisher);</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rm), Establisher),</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">                   Establisher, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, PSPSlotOffset)</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ae565d45627e1678a3e37bd6a016c561c">addMemOperand</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a453ae3052b4f5b14cb4c184243ce5027">getMachineMemOperand</a>(</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">              NoInfo, <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda7d12be6206e5b0026c71bbcd5cb76494">MachineMemOperand::MOLoad</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, <a href="/docs/api/structs/llvm/align">Align</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>)));</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">      ;</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Save the root establisher back into the current funclet&#39;s (mostly</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// empty) frame, in case a sub-funclet or the GC needs it.</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64mr)), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>,</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, PSPSlotOffset)</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Establisher)</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ae565d45627e1678a3e37bd6a016c561c">addMemOperand</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a453ae3052b4f5b14cb4c184243ce5027">getMachineMemOperand</a>(</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">              NoInfo,</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2ddaed357b1367bc90a56fefa4d1b0e17374">MachineMemOperand::MOStore</a> | <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda796891d6ca349b671fce24b6d01d77a8">MachineMemOperand::MOVolatile</a>,</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, <a href="/docs/api/structs/llvm/align">Align</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>)));</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">    SPOrEstablisher = Establisher;</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    SPOrEstablisher = <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>;</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsWin64Prologue &amp;&amp; HasFP) &#123;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set RBP to a small fixed offset from RSP. In the funclet case, we base</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this calculation on the incoming establisher, which holds the value of</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// RSP from the parent frame at the end of the prologue.</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">    SEHFrameOffset = <a href="#a045c9bd8c547ec3f14eba7aedf55a044">calculateSetFPREG</a>(ParentFrameNumBytes);</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SEHFrameOffset)</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::LEA64r), <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>),</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">                   SPOrEstablisher, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, SEHFrameOffset);</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64rr), <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SPOrEstablisher);</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is not a funclet, emit the CFI describing our frame pointer.</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI &amp;&amp; !IsFunclet) &#123;</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!NeedsWinFPO &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;this setframe incompatible with FPO data&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">      HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;SetFrame))</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(SEHFrameOffset)</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab9c9fb92464f96c0e0f326d624e82eab">isAsynchronousEHPersonality</a>(Personality))</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">        MF.<a href="/docs/api/classes/llvm/machinefunction/#a11cf771f7f11ea4fdacdbd5420371172">getWinEHFuncInfo</a>()-&gt;<a href="/docs/api/structs/llvm/winehfuncinfo/#a38a08c28728c84e59ce6c4ef79bdabcc">SEHSetFrameOffset</a> = SEHFrameOffset;</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFunclet &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is32Bit()) &#123;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reset EBP / ESI to something good for funclets.</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a535388ac574e0f8d844662d315997b3d">restoreWin32EHStackPointers</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re a catch funclet, we can be returned to via catchret. Save ESP</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// into the registration node so that the runtime will restore it for us.</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isCleanupFuncletEntry()) &#123;</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Personality == <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aab34bedfd8d86f0adbefe4ae0e708f428">EHPersonality::MSVC&#95;CXX</a>);</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> FrameReg;</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a11cf771f7f11ea4fdacdbd5420371172">getWinEHFuncInfo</a>()-&gt;<a href="/docs/api/structs/llvm/winehfuncinfo/#a1685e8ca2cc67569dbfdd32ad11cbe70">EHRegNodeFrameIndex</a>;</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">      int64&#95;t EHRegOffset = <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, FI, FrameReg).<a href="/docs/api/classes/llvm/stackoffset/#aeb11e994c5580c80bbb0951eb05f9c80">getFixed</a>();</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// ESP is the first field, so no extra displacement is needed.</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV32mr)), FrameReg,</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, EHRegOffset)</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::ESP);</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>)) &#123;</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;FrameInstr = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">    ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI) &#123;</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI;</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.isStoreToStackSlot(FrameInstr, FI)) &#123;</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::FR64RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg)) &#123;</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/register">Register</a> IgnoredFrameReg;</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsWin64Prologue &amp;&amp; IsFunclet)</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/classes/llvm/x86framelowering/#acd3876e593314b23ed0679279ee31dfe">getWin64EHFrameIndexRef</a>(MF, FI, IgnoredFrameReg);</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> =</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, FI, IgnoredFrameReg).<a href="/docs/api/classes/llvm/stackoffset/#aeb11e994c5580c80bbb0951eb05f9c80">getFixed</a>() +</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">                SEHFrameOffset;</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">          HasWinCFI = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!NeedsWinFPO &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;SEH&#95;SaveXMM incompatible with FPO data&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;SaveXMM))</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(Reg)</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWinCFI &amp;&amp; HasWinCFI)</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;EndPrologue))</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FnHasClrFunclet &amp;&amp; !IsFunclet) &#123;</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the so-called Initial-SP (i.e. the value of the stack pointer</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// immediately after the prolog)  into the PSPSlot so that funclets</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and the GC can recover it.</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PSPSlotOffset = getPSPSlotOffsetFromSP(MF);</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PSPInfo = <a href="/docs/api/structs/llvm/machinepointerinfo/#ad8ce1aee13dbdcc05d20284a30e83170">MachinePointerInfo::getFixedStack</a>(</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">        MF, MF.<a href="/docs/api/classes/llvm/machinefunction/#a11cf771f7f11ea4fdacdbd5420371172">getWinEHFuncInfo</a>()-&gt;<a href="/docs/api/structs/llvm/winehfuncinfo/#a14648296e0e889504d49ee3aa956663c">PSPSymFrameIdx</a>);</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64mr)), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">                 PSPSlotOffset)</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>)</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ae565d45627e1678a3e37bd6a016c561c">addMemOperand</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a453ae3052b4f5b14cb4c184243ce5027">getMachineMemOperand</a>(</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">            PSPInfo, <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2ddaed357b1367bc90a56fefa4d1b0e17374">MachineMemOperand::MOStore</a> | <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda796891d6ca349b671fce24b6d01d77a8">MachineMemOperand::MOVolatile</a>,</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, <a href="/docs/api/structs/llvm/align">Align</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>)));</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Realign stack after we spilled callee-saved registers (so that we&#39;ll be</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// able to calculate their offsets from the frame pointer).</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Win64 requires aligning the stack after the prologue.</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsWin64Prologue &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF)) &#123;</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HasFP &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There should be a frame pointer if stack is realigned.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">    BuildStackAlignAND(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SPOrEstablisher, MaxAlign);</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We already dealt with stack realignment and funclets above.</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFunclet &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is32Bit())</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we need a base pointer, set it up here. It&#39;s whatever the value</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the stack pointer is at this point. Any variable size objects</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will be allocated after this, so we can still use the base pointer</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to reference locals.</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasBasePointer(MF)) &#123;</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update the base pointer with the current stack pointer.</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::MOV64rr : X86::MOV32rr;</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc), BasePtr)</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SPOrEstablisher)</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aad8e7e85710893cb7fa03109a108a070">getRestoreBasePointer</a>()) &#123;</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Stash value of base pointer.  Saving RSP instead of EBP shortens</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dependence chain. Used by SjLj EH.</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opm = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::MOV64mr : X86::MOV32mr;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opm)), <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">                   X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a5e8edced8a4733e0f6d5d1f9a31f16a4">getRestoreBasePointerOffset</a>())</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(SPOrEstablisher)</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a8ed3059d287792eb8e73780ac551e918">getHasSEHFramePtrSave</a>() &amp;&amp; !IsFunclet) &#123;</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Stash the value of the frame pointer relative to the base pointer for</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Win32 EH. This supports Win32 EH, which does the inverse of the above:</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it recovers the frame pointer from the base pointer rather than the</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// other way around.</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opm = <a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::MOV64mr : X86::MOV32mr;</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> UsedReg;</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> =</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a75b0fbc272791b1c8f9acaa3564abddb">getSEHFramePtrSaveIndex</a>(), UsedReg)</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/stackoffset/#aeb11e994c5580c80bbb0951eb05f9c80">getFixed</a>();</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UsedReg == BasePtr);</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opm)), UsedReg, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgBaseReg.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save argument base pointer.</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab35a2bbb33b7a14cf05c24b429e2f593">getStackPtrSaveMI</a>();</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(1).getIndex();</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MOVmr = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::MOV64mr : X86::MOV32mr;</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// movl    %basereg, offset(%ebp)</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a3e8b1da7820b3f19cfb702d4312410ce">addFrameReference</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MOVmr)), FI)</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ArgBaseReg)</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (((!HasFP &amp;&amp; NumBytes) || PushedRegs) &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark end of stack pointer adjustment.</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NumBytes) &#123;</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Define the current CFA rule to use the provided offset.</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StackSize);</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/mccfiinstruction/#abbe481ab35db0dcfa03f9f5bbabb9def">MCCFIInstruction::cfiDefCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, StackSize - stackGrowth),</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit DWARF info specifying the offsets of the callee-saved registers.</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a6c1f3151b66ea2dfd6a8b9cef815d51c">emitCalleeSavedFrameMoves</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// X86 Interrupt handling function cannot assume anything about the direction</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// flag (DF in EFLAGS register). Clear this flag by creating &quot;cld&quot; instruction</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in each prologue of interrupt handler function.</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create &quot;cld&quot; instruction only in these cases:</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 The interrupt handling function uses any of the &quot;rep&quot; instructions.</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 Interrupt handling function calls another function.</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3 If there are any inline asm blocks, as we do not know what they do</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We should also emit cld if we detect the use of std, but as of now,</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the compiler does not even emit that instruction or even define it, so in</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// practice, this would only happen with inline asm, which we cover anyway.</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Fn.<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>() == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca765508a953368531a7d69d1279e6cfb1">CallingConv::X86&#95;INTR</a>) &#123;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsCLD = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : MF) &#123;</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCall()) &#123;</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">          NeedsCLD = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a74d57d95c26d07b86a63a501e1052739">isOpcodeRep</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode())) &#123;</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">          NeedsCLD = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isInlineAsm()) &#123;</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// TODO: Parse asm for rep instructions or call sites?</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// For now, let&#39;s play it safe and emit a cld instruction</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// just in case.</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">          NeedsCLD = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsCLD) &#123;</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CLD))</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point we know if the function has WinCFI or not.</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#a330afa0baf556056f9c032480dd57347">setHasWinCFI</a>(HasWinCFI);</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295" lineLink="/docs/api/classes/llvm/x86framelowering/#ad7e593e787ba6a94dbd287c32abe4006"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#ad7e593e787ba6a94dbd287c32abe4006">X86FrameLowering::canUseLEAForSPInEpilogue</a>(</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t use LEA instructions for adjusting the stack pointer if we don&#39;t</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have a frame pointer in the Win64 ABI.  Only ADD instructions may be used</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to deallocate the stack.</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This means that we can use LEA for SP in two situations:</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 We &#42;aren&#39;t&#42; using the Win64 ABI which means we are free to use LEA.</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 We &#42;have&#42; a frame pointer which means we are permitted to use LEA.</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afb72c5626afbc815284e2b26bb0663f8">getMCAsmInfo</a>()-&gt;<a href="/docs/api/classes/llvm/mcasminfo/#ac158349781823fe8ff9e02d3a3533d55">usesWindowsCFI</a>() || <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF);</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306" lineLink="#a97265f2cad366f364b2bc884e589277e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64framelowering-cpp/#adee4182085538431c4a8cb7ffec54783">isFuncletReturnInstr</a>(<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode()) &#123;</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::CATCHRET:</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> X86::CLEANUPRET:</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;impossible&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlightComment">// CLR funclets use a special &quot;Previous Stack Pointer Symbol&quot; slot on the</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlightComment">// stack. It holds a pointer to the bottom of the root function frame.  The</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlightComment">// establisher frame pointer passed to a nested funclet may point to the</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlightComment">// (mostly empty) frame of its parent funclet, but it will need to find</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlightComment">// the frame of the root function to access locals.  To facilitate this,</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlightComment">// every funclet copies the pointer to the bottom of the root function</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlightComment">// frame into a PSPSym slot in its own (mostly empty) stack frame. Using the</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlightComment">// same offset for the PSPSym in the root function frame that&#39;s used in the</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlightComment">// funclets&#39; frames allows each funclet to dynamically accept any ancestor</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlightComment">// frame as its establisher argument (the runtime doesn&#39;t guarantee the</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlightComment">// immediate parent for some reason lost to history), and also allows the GC,</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlightComment">// which uses the PSPSym for some bookkeeping, to find it in any funclet&#39;s</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlightComment">// frame with only a single offset reported for the entire method.</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlightKeywordType">unsigned</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">X86FrameLowering::getPSPSlotOffsetFromSP(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> WinEHFuncInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> = &#42;MF.<a href="/docs/api/classes/llvm/machinefunction/#a11cf771f7f11ea4fdacdbd5420371172">getWinEHFuncInfo</a>();</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a>;</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/classes/llvm/x86framelowering/#afb20caf4eb8695705452f25d78a18a06">getFrameIndexReferencePreferSP</a>(MF, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.PSPSymFrameIdx, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a>,</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">                                              </span><span class="doxyHighlightComment">/&#42;IgnoreSPUpdates&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">                   .<a href="/docs/api/classes/llvm/stackoffset/#aeb11e994c5580c80bbb0951eb05f9c80">getFixed</a>();</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt;= 0 &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a> == <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getStackRegister());</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><span class="doxyHighlightKeywordType">unsigned</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">X86FrameLowering::getWinEHFuncletFrameSize(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> X86MachineFunctionInfo &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;X86MachineFunctionInfo&gt;();</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is the size of the pushed CSRs.</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CSSize = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad6e59a435273270b3ef84dc8a841c122">getCalleeSavedFrameSize</a>();</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is the size of callee saved XMMs.</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;WinEHXMMSlotInfo = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a9bbe23d1b534d969ab8244ae95a15bf7">getWinEHXMMSlotInfo</a>();</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> XMMSize =</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">      WinEHXMMSlotInfo.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() &#42; <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getSpillSize(X86::VR128RegClass);</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is the amount of stack a funclet needs to allocate.</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UsedSize;</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6a">EHPersonality</a> Personality =</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a6f77e4e800ba4dffd63e8ddb330062aa">getPersonalityFn</a>());</span></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Personality == <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa05b0e25c98ba4300ca28989a35dab72a">EHPersonality::CoreCLR</a>) &#123;</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// CLR funclets need to hold enough space to include the PSPSym, at the</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// same offset from the stack pointer (immediately after the prolog) as it</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// resides at in the main function.</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">    UsedSize = getPSPSlotOffsetFromSP(MF) + <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Other funclets just need enough stack for outgoing call arguments.</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">    UsedSize = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>().<a href="/docs/api/classes/llvm/machineframeinfo/#a4f335273c28b17552a7cfd802f42be2a">getMaxCallFrameSize</a>();</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// RBP is not included in the callee saved register block. After pushing RBP,</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// everything is 16 byte aligned. Everything we allocate before an outgoing</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call must also be 16 byte aligned.</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FrameSizeMinusRBP = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(CSSize + UsedSize, <a href="/docs/api/classes/llvm/targetframelowering/#a74d93035f53f5e8c2aaea5a8f307972d">getStackAlign</a>());</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Subtract out the size of the callee saved registers. This is how much stack</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// each funclet will allocate.</span></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FrameSizeMinusRBP + XMMSize - CSSize;</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372" lineLink="#a8485a5e7c82a6e2b65a859701c4a6cb8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/m68k/m68kframelowering-cpp/#a8485a5e7c82a6e2b65a859701c4a6cb8">isTailCallOpcode</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc) &#123;</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Opc == X86::TCRETURNri || Opc == X86::TCRETURNdi ||</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">         Opc == X86::TCRETURNmi || Opc == X86::TCRETURNri64 ||</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">         Opc == X86::TCRETURNdi64 || Opc == X86::TCRETURNmi64;</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378" lineLink="/docs/api/classes/llvm/x86framelowering/#a353d6967ff6cb7d22110de97773d65d8"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a353d6967ff6cb7d22110de97773d65d8">X86FrameLowering::emitEpilogue</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> Terminator = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getFirstTerminator();</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = Terminator;</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end())</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// standard x86&#95;64 and NaCl use 64-bit frame/stack pointers, x32 - 32-bit.</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Is64BitILP32 = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32();</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> MachineFramePtr =</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">      Is64BitILP32 ? <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, 64)) : <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>;</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsWin64Prologue = MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afb72c5626afbc815284e2b26bb0663f8">getMCAsmInfo</a>()-&gt;<a href="/docs/api/classes/llvm/mcasminfo/#ac158349781823fe8ff9e02d3a3533d55">usesWindowsCFI</a>();</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsWin64CFI =</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">      IsWin64Prologue &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#ad7332117b148c3f93c1d7e58306ee748">needsUnwindTableEntry</a>();</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFunclet = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end() ? <a href="/docs/api/namespaces/false">false</a> : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64framelowering-cpp/#adee4182085538431c4a8cb7ffec54783">isFuncletReturnInstr</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the number of bytes to allocate from the FrameInfo.</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">  uint64&#95;t StackSize = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a14c39a24bf6ebbe339ae8a453c7fdd11">getStackSize</a>();</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">  uint64&#95;t MaxAlign = calculateMaxStackAlign(MF);</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CSSize = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad6e59a435273270b3ef84dc8a841c122">getCalleeSavedFrameSize</a>();</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TailCallArgReserveSize = -X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>();</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasFP = <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF);</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">  uint64&#95;t NumBytes = 0;</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsDwarfCFI = (!MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().getTargetTriple().isOSDarwin() &amp;&amp;</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">                        !MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#a33fe94054a904130a7c774f78423c8b7">getTargetTriple</a>().<a href="/docs/api/classes/llvm/triple/#a7736bfc4c1afef875ecf02f2a7701fe3">isOSWindows</a>()) &amp;&amp;</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">                       MF.<a href="/docs/api/classes/llvm/machinefunction/#a4f117e439113383ea819a6f7beb8ff0b">needsFrameMoves</a>();</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> ArgBaseReg;</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab35a2bbb33b7a14cf05c24b429e2f593">getStackPtrSaveMI</a>()) &#123;</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = X86::LEA32r;</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> StackReg = X86::ESP;</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">    ArgBaseReg = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(0).getReg();</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit()) &#123;</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">      Opc = X86::LEA64r;</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">      StackReg = X86::RSP;</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// leal    -4(%basereg), %esp</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// .cfi&#95;def&#95;cfa %esp, 4</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc), StackReg)</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(ArgBaseReg)</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister)</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(-(int64&#95;t)<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>)</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(X86::NoRegister)</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfStackPtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(StackReg, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#a64fe578753bb594671a8e440e32a2b95">MCCFIInstruction::cfiDefCfa</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfStackPtr, <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>),</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">      --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">    --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFunclet) &#123;</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HasFP &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;EH funclets without FP not yet implemented&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">    NumBytes = getWinEHFuncletFrameSize(MF);</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFP) &#123;</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Calculate required stack adjustment.</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">    uint64&#95;t FrameSize = StackSize - <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">    NumBytes = FrameSize - CSSize - TailCallArgReserveSize;</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Callee-saved registers were pushed on stack before the stack was</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// realigned.</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) &amp;&amp; !IsWin64Prologue)</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">      NumBytes = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(FrameSize, MaxAlign);</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">    NumBytes = StackSize - CSSize - TailCallArgReserveSize;</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">  uint64&#95;t SEHStackAllocAmt = NumBytes;</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// AfterPop is the position to insert .cfi&#95;restore.</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> AfterPop = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFP) &#123;</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>()) &#123;</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Discard the context.</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 16 + <a href="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4">mergeSPUpdates</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightComment">/&#42;InEpilogue&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pop EBP.</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#abe688d8814460e4a62c6e50b82d1be9a">getPOPOpcode</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;())),</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">            MachineFramePtr)</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to reset FP to its untagged state on return. Bit 60 is currently</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// used to show the presence of an extended frame.</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>()) &#123;</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::BTR64ri8), MachineFramePtr)</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#ad88e27102395957e457fed8e73a085cf">addUse</a>(MachineFramePtr)</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(60)</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ArgBaseReg.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfStackPtr =</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::RSP : X86::ESP, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/mccfiinstruction/#a64fe578753bb594671a8e440e32a2b95">MCCFIInstruction::cfiDefCfa</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfStackPtr, <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>),</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.succ&#95;empty() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isReturnBlock()) &#123;</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfFramePtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(MachineFramePtr, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, AfterPop, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/mccfiinstruction/#a43cce47857fdb1dfec97aeba83ab82a3">MCCFIInstruction::createRestore</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DwarfFramePtr),</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">        --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlight">        --AfterPop;</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">      --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> FirstCSPop = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip the callee-saved pop instructions.</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin()) &#123;</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> PI = std::prev(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = PI-&gt;getOpcode();</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc != X86::DBG&#95;VALUE &amp;&amp; !PI-&gt;isTerminator()) &#123;</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PI-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>) ||</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">          (Opc != X86::POP32r &amp;&amp; Opc != X86::POP64r &amp;&amp; Opc != X86::BTR64ri8 &amp;&amp;</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">           Opc != X86::ADD64ri32 &amp;&amp; Opc != X86::POPP64r &amp;&amp; Opc != X86::POP2 &amp;&amp;</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">           Opc != X86::POP2P &amp;&amp; Opc != X86::LEA64r))</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">      FirstCSPop = PI;</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">    --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgBaseReg.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Restore argument base pointer.</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab35a2bbb33b7a14cf05c24b429e2f593">getStackPtrSaveMI</a>();</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(1).getIndex();</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MOVrm = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::MOV64rm : X86::MOV32rm;</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// movl   offset(%ebp), %basereg</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a3e8b1da7820b3f19cfb702d4312410ce">addFrameReference</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MOVrm), ArgBaseReg), FI)</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = FirstCSPop;</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFunclet &amp;&amp; Terminator-&gt;getOpcode() == X86::CATCHRET)</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">    emitCatchRetReturnValue(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, FirstCSPop, &amp;&#42;Terminator);</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end())</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is an ADD32ri or SUB32ri of ESP immediately before this</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction, merge the two instructions.</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumBytes || MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a0509430713d587eba74220a8375948a8">hasVarSizedObjects</a>())</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">    NumBytes += <a href="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4">mergeSPUpdates</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If dynamic alloca is used, then reset esp to point to the last callee-saved</span></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// slot before popping them off! Same applies for the case, when stack was</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// realigned. Don&#39;t do this if this was a funclet epilogue, since the funclets</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will not do realignment or dynamic stack allocation.</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (((<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF)) || MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a0509430713d587eba74220a8375948a8">hasVarSizedObjects</a>()) &amp;&amp;</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">      !IsFunclet) &#123;</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF))</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = FirstCSPop;</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SEHFrameOffset = <a href="#a045c9bd8c547ec3f14eba7aedf55a044">calculateSetFPREG</a>(SEHStackAllocAmt);</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">    uint64&#95;t LEAAmount =</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">        IsWin64Prologue ? SEHStackAllocAmt - SEHFrameOffset : -CSSize;</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>())</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlight">      LEAAmount -= 16;</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There are only two legal forms of epilogue:</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// - add SEHAllocationSize, %rsp</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// - lea SEHAllocationSize(%FramePtr), %rsp</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#39;mov %FramePtr, %rsp&#39; will not be recognized as an epilogue sequence.</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// However, we may use this sequence if we have a frame pointer because the</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// effects of the prologue can safely be undone.</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LEAAmount != 0) &#123;</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = <a href="#a48597b35dc2ab842232cc2a5c6047401">getLEArOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a>);</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>), <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>,</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, LEAAmount);</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">      --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = (<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> ? X86::MOV64rr : X86::MOV32rr);</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc), <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>);</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">      --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumBytes) &#123;</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Adjust stack pointer back: ESP += numbytes.</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, NumBytes, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Define the current CFA rule to use the provided offset.</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#abbe481ab35db0dcfa03f9f5bbabb9def">MCCFIInstruction::cfiDefCfaOffset</a>(</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, CSSize + TailCallArgReserveSize + <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>),</span></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">    --<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Windows unwinder will not invoke function&#39;s exception handler if IP is</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// either in prologue or in epilogue.  This behavior causes a problem when a</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call immediately precedes an epilogue, because the return address points</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into the epilogue.  To cope with that, we insert an epilogue marker here,</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then replace it with a &#39;nop&#39; if it ends up immediately after a CALL in the</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// final emitted code.</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsWin64CFI &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#a4a8d56726b9e91d336422a546d126a0f">hasWinCFI</a>())</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::SEH&#95;Epilogue));</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasFP &amp;&amp; NeedsDwarfCFI) &#123;</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = FirstCSPop;</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">    int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = -(int64&#95;t)CSSize - <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark callee-saved pop instruction.</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Define the current CFA rule to use the provided offset.</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end()) &#123;</span></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> PI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = PI-&gt;getOpcode();</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == X86::POP32r || Opc == X86::POP64r || Opc == X86::POPP64r ||</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">          Opc == X86::POP2 || Opc == X86::POP2P) &#123;</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Compared to pop, pop2 introduces more stack offset (one more</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// register).</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == X86::POP2 || Opc == X86::POP2P)</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/mccfiinstruction/#abbe481ab35db0dcfa03f9f5bbabb9def">MCCFIInstruction::cfiDefCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, -<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>),</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit DWARF info specifying the restores of the callee-saved registers.</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For epilogue with return inside or being other block without successor,</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// no need to generate .cfi&#95;restore for callee-saved registers.</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsDwarfCFI &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.succ&#95;empty())</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a6c1f3151b66ea2dfd6a8b9cef815d51c">emitCalleeSavedFrameMoves</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, AfterPop, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Terminator == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end() || !<a href="/docs/api/files/lib/lib/target/lib/target/m68k/m68kframelowering-cpp/#a8485a5e7c82a6e2b65a859701c4a6cb8">isTailCallOpcode</a>(Terminator-&gt;getOpcode())) &#123;</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the return addr area delta back since we are not tail calling.</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = -1 &#42; X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>();</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt;= 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;TCDelta should never be positive&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &#123;</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check for possible merge with preceding ADD instruction.</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4">mergeSPUpdates</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Terminator, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Terminator, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit tilerelease for AMX kernel.</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ac794820144c3b6fd6caaa134ea23675e">getAMXProgModel</a>() == <a href="/docs/api/namespaces/llvm/#a7a24c2247bd546fc56e2de6cfd04a3d7aa92628f81845096d30f91faafc41c043">AMXProgModelEnum::ManagedRA</a>)</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Terminator, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::TILERELEASE));</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635" lineLink="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/stackoffset">StackOffset</a> <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">X86FrameLowering::getFrameIndexReference</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">                                                     </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI,</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/register">Register</a> &amp;FrameReg)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFixed = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ae6e7e975f7a4e5d535be32068a7c67df">isFixedObjectIndex</a>(FI);</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t calculate offset from frame pointer if the stack is realigned,</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so enforce usage of stack/base pointer.  The base pointer is used when we</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have dynamic allocas in addition to dynamic realignment.</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasBasePointer(MF))</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">    FrameReg = IsFixed ? <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFramePtr() : <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getBaseRegister();</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF))</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">    FrameReg = IsFixed ? <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFramePtr() : <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getStackRegister();</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">    FrameReg = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Offset will hold the offset from the stack pointer at function entry to the</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// object.</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to factor in additional offsets applied during the prologue to the</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// frame, base, and stack pointer depending on which is used.</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#adf98860d7f42290f873c82a981eb0ea6">getObjectOffset</a>(FI) - <a href="/docs/api/classes/llvm/targetframelowering/#a6521d4d5560c03b2e6490883558b882c">getOffsetOfLocalArea</a>();</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CSSize = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad6e59a435273270b3ef84dc8a841c122">getCalleeSavedFrameSize</a>();</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">  uint64&#95;t StackSize = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a14c39a24bf6ebbe339ae8a453c7fdd11">getStackSize</a>();</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsWin64Prologue = MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afb72c5626afbc815284e2b26bb0663f8">getMCAsmInfo</a>()-&gt;<a href="/docs/api/classes/llvm/mcasminfo/#ac158349781823fe8ff9e02d3a3533d55">usesWindowsCFI</a>();</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">  int64&#95;t FPDelta = 0;</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In an x86 interrupt, remove the offset we added to account for the return</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// address from any stack object allocated in the caller&#39;s frame. Interrupts</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// do not have a standard return address. Fixed objects in the current frame,</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// such as SSE register spills, should not get this treatment.</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>() == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca765508a953368531a7d69d1279e6cfb1">CallingConv::X86&#95;INTR</a> &amp;&amp;</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt;= 0) &#123;</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/targetframelowering/#a6521d4d5560c03b2e6490883558b882c">getOffsetOfLocalArea</a>();</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsWin64Prologue) &#123;</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a2cc8bb867c8949943ca7d88f1db31fde">hasCalls</a>() || (StackSize % 16) == 8);</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Calculate required stack adjustment.</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">    uint64&#95;t FrameSize = StackSize - <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If required, include space for extra hidden slot for stashing base</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointer.</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aad8e7e85710893cb7fa03109a108a070">getRestoreBasePointer</a>())</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">      FrameSize += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">    uint64&#95;t NumBytes = FrameSize - CSSize;</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">    uint64&#95;t SEHFrameOffset = <a href="#a045c9bd8c547ec3f14eba7aedf55a044">calculateSetFPREG</a>(NumBytes);</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FI &amp;&amp; FI == X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7024c419adc3f16454faa53af71fb515">getFAIndex</a>())</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stackoffset/#a0775e5fb52ac148f4d06e7eedb34e94e">StackOffset::getFixed</a>(-SEHFrameOffset);</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FPDelta is the offset from the &quot;traditional&quot; FP location of the old base</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointer followed by return address and the location required by the</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// restricted Win64 prologue.</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add FPDelta to all offsets below that go through the frame pointer.</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">    FPDelta = FrameSize - SEHFrameOffset;</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a2cc8bb867c8949943ca7d88f1db31fde">hasCalls</a>() || (FPDelta % 16) == 0) &amp;&amp;</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;FPDelta isn&#39;t aligned per the Win64 ABI!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FrameReg == <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFramePtr()) &#123;</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip saved EBP/RBP</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Account for restricted Windows prologue.</span></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += FPDelta;</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip the RETADDR move area</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> TailCallReturnAddrDelta = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>();</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailCallReturnAddrDelta &lt; 0)</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> -= TailCallReturnAddrDelta;</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stackoffset/#a0775e5fb52ac148f4d06e7eedb34e94e">StackOffset::getFixed</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FrameReg is either the stack pointer or a base pointer. But the base is</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// located at the end of the statically known StackSize so the distinction</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// doesn&#39;t really matter.</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) || <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasBasePointer(MF))</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a25f1d7ccf87af8d87fcb950f7ed758b5">isAligned</a>(MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a8320a54de0a273478de910ac3795058b">getObjectAlign</a>(FI), -(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + StackSize)));</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stackoffset/#a0775e5fb52ac148f4d06e7eedb34e94e">StackOffset::getFixed</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + StackSize);</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718" lineLink="/docs/api/classes/llvm/x86framelowering/#acd3876e593314b23ed0679279ee31dfe"><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#acd3876e593314b23ed0679279ee31dfe">X86FrameLowering::getWin64EHFrameIndexRef</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI,</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/register">Register</a> &amp;FrameReg)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;WinEHXMMSlotInfo = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a9bbe23d1b534d969ab8244ae95a15bf7">getWinEHXMMSlotInfo</a>();</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> it = WinEHXMMSlotInfo.find(FI);</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (it == WinEHXMMSlotInfo.end())</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, FI, FrameReg).<a href="/docs/api/classes/llvm/stackoffset/#aeb11e994c5580c80bbb0951eb05f9c80">getFixed</a>();</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlight">  FrameReg = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getStackRegister();</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a41896492f62ee8d25cf8aaad70bd88aa">alignDown</a>(MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a4f335273c28b17552a7cfd802f42be2a">getMaxCallFrameSize</a>(), <a href="/docs/api/classes/llvm/targetframelowering/#a74d93035f53f5e8c2aaea5a8f307972d">getStackAlign</a>().value()) +</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">         it-&gt;second;</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/stackoffset">StackOffset</a></span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734" lineLink="/docs/api/classes/llvm/x86framelowering/#a79ebbed1ceecae3f74214e33fc8c533f"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/x86framelowering/#a79ebbed1ceecae3f74214e33fc8c533f">X86FrameLowering::getFrameIndexReferenceSP</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI,</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/register">Register</a> &amp;FrameReg,</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Adjustment)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">  FrameReg = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getStackRegister();</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stackoffset/#a0775e5fb52ac148f4d06e7eedb34e94e">StackOffset::getFixed</a>(MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#adf98860d7f42290f873c82a981eb0ea6">getObjectOffset</a>(FI) -</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/targetframelowering/#a6521d4d5560c03b2e6490883558b882c">getOffsetOfLocalArea</a>() + Adjustment);</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/stackoffset">StackOffset</a></span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744" lineLink="/docs/api/classes/llvm/x86framelowering/#afb20caf4eb8695705452f25d78a18a06"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/x86framelowering/#afb20caf4eb8695705452f25d78a18a06">X86FrameLowering::getFrameIndexReferencePreferSP</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlight">                                                 </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI, <a href="/docs/api/classes/llvm/register">Register</a> &amp;FrameReg,</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">                                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IgnoreSPUpdates)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Does not include any dynamic realign.</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t StackSize = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a14c39a24bf6ebbe339ae8a453c7fdd11">getStackSize</a>();</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LLVM arranges the stack as follows:</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ARG2</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ARG1</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   RETADDR</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   PUSH RBP   &lt;-- RBP points here</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   PUSH CSRs</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ~~~~~~~    &lt;-- possible stack realignment (non-win64)</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   STACK OBJECTS</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...        &lt;-- RSP after prologue points here</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ~~~~~~~    &lt;-- possible stack realignment (win64)</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if (hasVarSizedObjects()):</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...        &lt;-- &quot;base pointer&quot; (ESI/RBX) points here</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   DYNAMIC ALLOCAS</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...        &lt;-- RSP points here</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Case 1: In the simple case of no stack realignment and no dynamic</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocas, both &quot;fixed&quot; stack objects (arguments and CSRs) are addressable</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with fixed offsets from RSP.</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Case 2: In the case of stack realignment with no dynamic allocas, fixed</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack objects are addressed with RBP and regular stack objects with RSP.</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Case 3: In the case of dynamic allocas and stack realignment, RSP is used</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to address stack arguments for outgoing calls and nothing else. The &quot;base</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointer&quot; points to local variables, and RBP points to fixed objects.</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In cases 2 and 3, we can only answer for non-fixed stack objects, and the</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// answer we give is relative to the SP after the prologue, and not the</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SP in the middle of the function.</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ae6e7e975f7a4e5d535be32068a7c67df">isFixedObjectIndex</a>(FI) &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) &amp;&amp;</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">      !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64())</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, FI, FrameReg);</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If !hasReservedCallFrame the function might have SP adjustement in the</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// body.  So, even though the offset is statically known, it depends on where</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we are in the function.</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IgnoreSPUpdates &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#a6696e7a9f36d7983d3593e5f4a17831f">hasReservedCallFrame</a>(MF))</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, FI, FrameReg);</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t handle tail calls, and shouldn&#39;t be seeing them either.</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>() &gt;= 0 &amp;&amp;</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;we don&#39;t handle this case!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is how the math works out:</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %rsp grows (i.e. gets lower) left to right. Each box below is</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  one word (eight bytes).  Obj0 is the stack slot we&#39;re trying to</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  get to.</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    ----------------------------------</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    | BP | Obj0 | Obj1 | ... | ObjN |</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    ----------------------------------</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    ^    ^      ^                   ^</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    A    B      C                   E</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A is the incoming stack pointer.</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (B - A) is the local area offset (-8 for x86-64) &#91;1&#93;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (C - A) is the Offset returned by MFI.getObjectOffset for Obj0 &#91;2&#93;</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// |(E - B)| is the StackSize (absolute value, positive).  For a</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack that grown down, this works out to be (B - E). &#91;3&#93;</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// E is also the value of %rsp after stack has been set up, and we</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// want (C - E) -- the value we can add to %rsp to get to Obj0.  Now</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (C - E) == (C - A) - (B - A) + (B - E)</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//            &#123; Using &#91;1&#93;, &#91;2&#93; and &#91;3&#93; above &#125;</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         == getObjectOffset - LocalAreaOffset + StackSize</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a79ebbed1ceecae3f74214e33fc8c533f">getFrameIndexReferenceSP</a>(MF, FI, FrameReg, StackSize);</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826" lineLink="/docs/api/classes/llvm/x86framelowering/#a7c6fdca5f3b44d406ff07e43b2f140f6"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a7c6fdca5f3b44d406ff07e43b2f140f6">X86FrameLowering::assignCalleeSavedSpillSlots</a>(</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>,</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">    std::vector&lt;CalleeSavedInfo&gt; &amp;CSI)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CalleeSavedFrameSize = 0;</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> XMMCalleeSavedFrameSize = 0;</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;WinEHXMMSlotInfo = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a9bbe23d1b534d969ab8244ae95a15bf7">getWinEHXMMSlotInfo</a>();</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SpillSlotOffset = <a href="/docs/api/classes/llvm/targetframelowering/#a6521d4d5560c03b2e6490883558b882c">getOffsetOfLocalArea</a>() + X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>();</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><span class="doxyHighlight">  int64&#95;t TailCallReturnAddrDelta = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7c7a3251bd6c1b0b89e5712c89aaa305">getTCReturnAddrDelta</a>();</span></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailCallReturnAddrDelta &lt; 0) &#123;</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// create RETURNADDR area</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   arg</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   arg</span></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   RETADDR</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   &#123; ...</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     RETADDR area</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     ...</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   &#91;EBP&#93;</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">    MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a03cf34252938b54f7e86c736f9fd7dc1">CreateFixedObject</a>(-TailCallReturnAddrDelta,</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlight">                          TailCallReturnAddrDelta - <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Spill the BasePtr if it&#39;s used.</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (this-&gt;TRI-&gt;hasBasePointer(MF)) &#123;</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Allocate a spill slot for EBP if we have a base pointer and EH funclets.</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#ad40522ac860df72189255e38782acc3f">hasEHFunclets</a>()) &#123;</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a61960903871aa95a7161074c6f1eec8f">CreateSpillStackObject</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, <a href="/docs/api/structs/llvm/align">Align</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>));</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">      X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aaa40c0068f7a88682bc61cd9c56fede4">setHasSEHFramePtrSave</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">      X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#af98de3669b3b297736be7a9a77b5caf1">setSEHFramePtrSaveIndex</a>(FI);</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF)) &#123;</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// emitPrologue always spills frame register the first thing.</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">    SpillSlotOffset -= <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">    MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ad2270087c6b8d7061c3a5e83fb61c0a6">CreateFixedSpillStackObject</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, SpillSlotOffset);</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The async context lives directly before the frame pointer, and we</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// allocate a second slot to preserve stack alignment.</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>()) &#123;</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><span class="doxyHighlight">      SpillSlotOffset -= <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">      MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ad2270087c6b8d7061c3a5e83fb61c0a6">CreateFixedSpillStackObject</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, SpillSlotOffset);</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">      SpillSlotOffset -= <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Since emitPrologue and emitEpilogue will handle spilling and restoring of</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the frame register, we can delete it from CSI list and not have to worry</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// about avoiding it later.</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a1dd46e82704007e1b3b83ee229ffa79f">FPReg</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; CSI.size(); ++i) &#123;</span></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;regsOverlap(CSI&#91;i&#93;.getReg(), <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a1dd46e82704007e1b3b83ee229ffa79f">FPReg</a>)) &#123;</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">        CSI.erase(CSI.begin() + i);</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Strategy:</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 Use push2 when</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       a) number of CSR &gt; 1 if no need padding</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       b) number of CSR &gt; 2 if need padding</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 When the number of CSR push is odd</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    a. Start to use push2 from the 1st push if stack is 16B aligned.</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    b. Start to use push2 from the 2nd push if stack is not 16B aligned.</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3 When the number of CSR push is even, start to use push2 from the 1st</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    push and make the stack 16B aligned before the push</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumRegsForPush2 = 0;</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.hasPush2Pop2()) &#123;</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumCSGPR = <a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">llvm::count&#95;if</a>(CSI, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/calleesavedinfo">CalleeSavedInfo</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> X86::GR64RegClass.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getReg());</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedPadding = (SpillSlotOffset % 16 != 0) &amp;&amp; (NumCSGPR % 2 == 0);</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsePush2Pop2 = NeedPadding ? NumCSGPR &gt; 2 : NumCSGPR &gt; 1;</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlight">    X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a0920abec0037c0cd3eb296f505ffc187">setPadForPush2Pop2</a>(NeedPadding &amp;&amp; UsePush2Pop2);</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">    NumRegsForPush2 = UsePush2Pop2 ? <a href="/docs/api/namespaces/llvm/#a41896492f62ee8d25cf8aaad70bd88aa">alignDown</a>(NumCSGPR, 2) : 0;</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ae61044e0566a5eefd1fd0d2f1fd16805">padForPush2Pop2</a>()) &#123;</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlight">      SpillSlotOffset -= <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><span class="doxyHighlight">      MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ad2270087c6b8d7061c3a5e83fb61c0a6">CreateFixedSpillStackObject</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, SpillSlotOffset);</span></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assign slots for GPRs. It increases frame size.</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/calleesavedinfo">CalleeSavedInfo</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(CSI)) &#123;</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getReg();</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!X86::GR64RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg) &amp;&amp; !X86::GR32RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A CSR is a candidate for push2/pop2 when it&#39;s slot offset is 16B aligned</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or only an odd number of registers in the candidates.</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab47b5e1f45cd8a0fbdd840547e6517af">getNumCandidatesForPush2Pop2</a>() &lt; NumRegsForPush2 &amp;&amp;</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">        (SpillSlotOffset % 16 == 0 ||</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">         X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab47b5e1f45cd8a0fbdd840547e6517af">getNumCandidatesForPush2Pop2</a>() % 2))</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">      X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ad0cd3133a28b196d900d4a2fb49f19e2">addCandidateForPush2Pop2</a>(Reg);</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlight">    SpillSlotOffset -= <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">    CalleeSavedFrameSize += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/slotindex">SlotIndex</a> = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ad2270087c6b8d7061c3a5e83fb61c0a6">CreateFixedSpillStackObject</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, SpillSlotOffset);</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setFrameIdx(<a href="/docs/api/classes/llvm/slotindex">SlotIndex</a>);</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust the offset of spill slot as we know the accurate callee saved frame</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size.</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aad8e7e85710893cb7fa03109a108a070">getRestoreBasePointer</a>()) &#123;</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlight">    SpillSlotOffset -= <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlight">    CalleeSavedFrameSize += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">    MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ad2270087c6b8d7061c3a5e83fb61c0a6">CreateFixedSpillStackObject</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, SpillSlotOffset);</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: saving the slot index is better?</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlight">    X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a8109e774fb19e0ec57444aa577358ef4">setRestoreBasePointer</a>(CalleeSavedFrameSize);</span></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab47b5e1f45cd8a0fbdd840547e6517af">getNumCandidatesForPush2Pop2</a>() % 2 == 0 &amp;&amp;</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expect even candidates for push2/pop2&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab47b5e1f45cd8a0fbdd840547e6517af">getNumCandidatesForPush2Pop2</a>())</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">    ++NumFunctionUsingPush2Pop2;</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlight">  X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#af3682a96148f7c1e534dfa7c2726ccec">setCalleeSavedFrameSize</a>(CalleeSavedFrameSize);</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlight">  MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a5ed62fb6fd245cb4efd8ea1bb4d56856">setCVBytesOfCalleeSavedRegisters</a>(CalleeSavedFrameSize);</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assign slots for XMMs.</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/calleesavedinfo">CalleeSavedInfo</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(CSI)) &#123;</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getReg();</span></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::GR64RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg) || X86::GR32RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is k-register make sure we lookup via the largest legal type.</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mvt">MVT</a> VT = MVT::Other;</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::VK16RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><span class="doxyHighlight">      VT = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.hasBWI() ? MVT::v64i1 : MVT::v16i1;</span></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RC = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getMinimalPhysRegClass(Reg, VT);</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getSpillSize(&#42;RC);</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getSpillAlign(&#42;RC);</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ensure alignment</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SpillSlotOffset &lt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;SpillSlotOffset should always &lt; 0 on X86&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">    SpillSlotOffset = -<a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(-SpillSlotOffset, Alignment);</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// spill into slot</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">    SpillSlotOffset -= <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/slotindex">SlotIndex</a> = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ad2270087c6b8d7061c3a5e83fb61c0a6">CreateFixedSpillStackObject</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, SpillSlotOffset);</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setFrameIdx(<a href="/docs/api/classes/llvm/slotindex">SlotIndex</a>);</span></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">    MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a1f09e99062be1101e3a2cf3ff88878f7">ensureMaxAlignment</a>(Alignment);</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the start offset and size of XMM in stack frame for funclets.</span></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::VR128RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg)) &#123;</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlight">      WinEHXMMSlotInfo&#91;<a href="/docs/api/classes/llvm/slotindex">SlotIndex</a>&#93; = XMMCalleeSavedFrameSize;</span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlight">      XMMCalleeSavedFrameSize += <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984" lineLink="/docs/api/classes/llvm/x86framelowering/#afc942a637e5d48a94d4033498b7479dd"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#afc942a637e5d48a94d4033498b7479dd">X86FrameLowering::spillCalleeSavedRegisters</a>(</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;CalleeSavedInfo&gt;</a> CSI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.findDebugLoc(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t save CSRs in 32-bit EH funclets. The caller saves EBX, EBP, ESI, EDI</span></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for us, and there are no XMM CSRs on Win32.</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEHFuncletEntry() &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is32Bit() &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isOSWindows())</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Push GPRs. It increases frame size.</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ae61044e0566a5eefd1fd0d2f1fd16805">padForPush2Pop2</a>())</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -(int64&#95;t)<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update LiveIn of the basic block and decide whether we can add a kill flag</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the use.</span></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UpdateLiveInCheckCanKill = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/register">Register</a> Reg) &#123;</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>();</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not set a kill flag on values that are also marked as live-in. This</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// happens with the @llvm-returnaddress intrinsic and with arguments</span></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// passed in callee saved registers.</span></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Omitting the kill flags is conservatively correct even if the live-in</span></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is not used after all.</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.isLiveIn(Reg))</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.addLiveIn(Reg);</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if any subregister is live-in</span></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mcregaliasiterator">MCRegAliasIterator</a> AReg(Reg, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">); AReg.<a href="/docs/api/classes/llvm/mcregaliasiterator/#ac336c049c12ead7be5b86e6d046f8ab0">isValid</a>(); ++AReg)</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.isLiveIn(&#42;AReg))</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UpdateLiveInGetKillRegState = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/register">Register</a> Reg) &#123;</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#aac57d4100e9a9d02522fbd724568397d">getKillRegState</a>(UpdateLiveInCheckCanKill(Reg));</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RI = CSI.<a href="/docs/api/classes/llvm/arrayref/#aebe6da1ab4a07020669f3d6148c0b559">rbegin</a>(), RE = CSI.<a href="/docs/api/classes/llvm/arrayref/#a709f5d7f042648ec20197939d9a6805f">rend</a>(); RI != RE; ++RI) &#123;</span></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = RI-&gt;getReg();</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!X86::GR64RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg) &amp;&amp; !X86::GR32RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a2bfcb8851d30d4d3ac6b27a82e7f85f7">isCandidateForPush2Pop2</a>(Reg)) &#123;</span></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> Reg2 = (++RI)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/disassembler/mipsdisassembler-cpp/#a15b5b86944f6df97d2c3659d77f51f91">getReg</a>();</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#a2621d6b164bd8fb5ef4356154ea9b399">getPUSH2Opcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>)))</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Reg, UpdateLiveInGetKillRegState(Reg))</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Reg2, UpdateLiveInGetKillRegState(Reg2))</span></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#aef1cc59e277ff82741aa24e3e170ee04">getPUSHOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>)))</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Reg, UpdateLiveInGetKillRegState(Reg))</span></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aad8e7e85710893cb7fa03109a108a070">getRestoreBasePointer</a>()) &#123;</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit() ? X86::PUSH64r : X86::PUSH32r;</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> BaseReg = this-&gt;TRI-&gt;getBaseRegister();</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc))</span></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(BaseReg, <a href="/docs/api/namespaces/llvm/#aac57d4100e9a9d02522fbd724568397d">getKillRegState</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make XMM regs spilled. X86 does not have ability of push/pop XMM.</span></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It can be done by spilling XMMs to stack frame.</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/calleesavedinfo">CalleeSavedInfo</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(CSI)) &#123;</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getReg();</span></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::GR64RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg) || X86::GR32RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is k-register make sure we lookup via the largest legal type.</span></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mvt">MVT</a> VT = MVT::Other;</span></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::VK16RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><span class="doxyHighlight">      VT = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.hasBWI() ? MVT::v64i1 : MVT::v16i1;</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the callee-saved register as live-in. It&#39;s killed at the spill.</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.addLiveIn(Reg);</span></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RC = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getMinimalPhysRegClass(Reg, VT);</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.storeRegToStackSlot(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, Reg, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFrameIdx(), RC, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>,</span></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/register">Register</a>());</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><span class="doxyHighlight">    --<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;setFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><span class="doxyHighlight">    ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::emitCatchRetReturnValue(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;CatchRet)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SEH shouldn&#39;t use catchret.</span></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#ab9c9fb92464f96c0e0f326d624e82eab">isAsynchronousEHPersonality</a>(<a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent()-&gt;getFunction().getPersonalityFn())) &amp;&amp;</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;SEH should not use CATCHRET&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = CatchRet-&gt;<a href="/docs/api/classes/llvm/machineinstr/#abb10ef030fba4ea901518a0c8dbef3e2">getDebugLoc</a>();</span></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;CatchRetTarget = CatchRet-&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(0).<a href="/docs/api/classes/llvm/machineoperand/#a57e64b633278df75c699e6b98ce15031">getMBB</a>();</span></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fill EAX/RAX with the address of the target block.</span></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit()) &#123;</span></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// LEA64r CatchRetTarget(%rip), %rax</span></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>.get(X86::LEA64r), X86::RAX)</span></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RIP)</span></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(CatchRetTarget)</span></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0);</span></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MOV32ri $CatchRetTarget, %eax</span></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>.get(X86::MOV32ri), X86::EAX)</span></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(CatchRetTarget);</span></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record that we&#39;ve taken the address of CatchRetTarget and no longer just</span></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reference it in a terminator.</span></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><span class="doxyHighlight">  CatchRetTarget-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#af4236a9c3c028303d301f49c7ee9a868">setMachineBlockAddressTaken</a>();</span></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104" lineLink="/docs/api/classes/llvm/x86framelowering/#a94ed22ca5dc3213bfb96e1ddbc41952e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a94ed22ca5dc3213bfb96e1ddbc41952e">X86FrameLowering::restoreCalleeSavedRegisters</a>(</span></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mutablearrayref">MutableArrayRef&lt;CalleeSavedInfo&gt;</a> CSI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CSI.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</span></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64framelowering-cpp/#adee4182085538431c4a8cb7ffec54783">isFuncletReturnInstr</a>(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isOSWindows()) &#123;</span></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t restore CSRs in 32-bit EH funclets. Matches</span></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// spillCalleeSavedRegisters.</span></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is32Bit())</span></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t restore CSRs before an SEH catchret. SEH except blocks do not form</span></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// funclets. emitEpilogue transforms these to normal jumps.</span></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOpcode() == X86::CATCHRET) &#123;</span></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent()-&gt;getFunction();</span></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSEH = <a href="/docs/api/namespaces/llvm/#ab9c9fb92464f96c0e0f326d624e82eab">isAsynchronousEHPersonality</a>(</span></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getPersonalityFn()));</span></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSEH)</span></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.findDebugLoc(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reload XMMs from stack frame.</span></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/calleesavedinfo">CalleeSavedInfo</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : CSI) &#123;</span></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getReg();</span></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::GR64RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg) || X86::GR32RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is k-register make sure we lookup via the largest legal type.</span></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mvt">MVT</a> VT = MVT::Other;</span></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86::VK16RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><span class="doxyHighlight">      VT = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.hasBWI() ? MVT::v64i1 : MVT::v16i1;</span></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RC = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getMinimalPhysRegClass(Reg, VT);</span></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.loadRegFromStackSlot(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, Reg, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFrameIdx(), RC, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>,</span></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/register">Register</a>());</span></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clear the stack slot for spill base pointer register.</span></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aad8e7e85710893cb7fa03109a108a070">getRestoreBasePointer</a>()) &#123;</span></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit() ? X86::POP64r : X86::POP32r;</span></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> BaseReg = this-&gt;TRI-&gt;getBaseRegister();</span></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(Opc), BaseReg)</span></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// POP GPRs.</span></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CSI.<a href="/docs/api/classes/llvm/mutablearrayref/#aae2bf8b46988a2fc0589e95903930c19">begin</a>(), E = CSI.<a href="/docs/api/classes/llvm/mutablearrayref/#a9d959094f4544749c129c46034cbed67">end</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getReg();</span></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!X86::GR64RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg) &amp;&amp; !X86::GR32RegClass.<a href="/docs/api/files/lib/lib/sandboxir/value-cpp/#a34433c37334a1cde3d58cde3099257dd">contains</a>(Reg))</span></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a2bfcb8851d30d4d3ac6b27a82e7f85f7">isCandidateForPush2Pop2</a>(Reg))</span></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#ae299adbcf2ff9ecc484dc4b73d262eaa">getPOP2Opcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>)), Reg)</span></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>((++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/disassembler/mipsdisassembler-cpp/#a15b5b86944f6df97d2c3659d77f51f91">getReg</a>(), <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a72c17e2ff2d5af62a30e56ac152aa8d5">RegState::Define</a>)</span></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#abe688d8814460e4a62c6e50b82d1be9a">getPOPOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>)), Reg)</span></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::FrameDestroy</a>);</span></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ae61044e0566a5eefd1fd0d2f1fd16805">padForPush2Pop2</a>())</span></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174" lineLink="/docs/api/classes/llvm/x86framelowering/#a6cbb50454d9bb068f4ab6b2d08fb7abf"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a6cbb50454d9bb068f4ab6b2d08fb7abf">X86FrameLowering::determineCalleeSaves</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/bitvector">BitVector</a> &amp;SavedRegs,</span></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/regscavenger">RegScavenger</a> &#42;RS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetframelowering/#a2f26766f4dcfa6457ba405584a34d5c3">TargetFrameLowering::determineCalleeSaves</a>(MF, SavedRegs, RS);</span></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Spill the BasePtr if it&#39;s used.</span></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasBasePointer(MF)) &#123;</span></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> BasePtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getBaseRegister();</span></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32())</span></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><span class="doxyHighlight">      BasePtr = <a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(BasePtr, 64);</span></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><span class="doxyHighlight">    SavedRegs.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(BasePtr);</span></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188" lineLink="#ab29c5668ec7d2b12468b97aa33e5f87b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab29c5668ec7d2b12468b97aa33e5f87b">HasNestArgument</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42;MF) &#123;</span></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = MF-&gt;<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>();</span></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function/#ae8dcf6aa51ec5887c9c52c148535c021">Function::const&#95;arg&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.arg&#95;begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.arg&#95;end(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;</span></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</span></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasNestAttr() &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;use&#95;empty())</span></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><span class="doxyHighlightComment">/// GetScratchRegister - Get a temp register for performing work in the</span></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><span class="doxyHighlightComment">/// segmented stack and the Erlang/HiPE stack prologue. Depending on platform</span></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><span class="doxyHighlightComment">/// and the properties of the function either one or two registers will be</span></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><span class="doxyHighlightComment">/// needed. Set primary to true for the first register, false for the second.</span></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202" lineLink="#a1021e45de682ea397f9aa6c529ac80be"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a1021e45de682ea397f9aa6c529ac80be">GetScratchRegister</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Is64Bit, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLP64,</span></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><span class="doxyHighlight">                                   </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Primary) &#123;</span></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">CallingConv::ID</a> CallingConvention = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>();</span></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Erlang stuff.</span></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallingConvention == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca20ddc463f96d806f369d56205ea205f5">CallingConv::HiPE</a>) &#123;</span></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Is64Bit)</span></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Primary ? X86::R14 : X86::R13;</span></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Primary ? X86::EBX : X86::EDI;</span></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Is64Bit) &#123;</span></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsLP64)</span></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Primary ? X86::R11 : X86::R12;</span></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Primary ? X86::R11D : X86::R12D;</span></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNested = <a href="#ab29c5668ec7d2b12468b97aa33e5f87b">HasNestArgument</a>(&amp;MF);</span></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallingConvention == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafde87569738f9e23963e8735f71c33eb">CallingConv::X86&#95;FastCall</a> ||</span></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><span class="doxyHighlight">      CallingConvention == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cabc8e2ee40a84687a9e12fd08784b87ba">CallingConv::Fast</a> ||</span></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><span class="doxyHighlight">      CallingConvention == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">CallingConv::Tail</a>) &#123;</span></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNested)</span></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Segmented stacks does not support fastcall with &quot;</span></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;nested function.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Primary ? X86::EAX : X86::ECX;</span></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNested)</span></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Primary ? X86::EDX : X86::EAX;</span></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Primary ? X86::ECX : X86::EAX;</span></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><span class="doxyHighlightComment">// The stack limit in the TCB is set to this many bytes above the actual stack</span></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><span class="doxyHighlightComment">// limit.</span></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238" lineLink="#ad6f5455eb7ba6ed74cab551099d0a952"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t <a href="/docs/api/files/lib/lib/target/lib/target/arm/armframelowering-cpp/#ad6f5455eb7ba6ed74cab551099d0a952">kSplitStackAvailable</a> = 256;</span></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240" lineLink="/docs/api/classes/llvm/x86framelowering/#ac8faf9a625064bfefafb7ace646815ff"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#ac8faf9a625064bfefafb7ace646815ff">X86FrameLowering::adjustForSegmentedStacks</a>(</span></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;PrologueMBB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><span class="doxyHighlight">  uint64&#95;t StackSize;</span></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TlsReg, TlsOffset;</span></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// To support shrink-wrapping we would need to insert the new blocks</span></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// at the right place and update the branches to PrologueMBB.</span></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;(&#42;MF.<a href="/docs/api/classes/llvm/machinefunction/#ab0789854909cf47f640a85fa2bac29c7">begin</a>()) == &amp;PrologueMBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Shrink-wrapping not supported yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ScratchReg = <a href="#a1021e45de682ea397f9aa6c529ac80be">GetScratchRegister</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a>, MF, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>().<a href="/docs/api/classes/llvm/machineregisterinfo/#a640f34062e7189756ce67e60d5dfd629">isLiveIn</a>(ScratchReg) &amp;&amp;</span></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Scratch register is live-in&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#af457a58a84b500d44feb7b699aa43ec1">isVarArg</a>())</span></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Segmented stacks do not support vararg functions.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetLinux() &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDarwin() &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin32() &amp;&amp;</span></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><span class="doxyHighlight">      !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64() &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetFreeBSD() &amp;&amp;</span></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><span class="doxyHighlight">      !<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDragonFly())</span></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Segmented stacks not supported on this platform.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eventually StackSize will be calculated by a link-time pass; which will</span></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// also decide whether checking code needs to be injected into this particular</span></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// prologue.</span></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><span class="doxyHighlight">  StackSize = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a14c39a24bf6ebbe339ae8a453c7fdd11">getStackSize</a>();</span></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a00d2c6aab11836fcd2116ef07924253e">needsSplitStackProlog</a>())</span></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;allocMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>();</span></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;checkMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>();</span></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNested = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to know if the function has a nest argument only in 64 bit mode.</span></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>)</span></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><span class="doxyHighlight">    IsNested = <a href="#ab29c5668ec7d2b12468b97aa33e5f87b">HasNestArgument</a>(&amp;MF);</span></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The MOV R10, RAX needs to be in a different block, since the RET we emit in</span></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocMBB needs to be last (terminating) instruction.</span></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LI : PrologueMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a364ed6e68f92f797c0cd9e53ce5ea2a5">liveins</a>()) &#123;</span></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><span class="doxyHighlight">    allocMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(LI);</span></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><span class="doxyHighlight">    checkMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(LI);</span></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNested)</span></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><span class="doxyHighlight">    allocMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::R10 : X86::R10D);</span></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#a6a437bb3c4a44ac328344e5f361c7816">push&#95;front</a>(allocMBB);</span></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#a6a437bb3c4a44ac328344e5f361c7816">push&#95;front</a>(checkMBB);</span></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When the frame size is less than 256 we just compare the stack</span></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// boundary directly to the value of the stack pointer, per gcc.</span></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CompareStackPointer = StackSize &lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armframelowering-cpp/#ad6f5455eb7ba6ed74cab551099d0a952">kSplitStackAvailable</a>;</span></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Read the limit off the current stacklet off the stack&#95;guard location.</span></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>) &#123;</span></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetLinux()) &#123;</span></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><span class="doxyHighlight">      TlsReg = X86::FS;</span></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><span class="doxyHighlight">      TlsOffset = <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? 112 : 0x40;</span></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDarwin()) &#123;</span></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><span class="doxyHighlight">      TlsReg = X86::GS;</span></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><span class="doxyHighlight">      TlsOffset = 96 + 90 &#42; 8; </span><span class="doxyHighlightComment">// See pthread&#95;machdep.h. Steal TLS slot 90</span></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64()) &#123;</span></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><span class="doxyHighlight">      TlsReg = X86::GS;</span></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><span class="doxyHighlight">      TlsOffset = 0x28; </span><span class="doxyHighlightComment">// pvArbitrary, reserved for application use</span></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetFreeBSD()) &#123;</span></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><span class="doxyHighlight">      TlsReg = X86::FS;</span></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><span class="doxyHighlight">      TlsOffset = 0x18;</span></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDragonFly()) &#123;</span></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><span class="doxyHighlight">      TlsReg = X86::FS;</span></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><span class="doxyHighlight">      TlsOffset = 0x20; </span><span class="doxyHighlightComment">// use tls&#95;tcb.tcb&#95;segstack</span></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Segmented stacks not supported on this platform.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CompareStackPointer)</span></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><span class="doxyHighlight">      ScratchReg = <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::RSP : X86::ESP;</span></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::LEA64r : X86::LEA64&#95;32r),</span></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><span class="doxyHighlight">              ScratchReg)</span></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RSP)</span></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(-StackSize)</span></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0);</span></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::CMP64rm : X86::CMP32rm))</span></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ScratchReg)</span></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(TlsOffset)</span></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(TlsReg);</span></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetLinux()) &#123;</span></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><span class="doxyHighlight">      TlsReg = X86::GS;</span></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><span class="doxyHighlight">      TlsOffset = 0x30;</span></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDarwin()) &#123;</span></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><span class="doxyHighlight">      TlsReg = X86::GS;</span></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><span class="doxyHighlight">      TlsOffset = 72 + 90 &#42; 4;</span></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin32()) &#123;</span></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><span class="doxyHighlight">      TlsReg = X86::FS;</span></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><span class="doxyHighlight">      TlsOffset = 0x14; </span><span class="doxyHighlightComment">// pvArbitrary, reserved for application use</span></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDragonFly()) &#123;</span></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><span class="doxyHighlight">      TlsReg = X86::FS;</span></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><span class="doxyHighlight">      TlsOffset = 0x10; </span><span class="doxyHighlightComment">// use tls&#95;tcb.tcb&#95;segstack</span></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetFreeBSD()) &#123;</span></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Segmented stacks not supported on FreeBSD i386.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Segmented stacks not supported on this platform.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CompareStackPointer)</span></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><span class="doxyHighlight">      ScratchReg = X86::ESP;</span></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::LEA32r), ScratchReg)</span></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::ESP)</span></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(-StackSize)</span></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0);</span></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetLinux() || <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin32() || <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64() ||</span></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDragonFly()) &#123;</span></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CMP32rm))</span></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ScratchReg)</span></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(TlsOffset)</span></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(TlsReg);</span></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetDarwin()) &#123;</span></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TlsOffset doesn&#39;t fit into a mod r/m byte so we need an extra register.</span></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ScratchReg2;</span></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SaveScratch2;</span></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CompareStackPointer) &#123;</span></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The primary scratch register is available for holding the TLS offset.</span></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><span class="doxyHighlight">        ScratchReg2 = <a href="#a1021e45de682ea397f9aa6c529ac80be">GetScratchRegister</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a>, MF, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><span class="doxyHighlight">        SaveScratch2 = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Need to use a second register to hold the TLS offset</span></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><span class="doxyHighlight">        ScratchReg2 = <a href="#a1021e45de682ea397f9aa6c529ac80be">GetScratchRegister</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a>, MF, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Unfortunately, with fastcc the second scratch register may hold an</span></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// argument.</span></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><span class="doxyHighlight">        SaveScratch2 = MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>().<a href="/docs/api/classes/llvm/machineregisterinfo/#a640f34062e7189756ce67e60d5dfd629">isLiveIn</a>(ScratchReg2);</span></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If Scratch2 is live-in then it needs to be saved.</span></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>().<a href="/docs/api/classes/llvm/machineregisterinfo/#a640f34062e7189756ce67e60d5dfd629">isLiveIn</a>(ScratchReg2) || SaveScratch2) &amp;&amp;</span></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Scratch register is live-in and not saved&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SaveScratch2)</span></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH32r))</span></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ScratchReg2, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5a9ddde91ef09476d28a088fe57f8e2921">RegState::Kill</a>);</span></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV32ri), ScratchReg2)</span></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(TlsOffset);</span></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CMP32rm))</span></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ScratchReg)</span></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ScratchReg2)</span></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(1)</span></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(TlsReg);</span></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SaveScratch2)</span></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::POP32r), ScratchReg2);</span></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This jump is taken if SP &gt;= (Stacklet Limit + Stack Space required).</span></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It jumps to normal execution of the function body.</span></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(checkMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(&amp;PrologueMBB)</span></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eade92e2f17ca0acdd1ffa23d01df381df">X86::COND&#95;A</a>);</span></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// On 32 bit we first push the arguments size and then the frame size. On 64</span></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bit, we pass the stack frame size in r10 and the argument size in r11.</span></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>) &#123;</span></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Functions with nested arguments use R10, so it needs to be saved across</span></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the call to &#95;morestack</span></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RegAX = <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::RAX : X86::EAX;</span></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Reg10 = <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::R10 : X86::R10D;</span></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Reg11 = <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::R11 : X86::R11D;</span></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MOVrr = <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a> ? X86::MOV64rr : X86::MOV32rr;</span></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNested)</span></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(MOVrr), RegAX).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Reg10);</span></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#a39d0dcc2605f63349a774a79927b2209">getMOVriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a>, StackSize)), Reg10)</span></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(StackSize);</span></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#a39d0dcc2605f63349a774a79927b2209">getMOVriOpcode</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a>, X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a2e51353f9cba613d53a5c85b94f224b1">getArgumentStackSize</a>())),</span></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><span class="doxyHighlight">            Reg11)</span></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a2e51353f9cba613d53a5c85b94f224b1">getArgumentStackSize</a>());</span></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH32i))</span></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a2e51353f9cba613d53a5c85b94f224b1">getArgumentStackSize</a>());</span></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::PUSH32i)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(StackSize);</span></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;morestack is in libgcc</span></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#ae106f6c6362377b3016f0d174227e193">getCodeModel</a>() == <a href="/docs/api/namespaces/llvm/codemodel/#afc59396a9e5809fc92938e203d91a8dfa5208f558fccf9f63423fb5385bb3e75c">CodeModel::Large</a>) &#123;</span></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Under the large code model, we cannot assume that &#95;&#95;morestack lives</span></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// within 2^31 bytes of the call site, so we cannot use pc-relative</span></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// addressing. We cannot perform the call via a temporary register,</span></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as the rax register may be used to store the static chain, and all</span></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other suitable registers may be either callee-save or used for</span></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// parameter passing. We cannot use the stack at this point either</span></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// because &#95;&#95;morestack manipulates the stack directly.</span></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// To avoid these issues, perform an indirect call via a read-only memory</span></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// location containing the address.</span></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This solution is not perfect, as it assumes that the .rodata section</span></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is laid out within 2^31 bytes of each function body, but this seems</span></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to be sufficient for JIT.</span></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Add retpoline support and remove the error here..</span></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.useIndirectThunkCalls())</span></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Emitting morestack calls on 64-bit with the large &quot;</span></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;code model and thunks not yet implemented.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CALL64m))</span></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(X86::RIP)</span></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0)</span></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0)</span></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;morestack&#95;addr&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(0);</span></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>)</span></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CALL64pcrel32))</span></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;morestack&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::CALLpcrel32))</span></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;morestack&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNested)</span></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MORESTACK&#95;RET&#95;RESTORE&#95;R10));</span></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(allocMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MORESTACK&#95;RET));</span></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><span class="doxyHighlight">  allocMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(&amp;PrologueMBB);</span></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><span class="doxyHighlight">  checkMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(allocMBB, <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>());</span></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><span class="doxyHighlight">  checkMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(&amp;PrologueMBB, <a href="/docs/api/classes/llvm/branchprobability/#a56e1b2d1999aadf4c513caee1ce5275b">BranchProbability::getOne</a>());</span></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><span class="doxyHighlightPreprocessor">#ifdef EXPENSIVE&#95;CHECKS</span></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#a8efc9cbc802adc2bb2673b4ba6308869">verify</a>();</span></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><span class="doxyHighlightComment">/// Lookup an ERTS parameter in the !hipe.literals named metadata node.</span></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><span class="doxyHighlightComment">/// HiPE provides Erlang Runtime System-internal parameters, such as PCB offsets</span></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><span class="doxyHighlightComment">/// to fields it needs, through a named metadata node &quot;hipe.literals&quot; containing</span></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><span class="doxyHighlightComment">/// name-value pairs.</span></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501" lineLink="#ae2c3c56fbe514f4a3ee837a4af0499a8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#ae2c3c56fbe514f4a3ee837a4af0499a8">getHiPELiteral</a>(<a href="/docs/api/classes/llvm/namedmdnode">NamedMDNode</a> &#42;HiPELiteralsMD,</span></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> LiteralName) &#123;</span></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0, e = HiPELiteralsMD-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#acde8007e0e69969423e2de52343b702f">getNumOperands</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/classes/node">Node</a> = HiPELiteralsMD-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#aa24b566603d206b0e74bf63daf521078">getOperand</a>(i);</span></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/node">Node</a>-&gt;getNumOperands() != 2)</span></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdstring">MDString</a> &#42;NodeName = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDString&gt;</a>(<a href="/docs/api/classes/node">Node</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/valueasmetadata">ValueAsMetadata</a> &#42;NodeVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ValueAsMetadata&gt;</a>(<a href="/docs/api/classes/node">Node</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NodeName || !NodeVal)</span></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;ValConst = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ConstantInt&gt;</a>(NodeVal-&gt;<a href="/docs/api/classes/llvm/valueasmetadata/#af7494dfd1267d5300f4896c01a28ab71">getValue</a>());</span></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ValConst &amp;&amp; NodeName-&gt;<a href="/docs/api/classes/llvm/mdstring/#ae44259d9edd71181ea8b89d18f27a967">getString</a>() == LiteralName) &#123;</span></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ValConst-&gt;<a href="/docs/api/classes/llvm/constantint/#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>();</span></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;HiPE literal &quot;</span><span class="doxyHighlight"> + LiteralName +</span></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><span class="doxyHighlight">                     </span><span class="doxyHighlightStringLiteral">&quot; required but not provided&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><span class="doxyHighlightComment">// Return true if there are no non-ehpad successors to MBB and there are no</span></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><span class="doxyHighlightComment">// non-meta instructions between MBBI and MBB.end().</span></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523" lineLink="#ae31fe0327c2bb8a7d5cfbc532825e5a3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ae31fe0327c2bb8a7d5cfbc532825e5a3">blockEndIsUnreachable</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) &#123;</span></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(</span></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.successors(),</span></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><span class="doxyHighlight">             &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ) &#123; return Succ-&gt;isEHPad(); &#125;) &amp;&amp;</span></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><span class="doxyHighlight">         std::all&#95;of(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end(), &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><span class="doxyHighlight">           return MI.isMetaInstruction();</span></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><span class="doxyHighlight">         &#125;);</span></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><span class="doxyHighlightComment">/// Erlang programs may need a special prologue to handle the stack size they</span></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><span class="doxyHighlightComment">/// might need at runtime. That is because Erlang/OTP does not implement a C</span></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><span class="doxyHighlightComment">/// stack but uses a custom implementation of hybrid stack/heap architecture.</span></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><span class="doxyHighlightComment">/// (for more information see Eric Stenman&#39;s Ph.D. thesis:</span></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><span class="doxyHighlightComment">/// http://publications.uu.se/uu/fulltext/nbn&#95;se&#95;uu&#95;diva-2688.pdf)</span></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><span class="doxyHighlightComment">/// CheckStack:</span></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><span class="doxyHighlightComment">///       temp0 = sp - MaxStack</span></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><span class="doxyHighlightComment">///       if( temp0 &lt; SP&#95;LIMIT(P) ) goto IncStack else goto OldStart</span></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><span class="doxyHighlightComment">/// OldStart:</span></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><span class="doxyHighlightComment">///       ...</span></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><span class="doxyHighlightComment">/// IncStack:</span></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><span class="doxyHighlightComment">///       call inc&#95;stack   # doubles the stack space</span></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><span class="doxyHighlightComment">///       temp0 = sp - MaxStack</span></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"><span class="doxyHighlightComment">///       if( temp0 &lt; SP&#95;LIMIT(P) ) goto IncStack else goto OldStart</span></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548" lineLink="/docs/api/classes/llvm/x86framelowering/#afd992a2165073c9cea53128d5b6c4145"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#afd992a2165073c9cea53128d5b6c4145">X86FrameLowering::adjustForHiPEPrologue</a>(</span></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;PrologueMBB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// To support shrink-wrapping we would need to insert the new blocks</span></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// at the right place and update the branches to PrologueMBB.</span></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;(&#42;MF.<a href="/docs/api/classes/llvm/machinefunction/#ab0789854909cf47f640a85fa2bac29c7">begin</a>()) == &amp;PrologueMBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Shrink-wrapping not supported yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// HiPE-specific values</span></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/namedmdnode">NamedMDNode</a> &#42;HiPELiteralsMD =</span></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/module/#a06bb57eb1830a137e7b8f8b25908ed24">getNamedMetadata</a>(</span><span class="doxyHighlightStringLiteral">&quot;hipe.literals&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HiPELiteralsMD)</span></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t generate HiPE prologue without runtime parameters&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> HipeLeafWords = <a href="#ae2c3c56fbe514f4a3ee837a4af0499a8">getHiPELiteral</a>(</span></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><span class="doxyHighlight">      HiPELiteralsMD, <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? </span><span class="doxyHighlightStringLiteral">&quot;AMD64&#95;LEAF&#95;WORDS&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;X86&#95;LEAF&#95;WORDS&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CCRegisteredArgs = <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? 6 : 5;</span></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Guaranteed = HipeLeafWords &#42; <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CallerStkArity = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() &gt; CCRegisteredArgs</span></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><span class="doxyHighlight">                                ? MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - CCRegisteredArgs</span></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><span class="doxyHighlight">                                : 0;</span></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxStack = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a14c39a24bf6ebbe339ae8a453c7fdd11">getStackSize</a>() + CallerStkArity &#42; <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a> + <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetLinux() &amp;&amp;</span></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;HiPE prologue is only supported on Linux operating systems.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the largest caller&#39;s frame that is needed to fit the callees&#39;</span></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// frames. This &#39;MaxStack&#39; is computed from:</span></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a) the fixed frame size, which is the space needed for all spilled temps,</span></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// b) outgoing on-stack parameter areas, and</span></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// c) the minimum stack space this function needs to make available for the</span></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    functions it calls (a tunable ABI property).</span></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a2cc8bb867c8949943ca7d88f1db31fde">hasCalls</a>()) &#123;</span></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MoreStackForCalls = 0;</span></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCall())</span></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Get callee operand.</span></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(0);</span></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Only take account of global function calls (no closures etc.).</span></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.<a href="/docs/api/classes/llvm/machineoperand/#ab0d1155c8c38e84cbe387998fd2e517e">isGlobal</a>())</span></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(MO.<a href="/docs/api/classes/llvm/machineoperand/#a0fcdaab1a4c3134b8f80aa74cabeb970">getGlobal</a>());</span></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Do not update &#39;MaxStack&#39; for primitive and built-in functions</span></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// (encoded with names either starting with &quot;erlang.&quot;/&quot;bif&#95;&quot; or not</span></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// having a &quot;.&quot;, such as a simple &lt;Module&gt;.&lt;Function&gt;.&lt;Arity&gt;, or an</span></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// &quot;&#95;&quot;, such as the BIF &quot;suspend&#95;0&quot;) as they are executed on another</span></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// stack.</span></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName().contains(</span><span class="doxyHighlightStringLiteral">&quot;erlang.&quot;</span><span class="doxyHighlight">) || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName().contains(</span><span class="doxyHighlightStringLiteral">&quot;bif&#95;&quot;</span><span class="doxyHighlight">) ||</span></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName().find&#95;first&#95;of(</span><span class="doxyHighlightStringLiteral">&quot;.&#95;&quot;</span><span class="doxyHighlight">) == <a href="/docs/api/classes/llvm/stringref/#ad0f54a163ac500b144590640c6f1eb6b">StringRef::npos</a>)</span></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CalleeStkArity = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;size() &gt; CCRegisteredArgs</span></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><span class="doxyHighlight">                                      ? <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;size() - CCRegisteredArgs</span></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><span class="doxyHighlight">                                      : 0;</span></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HipeLeafWords - 1 &gt; CalleeStkArity)</span></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><span class="doxyHighlight">          MoreStackForCalls =</span></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><span class="doxyHighlight">              std::max(MoreStackForCalls,</span></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><span class="doxyHighlight">                       (HipeLeafWords - 1 - CalleeStkArity) &#42; <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>);</span></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><span class="doxyHighlight">    MaxStack += MoreStackForCalls;</span></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the stack frame needed is larger than the guaranteed then runtime checks</span></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and calls to &quot;inc&#95;stack&#95;0&quot; BIF should be inserted in the assembly prologue.</span></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxStack &gt; Guaranteed) &#123;</span></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;stackCheckMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>();</span></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;incStackMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>();</span></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LI : PrologueMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a364ed6e68f92f797c0cd9e53ce5ea2a5">liveins</a>()) &#123;</span></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><span class="doxyHighlight">      stackCheckMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(LI);</span></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><span class="doxyHighlight">      incStackMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acce9c12cc977a88dc7bc51493ce7681c">addLiveIn</a>(LI);</span></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><span class="doxyHighlight">    MF.<a href="/docs/api/classes/llvm/machinefunction/#a6a437bb3c4a44ac328344e5f361c7816">push&#95;front</a>(incStackMBB);</span></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><span class="doxyHighlight">    MF.<a href="/docs/api/classes/llvm/machinefunction/#a6a437bb3c4a44ac328344e5f361c7816">push&#95;front</a>(stackCheckMBB);</span></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ScratchReg, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a>, PReg, SPLimitOffset;</span></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LEAop, CMPop, CALLop;</span></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><span class="doxyHighlight">    SPLimitOffset = <a href="#ae2c3c56fbe514f4a3ee837a4af0499a8">getHiPELiteral</a>(HiPELiteralsMD, </span><span class="doxyHighlightStringLiteral">&quot;P&#95;NSP&#95;LIMIT&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>) &#123;</span></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a> = X86::RSP;</span></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><span class="doxyHighlight">      PReg = X86::RBP;</span></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><span class="doxyHighlight">      LEAop = X86::LEA64r;</span></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><span class="doxyHighlight">      CMPop = X86::CMP64rm;</span></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><span class="doxyHighlight">      CALLop = X86::CALL64pcrel32;</span></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a> = X86::ESP;</span></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><span class="doxyHighlight">      PReg = X86::EBP;</span></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><span class="doxyHighlight">      LEAop = X86::LEA32r;</span></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><span class="doxyHighlight">      CMPop = X86::CMP32rm;</span></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><span class="doxyHighlight">      CALLop = X86::CALLpcrel32;</span></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><span class="doxyHighlight">    ScratchReg = <a href="#a1021e45de682ea397f9aa6c529ac80be">GetScratchRegister</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a7761d9f26e6c0722ee9c9d8c5e052c1c">IsLP64</a>, MF, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>().<a href="/docs/api/classes/llvm/machineregisterinfo/#a640f34062e7189756ce67e60d5dfd629">isLiveIn</a>(ScratchReg) &amp;&amp;</span></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;HiPE prologue scratch register is live-in&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create new MBB for StackCheck:</span></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(stackCheckMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(LEAop), ScratchReg), <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a>,</span></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, -MaxStack);</span></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SPLimitOffset is in a fixed heap location (pointed by BP).</span></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(stackCheckMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(CMPop)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ScratchReg),</span></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><span class="doxyHighlight">                 PReg, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, SPLimitOffset);</span></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(stackCheckMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(&amp;PrologueMBB)</span></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eafeeb44274a14a14010dc990daecb39a0">X86::COND&#95;AE</a>);</span></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create new MBB for IncStack:</span></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(incStackMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(CALLop)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(</span><span class="doxyHighlightStringLiteral">&quot;inc&#95;stack&#95;0&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(incStackMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(LEAop), ScratchReg), <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvframelowering-cpp/#a0e92b710da2e75e063fee5f7efb8f21e">SPReg</a>,</span></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, -MaxStack);</span></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(incStackMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(CMPop)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ScratchReg),</span></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><span class="doxyHighlight">                 PReg, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, SPLimitOffset);</span></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(incStackMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::JCC&#95;1))</span></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(incStackMBB)</span></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(<a href="/docs/api/namespaces/llvm/x86/#a1a356a51a1fb4cc3c427599082cf1d2eae364c60967a7bc453d49caffc07d7bef">X86::COND&#95;LE</a>);</span></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><span class="doxyHighlight">    stackCheckMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(&amp;PrologueMBB, &#123;99, 100&#125;);</span></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><span class="doxyHighlight">    stackCheckMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(incStackMBB, &#123;1, 100&#125;);</span></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><span class="doxyHighlight">    incStackMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(&amp;PrologueMBB, &#123;99, 100&#125;);</span></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><span class="doxyHighlight">    incStackMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(incStackMBB, &#123;1, 100&#125;);</span></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><span class="doxyHighlightPreprocessor">#ifdef EXPENSIVE&#95;CHECKS</span></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#a8efc9cbc802adc2bb2673b4ba6308869">verify</a>();</span></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> X86FrameLowering::adjustStackWithPops(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt;= 0)</span></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> % <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>)</span></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> NumPops = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> / <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is only worth it if we have at most 2 pops.</span></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumPops != 1 &amp;&amp; NumPops != 2)</span></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle only the trivial case where the adjustment directly follows</span></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a call. This is the most common one, anyway.</span></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin())</span></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> Prev = std::prev(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Prev-&gt;isCall() || !Prev-&gt;getOperand(1).isRegMask())</span></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Regs&#91;2&#93;;</span></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FoundRegs = 0;</span></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent()-&gt;getRegInfo();</span></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;RegMask = Prev-&gt;getOperand(1);</span></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RegClass =</span></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#ab69c52bac76806c714de3de7674d8f31">Is64Bit</a> ? X86::GR64&#95;NOREX&#95;NOSPRegClass : X86::GR32&#95;NOREX&#95;NOSPRegClass;</span></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to find up to NumPops free registers.</span></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Candidate : RegClass) &#123;</span></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Poor man&#39;s liveness:</span></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Since we&#39;re immediately after a call, any register that is clobbered</span></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// by the call and not defined by it can be considered dead.</span></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RegMask.<a href="/docs/api/classes/llvm/machineoperand/#ae4ecf5483b94e2bb72967b80cc2008d2">clobbersPhysReg</a>(Candidate))</span></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t clobber reserved registers</span></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>.isReserved(Candidate))</span></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsDef = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : Prev-&gt;implicit&#95;operands()) &#123;</span></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isReg() &amp;&amp; MO.isDef() &amp;&amp;</span></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isSuperOrSubRegisterEq(MO.getReg(), Candidate)) &#123;</span></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><span class="doxyHighlight">        IsDef = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsDef)</span></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><span class="doxyHighlight">    Regs&#91;FoundRegs++&#93; = Candidate;</span></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FoundRegs == (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">)NumPops)</span></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FoundRegs == 0)</span></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we found only one free register, but need two, reuse the same one twice.</span></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (FoundRegs &lt; (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">)NumPops)</span></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><span class="doxyHighlight">    Regs&#91;FoundRegs++&#93; = Regs&#91;0&#93;;</span></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0; i &lt; NumPops; ++i)</span></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit() ? X86::POP64r : X86::POP32r),</span></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><span class="doxyHighlight">            Regs&#91;i&#93;);</span></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761" lineLink="/docs/api/classes/llvm/x86framelowering/#aa5f78769915f0742f77e73e45abab318"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/classes/llvm/x86framelowering/#aa5f78769915f0742f77e73e45abab318">X86FrameLowering::eliminateCallFramePseudoInstr</a>(</span></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> reserveCallFrame = <a href="/docs/api/classes/llvm/x86framelowering/#a6696e7a9f36d7983d3593e5f4a17831f">hasReservedCallFrame</a>(MF);</span></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</span></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isDestroy = Opcode == <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.getCallFrameDestroyOpcode();</span></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc(); </span><span class="doxyHighlightComment">// copy DebugLoc as I will be erased.</span></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><span class="doxyHighlight">  uint64&#95;t Amount = <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.getFrameSize(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><span class="doxyHighlight">  uint64&#95;t InternalAmt = (isDestroy || Amount) ? <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.getFrameAdjustment(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) : 0;</span></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.erase(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertPos = <a href="/docs/api/namespaces/llvm/#a5bacbbd03e9261f7b30dc174f26d680c">skipDebugInstructionsForward</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end());</span></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to avoid emitting dead SP adjustments if the block end is unreachable,</span></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// typically because the function is marked noreturn (abort, throw,</span></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assert&#95;fail, etc).</span></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isDestroy &amp;&amp; <a href="#ae31fe0327c2bb8a7d5cfbc532825e5a3">blockEndIsUnreachable</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!reserveCallFrame) &#123;</span></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the stack pointer can be changed after prologue, turn the</span></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// adjcallstackup instruction into a &#39;sub ESP, &lt;amt&gt;&#39; and the</span></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// adjcallstackdown instruction into &#39;add ESP, &lt;amt&gt;&#39;</span></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to keep the stack aligned properly.  To do this, we round the</span></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// amount of space needed for the outgoing arguments up to the next</span></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alignment boundary.</span></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><span class="doxyHighlight">    Amount = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(Amount, <a href="/docs/api/classes/llvm/targetframelowering/#a74d93035f53f5e8c2aaea5a8f307972d">getStackAlign</a>());</span></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>();</span></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> WindowsCFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afb72c5626afbc815284e2b26bb0663f8">getMCAsmInfo</a>()-&gt;<a href="/docs/api/classes/llvm/mcasminfo/#ac158349781823fe8ff9e02d3a3533d55">usesWindowsCFI</a>();</span></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84ab4fe87e4046ecd1f9f3d96bbf63822b3">DwarfCFI</a> = !WindowsCFI &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#a4f117e439113383ea819a6f7beb8ff0b">needsFrameMoves</a>();</span></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have any exception handlers in this function, and we adjust</span></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the SP before calls, we may need to indicate this to the unwinder</span></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// using GNU&#95;ARGS&#95;SIZE. Note that this may be necessary even when</span></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Amount == 0, because the preceding function may have set a non-0</span></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// GNU&#95;ARGS&#95;SIZE.</span></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: We don&#39;t need to reset this between subsequent functions,</span></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if it didn&#39;t change.</span></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDwarfEHHandlers = !WindowsCFI &amp;&amp; !MF.<a href="/docs/api/classes/llvm/machinefunction/#aa3fd81545fc9f10418752ee043f8645f">getLandingPads</a>().empty();</span></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasDwarfEHHandlers &amp;&amp; !isDestroy &amp;&amp;</span></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><span class="doxyHighlight">        MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ae14195edab055f9809a0349de0be5cce">getHasPushSequences</a>())</span></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, InsertPos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#a2097ca045c7251b81f97c5fc3efdcfc8">MCCFIInstruction::createGnuArgsSize</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Amount));</span></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Amount == 0)</span></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Factor out the amount that gets handled inside the sequence</span></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (Pushes of argument for frame setup, callee pops for frame destroy)</span></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><span class="doxyHighlight">    Amount -= InternalAmt;</span></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: This is needed only if we require precise CFA.</span></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a callee-pop calling convention, emit a CFA adjust for</span></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the amount the callee popped.</span></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isDestroy &amp;&amp; InternalAmt &amp;&amp; <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84ab4fe87e4046ecd1f9f3d96bbf63822b3">DwarfCFI</a> &amp;&amp; !<a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF))</span></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, InsertPos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/mccfiinstruction/#ad6a85756410e7929f561fc1454069563">MCCFIInstruction::createAdjustCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, -InternalAmt));</span></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add Amount to SP to destroy a frame, or subtract to setup.</span></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><span class="doxyHighlight">    int64&#95;t StackAdjustment = isDestroy ? Amount : -Amount;</span></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StackAdjustment) &#123;</span></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Merge with any previous or following adjustment instruction. Note: the</span></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instructions merged with here do not have CFI, so their stack</span></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// adjustments do not feed into CfaAdjustment.</span></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><span class="doxyHighlight">      StackAdjustment += <a href="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4">mergeSPUpdates</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, InsertPos, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><span class="doxyHighlight">      StackAdjustment += <a href="/docs/api/classes/llvm/x86framelowering/#af1d6349ca67f14c36e41916e41536da4">mergeSPUpdates</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, InsertPos, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StackAdjustment) &#123;</span></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasMinSize() &amp;&amp;</span></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><span class="doxyHighlight">              adjustStackWithPops(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, InsertPos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, StackAdjustment)))</span></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><span class="doxyHighlight">          BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, InsertPos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, StackAdjustment,</span></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><span class="doxyHighlight">                               </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84ab4fe87e4046ecd1f9f3d96bbf63822b3">DwarfCFI</a> &amp;&amp; !<a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF)) &#123;</span></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we don&#39;t have FP, but need to generate unwind information,</span></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we need to set the correct CFA offset after the stack adjustment.</span></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// How much we adjust the CFA offset depends on whether we&#39;re emitting</span></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// CFI only for EH purposes or for debugging. EH only requires the CFA</span></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// offset to be correct at each call site, while for debugging we want</span></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it to be more precise.</span></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><span class="doxyHighlight">      int64&#95;t CfaAdjustment = -StackAdjustment;</span></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: When not using precise CFA, we also need to adjust for the</span></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// InternalAmt here.</span></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CfaAdjustment) &#123;</span></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(</span></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, InsertPos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/mccfiinstruction/#ad6a85756410e7929f561fc1454069563">MCCFIInstruction::createAdjustCfaOffset</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, CfaAdjustment));</span></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InternalAmt) &#123;</span></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> CI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin();</span></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> &amp;&amp; !std::prev(CI)-&gt;isCall())</span></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><span class="doxyHighlight">      --CI;</span></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><span class="doxyHighlight">    BuildStackAdjustment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, CI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -InternalAmt, </span><span class="doxyHighlightComment">/&#42;InEpilogue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870"></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871" lineLink="/docs/api/classes/llvm/x86framelowering/#a652c5c131aaf585181fb0ff722781118"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a652c5c131aaf585181fb0ff722781118">X86FrameLowering::canUseAsPrologue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Block is not attached to a function!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isLiveIn(X86::EFLAGS))</span></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If stack probes have to loop inline or call, that will clobber EFLAGS.</span></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: we could allow cases that will use emitStackProbeInlineGenericBlock.</span></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a> &amp;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/x86subtarget">X86Subtarget</a>&gt;();</span></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86targetlowering">X86TargetLowering</a> &amp;TLI = &#42;<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.getTargetLowering();</span></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TLI.hasInlineStackProbe(MF) || TLI.hasStackProbeSymbol(MF))</span></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) &amp;&amp; !X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>();</span></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888" lineLink="/docs/api/classes/llvm/x86framelowering/#aae24f16623a7d1df7b850c55694e9d27"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#aae24f16623a7d1df7b850c55694e9d27">X86FrameLowering::canUseAsEpilogue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Block is not attached to a function!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Win64 has strict requirements in terms of epilogue and we are</span></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not taking a chance at messing with them.</span></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// I.e., unless this block is already an exit block, we can&#39;t use</span></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it as an epilogue.</span></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin64() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.succ&#95;empty() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isReturnBlock())</span></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Swift async context epilogue has a BTR instruction that clobbers parts of</span></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// EFLAGS.</span></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aa92686e5bcf4b22006a54652f92254df">hasSwiftAsyncContext</a>())</span></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="#a63bd353ca84282a830d803a6bf9e4c5e">flagsNeedToBePreservedBeforeTheTerminators</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#ad7e593e787ba6a94dbd287c32abe4006">canUseLEAForSPInEpilogue</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent()))</span></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906"></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we cannot use LEA to adjust SP, we may need to use ADD, which</span></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// clobbers the EFLAGS. Check that we do not need to preserve it,</span></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// otherwise, conservatively assume this is not</span></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// safe to insert the epilogue here.</span></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="#a63bd353ca84282a830d803a6bf9e4c5e">flagsNeedToBePreservedBeforeTheTerminators</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914" lineLink="/docs/api/classes/llvm/x86framelowering/#a7e24606b8fe6124decedb17e5ffa405e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a7e24606b8fe6124decedb17e5ffa405e">X86FrameLowering::enableShrinkWrapping</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we may need to emit frameless compact unwind information, give</span></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// up as this is currently broken: PR25614.</span></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CompactUnwind =</span></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#a752546c51633c140d9ca4ab98b4781b6">getContext</a>().<a href="/docs/api/classes/llvm/mccontext/#a01d6d82d18a5da901c50a546932c4264">getObjectFileInfo</a>()-&gt;<a href="/docs/api/classes/llvm/mcobjectfileinfo/#aff8632a15d42e54c1367a81afc1b6602">getCompactUnwindSection</a>() != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::NoUnwind) || <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF) ||</span></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><span class="doxyHighlight">          !CompactUnwind) &amp;&amp;</span></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><span class="doxyHighlight">         </span><span class="doxyHighlightComment">// The lowering of segmented stack and HiPE only support entry</span></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><span class="doxyHighlight">         </span><span class="doxyHighlightComment">// blocks as prologue blocks: PR26107. This limitation may be</span></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923"><span class="doxyHighlight">         </span><span class="doxyHighlightComment">// lifted if we fix:</span></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><span class="doxyHighlight">         </span><span class="doxyHighlightComment">// - adjustForSegmentedStacks</span></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><span class="doxyHighlight">         </span><span class="doxyHighlightComment">// - adjustForHiPEPrologue</span></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><span class="doxyHighlight">         MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>() != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca20ddc463f96d806f369d56205ea205f5">CallingConv::HiPE</a> &amp;&amp;</span></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"><span class="doxyHighlight">         !MF.<a href="/docs/api/classes/llvm/machinefunction/#ab499fb31e894a900402d0871eee39b75">shouldSplitStack</a>();</span></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930" lineLink="/docs/api/classes/llvm/x86framelowering/#a535388ac574e0f8d844662d315997b3d"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/classes/llvm/x86framelowering/#a535388ac574e0f8d844662d315997b3d">X86FrameLowering::restoreWin32EHStackPointers</a>(</span></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>,</span></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RestoreSP)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWindowsMSVC() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;funclets only supported in MSVC env&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTargetWin32() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;EBP/ESI restoration only required on win32&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is32Bit() &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#abb804392ca8368795013f2e5dc001ee2">Uses64BitFramePtr</a> &amp;&amp;</span></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;restoring EBP/ESI on non-32-bit target&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent();</span></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> BasePtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getBaseRegister();</span></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/winehfuncinfo">WinEHFuncInfo</a> &amp;FuncInfo = &#42;MF.<a href="/docs/api/classes/llvm/machinefunction/#a11cf771f7f11ea4fdacdbd5420371172">getWinEHFuncInfo</a>();</span></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Don&#39;t set FrameSetup flag in catchret case.</span></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = FuncInfo.EHRegNodeFrameIndex;</span></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> EHRegSize = MFI.getObjectSize(FI);</span></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RestoreSP) &#123;</span></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MOV32rm -EHRegSize(%ebp), %esp</span></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV32rm), X86::ESP),</span></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><span class="doxyHighlight">                 X86::EBP, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, -EHRegSize)</span></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956"></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> UsedReg;</span></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> EHRegOffset = <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, FI, UsedReg).<a href="/docs/api/classes/llvm/stackoffset/#aeb11e994c5580c80bbb0951eb05f9c80">getFixed</a>();</span></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> EndOffset = -EHRegOffset - EHRegSize;</span></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><span class="doxyHighlight">  FuncInfo.EHRegNodeEndOffset = EndOffset;</span></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedReg == <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>) &#123;</span></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ADD $offset, %ebp</span></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ADDri = <a href="#a1ecf75331d34e66af2a1ecb91a339090">getADDriOpcode</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(ADDri), <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>)</span></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(EndOffset)</span></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>)</span></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><span class="doxyHighlight">        -&gt;<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(3)</span></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineoperand/#a61a42c85bd86c6ca4554e27d33c3f798">setIsDead</a>();</span></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndOffset &gt;= 0 &amp;&amp;</span></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;end of registration object above normal EBP position!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedReg == BasePtr) &#123;</span></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// LEA offset(%ebp), %esi</span></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::LEA32r), BasePtr),</span></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, EndOffset)</span></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MOV32rm SavedEBPOffset(%esi), %ebp</span></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a8ed3059d287792eb8e73780ac551e918">getHasSEHFramePtrSave</a>());</span></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> =</span></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/x86framelowering/#a84fbe17f451c957c67de546c98f2b79b">getFrameIndexReference</a>(MF, X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a75b0fbc272791b1c8f9acaa3564abddb">getSEHFramePtrSaveIndex</a>(), UsedReg)</span></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/stackoffset/#aeb11e994c5580c80bbb0951eb05f9c80">getFixed</a>();</span></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UsedReg == BasePtr);</span></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a752b9dfb94f917a9e494fc4ed8cb6208">addRegOffset</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV32rm), <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>),</span></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><span class="doxyHighlight">                 UsedReg, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a632680dcf899466c32c0095a40e7e89e">setMIFlag</a>(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;32-bit frames with WinEH must use FramePtr or BasePtr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993" lineLink="/docs/api/classes/llvm/x86framelowering/#a5f9f26d96deb10d0d3b394fe12e2b0f5"><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a5f9f26d96deb10d0d3b394fe12e2b0f5">X86FrameLowering::getInitialCFAOffset</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getSlotSize();</span></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996"></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/register">Register</a></span></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998" lineLink="/docs/api/classes/llvm/x86framelowering/#abac406e51bd21d4da6eb9762f2f36df6"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/x86framelowering/#abac406e51bd21d4da6eb9762f2f36df6">X86FrameLowering::getInitialCFARegister</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>;</span></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/targetframelowering/dwarfframebase">TargetFrameLowering::DwarfFrameBase</a></span></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003" lineLink="/docs/api/classes/llvm/x86framelowering/#aca49f4bdff5eb8f32e4b650f33d6f98e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/x86framelowering/#aca49f4bdff5eb8f32e4b650f33d6f98e">X86FrameLowering::getDwarfFrameBase</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;RI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#a43c530c830206ecf5ad3359364634c75">getRegisterInfo</a>();</span></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> FrameRegister = RI-&gt;<a href="/docs/api/classes/llvm/targetregisterinfo/#aefb3b77455d0e0f2e1e8b56604c63c0c">getFrameRegister</a>(MF);</span></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#abac406e51bd21d4da6eb9762f2f36df6">getInitialCFARegister</a>(MF) == FrameRegister &amp;&amp;</span></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a7aec3b56c5a4ee2489363834a3b6ca99">hasCFIAdjustCfa</a>()) &#123;</span></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targetframelowering/dwarfframebase">DwarfFrameBase</a> FrameBase;</span></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><span class="doxyHighlight">    FrameBase.<a href="/docs/api/structs/llvm/targetframelowering/dwarfframebase/#ab9d82d53acc347a5ab75ea59da93c298">Kind</a> = DwarfFrameBase::CFA;</span></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><span class="doxyHighlight">    FrameBase.<a href="/docs/api/structs/llvm/targetframelowering/dwarfframebase/#a82acb7f3bcf1d1f621a2afbcc936e85b">Location</a>.<a href="/docs/api/structs/llvm/targetframelowering/dwarfframebase/#a0f3e9e851be1c3d4d7276752c0c2d330">Offset</a> =</span></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><span class="doxyHighlight">        -MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>().<a href="/docs/api/classes/llvm/machineframeinfo/#a14c39a24bf6ebbe339ae8a453c7fdd11">getStackSize</a>() - <a href="/docs/api/classes/llvm/x86framelowering/#a5f9f26d96deb10d0d3b394fe12e2b0f5">getInitialCFAOffset</a>(MF);</span></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FrameBase;</span></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetframelowering/dwarfframebase">DwarfFrameBase</a>&#123;DwarfFrameBase::Register, &#123;FrameRegister&#125;&#125;;</span></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018" lineLink="/docs/api/namespaces/anonymous-x86framelowering-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><span class="doxyHighlightComment">// Struct used by orderFrameObjects to help sort the stack objects.</span></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject">X86FrameSortingObject</a> &#123;</span></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#a6737e591c015571f3c938c4a28e16354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#a6737e591c015571f3c938c4a28e16354">IsValid</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;             </span><span class="doxyHighlightComment">// true if we care about this Object.</span></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#aa0332712911e5a7f078a096647d2ea8d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#aa0332712911e5a7f078a096647d2ea8d">ObjectIndex</a> = 0;         </span><span class="doxyHighlightComment">// Index of Object into MFI list.</span></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#afaac64eeb0dd06d8c9c554b814de9e0a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#afaac64eeb0dd06d8c9c554b814de9e0a">ObjectSize</a> = 0;          </span><span class="doxyHighlightComment">// Size of Object in bytes.</span></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#ae91c6bbcc0f99ad44f39be523066b801"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#ae91c6bbcc0f99ad44f39be523066b801">ObjectAlignment</a> = <a href="/docs/api/structs/llvm/align">Align</a>(1); </span><span class="doxyHighlightComment">// Alignment of Object in bytes.</span></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#ac90fef00f2a9a8d67a65fa937a546667"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject/#ac90fef00f2a9a8d67a65fa937a546667">ObjectNumUses</a> = 0;       </span><span class="doxyHighlightComment">// Object static number of uses.</span></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"><span class="doxyHighlightComment">// The comparison function we use for std::sort to order our local</span></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029"><span class="doxyHighlightComment">// stack symbols. The current algorithm is to use an estimated</span></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"><span class="doxyHighlightComment">// &quot;density&quot;. This takes into consideration the size and number of</span></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031"><span class="doxyHighlightComment">// uses each object has in order to roughly minimize code size.</span></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><span class="doxyHighlightComment">// So, for example, an object of size 16B that is referenced 5 times</span></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><span class="doxyHighlightComment">// will get higher priority than 4 4B objects referenced 1 time each.</span></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><span class="doxyHighlightComment">// It&#39;s not perfect and we may be able to squeeze a few more bytes out of</span></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><span class="doxyHighlightComment">// it (for example : 0(esp) requires fewer bytes, symbols allocated at the</span></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><span class="doxyHighlightComment">// fringe end can have special consideration, given their size is less</span></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><span class="doxyHighlightComment">// important, etc.), but the algorithmic complexity grows too much to be</span></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><span class="doxyHighlightComment">// worth the extra gains we get. This gets us pretty close.</span></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><span class="doxyHighlightComment">// The final order leaves us with objects with highest priority going</span></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"><span class="doxyHighlightComment">// at the end of our list.</span></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingcomparator"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingcomparator">X86FrameSortingComparator</a> &#123;</span></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042" lineLink="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingcomparator/#aa40e5377007cb04e6d574ee076ecff22"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingcomparator/#aa40e5377007cb04e6d574ee076ecff22">operator()</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject">X86FrameSortingObject</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</span></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-x86framelowering-cpp-/x86framesortingobject">X86FrameSortingObject</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"><span class="doxyHighlight">    uint64&#95;t DensityAScaled, DensityBScaled;</span></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045"></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For consistency in our comparison, all invalid objects are placed</span></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// at the end. This also allows us to stop walking when we hit the</span></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// first invalid item after it&#39;s all sorted.</span></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.IsValid)</span></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.IsValid)</span></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053"></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The density is calculated by doing :</span></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     (double)DensityA = A.ObjectNumUses / A.ObjectSize</span></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     (double)DensityB = B.ObjectNumUses / B.ObjectSize</span></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Since this approach may cause inconsistencies in</span></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the floating point &lt;, &gt;, == comparisons, depending on the floating</span></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// point model with which the compiler was built, we&#39;re going</span></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to scale both sides by multiplying with</span></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A.ObjectSize &#42; B.ObjectSize. This ends up factoring away</span></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the division and, with it, the need for any floating point</span></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// arithmetic.</span></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><span class="doxyHighlight">    DensityAScaled = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">uint64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.ObjectNumUses) &#42;</span></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">uint64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.ObjectSize);</span></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><span class="doxyHighlight">    DensityBScaled = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">uint64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.ObjectNumUses) &#42;</span></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">uint64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.ObjectSize);</span></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the two densities are equal, prioritize highest alignment</span></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// objects. This allows for similar alignment objects</span></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to be packed together (given the same density).</span></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There&#39;s room for improvement here, also, since we can pack</span></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// similar alignment (different density) objects next to each</span></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other to save padding. This will also require further</span></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// complexity/iterations, and the overall gain isn&#39;t worth it,</span></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in general. Something to keep in mind, though.</span></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DensityAScaled == DensityBScaled)</span></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.ObjectAlignment &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.ObjectAlignment;</span></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DensityAScaled &lt; DensityBScaled;</span></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"><span class="doxyHighlightComment">// Order the symbols in the local stack.</span></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><span class="doxyHighlightComment">// We want to place the local stack objects in some sort of sensible order.</span></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><span class="doxyHighlightComment">// The heuristic we use is to try and pack them according to static number</span></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"><span class="doxyHighlightComment">// of uses and size of object in order to minimize code size.</span></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089" lineLink="/docs/api/classes/llvm/x86framelowering/#adee8390bf727c3086a7b864de6c6913e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#adee8390bf727c3086a7b864de6c6913e">X86FrameLowering::orderFrameObjects</a>(</span></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;int&gt;</a> &amp;ObjectsToAllocate)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t waste time if there&#39;s nothing to do.</span></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ObjectsToAllocate.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create an array of all MFI objects. We won&#39;t need all of these</span></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// objects, but we&#39;re going to create a full array of them to make</span></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it easier to index into when we&#39;re counting &quot;uses&quot; down below.</span></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to be able to easily/cheaply access an object by simply</span></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// indexing into it, instead of having to search for it every time.</span></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102"><span class="doxyHighlight">  std::vector&lt;X86FrameSortingObject&gt; SortingObjects(MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ac51e2d34abb79b72afef355fac525c76">getObjectIndexEnd</a>());</span></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the objects we care about and mark them as such in our working</span></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// struct.</span></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Obj : ObjectsToAllocate) &#123;</span></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><span class="doxyHighlight">    SortingObjects&#91;Obj&#93;.IsValid = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><span class="doxyHighlight">    SortingObjects&#91;Obj&#93;.ObjectIndex = Obj;</span></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><span class="doxyHighlight">    SortingObjects&#91;Obj&#93;.ObjectAlignment = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a8320a54de0a273478de910ac3795058b">getObjectAlign</a>(Obj);</span></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set the size.</span></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ObjectSize = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(Obj);</span></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ObjectSize == 0)</span></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Variable size. Just use 4</span></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><span class="doxyHighlight">      SortingObjects&#91;Obj&#93;.ObjectSize = 4;</span></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><span class="doxyHighlight">      SortingObjects&#91;Obj&#93;.ObjectSize = ObjectSize;</span></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Count the number of uses for each object.</span></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr())</span></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Check to see if it&#39;s a local stack symbol.</span></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isFI())</span></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Index = MO.getIndex();</span></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Check to see if it falls within our range, and is tagged</span></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to require ordering.</span></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Index &gt;= 0 &amp;&amp; Index &lt; MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ac51e2d34abb79b72afef355fac525c76">getObjectIndexEnd</a>() &amp;&amp;</span></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><span class="doxyHighlight">            SortingObjects&#91;Index&#93;.IsValid)</span></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><span class="doxyHighlight">          SortingObjects&#91;Index&#93;.ObjectNumUses++;</span></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort the objects using X86FrameSortingAlgorithm (see its comment for</span></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// info).</span></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(SortingObjects, X86FrameSortingComparator());</span></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now modify the original list to represent the final order that</span></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we want. The order will depend on whether we&#39;re going to access them</span></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from the stack pointer or the frame pointer. For SP, the list should</span></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// end up with the END containing objects that we want with smaller offsets.</span></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For FP, it should be flipped.</span></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0;</span></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Obj : SortingObjects) &#123;</span></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All invalid items are sorted at the end, so it&#39;s safe to stop.</span></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Obj.IsValid)</span></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><span class="doxyHighlight">    ObjectsToAllocate&#91;i++&#93; = Obj.ObjectIndex;</span></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Flip it if we&#39;re accessing off of the FP.</span></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasStackRealignment(MF) &amp;&amp; <a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF))</span></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><span class="doxyHighlight">    std::reverse(ObjectsToAllocate.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), ObjectsToAllocate.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"><span class="doxyHighlightKeywordType">unsigned</span></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161" lineLink="/docs/api/classes/llvm/x86framelowering/#ac7b381a1c38101d4e17121c7b993e00c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/x86framelowering/#ac7b381a1c38101d4e17121c7b993e00c">X86FrameLowering::getWinEHParentFrameOffset</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// RDX, the parent frame pointer, is homed into 16(%rsp) in the prologue.</span></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 16;</span></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// RBP is immediately pushed.</span></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All callee-saved registers are then pushed.</span></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;()-&gt;getCalleeSavedFrameSize();</span></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Every funclet allocates enough stack space for the largest outgoing call.</span></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += getWinEHFuncletFrameSize(MF);</span></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173" lineLink="/docs/api/classes/llvm/x86framelowering/#a6a8d1523f211998978b3fa0bfe8818a1"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a6a8d1523f211998978b3fa0bfe8818a1">X86FrameLowering::processFunctionBeforeFrameFinalized</a>(</span></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/regscavenger">RegScavenger</a> &#42;RS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark the function as not having WinCFI. We will set it back to true in</span></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// emitPrologue if it gets called and emits CFI.</span></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#a330afa0baf556056f9c032480dd57347">setHasWinCFI</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are using Windows x64 CFI, ensure that the stack is always 8 byte</span></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// aligned. The format doesn&#39;t support misaligned stack adjustments.</span></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afb72c5626afbc815284e2b26bb0663f8">getMCAsmInfo</a>()-&gt;<a href="/docs/api/classes/llvm/mcasminfo/#ac158349781823fe8ff9e02d3a3533d55">usesWindowsCFI</a>())</span></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><span class="doxyHighlight">    MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>().<a href="/docs/api/classes/llvm/machineframeinfo/#a1f09e99062be1101e3a2cf3ff88878f7">ensureMaxAlignment</a>(<a href="/docs/api/structs/llvm/align">Align</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>));</span></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this function isn&#39;t doing Win64-style C++ EH, we don&#39;t need to do</span></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// anything.</span></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is64Bit() &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#ad40522ac860df72189255e38782acc3f">hasEHFunclets</a>() &amp;&amp;</span></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a6f77e4e800ba4dffd63e8ddb330062aa">getPersonalityFn</a>()) ==</span></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aab34bedfd8d86f0adbefe4ae0e708f428">EHPersonality::MSVC&#95;CXX</a>) &#123;</span></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><span class="doxyHighlight">    adjustFrameForMsvcCxxEh(MF);</span></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::adjustFrameForMsvcCxxEh(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Win64 C++ EH needs to allocate the UnwindHelp object at some fixed offset</span></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// relative to RSP after the prologue.  Find the offset of the last fixed</span></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// object, so that we can allocate a slot immediately following it. If there</span></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// were no fixed objects, use offset -SlotSize, which is immediately after the</span></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return address. Fixed objects have negative frame indices.</span></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/winehfuncinfo">WinEHFuncInfo</a> &amp;EHInfo = &#42;MF.<a href="/docs/api/classes/llvm/machinefunction/#a11cf771f7f11ea4fdacdbd5420371172">getWinEHFuncInfo</a>();</span></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><span class="doxyHighlight">  int64&#95;t MinFixedObjOffset = -<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#ae70474766f2a88bab5b2b77bcb22212b">getObjectIndexBegin</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; 0; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><span class="doxyHighlight">    MinFixedObjOffset = std::min(MinFixedObjOffset, MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#adf98860d7f42290f873c82a981eb0ea6">getObjectOffset</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehtryblockmapentry">WinEHTryBlockMapEntry</a> &amp;TBME : EHInfo.<a href="/docs/api/structs/llvm/winehfuncinfo/#a704147adbd0b4b79d33d444f76e8617c">TryBlockMap</a>) &#123;</span></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehhandlertype">WinEHHandlerType</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a> : TBME.<a href="/docs/api/structs/llvm/winehtryblockmapentry/#a203f60eaca27055d5b7395fca270037e">HandlerArray</a>) &#123;</span></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FrameIndex = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex;</span></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FrameIndex != INT&#95;MAX) &#123;</span></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Ensure alignment.</span></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/align">Align</a> = MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a8320a54de0a273478de910ac3795058b">getObjectAlign</a>(FrameIndex).<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>();</span></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><span class="doxyHighlight">        MinFixedObjOffset -= std::abs(MinFixedObjOffset) % <a href="/docs/api/structs/llvm/align">Align</a>;</span></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><span class="doxyHighlight">        MinFixedObjOffset -= MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(FrameIndex);</span></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><span class="doxyHighlight">        MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a3cd29e7edbcaceb5834eaa7d089a5bc4">setObjectOffset</a>(FrameIndex, MinFixedObjOffset);</span></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure alignment.</span></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><span class="doxyHighlight">  MinFixedObjOffset -= std::abs(MinFixedObjOffset) % 8;</span></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><span class="doxyHighlight">  int64&#95;t UnwindHelpOffset = MinFixedObjOffset - <a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>;</span></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> UnwindHelpFI =</span></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><span class="doxyHighlight">      MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a03cf34252938b54f7e86c736f9fd7dc1">CreateFixedObject</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a>, UnwindHelpOffset, </span><span class="doxyHighlightComment">/&#42;IsImmutable=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><span class="doxyHighlight">  EHInfo.<a href="/docs/api/structs/llvm/winehfuncinfo/#a297243a501424b3f88e1295034db122d">UnwindHelpFrameIdx</a> = UnwindHelpFI;</span></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Store -2 into UnwindHelp on function entry. We have to scan forwards past</span></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other frame setup instructions.</span></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"><span class="doxyHighlight">  MachineBasicBlock &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#ac8ca28de0f4dcee651340e7ef0c45233">front</a>();</span></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>))</span></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"><span class="doxyHighlight">    ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#ab622d694b5fcb0edb99159f1ebdcdb6b">findDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</span></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a3e8b1da7820b3f19cfb702d4312410ce">addFrameReference</a>(<a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(X86::MOV64mi32)),</span></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><span class="doxyHighlight">                    UnwindHelpFI)</span></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(-2);</span></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238" lineLink="/docs/api/classes/llvm/x86framelowering/#af7d9e67f21b6a4968a6074b082944dc6"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#af7d9e67f21b6a4968a6074b082944dc6">X86FrameLowering::processFunctionBeforeFrameIndicesReplaced</a>(</span></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/regscavenger">RegScavenger</a> &#42;RS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.is32Bit() &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#ad40522ac860df72189255e38782acc3f">hasEHFunclets</a>())</span></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#afc0900cd962cd955b2b6de25731710f5">restoreWinEHStackPointersInParent</a>(MF);</span></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have emitted prolog and epilog. Don&#39;t need stack pointer saving</span></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction any more.</span></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#ab35a2bbb33b7a14cf05c24b429e2f593">getStackPtrSaveMI</a>()) &#123;</span></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><span class="doxyHighlight">    X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#aefa6fd7c14db84eada72c79be21b2ad5">setStackPtrSaveMI</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252" lineLink="/docs/api/classes/llvm/x86framelowering/#afc0900cd962cd955b2b6de25731710f5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#afc0900cd962cd955b2b6de25731710f5">X86FrameLowering::restoreWinEHStackPointersInParent</a>(</span></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 32-bit functions have to restore stack pointers when control is transferred</span></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// back to the parent function. These blocks are identified as eh pads that</span></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are not funclet entries.</span></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSEH = <a href="/docs/api/namespaces/llvm/#ab9c9fb92464f96c0e0f326d624e82eab">isAsynchronousEHPersonality</a>(</span></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a6f77e4e800ba4dffd63e8ddb330062aa">getPersonalityFn</a>()));</span></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsRestore = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEHPad() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEHFuncletEntry();</span></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsRestore)</span></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#a535388ac574e0f8d844662d315997b3d">restoreWin32EHStackPointers</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin(), <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>(),</span></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><span class="doxyHighlight">                                  </span><span class="doxyHighlightComment">/&#42;RestoreSP=&#42;/</span><span class="doxyHighlight">IsSEH);</span></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><span class="doxyHighlightComment">// Compute the alignment gap between current SP after spilling FP/BP and the</span></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><span class="doxyHighlightComment">// next properly aligned stack offset.</span></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269" lineLink="#a88b438423c0bb502e843c7dae099b7f4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="#a88b438423c0bb502e843c7dae099b7f4">computeFPBPAlignmentGap</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><span class="doxyHighlight">                                   </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterclass">TargetRegisterClass</a> &#42;RC,</span></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"><span class="doxyHighlight">                                   </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSpilledRegs) &#123;</span></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#a43c530c830206ecf5ad3359364634c75">getRegisterInfo</a>();</span></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AllocSize = <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;getSpillSize(&#42;RC) &#42; NumSpilledRegs;</span></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> StackAlign = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#ac83b44e69c9f9f4f9d60be2d72f4a5df">getFrameLowering</a>()-&gt;<a href="/docs/api/classes/llvm/targetframelowering/#a74d93035f53f5e8c2aaea5a8f307972d">getStackAlign</a>();</span></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AlignedSize = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(AllocSize, StackAlign);</span></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AlignedSize - AllocSize;</span></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::spillFPBPUsingSP(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> BeforeMI,</span></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, <a href="/docs/api/classes/llvm/register">Register</a> BP,</span></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SPAdjust)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>.isValid() || BP.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>());</span></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><span class="doxyHighlight">  MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = BeforeMI-&gt;getParent();</span></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = BeforeMI-&gt;getDebugLoc();</span></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Spill FP.</span></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>.isValid()) &#123;</span></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BeforeMI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#aef1cc59e277ff82741aa24e3e170ee04">getPUSHOpcode</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;())))</span></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>);</span></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Spill BP.</span></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BP.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BeforeMI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#aef1cc59e277ff82741aa24e3e170ee04">getPUSHOpcode</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;())))</span></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(BP);</span></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure SP is aligned.</span></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SPAdjust)</span></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BeforeMI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, -SPAdjust, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit unwinding information.</span></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>.isValid() &amp;&amp; needsDwarfCFI(MF)) &#123;</span></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit .cfi&#95;remember&#95;state to remember old frame.</span></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CFIIndex =</span></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><span class="doxyHighlight">        MF.<a href="/docs/api/classes/llvm/machinefunction/#a247230f547064b27022d70c0aeb86682">addFrameInst</a>(<a href="/docs/api/classes/llvm/mccfiinstruction/#a8c6c95634a9db9cd0fc23175a01afd80">MCCFIInstruction::createRememberState</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BeforeMI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(TargetOpcode::CFI&#95;INSTRUCTION))</span></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><span class="doxyHighlight">        .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a3e4e67777edb24fac492ef4ae15e69ba">addCFIIndex</a>(CFIIndex);</span></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Setup new CFA value with DW&#95;CFA&#95;def&#95;cfa&#95;expression:</span></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     DW&#95;OP&#95;breg7+offset, DW&#95;OP&#95;deref, DW&#95;OP&#95;consts 16, DW&#95;OP&#95;plus</span></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><span class="doxyHighlight">    SmallString&lt;64&gt; CfaExpr;</span></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"><span class="doxyHighlight">    uint8&#95;t buffer&#91;16&#93;;</span></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = SPAdjust;</span></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BP.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>())</span></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getSpillSize(&#42;<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getMinimalPhysRegClass(BP));</span></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If BeforeMI is a frame setup instruction, we need to adjust the position</span></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and offset of the new cfi instruction.</span></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.isFrameSetup(&#42;BeforeMI)) &#123;</span></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.getFrameSize(&#42;BeforeMI), <a href="/docs/api/classes/llvm/targetframelowering/#a74d93035f53f5e8c2aaea5a8f307972d">getStackAlign</a>());</span></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><span class="doxyHighlight">      BeforeMI = std::next(BeforeMI);</span></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getStackRegister();</span></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32())</span></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a> = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, 64));</span></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DwarfStackPtr = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getDwarfRegNum(<a href="/docs/api/classes/llvm/x86framelowering/#ab7147559f9c35cbab44e96ecc2408c90">StackPtr</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>((uint8&#95;t)(dwarf::DW&#95;OP&#95;breg0 + DwarfStackPtr));</span></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ac21006e81ffbbc79e8e51e44f7878053">encodeSLEB128</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, buffer));</span></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(dwarf::DW&#95;OP&#95;deref);</span></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(dwarf::DW&#95;OP&#95;consts);</span></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ac21006e81ffbbc79e8e51e44f7878053">encodeSLEB128</a>(<a href="/docs/api/classes/llvm/x86framelowering/#a926474da108c2083d64a3a03742677ae">SlotSize</a> &#42; 2, buffer));</span></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><span class="doxyHighlight">    CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>((uint8&#95;t)dwarf::DW&#95;OP&#95;plus);</span></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><span class="doxyHighlight">    SmallString&lt;64&gt; DefCfaExpr;</span></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><span class="doxyHighlight">    DefCfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(dwarf::DW&#95;CFA&#95;def&#95;cfa&#95;expression);</span></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><span class="doxyHighlight">    DefCfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(buffer, buffer + <a href="/docs/api/namespaces/llvm/#ac21006e81ffbbc79e8e51e44f7878053">encodeSLEB128</a>(CfaExpr.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(), buffer));</span></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><span class="doxyHighlight">    DefCfaExpr.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(CfaExpr.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>());</span></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aef0079a40a972f2942156b2d73bbf190">BuildCFI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BeforeMI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/mccfiinstruction/#ac6eb36207cf2c7ebbd9a67e63dcc5568">MCCFIInstruction::createEscape</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DefCfaExpr.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>()),</span></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::FrameSetup</a>);</span></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::restoreFPBPUsingSP(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> AfterMI,</span></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, <a href="/docs/api/classes/llvm/register">Register</a> BP,</span></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SPAdjust)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>.isValid() || BP.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>());</span></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust SP so it points to spilled FP or BP.</span></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><span class="doxyHighlight">  MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = AfterMI-&gt;getParent();</span></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> Pos = std::next(AfterMI);</span></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = AfterMI-&gt;getDebugLoc();</span></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SPAdjust)</span></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86framelowering/#aa8a605a58ebdee20705834400bdbb922">emitSPUpdate</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SPAdjust, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Restore BP.</span></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BP.<a href="/docs/api/classes/llvm/register/#a7407603b3efcdc8d4c2b76697be34528">isValid</a>()) &#123;</span></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#abe688d8814460e4a62c6e50b82d1be9a">getPOPOpcode</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;())), BP);</span></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Restore FP.</span></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>.isValid()) &#123;</span></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(<a href="#abe688d8814460e4a62c6e50b82d1be9a">getPOPOpcode</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;X86Subtarget&gt;())), <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>);</span></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit unwinding information.</span></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (needsDwarfCFI(MF)) &#123;</span></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Restore original frame with .cfi&#95;restore&#95;state.</span></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CFIIndex =</span></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"><span class="doxyHighlight">          MF.<a href="/docs/api/classes/llvm/machinefunction/#a247230f547064b27022d70c0aeb86682">addFrameInst</a>(<a href="/docs/api/classes/llvm/mccfiinstruction/#ae2bed50736717b1120a41c6dcc41428f">MCCFIInstruction::createRestoreState</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.get(TargetOpcode::CFI&#95;INSTRUCTION))</span></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a3e4e67777edb24fac492ef4ae15e69ba">addCFIIndex</a>(CFIIndex);</span></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::saveAndRestoreFPBPUsingSP(</span></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> BeforeMI,</span></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> AfterMI, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SpillFP, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SpillBP)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SpillFP || SpillBP);</span></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, BP;</span></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetRegisterClass &#42;RC;</span></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumRegs = 0;</span></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SpillFP) &#123;</span></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32())</span></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a> = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, 64));</span></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><span class="doxyHighlight">    RC = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getMinimalPhysRegClass(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>);</span></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><span class="doxyHighlight">    ++NumRegs;</span></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SpillBP) &#123;</span></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><span class="doxyHighlight">    BP = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getBaseRegister();</span></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#afeee4b43efe13447f760c28d545fe653">STI</a>.isTarget64BitILP32())</span></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><span class="doxyHighlight">      BP = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a>(<a href="/docs/api/namespaces/llvm/#a27b344a283e0620f484144889fe32064">getX86SubSuperRegister</a>(BP, 64));</span></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><span class="doxyHighlight">    RC = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getMinimalPhysRegClass(BP);</span></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><span class="doxyHighlight">    ++NumRegs;</span></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SPAdjust = <a href="#a88b438423c0bb502e843c7dae099b7f4">computeFPBPAlignmentGap</a>(MF, RC, NumRegs);</span></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><span class="doxyHighlight">  spillFPBPUsingSP(MF, BeforeMI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, BP, SPAdjust);</span></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><span class="doxyHighlight">  restoreFPBPUsingSP(MF, AfterMI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, BP, SPAdjust);</span></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> X86FrameLowering::skipSpillFPBP(</span></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOpcode() == X86::LCMPXCHG16B&#95;SAVE&#95;RBX) &#123;</span></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The pseudo instruction LCMPXCHG16B&#95;SAVE&#95;RBX is generated in the form</span></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     SaveRbx = COPY RBX</span></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     SaveRbx = LCMPXCHG16B&#95;SAVE&#95;RBX ..., SaveRbx, implicit-def rbx</span></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// And later LCMPXCHG16B&#95;SAVE&#95;RBX is expanded to restore RBX from SaveRbx.</span></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We should skip this instruction sequence.</span></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI;</span></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>;</span></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOpcode() == TargetOpcode::COPY &amp;&amp;</span></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(1).getReg() == X86::RBX) &amp;&amp;</span></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><span class="doxyHighlight">           !((<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.isStoreToStackSlot(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, FI)) &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> == X86::RBX))</span></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431" lineLink="#a63e534b2d2892aadaa791d48b0397c74"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a63e534b2d2892aadaa791d48b0397c74">isFPBPAccess</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, <a href="/docs/api/classes/llvm/register">Register</a> BP,</span></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;AccessFP,</span></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;AccessBP) &#123;</span></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><span class="doxyHighlight">  AccessFP = AccessBP = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>) &#123;</span></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.findRegisterUseOperandIdx(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) != -1 ||</span></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.findRegisterDefOperandIdx(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) != -1)</span></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><span class="doxyHighlight">      AccessFP = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BP) &#123;</span></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.findRegisterUseOperandIdx(BP, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) != -1 ||</span></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.findRegisterDefOperandIdx(BP, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) != -1)</span></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><span class="doxyHighlight">      AccessBP = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AccessFP || AccessBP;</span></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><span class="doxyHighlightComment">// Invoke instruction has been lowered to normal function call. We try to figure</span></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><span class="doxyHighlightComment">// out if MI comes from Invoke.</span></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><span class="doxyHighlightComment">// Do we have any better method?</span></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451" lineLink="#acc62a034274e2d51b819c39b96de48dd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#acc62a034274e2d51b819c39b96de48dd">isInvoke</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InsideEHLabels) &#123;</span></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCall())</span></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InsideEHLabels)</span></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent();</span></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;hasEHPadSuccessor())</span></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if there is another call instruction from MI to the end of MBB.</span></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, ME = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != ME; ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>)</span></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;isCall())</span></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><span class="doxyHighlightComment">/// Given the live range of FP or BP (DefMI, KillMI), check if there is any</span></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><span class="doxyHighlightComment">/// interfered stack access in the range, usually generated by register spill.</span></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> X86FrameLowering::checkInterferedAccess(</span></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>,</span></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a> KillMI, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SpillFP,</span></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SpillBP)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> == KillMI)</span></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasBasePointer(MF)) &#123;</span></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SpillBP)</span></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SpillFP)</span></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = KillMI;</span></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>) &#123;</span></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;operands(),</span></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><span class="doxyHighlight">               &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MachineOperand &amp;MO) &#123; return MO.isFI(); &#125;))</span></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#a752546c51633c140d9ca4ab98b4781b6">getContext</a>().<a href="/docs/api/classes/llvm/mccontext/#aac3107671801e6bb16ef896f382759cd">reportError</a>(SMLoc(),</span></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;Interference usage of base pointer/frame &quot;</span></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;pointer.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>++;</span></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><span class="doxyHighlightComment">/// If a function uses base pointer and the base pointer is clobbered by inline</span></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><span class="doxyHighlightComment">/// asm, RA doesn&#39;t detect this case, and after the inline asm, the base pointer</span></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><span class="doxyHighlightComment">/// contains garbage value.</span></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><span class="doxyHighlightComment">/// For example if a 32b x86 function uses base pointer esi, and esi is</span></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><span class="doxyHighlightComment">/// clobbered by following inline asm</span></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><span class="doxyHighlightComment">///     asm(&quot;rep movsb&quot; : &quot;+D&quot;(ptr), &quot;+S&quot;(x), &quot;+c&quot;(c)::&quot;memory&quot;);</span></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><span class="doxyHighlightComment">/// We need to save esi before the asm and restore it after the asm.</span></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><span class="doxyHighlightComment">/// The problem can also occur to frame pointer if there is a function call, and</span></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><span class="doxyHighlightComment">/// the callee uses a different calling convention and clobbers the fp.</span></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><span class="doxyHighlightComment">/// Because normal frame objects (spill slots) are accessed through fp/bp</span></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><span class="doxyHighlightComment">/// register, so we can&#39;t spill fp/bp to normal spill slots.</span></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"><span class="doxyHighlightComment">/// FIXME: There are 2 possible enhancements:</span></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><span class="doxyHighlightComment">/// 1 In many cases there are different physical registers not clobbered by</span></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><span class="doxyHighlightComment">/// inline asm, we can use one of them as base pointer. Or use a virtual</span></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><span class="doxyHighlightComment">/// register as base pointer and let RA allocate a physical register to it.</span></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><span class="doxyHighlightComment">/// 2 If there is no other instructions access stack with fp/bp from the</span></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><span class="doxyHighlightComment">/// inline asm to the epilog, and no cfi requirement for a correct fp, we can</span></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><span class="doxyHighlightComment">/// skip the save and restore operations.</span></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517" lineLink="/docs/api/classes/llvm/x86framelowering/#a068e9d1fd54621ae340f26c41d170a1a"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/x86framelowering/#a068e9d1fd54621ae340f26c41d170a1a">X86FrameLowering::spillFPBP</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, BP;</span></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetframelowering/#a6a6d31b2f1e5754f5824c5dec555eeac">TargetFrameLowering</a> &amp;TFI = &#42;MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#ac83b44e69c9f9f4f9d60be2d72f4a5df">getFrameLowering</a>();</span></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TFI.<a href="/docs/api/classes/llvm/targetframelowering/#a0c361440fb8d1e36932e65c8cc8497e7">hasFP</a>(MF))</span></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a> = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getFrameRegister(MF);</span></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;hasBasePointer(MF))</span></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><span class="doxyHighlight">    BP = <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>-&gt;getBaseRegister();</span></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Currently only inline asm and function call can clobbers fp/bp. So we can</span></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// do some quick test and return early.</span></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MF.<a href="/docs/api/classes/llvm/machinefunction/#a4070e578614e01d4c3f4aae3df10304c">hasInlineAsm</a>()) &#123;</span></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a> &#42;X86FI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo">X86MachineFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a43bece9f74d59569cf44bfa0cd162496">getFPClobberedByCall</a>())</span></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a> = 0;</span></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!X86FI-&gt;<a href="/docs/api/classes/llvm/x86machinefunctioninfo/#a9f3bec55d4dcb107b606a8ff918f7567">getBPClobberedByCall</a>())</span></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><span class="doxyHighlight">      BP = 0;</span></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a> &amp;&amp; !BP)</span></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InsideEHLabels = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.rbegin(), ME = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.rend();</span></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TermMI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getFirstTerminator();</span></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TermMI == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin())</span></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = &#42;(std::prev(TermMI));</span></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME) &#123;</span></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip frame setup/destroy instructions.</span></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip Invoke (call inside try block) instructions.</span></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip instructions handled by target.</span></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a78f1067d270179dff7915b90a03ce237">MachineInstr::MIFlag::FrameSetup</a>) ||</span></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4e4e6764dc61dbf0e8f330644880480f">MachineInstr::MIFlag::FrameDestroy</a>) ||</span></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><span class="doxyHighlight">          <a href="#acc62a034274e2d51b819c39b96de48dd">isInvoke</a>(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, InsideEHLabels) || skipSpillFPBP(MF, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</span></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOpcode() == TargetOpcode::EH&#95;LABEL) &#123;</span></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><span class="doxyHighlight">        InsideEHLabels = !InsideEHLabels;</span></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AccessFP, AccessBP;</span></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if fp or bp is used in MI.</span></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a63e534b2d2892aadaa791d48b0397c74">isFPBPAccess</a>(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, BP, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, AccessFP, AccessBP)) &#123;</span></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Look for the range &#91;DefMI, KillMI&#93; in which fp or bp is defined and</span></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// used.</span></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FPLive = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, BPLive = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SpillFP = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, SpillBP = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, KillMI = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><span class="doxyHighlight">        SpillFP |= AccessFP;</span></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><span class="doxyHighlight">        SpillBP |= AccessBP;</span></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Maintain FPLive and BPLive.</span></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FPLive &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;findRegisterDefOperandIdx(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) != -1)</span></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><span class="doxyHighlight">          FPLive = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a> &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;findRegisterUseOperandIdx(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) != -1)</span></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><span class="doxyHighlight">          FPLive = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BPLive &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;findRegisterDefOperandIdx(BP, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) != -1)</span></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><span class="doxyHighlight">          BPLive = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BP &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;findRegisterUseOperandIdx(BP, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) != -1)</span></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><span class="doxyHighlight">          BPLive = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>++;</span></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> ((<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME) &amp;&amp;</span></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><span class="doxyHighlight">               (FPLive || BPLive ||</span></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><span class="doxyHighlight">                <a href="#a63e534b2d2892aadaa791d48b0397c74">isFPBPAccess</a>(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a4ebada6a2af2bcba53ded1d7b414f081">FP</a>, BP, <a href="/docs/api/classes/llvm/x86framelowering/#a1b652b91e12384b9f49bb38521b78ffe">TRI</a>, AccessFP, AccessBP)));</span></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t need to save/restore if FP is accessed through llvm.frameaddress.</span></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FPLive &amp;&amp; !SpillBP)</span></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the bp is clobbered by a call, we should save and restore outside of</span></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the frame setup instructions.</span></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (KillMI-&gt;isCall() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> != ME) &#123;</span></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FrameSetup = std::next(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>);</span></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Look for frame setup instruction toward the start of the BB.</span></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we reach another call instruction, it means no frame setup</span></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// instruction for the current call instruction.</span></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (FrameSetup != ME &amp;&amp; !<a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.isFrameSetup(&#42;FrameSetup) &amp;&amp;</span></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><span class="doxyHighlight">               !FrameSetup-&gt;isCall())</span></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"><span class="doxyHighlight">          ++FrameSetup;</span></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If a frame setup instruction is found, we need to find out the</span></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// corresponding frame destroy instruction.</span></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FrameSetup != ME &amp;&amp; <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.isFrameSetup(&#42;FrameSetup) &amp;&amp;</span></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><span class="doxyHighlight">            (<a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.getFrameSize(&#42;FrameSetup) ||</span></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.getFrameAdjustment(&#42;FrameSetup))) &#123;</span></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/x86framelowering/#a9eb08d8f7165ce65d875c2329952262b">TII</a>.isFrameInstr(&#42;KillMI))</span></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><span class="doxyHighlight">            --KillMI;</span></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a> = FrameSetup;</span></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>;</span></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><span class="doxyHighlight">          ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><span class="doxyHighlight">      checkInterferedAccess(MF, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>, KillMI, SpillFP, SpillBP);</span></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621"></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Call target function to spill and restore FP and BP registers.</span></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><span class="doxyHighlight">      saveAndRestoreFPBPUsingSP(MF, &amp;(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#ad3ece0ac2421637044624c9b01c42466">DefMI</a>), &amp;(&#42;KillMI), SpillFP, SpillBP);</span></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
