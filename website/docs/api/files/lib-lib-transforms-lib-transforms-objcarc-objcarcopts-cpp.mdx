---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/objcarc/objcarcopts-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `ObjCARCOpts.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This file defines ObjC ARC optimizations. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="ARCRuntimeEntryPoints.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/arcruntimeentrypoints-h"
  isLocal="true" />
<IncludesListItem
  filePath="BlotMapVector.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/blotmapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="DependencyAnalysis.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/dependencyanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="ObjCARC.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarc-h"
  isLocal="true" />
<IncludesListItem
  filePath="ProvenanceAnalysis.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/provenanceanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="PtrState.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/ptrstate-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ObjCARCAnalysisUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcanalysisutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ObjCARCInstKind.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcinstkind-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ObjCARCUtil.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcutil-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/EHPersonalities.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Compiler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/ObjCARC.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/objcarc-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-objcarcopts-cpp-">anonymous&#123;ObjCARCOpts.cpp&#125;</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a></>}>
Per-BasicBlock state. <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/objcarcopt">ObjCARCOpt</a></>}>
The main ARC optimization pass. <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/objcarcopt/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="/docs/api/groups/arcopt/#ga5fd3f0408257b1a0df4a029c9b133d6c">CheckForCanReleaseCFGHazard</a> (const Sequence SuccSSeq, const bool SuccSRRIKnownSafe, TopDownPtrState &amp;S, bool &amp;SomeSuccHasSame, bool &amp;AllSuccsHaveSame, bool &amp;NotAllSeqEqualButKnownSafe)</>}>
If we have a Top Down pointer in the S&#95;CanRelease state, make sure that there are no CFG hazards by checking the states of various bottom up pointers. <a href="/docs/api/groups/arcopt/#ga5fd3f0408257b1a0df4a029c9b133d6c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="/docs/api/groups/arcopt/#ga3a319b49d26b9794c0cf855627fc36fa">CheckForUseCFGHazard</a> (const Sequence SuccSSeq, const bool SuccSRRIKnownSafe, TopDownPtrState &amp;S, bool &amp;SomeSuccHasSame, bool &amp;AllSuccsHaveSame, bool &amp;NotAllSeqEqualButKnownSafe, bool &amp;ShouldContinue)</>}>
If we have a top down pointer in the S&#95;Use state, make sure that there are no CFG hazards by checking the states of various bottom up pointers. <a href="/docs/api/groups/arcopt/#ga3a319b49d26b9794c0cf855627fc36fa">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="/docs/api/groups/arcopt/#gaa18296f3a634bc237e15fe2a5dd18820">collectReleaseInsertPts</a> (const BlotMapVector&lt; Value &#42;, RRInfo &gt; &amp;Retains, DenseMap&lt; const Instruction &#42;, SmallPtrSet&lt; const Value &#42;, 2 &gt; &gt; &amp;ReleaseInsertPtToRCIdentityRoots)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="/docs/api/groups/arcopt/#gac3778bafa67cdae223698e5bba785a76">ComputePostOrders</a> (Function &amp;F, SmallVectorImpl&lt; BasicBlock &#42; &gt; &amp;PostOrder, SmallVectorImpl&lt; BasicBlock &#42; &gt; &amp;ReverseCFGPostOrder, unsigned NoObjCARCExceptionsMDKind, DenseMap&lt; const BasicBlock &#42;, BBState &gt; &amp;BBStates)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="BundledInsts"
  name={<><a href="/docs/api/groups/arcopt/#ga64c911096875ed541621249ea2b997e7">eraseInst</a> (Retain)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gaa5ac1cad7a8710747dbe7253b852a760">EraseInstruction</a> (Autorelease)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="/docs/api/groups/arcopt/#gadc60e99c9f1a1290990a039851b33df4">FindPredecessorRetainWithSafePath</a> (const Value &#42;Arg, BasicBlock &#42;BB, Instruction &#42;Autorelease, ProvenanceAnalysis &amp;PA)</>}>
Find a dependent retain that precedes the given autorelease for which there is nothing in between the two instructions that can affect the ref count of Arg. <a href="/docs/api/groups/arcopt/#gadc60e99c9f1a1290990a039851b33df4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e">FindSingleUseIdentifiedObject</a> (const Value &#42;Arg)</>}>
This is similar to GetRCIdentityRoot but it stops as soon as it finds a value with multiple uses. <a href="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42;, 2 &gt; &#42;</>}
  name={<><a href="/docs/api/groups/arcopt/#gadf63a31ac3181d8ff195fa4f459725a7">getRCIdentityRootsFromReleaseInsertPt</a> (const Instruction &#42;InsertPt, const DenseMap&lt; const Instruction &#42;, SmallPtrSet&lt; const Value &#42;, 2 &gt; &gt; &amp;ReleaseInsertPtToRCIdentityRoots)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="/docs/api/groups/arcopt/#gafda5d85d74da7b8294f1385aa8ab1b7c">HasSafePathToPredecessorCall</a> (const Value &#42;Arg, Instruction &#42;Retain, ProvenanceAnalysis &amp;PA)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if there is a dependent call earlier that does not have anything in between the Retain and the call that can affect the reference count of their shared pointer argument. <a href="/docs/api/groups/arcopt/#gafda5d85d74da7b8294f1385aa8ab1b7c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga94ba18a4a5cbf64d84b0c1a8f3a92468">if</a> (!Autorelease) continue</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gabd5cfc217e8144536565097965fe05ab">if</a> (!Call||(!Call-&gt;isTailCall() &amp;&amp;GetBasicARCInstKind(Retain)==ARCInstKind::RetainRV &amp;&amp;GetBasicARCInstKind(Autorelease)==ARCInstKind::AutoreleaseRV)) continue</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="/docs/api/groups/arcopt/#ga88b57387a1e0d73c6481fb274f076bb2">isInertARCValue</a> (Value &#42;V, SmallPtrSet&lt; Value &#42;, 1 &gt; &amp;VisitedPhis)</>}>
This function returns true if the value is inert. <a href="/docs/api/groups/arcopt/#ga88b57387a1e0d73c6481fb274f076bb2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga09dff0880007400fcd19bd659c3fb780">LLVM&#95;DEBUG</a> (dbgs()&lt;&lt; &quot;Erasing: &quot;&lt;&lt; &#42;Retain&lt;&lt; &quot;\\nErasing: &quot;&lt;&lt; &#42;Autorelease&lt;&lt; &quot;\\n&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga30b12856f535a15fa97460888a954a3f">STATISTIC</a> (NumNoops, &quot;Number of no-op objc calls eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga127779107c1a1618c34be8f0d477ff6b">STATISTIC</a> (NumPartialNoops, &quot;Number of partially no-op objc calls eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gac29701c309b165dcf43e514578b1d793">STATISTIC</a> (NumAutoreleases,&quot;Number of autoreleases converted to releases&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gac96b4de44f538d03a297bdd088374ea2">STATISTIC</a> (NumRets, &quot;Number of return value forwarding &quot; &quot;retain+autoreleases eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gaa7c67d33f6017882daa5fd89baf2c280">STATISTIC</a> (NumRRs, &quot;Number of retain+release paths eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga29594fc35c687f79c667ca9856bea2ec">STATISTIC</a> (NumPeeps, &quot;Number of calls peephole-optimized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gabe17c07af1e10c0e9865d62980aa45d8">STATISTIC</a> (NumRetainsBeforeOpt, &quot;Number of retains before optimization&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gab693488a24c81d72490cf8feb067ec61">STATISTIC</a> (NumReleasesBeforeOpt, &quot;Number of releases before optimization&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga663c586b53021e57ca931733e7136f40">STATISTIC</a> (NumRetainsAfterOpt, &quot;Number of retains after optimization&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga907fb65409b13c0e1834ccadad2ff62f">STATISTIC</a> (NumReleasesAfterOpt, &quot;Number of releases after optimization&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a> =
        FindPredecessorAutoreleaseWithSafePath(Arg, &amp;BB, Ret, PA)</>}>
Look for an &#96;â€˜autorelease`&#39; instruction dependent on Arg such that there are / no instructions dependent on Arg that need a positive ref count in between / the autorelease and the ret. <a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/groups/arcopt/#gafda5d85d74da7b8294f1385aa8ab1b7c">HasSafePathToPredecessorCall</a>(Arg, <a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>, PA)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = <a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a89d4e9815aa179f229cb8ba702199cb7">MaxPtrStates</a></>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="/docs/api/groups/arcopt/#ga3e74fd1cf2a83ae4cf47d4fb0af4d07b">NumRets</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> = <a href="/docs/api/groups/arcopt/#gadc60e99c9f1a1290990a039851b33df4">FindPredecessorRetainWithSafePath</a>(
        Arg, <a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>(), <a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>, PA)</>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;objc-arc-opts&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This file defines ObjC ARC optimizations.

ARC stands for Automatic Reference Counting and is a system for managing reference counts for objects in Objective C.

The optimizations performed include elimination of redundant, partially redundant, and inconsequential reference count operations, elimination of redundant weak pointer operations, and numerous minor simplifications.

WARNING: This file knows about certain library functions. It recognizes them by name, and hardwires knowledge of their semantics.

WARNING: This file knows about how certain Objective-C library functions are used. Naive LLVM IR transformations which would otherwise be behavior-preserving may break these assumptions.

<SectionDefinition>

## Variables

### MaxPtrStates {#a89d4e9815aa179f229cb8ba702199cb7}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxPtrStates(&quot;arc-opt-max-ptr-states&quot;, cl::Hidden, cl::desc(&quot;Maximum number of ptr states the optimizer keeps track of&quot;), cl::init(4095))</>}
  labels = {["static"]}>

Definition at line <a href="#l00075">75</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarcopts-cpp">ObjCARCOpts.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;objc-arc-opts&quot;</>}>

Definition at line <a href="#l00073">73</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarcopts-cpp">ObjCARCOpts.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- ObjCARCOpts.cpp - ObjC ARC Optimization ----------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This file defines ObjC ARC optimizations. ARC stands for Automatic</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// Reference Counting and is a system for managing reference counts for objects</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">/// in Objective C.</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">/// The optimizations performed include elimination of redundant, partially</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">/// redundant, and inconsequential reference count operations, elimination of</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">/// redundant weak pointer operations, and numerous minor simplifications.</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">/// WARNING: This file knows about certain library functions. It recognizes them</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">/// by name, and hardwires knowledge of their semantics.</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">/// WARNING: This file knows about how certain Objective-C library functions are</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">/// used. Naive LLVM IR transformations which would otherwise be</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">/// behavior-preserving may break these assumptions.</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/arcruntimeentrypoints-h">ARCRuntimeEntryPoints.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/blotmapvector-h">BlotMapVector.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/dependencyanalysis-h">DependencyAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/objcarc-h">ObjCARC.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/provenanceanalysis-h">ProvenanceAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/ptrstate-h">PtrState.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h">llvm/Analysis/AliasAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcanalysisutils-h">llvm/Analysis/ObjCARCAnalysisUtils.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcinstkind-h">llvm/Analysis/ObjCARCInstKind.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcutil-h">llvm/Analysis/ObjCARCUtil.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h">llvm/IR/EHPersonalities.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h">llvm/IR/InstIterator.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h">llvm/Support/Compiler.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/objcarc-h">llvm/Transforms/ObjCARC.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/objcarc">llvm::objcarc</a>;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;objc-arc-opts&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75" lineLink="#a89d4e9815aa179f229cb8ba702199cb7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a89d4e9815aa179f229cb8ba702199cb7">MaxPtrStates</a>(</span><span class="doxyHighlightStringLiteral">&quot;arc-opt-max-ptr-states&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Maximum number of ptr states the optimizer keeps track of&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(4095));</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightComment">/// \\defgroup ARCUtilities Utility declarations/definitions specific to ARC.</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightComment">/// @&#123;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightComment">/// This is similar to GetRCIdentityRoot but it stops as soon</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightComment">/// as it finds a value with multiple uses.</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85" lineLink="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e">FindSingleUseIdentifiedObject</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg) &#123;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ConstantData (like ConstantPointerNull and UndefValue) is used across</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// modules.  It&#39;s never a single-use value.</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantData&gt;</a>(Arg))</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(Arg))</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e">FindSingleUseIdentifiedObject</a>(BC-&gt;getOperand(0));</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(Arg))</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllZeroIndices())</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e">FindSingleUseIdentifiedObject</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a7137a432b1d5406783f79dd29fc591fb">IsForwarding</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(Arg)))</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e">FindSingleUseIdentifiedObject</a>(</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Arg)-&gt;getArgOperand(0));</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/objcarc/#a509cccdade23eb44c7f84b31238dd52c">IsObjCIdentifiedObject</a>(Arg))</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Arg;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we found an identifiable object but it has multiple uses, but they are</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trivial uses, we can still consider this to be a single-use value.</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a509cccdade23eb44c7f84b31238dd52c">IsObjCIdentifiedObject</a>(Arg)) &#123;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : Arg-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!U-&gt;use&#95;empty() || <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">GetRCIdentityRoot</a>(U) != Arg)</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">         </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Arg;</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightComment">/// @&#125;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightComment">/// \\defgroup ARCOpt ARC Optimization.</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightComment">/// @&#123;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlightComment">// TODO: On code like this:</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlightComment">// objc&#95;retain(%x)</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightComment">// stuff&#95;that&#95;cannot&#95;release()</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightComment">// objc&#95;autorelease(%x)</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightComment">// stuff&#95;that&#95;cannot&#95;release()</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightComment">// objc&#95;retain(%x)</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightComment">// stuff&#95;that&#95;cannot&#95;release()</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightComment">// objc&#95;autorelease(%x)</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightComment">// The second retain and autorelease can be deleted.</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlightComment">// TODO: It should be possible to delete</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlightComment">// objc&#95;autoreleasePoolPush and objc&#95;autoreleasePoolPop</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlightComment">// pairs if nothing is actually autoreleased between them. Also, autorelease</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlightComment">// calls followed by objc&#95;autoreleasePoolPop calls (perhaps in ObjC++ code</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightComment">// after inlining) can be turned into plain release calls.</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlightComment">// TODO: Critical-edge splitting. If the optimial insertion point is</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlightComment">// a critical edge, the current algorithm has to fail, because it doesn&#39;t</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlightComment">// know how to split edges. It should be possible to make the optimizer</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">// think in terms of edges, rather than blocks, and then split critical</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightComment">// edges on demand.</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlightComment">// TODO: OptimizeSequences could generalized to be Interprocedural.</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightComment">// TODO: Recognize that a bunch of other objc runtime calls have</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightComment">// non-escaping arguments and non-releasing arguments, and may be</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlightComment">// non-autoreleasing.</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">// TODO: Sink autorelease calls as far as possible. Unfortunately we</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightComment">// usually can&#39;t sink them past other calls, which would be the main</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">// case where it would be useful.</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">// TODO: The pointer returned from objc&#95;loadWeakRetained is retained.</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">// TODO: Delete release+retain pairs (rare).</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161" lineLink="/docs/api/groups/arcopt/#ga30b12856f535a15fa97460888a954a3f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumNoops,       </span><span class="doxyHighlightStringLiteral">&quot;Number of no-op objc calls eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162" lineLink="/docs/api/groups/arcopt/#ga127779107c1a1618c34be8f0d477ff6b"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPartialNoops, </span><span class="doxyHighlightStringLiteral">&quot;Number of partially no-op objc calls eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163" lineLink="/docs/api/groups/arcopt/#gac29701c309b165dcf43e514578b1d793"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAutoreleases,</span><span class="doxyHighlightStringLiteral">&quot;Number of autoreleases converted to releases&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164" lineLink="/docs/api/groups/arcopt/#gac96b4de44f538d03a297bdd088374ea2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(<a href="/docs/api/groups/arcopt/#ga3e74fd1cf2a83ae4cf47d4fb0af4d07b">NumRets</a>,        </span><span class="doxyHighlightStringLiteral">&quot;Number of return value forwarding &quot;</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;retain+autoreleases eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166" lineLink="/docs/api/groups/arcopt/#gaa7c67d33f6017882daa5fd89baf2c280"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumRRs,         </span><span class="doxyHighlightStringLiteral">&quot;Number of retain+release paths eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167" lineLink="/docs/api/groups/arcopt/#ga29594fc35c687f79c667ca9856bea2ec"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPeeps,       </span><span class="doxyHighlightStringLiteral">&quot;Number of calls peephole-optimized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169" lineLink="/docs/api/groups/arcopt/#gabe17c07af1e10c0e9865d62980aa45d8"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumRetainsBeforeOpt,</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of retains before optimization&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171" lineLink="/docs/api/groups/arcopt/#gab693488a24c81d72490cf8feb067ec61"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumReleasesBeforeOpt,</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of releases before optimization&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173" lineLink="/docs/api/groups/arcopt/#ga663c586b53021e57ca931733e7136f40"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumRetainsAfterOpt,</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of retains after optimization&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175" lineLink="/docs/api/groups/arcopt/#ga907fb65409b13c0e1834ccadad2ff62f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumReleasesAfterOpt,</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of releases after optimization&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179" lineLink="/docs/api/namespaces/anonymous-objcarcopts-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlightComment">  /// Per-BasicBlock state.</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &#123;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlightComment">    /// The number of unique control paths from the entry which can reach this</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlightComment">    /// block.</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TopDownPathCount = 0;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightComment">    /// The number of unique control paths to exits from this block.</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BottomUpPathCount = 0;</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlightComment">    /// The top-down traversal uses this to record information known about a</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlightComment">    /// pointer at the bottom of each block.</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;const Value &#42;, TopDownPtrState&gt;</a> PerPtrTopDown;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlightComment">    /// The bottom-up traversal uses this to record information known about a</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlightComment">    /// pointer at the top of each block.</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;const Value &#42;, BottomUpPtrState&gt;</a> PerPtrBottomUp;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlightComment">    /// Effective predecessors of the current block ignoring ignorable edges and</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlightComment">    /// ignored backedges.</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> Preds;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlightComment">    /// Effective successors of the current block ignoring ignorable edges and</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlightComment">    /// ignored backedges.</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> Succs;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207" lineLink="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>;</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a>() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a2ce3f5b5a04add97c07dc88f808a4d40"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a2ce3f5b5a04add97c07dc88f808a4d40">top&#95;down&#95;ptr&#95;iterator</a> = </span><span class="doxyHighlightKeyword">decltype</span><span class="doxyHighlight">(PerPtrTopDown)<a href="/docs/api/classes/llvm/iplist">::iterator</a>;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aaa3c2c44d6e9e852d0a9ce5061227c23"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aaa3c2c44d6e9e852d0a9ce5061227c23">const&#95;top&#95;down&#95;ptr&#95;iterator</a> = </span><span class="doxyHighlightKeyword">decltype</span><span class="doxyHighlight">(PerPtrTopDown)<a href="/docs/api/classes/llvm/smallvectorimpl">::const&#95;iterator</a>;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a24ad33e93faa865233c3742130a7e821"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a2ce3f5b5a04add97c07dc88f808a4d40">top&#95;down&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a24ad33e93faa865233c3742130a7e821">top&#95;down&#95;ptr&#95;begin</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrTopDown.begin(); &#125;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5d6b6a78cf25b2f70736f9f3873aa2e5"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a2ce3f5b5a04add97c07dc88f808a4d40">top&#95;down&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5d6b6a78cf25b2f70736f9f3873aa2e5">top&#95;down&#95;ptr&#95;end</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrTopDown.end(); &#125;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a21dbee30031c6b2ace1822f68ace1c64"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aaa3c2c44d6e9e852d0a9ce5061227c23">const&#95;top&#95;down&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a21dbee30031c6b2ace1822f68ace1c64">top&#95;down&#95;ptr&#95;begin</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrTopDown.begin();</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a267de37110bfa333b34162bc28a5fa4a"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aaa3c2c44d6e9e852d0a9ce5061227c23">const&#95;top&#95;down&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a267de37110bfa333b34162bc28a5fa4a">top&#95;down&#95;ptr&#95;end</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrTopDown.end();</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a23f111de43f140e5cc4263292d8bc3b2"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a23f111de43f140e5cc4263292d8bc3b2">hasTopDownPtrs</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !PerPtrTopDown.empty();</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a7643bad194aea53c864780d1cad3d932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a7643bad194aea53c864780d1cad3d932">top&#95;down&#95;ptr&#95;list&#95;size</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::distance(<a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a24ad33e93faa865233c3742130a7e821">top&#95;down&#95;ptr&#95;begin</a>(), <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5d6b6a78cf25b2f70736f9f3873aa2e5">top&#95;down&#95;ptr&#95;end</a>());</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ad8a067a8a3e9b76687a1fe2489b5112f"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ad8a067a8a3e9b76687a1fe2489b5112f">bottom&#95;up&#95;ptr&#95;iterator</a> = </span><span class="doxyHighlightKeyword">decltype</span><span class="doxyHighlight">(PerPtrBottomUp)<a href="/docs/api/classes/llvm/iplist">::iterator</a>;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#af513739f27cb96666f62883d17b488b5"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#af513739f27cb96666f62883d17b488b5">const&#95;bottom&#95;up&#95;ptr&#95;iterator</a> =</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">decltype</span><span class="doxyHighlight">(PerPtrBottomUp)<a href="/docs/api/classes/llvm/smallvectorimpl">::const&#95;iterator</a>;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a44b4ed3c4f497a6de469679cb3848ebd"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ad8a067a8a3e9b76687a1fe2489b5112f">bottom&#95;up&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a44b4ed3c4f497a6de469679cb3848ebd">bottom&#95;up&#95;ptr&#95;begin</a>() &#123;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrBottomUp.begin();</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aa5ac0d8664a0a0c00d452f4f9b662817"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ad8a067a8a3e9b76687a1fe2489b5112f">bottom&#95;up&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aa5ac0d8664a0a0c00d452f4f9b662817">bottom&#95;up&#95;ptr&#95;end</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrBottomUp.end(); &#125;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aabe24534e9b4869b0c742ac432b2d381"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#af513739f27cb96666f62883d17b488b5">const&#95;bottom&#95;up&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aabe24534e9b4869b0c742ac432b2d381">bottom&#95;up&#95;ptr&#95;begin</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrBottomUp.begin();</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a77716e8423e3c3df2153c8f4709b7d8e"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#af513739f27cb96666f62883d17b488b5">const&#95;bottom&#95;up&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a77716e8423e3c3df2153c8f4709b7d8e">bottom&#95;up&#95;ptr&#95;end</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrBottomUp.end();</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a80573fc9db8d96d586e71cb492d6bd20"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a80573fc9db8d96d586e71cb492d6bd20">hasBottomUpPtrs</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !PerPtrBottomUp.empty();</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a022ec5629a502cd9e9c83b0f30eb4191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a022ec5629a502cd9e9c83b0f30eb4191">bottom&#95;up&#95;ptr&#95;list&#95;size</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::distance(<a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a44b4ed3c4f497a6de469679cb3848ebd">bottom&#95;up&#95;ptr&#95;begin</a>(), <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aa5ac0d8664a0a0c00d452f4f9b662817">bottom&#95;up&#95;ptr&#95;end</a>());</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlightComment">    /// Mark this block as being an entry block, which has one path from the</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlightComment">    /// entry by definition.</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a80aef00081f07599de8a859c96ff8e29"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a80aef00081f07599de8a859c96ff8e29">SetAsEntry</a>() &#123; TopDownPathCount = 1; &#125;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlightComment">    /// Mark this block as being an exit block, which has one path to an exit by</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlightComment">    /// definition.</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac93e3d82e2f6680f6fe50172c2f0e7d2"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac93e3d82e2f6680f6fe50172c2f0e7d2">SetAsExit</a>()  &#123; BottomUpPathCount = 1; &#125;</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlightComment">    /// Attempt to find the PtrState object describing the top down state for</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlightComment">    /// pointer Arg. Return a new initialized PtrState describing the top down</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlightComment">    /// state for Arg if we do not find one.</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a42276c8fcda0e12cd7fd25b90eb1a1d8"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;<a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a42276c8fcda0e12cd7fd25b90eb1a1d8">getPtrTopDownState</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg) &#123;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrTopDown&#91;Arg&#93;;</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightComment">    /// Attempt to find the PtrState object describing the bottom up state for</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlightComment">    /// pointer Arg. Return a new initialized PtrState describing the bottom up</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlightComment">    /// state for Arg if we do not find one.</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ae6dd134ba25f16cbabcee9775ba42368"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/bottomupptrstate">BottomUpPtrState</a> &amp;<a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ae6dd134ba25f16cbabcee9775ba42368">getPtrBottomUpState</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg) &#123;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrBottomUp&#91;Arg&#93;;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlightComment">    /// Attempt to find the PtrState object describing the bottom up state for</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlightComment">    /// pointer Arg.</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a82483bea0981a0e53587a61730a89a72"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ad8a067a8a3e9b76687a1fe2489b5112f">bottom&#95;up&#95;ptr&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a82483bea0981a0e53587a61730a89a72">findPtrBottomUpState</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg) &#123;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PerPtrBottomUp.find(Arg);</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac93dcc8299d4d4527b33b8961ea717fa"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac93dcc8299d4d4527b33b8961ea717fa">clearBottomUpPointers</a>() &#123;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">      PerPtrBottomUp.clear();</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a3641e7dbe4fa8121bf99c1ea7a8049ca"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a3641e7dbe4fa8121bf99c1ea7a8049ca">clearTopDownPointers</a>() &#123;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">      PerPtrTopDown.clear();</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> InitFromPred(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>);</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> InitFromSucc(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>);</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MergePred(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>);</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MergeSucc(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>);</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlightComment">    /// Compute the number of possible unique paths from an entry to an exit</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlightComment">    /// which pass through this block. This is only valid after both the</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlightComment">    /// top-down and bottom-up traversals are complete.</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlightComment">    ///</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlightComment">    /// Returns true if overflow occurred. Returns false if overflow did not</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlightComment">    /// occur.</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#affacfb81e5c97a55889323f5e6f5aacf"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#affacfb81e5c97a55889323f5e6f5aacf">GetAllPathCountWithOverflow</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;PathCount)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TopDownPathCount == <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a> ||</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">          BottomUpPathCount == <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>)</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight"> Product =</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">        (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">long</span><span class="doxyHighlight"> long)TopDownPathCount&#42;BottomUpPathCount;</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Overflow occurred if any of the upper bits of Product are set or if all</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the lower bits of Product are all set.</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (Product &gt;&gt; 32) ||</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">             ((PathCount = Product) == <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>);</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Specialized CFG utilities.</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">edge&#95;iterator</a> = <a href="/docs/api/classes/llvm/smallvectorimpl/#a641b0782e0cc309372855bfc19fdfd97">SmallVectorImpl&lt;BasicBlock &#42;&gt;::const&#95;iterator</a>;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#af9ca41414437da0262a799ea0d91eea6"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">edge&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#af9ca41414437da0262a799ea0d91eea6">pred&#95;begin</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Preds.begin(); &#125;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a9d362fec63555f74b19daeb03745e848"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">edge&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a9d362fec63555f74b19daeb03745e848">pred&#95;end</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Preds.end(); &#125;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac54467fda18cd54fca9f14f1d0992ee6"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">edge&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac54467fda18cd54fca9f14f1d0992ee6">succ&#95;begin</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Succs.begin(); &#125;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a0f9b4be7b81002bd6cc42be2a71c19c8"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">edge&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a0f9b4be7b81002bd6cc42be2a71c19c8">succ&#95;end</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Succs.end(); &#125;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aed2c0df9216eab3bef23b02901a58919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aed2c0df9216eab3bef23b02901a58919">addSucc</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ) &#123; Succs.push&#95;back(Succ); &#125;</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#abf56f09ced8f685a4fa522b02e44e544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#abf56f09ced8f685a4fa522b02e44e544">addPred</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred) &#123; Preds.push&#95;back(Pred); &#125;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a079a33bcf8b5c214f74bbffbc8f3dbf1"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a079a33bcf8b5c214f74bbffbc8f3dbf1">isExit</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Succs.empty(); &#125;</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a> = 0xffffffff;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;<a href="/docs/api/namespaces/llvm/#ab89f1db02887aa569176f0e29622eb47">operator&lt;&lt;</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS,</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">                        BBState &amp;BBState) <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#acc1c483f4b4ee2f17bb6643a3b353609">LLVM&#95;ATTRIBUTE&#95;UNUSED</a>;</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end namespace llvm</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336" lineLink="/docs/api/groups/arcopt/#ga9346e283861508359c876cda13cfd7d8"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9346e283861508359c876cda13cfd7d8">BBState::InitFromPred</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>) &#123;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  PerPtrTopDown = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.PerPtrTopDown;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  TopDownPathCount = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.TopDownPathCount;</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341" lineLink="/docs/api/groups/arcopt/#ga00e90d16c74d3fe8f597efab1f0d1104"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga00e90d16c74d3fe8f597efab1f0d1104">BBState::InitFromSucc</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>) &#123;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">  PerPtrBottomUp = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.PerPtrBottomUp;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">  BottomUpPathCount = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.BottomUpPathCount;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlightComment">/// The top-down traversal uses this to merge information about predecessors to</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlightComment">/// form the initial state for a new block.</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348" lineLink="/docs/api/groups/arcopt/#ga43bdfa3a92d9eaff97326d0756b88379"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga43bdfa3a92d9eaff97326d0756b88379">BBState::MergePred</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>) &#123;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TopDownPathCount == <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>)</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Other.TopDownPathCount can be 0, in which case it is either dead or a</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop backedge. Loop backedges are special.</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  TopDownPathCount += <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.TopDownPathCount;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In order to be consistent, we clear the top down pointers when by adding</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TopDownPathCount becomes OverflowOccurredValue even though &quot;true&quot; overflow</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// has not occurred.</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TopDownPathCount == <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>) &#123;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a3641e7dbe4fa8121bf99c1ea7a8049ca">clearTopDownPointers</a>();</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for overflow. If we have overflow, fall back to conservative</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// behavior.</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TopDownPathCount &lt; <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.TopDownPathCount) &#123;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    TopDownPathCount = <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a3641e7dbe4fa8121bf99c1ea7a8049ca">clearTopDownPointers</a>();</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each entry in the other set, if our set has an entry with the same key,</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// merge the entries. Otherwise, copy the entry and merge it with an empty</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// entry.</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.top&#95;down&#95;ptr&#95;begin(), ME = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.top&#95;down&#95;ptr&#95;end();</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME; ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Pair = PerPtrTopDown.insert(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">    Pair.first-&gt;second.Merge(Pair.second ? <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a>() : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;second,</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">                             </span><span class="doxyHighlightComment">/&#42;TopDown=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each entry in our set, if the other set doesn&#39;t have an entry with the</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same key, force it to merge with an empty entry.</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a24ad33e93faa865233c3742130a7e821">top&#95;down&#95;ptr&#95;begin</a>(), ME = <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5d6b6a78cf25b2f70736f9f3873aa2e5">top&#95;down&#95;ptr&#95;end</a>(); <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME; ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.PerPtrTopDown.find(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;first) == <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.PerPtrTopDown.end())</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;second.Merge(<a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a>(), </span><span class="doxyHighlightComment">/&#42;TopDown=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlightComment">/// The bottom-up traversal uses this to merge information about successors to</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlightComment">/// form the initial state for a new block.</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391" lineLink="/docs/api/groups/arcopt/#gacf2e521ed66ec3e1c4292beb27bdb696"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gacf2e521ed66ec3e1c4292beb27bdb696">BBState::MergeSucc</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>) &#123;</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BottomUpPathCount == <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>)</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Other.BottomUpPathCount can be 0, in which case it is either dead or a</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop backedge. Loop backedges are special.</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  BottomUpPathCount += <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.BottomUpPathCount;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In order to be consistent, we clear the top down pointers when by adding</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BottomUpPathCount becomes OverflowOccurredValue even though &quot;true&quot; overflow</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// has not occurred.</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BottomUpPathCount == <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>) &#123;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac93dcc8299d4d4527b33b8961ea717fa">clearBottomUpPointers</a>();</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for overflow. If we have overflow, fall back to conservative</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// behavior.</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BottomUpPathCount &lt; <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.BottomUpPathCount) &#123;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    BottomUpPathCount = <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">OverflowOccurredValue</a>;</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#ac93dcc8299d4d4527b33b8961ea717fa">clearBottomUpPointers</a>();</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each entry in the other set, if our set has an entry with the</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same key, merge the entries. Otherwise, copy the entry and merge</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it with an empty entry.</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.bottom&#95;up&#95;ptr&#95;begin(), ME = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.bottom&#95;up&#95;ptr&#95;end();</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME; ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Pair = PerPtrBottomUp.insert(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">    Pair.first-&gt;second.Merge(Pair.second ? <a href="/docs/api/structs/llvm/objcarc/bottomupptrstate">BottomUpPtrState</a>() : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;second,</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">                             </span><span class="doxyHighlightComment">/&#42;TopDown=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each entry in our set, if the other set doesn&#39;t have an entry</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with the same key, force it to merge with an empty entry.</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a44b4ed3c4f497a6de469679cb3848ebd">bottom&#95;up&#95;ptr&#95;begin</a>(), ME = <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#aa5ac0d8664a0a0c00d452f4f9b662817">bottom&#95;up&#95;ptr&#95;end</a>(); <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME;</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">       ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.PerPtrBottomUp.find(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;first) == <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.PerPtrBottomUp.end())</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;second.Merge(<a href="/docs/api/structs/llvm/objcarc/bottomupptrstate">BottomUpPtrState</a>(), </span><span class="doxyHighlightComment">/&#42;TopDown=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433" lineLink="/docs/api/groups/arcopt/#ga453c66f61a3fecc62b0658a43596f676"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;<a href="/docs/api/namespaces/llvm/#ab89f1db02887aa569176f0e29622eb47">llvm::operator&lt;&lt;</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;BBInfo) &#123;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Dump the pointers we are tracking.</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    TopDown State:\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BBInfo.hasTopDownPtrs()) &#123;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        NONE!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBInfo.top&#95;down&#95;ptr&#95;begin(), E = BBInfo.top&#95;down&#95;ptr&#95;end();</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/objcarc/ptrstate">PtrState</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">      OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        Ptr: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n            KnownSafe:        &quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.IsKnownSafe()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n            ImpreciseRelease: &quot;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.IsTrackingImpreciseReleases()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;            HasCFGHazards:    &quot;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.IsCFGHazardAfflicted()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;            KnownPositive:    &quot;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.HasKnownPositiveRefCount()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;            Seq:              &quot;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">         &lt;&lt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.GetSeq() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    BottomUp State:\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BBInfo.hasBottomUpPtrs()) &#123;</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        NONE!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBInfo.bottom&#95;up&#95;ptr&#95;begin(), E = BBInfo.bottom&#95;up&#95;ptr&#95;end();</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/objcarc/ptrstate">PtrState</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">      OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        Ptr: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n            KnownSafe:        &quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.IsKnownSafe()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n            ImpreciseRelease: &quot;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.IsTrackingImpreciseReleases()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;            HasCFGHazards:    &quot;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.IsCFGHazardAfflicted()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;            KnownPositive:    &quot;</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">           &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.HasKnownPositiveRefCount()?</span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">:</span><span class="doxyHighlightStringLiteral">&quot;false&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;            Seq:              &quot;</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">         &lt;&lt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.GetSeq() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OS;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlightComment">  /// The main ARC optimization pass.</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/objcarcopt"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/objcarcopt">ObjCARCOpt</a> &#123;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Changed = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CFGChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  <a href="/docs/api/classes/provenanceanalysis">ProvenanceAnalysis</a> PA;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlightComment">  /// A cache of references to runtime entry point constants.</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/objcarc/arcruntimeentrypoints">ARCRuntimeEntryPoints</a> EP;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlightComment">  /// A cache of MDKinds that can be passed into other functions to propagate</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlightComment">  /// MDKind identifiers.</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/objcarc/arcmdkindcache">ARCMDKindCache</a> MDKindCache;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/objcarc/bundledretainclaimrvs">BundledRetainClaimRVs</a> &#42;BundledInsts = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlightComment">  /// A flag indicating whether the optimization that removes or moves</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlightComment">  /// retain/release pairs should be performed.</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DisableRetainReleasePairing = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlightComment">  /// Flags which determine whether each of the interesting runtime functions</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlightComment">  /// is in fact used in the current function.</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UsedInThisFunction;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, ColorVector&gt;</a> BlockEHColors;</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimizeRetainRVCall(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>);</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OptimizeAutoreleaseRVCall(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>,</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> &amp;Class);</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OptimizeIndividualCalls(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlightComment">  /// Optimize an individual call, optionally passing the</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlightComment">  /// GetArgRCIdentityRoot if it has already been computed.</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OptimizeIndividualCallImpl(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> Class, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg);</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlightComment">  /// Try to optimize an AutoreleaseRV with a RetainRV or UnsafeClaimRV.  If the</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlightComment">  /// optimization occurs, returns true to indicate that the caller should</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">  /// assume the instructions are dead.</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimizeInlinedAutoreleaseRVCall(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;Arg, <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> Class,</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>,</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;AutoreleaseRVArg);</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> CheckForCFGHazards(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">                          <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a> &amp;MyStates) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VisitInstructionBottomUp(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">                                <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a> &amp;MyStates);</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VisitBottomUp(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains);</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VisitInstructionTopDown(</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases, <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate">BBState</a> &amp;MyStates,</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a>&gt;</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">          &amp;ReleaseInsertPtToRCIdentityRoots);</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VisitTopDown(</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases,</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a>&gt;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">          &amp;ReleaseInsertPtToRCIdentityRoots);</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Visit(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases);</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MoveCalls(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg, <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;RetainsToMove, <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;ReleasesToMove,</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases,</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;DeadInsts, <a href="/docs/api/classes/llvm/module">Module</a> &#42;M);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PairUpRetainsAndReleases(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases, <a href="/docs/api/classes/llvm/module">Module</a> &#42;M,</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>,</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;DeadInsts,</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">                                <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;RetainsToMove, <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;ReleasesToMove,</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> KnownSafe,</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;AnyPairsCompletelyEliminated);</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PerformCodePlacement(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases, <a href="/docs/api/classes/llvm/module">Module</a> &#42;M);</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OptimizeWeakCalls(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimizeSequences(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OptimizeReturns(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> PredicateT&gt;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> cloneOpBundlesIf(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CI,</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;OperandBundleDef&gt;</a> &amp;OpBundles,</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">                               PredicateT Predicate) &#123;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a35b3798829fba58f145ea59e4214e84a">getNumOperandBundles</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/operandbundleuse">OperandBundleUse</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a1b38c4ecbbce4814b679f08b72b1d67f">getOperandBundleAt</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Predicate(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">        OpBundles.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addOpBundleForFunclet(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;OperandBundleDef&gt;</a> &amp;OpBundles) &#123;</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BlockEHColors.empty()) &#123;</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac16c24df0637600996c9c6081da170a2">ColorVector</a> &amp;CV = BlockEHColors.find(BB)-&gt;second;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CV.<a href="/docs/api/classes/llvm/tinyptrvector/#aac784c7664f3f6b8076756c6fb0eed74">size</a>() &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Uncolored block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPadBB : CV)</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EHPad =</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FuncletPadInst&gt;</a>(EHPadBB-&gt;getFirstNonPHIIt())) &#123;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">          OpBundles.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(</span><span class="doxyHighlightStringLiteral">&quot;funclet&quot;</span><span class="doxyHighlight">, EHPad);</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> GatherStatistics(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AfterOptimization = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gac7ff3521e7b4b50e8db182392234aefb">init</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga2542f915a6ba493b029cfe3ffc5f4a44">run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &amp;<a href="/docs/api/namespaces/llvm/aa">AA</a>);</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601" lineLink="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/objcarcopt/#a9cda1b8e595016dcd88239ffa731aa87"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/objcarcopt/#a9cda1b8e595016dcd88239ffa731aa87">hasCFGChanged</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CFGChanged; &#125;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlightComment">/// Turn objc&#95;retainAutoreleasedReturnValue into objc&#95;retain if the operand is</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlightComment">/// not a return value.</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">ObjCARCOpt::OptimizeRetainRVCall(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>) &#123;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for the argument being from an immediately preceding call or invoke.</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>);</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(Arg)) &#123;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getParent() == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>-&gt;getParent()) &#123;</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a42a7d51fdde6913db72d098356c2c019">BasicBlock::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a77c263e77abfad00d916622aec23d468">IsNoopInstruction</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>)</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>)) &#123;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RetainRVParent = <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>-&gt;getParent();</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getNormalDest() == RetainRVParent) &#123;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a42a7d51fdde6913db72d098356c2c019">BasicBlock::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RetainRVParent-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a77c263e77abfad00d916622aec23d468">IsNoopInstruction</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">          ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>)</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!BundledInsts-&gt;contains(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>) &amp;&amp;</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;a bundled retainRV&#39;s argument should be a call&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Turn it to a plain objc&#95;retain.</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  ++NumPeeps;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Transforming objc&#95;retainAutoreleasedReturnValue =&gt; &quot;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;objc&#95;retain since the operand is not a return value.\\n&quot;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;Old = &quot;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">                    &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;NewDecl = EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644febaafece4245269582cb2f1009d4fb52047">ARCRuntimeEntryPointKind::Retain</a>);</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a>)-&gt;setCalledFunction(NewDecl);</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;New = &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">RetainRV</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::OptimizeInlinedAutoreleaseRVCall(</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;Arg, <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> Class,</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;AutoreleaseRVArg) &#123;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BundledInsts-&gt;contains(Inst))</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Must be in the same basic block.</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>-&gt;getParent());</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Must operate on the same root.</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(Inst);</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  AutoreleaseRVArg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>);</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg != AutoreleaseRVArg) &#123;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there isn&#39;t an exact match, check if we have equivalent PHIs.</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Arg);</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN)</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> ArgUsers;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#a7110df32902106ee880a19371b45d763">getEquivalentPHIs</a>(&#42;PN, ArgUsers);</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(ArgUsers, AutoreleaseRVArg))</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, this is a match.  Merge them.</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">  ++NumPeeps;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found inlined objc&#95;autoreleaseReturnValue &#39;&quot;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">                    &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; paired with &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete the RV pair, starting with the AutoreleaseRV.</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>-&gt;replaceAllUsesWith(</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>)-&gt;getArgOperand(0));</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>);</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>) &#123;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AutoreleaseRV and RetainRV cancel out.  Delete the RetainRV.</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">    Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst)-&gt;getArgOperand(0));</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Inst);</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// UnsafeClaimRV is a frontend peephole for RetainRV + Release.  Since the</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// AutoreleaseRV and RetainRV cancel out, replace UnsafeClaimRV with Release.</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ae490705e8a3fd75e76afa1108289c24a">ARCInstKind::UnsafeClaimRV</a>);</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/nvptxisd/#ab995b6d422b079c863075e073b2eb96ba21855f12c873f2db9747f91d62c65b40">CallArg</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst)-&gt;getArgOperand(0);</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/namespaces/llvm/#a239c4ac35d6028bfacaed4018d0488faab8e7b465df7c5979dc731d06e84ce2cf">Release</a> =</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644febab8e7b465df7c5979dc731d06e84ce2cf">ARCRuntimeEntryPointKind::Release</a>), CallArg, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">                       Inst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a392f31f4801522bd6062e369302d83a1">IsAlwaysTail</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ae490705e8a3fd75e76afa1108289c24a">ARCInstKind::UnsafeClaimRV</a>) &amp;&amp;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected UnsafeClaimRV to be safe to tail call&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a239c4ac35d6028bfacaed4018d0488faab8e7b465df7c5979dc731d06e84ce2cf">Release</a>-&gt;setTailCall();</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">  Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(CallArg);</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Inst);</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Run the normal optimizations on Release.</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  OptimizeIndividualCallImpl(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#a239c4ac35d6028bfacaed4018d0488faab8e7b465df7c5979dc731d06e84ce2cf">Release</a>, <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a>, Arg);</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlightComment">/// Turn objc&#95;autoreleaseReturnValue into objc&#95;autorelease if the result is not</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlightComment">/// used as a return value.</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> ObjCARCOpt::OptimizeAutoreleaseRVCall(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>,</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">                                           <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> &amp;Class) &#123;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for a return of the pointer value.</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>);</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the argument is ConstantPointerNull or UndefValue, its other users</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// aren&#39;t actually interesting to look at.</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantData&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 2&gt;</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>;</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.push&#95;back(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add PHIs that are equivalent to Ptr to Users.</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#a7110df32902106ee880a19371b45d763">getEquivalentPHIs</a>(&#42;PN, <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>);</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ReturnInst&gt;</a>(U) || <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(U) == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>)</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(U))</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.push&#95;back(U);</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.empty());</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  ++NumPeeps;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Transforming objc&#95;autoreleaseReturnValue =&gt; &quot;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;objc&#95;autorelease since its operand is not used as a return &quot;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;value.\\n&quot;</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;Old = &quot;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">             &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;AutoreleaseRVCI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>);</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;NewDecl = EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644feba61710f61a521b1544f5f7ab5abac843d">ARCRuntimeEntryPointKind::Autorelease</a>);</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  AutoreleaseRVCI-&gt;<a href="/docs/api/classes/llvm/callbase/#aee56a5257c4899bf97c5957d87a732e3">setCalledFunction</a>(NewDecl);</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  AutoreleaseRVCI-&gt;<a href="/docs/api/classes/llvm/callinst/#acff66a4cb0efaafb728848edf097c75f">setTailCall</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">); </span><span class="doxyHighlightComment">// Never tail call objc&#95;autorelease.</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a> = <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a61710f61a521b1544f5f7ab5abac843d">ARCInstKind::Autorelease</a>;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;New: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlightComment">/// Visit each call, one at a time, and make simplifications without doing any</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlightComment">/// additional analysis.</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> ObjCARCOpt::OptimizeIndividualCalls(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n== ObjCARCOpt::OptimizeIndividualCalls ==\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reset all the flags in preparation for recomputing them.</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  UsedInThisFunction = 0;</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Store any delayed AutoreleaseRV intrinsics, so they can be easily paired</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with RetainRV and UnsafeClaimRV.</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DelayedAutoreleaseRV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;DelayedAutoreleaseRVArg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> setDelayedAutoreleaseRV = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>) &#123;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!DelayedAutoreleaseRV || !<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">    DelayedAutoreleaseRV = <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">AutoreleaseRV</a>;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">    DelayedAutoreleaseRVArg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> optimizeDelayedAutoreleaseRV = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DelayedAutoreleaseRV)</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">    OptimizeIndividualCallImpl(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DelayedAutoreleaseRV,</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">ARCInstKind::AutoreleaseRV</a>,</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">                               DelayedAutoreleaseRVArg);</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    setDelayedAutoreleaseRV(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> shouldDelayAutoreleaseRV = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NonARCInst) &#123;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Nothing to delay, but we may as well skip the logic below.</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DelayedAutoreleaseRV)</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we hit the end of the basic block we&#39;re not going to find an RV-pair.</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Stop delaying.</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NonARCInst-&gt;isTerminator())</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Given the frontend rules for emitting AutoreleaseRV, RetainRV, and</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// UnsafeClaimRV, it&#39;s probably safe to skip over even opaque function calls</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// here since OptimizeInlinedAutoreleaseRVCall will confirm that they</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have the same RCIdentityRoot.  However, what really matters is</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// skipping instructions or intrinsics that the inliner could leave behind;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be conservative for now and don&#39;t skip over opaque calls, which could</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// potentially include other ARC calls.</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(NonARCInst);</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CB)</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CB-&gt;getIntrinsicID() != <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>;</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Visit all objc&#95;&#42; calls in F.</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0c27cc387928f22d241825cf0fb67ade">inst&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst&#95;begin</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/namespaces/llvm/#a945cded5463e0ccd3cf5a6ac80542a94">inst&#95;end</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ) &#123;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(Inst))</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#aefba9af2f61452f20f4c947b4c2e5f4e">objcarc::hasAttachedCallOpBundle</a>(CI)) &#123;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">        BundledInsts-&gt;insertRVCall(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator(), CI);</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a> = <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(Inst);</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip this loop if this instruction isn&#39;t itself an ARC intrinsic.</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Class) &#123;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">      optimizeDelayedAutoreleaseRV();</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a216b693ce70a5639bd2e33cdbb0d82d8">ARCInstKind::CallOrUser</a>:</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">ARCInstKind::User</a>:</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6adf97f83acf6453d4a6a4b1070f3754">ARCInstKind::None</a>:</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This is a non-ARC instruction.  If we&#39;re delaying an AutoreleaseRV,</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// check if it&#39;s safe to skip over it; if not, optimize the AutoreleaseRV</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// now.</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!shouldDelayAutoreleaseRV(Inst))</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">        optimizeDelayedAutoreleaseRV();</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">ARCInstKind::AutoreleaseRV</a>:</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">      optimizeDelayedAutoreleaseRV();</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">      setDelayedAutoreleaseRV(Inst);</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>:</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ae490705e8a3fd75e76afa1108289c24a">ARCInstKind::UnsafeClaimRV</a>:</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DelayedAutoreleaseRV) &#123;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We have a potential RV pair.  Check if they cancel out.</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OptimizeInlinedAutoreleaseRVCall(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Inst, Arg, Class,</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">                                             DelayedAutoreleaseRV,</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">                                             DelayedAutoreleaseRVArg)) &#123;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">          setDelayedAutoreleaseRV(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">        optimizeDelayedAutoreleaseRV();</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">    OptimizeIndividualCallImpl(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Inst, Class, Arg);</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Catch the final delayed AutoreleaseRV.</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">  optimizeDelayedAutoreleaseRV();</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlightComment">/// This function returns true if the value is inert. An ObjC ARC runtime call</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlightComment">/// taking an inert operand can be safely deleted.</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861" lineLink="/docs/api/groups/arcopt/#ga88b57387a1e0d73c6481fb274f076bb2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga88b57387a1e0d73c6481fb274f076bb2">isInertARCValue</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 1&gt;</a> &amp;VisitedPhis) &#123;</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">  V = V-&gt;stripPointerCasts();</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a4097309046dda09214babc993d35c679">IsNullOrUndef</a>(V))</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if this is a global attribute annotated with an &#39;objc&#95;arc&#95;inert&#39;.</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(V))</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GV-&gt;hasAttribute(</span><span class="doxyHighlightStringLiteral">&quot;objc&#95;arc&#95;inert&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore this phi if it has already been discovered.</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VisitedPhis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PN).second)</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look through phis&#39;s operands.</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd : PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#ga88b57387a1e0d73c6481fb274f076bb2">isInertARCValue</a>(Opnd, VisitedPhis))</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> ObjCARCOpt::OptimizeIndividualCallImpl(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst,</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">                                            <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> Class,</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg) &#123;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Visiting: Class: &quot;</span><span class="doxyHighlight"> &lt;&lt; Class &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;; &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can delete this call if it takes an inert value.</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 1&gt;</a> VisitedPhis;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BundledInsts-&gt;contains(Inst)) &#123;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    UsedInThisFunction |= 1 &lt;&lt; unsigned(Class);</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#ad3269e7374cddd8fb6760350aeb10f24">IsNoopOnGlobal</a>(Class))</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#ga88b57387a1e0d73c6481fb274f076bb2">isInertARCValue</a>(Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), VisitedPhis)) &#123;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>())</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">        Inst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Inst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Class) &#123;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete no-op casts. These function calls have special semantics, but</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the semantics are entirely implemented via lowering in the front-end,</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so by the time they reach the optimizer, they are just no-op calls</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which return their argument.</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There are gray areas here, as the ability to cast reference-counted</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointers to raw void&#42; and back allows code to break ARC assumptions,</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// however these are currently considered to be unimportant.</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ad20eb2456d446869820a1e7e385fe99f">ARCInstKind::NoopCast</a>:</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">    ++NumNoops;</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Erasing no-op cast: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Inst);</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the pointer-to-weak-pointer is null, it&#39;s undefined behavior.</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a4b72e11620e2360a97726a1554da02d2">ARCInstKind::StoreWeak</a>:</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a63bc8a0dc53d47fec308f2a7a9b99562">ARCInstKind::LoadWeak</a>:</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a373746ca100ea4fff46f2b4046984e94">ARCInstKind::LoadWeakRetained</a>:</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a60d8a1ea9604d54c2d3ea2c9cc065980">ARCInstKind::InitWeak</a>:</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a03973369165e1763744e9f56672dddad">ARCInstKind::DestroyWeak</a>: &#123;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a4097309046dda09214babc993d35c679">IsNullOrUndef</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0))) &#123;</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()),</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>())),</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">                    CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewValue = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;A null pointer-to-weak-pointer is undefined behavior.&quot;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;\\nOld = &quot;</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">                 &lt;&lt; &#42;CI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nNew = &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewValue &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">      CI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewValue);</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">      CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2acd9d38bb7cd5940d441b3325fd7bb607">ARCInstKind::CopyWeak</a>:</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6e6325433672a751336dfd07c9a2cf54">ARCInstKind::MoveWeak</a>: &#123;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a4097309046dda09214babc993d35c679">IsNullOrUndef</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0)) ||</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/objcarc/#a4097309046dda09214babc993d35c679">IsNullOrUndef</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1))) &#123;</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()),</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>())),</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">                    CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewValue = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;A null pointer-to-weak-pointer is undefined behavior.&quot;</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;\\nOld = &quot;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">                 &lt;&lt; &#42;CI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nNew = &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewValue &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">      CI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewValue);</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">      CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>:</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OptimizeRetainRVCall(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Inst))</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">ARCInstKind::AutoreleaseRV</a>:</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">    OptimizeAutoreleaseRVCall(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Inst, Class);</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// objc&#95;autorelease(x) -&gt; objc&#95;release(x) if x is otherwise unused.</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a40e51f6d288f308e305b565c047ff3a7">IsAutorelease</a>(Class) &amp;&amp; Inst-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getArgOperand(0);</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">    Arg = <a href="/docs/api/groups/arcutilities/#gaf231df4dd6fb738c1f548aedb34ca81e">FindSingleUseIdentifiedObject</a>(Arg);</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg) &#123;</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">      ++NumAutoreleases;</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Create the declaration lazily.</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = Inst-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>();</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;Decl = EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644febab8e7b465df7c5979dc731d06e84ce2cf">ARCRuntimeEntryPointKind::Release</a>);</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewCall = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Decl, <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getArgOperand(0), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">                                           <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getIterator());</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">      NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(MDKindCache.get(<a href="/docs/api/namespaces/llvm/objcarc/#a749ec59e4812b00a3cf7e7036fb39c06ab1ec2e3fd61b7a763d9173e07016906c">ARCMDKindID::ImpreciseRelease</a>),</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, &#123;&#125;));</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Replacing autorelease&#123;,RV&#125;(x) with objc&#95;release(x) &quot;</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;since x is otherwise unused.\\nOld: &quot;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">                        &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nNew: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewCall &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">      Inst = NewCall;</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a> = <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a>;</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For functions which can never be passed stack arguments, add</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a tail keyword.</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a392f31f4801522bd6062e369302d83a1">IsAlwaysTail</a>(Class) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst)-&gt;isNoTailCall()) &#123;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding tail keyword to function since it can never be &quot;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot;passed stack args: &quot;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">               &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst)-&gt;setTailCall();</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure that functions that can never have a &quot;tail&quot; keyword due to the</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// semantics of ARC truly do not do so.</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a38d5511a0458d8611ae8194db9f31e34">IsNeverTail</a>(Class)) &#123;</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Removing tail keyword from function: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst)-&gt;setTailCall(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set nounwind as needed.</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#aab5dadb7739df912c9522e75271c6984">IsNoThrow</a>(Class)) &#123;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found no throw class. Setting nounwind on: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst)-&gt;setDoesNotThrow();</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: This catches instructions unrelated to ARC.</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/objcarc/#adbe453c6ce7ea8e13eb18939197edeaf">IsNoopOnNull</a>(Class)) &#123;</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">    UsedInThisFunction |= 1 &lt;&lt; unsigned(Class);</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we haven&#39;t already looked up the root, look it up now.</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Arg)</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">    Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(Inst);</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ARC calls with null are no-ops. Delete them.</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a4097309046dda09214babc993d35c679">IsNullOrUndef</a>(Arg)) &#123;</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">    ++NumNoops;</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;ARC calls with  null are no-ops. Erasing: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Inst);</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track of which of retain, release, autorelease, and retain&#95;block</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are actually present in this function.</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  UsedInThisFunction |= 1 &lt;&lt; unsigned(Class);</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If Arg is a PHI, and one or more incoming values to the</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI are null, and the call is control-equivalent to the PHI, and there</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are no relevant side effects between the PHI and the call, and the call</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is not a release that doesn&#39;t have the clang.imprecise&#95;release tag, the</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call could be pushed up to just those paths with non-null incoming</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values. For now, don&#39;t bother splitting critical edges for this.</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a> &amp;&amp;</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">      !Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(MDKindCache.get(<a href="/docs/api/namespaces/llvm/objcarc/#a749ec59e4812b00a3cf7e7036fb39c06ab1ec2e3fd61b7a763d9173e07016906c">ARCMDKindID::ImpreciseRelease</a>)))</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;Instruction &#42;, const Value &#42;&gt;</a>, 4&gt; Worklist;</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(std::make&#95;pair(Inst, Arg));</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">    std::pair&lt;Instruction &#42;, const Value &#42;&gt; Pair = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">    Inst = Pair.first;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">    Arg = Pair.second;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Arg);</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN)</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if the PHI has any null operands, or any incoming</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// critical edges.</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNull = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasCriticalEdges = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a> = <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">GetRCIdentityRoot</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i));</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a4097309046dda09214babc993d35c679">IsNullOrUndef</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">        HasNull = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i)-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() !=</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">               1) &#123;</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">        HasCriticalEdges = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have null operands and no critical edges, optimize.</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasCriticalEdges)</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasNull)</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DepInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that there is nothing that cares about the reference</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// count between the call and the phi.</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Class) &#123;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aafece4245269582cb2f1009d4fb52047">ARCInstKind::Retain</a>:</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa5c9c22c7dedc1f8dd1d75b7c04460a9">ARCInstKind::RetainBlock</a>:</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// These can always be moved up.</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a>:</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// These can&#39;t be moved across things that care about the retain</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// count.</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">      DepInst = <a href="/docs/api/namespaces/llvm/objcarc/#a7a6c1dfa9b656660119d858a64521570">findSingleDependency</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a353f4c1f85416c596ecaa9c4d5afca75ae9cb4656651e6d8f4748dac4bbe1b361">NeedsPositiveRetainCount</a>, Arg,</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">                                     Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), Inst, PA);</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a61710f61a521b1544f5f7ab5abac843d">ARCInstKind::Autorelease</a>:</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// These can&#39;t be moved across autorelease pool scope boundaries.</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">      DepInst = <a href="/docs/api/namespaces/llvm/objcarc/#a7a6c1dfa9b656660119d858a64521570">findSingleDependency</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a353f4c1f85416c596ecaa9c4d5afca75ac6640fbd8b830536b76f884208bb53aa">AutoreleasePoolBoundary</a>, Arg,</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">                                     Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), Inst, PA);</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ae490705e8a3fd75e76afa1108289c24a">ARCInstKind::UnsafeClaimRV</a>:</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>:</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">ARCInstKind::AutoreleaseRV</a>:</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t move these; the RV optimization depends on the autoreleaseRV</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// being tail called, and the retainRV being immediately after a call</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (which might still happen if we get lucky with codegen layout, but</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it&#39;s not worth taking the chance).</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Invalid dependence flavor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DepInst != PN)</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">    ++NumPartialNoops;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clone the call into each predecessor that has a non-null value.</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ParamTy = CInst-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a> = <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">GetRCIdentityRoot</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i));</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a4097309046dda09214babc993d35c679">IsNullOrUndef</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i);</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos =</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">          PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2d071e661a02790177ba05f62c7c27d1">back</a>().<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">      cloneOpBundlesIf(CInst, OpBundles, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/operandbundleuse">OperandBundleUse</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getTagID() != <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca8997c6b0930e2c05209e95e7172c6cf3">LLVMContext::OB&#95;funclet</a>;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">      addOpBundleForFunclet(InsertPos-&gt;getParent(), OpBundles);</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;Clone = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(CInst, OpBundles);</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType() != ParamTy)</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, ParamTy, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, InsertPos);</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">      Clone-&gt;<a href="/docs/api/classes/llvm/callbase/#abc10b887caad109288ffceb230493a85">setArgOperand</a>(0, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">      Clone-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&#42;InsertPos-&gt;getParent(), InsertPos);</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cloning &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;CInst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">                                                   </span><span class="doxyHighlightStringLiteral">&quot;And inserting clone at &quot;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">                        &lt;&lt; &#42;InsertPos &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(std::make&#95;pair(Clone, <a href="/docs/api/structs/llvm/incoming">Incoming</a>));</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Erase the original call.</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Erasing: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;CInst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(CInst);</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>());</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlightComment">/// If we have a top down pointer in the S&#95;Use state, make sure that there are</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlightComment">/// no CFG hazards by checking the states of various bottom up pointers.</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173" lineLink="/docs/api/groups/arcopt/#ga3a319b49d26b9794c0cf855627fc36fa"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga3a319b49d26b9794c0cf855627fc36fa">CheckForUseCFGHazard</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306d">Sequence</a> SuccSSeq,</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SuccSRRIKnownSafe,</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">                                 <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;S,</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;SomeSuccHasSame,</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;AllSuccsHaveSame,</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;NotAllSeqEqualButKnownSafe,</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;ShouldContinue) &#123;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (SuccSSeq) &#123;</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8902051603b385fb4587620a0650b4f7">S&#95;CanRelease</a>: &#123;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#aee65472e4d66de6d1d50f8e54fdcf54c">IsKnownSafe</a>() &amp;&amp; !SuccSRRIKnownSafe) &#123;</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">      S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#ae5dabd431e08a0ca459d9d5ac9ef3709">ClearSequenceProgress</a>();</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">    S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a11a0f02bf705457f683e5607b1fd3e29">SetCFGHazardAfflicted</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">    ShouldContinue = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8e1b337cadca1fc899129d307df7d68e">S&#95;Use</a>:</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    SomeSuccHasSame = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daadd43d88dff4dfb5f9620f2151822b64">S&#95;Stop</a>:</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daff34dfb06d8316048c533bac105bfbe6">S&#95;MovableRelease</a>:</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#aee65472e4d66de6d1d50f8e54fdcf54c">IsKnownSafe</a>() &amp;&amp; !SuccSRRIKnownSafe)</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">      AllSuccsHaveSame = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">      NotAllSeqEqualButKnownSafe = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daac10e4a5d85a196bcb2578c2700f3ff3">S&#95;Retain</a>:</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;bottom-up pointer in retain state!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da6e431a7ec0fee74cc2ae9a79bd965122">S&#95;None</a>:</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;This should have been handled earlier.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlightComment">/// If we have a Top Down pointer in the S&#95;CanRelease state, make sure that</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlightComment">/// there are no CFG hazards by checking the states of various bottom up</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlightComment">/// pointers.</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210" lineLink="/docs/api/groups/arcopt/#ga5fd3f0408257b1a0df4a029c9b133d6c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga5fd3f0408257b1a0df4a029c9b133d6c">CheckForCanReleaseCFGHazard</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306d">Sequence</a> SuccSSeq,</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SuccSRRIKnownSafe,</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">                                        <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;S,</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;SomeSuccHasSame,</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;AllSuccsHaveSame,</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;NotAllSeqEqualButKnownSafe) &#123;</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (SuccSSeq) &#123;</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8902051603b385fb4587620a0650b4f7">S&#95;CanRelease</a>:</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">    SomeSuccHasSame = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daadd43d88dff4dfb5f9620f2151822b64">S&#95;Stop</a>:</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daff34dfb06d8316048c533bac105bfbe6">S&#95;MovableRelease</a>:</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8e1b337cadca1fc899129d307df7d68e">S&#95;Use</a>:</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#aee65472e4d66de6d1d50f8e54fdcf54c">IsKnownSafe</a>() &amp;&amp; !SuccSRRIKnownSafe)</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">      AllSuccsHaveSame = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">      NotAllSeqEqualButKnownSafe = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daac10e4a5d85a196bcb2578c2700f3ff3">S&#95;Retain</a>:</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;bottom-up pointer in retain state!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da6e431a7ec0fee74cc2ae9a79bd965122">S&#95;None</a>:</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;This should have been handled earlier.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlightComment">/// Check for critical edges, loop boundaries, irreducible control flow, or</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlightComment">/// other CFG structures where moving code across the edge would result in it</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlightComment">/// being executed more.</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">ObjCARCOpt::CheckForCFGHazards(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">                               <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;MyStates)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If any top-down local-use or possible-dec has a succ which is earlier in</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the sequence, forget it.</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MyStates.top&#95;down&#95;ptr&#95;begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = MyStates.top&#95;down&#95;ptr&#95;end();</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;S = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306d">Sequence</a> Seq = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.GetSeq();</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We only care about S&#95;Retain, S&#95;CanRelease, and S&#95;Use.</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Seq == <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da6e431a7ec0fee74cc2ae9a79bd965122">S&#95;None</a>)</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure that if extra top down states are added in the future that this</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// code is updated to handle it.</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Seq == <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daac10e4a5d85a196bcb2578c2700f3ff3">S&#95;Retain</a> || Seq == <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8902051603b385fb4587620a0650b4f7">S&#95;CanRelease</a> || Seq == <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8e1b337cadca1fc899129d307df7d68e">S&#95;Use</a>) &amp;&amp;</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unknown top down sequence state.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SomeSuccHasSame = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllSuccsHaveSame = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NotAllSeqEqualButKnownSafe = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB)) &#123;</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If VisitBottomUp has pointer information for this successor, take</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// what we know about it.</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;::iterator</a> BBI =</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">          BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Succ);</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BBI != BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/objcarc/bottomupptrstate">BottomUpPtrState</a> &amp;SuccS = BBI-&gt;second.getPtrBottomUpState(Arg);</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306d">Sequence</a> SuccSSeq = SuccS.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a1488167d90017e45843bfae0b00aaf49">GetSeq</a>();</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If bottom up, the pointer is in an S&#95;None state, clear the sequence</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// progress since the sequence in the bottom up state finished</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// suggesting a mismatch in between retains/releases. This is true for</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// all three cases that we are handling here: S&#95;Retain, S&#95;Use, and</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// S&#95;CanRelease.</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccSSeq == <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da6e431a7ec0fee74cc2ae9a79bd965122">S&#95;None</a>) &#123;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">        S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#ae5dabd431e08a0ca459d9d5ac9ef3709">ClearSequenceProgress</a>();</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we have S&#95;Use or S&#95;CanRelease, perform our check for cfg hazard</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// checks.</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SuccSRRIKnownSafe = SuccS.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#aee65472e4d66de6d1d50f8e54fdcf54c">IsKnownSafe</a>();</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#42;NOTE&#42; We do not use Seq from above here since we are allowing for</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// S.GetSeq() to change while we are visiting basic blocks.</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight">(S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a1488167d90017e45843bfae0b00aaf49">GetSeq</a>()) &#123;</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8e1b337cadca1fc899129d307df7d68e">S&#95;Use</a>: &#123;</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ShouldContinue = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#ga3a319b49d26b9794c0cf855627fc36fa">CheckForUseCFGHazard</a>(SuccSSeq, SuccSRRIKnownSafe, S, SomeSuccHasSame,</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">                             AllSuccsHaveSame, NotAllSeqEqualButKnownSafe,</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">                             ShouldContinue);</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShouldContinue)</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da8902051603b385fb4587620a0650b4f7">S&#95;CanRelease</a>:</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#ga5fd3f0408257b1a0df4a029c9b133d6c">CheckForCanReleaseCFGHazard</a>(SuccSSeq, SuccSRRIKnownSafe, S,</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">                                    SomeSuccHasSame, AllSuccsHaveSame,</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">                                    NotAllSeqEqualButKnownSafe);</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daac10e4a5d85a196bcb2578c2700f3ff3">S&#95;Retain</a>:</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306da6e431a7ec0fee74cc2ae9a79bd965122">S&#95;None</a>:</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daadd43d88dff4dfb5f9620f2151822b64">S&#95;Stop</a>:</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daff34dfb06d8316048c533bac105bfbe6">S&#95;MovableRelease</a>:</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the state at the other end of any of the successor edges</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// matches the current state, require all edges to match. This</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// guards against loops in the middle of a sequence.</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SomeSuccHasSame &amp;&amp; !AllSuccsHaveSame) &#123;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">      S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#ae5dabd431e08a0ca459d9d5ac9ef3709">ClearSequenceProgress</a>();</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NotAllSeqEqualButKnownSafe) &#123;</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we would have cleared the state foregoing the fact that we are known</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// safe, stop code motion. This is because whether or not it is safe to</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// remove RR pairs via KnownSafe is an orthogonal concept to whether we</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// are allowed to perform code motion.</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">      S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a11a0f02bf705457f683e5607b1fd3e29">SetCFGHazardAfflicted</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::VisitInstructionBottomUp(</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;MyStates) &#123;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NestingDetected = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a> = <a href="/docs/api/namespaces/llvm/objcarc/#a92ed436b80d7666f785e46f7e9aa3e82">GetARCInstKind</a>(Inst);</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        Class: &quot;</span><span class="doxyHighlight"> &lt;&lt; Class &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Class) &#123;</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a>: &#123;</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">    Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(Inst);</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/bottomupptrstate">BottomUpPtrState</a> &amp;S = MyStates.getPtrBottomUpState(Arg);</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">    NestingDetected |= S.<a href="/docs/api/structs/llvm/objcarc/bottomupptrstate/#a0b6f153e14da3299ec487acbf39e22ae">InitBottomUp</a>(MDKindCache, Inst);</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa5c9c22c7dedc1f8dd1d75b7c04460a9">ARCInstKind::RetainBlock</a>:</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In OptimizeIndividualCalls, we have strength reduced all optimizable</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// objc&#95;retainBlocks to objc&#95;retains. Thus at this point any</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// objc&#95;retainBlocks that we see are not optimizable.</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aafece4245269582cb2f1009d4fb52047">ARCInstKind::Retain</a>:</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>: &#123;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">    Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(Inst);</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/bottomupptrstate">BottomUpPtrState</a> &amp;S = MyStates.getPtrBottomUpState(Arg);</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.<a href="/docs/api/structs/llvm/objcarc/bottomupptrstate/#a91ef366645fbd66f709174e3b396fb92">MatchWithRetain</a>()) &#123;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t do retain+release tracking for ARCInstKind::RetainRV, because</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it&#39;s better to let it remain as the first instruction after a call.</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class != <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>) &#123;</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        Matching with: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">        Retains&#91;Inst&#93; = S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a60e312a27952f9db561a969d47cf496b">GetRRInfo</a>();</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">      S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#ae5dabd431e08a0ca459d9d5ac9ef3709">ClearSequenceProgress</a>();</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A retain moving bottom up can be a use.</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a4ee466dcf60bef3376060be50d45cdda">ARCInstKind::AutoreleasepoolPop</a>:</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Conservatively, clear MyStates for all known pointers.</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">    MyStates.clearBottomUpPointers();</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NestingDetected;</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a56a1f8ca583bf2a38d53b7e7825bd269">ARCInstKind::AutoreleasepoolPush</a>:</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6adf97f83acf6453d4a6a4b1070f3754">ARCInstKind::None</a>:</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// These are irrelevant.</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NestingDetected;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consider any other possible effects of this instruction on each</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointer being tracked.</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = MyStates.bottom&#95;up&#95;ptr&#95;begin(),</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">            ME = MyStates.bottom&#95;up&#95;ptr&#95;end();</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME; ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;first;</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == Arg)</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Handled above.</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/bottomupptrstate">BottomUpPtrState</a> &amp;S = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;second;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.<a href="/docs/api/structs/llvm/objcarc/bottomupptrstate/#a004bf866c0303839642a34b82e15eee5">HandlePotentialAlterRefCount</a>(Inst, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, PA, Class))</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">    S.<a href="/docs/api/structs/llvm/objcarc/bottomupptrstate/#a92756d26ffe5c46811ee48f629857ba2">HandlePotentialUse</a>(BB, Inst, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, PA, Class);</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NestingDetected;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::VisitBottomUp(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains) &#123;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n== ObjCARCOpt::VisitBottomUp ==\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NestingDetected = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;MyStates = BBStates&#91;BB&#93;;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Merge the states from each successor to compute the initial state</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for the current block.</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">BBState::edge&#95;iterator</a> <a href="/docs/api/namespaces/llvm/si">SI</a>(MyStates.succ&#95;begin()),</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">                         SE(MyStates.succ&#95;end());</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a> != SE) &#123;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>;</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Succ);</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">    MyStates.InitFromSucc(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">    ++<a href="/docs/api/namespaces/llvm/si">SI</a>;</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; <a href="/docs/api/namespaces/llvm/si">SI</a> != SE; ++<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">      Succ = &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>;</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Succ);</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">      MyStates.MergeSucc(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Before:\\n&quot;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">                    &lt;&lt; BBStates&#91;BB&#93; &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Performing Dataflow:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Visit all the instructions, bottom-up.</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = &amp;&#42;std::prev(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Invoke instructions are visited as part of their successors (below).</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(Inst))</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Visiting &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">    NestingDetected |= VisitInstructionBottomUp(Inst, BB, Retains, MyStates);</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bail out if the number of pointers being tracked becomes too large so</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that this pass can complete in a reasonable amount of time.</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MyStates.bottom&#95;up&#95;ptr&#95;list&#95;size() &gt; <a href="#a89d4e9815aa179f229cb8ba702199cb7">MaxPtrStates</a>) &#123;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">      DisableRetainReleasePairing = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there&#39;s a predecessor with an invoke, visit the invoke as if it were</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// part of this block, since we can&#39;t insert code after an invoke in its own</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block, and we don&#39;t want to split critical edges.</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">BBState::edge&#95;iterator</a> PI(MyStates.pred&#95;begin()),</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">       PE(MyStates.pred&#95;end()); PI != PE; ++PI) &#123;</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = &#42;PI;</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(&amp;Pred-&gt;back()))</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">      NestingDetected |= VisitInstructionBottomUp(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, BB, Retains, MyStates);</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nFinal State:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; BBStates&#91;BB&#93; &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NestingDetected;</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlightComment">// Fill ReleaseInsertPtToRCIdentityRoots, which is a map from insertion points</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlightComment">// to the set of RC identity roots that would be released by the release calls</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlightComment">// moved to the insertion points.</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463" lineLink="/docs/api/groups/arcopt/#gaa18296f3a634bc237e15fe2a5dd18820"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa18296f3a634bc237e15fe2a5dd18820">collectReleaseInsertPts</a>(</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a>&gt;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">        &amp;ReleaseInsertPtToRCIdentityRoots) &#123;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : Retains) &#123;</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Retains is a map from an objc&#95;retain call to a RRInfo of the RC identity</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// root of the call. Get the RC identity root of the objc&#95;retain call.</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.first);</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Root = <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">GetRCIdentityRoot</a>(<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect all the insertion points of the objc&#95;release calls that release</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the RC identity root of the objc&#95;retain call.</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.second.ReverseInsertPts)</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">      ReleaseInsertPtToRCIdentityRoots&#91;InsertPt&#93;.insert(Root);</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlightComment">// Get the RC identity roots from an insertion point of an objc&#95;release call.</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlightComment">// Return nullptr if the passed instruction isn&#39;t an insertion point.</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a> &#42;</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482" lineLink="/docs/api/groups/arcopt/#gadf63a31ac3181d8ff195fa4f459725a7"><span class="doxyHighlight"><a href="/docs/api/groups/arcopt/#gadf63a31ac3181d8ff195fa4f459725a7">getRCIdentityRootsFromReleaseInsertPt</a>(</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt,</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a>&gt;</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">        &amp;ReleaseInsertPtToRCIdentityRoots) &#123;</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ReleaseInsertPtToRCIdentityRoots.find(InsertPt);</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == ReleaseInsertPtToRCIdentityRoots.end())</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::VisitInstructionTopDown(</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases, <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;MyStates,</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a>&gt;</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">        &amp;ReleaseInsertPtToRCIdentityRoots) &#123;</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NestingDetected = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a> = <a href="/docs/api/namespaces/llvm/objcarc/#a92ed436b80d7666f785e46f7e9aa3e82">GetARCInstKind</a>(Inst);</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure a call to objc&#95;retain isn&#39;t moved past insertion points of calls</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to objc&#95;release.</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a> &#42;Roots =</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gadf63a31ac3181d8ff195fa4f459725a7">getRCIdentityRootsFromReleaseInsertPt</a>(</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">              Inst, ReleaseInsertPtToRCIdentityRoots))</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Root : &#42;Roots) &#123;</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;S = MyStates.getPtrTopDownState(Root);</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Disable code motion if the current position is S&#95;Retain to prevent</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// moving the objc&#95;retain call past objc&#95;release calls. If it&#39;s</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// S&#95;CanRelease or larger, it&#39;s not necessary to disable code motion as</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the insertion points that prevent the objc&#95;retain call from moving down</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// should have been set already.</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a1488167d90017e45843bfae0b00aaf49">GetSeq</a>() == <a href="/docs/api/namespaces/llvm/objcarc/#a845b8f76f8bd22e4e2eb851121db306daac10e4a5d85a196bcb2578c2700f3ff3">S&#95;Retain</a>)</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">        S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a11a0f02bf705457f683e5607b1fd3e29">SetCFGHazardAfflicted</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        Class: &quot;</span><span class="doxyHighlight"> &lt;&lt; Class &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Class) &#123;</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa5c9c22c7dedc1f8dd1d75b7c04460a9">ARCInstKind::RetainBlock</a>:</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In OptimizeIndividualCalls, we have strength reduced all optimizable</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// objc&#95;retainBlocks to objc&#95;retains. Thus at this point any</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// objc&#95;retainBlocks that we see are not optimizable. We need to break since</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a retain can be a potential use.</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aafece4245269582cb2f1009d4fb52047">ARCInstKind::Retain</a>:</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>: &#123;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">    Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(Inst);</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;S = MyStates.getPtrTopDownState(Arg);</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">    NestingDetected |= S.<a href="/docs/api/structs/llvm/objcarc/topdownptrstate/#a5e7821981d45cb3fada161fbd0b5b3ae">InitTopDown</a>(Class, Inst);</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A retain can be a potential use; proceed to the generic checking</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// code below.</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a>: &#123;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">    Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(Inst);</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;S = MyStates.getPtrTopDownState(Arg);</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to form a tentative pair in between this release instruction and the</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// top down pointers that we are tracking.</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.<a href="/docs/api/structs/llvm/objcarc/topdownptrstate/#a58e7f78b0c740eb2f30b8a24ee170f7a">MatchWithRelease</a>(MDKindCache, Inst)) &#123;</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we succeed, copy S&#39;s RRInfo into the Release -&gt; &#123;Retain Set</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Map&#125;. Then we clear S.</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;        Matching with: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">      Releases&#91;Inst&#93; = S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#a60e312a27952f9db561a969d47cf496b">GetRRInfo</a>();</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">      S.<a href="/docs/api/classes/llvm/objcarc/ptrstate/#ae5dabd431e08a0ca459d9d5ac9ef3709">ClearSequenceProgress</a>();</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a4ee466dcf60bef3376060be50d45cdda">ARCInstKind::AutoreleasepoolPop</a>:</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Conservatively, clear MyStates for all known pointers.</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">    MyStates.clearTopDownPointers();</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a56a1f8ca583bf2a38d53b7e7825bd269">ARCInstKind::AutoreleasepoolPush</a>:</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6adf97f83acf6453d4a6a4b1070f3754">ARCInstKind::None</a>:</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// These can not be uses of</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consider any other possible effects of this instruction on each</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointer being tracked.</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = MyStates.top&#95;down&#95;ptr&#95;begin(),</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">            ME = MyStates.top&#95;down&#95;ptr&#95;end();</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != ME; ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;first;</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == Arg)</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Handled above.</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/topdownptrstate">TopDownPtrState</a> &amp;S = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;second;</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.<a href="/docs/api/structs/llvm/objcarc/topdownptrstate/#acf48e56d2e2614373b53f03c5bd3c4b8">HandlePotentialAlterRefCount</a>(Inst, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, PA, Class, &#42;BundledInsts))</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">    S.<a href="/docs/api/structs/llvm/objcarc/topdownptrstate/#ad0da3c507a530abd23de4894502b3199">HandlePotentialUse</a>(Inst, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, PA, Class);</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NestingDetected;</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::VisitTopDown(</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases,</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 2&gt;</a>&gt;</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">        &amp;ReleaseInsertPtToRCIdentityRoots) &#123;</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n== ObjCARCOpt::VisitTopDown ==\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NestingDetected = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;MyStates = BBStates&#91;BB&#93;;</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Merge the states from each predecessor to compute the initial state</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for the current block.</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">BBState::edge&#95;iterator</a> PI(MyStates.pred&#95;begin()),</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">                         PE(MyStates.pred&#95;end());</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PI != PE) &#123;</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = &#42;PI;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Pred);</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">    MyStates.InitFromPred(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">    ++PI;</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; PI != PE; ++PI) &#123;</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">      Pred = &#42;PI;</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Pred);</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BBStates.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">      MyStates.MergePred(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that BB and MyStates have the same number of predecessors. This</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// prevents retain calls that live outside a loop from being moved into the</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop.</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a526630ff85b48f29ac5b4c519c6c2243">hasNPredecessors</a>(MyStates.pred&#95;end() - MyStates.pred&#95;begin()))</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MyStates.top&#95;down&#95;ptr&#95;begin(),</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = MyStates.top&#95;down&#95;ptr&#95;end();</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.SetCFGHazardAfflicted(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Before:\\n&quot;</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">                    &lt;&lt; BBStates&#91;BB&#93; &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Performing Dataflow:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Visit all the instructions, top-down.</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : &#42;BB) &#123;</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Visiting &quot;</span><span class="doxyHighlight"> &lt;&lt; Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">    NestingDetected |= VisitInstructionTopDown(</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">        &amp;Inst, Releases, MyStates, ReleaseInsertPtToRCIdentityRoots);</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bail out if the number of pointers being tracked becomes too large so</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that this pass can complete in a reasonable amount of time.</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MyStates.top&#95;down&#95;ptr&#95;list&#95;size() &gt; <a href="#a89d4e9815aa179f229cb8ba702199cb7">MaxPtrStates</a>) &#123;</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">      DisableRetainReleasePairing = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nState Before Checking for CFG Hazards:\\n&quot;</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">                    &lt;&lt; BBStates&#91;BB&#93; &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  CheckForCFGHazards(BB, BBStates, MyStates);</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Final State:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; BBStates&#91;BB&#93; &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NestingDetected;</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641" lineLink="/docs/api/groups/arcopt/#gac3778bafa67cdae223698e5bba785a76"><span class="doxyHighlight"><a href="/docs/api/groups/arcopt/#gac3778bafa67cdae223698e5bba785a76">ComputePostOrders</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;PostOrder,</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;ReverseCFGPostOrder,</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NoObjCARCExceptionsMDKind,</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates) &#123;</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlightComment">  /// The visited set, for doing DFS walks.</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> Visited;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do DFS, computing the PostOrder.</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> OnStack;</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;BasicBlock &#42;, succ&#95;iterator&gt;</a>, 16&gt; SuccStack;</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Functions always have exactly one entry block, and we don&#39;t have</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any other block that we treat like an entry block.</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EntryBB = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock();</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;MyStates = BBStates&#91;EntryBB&#93;;</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">  MyStates.SetAsEntry();</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;EntryTI = EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">  SuccStack.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(std::make&#95;pair(EntryBB, <a href="/docs/api/namespaces/llvm/#acc56362e89d398a34b5da66ddedb5448">succ&#95;iterator</a>(EntryTI)));</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">  Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(EntryBB);</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">  OnStack.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(EntryBB);</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">  dfs&#95;next&#95;succ:</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrBB = SuccStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().first;</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#acc56362e89d398a34b5da66ddedb5448">succ&#95;iterator</a> SE(CurrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (SuccStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second != SE) &#123;</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB = &#42;SuccStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second++;</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(SuccBB).second) &#123;</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">        SuccStack.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">            std::make&#95;pair(SuccBB, <a href="/docs/api/namespaces/llvm/#acc56362e89d398a34b5da66ddedb5448">succ&#95;iterator</a>(SuccBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())));</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">        BBStates&#91;CurrBB&#93;.addSucc(SuccBB);</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;SuccStates = BBStates&#91;SuccBB&#93;;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">        SuccStates.addPred(CurrBB);</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">        OnStack.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(SuccBB);</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> dfs&#95;next&#95;succ;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OnStack.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(SuccBB)) &#123;</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">        BBStates&#91;CurrBB&#93;.addSucc(SuccBB);</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">        BBStates&#91;SuccBB&#93;.addPred(CurrBB);</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">    OnStack.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(CurrBB);</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">    PostOrder.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurrBB);</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">    SuccStack.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#ad97688dfe9cd802e2a0691cbe620218a">pop&#95;back</a>();</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!SuccStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>());</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">  Visited.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do reverse-CFG DFS, computing the reverse-CFG PostOrder.</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Functions may have many exits, and there also blocks which we treat</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as exits due to ignored edges.</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;BasicBlock &#42;, BBState::edge&#95;iterator&gt;</a>, 16&gt; PredStack;</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;ExitBB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;MyStates = BBStates&#91;&amp;ExitBB&#93;;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MyStates.isExit())</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">    MyStates.SetAsExit();</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">    PredStack.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(std::make&#95;pair(&amp;ExitBB, MyStates.pred&#95;begin()));</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">    Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;ExitBB);</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!PredStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">    reverse&#95;dfs&#95;next&#95;succ:</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a535a25253435b7af798da77f854d5cc3">BBState::edge&#95;iterator</a> PE = BBStates&#91;PredStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().first&#93;.pred&#95;end();</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PredStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second != PE) &#123;</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = &#42;PredStack.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().second++;</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BB).second) &#123;</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">          PredStack.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(std::make&#95;pair(BB, BBStates&#91;BB&#93;.<a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#af9ca41414437da0262a799ea0d91eea6">pred&#95;begin</a>()));</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> reverse&#95;dfs&#95;next&#95;succ;</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">      ReverseCFGPostOrder.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredStack.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>().first);</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlightComment">// Visit the function both top-down and bottom-up.</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::Visit(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases) &#123;</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use reverse-postorder traversals, because we magically know that loops</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will be well behaved, i.e. they won&#39;t repeatedly call retain on a single</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointer without doing a release. We can&#39;t use the ReversePostOrderTraversal</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// class here because we want the reverse-CFG postorder to consider each</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function exit point, and we want to ignore selected cycle edges.</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 16&gt;</a> PostOrder;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 16&gt;</a> ReverseCFGPostOrder;</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gac3778bafa67cdae223698e5bba785a76">ComputePostOrders</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PostOrder, ReverseCFGPostOrder,</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">                    MDKindCache.get(<a href="/docs/api/namespaces/llvm/objcarc/#a749ec59e4812b00a3cf7e7036fb39c06adfb5efff844959d1f14f5450c9cefe8f">ARCMDKindID::NoObjCARCExceptions</a>),</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">                    BBStates);</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use reverse-postorder on the reverse CFG for bottom-up.</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BottomUpNestingDetected = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(ReverseCFGPostOrder)) &#123;</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">    BottomUpNestingDetected |= VisitBottomUp(BB, BBStates, Retains);</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DisableRetainReleasePairing)</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const Instruction &#42;, SmallPtrSet&lt;const Value &#42;, 2&gt;</a>&gt;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">      ReleaseInsertPtToRCIdentityRoots;</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa18296f3a634bc237e15fe2a5dd18820">collectReleaseInsertPts</a>(Retains, ReleaseInsertPtToRCIdentityRoots);</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use reverse-postorder for top-down.</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TopDownNestingDetected = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(PostOrder)) &#123;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">    TopDownNestingDetected |=</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">        VisitTopDown(BB, BBStates, Releases, ReleaseInsertPtToRCIdentityRoots);</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DisableRetainReleasePairing)</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TopDownNestingDetected &amp;&amp; BottomUpNestingDetected;</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlightComment">/// Move the calls in RetainsToMove and ReleasesToMove.</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> ObjCARCOpt::MoveCalls(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg, <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;RetainsToMove,</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">                           <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;ReleasesToMove,</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases,</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;DeadInsts,</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/module">Module</a> &#42;M) &#123;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;== ObjCARCOpt::MoveCalls ==\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert the new retain and release calls.</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt : ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>) &#123;</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;Decl = EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644febaafece4245269582cb2f1009d4fb52047">ARCRuntimeEntryPointKind::Retain</a>);</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> BundleList;</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">    addOpBundleForFunclet(InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), BundleList);</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> =</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Decl, Arg, BundleList, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setDoesNotThrow();</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setTailCall();</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inserting new Retain: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a></span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;At insertion point: &quot;</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">                      &lt;&lt; &#42;InsertPt &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt : RetainsToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>) &#123;</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;Decl = EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644febab8e7b465df7c5979dc731d06e84ce2cf">ARCRuntimeEntryPointKind::Release</a>);</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> BundleList;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">    addOpBundleForFunclet(InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), BundleList);</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> =</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Decl, Arg, BundleList, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Attach a clang.imprecise&#95;release metadata tag, if appropriate.</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;M = ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ab976ce410e551d37ce2f43177bb96995">ReleaseMetadata</a>)</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setMetadata(MDKindCache.get(<a href="/docs/api/namespaces/llvm/objcarc/#a749ec59e4812b00a3cf7e7036fb39c06ab1ec2e3fd61b7a763d9173e07016906c">ARCMDKindID::ImpreciseRelease</a>), M);</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setDoesNotThrow();</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac9afa1dadab0e6367ce487573142be4e">IsTailCallRelease</a>)</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setTailCall();</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inserting new Release: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a></span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;At insertion point: &quot;</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">                      &lt;&lt; &#42;InsertPt &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete the original retain and release calls.</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OrigRetain : RetainsToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>) &#123;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">    Retains.<a href="/docs/api/classes/llvm/blotmapvector/#a447fee52003ca0e778c9fa372c3143d1">blot</a>(OrigRetain);</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">    DeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OrigRetain);</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Deleting retain: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OrigRetain &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OrigRelease : ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>) &#123;</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">    Releases.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(OrigRelease);</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">    DeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OrigRelease);</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Deleting release: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OrigRelease &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::PairUpRetainsAndReleases(</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases, <a href="/docs/api/classes/llvm/module">Module</a> &#42;M,</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>,</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;DeadInsts, <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;RetainsToMove,</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;ReleasesToMove, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> KnownSafe,</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;AnyPairsCompletelyEliminated) &#123;</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If a pair happens in a region where it is known that the reference count</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is already incremented, we can similarly ignore possible decrements unless</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we are dealing with a retainable object with multiple provenance sources.</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> KnownSafeTD = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, KnownSafeBU = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CFGHazardAfflicted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Connect the dots between the top-down-collected RetainsToMove and</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bottom-up-collected ReleasesToMove to form sets of related calls.</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is an iterative process so that we connect multiple releases</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to multiple retains if needed.</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldDelta = 0;</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewDelta = 0;</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldCount = 0;</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewCount = 0;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FirstRelease = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> NewRetains&#123;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>&#125;;;) &#123;</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> NewReleases;</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewRetain : NewRetains) &#123;</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = Retains.<a href="/docs/api/classes/llvm/blotmapvector/#a73e3ded01b65ddc78347be07e1a87a29">find</a>(NewRetain);</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != Retains.<a href="/docs/api/classes/llvm/blotmapvector/#a858918a4b48c7fcb780817c1709c9d3f">end</a>());</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;NewRetainRRI = It-&gt;second;</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">      KnownSafeTD &amp;= NewRetainRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a5770bc64392d64b9900226f925521b94">KnownSafe</a>;</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">      CFGHazardAfflicted |= NewRetainRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac287dbb01fd38c21bbf0dafdbcfcb8cf">CFGHazardAfflicted</a>;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewRetainRelease : NewRetainRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>) &#123;</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Jt = Releases.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(NewRetainRelease);</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Jt == Releases.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;NewRetainReleaseRRI = Jt-&gt;second;</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the release does not have a reference to the retain as well,</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// something happened which is unaccounted for. Do not do anything.</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This can happen if we catch an additive overflow during path count</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// merging.</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewRetainReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>.count(NewRetain))</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>.insert(NewRetainRelease).second) &#123;</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If we overflow when we compute the path count, don&#39;t remove/move</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// anything.</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;NRRBBState = BBStates&#91;NewRetainRelease-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()&#93;;</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PathCount = <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a>;</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NRRBBState.GetAllPathCountWithOverflow(PathCount))</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PathCount != <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a> &amp;&amp;</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;PathCount at this point can not be &quot;</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;OverflowOccurredValue.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">          OldDelta -= PathCount;</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Merge the ReleaseMetadata and IsTailCallRelease values.</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstRelease) &#123;</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">            ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ab976ce410e551d37ce2f43177bb96995">ReleaseMetadata</a> =</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">              NewRetainReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ab976ce410e551d37ce2f43177bb96995">ReleaseMetadata</a>;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">            ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac9afa1dadab0e6367ce487573142be4e">IsTailCallRelease</a> =</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">              NewRetainReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac9afa1dadab0e6367ce487573142be4e">IsTailCallRelease</a>;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">            FirstRelease = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ab976ce410e551d37ce2f43177bb96995">ReleaseMetadata</a> !=</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">                NewRetainReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ab976ce410e551d37ce2f43177bb96995">ReleaseMetadata</a>)</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">              ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ab976ce410e551d37ce2f43177bb96995">ReleaseMetadata</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac9afa1dadab0e6367ce487573142be4e">IsTailCallRelease</a> !=</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">                NewRetainReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac9afa1dadab0e6367ce487573142be4e">IsTailCallRelease</a>)</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">              ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac9afa1dadab0e6367ce487573142be4e">IsTailCallRelease</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Collect the optimal insertion points.</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!KnownSafe)</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RIP : NewRetainReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>) &#123;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>.insert(RIP).second) &#123;</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// If we overflow when we compute the path count, don&#39;t</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// remove/move anything.</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;RIPBBState = BBStates&#91;RIP-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()&#93;;</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">                PathCount = <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a>;</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RIPBBState.GetAllPathCountWithOverflow(PathCount))</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PathCount != <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a> &amp;&amp;</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;PathCount at this point can not be &quot;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;OverflowOccurredValue.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">                NewDelta -= PathCount;</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">              &#125;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">          NewReleases.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NewRetainRelease);</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">    NewRetains.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewReleases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Back the other way.</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewRelease : NewReleases) &#123;</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = Releases.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(NewRelease);</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != Releases.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;NewReleaseRRI = It-&gt;second;</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">      KnownSafeBU &amp;= NewReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a5770bc64392d64b9900226f925521b94">KnownSafe</a>;</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">      CFGHazardAfflicted |= NewReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#ac287dbb01fd38c21bbf0dafdbcfcb8cf">CFGHazardAfflicted</a>;</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewReleaseRetain : NewReleaseRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>) &#123;</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Jt = Retains.<a href="/docs/api/classes/llvm/blotmapvector/#a73e3ded01b65ddc78347be07e1a87a29">find</a>(NewReleaseRetain);</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Jt == Retains.<a href="/docs/api/classes/llvm/blotmapvector/#a858918a4b48c7fcb780817c1709c9d3f">end</a>())</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> &amp;NewReleaseRetainRRI = Jt-&gt;second;</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the retain does not have a reference to the release as well,</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// something happened which is unaccounted for. Do not do anything.</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This can happen if we catch an additive overflow during path count</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// merging.</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewReleaseRetainRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>.count(NewRelease))</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RetainsToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#a937b2f49aeebc9752e9ff219acbd93f0">Calls</a>.insert(NewReleaseRetain).second) &#123;</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If we overflow when we compute the path count, don&#39;t remove/move</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// anything.</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;NRRBBState = BBStates&#91;NewReleaseRetain-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()&#93;;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PathCount = <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a>;</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NRRBBState.GetAllPathCountWithOverflow(PathCount))</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PathCount != <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a> &amp;&amp;</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;PathCount at this point can not be &quot;</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;OverflowOccurredValue.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">          OldDelta += PathCount;</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">          OldCount += PathCount;</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Collect the optimal insertion points.</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!KnownSafe)</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RIP : NewReleaseRetainRRI.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>) &#123;</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RetainsToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>.insert(RIP).second) &#123;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// If we overflow when we compute the path count, don&#39;t</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// remove/move anything.</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-objcarcopts-cpp-/bbstate/#a5bef84b7e585b367ff9881b532552560">BBState</a> &amp;RIPBBState = BBStates&#91;RIP-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()&#93;;</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">                PathCount = <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a>;</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RIPBBState.GetAllPathCountWithOverflow(PathCount))</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PathCount != <a href="/docs/api/groups/arcopt/#gaf049222c368a7cbc12109fbc79ce8f34">BBState::OverflowOccurredValue</a> &amp;&amp;</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;PathCount at this point can not be &quot;</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;OverflowOccurredValue.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">                NewDelta += PathCount;</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">                NewCount += PathCount;</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">              &#125;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">          NewRetains.push&#95;back(NewReleaseRetain);</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewRetains.empty()) </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only remove pointers if we are known safe in both directions.</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UnconditionallySafe = KnownSafeTD &amp;&amp; KnownSafeBU;</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnconditionallySafe) &#123;</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">    RetainsToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>.clear();</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>.clear();</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">    NewCount = 0;</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine whether the new insertion points we computed preserve the</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// balance of retain and release calls through the program.</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: If the fully aggressive solution isn&#39;t valid, try to find a</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// less aggressive solution which is.</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewDelta != 0)</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// At this point, we are not going to remove any RR pairs, but we still are</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// able to move RR pairs. If one of our pointers is afflicted with</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// CFGHazards, we cannot perform such code motion so exit early.</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> WillPerformCodeMotion =</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">        !RetainsToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>.empty() ||</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">        !ReleasesToMove.<a href="/docs/api/structs/llvm/objcarc/rrinfo/#aed932d067cad4f2d928df9bee21af52a">ReverseInsertPts</a>.empty();</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CFGHazardAfflicted &amp;&amp; WillPerformCodeMotion)</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine whether the original call points are balanced in the retain and</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// release calls through the program. If not, conservatively don&#39;t touch</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them.</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: It&#39;s theoretically possible to do code motion in this case, as</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// long as the existing imbalances are maintained.</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldDelta != 0)</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldCount != 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unreachable code?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">  NumRRs += OldCount - NewCount;</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set to true if we completely removed any RR pairs.</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">  AnyPairsCompletelyEliminated = NewCount == 0;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can move calls!</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlightComment">/// Identify pairings between the retains and releases, and delete and/or move</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlightComment">/// them.</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::PerformCodePlacement(</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> &amp;BBStates,</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> &amp;Retains,</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> &amp;Releases, <a href="/docs/api/classes/llvm/module">Module</a> &#42;M) &#123;</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n== ObjCARCOpt::PerformCodePlacement ==\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyPairsCompletelyEliminated = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> DeadInsts;</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Visit each retain.</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/blotmapvector/#a912153f3f439c544fff1d30b80d27659">BlotMapVector&lt;Value &#42;, RRInfo&gt;::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Retains.<a href="/docs/api/classes/llvm/blotmapvector/#afe9bb2d89b79c53645c7adef310b66f9">begin</a>(),</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">                                                      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Retains.<a href="/docs/api/classes/llvm/blotmapvector/#a858918a4b48c7fcb780817c1709c9d3f">end</a>();</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!V) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// blotted</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Visiting: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>);</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the object being released is in static or stack storage, we know it&#39;s</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// not being managed by ObjC reference counting, so we can delete pairs</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// regardless of what possible decrements or uses lie between them.</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> KnownSafe = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Arg) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(Arg);</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A constant pointer can&#39;t be pointing to an object on the heap. It may</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be reference-counted, but it won&#39;t be deleted.</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(Arg))</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV =</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">GetRCIdentityRoot</a>(LI-&gt;getPointerOperand())))</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GV-&gt;isConstant())</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">          KnownSafe = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Connect the dots between the top-down-collected RetainsToMove and</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bottom-up-collected ReleasesToMove to form sets of related calls.</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/objcarc/rrinfo">RRInfo</a> RetainsToMove, ReleasesToMove;</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PerformMoveCalls = PairUpRetainsAndReleases(</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">        BBStates, Retains, Releases, M, <a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>, DeadInsts,</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">        RetainsToMove, ReleasesToMove, Arg, KnownSafe,</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">        AnyPairsCompletelyEliminated);</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PerformMoveCalls) &#123;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ok, everything checks out and we&#39;re all set. Let&#39;s move/delete some</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// code!</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">      MoveCalls(Arg, RetainsToMove, ReleasesToMove,</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">                Retains, Releases, DeadInsts, M);</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we&#39;re done moving everything, we can delete the newly dead</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions, as we no longer need them as insert points.</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!DeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(DeadInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>());</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyPairsCompletelyEliminated;</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlightComment">/// Weak pointer optimizations.</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> ObjCARCOpt::OptimizeWeakCalls(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n== ObjCARCOpt::OptimizeWeakCalls ==\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, do memdep-style RLE and S2L optimizations. We can&#39;t use memdep</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// itself because it uses AliasAnalysis and we need to do provenance</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// queries instead.</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0c27cc387928f22d241825cf0fb67ade">inst&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst&#95;begin</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/namespaces/llvm/#a945cded5463e0ccd3cf5a6ac80542a94">inst&#95;end</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ) &#123;</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Visiting: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a> = <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(Inst);</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class != <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a63bc8a0dc53d47fec308f2a7a9b99562">ARCInstKind::LoadWeak</a> &amp;&amp;</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">        Class != <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a373746ca100ea4fff46f2b4046984e94">ARCInstKind::LoadWeakRetained</a>)</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Delete objc&#95;loadWeak calls with no users.</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a63bc8a0dc53d47fec308f2a7a9b99562">ARCInstKind::LoadWeak</a> &amp;&amp; Inst-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: For now, just look for an earlier available version of this value</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// within the same block. Theoretically, we could do memdep-style non-local</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// analysis too, but that would want caching. A better approach would be to</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// use the technique that EarlyCSE uses.</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a0c27cc387928f22d241825cf0fb67ade">inst&#95;iterator</a> Current = std::prev(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrentBB = &amp;&#42;Current.<a href="/docs/api/classes/llvm/institerator/#ab2213eb5902f7e6bafd336ff5653b83c">getBasicBlockIterator</a>();</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = CurrentBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">                              J = Current.<a href="/docs/api/classes/llvm/institerator/#ab179fcfbe78d52fc1c3f7d78ef796cbb">getInstructionIterator</a>();</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">         J != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>; --J) &#123;</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;EarlierInst = &amp;&#42;std::prev(J);</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> EarlierClass = <a href="/docs/api/namespaces/llvm/objcarc/#a92ed436b80d7666f785e46f7e9aa3e82">GetARCInstKind</a>(EarlierInst);</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (EarlierClass) &#123;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a63bc8a0dc53d47fec308f2a7a9b99562">ARCInstKind::LoadWeak</a>:</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a373746ca100ea4fff46f2b4046984e94">ARCInstKind::LoadWeakRetained</a>: &#123;</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this is loading from the same pointer, replace this load&#39;s value</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// with that one.</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;EarlierCall = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(EarlierInst);</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getArgOperand(0);</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;EarlierArg = EarlierCall-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0);</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (PA.getAA()-&gt;alias(Arg, EarlierArg)) &#123;</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57ac1a99a1af9a4778a61e5cc3e1d622180">AliasResult::MustAlias</a>:</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the load has a builtin retain, insert a plain retain for it.</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a373746ca100ea4fff46f2b4046984e94">ARCInstKind::LoadWeakRetained</a>) &#123;</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/function">Function</a> &#42;Decl = EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644febaafece4245269582cb2f1009d4fb52047">ARCRuntimeEntryPointKind::Retain</a>);</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI =</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Decl, EarlierCall, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getIterator());</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">            CI-&gt;<a href="/docs/api/classes/llvm/callinst/#acff66a4cb0efaafb728848edf097c75f">setTailCall</a>();</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Zap the fully redundant load.</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;replaceAllUsesWith(EarlierCall);</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> clobbered;</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57a0916b614598c673c1e6a59c7312a1409">AliasResult::MayAlias</a>:</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57a9e724bc94de38c6ca77508f19c246c0c">AliasResult::PartialAlias</a>:</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> clobbered;</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57a863ee317b92588eb2d6878af9fc98922">AliasResult::NoAlias</a>:</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a4b72e11620e2360a97726a1554da02d2">ARCInstKind::StoreWeak</a>:</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a60d8a1ea9604d54c2d3ea2c9cc065980">ARCInstKind::InitWeak</a>: &#123;</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this is storing to the same pointer and has the same size etc.</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// replace this load&#39;s value with the stored value.</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;EarlierCall = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(EarlierInst);</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getArgOperand(0);</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;EarlierArg = EarlierCall-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0);</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (PA.getAA()-&gt;alias(Arg, EarlierArg)) &#123;</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57ac1a99a1af9a4778a61e5cc3e1d622180">AliasResult::MustAlias</a>:</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the load has a builtin retain, insert a plain retain for it.</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a373746ca100ea4fff46f2b4046984e94">ARCInstKind::LoadWeakRetained</a>) &#123;</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/function">Function</a> &#42;Decl = EP.get(<a href="/docs/api/namespaces/llvm/objcarc/#aa4b95e1b6c59a75f558794b32b644febaafece4245269582cb2f1009d4fb52047">ARCRuntimeEntryPointKind::Retain</a>);</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI =</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Decl, EarlierCall, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getIterator());</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">            CI-&gt;<a href="/docs/api/classes/llvm/callinst/#acff66a4cb0efaafb728848edf097c75f">setTailCall</a>();</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Zap the fully redundant load.</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;replaceAllUsesWith(EarlierCall-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1));</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> clobbered;</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57a0916b614598c673c1e6a59c7312a1409">AliasResult::MayAlias</a>:</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57a9e724bc94de38c6ca77508f19c246c0c">AliasResult::PartialAlias</a>:</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> clobbered;</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/aliasresult/#a8d3de277fb70fa515efac2db2cfe9d57a863ee317b92588eb2d6878af9fc98922">AliasResult::NoAlias</a>:</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6e6325433672a751336dfd07c9a2cf54">ARCInstKind::MoveWeak</a>:</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2acd9d38bb7cd5940d441b3325fd7bb607">ARCInstKind::CopyWeak</a>:</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TOOD: Grab the copied value.</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> clobbered;</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a56a1f8ca583bf2a38d53b7e7825bd269">ARCInstKind::AutoreleasepoolPush</a>:</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6adf97f83acf6453d4a6a4b1070f3754">ARCInstKind::None</a>:</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2af635fed4a9fb967d38c264ed1106844f">ARCInstKind::IntrinsicUser</a>:</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">ARCInstKind::User</a>:</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Weak pointers are only modified through the weak entry points</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// (and arbitrary calls, which could call the weak entry points).</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Anything else could modify the weak pointer.</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> clobbered;</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">  clobbered:;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Then, for each destroyWeak with an alloca operand, check to see if</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the alloca and all its users can be zapped.</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))) &#123;</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a> = <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(&amp;Inst);</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Class != <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a03973369165e1763744e9f56672dddad">ARCInstKind::DestroyWeak</a>)</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(&amp;Inst);</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getArgOperand(0);</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(Arg)) &#123;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Alloca-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(UserInst)) &#123;</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a60d8a1ea9604d54c2d3ea2c9cc065980">ARCInstKind::InitWeak</a>:</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a4b72e11620e2360a97726a1554da02d2">ARCInstKind::StoreWeak</a>:</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a03973369165e1763744e9f56672dddad">ARCInstKind::DestroyWeak</a>:</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> done;</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(Alloca-&gt;users())) &#123;</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;UserInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(U);</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(UserInst)) &#123;</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a60d8a1ea9604d54c2d3ea2c9cc065980">ARCInstKind::InitWeak</a>:</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a4b72e11620e2360a97726a1554da02d2">ARCInstKind::StoreWeak</a>:</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// These functions return their second argument.</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">          UserInst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(UserInst-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1));</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a03973369165e1763744e9f56672dddad">ARCInstKind::DestroyWeak</a>:</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// No return value.</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;alloca really is used!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">        UserInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">      Alloca-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">    done:;</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlightComment">/// Identify program paths which execute sequences of retains and releases which</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlightComment">/// can be eliminated.</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ObjCARCOpt::OptimizeSequences(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Releases, Retains - These are used to store the results of the main flow</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// analysis. These use Value&#42; as the key instead of Instruction&#42; so that the</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// map stays valid when we get around to rewriting code and calls get</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replaced by arguments.</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, RRInfo&gt;</a> Releases;</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blotmapvector">BlotMapVector&lt;Value &#42;, RRInfo&gt;</a> Retains;</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is used during the traversal of the function to track the</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// states for each identified object at each block.</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const BasicBlock &#42;, BBState&gt;</a> BBStates;</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Analyze the CFG of the function, and all instructions.</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NestingDetected = Visit(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, BBStates, Retains, Releases);</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DisableRetainReleasePairing)</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transform.</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyPairsCompletelyEliminated = PerformCodePlacement(BBStates, Retains,</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">                                                           Releases,</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">                                                           <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AnyPairsCompletelyEliminated &amp;&amp; NestingDetected;</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlightComment">/// Check if there is a dependent call earlier that does not have anything in</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlightComment">/// between the Retain and the call that can affect the reference count of their</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlightComment">/// shared pointer argument. Note that Retain need not be in BB.</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265" lineLink="/docs/api/groups/arcopt/#gafda5d85d74da7b8294f1385aa8ab1b7c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#gafda5d85d74da7b8294f1385aa8ab1b7c">HasSafePathToPredecessorCall</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg,</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>,</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">                                              <a href="/docs/api/classes/provenanceanalysis">ProvenanceAnalysis</a> &amp;PA) &#123;</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a7a6c1dfa9b656660119d858a64521570">findSingleDependency</a>(</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/objcarc/#a353f4c1f85416c596ecaa9c4d5afca75a197563bb332a0ac8f6b578e8b6fcf0a7">CanChangeRetainCount</a>, Arg, <a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>-&gt;getParent(), <a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>, PA));</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that the pointer is the return value of the call.</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> || Arg != <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>)</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that the call is a regular call.</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> Class = <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a216b693ce70a5639bd2e33cdbb0d82d8">ARCInstKind::CallOrUser</a> || Class == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac3755e61202abd74da5885d2e9c9160e">ARCInstKind::Call</a></span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">             ? <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a></span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">             : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlightComment">/// Find a dependent retain that precedes the given autorelease for which there</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlightComment">/// is nothing in between the two instructions that can affect the ref count of</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlightComment">/// Arg.</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286" lineLink="/docs/api/groups/arcopt/#gadc60e99c9f1a1290990a039851b33df4"><span class="doxyHighlight"><a href="/docs/api/groups/arcopt/#gadc60e99c9f1a1290990a039851b33df4">FindPredecessorRetainWithSafePath</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>,</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">                                  <a href="/docs/api/classes/provenanceanalysis">ProvenanceAnalysis</a> &amp;PA) &#123;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/objcarc/#a7a6c1dfa9b656660119d858a64521570">findSingleDependency</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a353f4c1f85416c596ecaa9c4d5afca75a197563bb332a0ac8f6b578e8b6fcf0a7">CanChangeRetainCount</a>, Arg, BB, <a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>, PA));</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that we found a retain with the same argument.</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> || !<a href="/docs/api/namespaces/llvm/objcarc/#a349b82bbe060500b58c6ca86ac8b6ea6">IsRetain</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>)) ||</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>) != Arg) &#123;</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>;</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlightComment">/// Look for an &#96;&#96;autorelease&#39;&#39; instruction dependent on Arg such that there are</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlightComment">/// no instructions dependent on Arg that need a positive ref count in between</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlightComment">/// the autorelease and the ret.</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">FindPredecessorAutoreleaseWithSafePath(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;Ret,</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">                                       <a href="/docs/api/classes/provenanceanalysis">ProvenanceAnalysis</a> &amp;PA) &#123;</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 4&gt;</a> DepInsts;</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/objcarc/#a7a6c1dfa9b656660119d858a64521570">findSingleDependency</a>(<a href="/docs/api/namespaces/llvm/objcarc/#a353f4c1f85416c596ecaa9c4d5afca75ae9cb4656651e6d8f4748dac4bbe1b361">NeedsPositiveRetainCount</a>, Arg, BB, Ret, PA));</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>)</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">ARCInstKind</a> AutoreleaseClass = <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>);</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/objcarc/#a40e51f6d288f308e305b565c047ff3a7">IsAutorelease</a>(AutoreleaseClass))</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#aa76bc27e7a62bc63263463a83525948f">GetArgRCIdentityRoot</a>(<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>) != Arg)</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>;</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlightComment">/// Look for this pattern:</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlightComment">///    %call = call i8&#42; @something(...)</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlightComment">///    %2 = call i8&#42; @objc&#95;retain(i8&#42; %call)</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlightComment">///    %3 = call i8&#42; @objc&#95;autorelease(i8&#42; %2)</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlightComment">///    ret i8&#42; %3</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlightComment">/// And delete the retain and autorelease.</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> ObjCARCOpt::OptimizeReturns(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getReturnType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n== ObjCARCOpt::OptimizeReturns ==\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB: <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(&amp;BB.<a href="/docs/api/classes/llvm/basicblock/#a2d071e661a02790177ba05f62c7c27d1">back</a>());</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ret)</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Visiting: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Ret &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">GetRCIdentityRoot</a>(<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for an &#96;&#96;autorelease&#39;&#39; instruction that is a predecessor of Ret and</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dependent on Arg such that there are no instructions dependent on Arg</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that need a positive ref count in between the autorelease and Ret.</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349" lineLink="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a> =</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">        FindPredecessorAutoreleaseWithSafePath(Arg, &amp;BB, Ret, PA);</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352" lineLink="/docs/api/groups/arcopt/#ga94ba18a4a5cbf64d84b0c1a8f3a92468"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>)</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355" lineLink="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> = <a href="/docs/api/groups/arcopt/#gadc60e99c9f1a1290990a039851b33df4">FindPredecessorRetainWithSafePath</a>(</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">        Arg, <a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>-&gt;getParent(), <a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>, PA);</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>)</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that there is nothing that can affect the reference count</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// between the retain and the call.  Note that Retain need not be in BB.</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363" lineLink="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/groups/arcopt/#gafda5d85d74da7b8294f1385aa8ab1b7c">HasSafePathToPredecessorCall</a>(Arg, <a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>, PA);</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t remove retainRV/autoreleaseRV pairs if the call isn&#39;t a tail call.</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366" lineLink="/docs/api/groups/arcopt/#gabd5cfc217e8144536565097965fe05ab"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> ||</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">        (!<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;isTailCall() &amp;&amp;</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>) == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a> &amp;&amp;</span></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>) == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">ARCInstKind::AutoreleaseRV</a>))</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If so, we can zap the retain and autorelease.</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373" lineLink="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374" lineLink="/docs/api/groups/arcopt/#ga3e74fd1cf2a83ae4cf47d4fb0af4d07b"><span class="doxyHighlight">    ++<a href="/docs/api/groups/arcopt/#ga3e74fd1cf2a83ae4cf47d4fb0af4d07b">NumRets</a>;</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375" lineLink="/docs/api/groups/arcopt/#ga09dff0880007400fcd19bd659c3fb780"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Erasing: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nErasing: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a></span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377" lineLink="/docs/api/groups/arcopt/#ga64c911096875ed541621249ea2b997e7"><span class="doxyHighlight">    BundledInsts-&gt;eraseInst(<a href="/docs/api/groups/arcopt/#ga8bf6836a2bd83d4d7a9c8ac79d3da011">Retain</a>);</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378" lineLink="/docs/api/groups/arcopt/#gaa5ac1cad7a8710747dbe7253b852a760"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/objcarc/#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(<a href="/docs/api/groups/arcopt/#gaa746cc945a11e1a90abcd9b6dab3e509">Autorelease</a>);</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">ObjCARCOpt::GatherStatistics(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AfterOptimization) &#123;</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a6412c3ea6550f1aeab7571b6d38a2bf3">Statistic</a> &amp;NumRetains =</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">      AfterOptimization ? NumRetainsAfterOpt : NumRetainsBeforeOpt;</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a6412c3ea6550f1aeab7571b6d38a2bf3">Statistic</a> &amp;NumReleases =</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">      AfterOptimization ? NumReleasesAfterOpt : NumReleasesBeforeOpt;</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0c27cc387928f22d241825cf0fb67ade">inst&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst&#95;begin</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/namespaces/llvm/#a945cded5463e0ccd3cf5a6ac80542a94">inst&#95;end</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ) &#123;</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/objcarc/#a86cdbdf3773be3c67bc193b473b75708">GetBasicARCInstKind</a>(Inst)) &#123;</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aafece4245269582cb2f1009d4fb52047">ARCInstKind::Retain</a>:</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlight">      ++NumRetains;</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a>:</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">      ++NumReleases;</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406" lineLink="/docs/api/groups/arcopt/#gac7ff3521e7b4b50e8db182392234aefb"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gac7ff3521e7b4b50e8db182392234aefb">ObjCARCOpt::init</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/objcarc/#a6771e7364c5ab8a6354f744fe5bbc62b">EnableARCOpts</a>)</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Intuitively, objc&#95;retain and others are nocapture, however in practice</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// they are not, because they return their argument value. And objc&#95;release</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// calls finalizers which can have arbitrary side effects.</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">  MDKindCache.init(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize our runtime entry point cache.</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">  EP.init(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute which blocks are in which funclet.</span></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasPersonalityFn() &amp;&amp;</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a5309dbf19ec5ccffe3072c6087e106d3">isScopedEHPersonality</a>(<a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getPersonalityFn())))</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">    BlockEHColors = <a href="/docs/api/namespaces/llvm/#a3a3a97fed79c86bf242b0f090e1cb2e6">colorEHFunclets</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424" lineLink="/docs/api/groups/arcopt/#ga2542f915a6ba493b029cfe3ffc5f4a44"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga2542f915a6ba493b029cfe3ffc5f4a44">ObjCARCOpt::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &amp;<a href="/docs/api/namespaces/llvm/aa">AA</a>) &#123;</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/objcarc/#a6771e7364c5ab8a6354f744fe5bbc62b">EnableARCOpts</a>)</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">  Changed = CFGChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/objcarc/bundledretainclaimrvs">BundledRetainClaimRVs</a> BRV(</span><span class="doxyHighlightComment">/&#42;ContractPass=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">  BundledInsts = &amp;BRV;</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&lt;&lt;&lt; ObjCARCOpt: Visiting Function: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &gt;&gt;&gt;&quot;</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">  std::pair&lt;bool, bool&gt; R = BundledInsts-&gt;insertAfterInvokes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">  Changed |= R.first;</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">  CFGChanged |= R.second;</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">  PA.setAA(&amp;<a href="/docs/api/namespaces/llvm/aa">AA</a>);</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a846137dc22b3b399b62f606698f3ed59">AreStatisticsEnabled</a>()) &#123;</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">    GatherStatistics(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This pass performs several distinct transformations. As a compile-time aid</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when compiling code that isn&#39;t ObjC, skip these if the relevant ObjC</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// library functions aren&#39;t declared.</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Preliminary optimizations. This also computes UsedInThisFunction.</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">  OptimizeIndividualCalls(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimizations for weak pointers.</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedInThisFunction &amp; ((1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a63bc8a0dc53d47fec308f2a7a9b99562">ARCInstKind::LoadWeak</a>)) |</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a373746ca100ea4fff46f2b4046984e94">ARCInstKind::LoadWeakRetained</a>)) |</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a4b72e11620e2360a97726a1554da02d2">ARCInstKind::StoreWeak</a>)) |</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a60d8a1ea9604d54c2d3ea2c9cc065980">ARCInstKind::InitWeak</a>)) |</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2acd9d38bb7cd5940d441b3325fd7bb607">ARCInstKind::CopyWeak</a>)) |</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6e6325433672a751336dfd07c9a2cf54">ARCInstKind::MoveWeak</a>)) |</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a03973369165e1763744e9f56672dddad">ARCInstKind::DestroyWeak</a>))))</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">    OptimizeWeakCalls(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimizations for retain+release pairs.</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedInThisFunction &amp; ((1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aafece4245269582cb2f1009d4fb52047">ARCInstKind::Retain</a>)) |</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">ARCInstKind::RetainRV</a>)) |</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa5c9c22c7dedc1f8dd1d75b7c04460a9">ARCInstKind::RetainBlock</a>))))</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedInThisFunction &amp; (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ab8e7b465df7c5979dc731d06e84ce2cf">ARCInstKind::Release</a>)))</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Run OptimizeSequences until it either stops making changes or</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// no retain+release pair nesting is detected.</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (OptimizeSequences(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;&#125;</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimizations if objc&#95;autorelease is used.</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedInThisFunction &amp; ((1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a61710f61a521b1544f5f7ab5abac843d">ARCInstKind::Autorelease</a>)) |</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">                            (1 &lt;&lt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2ac1dbc9b59747323224171927c310917d">ARCInstKind::AutoreleaseRV</a>))))</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">    OptimizeReturns(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Gather statistics after optimization.</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a846137dc22b3b399b62f606698f3ed59">AreStatisticsEnabled</a>()) &#123;</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">    GatherStatistics(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Changed;</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlightComment">/// @&#125;</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494" lineLink="/docs/api/structs/llvm/objcarcoptpass/#a02b31ca54388bfecbdd6593b7563d146"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/structs/llvm/objcarcoptpass/#a02b31ca54388bfecbdd6593b7563d146">ObjCARCOptPass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">                                      <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">  ObjCARCOpt OCAO;</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">  OCAO.init(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = OCAO.run(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/aamanager">AAManager</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CFGChanged = OCAO.hasCFGChanged();</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>) &#123;</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CFGChanged)</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">      PA.<a href="/docs/api/classes/llvm/preservedanalyses/#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
