---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ParametersList from '@xpack/docusaurus-plugin-doxygen/components/ParametersList'
import ParametersListItem from '@xpack/docusaurus-plugin-doxygen/components/ParametersListItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `SROA.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This transformation implements the well known scalar replacement of aggregates transformation. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Scalar/SROA.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/sroa-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PointerIntPair.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallBitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Twine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/iterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/iterator_range.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/DomTreeUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GlobalsModRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/Loads.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/PtrUseVisitor.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/ptrusevisitor-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Config/llvm-config.h"
  permalink=""
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ConstantFolder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constantfolder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalAlias.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalalias-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstVisitor.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instvisitor-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Compiler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Scalar.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/scalar-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/PromoteMemToReg.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/promotememtoreg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SSAUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ssaupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstddef"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstring"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="string"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="tuple"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="variant"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-sroa-cpp-">anonymous&#123;SROA.cpp&#125;</a></>}>
Calculate the fragment of a variable to use when slicing a store based on the slice dimensions, existing fragment, and base storage fragment. <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity">SelectHandSpeculativity</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a></>}>
An optimization pass providing Scalar Replacement of Aggregates. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter">IRBuilderPrefixedInserter</a></>}>
A custom <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a> inserter which prefixes all names, but only in Assert builds. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice">Slice</a></>}>
A used slice of an alloca. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a></>}>
Representation of the alloca slices. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition">Partition</a></>}>
A partition of the slices. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/allocaslices/partition-iterator">partition_iterator</a></>}>
An iterator over partitions of the alloca&#39;s slices. <a href="/docs/api/classes/allocaslices/partition-iterator/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/allocaslices/slicebuilder">SliceBuilder</a></>}>
Builder for the alloca slices. <a href="/docs/api/classes/allocaslices/slicebuilder/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter">AllocaSliceRewriter</a></>}>
Visitor to rewrite instructions using p particular slice of an alloca to use a new alloca. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter">AggLoadStoreRewriter</a></>}>
Visitor to rewrite aggregate loads and stores as scalar. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/opsplitter">OpSplitter&lt;Derived&gt;</a></>}>
Generic recursive split emission class. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/opsplitter/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/loadopsplitter">LoadOpSplitter</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/storeopsplitter">StoreOpSplitter</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/basicloadandstorepromoter">BasicLoadAndStorePromoter</a></>}>
A basic LoadAndStorePromoter that does not remove store nodes. <a href="/docs/api/classes/basicloadandstorepromoter/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass">SROALegacyPass</a></>}>
A legacy pass for the legacy pass manager that wraps the <code><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a></code> pass. <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="FragCalcResult"
  name={<><a href="#a490b4809c80e7aa15ff171dae7f97b39">calculateFragment</a> (DILocalVariable &#42;Variable, uint64&#95;t NewStorageSliceOffsetInBits, uint64&#95;t NewStorageSliceSizeInBits, std::optional&lt; DIExpression::FragmentInfo &gt; StorageFragment, std::optional&lt; DIExpression::FragmentInfo &gt; CurrentFragment, DIExpression::FragmentInfo &amp;Target)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a> (const DataLayout &amp;DL, Type &#42;OldTy, Type &#42;NewTy)</>}>
Test whether we can convert a value from the old to the new type. <a href="#a2fb1c078833c17e4c9529b0cf924385c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a73ce9bc74349e7599dd4ae32a091ede7">checkVectorTypeForPromotion</a> (Partition &amp;P, VectorType &#42;VTy, const DataLayout &amp;DL)</>}>
Test whether a vector type is viable for promotion. <a href="#a73ce9bc74349e7599dd4ae32a091ede7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/vectortype">VectorType</a> &#42;</>}
  name={<><a href="#af9b65d81d95d19757080cfae034e3d7e">checkVectorTypesForPromotion</a> (Partition &amp;P, const DataLayout &amp;DL, SmallVectorImpl&lt; VectorType &#42; &gt; &amp;CandidateTys, bool HaveCommonEltTy, Type &#42;CommonEltTy, bool HaveVecPtrTy, bool HaveCommonVecPtrTy, VectorType &#42;CommonVecPtrTy)</>}>
Test whether any vector type in <code>CandidateTys</code> is viable for promotion. <a href="#af9b65d81d95d19757080cfae034e3d7e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a> (const DataLayout &amp;DL, IRBuilderTy &amp;IRB, Value &#42;V, Type &#42;NewTy)</>}>
Generic routine to convert an SSA value to a value of a different type. <a href="#af169f594f2c9e8cd49a59b29373eb4de">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/vectortype">VectorType</a> &#42;</>}
  name={<><a href="#a3ed7e979bee3c9d43ed5128461ca9070">createAndCheckVectorTypesForPromotion</a> (SetVector&lt; Type &#42; &gt; &amp;OtherTys, ArrayRef&lt; VectorType &#42; &gt; CandidateTysCopy, function&#95;ref&lt; void(Type &#42;)&gt; CheckCandidateType, Partition &amp;P, const DataLayout &amp;DL, SmallVectorImpl&lt; VectorType &#42; &gt; &amp;CandidateTys, bool &amp;HaveCommonEltTy, Type &#42;&amp;CommonEltTy, bool &amp;HaveVecPtrTy, bool &amp;HaveCommonVecPtrTy, VectorType &#42;&amp;CommonVecPtrTy)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;</>}
  name={<><a href="#a4c75a6c6ed9dedc2ff52927972587023">createOrReplaceFragment</a> (const DIExpression &#42;Expr, DIExpression::FragmentInfo Frag, int64&#95;t BitExtractOffset)</>}>
Create or replace an existing fragment in a <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> with <code>Frag</code>. <a href="#a4c75a6c6ed9dedc2ff52927972587023">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ab2f67bb5d465e282bbb175c9c278f251">extractInteger</a> (const DataLayout &amp;DL, IRBuilderTy &amp;IRB, Value &#42;V, IntegerType &#42;Ty, uint64&#95;t Offset, const Twine &amp;Name)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a604f6e897606d25237935a3374fe7a3e">extractVector</a> (IRBuilderTy &amp;IRB, Value &#42;V, unsigned BeginIndex, unsigned EndIndex, const Twine &amp;Name)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::pair&lt; <a href="/docs/api/classes/llvm/type">Type</a> &#42;, <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42; &gt;</>}
  name={<><a href="#a25781ba284c79cb93c65fd0c529ebf7c">findCommonType</a> (AllocaSlices::const&#95;iterator B, AllocaSlices::const&#95;iterator E, uint64&#95;t EndOffset)</>}>
Walk the range of a partitioning looking for a common type to cover this sequence of slices. <a href="#a25781ba284c79cb93c65fd0c529ebf7c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a62ada829b4d3487b24df63322b26bfca">foldPHINodeOrSelectInst</a> (Instruction &amp;I)</>}>
A helper that folds a PHI node or a select. <a href="#a62ada829b4d3487b24df63322b26bfca">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a6fc7e359a229f391d15a7a84a31e096a">foldSelectInst</a> (SelectInst &amp;SI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a4a30a3fae601106b8b33c0871aa3069d">getAddress</a> (const DbgVariableIntrinsic &#42;DVI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a6ba7848b8dd7159c151b8c53194cc44d">getAddress</a> (const DbgVariableRecord &#42;DVR)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;</>}
  name={<><a href="#acb9cb49df37f70129e1f44543ffa57a0">getAddressExpression</a> (const DbgVariableIntrinsic &#42;DVI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;</>}
  name={<><a href="#ad4fea0532db5a2d88aadc8ca450eba93">getAddressExpression</a> (const DbgVariableRecord &#42;DVR)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/structs/llvm/align">Align</a></>}
  name={<><a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a> (Instruction &#42;I, uint64&#95;t Offset)</>}>
Compute the adjusted alignment for a load or store from an offset. <a href="#a0c1779029e78ee6d643c3319b39e3ea8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a> (IRBuilderTy &amp;IRB, const DataLayout &amp;DL, Value &#42;Ptr, APInt Offset, Type &#42;PointerTy, const Twine &amp;NamePrefix)</>}>
Compute an adjusted pointer from Ptr by Offset bytes where the resulting pointer has <a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>. <a href="#a51c1effcc7b2215c922b2074c54d68a5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a></>}
  name={<><a href="#a30791b6c651e6313b0aab3f01da9d57b">getAggregateVariable</a> (DbgVariableIntrinsic &#42;DVI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a></>}
  name={<><a href="#a91311bfd92d95fb2817580a39aa9a6ad">getAggregateVariable</a> (DbgVariableRecord &#42;DVR)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#ad866ad1da941867a398da262103469b1">getTypePartition</a> (const DataLayout &amp;DL, Type &#42;Ty, uint64&#95;t Offset, uint64&#95;t Size)</>}>
Try to find a partition of the aggregate type passed in for a given offset and size. <a href="#ad866ad1da941867a398da262103469b1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a786d5a99befacdb30b3d3b5c3b07bd30">INITIALIZE&#95;PASS&#95;BEGIN</a> (SROALegacyPass, &quot;sroa&quot;, &quot;Scalar Replacement Of Aggregates&quot;, false, false) INITIALIZE&#95;PASS&#95;END(SROALegacyPass</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a4cad1dcbccfcc610dc8d47100b4871ef">insertInteger</a> (const DataLayout &amp;DL, IRBuilderTy &amp;IRB, Value &#42;Old, Value &#42;V, uint64&#95;t Offset, const Twine &amp;Name)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab994e75dc5cae892a87ae9a86d4b767a">insertNewDbgInst</a> (DIBuilder &amp;DIB, DbgDeclareInst &#42;Orig, AllocaInst &#42;NewAddr, DIExpression &#42;NewAddrExpr, Instruction &#42;BeforeInst, std::optional&lt; DIExpression::FragmentInfo &gt; NewFragment, int64&#95;t BitExtractAdjustment)</>}>
Insert a new dbg.declare. <a href="#ab994e75dc5cae892a87ae9a86d4b767a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5a020f0ab461a1f6e3b87aff314bd040">insertNewDbgInst</a> (DIBuilder &amp;DIB, DbgAssignIntrinsic &#42;Orig, AllocaInst &#42;NewAddr, DIExpression &#42;NewAddrExpr, Instruction &#42;BeforeInst, std::optional&lt; DIExpression::FragmentInfo &gt; NewFragment, int64&#95;t BitExtractAdjustment)</>}>
Insert a new dbg.assign. <a href="#a5a020f0ab461a1f6e3b87aff314bd040">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#abf39bad779191e6a85e053be5111c399">insertNewDbgInst</a> (DIBuilder &amp;DIB, DbgVariableRecord &#42;Orig, AllocaInst &#42;NewAddr, DIExpression &#42;NewAddrExpr, Instruction &#42;BeforeInst, std::optional&lt; DIExpression::FragmentInfo &gt; NewFragment, int64&#95;t BitExtractAdjustment)</>}>
Insert a new <a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a>. <a href="#abf39bad779191e6a85e053be5111c399">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a75cf62ffe10261611bab4d74598ab0e4">insertVector</a> (IRBuilderTy &amp;IRB, Value &#42;Old, Value &#42;V, unsigned BeginIndex, const Twine &amp;Name)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7fd9ee96f281dd94ed4119c2e45836bf">isIntegerWideningViable</a> (Partition &amp;P, Type &#42;AllocaTy, const DataLayout &amp;DL)</>}>
Test whether the given alloca partition&#39;s integer operations can be widened to promotable ones. <a href="#a7fd9ee96f281dd94ed4119c2e45836bf">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a593afa69fb7cfbb4506f605bd785f923">isIntegerWideningViableForSlice</a> (const Slice &amp;S, uint64&#95;t AllocBeginOffset, Type &#42;AllocaTy, const DataLayout &amp;DL, bool &amp;WholeAllocaOp)</>}>
Test whether a slice of an alloca is valid for integer widening. <a href="#a593afa69fb7cfbb4506f605bd785f923">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9852adb260b49ee49d3df79aa767f145">isKillAddress</a> (const DbgVariableIntrinsic &#42;DVI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a73ba5a0ae73c1f5de375603aa29818eb">isKillAddress</a> (const DbgVariableRecord &#42;DVR)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="SelectHandSpeculativity"
  name={<><a href="#af029ac9445c750f9a2a2d90c2aeab9e3">isSafeLoadOfSelectToSpeculate</a> (LoadInst &amp;LI, SelectInst &amp;SI, bool PreserveCFG)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aab37469c4748a495736ad163ac54e776">isSafePHIToSpeculate</a> (PHINode &amp;PN)</>}>
PHI instructions that use an alloca and are subsequently loaded can be rewritten to load both input pointers in the pred blocks and then PHI the results, allowing the load of the alloca to be promoted. <a href="#aab37469c4748a495736ad163ac54e776">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/vectortype">VectorType</a> &#42;</>}
  name={<><a href="#af6735614e085435a0f3bb90aab527213">isVectorPromotionViable</a> (Partition &amp;P, const DataLayout &amp;DL)</>}>
Test whether the given alloca partitioning and range of slices can be promoted to a vector. <a href="#af6735614e085435a0f3bb90aab527213">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab4c31035e44c7bda618eb2eb81dcf314">isVectorPromotionViableForSlice</a> (Partition &amp;P, const Slice &amp;S, VectorType &#42;Ty, uint64&#95;t ElementSize, const DataLayout &amp;DL)</>}>
Test whether the given slice use can be promoted to a vector. <a href="#ab4c31035e44c7bda618eb2eb81dcf314">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a> (AllocaInst &#42;OldAlloca, bool IsSplit, uint64&#95;t OldAllocaOffsetInBits, uint64&#95;t SliceSizeInBits, Instruction &#42;OldInst, Instruction &#42;Inst, Value &#42;Dest, Value &#42;Value, const DataLayout &amp;DL)</>}>
Find linked dbg.assign and generate a new one with the correct FragmentInfo. <a href="#a0346c3f86c714b9ae84f5566a95e90ac">More...</a>
</MembersIndexItem>

<MembersIndexItem
  template={<>template &lt;typename T&gt;</>}
  type="void"
  name={<><a href="#a670232d63153cd8cd2793b3106e80661">rewriteMemOpOfSelect</a> (SelectInst &amp;SI, T &amp;I, SelectHandSpeculativity Spec, DomTreeUpdater &amp;DTU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4a30f36def0478d9125147359f4f7c96">rewriteMemOpOfSelect</a> (SelectInst &amp;SelInst, Instruction &amp;I, SelectHandSpeculativity Spec, DomTreeUpdater &amp;DTU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a63ceac0fe90c6eae903dd259120cc4fd">rewriteSelectInstMemOps</a> (SelectInst &amp;SI, const RewriteableMemOps &amp;Ops, IRBuilderTy &amp;IRB, DomTreeUpdater &#42;DTU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a80f5f1399bc814c650325a6c41e350e2">speculatePHINodeLoads</a> (IRBuilderTy &amp;IRB, PHINode &amp;PN)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ace8766b97ac54db2bec8c29e4016f3f6">speculateSelectInstLoads</a> (SelectInst &amp;SI, LoadInst &amp;LI, IRBuilderTy &amp;IRB)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a618041bb2c6e95361ead0e45493039ef">STATISTIC</a> (NumAllocasAnalyzed, &quot;Number of allocas analyzed for replacement&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4e323f27ddb83247b75a5b2d375d9216">STATISTIC</a> (NumAllocaPartitions, &quot;Number of alloca partitions formed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ace0cc1a6f5d1eb652844d9752b238390">STATISTIC</a> (MaxPartitionsPerAlloca, &quot;Maximum number of partitions per alloca&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a8043ffc0bf25bc77b88596ec2555d25f">STATISTIC</a> (NumAllocaPartitionUses, &quot;Number of alloca partition uses rewritten&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab96dad8afe38ad77a313ecac3d1f151a">STATISTIC</a> (MaxUsesPerAllocaPartition, &quot;Maximum number of uses of a partition&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#adcd84289002379062d3d99430eb946df">STATISTIC</a> (NumNewAllocas, &quot;Number of new, smaller allocas introduced&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#afd53eb32a458943eee0e59c868868419">STATISTIC</a> (NumPromoted, &quot;Number of allocas promoted to SSA values&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ae1f1e2ef32da6004704b9dfd4d80482e">STATISTIC</a> (NumLoadsSpeculated, &quot;Number of loads speculated to allow promotion&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a67d9ffc6d212c740745c44d55b342183">STATISTIC</a> (NumLoadsPredicated, &quot;Number of loads rewritten into predicated loads to allow promotion&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a16541099df751a755cb836c9fd3e0b15">STATISTIC</a> (NumStoresPredicated, &quot;Number of stores rewritten into predicated loads to allow promotion&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af559aec98fbf691ccd4c3233556cc618">STATISTIC</a> (NumDeleted, &quot;Number of instructions deleted&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3f794c154e83c0c1f7953596198faa8f">STATISTIC</a> (NumVectorized, &quot;Number of vectorized aggregates&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#a29482246d1f1d9699e0a4786aafad1de">stripAggregateTypeWrapping</a> (const DataLayout &amp;DL, Type &#42;Ty)</>}>
Strip aggregate type wrapping. <a href="#a29482246d1f1d9699e0a4786aafad1de">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;</>}
  name={<><a href="#a23a1af31637f354c7238e84dde44e61a">UnwrapDbgInstPtr</a> (DbgInstPtr P, DbgVariableRecord &#42;Unused)</>}>
Helpers for handling new and old debug info modes in migrateDebugInfo. <a href="#a23a1af31637f354c7238e84dde44e61a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;</>}
  name={<><a href="#ac31fe878ff80e6b98248cacd098ab29b">UnwrapDbgInstPtr</a> (DbgInstPtr P, DbgAssignIntrinsic &#42;Unused)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type="Scalar Replacement Of"
  name={<><a href="#a5b3f8e5f6c512fe6a5059dd0c51aec95">Aggregates</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="Scalar Replacement Of"
  name={<><a href="#acc7a95cb9fb444faf77cd626f1b8128b">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6990f15b9f29df6e8497b3e53875ccab">sroa</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1b382400b6aa5cded55f3c0d0a0f9bf8">SROASkipMem2Reg</a></>}>
Disable running mem2reg during <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a> in order to test or debug <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a>. <a href="#a1b382400b6aa5cded55f3c0d0a0f9bf8">More...</a>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;sroa&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This transformation implements the well known scalar replacement of aggregates transformation.

It tries to identify promotable elements of an aggregate alloca, and promote them to registers. It will also try to convert uses of an element (or set of elements) of an alloca into a vector or bitfield-style integer scalar if appropriate.

It works to do this with minimal slicing of the alloca so that regions which are merely transferred in and out of external memory remain unchanged and are not decomposed to scalar code.

Because this also performs alloca promotion, it can be thought of as also serving the purpose of SSA formation. The algorithm iterates on the function until all opportunities for promotion have been realized.

<SectionDefinition>

## Functions

### calculateFragment() {#a490b4809c80e7aa15ff171dae7f97b39}

<MemberDefinition
  prototype={<>static FragCalcResult calculateFragment (<a href="/docs/api/classes/llvm/dilocalvariable">DILocalVariable</a> &#42; Variable, uint64&#95;t NewStorageSliceOffsetInBits, uint64&#95;t NewStorageSliceSizeInBits, std::optional&lt; <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> &gt; StorageFragment, std::optional&lt; <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> &gt; CurrentFragment, <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> &amp; Target)</>}
  labels = {["static"]}>

Definition at line <a href="#l00272">272</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### canConvertValue() {#a2fb1c078833c17e4c9529b0cf924385c}

<MemberDefinition
  prototype={<>static bool canConvertValue (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/type">Type</a> &#42; OldTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42; NewTy)</>}
  labels = {["static"]}>
Test whether we can convert a value from the old to the new type.

This predicate should be used to guard calls to convertValue in order to ensure that we only try to convert viable values. The strategy is that we will peel off single element struct and array wrappings to get to an underlying value, and convert that value.

Definition at line <a href="#l01928">1928</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### checkVectorTypeForPromotion() {#a73ce9bc74349e7599dd4ae32a091ede7}

<MemberDefinition
  prototype={<>static bool checkVectorTypeForPromotion (Partition &amp; P, <a href="/docs/api/classes/vectortype">VectorType</a> &#42; VTy, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Test whether a vector type is viable for promotion.

This implements the necessary checking for <code>checkVectorTypesForPromotion</code> (and thus isVectorPromotionViable) over all slices of the alloca for the given <a href="/docs/api/classes/vectortype">VectorType</a>.

Definition at line <a href="#l02118">2118</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### checkVectorTypesForPromotion() {#af9b65d81d95d19757080cfae034e3d7e}

<MemberDefinition
  prototype={<>static VectorType &#42; checkVectorTypesForPromotion (Partition &amp; P, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/vectortype">VectorType</a> &#42; &gt; &amp; CandidateTys, bool HaveCommonEltTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42; CommonEltTy, bool HaveVecPtrTy, bool HaveCommonVecPtrTy, <a href="/docs/api/classes/vectortype">VectorType</a> &#42; CommonVecPtrTy)</>}
  labels = {["static"]}>
Test whether any vector type in <code>CandidateTys</code> is viable for promotion.

This implements the necessary checking for <code>isVectorPromotionViable</code> over all slices of the alloca for the given <a href="/docs/api/classes/vectortype">VectorType</a>.

Definition at line <a href="#l02147">2147</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### convertValue() {#af169f594f2c9e8cd49a59b29373eb4de}

<MemberDefinition
  prototype={<>static Value &#42; convertValue (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, IRBuilderTy &amp; IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/type">Type</a> &#42; NewTy)</>}
  labels = {["static"]}>
Generic routine to convert an SSA value to a value of a different type.

This will try various different casting techniques, such as bitcasts, inttoptr, and ptrtoint casts. <a href="/docs/api/classes/llvm/use">Use</a> the <code>canConvertValue</code> predicate to test two types for viability with this routine.

Definition at line <a href="#l01990">1990</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### createAndCheckVectorTypesForPromotion() {#a3ed7e979bee3c9d43ed5128461ca9070}

<MemberDefinition
  prototype={<>static VectorType &#42; createAndCheckVectorTypesForPromotion (<a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/type">Type</a> &#42; &gt; &amp; OtherTys, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/vectortype">VectorType</a> &#42; &gt; CandidateTysCopy, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; void(<a href="/docs/api/classes/llvm/type">Type</a> &#42;)&gt; CheckCandidateType, Partition &amp; P, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/vectortype">VectorType</a> &#42; &gt; &amp; CandidateTys, bool &amp; HaveCommonEltTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42;&amp; CommonEltTy, bool &amp; HaveVecPtrTy, bool &amp; HaveCommonVecPtrTy, <a href="/docs/api/classes/vectortype">VectorType</a> &#42;&amp; CommonVecPtrTy)</>}
  labels = {["static"]}>

Definition at line <a href="#l02233">2233</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### createOrReplaceFragment() {#a4c75a6c6ed9dedc2ff52927972587023}

<MemberDefinition
  prototype={<>static DIExpression &#42; createOrReplaceFragment (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42; Expr, <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> Frag, int64&#95;t BitExtractOffset)</>}
  labels = {["static"]}>
Create or replace an existing fragment in a <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> with <code>Frag</code>.

If the expression already contains a DW&#95;OP&#95;LLVM&#95;extract&#95;bits&#95;&#91;sz&#93;ext operation, add <code>BitExtractOffset</code> to the offset part.

Returns the new expression, or nullptr if this fails (see details below).

This function is similar to <a href="/docs/api/classes/llvm/diexpression/#ab2fc167f75191e1d22e12e8e382605bb">DIExpression::createFragmentExpression</a> except for 3 important distinctions:
<ul>
<li>The new fragment isn&#39;t relative to an existing fragment.</li>
<li>It assumes the computed location is a memory location. This means we don&#39;t need to perform checks that creating the fragment preserves the expression semantics.</li>
<li>Existing extract&#95;bits are modified independently of fragment changes using <code>BitExtractOffset</code>. A change to the fragment offset or size may affect a bit extract. But a bit extract offset can change independently of the fragment dimensions.</li>
</ul>


Returns the new expression, or nullptr if one couldn&#39;t be created. Ideally this is only used to signal that a bit-extract has become zero-sized (and thus the new debug record has no size and can be dropped), however, it fails for other reasons too - see the FIXME below.

FIXME: To keep the change that introduces this function NFC it bails in some situations unecessarily, e.g. when fragment and bit extract sizes differ.

Definition at line <a href="#l05082">5082</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### extractInteger() {#ab2f67bb5d465e282bbb175c9c278f251}

<MemberDefinition
  prototype={<>static Value &#42; extractInteger (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, IRBuilderTy &amp; IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42; Ty, uint64&#95;t Offset, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name)</>}
  labels = {["static"]}>

Definition at line <a href="#l02492">2492</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### extractVector() {#a604f6e897606d25237935a3374fe7a3e}

<MemberDefinition
  prototype={<>static Value &#42; extractVector (IRBuilderTy &amp; IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, unsigned BeginIndex, unsigned EndIndex, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name)</>}
  labels = {["static"]}>

Definition at line <a href="#l02550">2550</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### findCommonType() {#a25781ba284c79cb93c65fd0c529ebf7c}

<MemberDefinition
  prototype={<>static std::pair&lt; Type &#42;, IntegerType &#42; &gt; findCommonType (<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">AllocaSlices::const&#95;iterator</a> B, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">AllocaSlices::const&#95;iterator</a> E, uint64&#95;t EndOffset)</>}
  labels = {["static"]}>
Walk the range of a partitioning looking for a common type to cover this sequence of slices.

Definition at line <a href="#l01485">1485</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### foldPHINodeOrSelectInst() {#a62ada829b4d3487b24df63322b26bfca}

<MemberDefinition
  prototype={<>static Value &#42; foldPHINodeOrSelectInst (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I)</>}
  labels = {["static"]}>
A helper that folds a PHI node or a select.

Definition at line <a href="#l01006">1006</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### foldSelectInst() {#a6fc7e359a229f391d15a7a84a31e096a}

<MemberDefinition
  prototype={<>static Value &#42; foldSelectInst (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp; SI)</>}
  labels = {["static"]}>

Definition at line <a href="#l00993">993</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAddress() {#a4a30a3fae601106b8b33c0871aa3069d}

<MemberDefinition
  prototype={<>const Value &#42; getAddress (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42; DVI)</>}>

Definition at line <a href="#l05023">5023</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAddress() {#a6ba7848b8dd7159c151b8c53194cc44d}

<MemberDefinition
  prototype={<>const Value &#42; getAddress (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; DVR)</>}>

Definition at line <a href="#l05029">5029</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAddressExpression() {#acb9cb49df37f70129e1f44543ffa57a0}

<MemberDefinition
  prototype={<>const DIExpression &#42; getAddressExpression (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42; DVI)</>}>

Definition at line <a href="#l05045">5045</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAddressExpression() {#ad4fea0532db5a2d88aadc8ca450eba93}

<MemberDefinition
  prototype={<>const DIExpression &#42; getAddressExpression (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; DVR)</>}>

Definition at line <a href="#l05051">5051</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAdjustedAlignment() {#a0c1779029e78ee6d643c3319b39e3ea8}

<MemberDefinition
  prototype={<>static Align getAdjustedAlignment (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, uint64&#95;t Offset)</>}
  labels = {["static"]}>
Compute the adjusted alignment for a load or store from an offset.

Definition at line <a href="#l01918">1918</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAdjustedPtr() {#a51c1effcc7b2215c922b2074c54d68a5}

<MemberDefinition
  prototype={<>static Value &#42; getAdjustedPtr (IRBuilderTy &amp; IRB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Ptr, <a href="/docs/api/classes/llvm/apint">APInt</a> Offset, <a href="/docs/api/classes/llvm/type">Type</a> &#42; PointerTy, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; NamePrefix)</>}
  labels = {["static"]}>
Compute an adjusted pointer from Ptr by Offset bytes where the resulting pointer has <a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>.

Definition at line <a href="#l01907">1907</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAggregateVariable() {#a30791b6c651e6313b0aab3f01da9d57b}

<MemberDefinition
  prototype={<>static DebugVariable getAggregateVariable (<a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42; DVI)</>}
  labels = {["static"]}>

Definition at line <a href="#l00318">318</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getAggregateVariable() {#a91311bfd92d95fb2817580a39aa9a6ad}

<MemberDefinition
  prototype={<>static DebugVariable getAggregateVariable (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; DVR)</>}
  labels = {["static"]}>

Definition at line <a href="#l00322">322</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### getTypePartition() {#ad866ad1da941867a398da262103469b1}

<MemberDefinition
  prototype={<>static Type &#42; getTypePartition (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, uint64&#95;t Offset, uint64&#95;t Size)</>}
  labels = {["static"]}>
Try to find a partition of the aggregate type passed in for a given offset and size.

This recurses through the aggregate type and tries to compute a subtype based on the offset and size. When the offset and size span a sub-section of an array, it will even compute a new array type for that sub-section, and the same for structs.

Note that this routine is very strict and tries to find a partition of the type which produces the <em>exact</em> right offset and size. It is not forgiving when the size or offset cause either end of type-based partition to be off. Also, this is a best-effort routine. It is reasonable to give up and not return a type if necessary.

Definition at line <a href="#l04224">4224</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#a786d5a99befacdb30b3d3b5c3b07bd30}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (SROALegacyPass, &quot;sroa&quot;, &quot;Scalar Replacement Of Aggregates&quot;, false, false)</>}>

Definition at line <a href="#l05843">5843</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### insertInteger() {#a4cad1dcbccfcc610dc8d47100b4871ef}

<MemberDefinition
  prototype={<>static Value &#42; insertInteger (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, IRBuilderTy &amp; IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Old, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, uint64&#95;t Offset, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name)</>}
  labels = {["static"]}>

Definition at line <a href="#l02517">2517</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### insertNewDbgInst() {#ab994e75dc5cae892a87ae9a86d4b767a}

<MemberDefinition
  prototype={<>static void insertNewDbgInst (<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp; DIB, <a href="/docs/api/classes/llvm/dbgdeclareinst">DbgDeclareInst</a> &#42; Orig, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; NewAddr, <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42; NewAddrExpr, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; BeforeInst, std::optional&lt; <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> &gt; NewFragment, int64&#95;t BitExtractAdjustment)</>}
  labels = {["static"]}>
Insert a new dbg.declare.

<code>Orig</code> Original to copy debug loc and variable from. <code>NewAddr</code> Location&#39;s new base address. <code>NewAddrExpr</code> New expression to apply to address. <code>BeforeInst</code> Insert position. <code>NewFragment</code> New fragment (absolute, non-relative). <code>BitExtractAdjustment</code> Offset to apply to any extract&#95;bits op.

Definition at line <a href="#l05146">5146</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### insertNewDbgInst() {#a5a020f0ab461a1f6e3b87aff314bd040}

<MemberDefinition
  prototype={<>static void insertNewDbgInst (<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp; DIB, <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42; Orig, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; NewAddr, <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42; NewAddrExpr, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; BeforeInst, std::optional&lt; <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> &gt; NewFragment, int64&#95;t BitExtractAdjustment)</>}
  labels = {["static"]}>
Insert a new dbg.assign.

<code>Orig</code> Original to copy debug loc, variable, value and value expression from. <code>NewAddr</code> Location&#39;s new base address. <code>NewAddrExpr</code> New expression to apply to address. <code>BeforeInst</code> Insert position. <code>NewFragment</code> New fragment (absolute, non-relative). <code>BitExtractAdjustment</code> Offset to apply to any extract&#95;bits op.

Definition at line <a href="#l05169">5169</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### insertNewDbgInst() {#abf39bad779191e6a85e053be5111c399}

<MemberDefinition
  prototype={<>static void insertNewDbgInst (<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp; DIB, <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; Orig, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; NewAddr, <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42; NewAddrExpr, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; BeforeInst, std::optional&lt; <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> &gt; NewFragment, int64&#95;t BitExtractAdjustment)</>}
  labels = {["static"]}>
Insert a new <a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a>.

<code>Orig</code> Original to copy record type, debug loc and variable from, and additionally value and value expression for dbg&#95;assign records. <code>NewAddr</code> Location&#39;s new base address. <code>NewAddrExpr</code> New expression to apply to address. <code>BeforeInst</code> Insert position. <code>NewFragment</code> New fragment (absolute, non-relative). <code>BitExtractAdjustment</code> Offset to apply to any extract&#95;bits op.

Definition at line <a href="#l05207">5207</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### insertVector() {#a75cf62ffe10261611bab4d74598ab0e4}

<MemberDefinition
  prototype={<>static Value &#42; insertVector (IRBuilderTy &amp; IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Old, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, unsigned BeginIndex, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name)</>}
  labels = {["static"]}>

Definition at line <a href="#l02572">2572</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isIntegerWideningViable() {#a7fd9ee96f281dd94ed4119c2e45836bf}

<MemberDefinition
  prototype={<>static bool isIntegerWideningViable (Partition &amp; P, <a href="/docs/api/classes/llvm/type">Type</a> &#42; AllocaTy, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Test whether the given alloca partition&#39;s integer operations can be widened to promotable ones.

This is a quick test to check whether we can rewrite the integer loads and stores to a particular alloca into wider loads and stores and be able to promote the resulting alloca.

Definition at line <a href="#l02451">2451</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isIntegerWideningViableForSlice() {#a593afa69fb7cfbb4506f605bd785f923}

<MemberDefinition
  prototype={<>static bool isIntegerWideningViableForSlice (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> Slice &amp; S, uint64&#95;t AllocBeginOffset, <a href="/docs/api/classes/llvm/type">Type</a> &#42; AllocaTy, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, bool &amp; WholeAllocaOp)</>}
  labels = {["static"]}>
Test whether a slice of an alloca is valid for integer widening.

This implements the necessary checking for the <code>isIntegerWideningViable</code> test below on a single slice of the alloca.

Definition at line <a href="#l02358">2358</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isKillAddress() {#a9852adb260b49ee49d3df79aa767f145}

<MemberDefinition
  prototype={<>bool isKillAddress (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42; DVI)</>}>

Definition at line <a href="#l05033">5033</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isKillAddress() {#a73ba5a0ae73c1f5de375603aa29818eb}

<MemberDefinition
  prototype={<>bool isKillAddress (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; DVR)</>}>

Definition at line <a href="#l05039">5039</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isSafeLoadOfSelectToSpeculate() {#af029ac9445c750f9a2a2d90c2aeab9e3}

<MemberDefinition
  prototype={<>static SelectHandSpeculativity isSafeLoadOfSelectToSpeculate (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &amp; LI, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp; SI, bool PreserveCFG)</>}
  labels = {["static"]}>

Definition at line <a href="#l01706">1706</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isSafePHIToSpeculate() {#aab37469c4748a495736ad163ac54e776}

<MemberDefinition
  prototype={<>static bool isSafePHIToSpeculate (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN)</>}
  labels = {["static"]}>
PHI instructions that use an alloca and are subsequently loaded can be rewritten to load both input pointers in the pred blocks and then PHI the results, allowing the load of the alloca to be promoted.

From this: P2 = phi &#91;i32&#42; Alloca, i32&#42; Other&#93; V = load i32&#42; P2 to: V1 = load i32&#42; Alloca -&gt; will be mem2reg&#39;d ... V2 = load i32&#42; Other ... V = phi &#91;i32 V1, i32 V2&#93;

We can do this to a select if its only uses are loads and if the operands to the select can be loaded unconditionally.

FIXME: This should be hoisted into a generic utility, likely in Transforms/Util/Local.h

Definition at line <a href="#l01551">1551</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isVectorPromotionViable() {#af6735614e085435a0f3bb90aab527213}

<MemberDefinition
  prototype={<>static VectorType &#42; isVectorPromotionViable (Partition &amp; P, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Test whether the given alloca partitioning and range of slices can be promoted to a vector.

This is a quick test to check whether we can rewrite a particular alloca partition (and its newly formed alloca) into a vector alloca with only whole-vector loads and stores such that it could be promoted to a vector SSA value. We only can ensure this for a limited set of operations, and we don&#39;t want to do the rewrites unless we are confident that the result will be promotable, so we have an early test here.

Definition at line <a href="#l02277">2277</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### isVectorPromotionViableForSlice() {#ab4c31035e44c7bda618eb2eb81dcf314}

<MemberDefinition
  prototype={<>static bool isVectorPromotionViableForSlice (Partition &amp; P, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> Slice &amp; S, <a href="/docs/api/classes/vectortype">VectorType</a> &#42; Ty, uint64&#95;t ElementSize, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Test whether the given slice use can be promoted to a vector.

This function is called to test each entry in a partition which is slated for a single slice.

Definition at line <a href="#l02044">2044</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### migrateDebugInfo() {#a0346c3f86c714b9ae84f5566a95e90ac}

<MemberDefinition
  prototype={<>static void migrateDebugInfo (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; OldAlloca, bool IsSplit, uint64&#95;t OldAllocaOffsetInBits, uint64&#95;t SliceSizeInBits, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; OldInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Dest, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Value, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Find linked dbg.assign and generate a new one with the correct FragmentInfo.

Link Inst to the new dbg.assign. If <a href="/docs/api/classes/llvm/value">Value</a> is nullptr the value component is copied from the old dbg.assign to the new. 
<ParametersList title="Parameters">
<ParametersListItem name="OldAlloca">Alloca for the variable before splitting.</ParametersListItem>
<ParametersListItem name="IsSplit">True if the store (not necessarily alloca) is being split.</ParametersListItem>
<ParametersListItem name="OldAllocaOffsetInBits">Offset of the slice taken from OldAlloca.</ParametersListItem>
<ParametersListItem name="SliceSizeInBits">New number of bits being written to.</ParametersListItem>
<ParametersListItem name="OldInst"><a href="/docs/api/classes/llvm/instruction">Instruction</a> that is being split.</ParametersListItem>
<ParametersListItem name="Inst">New instruction performing this part of the split store.</ParametersListItem>
<ParametersListItem name="Dest">Store destination.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/value&quot;>Value</a>">Stored value.</ParametersListItem>
<ParametersListItem name="DL">Datalayout.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00353">353</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### rewriteMemOpOfSelect() {#a670232d63153cd8cd2793b3106e80661}

<MemberDefinition
  template={<>template &lt;typename T&gt;</>}
  prototype={<>static void rewriteMemOpOfSelect (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp; SI, T &amp; I, SelectHandSpeculativity Spec, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &amp; DTU)</>}
  labels = {["static"]}>

Definition at line <a href="#l01806">1806</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### rewriteMemOpOfSelect() {#a4a30f36def0478d9125147359f4f7c96}

<MemberDefinition
  prototype={<>static void rewriteMemOpOfSelect (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp; SelInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, SelectHandSpeculativity Spec, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &amp; DTU)</>}
  labels = {["static"]}>

Definition at line <a href="#l01862">1862</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### rewriteSelectInstMemOps() {#a63ceac0fe90c6eae903dd259120cc4fd}

<MemberDefinition
  prototype={<>static bool rewriteSelectInstMemOps (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp; SI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> RewriteableMemOps &amp; Ops, IRBuilderTy &amp; IRB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>

Definition at line <a href="#l01873">1873</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### speculatePHINodeLoads() {#a80f5f1399bc814c650325a6c41e350e2}

<MemberDefinition
  prototype={<>static void speculatePHINodeLoads (IRBuilderTy &amp; IRB, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN)</>}
  labels = {["static"]}>

Definition at line <a href="#l01625">1625</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### speculateSelectInstLoads() {#ace8766b97ac54db2bec8c29e4016f3f6}

<MemberDefinition
  prototype={<>static void speculateSelectInstLoads (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp; SI, <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &amp; LI, IRBuilderTy &amp; IRB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01768">1768</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a618041bb2c6e95361ead0e45493039ef}

<MemberDefinition
  prototype={<>STATISTIC (NumAllocasAnalyzed, &quot;Number of allocas analyzed <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> replacement&quot;)</>}>

Definition at line <a href="#l00104">104</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4e323f27ddb83247b75a5b2d375d9216}

<MemberDefinition
  prototype={<>STATISTIC (NumAllocaPartitions, &quot;Number of alloca partitions formed&quot;)</>}>

Definition at line <a href="#l00105">105</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ace0cc1a6f5d1eb652844d9752b238390}

<MemberDefinition
  prototype={<>STATISTIC (MaxPartitionsPerAlloca, &quot;Maximum number of partitions per alloca&quot;)</>}>

Definition at line <a href="#l00106">106</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a8043ffc0bf25bc77b88596ec2555d25f}

<MemberDefinition
  prototype={<>STATISTIC (NumAllocaPartitionUses, &quot;Number of alloca partition uses rewritten&quot;)</>}>

Definition at line <a href="#l00107">107</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab96dad8afe38ad77a313ecac3d1f151a}

<MemberDefinition
  prototype={<>STATISTIC (MaxUsesPerAllocaPartition, &quot;Maximum number of uses of a partition&quot;)</>}>

Definition at line <a href="#l00108">108</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#adcd84289002379062d3d99430eb946df}

<MemberDefinition
  prototype={<>STATISTIC (NumNewAllocas, &quot;Number of new, smaller allocas introduced&quot;)</>}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#afd53eb32a458943eee0e59c868868419}

<MemberDefinition
  prototype={<>STATISTIC (NumPromoted, &quot;Number of allocas promoted to <a href="/docs/api/files/lib/lib/analysis/memoryssa-cpp/#a20a60bdac22b099d87d8cb0c1d554120">SSA</a> values&quot;)</>}>

Definition at line <a href="#l00110">110</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ae1f1e2ef32da6004704b9dfd4d80482e}

<MemberDefinition
  prototype={<>STATISTIC (NumLoadsSpeculated, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloadstorewidening-cpp/#a5414f76815c8f01cd360c99ff6fb27a7">loads</a> speculated to allow promotion&quot;)</>}>

Definition at line <a href="#l00111">111</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a67d9ffc6d212c740745c44d55b342183}

<MemberDefinition
  prototype={<>STATISTIC (NumLoadsPredicated, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloadstorewidening-cpp/#a5414f76815c8f01cd360c99ff6fb27a7">loads</a> rewritten into predicated <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloadstorewidening-cpp/#a5414f76815c8f01cd360c99ff6fb27a7">loads</a> to allow promotion&quot;)</>}>

Definition at line <a href="#l00112">112</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a16541099df751a755cb836c9fd3e0b15}

<MemberDefinition
  prototype={<>STATISTIC (NumStoresPredicated, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloadstorewidening-cpp/#a7d2c711a42f51c1f7b3ce3f8f560fa74">stores</a> rewritten into predicated <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloadstorewidening-cpp/#a5414f76815c8f01cd360c99ff6fb27a7">loads</a> to allow promotion&quot;)</>}>

Definition at line <a href="#l00114">114</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#af559aec98fbf691ccd4c3233556cc618}

<MemberDefinition
  prototype={<>STATISTIC (NumDeleted, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> deleted&quot;)</>}>

Definition at line <a href="#l00117">117</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3f794c154e83c0c1f7953596198faa8f}

<MemberDefinition
  prototype={<>STATISTIC (NumVectorized, &quot;Number of vectorized aggregates&quot;)</>}>

Definition at line <a href="#l00118">118</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### stripAggregateTypeWrapping() {#a29482246d1f1d9699e0a4786aafad1de}

<MemberDefinition
  prototype={<>static Type &#42; stripAggregateTypeWrapping (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>
Strip aggregate type wrapping.

This removes no-op aggregate types wrapping an underlying type. It will strip as many layers of types as it can without changing either the type size or the allocated size.

Definition at line <a href="#l04186">4186</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### UnwrapDbgInstPtr() {#a23a1af31637f354c7238e84dde44e61a}

<MemberDefinition
  prototype={<>DbgVariableRecord &#42; UnwrapDbgInstPtr (<a href="/docs/api/namespaces/llvm/#ae590e0c860e4c1fb30629dfecac4bd58">DbgInstPtr</a> P, <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42; Unused)</>}>
Helpers for handling new and old debug info modes in migrateDebugInfo.

These overloads unwrap a <a href="/docs/api/namespaces/llvm/#ae590e0c860e4c1fb30629dfecac4bd58">DbgInstPtr</a> &#123;Instruction&#42; | DbgRecord&#42;&#125; union based on the <code>Unused</code> parameter type.

Definition at line <a href="#l00330">330</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### UnwrapDbgInstPtr() {#ac31fe878ff80e6b98248cacd098ab29b}

<MemberDefinition
  prototype={<>DbgAssignIntrinsic &#42; UnwrapDbgInstPtr (<a href="/docs/api/namespaces/llvm/#ae590e0c860e4c1fb30629dfecac4bd58">DbgInstPtr</a> P, <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42; Unused)</>}>

Definition at line <a href="#l00334">334</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### Aggregates {#a5b3f8e5f6c512fe6a5059dd0c51aec95}

<MemberDefinition
  prototype="Scalar Replacement Of Aggregates">

Definition at line <a href="#l05847">5847</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### false {#acc7a95cb9fb444faf77cd626f1b8128b}

<MemberDefinition
  prototype="Scalar Replacement Of false">

Definition at line <a href="#l05848">5848</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### sroa {#a6990f15b9f29df6e8497b3e53875ccab}

<MemberDefinition
  prototype="sroa">

Definition at line <a href="#l05847">5847</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

### SROASkipMem2Reg {#a1b382400b6aa5cded55f3c0d0a0f9bf8}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; SROASkipMem2Reg(&quot;sroa-skip-mem2reg&quot;, cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>
Disable running mem2reg during <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a> in order to test or debug <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a>.

Definition at line <a href="#l00121">121</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;sroa&quot;</>}>

Definition at line <a href="#l00102">102</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/sroa-cpp">SROA.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- SROA.cpp - Scalar Replacement Of Aggregates ------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// This transformation implements the well known scalar replacement of</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// aggregates transformation. It tries to identify promotable elements of an</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// aggregate alloca, and promote them to registers. It will also try to</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">/// convert uses of an element (or set of elements) of an alloca into a vector</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">/// or bitfield-style integer scalar if appropriate.</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">/// It works to do this with minimal slicing of the alloca so that regions</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">/// which are merely transferred in and out of external memory remain unchanged</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">/// and are not decomposed to scalar code.</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">/// Because this also performs alloca promotion, it can be thought of as also</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">/// serving the purpose of SSA formation. The algorithm iterates on the</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">/// function until all opportunities for promotion have been realized.</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/sroa-h">llvm/Transforms/Scalar/SROA.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/pointerintpair-h">llvm/ADT/PointerIntPair.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h">llvm/ADT/SmallBitVector.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h">llvm/ADT/Twine.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-h">llvm/ADT/iterator.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h">llvm/ADT/iterator&#95;range.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h">llvm/Analysis/DomTreeUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h">llvm/Analysis/GlobalsModRef.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h">llvm/Analysis/Loads.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/ptrusevisitor-h">llvm/Analysis/PtrUseVisitor.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Config/llvm-config.h&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constantfolder-h">llvm/IR/ConstantFolder.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalalias-h">llvm/IR/GlobalAlias.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instvisitor-h">llvm/IR/InstVisitor.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h">llvm/Support/Compiler.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/scalar-h">llvm/Transforms/Scalar.h</a>&quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/promotememtoreg-h">llvm/Transforms/Utils/PromoteMemToReg.h</a>&quot;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ssaupdater-h">llvm/Transforms/Utils/SSAUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightPreprocessor">#include &lt;cstddef&gt;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlightPreprocessor">#include &lt;cstring&gt;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlightPreprocessor">#include &lt;string&gt;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightPreprocessor">#include &lt;tuple&gt;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlightPreprocessor">#include &lt;variant&gt;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlightPreprocessor">#include &lt;vector&gt;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;sroa&quot;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104" lineLink="#a618041bb2c6e95361ead0e45493039ef"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAllocasAnalyzed, </span><span class="doxyHighlightStringLiteral">&quot;Number of allocas analyzed for replacement&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105" lineLink="#a4e323f27ddb83247b75a5b2d375d9216"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAllocaPartitions, </span><span class="doxyHighlightStringLiteral">&quot;Number of alloca partitions formed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106" lineLink="#ace0cc1a6f5d1eb652844d9752b238390"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(MaxPartitionsPerAlloca, </span><span class="doxyHighlightStringLiteral">&quot;Maximum number of partitions per alloca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#a8043ffc0bf25bc77b88596ec2555d25f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAllocaPartitionUses, </span><span class="doxyHighlightStringLiteral">&quot;Number of alloca partition uses rewritten&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108" lineLink="#ab96dad8afe38ad77a313ecac3d1f151a"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(MaxUsesPerAllocaPartition, </span><span class="doxyHighlightStringLiteral">&quot;Maximum number of uses of a partition&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#adcd84289002379062d3d99430eb946df"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumNewAllocas, </span><span class="doxyHighlightStringLiteral">&quot;Number of new, smaller allocas introduced&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="#afd53eb32a458943eee0e59c868868419"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPromoted, </span><span class="doxyHighlightStringLiteral">&quot;Number of allocas promoted to SSA values&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111" lineLink="#ae1f1e2ef32da6004704b9dfd4d80482e"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLoadsSpeculated, </span><span class="doxyHighlightStringLiteral">&quot;Number of loads speculated to allow promotion&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112" lineLink="#a67d9ffc6d212c740745c44d55b342183"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLoadsPredicated,</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of loads rewritten into predicated loads to allow promotion&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="#a16541099df751a755cb836c9fd3e0b15"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">    NumStoresPredicated,</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Number of stores rewritten into predicated loads to allow promotion&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117" lineLink="#af559aec98fbf691ccd4c3233556cc618"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDeleted, </span><span class="doxyHighlightStringLiteral">&quot;Number of instructions deleted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118" lineLink="#a3f794c154e83c0c1f7953596198faa8f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumVectorized, </span><span class="doxyHighlightStringLiteral">&quot;Number of vectorized aggregates&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightComment">/// Disable running mem2reg during SROA in order to test or debug SROA.</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121" lineLink="#a1b382400b6aa5cded55f3c0d0a0f9bf8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a1b382400b6aa5cded55f3c0d0a0f9bf8">SROASkipMem2Reg</a>(</span><span class="doxyHighlightStringLiteral">&quot;sroa-skip-mem2reg&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">                                     <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="/docs/api/namespaces/anonymous-sroa-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter">AllocaSliceRewriter</a>;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a>;</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition">Partition</a>;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a8b3a2a20e321496f2ff4ae0a11351bcf">SelectHandSpeculativity</a> &#123;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> Storage = 0; </span><span class="doxyHighlightComment">// None are speculatable by default.</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">TrueVal = <a href="/docs/api/structs/llvm/bitfield/element">Bitfield::Element&lt;bool, 0, 1&gt;</a>;  </span><span class="doxyHighlightComment">// Low 0&#39;th bit.</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">FalseVal = <a href="/docs/api/structs/llvm/bitfield/element">Bitfield::Element&lt;bool, 1, 1&gt;</a>; </span><span class="doxyHighlightComment">// Low 1&#39;th bit.</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a8b3a2a20e321496f2ff4ae0a11351bcf"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a8b3a2a20e321496f2ff4ae0a11351bcf">SelectHandSpeculativity</a>() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a8b3a2a20e321496f2ff4ae0a11351bcf">SelectHandSpeculativity</a> &amp;<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a6209f400e7cf0f855586aba618156e4b">setAsSpeculatable</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isTrueVal);</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#aa805dfd609789d10f3584ea58dc4722e">isSpeculatable</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isTrueVal) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#adad8666c34db782ec65e459474d9818e">areAllSpeculatable</a>() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#ad08f50c8be255b4a2c29229d279aae39">areAnySpeculatable</a>() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a143122ec3e895ae04e3f0ba830f0d5fe">areNoneSpeculatable</a>() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For interop as int half of PointerIntPair.</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a4b9ba51ced09013daa35f3e578e714e3"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">explicit</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">operator</span><span class="doxyHighlight"> intptr&#95;t()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">intptr&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(Storage); &#125;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a303d18dc3676b45471343b429d9fe6fe"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">explicit</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a303d18dc3676b45471343b429d9fe6fe">SelectHandSpeculativity</a>(intptr&#95;t Storage&#95;) : Storage(Storage&#95;) &#123;&#125;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightKeyword">static&#95;assert</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">sizeof</span><span class="doxyHighlight">(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a8b3a2a20e321496f2ff4ae0a11351bcf">SelectHandSpeculativity</a>) == </span><span class="doxyHighlightKeyword">sizeof</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> char));</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146" lineLink="/docs/api/namespaces/anonymous-sroa-cpp-/#a7093375450ef5127cbfd60122159f14c"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a7093375450ef5127cbfd60122159f14c">PossiblySpeculatableLoad</a> =</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/pointerintpair">PointerIntPair&lt;LoadInst &#42;, 2, SelectHandSpeculativity&gt;</a>;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148" lineLink="/docs/api/namespaces/anonymous-sroa-cpp-/#a9467aa3f41bed776158c3d1debdd90ac"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a9467aa3f41bed776158c3d1debdd90ac">UnspeculatableStore</a> = <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149" lineLink="/docs/api/namespaces/anonymous-sroa-cpp-/#abec97ac904acec4f3903802da5e40cd3"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-sroa-cpp-/#abec97ac904acec4f3903802da5e40cd3">RewriteableMemOp</a> =</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">    std::variant&lt;PossiblySpeculatableLoad, UnspeculatableStore&gt;;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151" lineLink="/docs/api/namespaces/anonymous-sroa-cpp-/#a0bd6174f8bb3840fa3e80f8c870023fd"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a0bd6174f8bb3840fa3e80f8c870023fd">RewriteableMemOps</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;RewriteableMemOp, 2&gt;</a>;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">/// An optimization pass providing Scalar Replacement of Aggregates.</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">/// This pass takes allocations which can be completely analyzed (that is, they</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightComment">/// don&#39;t escape) and tries to turn them into scalar SSA values. There are</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">/// a few steps to this process.</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">/// 1) It takes allocations of aggregates and analyzes the ways in which they</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlightComment">///    are used to try to split them into smaller allocations, ideally of</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightComment">///    a single scalar data type. It will split up memcpy and memset accesses</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightComment">///    as necessary and try to isolate individual scalar accesses.</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightComment">/// 2) It will transform accesses into forms which are suitable for SSA value</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlightComment">///    promotion. This can be replacing a memset with a scalar store of an</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlightComment">///    integer value, or it can involve speculating operations on a PHI or</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlightComment">///    select to be a PHI or select of the results.</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlightComment">/// 3) Finally, this will try to detect a pattern of accesses which map cleanly</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlightComment">///    onto insert and extract operations on a vector value, and convert them to</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlightComment">///    this form. By doing so, it will enable promotion of vector aggregates to</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlightComment">///    SSA vector values.</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#afc5246d29111911b196d9a1c69aa812c">SROA</a> &#123;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> C;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DTU;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> AC;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PreserveCFG;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlightComment">  /// Worklist of alloca instructions to simplify.</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlightComment">  /// Each alloca in the function is added to this. Each new alloca formed gets</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlightComment">  /// added to it as well to recursively simplify unless that alloca can be</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlightComment">  /// directly promoted. Finally, each time we rewrite a use of an alloca other</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlightComment">  /// the one being actively rewritten, we add it back onto the list if not</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlightComment">  /// already present to ensure it is re-visited.</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;AllocaInst &#42;, 16&gt;</a> Worklist;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlightComment">  /// A collection of instructions to delete.</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightComment">  /// We try to batch deletions to simplify code and make things a bit more</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlightComment">  /// efficient. We also make sure there is no dangling pointers.</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakVH, 8&gt;</a> DeadInsts;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlightComment">  /// Post-promotion worklist.</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlightComment">  /// Sometimes we discover an alloca which has a high probability of becoming</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlightComment">  /// viable for SROA after a round of promotion takes place. In those cases,</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlightComment">  /// the alloca is enqueued here for re-processing.</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlightComment">  /// Note that we have to be very careful to clear allocas out of this list in</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlightComment">  /// the event they are deleted.</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;AllocaInst &#42;, 16&gt;</a> PostPromotionWorklist;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlightComment">  /// A collection of alloca instructions we can directly promote.</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;AllocaInst &#42;, SmallVector&lt;AllocaInst &#42;&gt;</a>,</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;AllocaInst &#42;, 16&gt;</a>, 16&gt;</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      PromotableAllocas;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlightComment">  /// A worklist of PHIs to speculate prior to promoting allocas.</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlightComment">  /// All of these PHIs have been checked for the safety of speculation and by</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlightComment">  /// being speculated will allow promoting allocas currently in the promotable</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlightComment">  /// queue.</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;PHINode &#42;, 8&gt;</a> SpeculatablePHIs;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlightComment">  /// A worklist of select instructions to rewrite prior to promoting</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlightComment">  /// allocas.</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;SelectInst &#42;, RewriteableMemOps, 8&gt;</a> SelectsToRewrite;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlightComment">  /// Select instructions that use an alloca and are subsequently loaded can be</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlightComment">  /// rewritten to load both input pointers and then select between the result,</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlightComment">  /// allowing the load of the alloca to be promoted.</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlightComment">  /// From this:</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlightComment">  ///   %P2 = select i1 %cond, ptr %Alloca, ptr %Other</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlightComment">  ///   %V = load &lt;type&gt;, ptr %P2</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlightComment">  /// to:</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlightComment">  ///   %V1 = load &lt;type&gt;, ptr %Alloca      -&gt; will be mem2reg&#39;d</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlightComment">  ///   %V2 = load &lt;type&gt;, ptr %Other</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlightComment">  ///   %V = select i1 %cond, &lt;type&gt; %V1, &lt;type&gt; %V2</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlightComment">  /// We can do this to a select if its only uses are loads</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlightComment">  /// and if either the operand to the select can be loaded unconditionally,</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlightComment">  ///        or if we are allowed to perform CFG modifications.</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlightComment">  /// If found an intervening bitcast with a single use of the load,</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlightComment">  /// allow the promotion.</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;RewriteableMemOps&gt;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  isSafeSelectToSpeculate(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PreserveCFG);</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#afc5246d29111911b196d9a1c69aa812c"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#afc5246d29111911b196d9a1c69aa812c">SROA</a>(<a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &#42;C, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139">SROAOptions</a> PreserveCFG&#95;)</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">      : C(C), DTU(DTU), AC(AC),</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">        PreserveCFG(PreserveCFG&#95; == <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139">SROAOptions</a>::PreserveCFG) &#123;&#125;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlightComment">  /// Main run method used by both the SROAPass and by the legacy pass.</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">  std::pair&lt;</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Changed&#42;/</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;CFGChanged&#42;/</span><span class="doxyHighlight">&gt; runSROA(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#a79522441dc59c0a101a4e208abdf855a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#a79522441dc59c0a101a4e208abdf855a">AllocaSliceRewriter</a>;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> presplitLoadsAndStores(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS);</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;rewritePartition(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition">Partition</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> splitAlloca(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS);</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> propagateStoredValuesToLoads(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS);</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">  std::pair&lt;</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Changed&#42;/</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;CFGChanged&#42;/</span><span class="doxyHighlight">&gt; runOnAlloca(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI);</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> clobberUse(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U);</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> deleteDeadInstructions(<a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;AllocaInst &#42;&gt;</a> &amp;DeletedAllocas);</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> promoteAllocas(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlightComment">/// Calculate the fragment of a variable to use when slicing a store</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlightComment">/// based on the slice dimensions, existing fragment, and base storage</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlightComment">/// fragment.</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlightComment">/// Results:</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlightComment">/// UseFrag - Use Target as the new fragment.</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlightComment">/// UseNoFrag - The new slice already covers the whole variable.</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlightComment">/// Skip - The new alloca slice doesn&#39;t include this variable.</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightComment">/// FIXME: Can we use calculateFragmentIntersect instead?</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269" lineLink="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520e"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520e">FragCalcResult</a> &#123; <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520ea9745a2ae9717a9a4a5554b0916a1b33d">UseFrag</a>, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520eaeeb027708a9dec9a0f3bff25a3b0ded8">UseNoFrag</a>, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520eacc6534ce01ba29b615c54d66b077022f">Skip</a> &#125;;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520e">FragCalcResult</a></span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272" lineLink="#a490b4809c80e7aa15ff171dae7f97b39"><span class="doxyHighlight"><a href="#a490b4809c80e7aa15ff171dae7f97b39">calculateFragment</a>(<a href="/docs/api/classes/llvm/dilocalvariable">DILocalVariable</a> &#42;Variable,</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">                  uint64&#95;t NewStorageSliceOffsetInBits,</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">                  uint64&#95;t NewStorageSliceSizeInBits,</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">                  std::optional&lt;DIExpression::FragmentInfo&gt; StorageFragment,</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">                  std::optional&lt;DIExpression::FragmentInfo&gt; CurrentFragment,</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> &amp;<a href="/docs/api/classes/llvm/target">Target</a>) &#123;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the base storage describes part of the variable apply the offset and</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the size constraint.</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StorageFragment) &#123;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/target">Target</a>.SizeInBits =</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">        std::min(NewStorageSliceSizeInBits, StorageFragment-&gt;SizeInBits);</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/target">Target</a>.OffsetInBits =</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">        NewStorageSliceOffsetInBits + StorageFragment-&gt;OffsetInBits;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/target">Target</a>.SizeInBits = NewStorageSliceSizeInBits;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/target">Target</a>.OffsetInBits = NewStorageSliceOffsetInBits;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this slice extracts the entirety of an independent variable from a</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// larger alloca, do not produce a fragment expression, as the variable is</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not fragmented.</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurrentFragment) &#123;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = Variable-&gt;<a href="/docs/api/classes/llvm/divariable/#a6b5977deeb9f99e156685e190de78403">getSizeInBits</a>()) &#123;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Treat the current fragment as covering the whole variable.</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">      CurrentFragment = <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a>(&#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, 0);</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/target">Target</a> == CurrentFragment)</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520eaeeb027708a9dec9a0f3bff25a3b0ded8">UseNoFrag</a>;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No additional work to do if there isn&#39;t a fragment already, or there is</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// but it already exactly describes the new assignment.</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurrentFragment || &#42;CurrentFragment == <a href="/docs/api/classes/llvm/target">Target</a>)</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520ea9745a2ae9717a9a4a5554b0916a1b33d">UseFrag</a>;</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reject the target fragment if it doesn&#39;t fit wholly within the current</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fragment. TODO: We could instead chop up the target to fit in the case of</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a partial overlap.</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/target">Target</a>.startInBits() &lt; CurrentFragment-&gt;startInBits() ||</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/target">Target</a>.endInBits() &gt; CurrentFragment-&gt;endInBits())</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520eacc6534ce01ba29b615c54d66b077022f">Skip</a>;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Target fits within the current fragment, return it.</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520ea9745a2ae9717a9a4a5554b0916a1b33d">UseFrag</a>;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318" lineLink="#a30791b6c651e6313b0aab3f01da9d57b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a> <a href="#a30791b6c651e6313b0aab3f01da9d57b">getAggregateVariable</a>(<a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42;DVI) &#123;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(DVI-&gt;<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a854857be09a21f27fb21ba872fe6f639">getVariable</a>(), std::nullopt,</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">                       DVI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>().<a href="/docs/api/classes/llvm/debugloc/#ada0b6f3c53a53b7274e7aeb23eeab5a8">getInlinedAt</a>());</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322" lineLink="#a91311bfd92d95fb2817580a39aa9a6ad"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a> <a href="#a30791b6c651e6313b0aab3f01da9d57b">getAggregateVariable</a>(<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR) &#123;</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#aa774c62045e74bb457b32713c0670696">getVariable</a>(), std::nullopt,</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">                       DVR-&gt;<a href="/docs/api/classes/llvm/dbgrecord/#a3a0f4e00c3f6345c52c6acd178b3fca3">getDebugLoc</a>().<a href="/docs/api/classes/llvm/debugloc/#ada0b6f3c53a53b7274e7aeb23eeab5a8">getInlinedAt</a>());</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightComment">/// Helpers for handling new and old debug info modes in migrateDebugInfo.</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlightComment">/// These overloads unwrap a DbgInstPtr &#123;Instruction&#42; | DbgRecord&#42;&#125; union based</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlightComment">/// on the \\p Unused parameter type.</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330" lineLink="#a23a1af31637f354c7238e84dde44e61a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;<a href="#a23a1af31637f354c7238e84dde44e61a">UnwrapDbgInstPtr</a>(<a href="/docs/api/namespaces/llvm/#ae590e0c860e4c1fb30629dfecac4bd58">DbgInstPtr</a> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;Unused) &#123;</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  (void)Unused;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgRecord &#42;&gt;</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>));</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334" lineLink="#ac31fe878ff80e6b98248cacd098ab29b"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;<a href="#a23a1af31637f354c7238e84dde44e61a">UnwrapDbgInstPtr</a>(<a href="/docs/api/namespaces/llvm/#ae590e0c860e4c1fb30629dfecac4bd58">DbgInstPtr</a> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;Unused) &#123;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  (void)Unused;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction &#42;&gt;</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>));</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlightComment">/// Find linked dbg.assign and generate a new one with the correct</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlightComment">/// FragmentInfo. Link Inst to the new dbg.assign.  If Value is nullptr the</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlightComment">/// value component is copied from the old dbg.assign to the new.</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlightComment">/// \\param OldAlloca             Alloca for the variable before splitting.</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlightComment">/// \\param IsSplit               True if the store (not necessarily alloca)</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlightComment">///                              is being split.</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlightComment">/// \\param OldAllocaOffsetInBits Offset of the slice taken from OldAlloca.</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlightComment">/// \\param SliceSizeInBits       New number of bits being written to.</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlightComment">/// \\param OldInst               Instruction that is being split.</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlightComment">/// \\param Inst                  New instruction performing this part of the</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlightComment">///                              split store.</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlightComment">/// \\param Dest                  Store destination.</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlightComment">/// \\param Value                 Stored value.</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlightComment">/// \\param DL                    Datalayout.</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353" lineLink="#a0346c3f86c714b9ae84f5566a95e90ac"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;OldAlloca, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSplit,</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">                             uint64&#95;t OldAllocaOffsetInBits,</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">                             uint64&#95;t SliceSizeInBits, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldInst,</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Dest, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/value">Value</a>,</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MarkerRange = <a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(OldInst);</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DVRAssignMarkerRange = <a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(OldInst);</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Nothing to do if OldInst has no linked dbg.assign intrinsics.</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MarkerRange.empty() &amp;&amp; DVRAssignMarkerRange.empty())</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  migrateDebugInfo\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    OldAlloca: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OldAlloca &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    IsSplit: &quot;</span><span class="doxyHighlight"> &lt;&lt; IsSplit &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    OldAllocaOffsetInBits: &quot;</span><span class="doxyHighlight"> &lt;&lt; OldAllocaOffsetInBits</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    SliceSizeInBits: &quot;</span><span class="doxyHighlight"> &lt;&lt; SliceSizeInBits &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    OldInst: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OldInst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Inst: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Inst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Dest: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Dest &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a>)</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Value: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/classes/llvm/value">Value</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlightComment">  /// Map of aggregate variables to their fragment associated with OldAlloca.</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;DebugVariable, std::optional&lt;DIExpression::FragmentInfo&gt;</a>&gt;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">      BaseFragments;</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DAI : <a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(OldAlloca))</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">    BaseFragments&#91;<a href="#a30791b6c651e6313b0aab3f01da9d57b">getAggregateVariable</a>(DAI)&#93; =</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">        DAI-&gt;getExpression()-&gt;getFragmentInfo();</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DVR : <a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(OldAlloca))</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    BaseFragments&#91;<a href="#a30791b6c651e6313b0aab3f01da9d57b">getAggregateVariable</a>(DVR)&#93; =</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">        DVR-&gt;getExpression()-&gt;getFragmentInfo();</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The new inst needs a DIAssignID unique metadata tag (if OldInst has</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one). It shouldn&#39;t already have one: assert this assumption.</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;DIAssignID));</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/diassignid">DIAssignID</a> &#42;NewID = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Ctx = Inst-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>();</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> DIB(&#42;OldInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), </span><span class="doxyHighlightComment">/&#42;AllowUnresolved&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a36e31f42170be95fc392dad696d9ba19">isStaticAlloca</a>());</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MigrateDbgAssign = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgAssign) &#123;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      existing dbg.assign is: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;DbgAssign</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Expr = DbgAssign-&gt;getExpression();</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SetKillLocation = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSplit) &#123;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">      std::optional&lt;DIExpression::FragmentInfo&gt; BaseFragment;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">      &#123;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> R = BaseFragments.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="#a30791b6c651e6313b0aab3f01da9d57b">getAggregateVariable</a>(DbgAssign));</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (R == BaseFragments.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">        BaseFragment = R-&gt;second;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">      std::optional&lt;DIExpression::FragmentInfo&gt; CurrentFragment =</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">          Expr-&gt;getFragmentInfo();</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> NewFragment;</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520e">FragCalcResult</a> Result = <a href="#a490b4809c80e7aa15ff171dae7f97b39">calculateFragment</a>(</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">          DbgAssign-&gt;getVariable(), OldAllocaOffsetInBits, SliceSizeInBits,</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">          BaseFragment, CurrentFragment, NewFragment);</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result == <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520eacc6534ce01ba29b615c54d66b077022f">Skip</a>)</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result == <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a2819f4cf13f1e26271d1f82b802d520ea9745a2ae9717a9a4a5554b0916a1b33d">UseFrag</a> &amp;&amp; !(NewFragment == CurrentFragment)) &#123;</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentFragment) &#123;</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Rewrite NewFragment to be relative to the existing one (this is</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// what createFragmentExpression wants).  CalculateFragment has</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// already resolved the size for us. FIXME: Should it return the</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// relative fragment too?</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">          NewFragment.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#aa448040bf5ec2ebafc3dbe0eb15b6d55">OffsetInBits</a> -= CurrentFragment-&gt;OffsetInBits;</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Add the new fragment info to the existing expression if possible.</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/classes/llvm/diexpression/#ab2fc167f75191e1d22e12e8e382605bb">DIExpression::createFragmentExpression</a>(</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">                Expr, NewFragment.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#aa448040bf5ec2ebafc3dbe0eb15b6d55">OffsetInBits</a>, NewFragment.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#af581a7bb056b2b642d6705cc4af65fa2">SizeInBits</a>)) &#123;</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">          Expr = &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Otherwise, add the new fragment info to an empty expression and</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// discard the value component of this dbg.assign as the value cannot</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// be computed with the new fragment.</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">          Expr = &#42;<a href="/docs/api/classes/llvm/diexpression/#ab2fc167f75191e1d22e12e8e382605bb">DIExpression::createFragmentExpression</a>(</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIExpression::get</a>(Expr-&gt;getContext(), &#123;&#125;),</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">              NewFragment.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#aa448040bf5ec2ebafc3dbe0eb15b6d55">OffsetInBits</a>, NewFragment.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#af581a7bb056b2b642d6705cc4af65fa2">SizeInBits</a>);</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">          SetKillLocation = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we haven&#39;t created a DIAssignID ID do that now and attach it to Inst.</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewID) &#123;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">      NewID = <a href="/docs/api/classes/llvm/diassignid/#aa1a51f00d72f783f9da056877b8fe632">DIAssignID::getDistinct</a>(Ctx);</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">      Inst-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;DIAssignID, NewID);</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">::Value</a> &#42;NewValue = <a href="/docs/api/classes/llvm/value">Value</a> ? <a href="/docs/api/classes/llvm/value">Value</a> : DbgAssign-&gt;getValue();</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewAssign = <a href="#a23a1af31637f354c7238e84dde44e61a">UnwrapDbgInstPtr</a>(</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">        DIB.<a href="/docs/api/classes/llvm/dibuilder/#a5a6937fcd639ac78a93b48ab6624e957">insertDbgAssign</a>(Inst, NewValue, DbgAssign-&gt;getVariable(), Expr,</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">                            Dest, <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIExpression::get</a>(Expr-&gt;getContext(), &#123;&#125;),</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">                            DbgAssign-&gt;getDebugLoc()),</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">        DbgAssign);</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;ve updated the value but the original dbg.assign has an arglist</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// then kill it now - we can&#39;t use the requested new value.</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can&#39;t replace the DIArgList with the new value as it&#39;d leave</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the DIExpression in an invalid state (DW&#95;OP&#95;LLVM&#95;arg operands without</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// an arglist). And we can&#39;t keep the DIArgList in case the linked store</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is being split - in which case the DIArgList + expression may no longer</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be computing the correct value.</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This should be a very rare situation as it requires the value being</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// stored to differ from the dbg.assign (i.e., the value has been</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// represented differently in the debug intrinsic for some reason).</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">    SetKillLocation |=</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &amp;&amp; (DbgAssign-&gt;hasArgList() ||</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">                  !DbgAssign-&gt;getExpression()-&gt;isSingleLocationExpression());</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SetKillLocation)</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">      NewAssign-&gt;setKillLocation();</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We could use more precision here at the cost of some additional (code)</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// complexity - if the original dbg.assign was adjacent to its store, we</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// could position this new dbg.assign adjacent to its store rather than the</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// old dbg.assgn. That would result in interleaved dbg.assigns rather than</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// what we get now:</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    split store !1</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    split store !2</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    dbg.assign !1</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    dbg.assign !2</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This (current behaviour) results results in debug assignments being</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// noted as slightly offset (in code) from the store. In practice this</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// should have little effect on the debugging experience due to the fact</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that all the split stores should get the same line number.</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">    NewAssign-&gt;moveBefore(DbgAssign-&gt;getIterator());</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    NewAssign-&gt;setDebugLoc(DbgAssign-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Created new assign: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewAssign &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(MarkerRange, MigrateDbgAssign);</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(DVRAssignMarkerRange, MigrateDbgAssign);</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlightComment">/// A custom IRBuilder inserter which prefixes all names, but only in</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlightComment">/// Assert builds.</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter">IRBuilderPrefixedInserter</a> final : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/irbuilderdefaultinserter">IRBuilderDefaultInserter</a> &#123;</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  std::string Prefix;</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/twine">Twine</a> getNameWithPrefix(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Name.isTriviallyEmpty() ? Name : Prefix + Name;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter/#a0981aec7a2f427a0628875841bd567a8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter/#a0981aec7a2f427a0628875841bd567a8">SetNamePrefix</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123; Prefix = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.str(); &#125;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter/#a53ed76a0f259c30bcba9529d7bfc9e9c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/irbuilderprefixedinserter/#a53ed76a0f259c30bcba9529d7bfc9e9c">InsertHelper</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name,</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilderdefaultinserter/#a21ae8ae9d2e575d1008b95ae539aae2b">IRBuilderDefaultInserter::InsertHelper</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, getNameWithPrefix(Name),</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">                                           InsertPt);</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlightComment">/// Provide a type for IRBuilder that drops names in release builds.</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515" lineLink="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> = <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;ConstantFolder, IRBuilderPrefixedInserter&gt;</a>;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">/// A used slice of an alloca.</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlightComment">/// This structure represents a slice of an alloca used by some instruction. It</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlightComment">/// stores both the begin and end offsets of this use, a pointer to the use</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlightComment">/// itself, and a flag indicating whether we can classify the use as splittable</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlightComment">/// or not when forming partitions of the alloca.</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2">Slice</a> &#123;</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlightComment">  /// The beginning offset of the range.</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  uint64&#95;t BeginOffset = 0;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlightComment">  /// The ending offset, not included in the range.</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">  uint64&#95;t EndOffset = 0;</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlightComment">  /// Storage for both the use of this slice and whether it can be</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlightComment">  /// split.</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/pointerintpair">PointerIntPair&lt;Use &#42;, 1, bool&gt;</a> UseAndIsSplittable;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2">Slice</a>() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a8179f125330d27049011790904bbdfd0"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a8179f125330d27049011790904bbdfd0">Slice</a>(uint64&#95;t BeginOffset, uint64&#95;t EndOffset, <a href="/docs/api/classes/llvm/use">Use</a> &#42;U, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSplittable)</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">      : BeginOffset(BeginOffset), EndOffset(EndOffset),</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">        UseAndIsSplittable(U, IsSplittable) &#123;&#125;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a6dec7bdd275c1096cc2f1888e463665e"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a6dec7bdd275c1096cc2f1888e463665e">beginOffset</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BeginOffset; &#125;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#ad54f462f2854ae4b16796133168477de"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#ad54f462f2854ae4b16796133168477de">endOffset</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EndOffset; &#125;</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a34b1efe42be3aa569e499849efe6477d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a34b1efe42be3aa569e499849efe6477d">isSplittable</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UseAndIsSplittable.getInt(); &#125;</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#adf0967e6927ba0b71281602261b71f1e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#adf0967e6927ba0b71281602261b71f1e">makeUnsplittable</a>() &#123; UseAndIsSplittable.setInt(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">); &#125;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#acd6900c5f09016f6ad1ad8932bf7ee14"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/use">Use</a> &#42;<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#acd6900c5f09016f6ad1ad8932bf7ee14">getUse</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UseAndIsSplittable.getPointer(); &#125;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a4868b432ece4f5a415512709d74d5f1e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a4868b432ece4f5a415512709d74d5f1e">isDead</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#acd6900c5f09016f6ad1ad8932bf7ee14">getUse</a>() == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a70e4481fca9e174627e425a5573fc668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a70e4481fca9e174627e425a5573fc668">kill</a>() &#123; UseAndIsSplittable.setPointer(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">); &#125;</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlightComment">  /// Support for ordering ranges.</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlightComment">  /// This provides an ordering over ranges such that start offsets are</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlightComment">  /// always increasing, and within equal start offsets, the end offsets are</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlightComment">  /// decreasing. Thus the spanning range comes first in a cluster with the</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlightComment">  /// same start position.</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#aaa496ecfd8937d9232eadf4c08095d80"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#aaa496ecfd8937d9232eadf4c08095d80">operator&lt;</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2">Slice</a> &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a6dec7bdd275c1096cc2f1888e463665e">beginOffset</a>() &lt; RHS.beginOffset())</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a6dec7bdd275c1096cc2f1888e463665e">beginOffset</a>() &gt; RHS.beginOffset())</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a34b1efe42be3aa569e499849efe6477d">isSplittable</a>() != RHS.isSplittable())</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a34b1efe42be3aa569e499849efe6477d">isSplittable</a>();</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#ad54f462f2854ae4b16796133168477de">endOffset</a>() &gt; RHS.endOffset())</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlightComment">  /// Support comparison with a single offset to allow binary searches.</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a0a8bc89992786ef1cb98be7e518e6849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#acc1c483f4b4ee2f17bb6643a3b353609">LLVM&#95;ATTRIBUTE&#95;UNUSED</a> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a0a8bc89992786ef1cb98be7e518e6849">operator&lt;</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2">Slice</a> &amp;LHS,</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">                                              uint64&#95;t RHSOffset) &#123;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHS.beginOffset() &lt; RHSOffset;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a086fd953b23c8ea0df25ad9ae20670ea"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#acc1c483f4b4ee2f17bb6643a3b353609">LLVM&#95;ATTRIBUTE&#95;UNUSED</a> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a086fd953b23c8ea0df25ad9ae20670ea">operator&lt;</a>(uint64&#95;t LHSOffset,</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">                                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2">Slice</a> &amp;RHS) &#123;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHSOffset &lt; RHS.beginOffset();</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a67c455487635523fc263fde777087717"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a67c455487635523fc263fde777087717">operator==</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2">Slice</a> &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a34b1efe42be3aa569e499849efe6477d">isSplittable</a>() == RHS.isSplittable() &amp;&amp;</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">           <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a6dec7bdd275c1096cc2f1888e463665e">beginOffset</a>() == RHS.beginOffset() &amp;&amp; <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#ad54f462f2854ae4b16796133168477de">endOffset</a>() == RHS.endOffset();</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#ae74cc2f68017f46808c223df3b139e18"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#ae74cc2f68017f46808c223df3b139e18">operator!=</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/slice/#a74976613b9312a4eca293750df8bc1a2">Slice</a> &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#a4d812a2dd18aa186c164447e20e348e7">operator==</a>(RHS); &#125;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlightComment">/// Representation of the alloca slices.</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlightComment">/// This class represents the slices of an alloca which are formed by its</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlightComment">/// various uses. If a pointer escapes, we can&#39;t fully build a representation</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlightComment">/// for the slices used and we reflect that in this structure. The uses are</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlightComment">/// stored, sorted by increasing beginning offset and with unsplittable slices</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlightComment">/// starting at a particular offset before splittable slices.</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a57e4e42fb1a33956f31a76559c80485b">AllocaSlices</a> &#123;</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlightComment">  /// Construct the slices of a particular alloca.</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a57e4e42fb1a33956f31a76559c80485b"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a57e4e42fb1a33956f31a76559c80485b">AllocaSlices</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI);</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlightComment">  /// Test whether a pointer to the allocation escapes our analysis.</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlightComment">  /// If this is true, the slices are never fully built and should be</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlightComment">  /// ignored.</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a4b26ec50bd45cb91a28d19e08b53e6be"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a4b26ec50bd45cb91a28d19e08b53e6be">isEscaped</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PointerEscapingInstr; &#125;</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a3b4cbfee42212ff4f0c59742fbfbf15a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a3b4cbfee42212ff4f0c59742fbfbf15a">isEscapedReadOnly</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PointerEscapingInstrReadOnly; &#125;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlightComment">  /// Support for iterating over the slices.</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlightComment">  /// @&#123;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">iterator</a> = <a href="/docs/api/classes/llvm/smallvectorimpl/#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;Slice&gt;::iterator</a>;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a243bdc4c4bcaf99800841979de344f8c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a243bdc4c4bcaf99800841979de344f8c">range</a> = <a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range&lt;iterator&gt;</a>;</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a3265a3ed574c84058706161a9f3dd1ed"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">iterator</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a3265a3ed574c84058706161a9f3dd1ed">begin</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Slices.begin(); &#125;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aaae89e1b35c44450b62ddfc3033f618e"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">iterator</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aaae89e1b35c44450b62ddfc3033f618e">end</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Slices.end(); &#125;</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> = <a href="/docs/api/classes/llvm/smallvectorimpl/#a641b0782e0cc309372855bfc19fdfd97">SmallVectorImpl&lt;Slice&gt;::const&#95;iterator</a>;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ac3a33e07640ddec25830a636e84c0e23"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ac3a33e07640ddec25830a636e84c0e23">const&#95;range</a> = <a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range&lt;const&#95;iterator&gt;</a>;</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ae4dc20e2719585ca61e190d753b4dd84"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ae4dc20e2719585ca61e190d753b4dd84">begin</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Slices.begin(); &#125;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a26bd4690d6afdc0c98972bd613a52d94"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a26bd4690d6afdc0c98972bd613a52d94">end</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Slices.end(); &#125;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlightComment">  /// @&#125;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlightComment">  /// Erase a range of slices.</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a90b77be6df4479f45775b3eed9fdf140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a90b77be6df4479f45775b3eed9fdf140">erase</a>(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">iterator</a> Start, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">iterator</a> Stop) &#123; Slices.erase(Start, Stop); &#125;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlightComment">  /// Insert new slices for this alloca.</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlightComment">  /// This moves the slices into the alloca&#39;s slices collection, and re-sorts</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlightComment">  /// everything so that the usual ordering properties of the alloca&#39;s slices</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlightComment">  /// hold.</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a9d50c642270c265bdb2af02bf6d4eed0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a9d50c642270c265bdb2af02bf6d4eed0">insert</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Slice&gt;</a> NewSlices) &#123;</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> OldSize = Slices.size();</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">    Slices.append(NewSlices.<a href="/docs/api/classes/llvm/arrayref/#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), NewSlices.<a href="/docs/api/classes/llvm/arrayref/#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SliceI = Slices.begin() + OldSize;</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">    std::stable&#95;sort(SliceI, Slices.end());</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">    std::inplace&#95;merge(Slices.begin(), SliceI, Slices.end());</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Forward declare the iterator and range accessor for walking the</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// partitions.</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">partition&#95;iterator;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a59015205f2e341c003578afecd653eca"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range&lt;partition&#95;iterator&gt;</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a59015205f2e341c003578afecd653eca">partitions</a>();</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlightComment">  /// Access the dead users for this alloca.</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a375c627ea25cd244167c20c7f89ec910"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Instruction &#42;&gt;</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a375c627ea25cd244167c20c7f89ec910">getDeadUsers</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DeadUsers; &#125;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlightComment">  /// Access Uses that should be dropped if the alloca is promotable.</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad4a6303626704c781571e5b4dd9366ab"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Use &#42;&gt;</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad4a6303626704c781571e5b4dd9366ab">getDeadUsesIfPromotable</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DeadUseIfPromotable;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlightComment">  /// Access the dead operands referring to this alloca.</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlightComment">  /// These are operands which have cannot actually be used to refer to the</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlightComment">  /// alloca as they are outside its range and the user doesn&#39;t correct for</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlightComment">  /// that. These mostly consist of PHI node inputs and the like which we just</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlightComment">  /// need to replace with undef.</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a9573d85afd3de8ebbfa0999ba6edcb7e"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Use &#42;&gt;</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a9573d85afd3de8ebbfa0999ba6edcb7e">getDeadOperands</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DeadOperands; &#125;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a09d4b4a68a710521ace72d146ae2fb5b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a09d4b4a68a710521ace72d146ae2fb5b">print</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/stringref">StringRef</a> Indent = </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight">) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#adb7609cd30f47c1177bd9149c5695b07"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#adb7609cd30f47c1177bd9149c5695b07">printSlice</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/stringref">StringRef</a> Indent = </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight">) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa3800dd58371d975840087cf0f71406a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa3800dd58371d975840087cf0f71406a">printUse</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/stringref">StringRef</a> Indent = </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight">) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a9f22f9e026889cdac61c722e316a0f25"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a9f22f9e026889cdac61c722e316a0f25">print</a>(<a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad1650a5b98da86efa1e0ec0926c3b15b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad1650a5b98da86efa1e0ec0926c3b15b">dump</a>(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a1166882c353173bf8722ac7c9ac78897"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a1166882c353173bf8722ac7c9ac78897">dump</a>() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> DerivedT, </span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> RetT = </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">&gt; </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">BuilderBase;</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aee3b9c3a8070e4c1a419d1aaa396c4a4">SliceBuilder</a>;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aee3b9c3a8070e4c1a419d1aaa396c4a4"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aee3b9c3a8070e4c1a419d1aaa396c4a4">AllocaSlices::SliceBuilder</a>;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlightComment">  /// Handle to alloca instruction to simplify method interfaces.</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlightComment">  /// The instruction responsible for this alloca not having a known set</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlightComment">  /// of slices.</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlightComment">  /// When an instruction (potentially) escapes the pointer to the alloca, we</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlightComment">  /// store a pointer to that here and abort trying to form slices of the</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlightComment">  /// alloca. This will be null if the alloca slices are analyzed successfully.</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PointerEscapingInstr;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PointerEscapingInstrReadOnly;</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlightComment">  /// The slices of the alloca.</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlightComment">  /// We store a vector of the slices formed by uses of the alloca here. This</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlightComment">  /// vector is sorted by increasing begin offset, and then the unsplittable</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlightComment">  /// slices before the splittable ones. See the Slice inner class for more</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlightComment">  /// details.</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Slice, 8&gt;</a> Slices;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlightComment">  /// Instructions which will become dead if we rewrite the alloca.</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlightComment">  /// Note that these are not separated by slice. This is because we expect an</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlightComment">  /// alloca to be completely rewritten or not rewritten at all. If rewritten,</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlightComment">  /// all these instructions can simply be removed and replaced with poison as</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlightComment">  /// they come from outside of the allocated space.</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> DeadUsers;</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlightComment">  /// Uses which will become dead if can promote the alloca.</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Use &#42;, 8&gt;</a> DeadUseIfPromotable;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlightComment">  /// Operands which will become dead if we rewrite the alloca.</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlightComment">  /// These are operands that in their particular use can be replaced with</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlightComment">  /// poison when we rewrite the alloca. These show up in out-of-bounds inputs</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlightComment">  /// to PHI nodes and the like. They aren&#39;t entirely dead (there might be</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlightComment">  /// a GEP back into the bounds using it elsewhere) and nor is the PHI, but we</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlightComment">  /// want to swap this particular input for poison to simplify the use lists of</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlightComment">  /// the alloca.</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Use &#42;, 8&gt;</a> DeadOperands;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlightComment">/// A partition of the slices.</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlightComment">/// An ephemeral representation for a range of slices which can be viewed as</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlightComment">/// a partition of the alloca. This range represents a span of the alloca&#39;s</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlightComment">/// memory which cannot be split, and provides access to all of the slices</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlightComment">/// overlapping some part of the partition.</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlightComment">/// Objects of this type are produced by traversing the alloca&#39;s slices, but</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlightComment">/// are only ephemeral and not persistent.</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">Partition &#123;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a499150c6fcbe74f910eb3533901d9083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a499150c6fcbe74f910eb3533901d9083">AllocaSlices</a>;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a7b62c5f050b3232eda724b7b08bb5147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">AllocaSlices::partition&#95;iterator;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">iterator = <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">AllocaSlices::iterator</a>;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlightComment">  /// The beginning and ending offsets of the alloca for this</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlightComment">  /// partition.</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">  uint64&#95;t BeginOffset = 0, EndOffset = 0;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlightComment">  /// The start and end iterators of this partition.</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  iterator SI, SJ;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlightComment">  /// A collection of split slice tails overlapping the partition.</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Slice &#42;, 4&gt;</a> SplitTails;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlightComment">  /// Raw constructor builds an empty partition starting and ending at</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlightComment">  /// the given iterator.</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  Partition(iterator SI) : SI(SI), SJ(SI) &#123;&#125;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlightComment">  /// The start offset of this partition.</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlightComment">  /// All of the contained slices start at or after this offset.</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a45def197551605d13d134d4279e16457"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a45def197551605d13d134d4279e16457">beginOffset</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BeginOffset; &#125;</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlightComment">  /// The end offset of this partition.</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlightComment">  /// All of the contained slices end at or before this offset.</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#aa801bae53a7891490e91a950fd5302be"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#aa801bae53a7891490e91a950fd5302be">endOffset</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EndOffset; &#125;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlightComment">  /// The size of the partition.</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlightComment">  /// Note that this can never be zero.</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a1e3df5eb30dbcf9ff9f4a767764d26eb"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a1e3df5eb30dbcf9ff9f4a767764d26eb">size</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BeginOffset &lt; EndOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Partitions must span some bytes!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EndOffset - BeginOffset;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlightComment">  /// Test whether this partition contains no slices, and merely spans</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlightComment">  /// a region occupied by split slices.</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a332aca239849e5d123026eaac529e48b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a332aca239849e5d123026eaac529e48b">empty</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SI == SJ; &#125;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlightComment">  /// \\name Iterate slices that start within the partition.</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlightComment">  /// These may be splittable or unsplittable. They have a begin offset &gt;= the</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlightComment">  /// partition begin offset.</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlightComment">  /// @&#123;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: We should probably define a &quot;concat&#95;iterator&quot; helper and use that</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to stitch together pointee&#95;iterators over the split tails and the</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// contiguous iterators of the partition. That would give a much nicer</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// interface here. We could then additionally expose filtered iterators for</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// split, unsplit, and unsplittable splices based on the usage patterns.</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#aa41694321e39a14a5da301840055fe17"><span class="doxyHighlight">  iterator <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#aa41694321e39a14a5da301840055fe17">begin</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SI; &#125;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a8d5eae2fe05203ff3f3e625c9e580ffc"><span class="doxyHighlight">  iterator <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a8d5eae2fe05203ff3f3e625c9e580ffc">end</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SJ; &#125;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlightComment">  /// @&#125;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlightComment">  /// Get the sequence of split slice tails.</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlightComment">  /// These tails are of slices which start before this partition but are</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlightComment">  /// split and overlap into the partition. We accumulate these while forming</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlightComment">  /// partitions.</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a059c4503606498e74fdb8e43b2d013b5"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Slice &#42;&gt;</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition/#a059c4503606498e74fdb8e43b2d013b5">splitSliceTails</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SplitTails; &#125;</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlightComment">/// An iterator over partitions of the alloca&#39;s slices.</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlightComment">/// This iterator implements the core algorithm for partitioning the alloca&#39;s</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlightComment">/// slices. It is a forward iterator as we don&#39;t support backtracking for</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlightComment">/// efficiency reasons, and re-use a single storage area to maintain the</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlightComment">/// current set of split slices.</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlightComment">/// It is templated on the slice iterator type to use so that it can operate</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlightComment">/// with either const or non-const slice iterators.</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804" lineLink="/docs/api/classes/allocaslices/partition-iterator"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">AllocaSlices::partition&#95;iterator</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">    : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/iterator-facade-base">iterator&#95;facade&#95;base</a>&lt;partition&#95;iterator, std::forward&#95;iterator&#95;tag,</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">                                  Partition&gt; &#123;</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807" lineLink="/docs/api/classes/allocaslices/partition-iterator/#a499150c6fcbe74f910eb3533901d9083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/allocaslices/partition-iterator/#a499150c6fcbe74f910eb3533901d9083">AllocaSlices</a>;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlightComment">  /// Most of the state for walking the partitions is held in a class</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlightComment">  /// with a nice interface for examining them.</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  Partition P;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlightComment">  /// We need to keep the end of the slices to know when to stop.</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">AllocaSlices::iterator</a> SE;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlightComment">  /// We also need to keep track of the maximum split end offset seen.</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlightComment">  /// FIXME: Do we really?</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">  uint64&#95;t MaxSplitSliceEndOffset = 0;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlightComment">  /// Sets the partition to be empty at given iterator, and sets the</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlightComment">  /// end iterator.</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">  partition&#95;iterator(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">AllocaSlices::iterator</a> <a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa5e9599c0f44af2af5575fe5da9a935a">AllocaSlices::iterator</a> SE)</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">      : P(<a href="/docs/api/namespaces/llvm/si">SI</a>), SE(SE) &#123;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If not already at the end, advance our state to form the initial</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// partition.</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a> != SE)</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      advance();</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlightComment">  /// Advance the iterator to the next partition.</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlightComment">  /// Requires that the iterator not be at the end of the slices.</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> advance() &#123;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI != SE || !<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails.empty()) &amp;&amp;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot advance past the end of the slices!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clear out any split uses which have ended.</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails.empty()) &#123;</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset &gt;= MaxSplitSliceEndOffset) &#123;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we&#39;ve finished all splits, this is easy.</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails.clear();</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">        MaxSplitSliceEndOffset = 0;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remove the uses which have ended in the prior partition. This</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// cannot change the max split slice end because we just checked that</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the prior partition ended prior to that max.</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails,</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">                       &#91;&amp;&#93;(Slice &#42;S) &#123; return S-&gt;endOffset() &lt;= P.EndOffset; &#125;);</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">llvm::any&#95;of</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails,</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">                            &#91;&amp;&#93;(Slice &#42;S) &#123;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">                              return S-&gt;endOffset() == MaxSplitSliceEndOffset;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">                            &#125;) &amp;&amp;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Could not find the current max split slice offset!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails,</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">                            &#91;&amp;&#93;(Slice &#42;S) &#123;</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">                              return S-&gt;endOffset() &lt;= MaxSplitSliceEndOffset;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">                            &#125;) &amp;&amp;</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Max split slice end offset is not actually the max!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If P.SI is already at the end, then we&#39;ve cleared the split tail and</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// now have an end iterator.</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI == SE) &#123;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails.empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Failed to clear the split slices!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we had a non-empty partition previously, set up the state for</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// subsequent partitions.</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI != <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ) &#123;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Accumulate all the splittable slices which started in the old</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// partition into the split list.</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &amp;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>)</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.isSplittable() &amp;&amp; S.endOffset() &gt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset) &#123;</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails.push&#95;back(&amp;S);</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">          MaxSplitSliceEndOffset =</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">              std::max(S.endOffset(), MaxSplitSliceEndOffset);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Start from the end of the previous partition.</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ;</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If P.SI is now at the end, we at most have a tail of split slices.</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI == SE) &#123;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.BeginOffset = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset;</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset = MaxSplitSliceEndOffset;</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the we have split slices and the next slice is after a gap and is</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// not splittable immediately form an empty partition for the split</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// slices up until the next slice begins.</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails.empty() &amp;&amp; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;beginOffset() != <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset &amp;&amp;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">          !<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;isSplittable()) &#123;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.BeginOffset = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;beginOffset();</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// OK, we need to consume new slices. Set the end offset based on the</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// current slice, and step SJ past it. The beginning offset of the</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// partition is the beginning offset of the next slice unless we have</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pre-existing split slices that are continuing, in which case we begin</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// at the prior end offset.</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.BeginOffset = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SplitTails.empty() ? <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;beginOffset() : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;endOffset();</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">    ++<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There are two strategies to form a partition based on whether the</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// partition starts with an unsplittable slice or a splittable slice.</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;isSplittable()) &#123;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// When we&#39;re forming an unsplittable region, it must always start at</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the first slice and will extend through its end.</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.BeginOffset == <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;beginOffset());</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Form a partition including all of the overlapping slices with this</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// unsplittable slice.</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ != SE &amp;&amp; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;beginOffset() &lt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset) &#123;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;isSplittable())</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset = std::max(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;endOffset());</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We have a partition across a set of overlapping unsplittable</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// partitions.</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re starting with a splittable slice, then we need to form</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a synthetic partition spanning it and any other overlapping splittable</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// splices.</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SI-&gt;isSplittable() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Forming a splittable partition!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect all of the overlapping splittable slices.</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ != SE &amp;&amp; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;beginOffset() &lt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset &amp;&amp;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">           <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;isSplittable()) &#123;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset = std::max(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;endOffset());</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ;</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Back upiP.EndOffset if we ended the span early when encountering an</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unsplittable slice. This synthesizes the early end offset of</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a partition spanning only splittable slices.</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ != SE &amp;&amp; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;beginOffset() &lt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset) &#123;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;isSplittable());</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.EndOffset = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.SJ-&gt;beginOffset();</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953" lineLink="/docs/api/classes/allocaslices/partition-iterator/#a09094d8b7d9ec638b7c1dab3c9a2060d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/allocaslices/partition-iterator/#a09094d8b7d9ec638b7c1dab3c9a2060d">operator==</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> partition&#95;iterator &amp;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE == RHS.SE &amp;&amp;</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;End iterators don&#39;t match between compared partition iterators!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The observed positions of partitions is marked by the P.SI iterator and</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the emptiness of the split slices. The latter is only relevant when</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// P.SI == SE, as the end iterator will additionally have an empty split</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// slices list, but the prior may have the same P.SI and a tail of split</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// slices.</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (P.SI == RHS.P.SI &amp;&amp; P.SplitTails.empty() == RHS.P.SplitTails.empty()) &#123;</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(P.SJ == RHS.P.SJ &amp;&amp;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Same set of slices formed two different sized partitions!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(P.SplitTails.size() == RHS.P.SplitTails.size() &amp;&amp;</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Same slice position with differently sized non-empty split &quot;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;slice tails!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973" lineLink="/docs/api/classes/allocaslices/partition-iterator/#a55273ff472faed8c2870681606a84bd1"><span class="doxyHighlight">  partition&#95;iterator &amp;<a href="/docs/api/classes/allocaslices/partition-iterator/#a55273ff472faed8c2870681606a84bd1">operator++</a>() &#123;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">    advance();</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978" lineLink="/docs/api/classes/allocaslices/slicebuilder/#abb0399d372fbb120a3e1e0672af49785"><span class="doxyHighlight">  Partition &amp;<a href="/docs/api/namespaces/llvm/#a2366b4a30c90d2207626fb717dfb778d">operator&#42;</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>; &#125;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlightComment">/// A forward range over the partitions of the alloca&#39;s slices.</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlightComment">/// This accesses an iterator range over the partitions of the alloca&#39;s</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlightComment">/// slices. It computes these partitions on the fly based on the overlapping</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlightComment">/// offsets of the slices and the ability to split them. It will visit &quot;empty&quot;</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlightComment">/// partitions to cover regions of the alloca only accessed via split</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlightComment">/// slices.</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range&lt;AllocaSlices::partition&#95;iterator&gt;</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a59015205f2e341c003578afecd653eca">AllocaSlices::partitions</a>() &#123;</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(partition&#95;iterator(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a3265a3ed574c84058706161a9f3dd1ed">begin</a>(), <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aaae89e1b35c44450b62ddfc3033f618e">end</a>()),</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">                    partition&#95;iterator(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aaae89e1b35c44450b62ddfc3033f618e">end</a>(), <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aaae89e1b35c44450b62ddfc3033f618e">end</a>()));</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993" lineLink="#a6fc7e359a229f391d15a7a84a31e096a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a6fc7e359a229f391d15a7a84a31e096a">foldSelectInst</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the condition being selected on is a constant or the same value is</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// being selected between, fold the select. Yes this does (rarely) happen</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// early on.</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getCondition()))</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/si">SI</a>.getOperand(1 + CI-&gt;isZero());</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.getOperand(1) == <a href="/docs/api/namespaces/llvm/si">SI</a>.getOperand(2))</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/si">SI</a>.getOperand(1);</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlightComment">/// A helper that folds a PHI node or a select.</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006" lineLink="#a62ada829b4d3487b24df63322b26bfca"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a62ada829b4d3487b24df63322b26bfca">foldPHINodeOrSelectInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If PN merges together the same value, return that value.</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PN-&gt;hasConstantValue();</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a6fc7e359a229f391d15a7a84a31e096a">foldSelectInst</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlightComment">/// Builder for the alloca slices.</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlightComment">/// This class builds a set of alloca slices by recursively visiting the uses</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlightComment">/// of an alloca and making a slice for each load and store at each offset.</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018" lineLink="/docs/api/classes/allocaslices/slicebuilder"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aee3b9c3a8070e4c1a419d1aaa396c4a4">AllocaSlices::SliceBuilder</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/ptrusevisitor/#a564995c967b0a398c32f31a41b4418c1">PtrUseVisitor</a>&lt;SliceBuilder&gt; &#123;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/ptrusevisitor/#a564995c967b0a398c32f31a41b4418c1">PtrUseVisitor</a>&lt;<a href="/docs/api/classes/allocaslices/slicebuilder/#a8a54eb11a6edc3c5411cbedcf76b2002">SliceBuilder</a>&gt;;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instvisitor">InstVisitor</a>&lt;<a href="/docs/api/classes/allocaslices/slicebuilder/#a8a54eb11a6edc3c5411cbedcf76b2002">SliceBuilder</a>&gt;;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">Base = <a href="/docs/api/classes/llvm/ptrusevisitor/#a564995c967b0a398c32f31a41b4418c1">PtrUseVisitor&lt;SliceBuilder&gt;</a>;</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t AllocSize;</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  AllocaSlices &amp;AS;</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Instruction &#42;, unsigned&gt;</a> MemTransferSliceMap;</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Instruction &#42;, uint64&#95;t&gt;</a> PHIOrSelectSizes;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlightComment">  /// Set to de-duplicate dead instructions found in the use walk.</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 4&gt;</a> VisitedDeadInsts;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034" lineLink="/docs/api/classes/allocaslices/slicebuilder/#a8a54eb11a6edc3c5411cbedcf76b2002"><span class="doxyHighlight">  <a href="/docs/api/classes/allocaslices/slicebuilder/#a8a54eb11a6edc3c5411cbedcf76b2002">SliceBuilder</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#ac5b2513c27d0e8fe9a9214eb9fe99a7b">DL</a>, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI, AllocaSlices &amp;AS)</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/ptrusevisitor/#a564995c967b0a398c32f31a41b4418c1">PtrUseVisitor</a>&lt;<a href="/docs/api/classes/allocaslices/slicebuilder/#a8a54eb11a6edc3c5411cbedcf76b2002">SliceBuilder</a>&gt;(<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#ac5b2513c27d0e8fe9a9214eb9fe99a7b">DL</a>),</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">        AllocSize(<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#ac5b2513c27d0e8fe9a9214eb9fe99a7b">DL</a>.getTypeAllocSize(AI.getAllocatedType()).getFixedValue()),</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">        AS(AS) &#123;&#125;</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VisitedDeadInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">      AS.DeadUsers.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> insertUse(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>,</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSplittable = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Completely skip uses which have a zero size or start either before or</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// past the end of the allocation.</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> == 0 || <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.uge(AllocSize)) &#123;</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;WARNING: Ignoring &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; byte use @&quot;</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a></span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; which has zero size or starts outside of the &quot;</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">                        &lt;&lt; AllocSize &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; byte alloca:\\n&quot;</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    alloca: &quot;</span><span class="doxyHighlight"> &lt;&lt; AS.AI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;       use: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">    uint64&#95;t BeginOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue();</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">    uint64&#95;t EndOffset = BeginOffset + <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clamp the end offset to the end of the allocation. Note that this is</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// formulated to handle even the case where &quot;BeginOffset + Size&quot; overflows.</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This may appear superficially to be something we could ignore entirely,</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// but that is not so! There may be widened loads or PHI-node uses where</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// some instructions are dead but not others. We can&#39;t completely ignore</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// them, and so have to record at least the information here.</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AllocSize &gt;= BeginOffset); </span><span class="doxyHighlightComment">// Established above.</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; AllocSize - BeginOffset) &#123;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;WARNING: Clamping a &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; byte use @&quot;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to remain within the &quot;</span><span class="doxyHighlight"> &lt;&lt; AllocSize</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; byte alloca:\\n&quot;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    alloca: &quot;</span><span class="doxyHighlight"> &lt;&lt; AS.AI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;       use: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">      EndOffset = AllocSize;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">    AS.Slices.push&#95;back(Slice(BeginOffset, EndOffset, U, IsSplittable));</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitBitCastInst(BitCastInst &amp;BC) &#123;</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BC.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(BC);</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Base::visitBitCastInst(BC);</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitAddrSpaceCastInst(AddrSpaceCastInst &amp;ASC) &#123;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ASC.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(ASC);</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Base::visitAddrSpaceCastInst(ASC);</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitGetElementPtrInst(GetElementPtrInst &amp;GEPI) &#123;</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GEPI.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(GEPI);</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Base::visitGetElementPtrInst(GEPI);</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> handleLoadOrStore(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty, Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> APInt &amp;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">                         uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsVolatile) &#123;</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We allow splitting of non-volatile loads and stores where the type is an</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// integer type. These may be used to implement &#39;memcpy&#39; or other &quot;transfer</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of bits&quot; patterns.</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSplittable =</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">        Ty-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; !<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a4eea8fbc268a347761cbbc80e3660544">IsVolatile</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(Ty);</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">    insertUse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, IsSplittable);</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitLoadInst(LoadInst &amp;LI) &#123;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!LI.<a href="/docs/api/classes/llvm/loadinst/#aeb534c1a0391ce24551c226a582099a7">isSimple</a>() || LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;All simple FCA loads should have been pre-split&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsOffsetKnown)</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;LI);</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">    TypeSize <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>.isScalable())</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;LI);</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> handleLoadOrStore(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), LI, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>.getFixedValue(),</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">                             LI.<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>());</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitStoreInst(StoreInst &amp;SI) &#123;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ValOp = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getValueOperand();</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ValOp == &#42;U)</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#ab5478c96ff9b7951abe633b702b1c47e">setEscapedAndAborted</a>(&amp;SI);</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsOffsetKnown)</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;SI);</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">    TypeSize StoreSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(ValOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;SI);</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = StoreSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this memory access can be shown to &#42;statically&#42; extend outside the</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bounds of the allocation, it&#39;s behavior is undefined, so simply</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ignore it. Note that this is more strict than the generic clamping</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// behavior of insertUse. We also try to handle cases which might run the</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// risk of overflow.</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: We should instead consider the pointer to have escaped if this</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function is being instrumented for addressing bugs or race conditions.</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; AllocSize || <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.ugt(AllocSize - <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)) &#123;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;WARNING: Ignoring &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; byte store @&quot;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; which extends past the end of the &quot;</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">                        &lt;&lt; AllocSize &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; byte alloca:\\n&quot;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    alloca: &quot;</span><span class="doxyHighlight"> &lt;&lt; AS.AI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;       use: &quot;</span><span class="doxyHighlight"> &lt;&lt; SI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(SI);</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isSimple() || ValOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;All simple FCA stores should have been pre-split&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">    handleLoadOrStore(ValOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), SI, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile());</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitMemSetInst(MemSetInst &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawDest() == &#42;U &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Pointer use is not the destination?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">    ConstantInt &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getLength());</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a>-&gt;getValue() == 0) ||</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">        (IsOffsetKnown &amp;&amp; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.uge(AllocSize)))</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Zero-length mem transfer intrinsics can be ignored entirely.</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsOffsetKnown)</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">    insertUse(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a> ? <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a>-&gt;getLimitedValue()</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">                     : AllocSize - <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getLimitedValue(),</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">              (</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">)<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a>);</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitMemTransferInst(MemTransferInst &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">    ConstantInt &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getLength());</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a>-&gt;getValue() == 0)</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Zero-length mem transfer intrinsics can be ignored entirely.</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Because we can visit these intrinsics twice, also check to see if the</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// first time marked this instruction as dead. If so, skip it.</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VisitedDeadInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>))</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsOffsetKnown)</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This side of the transfer is completely out-of-bounds, and so we can</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// nuke the entire transfer. However, we also need to nuke the other side</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if already added to our partitions.</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Yet another place we really should bypass this when</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instrumenting for ASan.</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.uge(AllocSize)) &#123;</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">      SmallDenseMap&lt;Instruction &#42;, unsigned&gt;::iterator MTPI =</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">          MemTransferSliceMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MTPI != MemTransferSliceMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">        AS.Slices&#91;MTPI-&gt;second&#93;.kill();</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">    uint64&#95;t RawOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getLimitedValue();</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a> ? <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a>-&gt;getLimitedValue() : AllocSize - RawOffset;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check for the special case where the same exact value is used for both</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// source and dest.</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;U == <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawDest() &amp;&amp; &#42;U == <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawSource()) &#123;</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For non-volatile transfers this is a no-op.</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile())</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> insertUse(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, </span><span class="doxyHighlightComment">/&#42;IsSplittable=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have seen both source and destination for a mem transfer, then</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// they both point to the same alloca.</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa157d034f9c98a305eb73776582550027">Inserted</a>;</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">    SmallDenseMap&lt;Instruction &#42;, unsigned&gt;::iterator MTPI;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    std::tie(MTPI, Inserted) =</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">        MemTransferSliceMap.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, AS.Slices.size()));</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PrevIdx = MTPI-&gt;second;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inserted) &#123;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">      Slice &amp;PrevP = AS.Slices&#91;PrevIdx&#93;;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if the begin offsets match and this is a non-volatile transfer.</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// In that case, we can completely elide the transfer.</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile() &amp;&amp; PrevP.beginOffset() == RawOffset) &#123;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">        PrevP.kill();</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise we have an offset transfer within the same alloca. We can&#39;t</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// split those.</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">      PrevP.makeUnsplittable();</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert the use now that we&#39;ve fixed up the splittable nature.</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">    insertUse(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, </span><span class="doxyHighlightComment">/&#42;IsSplittable=&#42;/</span><span class="doxyHighlight">Inserted &amp;&amp; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a>);</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that we ended up with a valid index in the map.</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AS.Slices&#91;PrevIdx&#93;.getUse()-&gt;getUser() == &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &amp;&amp;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Map index doesn&#39;t point back to a slice with this user.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disable SRoA for any intrinsics except for lifetime invariants and</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// invariant group.</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: What about debug intrinsics? This matches old behavior, but</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// doesn&#39;t make sense.</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitIntrinsicInst(IntrinsicInst &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isDroppable()) &#123;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">      AS.DeadUseIfPromotable.push&#95;back(U);</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsOffsetKnown)</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isLifetimeStartOrEnd()) &#123;</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">      ConstantInt &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getArgOperand(0));</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">      uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = std::min(AllocSize - <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getLimitedValue(),</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878af6d9f1c7b49b7601fae6a545002a6763">Length</a>-&gt;getLimitedValue());</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">      insertUse(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isLaunderOrStripInvariantGroup()) &#123;</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">      insertUse(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, AllocSize, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a0ea2fc89be409baf64d5a935f6b02f28">enqueueUsers</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">    Base::visitIntrinsicInst(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;hasUnsafePHIOrSelectUse(Instruction &#42;Root, uint64&#95;t &amp;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>) &#123;</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We consider any PHI or select that results in a direct load or store of</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the same offset to be a viable use for slicing purposes. These uses</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// are considered unsplittable and the size is the maximum loaded or stored</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// size.</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">    SmallPtrSet&lt;Instruction &#42;, 4&gt; Visited;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;std::pair&lt;Instruction &#42;, Instruction &#42;&gt;</a>, 4&gt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">    Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Root);</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;U), Root));</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Root-&gt;<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are no loads or stores, the access is dead. We mark that as</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a size zero access.</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = 0;</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#42;UsedI;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">      std::tie(UsedI, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) = <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadInst &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">        TypeSize LoadSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(LI);</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = std::max(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, LoadSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>());</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreInst &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == UsedI)</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>;</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">        TypeSize StoreSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType());</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(SI);</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = std::max(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, StoreSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>());</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllZeroIndices())</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">                 !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AddrSpaceCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users())</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)).second)</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)));</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.empty());</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitPHINodeOrSelectInst(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.use&#95;empty())</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> markAsDead(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a PHI node before a catchswitch, we cannot insert any non-PHI</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions in this BB, which may be required during rewriting. Bail out</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// on these cases.</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent()-&gt;getFirstInsertionPt() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent()-&gt;end())</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: We could use simplifyInstruction here to fold PHINodes and</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SelectInsts. However, doing so requires to change the current</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dead-operand-tracking mechanism. For instance, suppose neither loading</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// from %U nor %other traps. Then &quot;load (select undef, %U, %other)&quot; does not</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trap either.  However, if we simply replace %U with undef using the</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// current dead-operand-tracking mechanism, &quot;load (select undef, undef,</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// %other)&quot; may trap because the select may return the first operand</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &quot;undef&quot;.</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Result = <a href="#a62ada829b4d3487b24df63322b26bfca">foldPHINodeOrSelectInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result == &#42;U)</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the result of the constant fold will be the pointer, recurse</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// through the PHI/select as if we had RAUW&#39;ed it.</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a0ea2fc89be409baf64d5a935f6b02f28">enqueueUsers</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Otherwise the operand to the PHI/select is dead, and we can replace</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// it with poison.</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">        AS.DeadOperands.push&#95;back(U);</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsOffsetKnown)</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// See if we already have computed info on this node.</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">    uint64&#95;t &amp;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = PHIOrSelectSizes&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>) &#123;</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This is a new PHI/Select, check for an unsafe use of it.</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;UnsafeI = hasUnsafePHIOrSelectUse(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>))</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(UnsafeI);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For PHI and select operands outside the alloca, we can&#39;t nuke the entire</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// phi or select -- the other side might still be relevant, so we special</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// case them here and use a separate structure to track the operands</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// themselves which should be replaced with poison.</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: This should instead be escaped in the event we&#39;re instrumenting</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for address sanitization.</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.uge(AllocSize)) &#123;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">      AS.DeadOperands.push&#95;back(U);</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">    insertUse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitPHINode(PHINode &amp;PN) &#123; visitPHINodeOrSelectInst(PN); &#125;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitSelectInst(SelectInst &amp;SI) &#123; visitPHINodeOrSelectInst(SI); &#125;</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlightComment">  /// Disable SROA entirely if there are unhandled users of the alloca.</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> visitInstruction(Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123; <a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/#a6847f1159ccc4f90e71099c76800f893">PI</a>.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#a602f57572e04c48ae16d990932783108">setAborted</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); &#125;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#a73e5f32465500cf4cbd002f5c1c9a025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instvisitor/#a22ae80c2045ac48274ba65b1d91d89e7">visitCallBase</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB) &#123;</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the call operand is NoCapture ReadOnly, then we mark it as</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// EscapedReadOnly.</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB.<a href="/docs/api/classes/llvm/callbase/#aebb1d2333537383d23ad22081752930f">isDataOperand</a>(U) &amp;&amp;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">        CB.<a href="/docs/api/classes/llvm/callbase/#a27ab264aa1e655ed42732fe0ec40d441">doesNotCapture</a>(U-&gt;getOperandNo()) &amp;&amp;</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">        CB.<a href="/docs/api/classes/llvm/callbase/#a857a8c38e4856efec047cc914c25b692">onlyReadsMemory</a>(U-&gt;getOperandNo())) &#123;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">      PI.<a href="/docs/api/classes/llvm/detail/ptrusevisitorbase/ptrinfo/#ac9cebd269bfd53ecb680aa1cfd048c78">setEscapedReadOnly</a>(&amp;CB);</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instvisitor/#a22ae80c2045ac48274ba65b1d91d89e7">Base::visitCallBase</a>(CB);</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a57e4e42fb1a33956f31a76559c80485b">AllocaSlices::AllocaSlices</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;AI)</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    :</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">#<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> !defined(<a href="/docs/api/files/lib/lib/support/regutils-h/#a8de3ed741dadc9c979a4ff17c0a9116e">NDEBUG</a>) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">      AI(AI),</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">#endif</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">      PointerEscapingInstr(nullptr), PointerEscapingInstrReadOnly(nullptr) &#123;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">  SliceBuilder <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#afd1501c49c84f3addfd108c2484f5674">PB</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AI, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">  SliceBuilder::PtrInfo PtrI = <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#afd1501c49c84f3addfd108c2484f5674">PB</a>.visitPtr(AI);</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PtrI.isEscaped() || PtrI.isAborted()) &#123;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: We should sink the escape vs. abort info into the caller nicely,</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// possibly by just storing the PtrInfo in the AllocaSlices.</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">    PointerEscapingInstr = PtrI.getEscapingInst() ? PtrI.getEscapingInst()</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">                                                  : PtrI.getAbortingInst();</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PointerEscapingInstr &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Did not track a bad instruction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">  PointerEscapingInstrReadOnly = PtrI.getEscapedReadOnlyInst();</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(Slices, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &amp;S) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> S.isDead(); &#125;);</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort the uses. This arranges for the offsets to be in ascending order,</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the sizes to be in descending order.</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(Slices);</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a09d4b4a68a710521ace72d146ae2fb5b">AllocaSlices::print</a>(raw&#95;ostream &amp;OS, const&#95;iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">                         StringRef Indent)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#adb7609cd30f47c1177bd9149c5695b07">printSlice</a>(OS, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Indent);</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa3800dd58371d975840087cf0f71406a">printUse</a>(OS, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Indent);</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#adb7609cd30f47c1177bd9149c5695b07">AllocaSlices::printSlice</a>(raw&#95;ostream &amp;OS, const&#95;iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">                              StringRef Indent)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">  OS &lt;&lt; Indent &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;beginOffset() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;,&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;endOffset() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)&quot;</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">     &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; slice #&quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> - <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a3265a3ed574c84058706161a9f3dd1ed">begin</a>())</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">     &lt;&lt; (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isSplittable() ? </span><span class="doxyHighlightStringLiteral">&quot; (splittable)&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aa3800dd58371d975840087cf0f71406a">AllocaSlices::printUse</a>(raw&#95;ostream &amp;OS, const&#95;iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">                            StringRef Indent)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">  OS &lt;&lt; Indent &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  used by: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getUse()-&gt;getUser() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a09d4b4a68a710521ace72d146ae2fb5b">AllocaSlices::print</a>(raw&#95;ostream &amp;OS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PointerEscapingInstr) &#123;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">    OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t analyze slices for alloca: &quot;</span><span class="doxyHighlight"> &lt;&lt; AI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">       &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  A pointer to this alloca escaped by:\\n&quot;</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">       &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PointerEscapingInstr &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PointerEscapingInstrReadOnly)</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">    OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Escapes into ReadOnly: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PointerEscapingInstrReadOnly &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Slices of alloca: &quot;</span><span class="doxyHighlight"> &lt;&lt; AI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a3265a3ed574c84058706161a9f3dd1ed">begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#aaae89e1b35c44450b62ddfc3033f618e">end</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a09d4b4a68a710521ace72d146ae2fb5b">print</a>(OS, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a1166882c353173bf8722ac7c9ac78897">AllocaSlices::dump</a>(const&#95;iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a09d4b4a68a710521ace72d146ae2fb5b">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a1166882c353173bf8722ac7c9ac78897">AllocaSlices::dump</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#a09d4b4a68a710521ace72d146ae2fb5b">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); &#125;</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlightPreprocessor">#endif </span><span class="doxyHighlightComment">// !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlightComment">/// Walk the range of a partitioning looking for a common type to cover this</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlightComment">/// sequence of slices.</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::pair&lt;Type &#42;, IntegerType &#42;&gt;</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485" lineLink="#a25781ba284c79cb93c65fd0c529ebf7c"><span class="doxyHighlight"><a href="#a25781ba284c79cb93c65fd0c529ebf7c">findCommonType</a>(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">AllocaSlices::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">AllocaSlices::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>,</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">               uint64&#95;t EndOffset) &#123;</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TyIsCommon = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;ITy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that we need to look at &#42;every&#42; alloca slice&#39;s Use to ensure we</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// always get consistent results regardless of the order of slices.</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">AllocaSlices::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &#42;U = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getUse();</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(&#42;U-&gt;getUser()))</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;beginOffset() != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;beginOffset() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;endOffset() != EndOffset)</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;UserTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">      UserTy = LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">      UserTy = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType();</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;UserITy = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;IntegerType&gt;</a>(UserTy)) &#123;</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the type is larger than the partition, skip it. We only encounter</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this for split integer operations where we want to use the type of the</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// entity causing the split. Also skip if the type is not a byte width</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// multiple.</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserITy-&gt;getBitWidth() % 8 != 0 ||</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">          UserITy-&gt;getBitWidth() / 8 &gt; (EndOffset - <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;beginOffset()))</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Track the largest bitwidth integer type used in this way in case there</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// is no common type.</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ITy || ITy-&gt;<a href="/docs/api/classes/llvm/integertype/#a90b790ccb1af4ea5ccd69db4b8cd2d81">getBitWidth</a>() &lt; UserITy-&gt;getBitWidth())</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">        ITy = UserITy;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// To avoid depending on the order of slices, Ty and TyIsCommon must not</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// depend on types skipped above.</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UserTy || (Ty &amp;&amp; Ty != UserTy))</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">      TyIsCommon = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Give up on anything but an iN type.</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">      Ty = UserTy;</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;TyIsCommon ? Ty : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ITy&#125;;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlightComment">/// PHI instructions that use an alloca and are subsequently loaded can be</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlightComment">/// rewritten to load both input pointers in the pred blocks and then PHI the</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlightComment">/// results, allowing the load of the alloca to be promoted.</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlightComment">/// From this:</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlightComment">///   %P2 = phi &#91;i32&#42; %Alloca, i32&#42; %Other&#93;</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlightComment">///   %V = load i32&#42; %P2</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlightComment">/// to:</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlightComment">///   %V1 = load i32&#42; %Alloca      -&gt; will be mem2reg&#39;d</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlightComment">///   %V2 = load i32&#42; %Other</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlightComment">///   %V = phi &#91;i32 %V1, i32 %V2&#93;</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlightComment">/// We can do this to a select if its only uses are loads and if the operands</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlightComment">/// to the select can be loaded unconditionally.</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlightComment">/// FIXME: This should be hoisted into a generic utility, likely in</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlightComment">/// Transforms/Util/Local.h</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551" lineLink="#aab37469c4748a495736ad163ac54e776"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aab37469c4748a495736ad163ac54e776">isSafePHIToSpeculate</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = PN.<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For now, we can only do this promotion if the load is in the same block</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as the PHI, and if there are no stores between the phi and load.</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Allow recursive phi users.</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Allow stores.</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> MaxAlign;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  uint64&#95;t APWidth = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;LoadType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : PN.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U);</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI || !LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#aeb534c1a0391ce24551c226a582099a7">isSimple</a>())</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For now we only allow loads in the same block as the PHI.  This is</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a common case that happens when instcombine merges two loads through</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a PHI.</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB)</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadType) &#123;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadType != LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">      LoadType = LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ensure that there are no instructions between the PHI and the load that</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// could store.</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI(PN); &amp;&#42;BBI != LI; ++BBI)</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBI-&gt;mayWriteToMemory())</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">    MaxAlign = std::max(MaxAlign, LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>());</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadType)</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> LoadSize =</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a>(APWidth, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(LoadType).getFixedValue());</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only transform this if it is safe to push the loads into the</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor blocks. The only thing to watch out for is that we can&#39;t put</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a possibly trapping load in the predecessor if it is a critical edge.</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, Num = PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx != Num; ++Idx) &#123;</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx)-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the value is produced by the terminator of the predecessor (an</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// invoke) or it has side-effects, there is no valid place to put a load</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in the predecessor.</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TI == InVal || TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6ea260be710ac7b61309534308da3147">mayHaveSideEffects</a>())</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the predecessor has a single successor, then the edge isn&#39;t</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// critical.</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1)</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this pointer is always safe to load, or if we can prove that there</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is already a load in the block, then we can move the load to the pred</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a7bca5709e8d5f8d45c9e46c51322e017">isSafeToLoadUnconditionally</a>(InVal, MaxAlign, LoadSize, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TI))</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625" lineLink="#a80f5f1399bc814c650325a6c41e350e2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a80f5f1399bc814c650325a6c41e350e2">speculatePHINodeLoads</a>(<a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; PN &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;SomeLoad = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(PN.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>());</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;LoadTy = SomeLoad-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">  IRB.SetInsertPoint(&amp;PN);</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = IRB.CreatePHI(LoadTy, PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(),</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">                                 PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.speculated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the AA tags and alignment to use from one of the loads. It does not</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// matter which one we get and if any differ.</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> AATags = SomeLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> Alignment = SomeLoad-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>();</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rewrite all loads of the PN to use the new PHI.</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!PN.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(PN.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>());</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">    LI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewPN);</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">    LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Inject loads into all of the pred blocks.</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, Value &#42;&gt;</a> InjectedLoads;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, Num = PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx != Num; ++Idx) &#123;</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx);</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A PHI node is allowed to have multiple (duplicated) entries for the same</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// basic block, as long as the value is the same. So if we already injected</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a load in the predecessor, then we should reuse the same load for all</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// duplicated entries.</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = InjectedLoads.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(Pred)) &#123;</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(V, Pred);</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = Pred-&gt;getTerminator();</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">    IRB.SetInsertPoint(TI);</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;Load = IRB.CreateAlignedLoad(</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">        LoadTy, InVal, Alignment,</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">        (PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.speculate.load.&quot;</span><span class="doxyHighlight"> + Pred-&gt;getName()));</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">    ++NumLoadsSpeculated;</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">      Load-&gt;setAAMetadata(AATags);</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Load, Pred);</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">    InjectedLoads&#91;Pred&#93; = Load;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          speculated to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewPN &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">  PN.<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity">SelectHandSpeculativity</a> &amp;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a6209f400e7cf0f855586aba618156e4b"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a6209f400e7cf0f855586aba618156e4b">SelectHandSpeculativity::setAsSpeculatable</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isTrueVal) &#123;</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isTrueVal)</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/bitfield/#aac5c44667e3b3ebe2ed424dbd12a35d5">Bitfield::set&lt;SelectHandSpeculativity::TrueVal&gt;</a>(Storage, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/bitfield/#aac5c44667e3b3ebe2ed424dbd12a35d5">Bitfield::set&lt;SelectHandSpeculativity::FalseVal&gt;</a>(Storage, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#aa805dfd609789d10f3584ea58dc4722e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#aa805dfd609789d10f3584ea58dc4722e">SelectHandSpeculativity::isSpeculatable</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isTrueVal)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> isTrueVal ? <a href="/docs/api/structs/llvm/bitfield/#a3cd3d6331b8a3ea50db05696debf2075">Bitfield::get&lt;SelectHandSpeculativity::TrueVal&gt;</a>(Storage)</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">                   : <a href="/docs/api/structs/llvm/bitfield/#a3cd3d6331b8a3ea50db05696debf2075">Bitfield::get&lt;SelectHandSpeculativity::FalseVal&gt;</a>(Storage);</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#adad8666c34db782ec65e459474d9818e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#adad8666c34db782ec65e459474d9818e">SelectHandSpeculativity::areAllSpeculatable</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#aa805dfd609789d10f3584ea58dc4722e">isSpeculatable</a>(</span><span class="doxyHighlightComment">/&#42;isTrueVal=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &amp;&amp;</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">         <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#aa805dfd609789d10f3584ea58dc4722e">isSpeculatable</a>(</span><span class="doxyHighlightComment">/&#42;isTrueVal=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#ad08f50c8be255b4a2c29229d279aae39"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#ad08f50c8be255b4a2c29229d279aae39">SelectHandSpeculativity::areAnySpeculatable</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#aa805dfd609789d10f3584ea58dc4722e">isSpeculatable</a>(</span><span class="doxyHighlightComment">/&#42;isTrueVal=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) ||</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">         <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#aa805dfd609789d10f3584ea58dc4722e">isSpeculatable</a>(</span><span class="doxyHighlightComment">/&#42;isTrueVal=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a143122ec3e895ae04e3f0ba830f0d5fe"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#a143122ec3e895ae04e3f0ba830f0d5fe">SelectHandSpeculativity::areNoneSpeculatable</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity/#ad08f50c8be255b4a2c29229d279aae39">areAnySpeculatable</a>();</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/selecthandspeculativity">SelectHandSpeculativity</a></span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706" lineLink="#af029ac9445c750f9a2a2d90c2aeab9e3"><span class="doxyHighlight"><a href="#af029ac9445c750f9a2a2d90c2aeab9e3">isSafeLoadOfSelectToSpeculate</a>(<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &amp;LI, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">PreserveCFG</a>) &#123;</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI.<a href="/docs/api/classes/llvm/loadinst/#aeb534c1a0391ce24551c226a582099a7">isSimple</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Only for simple loads&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">  SelectHandSpeculativity <a href="/docs/api/structs/llvm/spec">Spec</a>;</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>.getDataLayout();</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/value">Value</a> : &#123;<a href="/docs/api/namespaces/llvm/si">SI</a>.getTrueValue(), <a href="/docs/api/namespaces/llvm/si">SI</a>.getFalseValue()&#125;)</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a7bca5709e8d5f8d45c9e46c51322e017">isSafeToLoadUnconditionally</a>(<a href="/docs/api/classes/llvm/value">Value</a>, LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), LI.<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">                                    &amp;LI))</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/spec">Spec</a>.setAsSpeculatable(</span><span class="doxyHighlightComment">/&#42;isTrueVal=&#42;/</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> == <a href="/docs/api/namespaces/llvm/si">SI</a>.getTrueValue());</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">PreserveCFG</a>)</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/spec">Spec</a>;</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/spec">Spec</a>;</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">std::optional&lt;RewriteableMemOps&gt;</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">SROA::isSafeSelectToSpeculate(SelectInst &amp;SI, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">PreserveCFG</a>) &#123;</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a0bd6174f8bb3840fa3e80f8c870023fd">RewriteableMemOps</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.users()) &#123;</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(U); BC &amp;&amp; BC-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a> = &#42;BC-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>();</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note that atomic stores can be transformed; atomic semantics do not</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// have any meaning for a local alloca. Stores are not speculatable,</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// however, so if we can&#39;t turn it into a predicated store, we are done.</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;isVolatile() || PreserveCFG)</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#125;; </span><span class="doxyHighlightComment">// Give up on this &#96;select&#96;.</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.emplace&#95;back(Store);</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U);</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that atomic loads can be transformed;</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// atomic semantics do not have any meaning for a local alloca.</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI || LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>())</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#125;; </span><span class="doxyHighlightComment">// Give up on this &#96;select&#96;.</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a7093375450ef5127cbfd60122159f14c">PossiblySpeculatableLoad</a> <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>(LI);</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#aeb534c1a0391ce24551c226a582099a7">isSimple</a>()) &#123;</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the &#96;load&#96; is not simple, we can&#39;t speculatively execute it,</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// but we could handle this via a CFG modification. But can we?</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreserveCFG)</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#125;; </span><span class="doxyHighlightComment">// Give up on this &#96;select&#96;.</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.emplace&#95;back(Load);</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">    SelectHandSpeculativity Spec =</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">        <a href="#af029ac9445c750f9a2a2d90c2aeab9e3">isSafeLoadOfSelectToSpeculate</a>(&#42;LI, SI, PreserveCFG);</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreserveCFG &amp;&amp; !Spec.areAllSpeculatable())</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#125;; </span><span class="doxyHighlightComment">// Give up on this &#96;select&#96;.</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>.setInt(Spec);</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.emplace&#95;back(Load);</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768" lineLink="#ace8766b97ac54db2bec8c29e4016f3f6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ace8766b97ac54db2bec8c29e4016f3f6">speculateSelectInstLoads</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &amp;LI,</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">                                     <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB) &#123;</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original load: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/si">SI</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TV = <a href="/docs/api/namespaces/llvm/si">SI</a>.getTrueValue();</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;FV = <a href="/docs/api/namespaces/llvm/si">SI</a>.getFalseValue();</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the given load of the select with a select of two loads.</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI.<a href="/docs/api/classes/llvm/loadinst/#aeb534c1a0391ce24551c226a582099a7">isSimple</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We only speculate simple loads&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">  IRB.SetInsertPoint(&amp;LI);</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;TL =</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">      IRB.CreateAlignedLoad(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), TV, LI.<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(),</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">                            LI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.speculate.load.true&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;FL =</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">      IRB.CreateAlignedLoad(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), FV, LI.<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(),</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">                            LI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.speculate.load.false&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">  NumLoadsSpeculated += 2;</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transfer alignment and AA info if present.</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">  TL-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2b1268b642e9bf4373b6fb31c482c9ca">setAlignment</a>(LI.<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>());</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">  FL-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2b1268b642e9bf4373b6fb31c482c9ca">setAlignment</a>(LI.<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>());</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> Tags = LI.<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Tags) &#123;</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">    TL-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(Tags);</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">    FL-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(Tags);</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = IRB.CreateSelect(<a href="/docs/api/namespaces/llvm/si">SI</a>.getCondition(), TL, FL,</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">                              LI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.speculated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          speculated to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">  LI.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> T&gt;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806" lineLink="#a670232d63153cd8cd2793b3106e80661"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a670232d63153cd8cd2793b3106e80661">rewriteMemOpOfSelect</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">                                 SelectHandSpeculativity <a href="/docs/api/structs/llvm/spec">Spec</a>,</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &amp;DTU) &#123;</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Only for load and store!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original mem op: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Head = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent();</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ThenTerm = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ElseTerm = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/spec">Spec</a>.areNoneSpeculatable())</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7ac00229d8c59902686f52ed061cdc80">SplitBlockAndInsertIfThenElse</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getCondition(), &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;ThenTerm, &amp;ElseTerm,</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/si">SI</a>.getMetadata(LLVMContext::MD&#95;prof), &amp;DTU);</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ad957413955739c91204c96e33e0cc933">SplitBlockAndInsertIfThen</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getCondition(), &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightComment">/&#42;Unreachable=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">                              <a href="/docs/api/namespaces/llvm/si">SI</a>.getMetadata(LLVMContext::MD&#95;prof), &amp;DTU,</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;LI=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;ThenBlock=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/spec">Spec</a>.isSpeculatable(</span><span class="doxyHighlightComment">/&#42;isTrueVal=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Head-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())-&gt;swapSuccessors();</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;HeadBI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Head-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/spec">Spec</a> = &#123;&#125;; </span><span class="doxyHighlightComment">// Do not use &#96;Spec&#96; beyond this point.</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent();</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>-&gt;setName(Head-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.cont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">    PN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), 2, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIterator());</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Head)) &#123;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsThen = SuccBB == HeadBI-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SuccIdx = IsThen ? 0 : 1;</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewMemOpBB = SuccBB == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> ? Head : SuccBB;</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;CondMemOp = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;T&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.clone());</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewMemOpBB != Head) &#123;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">      NewMemOpBB-&gt;setName(Head-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + (IsThen ? </span><span class="doxyHighlightStringLiteral">&quot;.then&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;.else&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">        ++NumLoadsPredicated;</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">        ++NumStoresPredicated;</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">      CondMemOp.dropUBImplyingAttrsAndMetadata();</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">      ++NumLoadsSpeculated;</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">    CondMemOp.insertBefore(NewMemOpBB-&gt;getTerminator()-&gt;getIterator());</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>.getOperand(1 + SuccIdx);</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">    CondMemOp.setOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getPointerOperandIndex(), <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">      CondMemOp.setName(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getName() + (IsThen ? </span><span class="doxyHighlightStringLiteral">&quot;.then&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;.else&quot;</span><span class="doxyHighlight">) + </span><span class="doxyHighlightStringLiteral">&quot;.val&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">      PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(&amp;CondMemOp, NewMemOpBB);</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;                 to: &quot;</span><span class="doxyHighlight"> &lt;&lt; CondMemOp &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PN &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.replaceAllUsesWith(PN);</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862" lineLink="#a4a30f36def0478d9125147359f4f7c96"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a670232d63153cd8cd2793b3106e80661">rewriteMemOpOfSelect</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;SelInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">                                 SelectHandSpeculativity <a href="/docs/api/structs/llvm/spec">Spec</a>,</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &amp;DTU) &#123;</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">    <a href="#a670232d63153cd8cd2793b3106e80661">rewriteMemOpOfSelect</a>(SelInst, &#42;LI, <a href="/docs/api/structs/llvm/spec">Spec</a>, DTU);</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">    <a href="#a670232d63153cd8cd2793b3106e80661">rewriteMemOpOfSelect</a>(SelInst, &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/structs/llvm/spec">Spec</a>, DTU);</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8cb1f2bd469f8a823857a1cf1447a0e3">llvm&#95;unreachable&#95;internal</a>(</span><span class="doxyHighlightStringLiteral">&quot;Only for load and store.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873" lineLink="#a63ceac0fe90c6eae903dd259120cc4fd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a63ceac0fe90c6eae903dd259120cc4fd">rewriteSelectInstMemOps</a>(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>,</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a0bd6174f8bb3840fa3e80f8c870023fd">RewriteableMemOps</a> &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">                                    <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CFGChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original select: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/si">SI</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#abec97ac904acec4f3903802da5e40cd3">RewriteableMemOp</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>) &#123;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">    SelectHandSpeculativity <a href="/docs/api/structs/llvm/spec">Spec</a>;</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> &#42;US = std::get&#95;if&lt;UnspeculatableStore&gt;(&amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &#42;US;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PSL = std::get&lt;PossiblySpeculatableLoad&gt;(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = PSL.getPointer();</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/spec">Spec</a> = PSL.getInt();</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/spec">Spec</a>.areAllSpeculatable()) &#123;</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">      <a href="#ace8766b97ac54db2bec8c29e4016f3f6">speculateSelectInstLoads</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), IRB);</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DTU &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should not get here when not allowed to modify the CFG!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">      <a href="#a670232d63153cd8cd2793b3106e80661">rewriteMemOpOfSelect</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/structs/llvm/spec">Spec</a>, &#42;DTU);</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">      CFGChanged = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.users()))</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BitCastInst&gt;</a>(U)-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.eraseFromParent();</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CFGChanged;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlightComment">/// Compute an adjusted pointer from Ptr by Offset bytes where the</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlightComment">/// resulting pointer has PointerTy.</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907" lineLink="#a51c1effcc7b2215c922b2074c54d68a5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(<a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>,</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>,</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;NamePrefix) &#123;</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != 0)</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = IRB.CreateInBoundsPtrAdd(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, IRB.getInt(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>),</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">                                   NamePrefix + </span><span class="doxyHighlightStringLiteral">&quot;sroa&#95;idx&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRB.CreatePointerBitCastOrAddrSpaceCast(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>,</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">                                                 NamePrefix + </span><span class="doxyHighlightStringLiteral">&quot;sroa&#95;cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlightComment">/// Compute the adjusted alignment for a load or store from an offset.</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918" lineLink="#a0c1779029e78ee6d643c3319b39e3ea8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/align">Align</a> <a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &#123;</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(<a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlightComment">/// Test whether we can convert a value from the old to the new type.</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlightComment">/// This predicate should be used to guard calls to convertValue in order to</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlightComment">/// ensure that we only try to convert viable values. The strategy is that we</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlightComment">/// will peel off single element struct and array wrappings to get to an</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlightComment">/// underlying value, and convert that value.</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928" lineLink="#a2fb1c078833c17e4c9529b0cf924385c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;OldTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy) &#123;</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldTy == NewTy)</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For integer types, we can&#39;t handle any bit-width differences. This would</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// break both vector conversions with extension and introduce endianness</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// issues when in conjunction with loads and stores.</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(OldTy) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(NewTy)) &#123;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(OldTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() !=</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(NewTy)-&gt;<a href="/docs/api/files/lib/lib/analysis/valuetracking-cpp/#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &amp;&amp;</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;We can&#39;t have the same bitwidth for different int types&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(NewTy).getFixedValue() !=</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(OldTy).getFixedValue())</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>() || !OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>())</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can convert pointers to integers and vice-versa. Same for vectors</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of pointers and integers.</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">  OldTy = OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">  NewTy = NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() || OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp; OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldAS = OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewAS = NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Convert pointers if they are pointers from the same address space or</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// different integral (not non-integral) address spaces with the same</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// pointer size.</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OldAS == NewAS ||</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">             (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralAddressSpace(OldAS) &amp;&amp;</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">              !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralAddressSpace(NewAS) &amp;&amp;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerSize(OldAS) == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerSize(NewAS));</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can convert integers to integral pointers, but not to non-integral</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointers.</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>())</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(NewTy);</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can convert integral pointers to integers, but non-integral pointers</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// need to remain pointers.</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(OldTy))</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>();</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a8536986ed6c44fce15dba30748428d2c">isTargetExtTy</a>() || NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a8536986ed6c44fce15dba30748428d2c">isTargetExtTy</a>())</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlightComment">/// Generic routine to convert an SSA value to a value of a different</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlightComment">/// type.</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlightComment">/// This will try various different casting techniques, such as bitcasts,</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlightComment">/// inttoptr, and ptrtoint casts. Use the \\c canConvertValue predicate to test</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlightComment">/// two types for viability with this routine.</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990" lineLink="#af169f594f2c9e8cd49a59b29373eb4de"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewTy) &#123;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;OldTy = V-&gt;getType();</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, OldTy, NewTy) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Value not convertable to type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldTy == NewTy)</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(OldTy) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(NewTy)) &amp;&amp;</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Integer types must be the exact same to convert.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we need inttoptr for this type pair. May require additional bitcast.</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a34ee40bb2f4f5ece47ef19e5f1f57e3c">isIntOrIntVectorTy</a>() &amp;&amp; NewTy-&gt;<a href="/docs/api/classes/llvm/type/#ab03652069eab17006c51f00c261a6a44">isPtrOrPtrVectorTy</a>()) &#123;</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand &lt;2 x i32&gt; to i8&#42; --&gt; &lt;2 x i32&gt; to i64 to i8&#42;</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand i128 to &lt;2 x i8&#42;&gt; --&gt; i128 to &lt;2 x i64&gt; to &lt;2 x i8&#42;&gt;</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand &lt;4 x i32&gt; to &lt;2 x i8&#42;&gt; --&gt; &lt;4 x i32&gt; to &lt;2 x i64&gt; to &lt;2 x i8&#42;&gt;</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Directly handle i64 to i8&#42;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRB.CreateIntToPtr(IRB.CreateBitCast(V, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(NewTy)),</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">                              NewTy);</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we need ptrtoint for this type pair. May require additional bitcast.</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldTy-&gt;<a href="/docs/api/classes/llvm/type/#ab03652069eab17006c51f00c261a6a44">isPtrOrPtrVectorTy</a>() &amp;&amp; NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a34ee40bb2f4f5ece47ef19e5f1f57e3c">isIntOrIntVectorTy</a>()) &#123;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand &lt;2 x i8&#42;&gt; to i128 --&gt; &lt;2 x i8&#42;&gt; to &lt;2 x i64&gt; to i128</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand i8&#42; to &lt;2 x i32&gt; --&gt; i8&#42; to i64 to &lt;2 x i32&gt;</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand &lt;2 x i8&#42;&gt; to &lt;4 x i32&gt; --&gt; &lt;2 x i8&#42;&gt; to &lt;2 x i64&gt; to &lt;4 x i32&gt;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand i8&#42; to i64 --&gt; i8&#42; to i64 to i64</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRB.CreateBitCast(IRB.CreatePtrToInt(V, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(OldTy)),</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">                             NewTy);</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldTy-&gt;<a href="/docs/api/classes/llvm/type/#ab03652069eab17006c51f00c261a6a44">isPtrOrPtrVectorTy</a>() &amp;&amp; NewTy-&gt;<a href="/docs/api/classes/llvm/type/#ab03652069eab17006c51f00c261a6a44">isPtrOrPtrVectorTy</a>()) &#123;</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldAS = OldTy-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewAS = NewTy-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// To convert pointers with different address spaces (they are already</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// checked convertible, i.e. they have the same pointer size), so far we</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cannot use &#96;bitcast&#96; (which has restrict on the same address space) or</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#96;addrspacecast&#96; (which is not always no-op casting). Instead, use a pair</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of no-op &#96;ptrtoint&#96;/&#96;inttoptr&#96; casts through an integer with the same bit</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// size.</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldAS != NewAS) &#123;</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerSize(OldAS) == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerSize(NewAS));</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRB.CreateIntToPtr(IRB.CreatePtrToInt(V, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(OldTy)),</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">                                NewTy);</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRB.CreateBitCast(V, NewTy);</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlightComment">/// Test whether the given slice use can be promoted to a vector.</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlightComment">/// This function is called to test each entry in a partition which is slated</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlightComment">/// for a single slice.</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044" lineLink="#ab4c31035e44c7bda618eb2eb81dcf314"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab4c31035e44c7bda618eb2eb81dcf314">isVectorPromotionViableForSlice</a>(Partition &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &amp;S,</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">                                            <a href="/docs/api/classes/vectortype">VectorType</a> &#42;Ty,</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">                                            uint64&#95;t ElementSize,</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First validate the slice offsets.</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  uint64&#95;t BeginOffset =</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">      std::max(S.beginOffset(), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset()) - <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset();</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  uint64&#95;t BeginIndex = BeginOffset / ElementSize;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BeginIndex &#42; ElementSize != BeginOffset ||</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">      BeginIndex &gt;= <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Ty)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>())</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  uint64&#95;t EndOffset = std::min(S.endOffset(), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset()) - <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset();</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  uint64&#95;t EndIndex = EndOffset / ElementSize;</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EndIndex &#42; ElementSize != EndOffset ||</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">      EndIndex &gt; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Ty)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>())</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndIndex &gt; BeginIndex &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Empty vector!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">  uint64&#95;t NumElements = EndIndex - BeginIndex;</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SliceTy = (NumElements == 1)</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">                      ? Ty-&gt;getElementType()</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">                      : <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Ty-&gt;getElementType(), NumElements);</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SplitIntTy =</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(Ty-&gt;getContext(), NumElements &#42; ElementSize &#42; 8);</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/use">Use</a> &#42;U = S.getUse();</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/memintrinsic">MemIntrinsic</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemIntrinsic&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;isVolatile())</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.isSplittable())</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Skip any unsplittable intrinsics.</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isLifetimeStartOrEnd() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isDroppable())</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>())</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;LTy = LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Disable vector promotion when there are loads or stores of an FCA.</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LTy-&gt;isStructTy())</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset() &gt; S.beginOffset() || <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset() &lt; S.endOffset()) &#123;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LTy-&gt;isIntegerTy());</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">      LTy = SplitIntTy;</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SliceTy, LTy))</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isVolatile())</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;STy = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType();</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Disable vector promotion when there are loads or stores of an FCA.</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STy-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>())</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset() &gt; S.beginOffset() || <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset() &lt; S.endOffset()) &#123;</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(STy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>());</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">      STy = SplitIntTy;</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, STy, SliceTy))</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlightComment">/// Test whether a vector type is viable for promotion.</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlightComment">/// This implements the necessary checking for \\c checkVectorTypesForPromotion</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlightComment">/// (and thus isVectorPromotionViable) over all slices of the alloca for the</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlightComment">/// given VectorType.</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118" lineLink="#a73ce9bc74349e7599dd4ae32a091ede7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a73ce9bc74349e7599dd4ae32a091ede7">checkVectorTypeForPromotion</a>(Partition &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/classes/vectortype">VectorType</a> &#42;VTy,</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">  uint64&#95;t ElementSize =</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(VTy-&gt;getElementType()).getFixedValue();</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// While the definition of LLVM vectors is bitpacked, we don&#39;t support sizes</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that aren&#39;t byte sized.</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ElementSize % 8)</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(VTy).getFixedValue() % 8) == 0 &amp;&amp;</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;vector size not a multiple of element size?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">  ElementSize /= 8;</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &amp;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>)</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ab4c31035e44c7bda618eb2eb81dcf314">isVectorPromotionViableForSlice</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, S, VTy, ElementSize, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &#42;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.splitSliceTails())</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ab4c31035e44c7bda618eb2eb81dcf314">isVectorPromotionViableForSlice</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, &#42;S, VTy, ElementSize, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlightComment">/// Test whether any vector type in \\p CandidateTys is viable for promotion.</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlightComment">/// This implements the necessary checking for \\c isVectorPromotionViable over</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlightComment">/// all slices of the alloca for the given VectorType.</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30ba554dbd7b42f5e21acdc8a1d86120e53c">VectorType</a> &#42;</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147" lineLink="#af9b65d81d95d19757080cfae034e3d7e"><span class="doxyHighlight"><a href="#af9b65d81d95d19757080cfae034e3d7e">checkVectorTypesForPromotion</a>(Partition &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;VectorType &#42;&gt;</a> &amp;CandidateTys,</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveCommonEltTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42;CommonEltTy,</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveVecPtrTy, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveCommonVecPtrTy,</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">                             <a href="/docs/api/classes/vectortype">VectorType</a> &#42;CommonVecPtrTy) &#123;</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we didn&#39;t find a vector type, nothing to do here.</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CandidateTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pointer-ness is sticky, if we had a vector-of-pointers candidate type,</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then we should choose it, not some other alternative.</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// But, we can&#39;t perform a no-op pointer address space change via bitcast,</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so if we didn&#39;t have a common pointer element type, bail.</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HaveVecPtrTy &amp;&amp; !HaveCommonVecPtrTy)</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to pick the &quot;best&quot; element type out of the choices.</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HaveCommonEltTy &amp;&amp; HaveVecPtrTy) &#123;</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there was a pointer element type, there&#39;s really only one choice.</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">    CandidateTys.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">    CandidateTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CommonVecPtrTy);</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HaveCommonEltTy &amp;&amp; !HaveVecPtrTy) &#123;</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Integer-ify vector types.</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/vectortype">VectorType</a> &#42;&amp;VTy : CandidateTys) &#123;</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VTy-&gt;getElementType()-&gt;isIntegerTy())</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">        VTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(VTy-&gt;getWithNewType(<a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">IntegerType::getIntNTy</a>(</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">            VTy-&gt;getContext(), VTy-&gt;getScalarSizeInBits())));</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Rank the remaining candidate vector types. This is easy because we know</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// they&#39;re all integer vectors. We sort by ascending number of elements.</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RankVectorTypesComp = &#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>&#93;(<a href="/docs/api/classes/vectortype">VectorType</a> &#42;RHSTy, <a href="/docs/api/classes/vectortype">VectorType</a> &#42;LHSTy) &#123;</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">      (void)<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(RHSTy).getFixedValue() ==</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(LHSTy).getFixedValue() &amp;&amp;</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Cannot have vector types of different sizes!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RHSTy-&gt;getElementType()-&gt;isIntegerTy() &amp;&amp;</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;All non-integer types eliminated!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LHSTy-&gt;getElementType()-&gt;isIntegerTy() &amp;&amp;</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;All non-integer types eliminated!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(RHSTy)-&gt;getNumElements() &lt;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(LHSTy)-&gt;getNumElements();</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RankVectorTypesEq = &#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>&#93;(<a href="/docs/api/classes/vectortype">VectorType</a> &#42;RHSTy, <a href="/docs/api/classes/vectortype">VectorType</a> &#42;LHSTy) &#123;</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">      (void)<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(RHSTy).getFixedValue() ==</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(LHSTy).getFixedValue() &amp;&amp;</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Cannot have vector types of different sizes!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RHSTy-&gt;getElementType()-&gt;isIntegerTy() &amp;&amp;</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;All non-integer types eliminated!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LHSTy-&gt;getElementType()-&gt;isIntegerTy() &amp;&amp;</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;All non-integer types eliminated!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(RHSTy)-&gt;getNumElements() ==</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(LHSTy)-&gt;getNumElements();</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(CandidateTys, RankVectorTypesComp);</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">    CandidateTys.erase(<a href="/docs/api/namespaces/llvm/#a48f85da577c6ce7d9aed90437dc0d07c">llvm::unique</a>(CandidateTys, RankVectorTypesEq),</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">                       CandidateTys.end());</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlightComment">// The only way to have the same element type in every vector type is to</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlightComment">// have the same vector type. Check that and remove all but one.</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/vectortype">VectorType</a> &#42;VTy : CandidateTys) &#123;</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VTy-&gt;getElementType() == CommonEltTy &amp;&amp;</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Unaccounted for element type!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VTy == CandidateTys&#91;0&#93; &amp;&amp;</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Different vector types with the same element type!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">    CandidateTys.resize(1);</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: hack. Do we have a named constant for this?</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SDAG SDNode can&#39;t have more than 65535 operands.</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(CandidateTys, &#91;&#93;(<a href="/docs/api/classes/vectortype">VectorType</a> &#42;VTy) &#123;</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VTy)-&gt;getNumElements() &gt;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">           std::numeric&#95;limits&lt;unsigned short&gt;::max();</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/vectortype">VectorType</a> &#42;VTy : CandidateTys)</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a73ce9bc74349e7599dd4ae32a091ede7">checkVectorTypeForPromotion</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, VTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VTy;</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233" lineLink="#a3ed7e979bee3c9d43ed5128461ca9070"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/vectortype">VectorType</a> &#42;<a href="#a3ed7e979bee3c9d43ed5128461ca9070">createAndCheckVectorTypesForPromotion</a>(</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Type &#42;&gt;</a> &amp;OtherTys, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VectorType &#42;&gt;</a> CandidateTysCopy,</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">(<a href="/docs/api/classes/llvm/type">Type</a> &#42;)&gt; CheckCandidateType, Partition &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>,</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;VectorType &#42;&gt;</a> &amp;CandidateTys,</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;HaveCommonEltTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42;&amp;CommonEltTy, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;HaveVecPtrTy,</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;HaveCommonVecPtrTy, <a href="/docs/api/classes/vectortype">VectorType</a> &#42;&amp;CommonVecPtrTy) &#123;</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">  &#91;&#91;maybe&#95;unused&#93;&#93; <a href="/docs/api/classes/vectortype">VectorType</a> &#42;OriginalElt =</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">      CandidateTysCopy.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() ? CandidateTysCopy&#91;0&#93; : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consider additional vector types where the element type size is a</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// multiple of load/store element size.</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty : OtherTys) &#123;</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/vectortype/#aa6a2194fc011669faabe43322d7c6c5f">VectorType::isValidElementType</a>(Ty))</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/typesize">TypeSize</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(Ty).getFixedValue();</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make a copy of CandidateTys and iterate through it, because we</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// might append to CandidateTys in the loop.</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/vectortype">VectorType</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> VTy : CandidateTysCopy) &#123;</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The elements in the copy should remain invariant throughout the loop</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CandidateTysCopy&#91;0&#93; == OriginalElt &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Different Element&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> VectorSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(VTy).getFixedValue();</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ElementSize =</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(VTy-&gt;getElementType()).getFixedValue();</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/typesize">TypeSize</a> != VectorSize &amp;&amp; <a href="/docs/api/classes/llvm/typesize">TypeSize</a> != ElementSize &amp;&amp;</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">          VectorSize % <a href="/docs/api/classes/llvm/typesize">TypeSize</a> == 0) &#123;</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">        <a href="/docs/api/classes/vectortype">VectorType</a> &#42;NewVTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Ty, VectorSize / <a href="/docs/api/classes/llvm/typesize">TypeSize</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">        CheckCandidateType(NewVTy);</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#af9b65d81d95d19757080cfae034e3d7e">checkVectorTypesForPromotion</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CandidateTys, HaveCommonEltTy,</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">                                      CommonEltTy, HaveVecPtrTy,</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">                                      HaveCommonVecPtrTy, CommonVecPtrTy);</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlightComment">/// Test whether the given alloca partitioning and range of slices can be</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlightComment">/// promoted to a vector.</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlightComment">/// This is a quick test to check whether we can rewrite a particular alloca</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlightComment">/// partition (and its newly formed alloca) into a vector alloca with only</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlightComment">/// whole-vector loads and stores such that it could be promoted to a vector</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlightComment">/// SSA value. We only can ensure this for a limited set of operations, and we</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlightComment">/// don&#39;t want to do the rewrites unless we are confident that the result will</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlightComment">/// be promotable, so we have an early test here.</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277" lineLink="#af6735614e085435a0f3bb90aab527213"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/vectortype">VectorType</a> &#42;<a href="#af6735614e085435a0f3bb90aab527213">isVectorPromotionViable</a>(Partition &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the candidate types for vector-based promotion. Also track whether</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we have different element types.</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VectorType &#42;, 4&gt;</a> CandidateTys;</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Type &#42;&gt;</a> LoadStoreTys;</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Type &#42;&gt;</a> DeferredTys;</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CommonEltTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;CommonVecPtrTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveVecPtrTy = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveCommonEltTy = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveCommonVecPtrTy = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CheckCandidateType = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(Ty)) &#123;</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Return if bitcast to vectors is different for total size in bits.</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CandidateTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">        <a href="/docs/api/classes/vectortype">VectorType</a> &#42;V = CandidateTys&#91;0&#93;;</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(VTy).getFixedValue() !=</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(V).getFixedValue()) &#123;</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">          CandidateTys.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">      CandidateTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VTy);</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;EltTy = VTy-&gt;getElementType();</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CommonEltTy)</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">        CommonEltTy = EltTy;</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonEltTy != EltTy)</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">        HaveCommonEltTy = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EltTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">        HaveVecPtrTy = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CommonVecPtrTy)</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">          CommonVecPtrTy = VTy;</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonVecPtrTy != VTy)</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">          HaveCommonVecPtrTy = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Put load and store types into a set for de-duplication.</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &amp;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty;</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(S.getUse()-&gt;getUser()))</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">      Ty = LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(S.getUse()-&gt;getUser()))</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">      Ty = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType();</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CandTy = Ty-&gt;getScalarType();</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CandTy-&gt;isPointerTy() &amp;&amp; (S.beginOffset() != <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset() ||</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlight">                                  S.endOffset() != <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset())) &#123;</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">      DeferredTys.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Ty);</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">    LoadStoreTys.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Ty);</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Consider any loads or stores that are the exact size of the slice.</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.beginOffset() == <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset() &amp;&amp; S.endOffset() == <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset())</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">      CheckCandidateType(Ty);</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VectorType &#42;, 4&gt;</a> CandidateTysCopy = CandidateTys;</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VTy = <a href="#a3ed7e979bee3c9d43ed5128461ca9070">createAndCheckVectorTypesForPromotion</a>(</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">          LoadStoreTys, CandidateTysCopy, CheckCandidateType, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">          CandidateTys, HaveCommonEltTy, CommonEltTy, HaveVecPtrTy,</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">          HaveCommonVecPtrTy, CommonVecPtrTy))</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VTy;</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">  CandidateTys.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a3ed7e979bee3c9d43ed5128461ca9070">createAndCheckVectorTypesForPromotion</a>(</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">      DeferredTys, CandidateTysCopy, CheckCandidateType, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CandidateTys,</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">      HaveCommonEltTy, CommonEltTy, HaveVecPtrTy, HaveCommonVecPtrTy,</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">      CommonVecPtrTy);</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlightComment">/// Test whether a slice of an alloca is valid for integer widening.</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlightComment">/// This implements the necessary checking for the \\c isIntegerWideningViable</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlightComment">/// test below on a single slice of the alloca.</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358" lineLink="#a593afa69fb7cfbb4506f605bd785f923"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a593afa69fb7cfbb4506f605bd785f923">isIntegerWideningViableForSlice</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &amp;S,</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">                                            uint64&#95;t AllocBeginOffset,</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/type">Type</a> &#42;AllocaTy,</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;WholeAllocaOp) &#123;</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(AllocaTy).getFixedValue();</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">  uint64&#95;t RelBegin = S.beginOffset() - AllocBeginOffset;</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight">  uint64&#95;t RelEnd = S.endOffset() - AllocBeginOffset;</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/use">Use</a> &#42;U = S.getUse();</span></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lifetime intrinsics operate over the whole alloca whose sizes are usually</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// larger than other load/store slices (RelEnd &gt; Size). But lifetime are</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// always promotable and should not impact other slices&#39; promotability of the</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// partition.</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isLifetimeStartOrEnd() || <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isDroppable())</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t reasonably handle cases where the load or store extends past</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the end of the alloca&#39;s type and into its padding.</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RelEnd &gt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>())</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can&#39;t handle loads that extend past the allocated memory.</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()).getFixedValue() &gt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// So far, AllocaSliceRewriter does not support widening split slice tails</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in rewriteIntegerLoad.</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.beginOffset() &lt; AllocBeginOffset)</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that we don&#39;t count vector loads or stores as whole-alloca</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// operations which enable integer widening because we would prefer to use</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vector widening instead.</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp; RelBegin == 0 &amp;&amp; RelEnd == <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">      WholeAllocaOp = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;ITy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntegerType&gt;</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ITy-&gt;getBitWidth() &lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSizeInBits(ITy).getFixedValue())</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RelBegin != 0 || RelEnd != <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> ||</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">               !<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AllocaTy, LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Non-integer loads need to be convertible from the alloca type so that</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// they are promotable.</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ValueTy = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType();</span></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isVolatile())</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can&#39;t handle stores that extend past the allocated memory.</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(ValueTy).getFixedValue() &gt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// So far, AllocaSliceRewriter does not support widening split slice tails</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in rewriteIntegerStore.</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.beginOffset() &lt; AllocBeginOffset)</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that we don&#39;t count vector loads or stores as whole-alloca</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// operations which enable integer widening because we would prefer to use</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vector widening instead.</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(ValueTy) &amp;&amp; RelBegin == 0 &amp;&amp; RelEnd == <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">      WholeAllocaOp = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;ITy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntegerType&gt;</a>(ValueTy)) &#123;</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ITy-&gt;getBitWidth() &lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSizeInBits(ITy).getFixedValue())</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RelBegin != 0 || RelEnd != <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> ||</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">               !<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ValueTy, AllocaTy)) &#123;</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Non-integer stores need to be convertible to the alloca type so that</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// they are promotable.</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/memintrinsic">MemIntrinsic</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemIntrinsic&gt;</a>(U-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;isVolatile() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getLength()))</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.isSplittable())</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Skip any unsplittable intrinsics.</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlightComment">/// Test whether the given alloca partition&#39;s integer operations can be</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlightComment">/// widened to promotable ones.</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlightComment">/// This is a quick test to check whether we can rewrite the integer loads and</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlightComment">/// stores to a particular alloca into wider loads and stores and be able to</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlightComment">/// promote the resulting alloca.</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451" lineLink="#a7fd9ee96f281dd94ed4119c2e45836bf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7fd9ee96f281dd94ed4119c2e45836bf">isIntegerWideningViable</a>(Partition &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;AllocaTy,</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">  uint64&#95;t SizeInBits = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(AllocaTy).getFixedValue();</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t create integer types larger than the maximum bitwidth.</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SizeInBits &gt; <a href="/docs/api/classes/llvm/integertype/#a8bb58e9357b2f891f98fbbce353155efa1ccefdf8a7414a6829f888e5071e0379">IntegerType::MAX&#95;INT&#95;BITS</a>)</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t try to handle allocas with bit-padding.</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SizeInBits != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSizeInBits(AllocaTy).getFixedValue())</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to ensure that an integer type with the appropriate bitwidth can</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be converted to the alloca type, whatever that is. We don&#39;t want to force</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the alloca itself to have an integer type if there is a more suitable one.</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntTy = <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(AllocaTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), SizeInBits);</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AllocaTy, IntTy) ||</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">      !<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IntTy, AllocaTy))</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// While examining uses, we ensure that the alloca has a covering load or</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store. We don&#39;t want to widen the integer operations only to fail to</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// promote due to some other unsplittable entry (which we may make splittable</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// later). However, if there are only splittable uses, go ahead and assume</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that we cover the alloca.</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: We shouldn&#39;t consider split slices that happen to start in the</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// partition here...</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> WholeAllocaOp = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.empty() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isLegalInteger(SizeInBits);</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &amp;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>)</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a593afa69fb7cfbb4506f605bd785f923">isIntegerWideningViableForSlice</a>(S, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset(), AllocaTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">                                         WholeAllocaOp))</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &#42;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.splitSliceTails())</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a593afa69fb7cfbb4506f605bd785f923">isIntegerWideningViableForSlice</a>(&#42;S, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset(), AllocaTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">                                         WholeAllocaOp))</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WholeAllocaOp;</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492" lineLink="#ab2f67bb5d465e282bbb175c9c278f251"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ab2f67bb5d465e282bbb175c9c278f251">extractInteger</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;Ty, uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;       start: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;IntTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(V-&gt;getType());</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(Ty).getFixedValue() + <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt;=</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(IntTy).getFixedValue() &amp;&amp;</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Element extends past full value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">  uint64&#95;t ShAmt = 8 &#42; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isBigEndian())</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">    ShAmt = 8 &#42; (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(IntTy).getFixedValue() -</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(Ty).getFixedValue() - <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShAmt) &#123;</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">    V = IRB.CreateLShr(V, ShAmt, Name + </span><span class="doxyHighlightStringLiteral">&quot;.shift&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;     shifted: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;getBitWidth() &lt;= IntTy-&gt;getBitWidth() &amp;&amp;</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Cannot extract to a larger integer!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty != IntTy) &#123;</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">    V = IRB.CreateTrunc(V, Ty, Name + </span><span class="doxyHighlightStringLiteral">&quot;.trunc&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;     trunced: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517" lineLink="#a4cad1dcbccfcc610dc8d47100b4871ef"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a4cad1dcbccfcc610dc8d47100b4871ef">insertInteger</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Old,</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;IntTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(Old-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(V-&gt;getType());</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;getBitWidth() &lt;= IntTy-&gt;getBitWidth() &amp;&amp;</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Cannot insert a larger integer!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;       start: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty != IntTy) &#123;</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight">    V = IRB.CreateZExt(V, IntTy, Name + </span><span class="doxyHighlightStringLiteral">&quot;.ext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    extended: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(Ty).getFixedValue() + <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt;=</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(IntTy).getFixedValue() &amp;&amp;</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Element store outside of alloca store&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">  uint64&#95;t ShAmt = 8 &#42; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isBigEndian())</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">    ShAmt = 8 &#42; (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(IntTy).getFixedValue() -</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(Ty).getFixedValue() - <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShAmt) &#123;</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><span class="doxyHighlight">    V = IRB.CreateShl(V, ShAmt, Name + </span><span class="doxyHighlightStringLiteral">&quot;.shift&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;     shifted: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShAmt || Ty-&gt;getBitWidth() &lt; IntTy-&gt;getBitWidth()) &#123;</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> Mask = ~Ty-&gt;getMask().zext(IntTy-&gt;getBitWidth()).shl(ShAmt);</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">    Old = IRB.CreateAnd(Old, Mask, Name + </span><span class="doxyHighlightStringLiteral">&quot;.mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      masked: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Old &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">    V = IRB.CreateOr(Old, V, Name + </span><span class="doxyHighlightStringLiteral">&quot;.insert&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    inserted: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550" lineLink="#a604f6e897606d25237935a3374fe7a3e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a604f6e897606d25237935a3374fe7a3e">extractVector</a>(<a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BeginIndex,</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIndex, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VecTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V-&gt;getType());</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElements = EndIndex - BeginIndex;</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumElements &lt;= VecTy-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Too many elements!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumElements == VecTy-&gt;getNumElements())</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumElements == 1) &#123;</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">    V = IRB.CreateExtractElement(V, IRB.getInt32(BeginIndex),</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">                                 Name + </span><span class="doxyHighlightStringLiteral">&quot;.extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;     extract: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Mask = <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">llvm::to&#95;vector&lt;8&gt;</a>(<a href="/docs/api/namespaces/llvm/#adc4eb8be6f7a12ede962987fb9cabb47">llvm::seq&lt;int&gt;</a>(BeginIndex, EndIndex));</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">  V = IRB.CreateShuffleVector(V, Mask, Name + </span><span class="doxyHighlightStringLiteral">&quot;.extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;     shuffle: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572" lineLink="#a75cf62ffe10261611bab4d74598ab0e4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a75cf62ffe10261611bab4d74598ab0e4">insertVector</a>(<a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Old, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BeginIndex, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;VecTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Old-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VecTy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can only insert a vector into a vector&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;Ty = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(V-&gt;getType());</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ty) &#123;</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Single element to insert.</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">    V = IRB.CreateInsertElement(Old, V, IRB.getInt32(BeginIndex),</span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">                                Name + </span><span class="doxyHighlightStringLiteral">&quot;.insert&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;     insert: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Ty)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>() &lt;=</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>() &amp;&amp;</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Too many elements!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Ty)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>() ==</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>()) &#123;</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getType() == VecTy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Vector type mismatch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIndex = BeginIndex + <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Ty)-&gt;getNumElements();</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When inserting a smaller vector into the larger to store, we first</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// use a shuffle vector to widen it with undef elements, and then</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a second shuffle vector to select between the loaded vector and the</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// incoming vector.</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 8&gt;</a> Mask;</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">  Mask.reserve(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>());</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;getNumElements(); ++i)</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (i &gt;= BeginIndex &amp;&amp; i &lt; EndIndex)</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">      Mask.push&#95;back(i - BeginIndex);</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">      Mask.push&#95;back(-1);</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">  V = IRB.CreateShuffleVector(V, Mask, Name + </span><span class="doxyHighlightStringLiteral">&quot;.expand&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    shuffle: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 8&gt;</a> Mask2;</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">  Mask2.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>());</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;getNumElements(); ++i)</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">    Mask2.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(IRB.getInt1(i &gt;= BeginIndex &amp;&amp; i &lt; EndIndex));</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">  V = IRB.CreateSelect(<a href="/docs/api/classes/llvm/constantvector/#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(Mask2), V, Old, Name + </span><span class="doxyHighlightStringLiteral">&quot;blend&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    blend: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlightComment">/// Visitor to rewrite instructions using p particular slice of an alloca</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlightComment">/// to use a new alloca.</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlightComment">/// Also implements the rewriting to vector-based accesses when the partition</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlightComment">/// passes the isVectorPromotionViable predicate. Most of the rewriting logic</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlightComment">/// lives here.</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#a26b5ff773160777e00a74f30759b973f">AllocaSliceRewriter</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instvisitor">InstVisitor</a>&lt;AllocaSliceRewriter, bool&gt; &#123;</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Befriend the base class so it can delegate to private visit methods.</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instvisitor">InstVisitor</a>&lt;<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#a26b5ff773160777e00a74f30759b973f">AllocaSliceRewriter</a>, bool&gt;;</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">Base = <a href="/docs/api/classes/llvm/instvisitor">InstVisitor&lt;AllocaSliceRewriter, bool&gt;</a>;</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS;</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a> &amp;Pass;</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;OldAI, &amp;NewAI;</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t NewAllocaBeginOffset, NewAllocaEndOffset;</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewAllocaTy;</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is a convenience and flag variable that will be null unless the new</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// alloca&#39;s integer operations should be widened to this integer type due to</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// passing isIntegerWideningViable above. If it is non-null, the desired</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// integer type will be stored here for easy access during rewriting.</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;IntTy;</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are rewriting an alloca partition which can be written as pure</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vector operations, we stash extra information here. When VecTy is</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// non-null, we have some strict guarantees about the rewritten alloca:</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   - The new alloca is exactly the size of the vector type here.</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   - The accesses all either map to the entire vector or to a single</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     element.</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   - The set of accessing instructions is only one of those handled above</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     in isVectorPromotionViable. Generally these are the same access kinds</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     which are promotable via mem2reg.</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vectortype">VectorType</a> &#42;VecTy;</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementTy;</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">  uint64&#95;t ElementSize;</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The original offset of the slice currently being rewritten relative to</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the original alloca.</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">  uint64&#95;t BeginOffset = 0;</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">  uint64&#95;t EndOffset = 0;</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The new offsets of the slice currently being rewritten relative to the</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// original alloca.</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">  uint64&#95;t NewBeginOffset = 0, NewEndOffset = 0;</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">  uint64&#95;t SliceSize = 0;</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSplittable = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSplit = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/use">Use</a> &#42;OldUse = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldPtr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Track post-rewrite users which are PHI nodes and Selects.</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;PHINode &#42;, 8&gt;</a> &amp;PHIUsers;</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;SelectInst &#42;, 8&gt;</a> &amp;SelectUsers;</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Utility IR builder, whose name prefix is setup for each visited use, and</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the insertion point is set to point to the user.</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> IRB;</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return the new alloca, addrspacecasted if required to avoid changing the</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// addrspace of a volatile access.</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;getPtrToNewAI(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AddrSpace, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsVolatile) &#123;</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsVolatile || AddrSpace == NewAI.getType()-&gt;getPointerAddressSpace())</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;NewAI;</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy = IRB.getPtrTy(AddrSpace);</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRB.CreateAddrSpaceCast(&amp;NewAI, AccessTy);</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#a26b5ff773160777e00a74f30759b973f"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#a26b5ff773160777e00a74f30759b973f">AllocaSliceRewriter</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a> &amp;Pass,</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;OldAI, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &amp;NewAI,</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">                      uint64&#95;t NewAllocaBeginOffset,</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">                      uint64&#95;t NewAllocaEndOffset, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsIntegerPromotable,</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/vectortype">VectorType</a> &#42;PromotableVecTy,</span></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;PHINode &#42;, 8&gt;</a> &amp;PHIUsers,</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;SelectInst &#42;, 8&gt;</a> &amp;SelectUsers)</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">      : DL(DL), AS(AS), Pass(Pass), OldAI(OldAI), NewAI(NewAI),</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">        NewAllocaBeginOffset(NewAllocaBeginOffset),</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">        NewAllocaEndOffset(NewAllocaEndOffset),</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">        NewAllocaTy(NewAI.getAllocatedType()),</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">        IntTy(</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">            IsIntegerPromotable</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlight">                ? <a href="/docs/api/classes/llvm/type">Type</a>::getIntNTy(NewAI.getContext(),</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">                                  DL.getTypeSizeInBits(NewAI.getAllocatedType())</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">                                      .getFixedValue())</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">                : nullptr),</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">        VecTy(PromotableVecTy),</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">        ElementTy(VecTy ? VecTy-&gt;getElementType() : nullptr),</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">        ElementSize(VecTy ? DL.getTypeSizeInBits(ElementTy).getFixedValue() / 8</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">                          : 0),</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">        PHIUsers(PHIUsers), SelectUsers(SelectUsers),</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">        IRB(NewAI.getContext(), <a href="/docs/api/classes/llvm/constantfolder">ConstantFolder</a>()) &#123;</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy) &#123;</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((DL.getTypeSizeInBits(ElementTy).getFixedValue() % 8) == 0 &amp;&amp;</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Only multiple-of-8 sized vector elements are viable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">      ++NumVectorized;</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!IntTy &amp;&amp; !VecTy) || (IntTy &amp;&amp; !VecTy) || (!IntTy &amp;&amp; VecTy));</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#ad5e4a813f4c680afb71906bfbf32d01a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslicerewriter/#ad5e4a813f4c680afb71906bfbf32d01a">visit</a>(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices/#ad48fd3fa1d55039999612203a416856b">AllocaSlices::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanSROA = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlight">    BeginOffset = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;beginOffset();</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">    EndOffset = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;endOffset();</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">    IsSplittable = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isSplittable();</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">    IsSplit =</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlight">        BeginOffset &lt; NewAllocaBeginOffset || EndOffset &gt; NewAllocaEndOffset;</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  rewriting &quot;</span><span class="doxyHighlight"> &lt;&lt; (IsSplit ? </span><span class="doxyHighlightStringLiteral">&quot;split &quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(AS.printSlice(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the intersecting offset range.</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BeginOffset &lt; NewAllocaEndOffset);</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndOffset &gt; NewAllocaBeginOffset);</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">    NewBeginOffset = std::max(BeginOffset, NewAllocaBeginOffset);</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">    NewEndOffset = std::min(EndOffset, NewAllocaEndOffset);</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">    SliceSize = NewEndOffset - NewBeginOffset;</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;   Begin:(&quot;</span><span class="doxyHighlight"> &lt;&lt; BeginOffset &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight"> &lt;&lt; EndOffset</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;) NewBegin:(&quot;</span><span class="doxyHighlight"> &lt;&lt; NewBeginOffset &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">                      &lt;&lt; NewEndOffset &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;) NewAllocaBegin:(&quot;</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlight">                      &lt;&lt; NewAllocaBeginOffset &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight"> &lt;&lt; NewAllocaEndOffset</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsSplit || NewBeginOffset == BeginOffset);</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">    OldUse = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getUse();</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">    OldPtr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(OldUse-&gt;get());</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldUserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(OldUse-&gt;getUser());</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">    IRB.SetInsertPoint(OldUserI);</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">    IRB.SetCurrentDebugLocation(OldUserI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">    IRB.getInserter().SetNamePrefix(<a href="/docs/api/classes/llvm/twine">Twine</a>(NewAI.getName()) + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight"> +</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/twine">Twine</a>(BeginOffset) + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">    CanSROA &amp;= <a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvpostlegalizer-cpp/#a090736355958192cac4db32336c48bbd">visit</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(OldUse-&gt;getUser()));</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy || IntTy)</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CanSROA);</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CanSROA;</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure the other visit overloads are visible.</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">Base::visit;</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Every instruction which can end up as a user must have a rewrite rule.</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitInstruction(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    !!!! Cannot rewrite: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;No rewrite rule for this instruction!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;getNewAllocaSlicePtr(IRBuilderTy &amp;IRB, <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>) &#123;</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that the offset computation can use BeginOffset or NewBeginOffset</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// interchangeably for unsplit slices.</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsSplit || BeginOffset == NewBeginOffset);</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = NewBeginOffset - NewAllocaBeginOffset;</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> OldName = OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip through the last &#39;.sroa.&#39; component of the name.</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> LastSROAPrefix = OldName.<a href="/docs/api/classes/llvm/stringref/#a97d45ce069c1a09ca84672df63acf096">rfind</a>(</span><span class="doxyHighlightStringLiteral">&quot;.sroa.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LastSROAPrefix != <a href="/docs/api/classes/anonymous-namespace-path-cpp-/stringref/#ad0f54a163ac500b144590640c6f1eb6b">StringRef::npos</a>) &#123;</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">      OldName = OldName.<a href="/docs/api/classes/llvm/stringref/#a25f1fd81f2132805676c82ab8ae0c109">substr</a>(LastSROAPrefix + strlen(</span><span class="doxyHighlightStringLiteral">&quot;.sroa.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Look for an SROA slice index.</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> IndexEnd = OldName.<a href="/docs/api/classes/llvm/stringref/#ae851887270f35d2a2670a79b9833d45b">find&#95;first&#95;not&#95;of</a>(</span><span class="doxyHighlightStringLiteral">&quot;0123456789&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IndexEnd != <a href="/docs/api/classes/anonymous-namespace-path-cpp-/stringref/#ad0f54a163ac500b144590640c6f1eb6b">StringRef::npos</a> &amp;&amp; OldName&#91;IndexEnd&#93; == </span><span class="doxyHighlightCharLiteral">&#39;.&#39;</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Strip the index and look for the offset.</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">        OldName = OldName.<a href="/docs/api/classes/llvm/stringref/#a25f1fd81f2132805676c82ab8ae0c109">substr</a>(IndexEnd + 1);</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> OffsetEnd = OldName.<a href="/docs/api/classes/llvm/stringref/#ae851887270f35d2a2670a79b9833d45b">find&#95;first&#95;not&#95;of</a>(</span><span class="doxyHighlightStringLiteral">&quot;0123456789&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OffsetEnd != <a href="/docs/api/classes/anonymous-namespace-path-cpp-/stringref/#ad0f54a163ac500b144590640c6f1eb6b">StringRef::npos</a> &amp;&amp; OldName&#91;OffsetEnd&#93; == </span><span class="doxyHighlightCharLiteral">&#39;.&#39;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Strip the offset.</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">          OldName = OldName.<a href="/docs/api/classes/llvm/stringref/#a25f1fd81f2132805676c82ab8ae0c109">substr</a>(OffsetEnd + 1);</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Strip any SROA suffixes as well.</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">    OldName = OldName.<a href="/docs/api/classes/llvm/stringref/#a25f1fd81f2132805676c82ab8ae0c109">substr</a>(0, OldName.<a href="/docs/api/classes/llvm/stringref/#aab312a8386488873bac2eddfc67c22be">find</a>(</span><span class="doxyHighlightStringLiteral">&quot;.sroa&#95;&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(IRB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;NewAI,</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">                          APInt(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(<a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>), <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>),</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>,</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">#ifndef <a href="/docs/api/files/lib/lib/support/regutils-h/#a8de3ed741dadc9c979a4ff17c0a9116e">NDEBUG</a></span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">                          Twine(OldName) + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">#</span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">                          Twine()</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">#endif</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlight">    );</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlightComment">  /// Compute suitable alignment to access this slice of the &#42;new&#42;</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlightComment">  /// alloca.</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlightComment">  /// You can optionally pass a type to this routine and if that type&#39;s ABI</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlightComment">  /// alignment is itself suitable, this will return zero.</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> getSliceAlign() &#123;</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(),</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">                           NewBeginOffset - NewAllocaBeginOffset);</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> getIndex(uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &#123;</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VecTy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can only call getIndex when rewriting a vector&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">    uint64&#95;t RelOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - NewAllocaBeginOffset;</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RelOffset / ElementSize &lt; UINT32&#95;MAX &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Index out of bounds&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">    uint32&#95;t <a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = RelOffset / ElementSize;</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Index &#42; ElementSize == RelOffset);</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a>;</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> deleteIfTriviallyDead(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;rewriteVectorizedLoadInst(LoadInst &amp;LI) &#123;</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BeginIndex = getIndex(NewBeginOffset);</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIndex = getIndex(NewEndOffset);</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndIndex &gt; BeginIndex &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Empty vector!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">    LoadInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a> = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlight">                                           NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;copyMetadata(LI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlight">                            LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a604f6e897606d25237935a3374fe7a3e">extractVector</a>(IRB, Load, BeginIndex, EndIndex, </span><span class="doxyHighlightStringLiteral">&quot;vec&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;rewriteIntegerLoad(LoadInst &amp;LI) &#123;</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IntTy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We cannot insert an integer to the alloca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LI.<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>());</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">                                     NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, IntTy);</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewBeginOffset &gt;= NewAllocaBeginOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Out of bounds offset&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = NewBeginOffset - NewAllocaBeginOffset;</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; 0 || NewEndOffset &lt; NewAllocaEndOffset) &#123;</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">      IntegerType &#42;ExtractTy = Type::getIntNTy(LI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SliceSize &#42; 8);</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#ab2f67bb5d465e282bbb175c9c278f251">extractInteger</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, ExtractTy, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightStringLiteral">&quot;extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It is possible that the extracted type is not the load type. This</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// happens if there is a load past the end of the alloca, and as</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a consequence the slice is narrower but still a candidate for integer</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// lowering. To handle this case, we just zero extend the extracted</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// integer.</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getBitWidth() &gt;= SliceSize &#42; 8 &amp;&amp;</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Can only handle an extract for an overly wide load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getBitWidth() &gt; SliceSize &#42; 8)</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = IRB.CreateZExt(V, LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitLoadInst(LoadInst &amp;LI) &#123;</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; LI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldOp = LI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldOp == OldPtr);</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><span class="doxyHighlight">    AAMDNodes AATags = LI.<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = LI.<a href="/docs/api/classes/llvm/loadinst/#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TargetTy = IsSplit ? Type::getIntNTy(LI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SliceSize &#42; 8)</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><span class="doxyHighlight">                             : LI.<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>();</span></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLoadPastEnd =</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(TargetTy).getFixedValue() &gt; SliceSize;</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPtrAdjusted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy) &#123;</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = rewriteVectorizedLoadInst(LI);</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntTy &amp;&amp; LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()) &#123;</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">      V = rewriteIntegerLoad(LI);</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (NewBeginOffset == NewAllocaBeginOffset &amp;&amp;</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">               NewEndOffset == NewAllocaEndOffset &amp;&amp;</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">               (<a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, NewAllocaTy, TargetTy) ||</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">                (IsLoadPastEnd &amp;&amp; NewAllocaTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlight">                 TargetTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; !LI.<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>()))) &#123;</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlight">      Value &#42;NewPtr =</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">          getPtrToNewAI(LI.getPointerAddressSpace(), LI.isVolatile());</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlight">      LoadInst &#42;NewLI = IRB.CreateAlignedLoad(NewAI.getAllocatedType(), NewPtr,</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlight">                                              NewAI.getAlign(), LI.isVolatile(),</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlight">                                              LI.getName());</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlight">      if (LI.isVolatile())</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">        NewLI-&gt;setAtomic(LI.getOrdering(), LI.getSyncScopeID());</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlight">      if (NewLI-&gt;isAtomic())</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlight">        NewLI-&gt;setAlignment(LI.getAlign());</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Copy any metadata that is valid for the new load. This may require</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// conversion to a different kind of metadata, e.g. !nonnull might change</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to !range or vice versa.</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">      copyMetadataForLoad(&#42;NewLI, LI);</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Do this after copyMetadataForLoad() to preserve the TBAA shift.</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><span class="doxyHighlight">      if (AATags)</span></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">        NewLI-&gt;setAAMetadata(AATags.adjustForAccess(</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">            NewBeginOffset - BeginOffset, NewLI-&gt;getType(), DL));</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Try to preserve nonnull metadata</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">      V = NewLI;</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is an integer load past the end of the slice (which means the</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// bytes outside the slice are undef or this load is dead) just forcibly</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// fix the integer size with correct handling of endianness.</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlight">      if (auto &#42;AITy = dyn&#95;cast&lt;IntegerType&gt;(NewAllocaTy))</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlight">        if (auto &#42;TITy = dyn&#95;cast&lt;IntegerType&gt;(TargetTy))</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">          if (AITy-&gt;getBitWidth() &lt; TITy-&gt;getBitWidth()) &#123;</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">            V = IRB.CreateZExt(V, TITy, </span><span class="doxyHighlightStringLiteral">&quot;load.ext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">            if (DL.isBigEndian())</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlight">              V = IRB.CreateShl(V, TITy-&gt;getBitWidth() - AITy-&gt;getBitWidth(),</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">                                </span><span class="doxyHighlightStringLiteral">&quot;endian&#95;shift&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;LTy = IRB.getPtrTy(AS);</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlight">      LoadInst &#42;NewLI =</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlight">          IRB.CreateAlignedLoad(TargetTy, getNewAllocaSlicePtr(IRB, LTy),</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlight">                                getSliceAlign(), LI.<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>(), LI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">        NewLI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlight">            NewBeginOffset - BeginOffset, NewLI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI.<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>())</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><span class="doxyHighlight">        NewLI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a6ae88dc44b078c80ce3a25401fd4b05b">setAtomic</a>(LI.<a href="/docs/api/classes/llvm/loadinst/#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>(), LI.<a href="/docs/api/classes/llvm/loadinst/#aca6c2de6950cb093f509ed2b67e02da2">getSyncScopeID</a>());</span></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">      NewLI-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(LI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">                               LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = NewLI;</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">      IsPtrAdjusted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, TargetTy);</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSplit) &#123;</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LI.<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>());</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Only integer type loads and stores are split&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SliceSize &lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()).getFixedValue() &amp;&amp;</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Split load isn&#39;t smaller than original load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp;</span></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Non-byte-multiple bit width&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Move the insertion point just past the load so that we can refer to it.</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> LIIt = std::next(LI.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ensure the insertion point comes before any debug-info immediately</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// after the load, so that variable values referring to the load are</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dominated by it.</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">      LIIt.setHeadBit(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">      IRB.SetInsertPoint(LI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), LIIt);</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Create a placeholder value with the same type as LI to use as the</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// basis for the new value. This allows us to replace the uses of LI with</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the computed value, and then replace the placeholder with LI, leaving</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// LI only used for this computation.</span></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/anonymous-rustdemangle-cpp-/#a76a6de3bfe4b34e80479b5139aae1ab7a68753d36ec0c4d7768b20993268d68d1">Placeholder</a> =</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> LoadInst(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(IRB.getPtrTy(AS)), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><span class="doxyHighlight">                       </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(1));</span></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#a4cad1dcbccfcc610dc8d47100b4871ef">insertInteger</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Placeholder, V, NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlight">                        </span><span class="doxyHighlightStringLiteral">&quot;insert&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlight">      LI.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-rustdemangle-cpp-/#a76a6de3bfe4b34e80479b5139aae1ab7a68753d36ec0c4d7768b20993268d68d1">Placeholder</a>-&gt;replaceAllUsesWith(&amp;LI);</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-rustdemangle-cpp-/#a76a6de3bfe4b34e80479b5139aae1ab7a68753d36ec0c4d7768b20993268d68d1">Placeholder</a>-&gt;deleteValue();</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">      LI.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(&amp;LI);</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">    deleteIfTriviallyDead(OldOp);</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !LI.<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>() &amp;&amp; !IsPtrAdjusted;</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> rewriteVectorizedStoreInst(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V, StoreInst &amp;SI, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldOp,</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">                                  AAMDNodes AATags) &#123;</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Capture V for the purpose of debug-info accounting once it&#39;s converted</span></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to a vector store.</span></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OrigV = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() != VecTy) &#123;</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BeginIndex = getIndex(NewBeginOffset);</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIndex = getIndex(NewEndOffset);</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndIndex &gt; BeginIndex &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Empty vector!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElements = EndIndex - BeginIndex;</span></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumElements &lt;= <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>() &amp;&amp;</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Too many elements!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SliceTy = (NumElements == 1)</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">                          ? ElementTy</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">                          : FixedVectorType::<a href="/docs/api/namespaces/llvm/#a73257f51950d9ea50955e3fb9c724a25">get</a>(ElementTy, NumElements);</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() != SliceTy)</span></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><span class="doxyHighlight">        V = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, SliceTy);</span></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mix in the existing elements.</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Old = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlight">                                         NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlight">      V = <a href="#a75cf62ffe10261611bab4d74598ab0e4">insertVector</a>(IRB, Old, V, BeginIndex, </span><span class="doxyHighlightStringLiteral">&quot;vec&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><span class="doxyHighlight">    StoreInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a> = IRB.CreateAlignedStore(V, &amp;NewAI, NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>());</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;copyMetadata(SI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">                             LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;setAAMetadata(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">                                                  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(&amp;SI);</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NOTE: Careful to use OrigV rather than V.</span></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><span class="doxyHighlight">    <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(&amp;OldAI, IsSplit, NewBeginOffset &#42; 8, SliceSize &#42; 8, &amp;SI,</span></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">                     Store, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getPointerOperand(), OrigV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Store &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> rewriteIntegerStore(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V, StoreInst &amp;SI, AAMDNodes AATags) &#123;</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IntTy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We cannot extract an integer from the alloca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile());</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()).getFixedValue() !=</span></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlight">        IntTy-&gt;<a href="/docs/api/classes/llvm/integertype/#a90b790ccb1af4ea5ccd69db4b8cd2d81">getBitWidth</a>()) &#123;</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Old = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">                                         NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;oldload&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><span class="doxyHighlight">      Old = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Old, IntTy);</span></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BeginOffset &gt;= NewAllocaBeginOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Out of bounds offset&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">      uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = BeginOffset - NewAllocaBeginOffset;</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#a4cad1dcbccfcc610dc8d47100b4871ef">insertInteger</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Old, <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getValueOperand(), <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightStringLiteral">&quot;insert&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, NewAllocaTy);</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><span class="doxyHighlight">    StoreInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a> = IRB.CreateAlignedStore(V, &amp;NewAI, NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>());</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;copyMetadata(SI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">                             LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;setAAMetadata(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><span class="doxyHighlight">                                                  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><span class="doxyHighlight">    <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(&amp;OldAI, IsSplit, NewBeginOffset &#42; 8, SliceSize &#42; 8, &amp;SI,</span></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><span class="doxyHighlight">                     Store, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getPointerOperand(),</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlight">                     <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(&amp;SI);</span></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Store &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitStoreInst(StoreInst &amp;SI) &#123;</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; SI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldOp = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getOperand(1);</span></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldOp == OldPtr);</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><span class="doxyHighlight">    AAMDNodes AATags = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getAAMetadata();</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getValueOperand();</span></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Strip all inbounds GEPs and pointer casts to try to dig out any root</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alloca that should be re-examined after promoting this alloca.</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;stripInBoundsOffsets()))</span></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.PostPromotionWorklist.insert(AI);</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SliceSize &lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()).getFixedValue()) &#123;</span></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile());</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isIntegerTy() &amp;&amp;</span></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Only integer type loads and stores are split&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()) &amp;&amp;</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Non-byte-multiple bit width&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><span class="doxyHighlight">      IntegerType &#42;NarrowTy = Type::getIntNTy(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getContext(), SliceSize &#42; 8);</span></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#ab2f67bb5d465e282bbb175c9c278f251">extractInteger</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, NarrowTy, NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy)</span></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> rewriteVectorizedStoreInst(V, SI, OldOp, AATags);</span></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntTy &amp;&amp; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isIntegerTy())</span></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> rewriteIntegerStore(V, SI, AATags);</span></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">    StoreInst &#42;NewSI;</span></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewBeginOffset == NewAllocaBeginOffset &amp;&amp;</span></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><span class="doxyHighlight">        NewEndOffset == NewAllocaEndOffset &amp;&amp;</span></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><span class="doxyHighlight">        <a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), NewAllocaTy)) &#123;</span></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, NewAllocaTy);</span></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewPtr =</span></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><span class="doxyHighlight">          getPtrToNewAI(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getPointerAddressSpace(), <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile());</span></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><span class="doxyHighlight">      NewSI =</span></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><span class="doxyHighlight">          IRB.CreateAlignedStore(V, NewPtr, NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile());</span></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getPointerAddressSpace();</span></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewPtr = getNewAllocaSlicePtr(IRB, IRB.getPtrTy(AS));</span></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><span class="doxyHighlight">      NewSI =</span></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><span class="doxyHighlight">          IRB.CreateAlignedStore(V, NewPtr, getSliceAlign(), <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile());</span></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><span class="doxyHighlight">    NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(SI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><span class="doxyHighlight">                             LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><span class="doxyHighlight">      NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><span class="doxyHighlight">                                                  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile())</span></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><span class="doxyHighlight">      NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#aff28bd42ac76fc3e1c0e4db7f9e06f2d">setAtomic</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getOrdering(), <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getSyncScopeID());</span></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>())</span></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><span class="doxyHighlight">      NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#a55195fa18cf783fe74de0cced1ca6eb3">setAlignment</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getAlign());</span></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><span class="doxyHighlight">    <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(&amp;OldAI, IsSplit, NewBeginOffset &#42; 8, SliceSize &#42; 8, &amp;SI,</span></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><span class="doxyHighlight">                     NewSI, NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#aefb15964facf7f35f22a6e8a7fb67285">getPointerOperand</a>(),</span></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><span class="doxyHighlight">                     NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(&amp;SI);</span></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><span class="doxyHighlight">    deleteIfTriviallyDead(OldOp);</span></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewSI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#aefb15964facf7f35f22a6e8a7fb67285">getPointerOperand</a>() == &amp;NewAI &amp;&amp;</span></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><span class="doxyHighlight">           NewSI-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == NewAllocaTy &amp;&amp;</span></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><span class="doxyHighlight">           !<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isVolatile();</span></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><span class="doxyHighlightComment">  /// Compute an integer value from splatting an i8 across the given</span></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><span class="doxyHighlightComment">  /// number of bytes.</span></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><span class="doxyHighlightComment">  /// Note that this routine assumes an i8 is a byte. If that isn&#39;t true, don&#39;t</span></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><span class="doxyHighlightComment">  /// call this routine.</span></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><span class="doxyHighlightComment">  /// FIXME: Heed the advice above.</span></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><span class="doxyHighlightComment">  /// \\param V The i8 value to splat.</span></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><span class="doxyHighlightComment">  /// \\param Size The number of bytes in the output (assuming i8 is one byte)</span></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;getIntegerSplat(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>) &#123;</span></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a positive number of bytes.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><span class="doxyHighlight">    IntegerType &#42;VTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType());</span></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VTy-&gt;<a href="/docs/api/classes/llvm/integertype/#a90b790ccb1af4ea5ccd69db4b8cd2d81">getBitWidth</a>() == 8 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected an i8 value for the byte&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> == 1)</span></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SplatIntTy = Type::getIntNTy(VTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &#42; 8);</span></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = IRB.CreateMul(</span></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><span class="doxyHighlight">        IRB.CreateZExt(V, SplatIntTy, </span><span class="doxyHighlightStringLiteral">&quot;zext&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><span class="doxyHighlight">        IRB.CreateUDiv(<a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(SplatIntTy),</span></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><span class="doxyHighlight">                       IRB.CreateZExt(<a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()),</span></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><span class="doxyHighlight">                                      SplatIntTy)),</span></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;isplat&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><span class="doxyHighlightComment">  /// Compute a vector splat for a given element value.</span></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a387427d56330771ba6f190e27776a327">getVectorSplat</a>(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElements) &#123;</span></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = IRB.CreateVectorSplat(NumElements, V, </span><span class="doxyHighlightStringLiteral">&quot;vsplat&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;       splat: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitMemSetInst(MemSetInst &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawDest() == OldPtr);</span></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><span class="doxyHighlight">    AAMDNodes AATags = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getAAMetadata();</span></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the memset has a variable size, it cannot be split, just adjust the</span></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointer to the new alloca.</span></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getLength())) &#123;</span></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!IsSplit);</span></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewBeginOffset == BeginOffset);</span></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.setDest(getNewAllocaSlicePtr(IRB, OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.setDestAlignment(getSliceAlign());</span></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// In theory we should call migrateDebugInfo here. However, we do not</span></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// emit dbg.assign intrinsics for mem intrinsics storing through non-</span></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// constant geps, or storing a variable number of bytes.</span></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>).<a href="/docs/api/namespaces/llvm/sandboxir/#a0e9cf49b789ff0825ffea99d23afd013">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>).<a href="/docs/api/namespaces/llvm/sandboxir/#a0e9cf49b789ff0825ffea99d23afd013">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;AT: Unexpected link to non-const GEP&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><span class="doxyHighlight">      deleteIfTriviallyDead(OldPtr);</span></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Record this instruction for deletion.</span></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;AllocaTy = NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>();</span></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ScalarTy = AllocaTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</span></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanContinue = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy || IntTy)</span></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BeginOffset &gt; NewAllocaBeginOffset || EndOffset &lt; NewAllocaEndOffset)</span></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Length must be in range for FixedVectorType.</span></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getLength());</span></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0ae88b4464fe326a51e6e6dfae28dd536d">Len</a> = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getLimitedValue();</span></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Len &gt; std::numeric&#95;limits&lt;unsigned&gt;::max())</span></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Int8Ty = IntegerType::getInt8Ty(NewAI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SrcTy = <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Int8Ty, Len);</span></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a2fb1c078833c17e4c9529b0cf924385c">canConvertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SrcTy, AllocaTy) &amp;&amp;</span></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isLegalInteger(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(ScalarTy).getFixedValue());</span></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><span class="doxyHighlight">    &#125;();</span></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this doesn&#39;t map cleanly onto the alloca type, and that type isn&#39;t</span></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a single value type, just emit a memset.</span></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CanContinue) &#123;</span></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SizeTy = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getLength()-&gt;getType();</span></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Sz = NewEndOffset - NewBeginOffset;</span></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = ConstantInt::get(SizeTy, Sz);</span></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><span class="doxyHighlight">      MemIntrinsic &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemIntrinsic&gt;</a>(IRB.CreateMemSet(</span></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><span class="doxyHighlight">          getNewAllocaSlicePtr(IRB, OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getValue(), <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>,</span></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><span class="doxyHighlight">          MaybeAlign(getSliceAlign()), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile()));</span></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;setAAMetadata(</span></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><span class="doxyHighlight">            AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(NewBeginOffset - BeginOffset, Sz));</span></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><span class="doxyHighlight">      <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(&amp;OldAI, IsSplit, NewBeginOffset &#42; 8, SliceSize &#42; 8, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>,</span></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><span class="doxyHighlight">                       New, <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;getRawDest(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;New &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we can represent this as a simple value, we have to build the actual</span></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value to store, which requires expanding the byte present in memset to</span></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a sensible representation for the alloca type. This is essentially</span></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// splatting the byte to a sufficiently wide integer, splatting it across</span></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// any desired vector width, and bitcasting to the final type.</span></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy) &#123;</span></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is a memset of a vectorized alloca, insert it.</span></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ElementTy == ScalarTy);</span></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BeginIndex = getIndex(NewBeginOffset);</span></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIndex = getIndex(NewEndOffset);</span></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndIndex &gt; BeginIndex &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Empty vector!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElements = EndIndex - BeginIndex;</span></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumElements &lt;= <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(VecTy)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>() &amp;&amp;</span></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Too many elements!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a> = getIntegerSplat(</span></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getValue(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(ElementTy).getFixedValue() / 8);</span></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, <a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a>, ElementTy);</span></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumElements &gt; 1)</span></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a> = <a href="/docs/api/namespaces/llvm/#a387427d56330771ba6f190e27776a327">getVectorSplat</a>(<a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a>, NumElements);</span></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Old = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><span class="doxyHighlight">                                         NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;oldload&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#a75cf62ffe10261611bab4d74598ab0e4">insertVector</a>(IRB, Old, <a href="/docs/api/namespaces/llvm/#a766456df1dd21e804cd4596304e10764a5b9bf50c6579a978e5c1104bf8787651">Splat</a>, BeginIndex, </span><span class="doxyHighlightStringLiteral">&quot;vec&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntTy) &#123;</span></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is a memset on an alloca where we can widen stores, insert the</span></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// set integer.</span></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile());</span></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><span class="doxyHighlight">      uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = NewEndOffset - NewBeginOffset;</span></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = getIntegerSplat(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getValue(), <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntTy &amp;&amp; (BeginOffset != NewAllocaBeginOffset ||</span></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><span class="doxyHighlight">                    EndOffset != NewAllocaBeginOffset)) &#123;</span></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Old = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><span class="doxyHighlight">                                           NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;oldload&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><span class="doxyHighlight">        Old = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Old, IntTy);</span></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><span class="doxyHighlight">        uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = NewBeginOffset - NewAllocaBeginOffset;</span></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#a4cad1dcbccfcc610dc8d47100b4871ef">insertInteger</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Old, V, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightStringLiteral">&quot;insert&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() == IntTy &amp;&amp;</span></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Wrong type for an alloca wide integer!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, AllocaTy);</span></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Established these invariants above.</span></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewBeginOffset == NewAllocaBeginOffset);</span></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewEndOffset == NewAllocaEndOffset);</span></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = getIntegerSplat(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getValue(),</span></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><span class="doxyHighlight">                          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(ScalarTy).getFixedValue() / 8);</span></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorType &#42;AllocaVecTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(AllocaTy))</span></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/#a387427d56330771ba6f190e27776a327">getVectorSplat</a>(</span></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><span class="doxyHighlight">            V, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(AllocaVecTy)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a2f1d58ac35de4475017aca6c5bda6d44">getNumElements</a>());</span></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, V, AllocaTy);</span></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewPtr = getPtrToNewAI(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getDestAddressSpace(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile());</span></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><span class="doxyHighlight">    StoreInst &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> =</span></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><span class="doxyHighlight">        IRB.CreateAlignedStore(V, NewPtr, NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile());</span></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;copyMetadata(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><span class="doxyHighlight">                           LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;setAAMetadata(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><span class="doxyHighlight">                                                <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><span class="doxyHighlight">    <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(&amp;OldAI, IsSplit, NewBeginOffset &#42; 8, SliceSize &#42; 8, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>,</span></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><span class="doxyHighlight">                     New, <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;getPointerOperand(), V, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;New &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile();</span></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitMemTransferInst(MemTransferInst &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Rewriting of memory transfer instructions can be a bit tricky. We break</span></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// them into two categories: split intrinsics and unsplit intrinsics.</span></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><span class="doxyHighlight">    AAMDNodes AATags = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getAAMetadata();</span></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsDest = &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawDestUse() == OldUse;</span></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IsDest &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawDest() == OldPtr) ||</span></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><span class="doxyHighlight">           (!IsDest &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawSource() == OldPtr));</span></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> SliceAlign = getSliceAlign();</span></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For unsplit intrinsics, we simply modify the source and destination</span></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointers in place. This isn&#39;t just an optimization, it is a matter of</span></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// correctness. With unsplit intrinsics we may be dealing with transfers</span></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// within a single alloca before SROA ran, or with transfers that have</span></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a variable length. We may also be dealing with memmove instead of</span></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// memcpy, and so simply updating the pointers is the necessary for us to</span></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// update both source and dest of a single call.</span></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSplittable) &#123;</span></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AdjustedPtr = getNewAllocaSlicePtr(IRB, OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsDest) &#123;</span></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update the address component of linked dbg.assigns.</span></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UpdateAssignAddress = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgAssign) &#123;</span></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(DbgAssign-&gt;location&#95;ops(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getDest()) ||</span></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><span class="doxyHighlight">              DbgAssign-&gt;getAddress() == <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getDest())</span></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><span class="doxyHighlight">            DbgAssign-&gt;replaceVariableLocationOp(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getDest(), AdjustedPtr);</span></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>), UpdateAssignAddress);</span></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>), UpdateAssignAddress);</span></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.setDest(AdjustedPtr);</span></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.setDestAlignment(SliceAlign);</span></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.setSource(AdjustedPtr);</span></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.setSourceAlignment(SliceAlign);</span></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><span class="doxyHighlight">      deleteIfTriviallyDead(OldPtr);</span></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For split transfer intrinsics we have an incredibly useful assurance:</span></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the source and destination do not reside within the same alloca, and at</span></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// least one of them does not escape. This means that we can replace</span></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// memmove with memcpy, and we don&#39;t need to worry about all manner of</span></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// downsides to splitting and transforming the operations.</span></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this doesn&#39;t map cleanly onto the alloca type, and that type isn&#39;t</span></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a single value type, just emit a memcpy.</span></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EmitMemCpy =</span></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><span class="doxyHighlight">        !VecTy &amp;&amp; !IntTy &amp;&amp;</span></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><span class="doxyHighlight">        (BeginOffset &gt; NewAllocaBeginOffset || EndOffset &lt; NewAllocaEndOffset ||</span></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><span class="doxyHighlight">         SliceSize !=</span></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>()).getFixedValue() ||</span></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><span class="doxyHighlight">         !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>()) ||</span></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><span class="doxyHighlight">         !NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>());</span></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re just going to emit a memcpy, the alloca hasn&#39;t changed, and the</span></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// size hasn&#39;t been shrunk based on analysis of the viable range, this is</span></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a no-op.</span></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EmitMemCpy &amp;&amp; &amp;OldAI == &amp;NewAI) &#123;</span></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ensure the start lines up.</span></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewBeginOffset == BeginOffset);</span></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Rewrite the size as needed.</span></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewEndOffset != EndOffset)</span></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.setLength(ConstantInt::get(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getLength()-&gt;getType(),</span></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><span class="doxyHighlight">                                      NewEndOffset - NewBeginOffset));</span></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Record this instruction for deletion.</span></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Strip all inbounds GEPs and pointer casts to try to dig out any root</span></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alloca that should be re-examined after rewriting this instruction.</span></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OtherPtr = IsDest ? <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawSource() : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getRawDest();</span></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;AI =</span></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(OtherPtr-&gt;<a href="/docs/api/classes/llvm/value/#a3ed745230c0e6c52f4b1ec0dae8c07fb">stripInBoundsOffsets</a>())) &#123;</span></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AI != &amp;OldAI &amp;&amp; AI != &amp;NewAI &amp;&amp;</span></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Splittable transfers cannot reach the same alloca on both ends.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.Worklist.insert(AI);</span></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;OtherPtrTy = OtherPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OtherAS = OtherPtrTy-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the relative offset for the other pointer within the transfer.</span></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OffsetWidth = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexSizeInBits(OtherAS);</span></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><span class="doxyHighlight">    APInt OtherOffset(OffsetWidth, NewBeginOffset - BeginOffset);</span></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> OtherAlign =</span></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><span class="doxyHighlight">        (IsDest ? <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getSourceAlign() : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getDestAlign()).valueOrOne();</span></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><span class="doxyHighlight">    OtherAlign =</span></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(OtherAlign, OtherOffset.zextOrTrunc(64).getZExtValue());</span></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EmitMemCpy) &#123;</span></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compute the other pointer, folding as much as possible to produce</span></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a single, simple GEP in most cases.</span></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><span class="doxyHighlight">      OtherPtr = <a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(IRB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, OtherPtr, OtherOffset, OtherPtrTy,</span></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><span class="doxyHighlight">                                OtherPtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OurPtr = getNewAllocaSlicePtr(IRB, OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SizeTy = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getLength()-&gt;getType();</span></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = ConstantInt::get(SizeTy, NewEndOffset - NewBeginOffset);</span></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestPtr, &#42;SrcPtr;</span></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><span class="doxyHighlight">      MaybeAlign DestAlign, SrcAlign;</span></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note: IsDest is true iff we&#39;re copying into the new alloca slice</span></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsDest) &#123;</span></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><span class="doxyHighlight">        DestPtr = OurPtr;</span></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><span class="doxyHighlight">        DestAlign = SliceAlign;</span></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><span class="doxyHighlight">        SrcPtr = OtherPtr;</span></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><span class="doxyHighlight">        SrcAlign = OtherAlign;</span></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><span class="doxyHighlight">        DestPtr = OtherPtr;</span></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><span class="doxyHighlight">        DestAlign = OtherAlign;</span></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><span class="doxyHighlight">        SrcPtr = OurPtr;</span></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><span class="doxyHighlight">        SrcAlign = SliceAlign;</span></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><span class="doxyHighlight">      CallInst &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = IRB.CreateMemCpy(DestPtr, DestAlign, SrcPtr, SrcAlign,</span></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><span class="doxyHighlight">                                       <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile());</span></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;setAAMetadata(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a5f73e1d64fc604ae208d9eee356dd2ab">shift</a>(NewBeginOffset - BeginOffset));</span></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><span class="doxyHighlight">      APInt <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(DestPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), 0);</span></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsDest) &#123;</span></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><span class="doxyHighlight">        <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(&amp;OldAI, IsSplit, NewBeginOffset &#42; 8, SliceSize &#42; 8,</span></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><span class="doxyHighlight">                         &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, New, DestPtr, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(</span></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><span class="doxyHighlight">                     DestPtr-&gt;<a href="/docs/api/classes/llvm/value/#a23c582e2452eeb2b2cf6e0c43eca617e">stripAndAccumulateConstantOffsets</a>(</span></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><span class="doxyHighlight">                         <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightComment">/&#42;AllowNonInbounds&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))) &#123;</span></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><span class="doxyHighlight">        <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, IsSplit, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue() &#42; 8,</span></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><span class="doxyHighlight">                         SliceSize &#42; 8, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, New, DestPtr, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;New &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsWholeAlloca = NewBeginOffset == NewAllocaBeginOffset &amp;&amp;</span></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><span class="doxyHighlight">                         NewEndOffset == NewAllocaEndOffset;</span></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = NewEndOffset - NewBeginOffset;</span></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BeginIndex = VecTy ? getIndex(NewBeginOffset) : 0;</span></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIndex = VecTy ? getIndex(NewEndOffset) : 0;</span></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElements = EndIndex - BeginIndex;</span></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><span class="doxyHighlight">    IntegerType &#42;SubIntTy =</span></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><span class="doxyHighlight">        IntTy ? Type::getIntNTy(IntTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &#42; 8) : nullptr;</span></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reset the other pointer type to match the register type we&#39;re going to</span></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// use, but using the address space of the original other pointer.</span></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;OtherTy;</span></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy &amp;&amp; !IsWholeAlloca) &#123;</span></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumElements == 1)</span></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><span class="doxyHighlight">        OtherTy = VecTy-&gt;<a href="/docs/api/classes/llvm/vectortype/#afdce715c901d62e2c1367a0ff5248175">getElementType</a>();</span></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><span class="doxyHighlight">        OtherTy = <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(VecTy-&gt;<a href="/docs/api/classes/llvm/vectortype/#afdce715c901d62e2c1367a0ff5248175">getElementType</a>(), NumElements);</span></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntTy &amp;&amp; !IsWholeAlloca) &#123;</span></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><span class="doxyHighlight">      OtherTy = SubIntTy;</span></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><span class="doxyHighlight">      OtherTy = NewAllocaTy;</span></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AdjPtr = <a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(IRB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, OtherPtr, OtherOffset, OtherPtrTy,</span></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><span class="doxyHighlight">                                   OtherPtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><span class="doxyHighlight">    MaybeAlign SrcAlign = OtherAlign;</span></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><span class="doxyHighlight">    MaybeAlign DstAlign = SliceAlign;</span></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsDest)</span></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(SrcAlign, DstAlign);</span></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcPtr;</span></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DstPtr;</span></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsDest) &#123;</span></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><span class="doxyHighlight">      DstPtr = getPtrToNewAI(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getDestAddressSpace(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile());</span></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><span class="doxyHighlight">      SrcPtr = AdjPtr;</span></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><span class="doxyHighlight">      DstPtr = AdjPtr;</span></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><span class="doxyHighlight">      SrcPtr = getPtrToNewAI(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getSourceAddressSpace(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile());</span></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>;</span></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy &amp;&amp; !IsWholeAlloca &amp;&amp; !IsDest) &#123;</span></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><span class="doxyHighlight">                                  NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="#a604f6e897606d25237935a3374fe7a3e">extractVector</a>(IRB, Src, BeginIndex, EndIndex, </span><span class="doxyHighlightStringLiteral">&quot;vec&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntTy &amp;&amp; !IsWholeAlloca &amp;&amp; !IsDest) &#123;</span></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><span class="doxyHighlight">                                  NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Src, IntTy);</span></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><span class="doxyHighlight">      uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = NewBeginOffset - NewAllocaBeginOffset;</span></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="#ab2f67bb5d465e282bbb175c9c278f251">extractInteger</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Src, SubIntTy, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightStringLiteral">&quot;extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><span class="doxyHighlight">      LoadInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a> = IRB.CreateAlignedLoad(OtherTy, SrcPtr, SrcAlign,</span></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><span class="doxyHighlight">                                             <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile(), </span><span class="doxyHighlightStringLiteral">&quot;copyload&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;copyMetadata(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><span class="doxyHighlight">                              LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;setAAMetadata(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><span class="doxyHighlight">                                                   <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>;</span></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy &amp;&amp; !IsWholeAlloca &amp;&amp; IsDest) &#123;</span></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Old = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><span class="doxyHighlight">                                         NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;oldload&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="#a75cf62ffe10261611bab4d74598ab0e4">insertVector</a>(IRB, Old, Src, BeginIndex, </span><span class="doxyHighlightStringLiteral">&quot;vec&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntTy &amp;&amp; !IsWholeAlloca &amp;&amp; IsDest) &#123;</span></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Old = IRB.CreateAlignedLoad(NewAI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), &amp;NewAI,</span></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><span class="doxyHighlight">                                         NewAI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), </span><span class="doxyHighlightStringLiteral">&quot;oldload&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><span class="doxyHighlight">      Old = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Old, IntTy);</span></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><span class="doxyHighlight">      uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = NewBeginOffset - NewAllocaBeginOffset;</span></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="#a4cad1dcbccfcc610dc8d47100b4871ef">insertInteger</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Old, Src, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightStringLiteral">&quot;insert&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="#af169f594f2c9e8cd49a59b29373eb4de">convertValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB, Src, NewAllocaTy);</span></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><span class="doxyHighlight">    StoreInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(</span></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><span class="doxyHighlight">        IRB.CreateAlignedStore(Src, DstPtr, DstAlign, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile()));</span></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;copyMetadata(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><span class="doxyHighlight">                             LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;setAAMetadata(AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(NewBeginOffset - BeginOffset,</span></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><span class="doxyHighlight">                                                  <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><span class="doxyHighlight">    APInt <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(DstPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), 0);</span></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsDest) &#123;</span></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><span class="doxyHighlight">      <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(&amp;OldAI, IsSplit, NewBeginOffset &#42; 8, SliceSize &#42; 8, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>,</span></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><span class="doxyHighlight">                       Store, DstPtr, Src, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(</span></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><span class="doxyHighlight">                   DstPtr-&gt;<a href="/docs/api/classes/llvm/value/#a23c582e2452eeb2b2cf6e0c43eca617e">stripAndAccumulateConstantOffsets</a>(</span></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><span class="doxyHighlight">                       <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </span><span class="doxyHighlightComment">/&#42;AllowNonInbounds&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))) &#123;</span></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><span class="doxyHighlight">      <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, IsSplit, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue() &#42; 8, SliceSize &#42; 8,</span></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><span class="doxyHighlight">                       &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, Store, DstPtr, Src, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Store &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isVolatile();</span></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitIntrinsicInst(IntrinsicInst &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isLifetimeStartOrEnd() || <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isLaunderOrStripInvariantGroup() ||</span></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isDroppable()) &amp;&amp;</span></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unexpected intrinsic!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Record this instruction for deletion.</span></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64conditionalcompares-cpp/#ab15af716dfa3d6f1fa7978be4639bd8e">Pass</a>.DeadInsts.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isDroppable()) &#123;</span></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getIntrinsicID() == Intrinsic::assume &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected assume&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO For now we forget assumed information, this can be improved.</span></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><span class="doxyHighlight">      OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a731895a3f577718bbaec9b180eb2a6bb">dropDroppableUsesIn</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.isLaunderOrStripInvariantGroup())</span></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getArgOperand(1) == OldPtr);</span></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Lifetime intrinsics are only promotable if they cover the whole alloca.</span></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Therefore, we drop lifetime intrinsics which don&#39;t cover the whole</span></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alloca.</span></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (In theory, intrinsics which partially cover an alloca could be</span></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// promoted, but PromoteMemToReg doesn&#39;t handle that case.)</span></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Check whether the alloca is promotable before dropping the</span></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// lifetime intrinsics?</span></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewBeginOffset != NewAllocaBeginOffset ||</span></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><span class="doxyHighlight">        NewEndOffset != NewAllocaEndOffset)</span></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><span class="doxyHighlight">    ConstantInt &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> =</span></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><span class="doxyHighlight">        ConstantInt::get(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getArgOperand(0)-&gt;getType()),</span></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><span class="doxyHighlight">                         NewEndOffset - NewBeginOffset);</span></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Lifetime intrinsics always expect an i8&#42; so directly get such a pointer</span></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for the new alloca slice.</span></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;<a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a> = IRB.getPtrTy(OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>());</span></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = getNewAllocaSlicePtr(IRB, <a href="/docs/api/namespaces/llvm/#a41f670c80fbc831d70a472b03c4739ae">PointerTy</a>);</span></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>;</span></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getIntrinsicID() == Intrinsic::lifetime&#95;start)</span></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = IRB.CreateLifetimeStart(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = IRB.CreateLifetimeEnd(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><span class="doxyHighlight">    (void)New;</span></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;New &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> fixLoadStoreAlign(Instruction &amp;Root) &#123;</span></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This algorithm implements the same visitor loop as</span></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// hasUnsafePHIOrSelectUse, and fixes the alignment of each load</span></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or store found.</span></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><span class="doxyHighlight">    SmallPtrSet&lt;Instruction &#42;, 4&gt; Visited;</span></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><span class="doxyHighlight">    SmallVector&lt;Instruction &#42;, 4&gt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</span></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><span class="doxyHighlight">    Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;Root);</span></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(&amp;Root);</span></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadInst &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><span class="doxyHighlight">        LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2b1268b642e9bf4373b6fb31c482c9ca">setAlignment</a>(std::min(LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(), getSliceAlign()));</span></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreInst &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;setAlignment(std::min(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getAlign(), getSliceAlign()));</span></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AddrSpaceCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users())</span></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)).second)</span></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</span></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.empty());</span></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitPHINode(PHINode &amp;PN) &#123;</span></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; PN &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BeginOffset &gt;= NewAllocaBeginOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;PHIs are unsplittable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndOffset &lt;= NewAllocaEndOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;PHIs are unsplittable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We would like to compute a new pointer in only one place, but have it be</span></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as local as possible to the PHI. To do that, we re-use the location of</span></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the old pointer, which necessarily must be in the right position to</span></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dominate the PHI.</span></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><span class="doxyHighlight">    IRBuilderBase::InsertPointGuard Guard(IRB);</span></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(OldPtr))</span></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><span class="doxyHighlight">      IRB.SetInsertPoint(OldPtr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(),</span></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><span class="doxyHighlight">                         OldPtr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><span class="doxyHighlight">      IRB.SetInsertPoint(OldPtr);</span></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><span class="doxyHighlight">    IRB.SetCurrentDebugLocation(OldPtr-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewPtr = getNewAllocaSlicePtr(IRB, OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace the operands which were using the old pointer.</span></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><span class="doxyHighlight">    std::replace(PN.<a href="/docs/api/classes/llvm/user/#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op&#95;begin</a>(), PN.<a href="/docs/api/classes/llvm/user/#af41f58e730804d10b91fcff39b035f74">op&#95;end</a>(), <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Value&gt;</a>(OldPtr), NewPtr);</span></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; PN &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><span class="doxyHighlight">    deleteIfTriviallyDead(OldPtr);</span></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fix the alignment of any loads or stores using this PHI node.</span></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><span class="doxyHighlight">    fixLoadStoreAlign(PN);</span></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PHIs can&#39;t be promoted on their own, but often can be speculated. We</span></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// check the speculation outside of the rewriter so that we see the</span></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fully-rewritten alloca.</span></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><span class="doxyHighlight">    PHIUsers.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&amp;PN);</span></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#a784e0c8f27c7cc40d3b741bef27e153d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitSelectInst(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/si">SI</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/si">SI</a>.getTrueValue() == OldPtr || <a href="/docs/api/namespaces/llvm/si">SI</a>.getFalseValue() == OldPtr) &amp;&amp;</span></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Pointer isn&#39;t an operand!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BeginOffset &gt;= NewAllocaBeginOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Selects are unsplittable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndOffset &lt;= NewAllocaEndOffset &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Selects are unsplittable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewPtr = getNewAllocaSlicePtr(IRB, OldPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace the operands which were using the old pointer.</span></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.getOperand(1) == OldPtr)</span></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>.setOperand(1, NewPtr);</span></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.getOperand(2) == OldPtr)</span></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>.setOperand(2, NewPtr);</span></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/si">SI</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><span class="doxyHighlight">    deleteIfTriviallyDead(OldPtr);</span></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fix the alignment of any loads or stores using this select.</span></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"><span class="doxyHighlight">    fixLoadStoreAlign(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Selects can&#39;t be promoted on their own, but often can be speculated. We</span></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// check the speculation outside of the rewriter so that we see the</span></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fully-rewritten alloca.</span></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><span class="doxyHighlight">    SelectUsers.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&amp;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><span class="doxyHighlightComment">/// Visitor to rewrite aggregate loads and stores as scalar.</span></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><span class="doxyHighlightComment">/// This pass aggressively rewrites all aggregate loads and stores on</span></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><span class="doxyHighlightComment">/// a particular pointer (or any pointer derived from it which we can identify)</span></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"><span class="doxyHighlightComment">/// with scalar loads and stores.</span></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#a3a9355e98cbb59191294e139660c5bc6">AggLoadStoreRewriter</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instvisitor">InstVisitor</a>&lt;AggLoadStoreRewriter, bool&gt; &#123;</span></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Befriend the base class so it can delegate to private visit methods.</span></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instvisitor">InstVisitor</a>&lt;<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#a3a9355e98cbb59191294e139660c5bc6">AggLoadStoreRewriter</a>, bool&gt;;</span></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><span class="doxyHighlightComment">  /// Queue of pointer uses to analyze and potentially rewrite.</span></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Use &#42;, 8&gt;</a> Queue;</span></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><span class="doxyHighlightComment">  /// Set to prevent us from cycling with phi nodes and loops.</span></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;User &#42;, 8&gt;</a> Visited;</span></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"><span class="doxyHighlightComment">  /// The current pointer use being rewritten. This is used to dig up the used</span></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><span class="doxyHighlightComment">  /// value (as opposed to the user).</span></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/use">Use</a> &#42;U = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><span class="doxyHighlightComment">  /// Used to calculate offsets, and hence alignment, of subobjects.</span></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</span></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB;</span></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#a3a9355e98cbb59191294e139660c5bc6"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#a3a9355e98cbb59191294e139660c5bc6">AggLoadStoreRewriter</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB)</span></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><span class="doxyHighlight">      : DL(DL), IRB(IRB) &#123;&#125;</span></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><span class="doxyHighlightComment">  /// Rewrite loads and stores through a pointer and all pointers derived from</span></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"><span class="doxyHighlightComment">  /// it.</span></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#a645e9f8a21fc4e44f9bb587edc5f0ad4"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/aggloadstorerewriter/#a645e9f8a21fc4e44f9bb587edc5f0ad4">rewrite</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Rewriting FCA loads and stores...\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><span class="doxyHighlight">    enqueueUsers(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Queue.empty()) &#123;</span></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><span class="doxyHighlight">      U = Queue.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/classes/llvm/instvisitor/#a6352e72d11377a9c62f24434ae869bf0">visit</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U-&gt;getUser()));</span></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><span class="doxyHighlightComment">  /// Enqueue all the users of the given instruction for further processing.</span></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><span class="doxyHighlightComment">  /// This uses a set to de-duplicate users.</span></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> enqueueUsers(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.uses())</span></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(U.getUser()).second)</span></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><span class="doxyHighlight">        Queue.push&#95;back(&amp;U);</span></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Conservative default is to not rewrite anything.</span></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitInstruction(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><span class="doxyHighlightComment">  /// Generic recursive split emission class.</span></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Derived&gt; </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight">OpSplitter &#123;</span></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">protected</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><span class="doxyHighlightComment">    /// The builder used to form new instructions.</span></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB;</span></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><span class="doxyHighlightComment">    /// The indices which to be used with insert- or extractvalue to select the</span></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><span class="doxyHighlightComment">    /// appropriate value within the aggregate.</span></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><span class="doxyHighlight">    SmallVector&lt;unsigned, 4&gt; Indices;</span></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><span class="doxyHighlightComment">    /// The indices to a GEP instruction which will move Ptr to the correct slot</span></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744"><span class="doxyHighlightComment">    /// within the aggregate.</span></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><span class="doxyHighlight">    SmallVector&lt;Value &#42;, 4&gt; GEPIndices;</span></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><span class="doxyHighlightComment">    /// The base pointer of the original op, used as a base for GEPing the</span></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><span class="doxyHighlightComment">    /// split operations.</span></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ptr;</span></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><span class="doxyHighlightComment">    /// The base pointee type being GEPed into.</span></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;BaseTy;</span></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><span class="doxyHighlightComment">    /// Known alignment of the base pointer.</span></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> BaseAlign;</span></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"><span class="doxyHighlightComment">    /// To calculate offset of each component so we can correctly deduce</span></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><span class="doxyHighlightComment">    /// alignments.</span></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;DL;</span></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"><span class="doxyHighlightComment">    /// Initialize the splitter with an insertion point, Ptr and start with a</span></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><span class="doxyHighlightComment">    /// single zero GEP index.</span></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><span class="doxyHighlight">    OpSplitter(Instruction &#42;InsertionPoint, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ptr, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;BaseTy,</span></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><span class="doxyHighlight">               Align BaseAlign, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;DL, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB)</span></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><span class="doxyHighlight">        : IRB(IRB), GEPIndices(1, IRB.getInt32(0)), Ptr(Ptr), BaseTy(BaseTy),</span></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><span class="doxyHighlight">          BaseAlign(BaseAlign), DL(DL) &#123;</span></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><span class="doxyHighlight">      IRB.SetInsertPoint(InsertionPoint);</span></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><span class="doxyHighlightComment">    /// Generic recursive split emission routine.</span></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><span class="doxyHighlightComment">    ///</span></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><span class="doxyHighlightComment">    /// This method recursively splits an aggregate op (load or store) into</span></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><span class="doxyHighlightComment">    /// scalar or vector ops. It splits recursively until it hits a single value</span></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><span class="doxyHighlightComment">    /// and emits that single value operation via the template argument.</span></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><span class="doxyHighlightComment">    ///</span></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><span class="doxyHighlightComment">    /// The logic of this routine relies on GEPs and insertvalue and</span></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><span class="doxyHighlightComment">    /// extractvalue all operating with the same fundamental index list, merely</span></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><span class="doxyHighlightComment">    /// formatted differently (GEPs need actual values).</span></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><span class="doxyHighlightComment">    ///</span></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><span class="doxyHighlightComment">    /// \\param Ty  The type being split recursively into smaller ops.</span></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><span class="doxyHighlightComment">    /// \\param Agg The aggregate value being built up or stored, depending on</span></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><span class="doxyHighlightComment">    /// whether this is splitting a load or a store respectively.</span></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> emitSplitOps(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;&amp;Agg, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Twine &amp;Name) &#123;</span></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>()) &#123;</span></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = DL.getIndexedOffsetInType(BaseTy, GEPIndices);</span></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">Derived &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)-&gt;emitFunc(</span></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><span class="doxyHighlight">            Ty, Agg, <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(BaseAlign, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>), Name);</span></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArrayType &#42;ATy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ArrayType&gt;</a>(Ty)) &#123;</span></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldSize = Indices.size();</span></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><span class="doxyHighlight">        (void)OldSize;</span></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = ATy-&gt;getNumElements(); Idx != <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><span class="doxyHighlight">             ++Idx) &#123;</span></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Indices.size() == OldSize &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Did not return to the old size&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><span class="doxyHighlight">          Indices.push&#95;back(Idx);</span></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><span class="doxyHighlight">          GEPIndices.push&#95;back(IRB.getInt32(Idx));</span></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><span class="doxyHighlight">          emitSplitOps(ATy-&gt;getElementType(), Agg, Name + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight"> + Twine(Idx));</span></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><span class="doxyHighlight">          GEPIndices.pop&#95;back();</span></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><span class="doxyHighlight">          Indices.pop&#95;back();</span></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StructType &#42;STy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(Ty)) &#123;</span></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldSize = Indices.size();</span></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><span class="doxyHighlight">        (void)OldSize;</span></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = STy-&gt;getNumElements(); Idx != <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><span class="doxyHighlight">             ++Idx) &#123;</span></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Indices.size() == OldSize &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Did not return to the old size&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><span class="doxyHighlight">          Indices.push&#95;back(Idx);</span></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"><span class="doxyHighlight">          GEPIndices.push&#95;back(IRB.getInt32(Idx));</span></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><span class="doxyHighlight">          emitSplitOps(STy-&gt;getElementType(Idx), Agg, Name + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight"> + Twine(Idx));</span></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><span class="doxyHighlight">          GEPIndices.pop&#95;back();</span></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><span class="doxyHighlight">          Indices.pop&#95;back();</span></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Only arrays and structs are aggregate loadable types&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">LoadOpSplitter : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> OpSplitter&lt;LoadOpSplitter&gt; &#123;</span></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><span class="doxyHighlight">    AAMDNodes AATags;</span></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A vector to hold the split components that we want to emit</span></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// separate fake uses for.</span></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><span class="doxyHighlight">    SmallVector&lt;Value &#42;, 4&gt; Components;</span></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A vector to hold all the fake uses of the struct that we are splitting.</span></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Usually there should only be one, but we are handling the general case.</span></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><span class="doxyHighlight">    SmallVector&lt;Instruction &#42;, 1&gt; FakeUses;</span></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><span class="doxyHighlight">    LoadOpSplitter(Instruction &#42;InsertionPoint, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ptr, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;BaseTy,</span></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><span class="doxyHighlight">                   AAMDNodes AATags, Align BaseAlign, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;DL,</span></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><span class="doxyHighlight">                   <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB)</span></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><span class="doxyHighlight">        : OpSplitter&lt;LoadOpSplitter&gt;(InsertionPoint, Ptr, BaseTy, BaseAlign, DL,</span></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><span class="doxyHighlight">                                     IRB),</span></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><span class="doxyHighlight">          AATags(AATags) &#123;&#125;</span></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><span class="doxyHighlightComment">    /// Emit a leaf load of a single value. This is called at the leaves of the</span></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><span class="doxyHighlightComment">    /// recursive emission to actually load values.</span></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> emitFunc(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;&amp;Agg, Align Alignment, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Twine &amp;Name) &#123;</span></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>());</span></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Load the single value and insert it using the indices.</span></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> =</span></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><span class="doxyHighlight">          IRB.CreateInBoundsGEP(BaseTy, Ptr, GEPIndices, Name + </span><span class="doxyHighlightStringLiteral">&quot;.gep&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><span class="doxyHighlight">      LoadInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a> =</span></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"><span class="doxyHighlight">          IRB.CreateAlignedLoad(Ty, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, Alignment, Name + </span><span class="doxyHighlightStringLiteral">&quot;.load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><span class="doxyHighlight">      APInt <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(</span></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><span class="doxyHighlight">          DL.getIndexSizeInBits(Ptr-&gt;getType()-&gt;getPointerAddressSpace()), 0);</span></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags &amp;&amp;</span></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/gepoperator/#a5c00e7e76ef5e98c6ffec8d31f63970a">GEPOperator::accumulateConstantOffset</a>(BaseTy, GEPIndices, DL, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>))</span></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;setAAMetadata(</span></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"><span class="doxyHighlight">            AATags.adjustForAccess(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue(), <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType(), DL));</span></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record the load so we can generate a fake use for this aggregate</span></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// component.</span></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"><span class="doxyHighlight">      Components.push&#95;back(Load);</span></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><span class="doxyHighlight">      Agg = IRB.CreateInsertValue(Agg, Load, Indices, Name + </span><span class="doxyHighlightStringLiteral">&quot;.insert&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Load &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Stash the fake uses that use the value generated by this instruction.</span></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> recordFakeUses(LoadInst &amp;LI) &#123;</span></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;U : LI.<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>())</span></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser()))</span></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::fake&#95;use)</span></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870"><span class="doxyHighlight">            FakeUses.push&#95;back(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace all fake uses of the aggregate with a series of fake uses, one</span></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for each split component.</span></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> emitFakeUses() &#123;</span></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : FakeUses) &#123;</span></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><span class="doxyHighlight">        IRB.SetInsertPoint(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : Components)</span></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"><span class="doxyHighlight">          IRB.CreateIntrinsic(Intrinsic::fake&#95;use, &#123;&#125;, &#123;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>&#125;);</span></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitLoadInst(LoadInst &amp;LI) &#123;</span></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI.<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>() == &#42;U);</span></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI.<a href="/docs/api/classes/llvm/loadinst/#aeb534c1a0391ce24551c226a582099a7">isSimple</a>() || LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>())</span></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have an aggregate being loaded, split it apart.</span></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; LI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><span class="doxyHighlight">    LoadOpSplitter Splitter(&amp;LI, &#42;U, LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), LI.<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>(),</span></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><span class="doxyHighlight">                            <a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a>(&amp;LI, 0), DL, IRB);</span></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><span class="doxyHighlight">    Splitter.recordFakeUses(LI);</span></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><span class="doxyHighlight">    Splitter.emitSplitOps(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), V, LI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.fca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><span class="doxyHighlight">    Splitter.emitFakeUses();</span></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><span class="doxyHighlight">    Visited.erase(&amp;LI);</span></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><span class="doxyHighlight">    LI.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><span class="doxyHighlight">    LI.<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">StoreOpSplitter : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> OpSplitter&lt;StoreOpSplitter&gt; &#123;</span></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><span class="doxyHighlight">    StoreOpSplitter(Instruction &#42;InsertionPoint, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ptr, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;BaseTy,</span></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906"><span class="doxyHighlight">                    AAMDNodes AATags, StoreInst &#42;AggStore, Align BaseAlign,</span></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;DL, <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> &amp;IRB)</span></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><span class="doxyHighlight">        : OpSplitter&lt;StoreOpSplitter&gt;(InsertionPoint, Ptr, BaseTy, BaseAlign,</span></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><span class="doxyHighlight">                                      DL, IRB),</span></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><span class="doxyHighlight">          AATags(AATags), AggStore(AggStore) &#123;&#125;</span></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><span class="doxyHighlight">    AAMDNodes AATags;</span></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><span class="doxyHighlight">    StoreInst &#42;AggStore;</span></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"><span class="doxyHighlightComment">    /// Emit a leaf store of a single value. This is called at the leaves of the</span></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><span class="doxyHighlightComment">    /// recursive emission to actually produce stores.</span></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> emitFunc(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;&amp;Agg, Align Alignment, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Twine &amp;Name) &#123;</span></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>());</span></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Extract the single value and store it using the indices.</span></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The gep and extractvalue values are factored out of the CreateStore</span></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// call to make the output independent of the argument evaluation order.</span></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ExtractValue =</span></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><span class="doxyHighlight">          IRB.CreateExtractValue(Agg, Indices, Name + </span><span class="doxyHighlightStringLiteral">&quot;.extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;InBoundsGEP =</span></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><span class="doxyHighlight">          IRB.CreateInBoundsGEP(BaseTy, Ptr, GEPIndices, Name + </span><span class="doxyHighlightStringLiteral">&quot;.gep&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><span class="doxyHighlight">      StoreInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a> =</span></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><span class="doxyHighlight">          IRB.CreateAlignedStore(ExtractValue, InBoundsGEP, Alignment);</span></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"><span class="doxyHighlight">      APInt <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(</span></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"><span class="doxyHighlight">          DL.getIndexSizeInBits(Ptr-&gt;getType()-&gt;getPointerAddressSpace()), 0);</span></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/gepoperator/#a5c00e7e76ef5e98c6ffec8d31f63970a">GEPOperator::accumulateConstantOffset</a>(BaseTy, GEPIndices, DL, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags) &#123;</span></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;setAAMetadata(AATags.adjustForAccess(</span></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue(), ExtractValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), DL));</span></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// migrateDebugInfo requires the base Alloca. Walk to it from this gep.</span></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we cannot (because there&#39;s an intervening non-const or unbounded</span></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// gep) then we wouldn&#39;t expect to see dbg.assign intrinsics linked to</span></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this instruction.</span></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = AggStore-&gt;getPointerOperand()-&gt;stripInBoundsOffsets();</span></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)) &#123;</span></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><span class="doxyHighlight">        uint64&#95;t SizeInBits =</span></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><span class="doxyHighlight">            DL.getTypeSizeInBits(<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand()-&gt;getType());</span></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><span class="doxyHighlight">        <a href="#a0346c3f86c714b9ae84f5566a95e90ac">migrateDebugInfo</a>(OldAI, </span><span class="doxyHighlightComment">/&#42;IsSplit&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue() &#42; 8,</span></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><span class="doxyHighlight">                         SizeInBits, AggStore, Store,</span></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getPointerOperand(), <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand(),</span></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"><span class="doxyHighlight">                         DL);</span></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(Store).<a href="/docs/api/namespaces/llvm/sandboxir/#a0e9cf49b789ff0825ffea99d23afd013">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(Store).<a href="/docs/api/namespaces/llvm/sandboxir/#a0e9cf49b789ff0825ffea99d23afd013">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;AT: unexpected debug.assign linked to store through &quot;</span></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;unbounded GEP&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Store &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitStoreInst(StoreInst &amp;SI) &#123;</span></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.isSimple() || <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getPointerOperand() != &#42;U)</span></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getValueOperand();</span></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()-&gt;isSingleValueType())</span></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have an aggregate being stored, split it apart.</span></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; SI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><span class="doxyHighlight">    StoreOpSplitter Splitter(&amp;SI, &#42;U, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.getAAMetadata(), &amp;SI,</span></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><span class="doxyHighlight">                             <a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a>(&amp;SI, 0), DL, IRB);</span></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><span class="doxyHighlight">    Splitter.emitSplitOps(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), V, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.fca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><span class="doxyHighlight">    Visited.erase(&amp;SI);</span></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The stores replacing SI each have markers describing fragments of the</span></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// assignment so delete the assignment markers linked to SI.</span></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/at/#acac0a0a393ce41aadc29e623549b6bfa">at::deleteAssignmentMarkers</a>(&amp;SI);</span></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>.eraseFromParent();</span></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977"></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitBitCastInst(BitCastInst &amp;BC) &#123;</span></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><span class="doxyHighlight">    enqueueUsers(BC);</span></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitAddrSpaceCastInst(AddrSpaceCastInst &amp;ASC) &#123;</span></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984"><span class="doxyHighlight">    enqueueUsers(ASC);</span></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unfold gep (select cond, ptr1, ptr2), idx</span></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   =&gt; select cond, gep(ptr1, idx), gep(ptr2, idx)</span></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and  gep ptr, (select cond, idx1, idx2)</span></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   =&gt; select cond, gep(ptr, idx1), gep(ptr, idx2)</span></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> unfoldGEPSelect(GetElementPtrInst &amp;GEPI) &#123;</span></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check whether the GEP has exactly one select operand and all indices</span></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will become constant after the transform.</span></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><span class="doxyHighlight">    SelectInst &#42;Sel = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#a0621d26039722d96ad6da863edbf60f9">getPointerOperand</a>());</span></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#a7a7c1233ce0f254ebac019389edcf951">indices</a>()) &#123;</span></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Sel)</span></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><span class="doxyHighlight">        Sel = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>;</span></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Sel-&gt;<a href="/docs/api/classes/llvm/selectinst/#ae95a0fb83a1c98ce1aed74147c026db0">getTrueValue</a>()) ||</span></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><span class="doxyHighlight">            !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Sel-&gt;<a href="/docs/api/classes/llvm/selectinst/#a1b39b0c7ce6162c1f4754a2862957185">getFalseValue</a>()))</span></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Sel)</span></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Rewriting gep(select) -&gt; select(gep):\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Sel &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;              &quot;</span><span class="doxyHighlight"> &lt;&lt; GEPI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;);</span></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetNewOps = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SelOp) &#123;</span></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><span class="doxyHighlight">      SmallVector&lt;Value &#42;&gt; NewOps;</span></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : GEPI.<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>())</span></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == Sel)</span></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"><span class="doxyHighlight">          NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SelOp);</span></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025"><span class="doxyHighlight">          NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewOps;</span></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;True = Sel-&gt;getTrueValue();</span></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;False = Sel-&gt;getFalseValue();</span></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031"><span class="doxyHighlight">    SmallVector&lt;Value &#42;&gt; TrueOps = GetNewOps(True);</span></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><span class="doxyHighlight">    SmallVector&lt;Value &#42;&gt; FalseOps = GetNewOps(False);</span></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><span class="doxyHighlight">    IRB.SetInsertPoint(&amp;GEPI);</span></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><span class="doxyHighlight">    GEPNoWrapFlags NW = GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#aebc354b6b8bd777fb2f1b952cf876bee">getNoWrapFlags</a>();</span></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty = GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#a9fa1834df0fa59e97b016549cf8cf903">getSourceElementType</a>();</span></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NTrue = IRB.CreateGEP(Ty, TrueOps&#91;0&#93;, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(TrueOps).drop&#95;front(),</span></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><span class="doxyHighlight">                                 True-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.gep&quot;</span><span class="doxyHighlight">, NW);</span></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NFalse =</span></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><span class="doxyHighlight">        IRB.CreateGEP(Ty, FalseOps&#91;0&#93;, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(FalseOps).drop&#95;front(),</span></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"><span class="doxyHighlight">                      False-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.gep&quot;</span><span class="doxyHighlight">, NW);</span></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NSel = IRB.CreateSelect(Sel-&gt;getCondition(), NTrue, NFalse,</span></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><span class="doxyHighlight">                                   Sel-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.sel&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047"><span class="doxyHighlight">    Visited.erase(&amp;GEPI);</span></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"><span class="doxyHighlight">    GEPI.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NSel);</span></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049"><span class="doxyHighlight">    GEPI.<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;NSelI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(NSel);</span></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051"><span class="doxyHighlight">    Visited.insert(NSelI);</span></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><span class="doxyHighlight">    enqueueUsers(&#42;NSelI);</span></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053"></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NTrue &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;              &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NFalse &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;              &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NSel &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;);</span></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unfold gep (phi ptr1, ptr2), idx</span></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   =&gt; phi ((gep ptr1, idx), (gep ptr2, idx))</span></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and  gep ptr, (phi idx1, idx2)</span></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   =&gt; phi ((gep ptr, idx1), (gep ptr, idx2))</span></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> unfoldGEPPhi(GetElementPtrInst &amp;GEPI) &#123;</span></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// To prevent infinitely expanding recursive phis, bail if the GEP pointer</span></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// operand (looking through the phi if it is the phi we want to unfold) is</span></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// an instruction besides a static alloca.</span></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><span class="doxyHighlight">    PHINode &#42;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#a0621d26039722d96ad6da863edbf60f9">getPointerOperand</a>());</span></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsInvalidPointerOperand = &#91;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>) &#123;</span></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(V))</span></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(V))</span></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !AI-&gt;isStaticAlloca();</span></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi) &#123;</span></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;operands(), IsInvalidPointerOperand))</span></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsInvalidPointerOperand(GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#a0621d26039722d96ad6da863edbf60f9">getPointerOperand</a>()))</span></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check whether the GEP has exactly one phi operand (including the pointer</span></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// operand) and all indices will become constant after the transform.</span></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#a7a7c1233ce0f254ebac019389edcf951">indices</a>()) &#123;</span></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi)</span></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>;</span></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;incoming&#95;values(),</span></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><span class="doxyHighlight">                    &#91;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123; return isa&lt;ConstantInt&gt;(V); &#125;))</span></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Phi)</span></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Rewriting gep(phi) -&gt; phi(gep):\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    original: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;              &quot;</span><span class="doxyHighlight"> &lt;&lt; GEPI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;);</span></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetNewOps = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PhiOp) &#123;</span></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110"><span class="doxyHighlight">      SmallVector&lt;Value &#42;&gt; NewOps;</span></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : GEPI.<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>())</span></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == Phi)</span></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><span class="doxyHighlight">          NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PhiOp);</span></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"><span class="doxyHighlight">          NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewOps;</span></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><span class="doxyHighlight">    IRB.SetInsertPoint(Phi);</span></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><span class="doxyHighlight">    PHINode &#42;NewPhi = IRB.CreatePHI(GEPI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues(),</span></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"><span class="doxyHighlight">                                    <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.phi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SourceTy = GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#a9fa1834df0fa59e97b016549cf8cf903">getSourceElementType</a>();</span></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We only handle arguments, constants, and static allocas here, so we can</span></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// insert GEPs at the end of the entry block.</span></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><span class="doxyHighlight">    IRB.SetInsertPoint(GEPI.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>().<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewGEP;</span></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> NI = NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ae9562b96f6f3fa41bd36538c080035ee">getBasicBlockIndex</a>(BB); NI &gt;= 0) &#123;</span></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><span class="doxyHighlight">        NewGEP = NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(NI);</span></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><span class="doxyHighlight">        SmallVector&lt;Value &#42;&gt; NewOps = GetNewOps(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><span class="doxyHighlight">        NewGEP =</span></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><span class="doxyHighlight">            IRB.CreateGEP(SourceTy, NewOps&#91;0&#93;, <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(NewOps).drop&#95;front(),</span></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.gep&quot;</span><span class="doxyHighlight">, GEPI.<a href="/docs/api/classes/llvm/getelementptrinst/#aebc354b6b8bd777fb2f1b952cf876bee">getNoWrapFlags</a>());</span></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><span class="doxyHighlight">      NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewGEP, BB);</span></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><span class="doxyHighlight">    Visited.erase(&amp;GEPI);</span></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><span class="doxyHighlight">    GEPI.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewPhi);</span></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><span class="doxyHighlight">    GEPI.<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><span class="doxyHighlight">    Visited.insert(NewPhi);</span></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><span class="doxyHighlight">    enqueueUsers(&#42;NewPhi);</span></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          to: &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><span class="doxyHighlight">               </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;In</span></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><span class="doxyHighlight">                    : NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()) <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n              &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;In;</span></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n              &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewPhi &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitGetElementPtrInst(GetElementPtrInst &amp;GEPI) &#123;</span></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (unfoldGEPSelect(GEPI))</span></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (unfoldGEPPhi(GEPI))</span></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164"><span class="doxyHighlight">    enqueueUsers(GEPI);</span></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitPHINode(PHINode &amp;PN) &#123;</span></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><span class="doxyHighlight">    enqueueUsers(PN);</span></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> visitSelectInst(SelectInst &amp;SI) &#123;</span></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><span class="doxyHighlight">    enqueueUsers(SI);</span></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><span class="doxyHighlightComment">/// Strip aggregate type wrapping.</span></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><span class="doxyHighlightComment">/// This removes no-op aggregate types wrapping an underlying type. It will</span></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><span class="doxyHighlightComment">/// strip as many layers of types as it can without changing either the type</span></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><span class="doxyHighlightComment">/// size or the allocated size.</span></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186" lineLink="#a29482246d1f1d9699e0a4786aafad1de"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="#a29482246d1f1d9699e0a4786aafad1de">stripAggregateTypeWrapping</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isSingleValueType())</span></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Ty;</span></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><span class="doxyHighlight">  uint64&#95;t AllocSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(Ty).getFixedValue();</span></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/classes/llvm/typesize">TypeSize</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(Ty).getFixedValue();</span></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;InnerTy;</span></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/arraytype">ArrayType</a> &#42;ArrTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ArrayType&gt;</a>(Ty)) &#123;</span></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"><span class="doxyHighlight">    InnerTy = ArrTy-&gt;getElementType();</span></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;STy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(Ty)) &#123;</span></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/structlayout">StructLayout</a> &#42;SL = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getStructLayout(STy);</span></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Index = SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a331caeb70809f50e71528de06fba7b66">getElementContainingOffset</a>(0);</span></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><span class="doxyHighlight">    InnerTy = STy-&gt;getElementType(Index);</span></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Ty;</span></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocSize &gt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(InnerTy).getFixedValue() ||</span></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/typesize">TypeSize</a> &gt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(InnerTy).getFixedValue())</span></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Ty;</span></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a29482246d1f1d9699e0a4786aafad1de">stripAggregateTypeWrapping</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, InnerTy);</span></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><span class="doxyHighlightComment">/// Try to find a partition of the aggregate type passed in for a given</span></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><span class="doxyHighlightComment">/// offset and size.</span></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><span class="doxyHighlightComment">/// This recurses through the aggregate type and tries to compute a subtype</span></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><span class="doxyHighlightComment">/// based on the offset and size. When the offset and size span a sub-section</span></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><span class="doxyHighlightComment">/// of an array, it will even compute a new array type for that sub-section,</span></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"><span class="doxyHighlightComment">/// and the same for structs.</span></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><span class="doxyHighlightComment">/// Note that this routine is very strict and tries to find a partition of the</span></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><span class="doxyHighlightComment">/// type which produces the &#42;exact&#42; right offset and size. It is not forgiving</span></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><span class="doxyHighlightComment">/// when the size or offset cause either end of type-based partition to be off.</span></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><span class="doxyHighlightComment">/// Also, this is a best-effort routine. It is reasonable to give up and not</span></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><span class="doxyHighlightComment">/// return a type if necessary.</span></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224" lineLink="#ad866ad1da941867a398da262103469b1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="#ad866ad1da941867a398da262103469b1">getTypePartition</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><span class="doxyHighlight">                              uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>) &#123;</span></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> == 0 &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(Ty).getFixedValue() == <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a29482246d1f1d9699e0a4786aafad1de">stripAggregateTypeWrapping</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Ty);</span></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(Ty).getFixedValue() ||</span></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><span class="doxyHighlight">      (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(Ty).getFixedValue() - <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &lt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ArrayType&gt;</a>(Ty) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Ty)) &#123;</span></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementTy;</span></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><span class="doxyHighlight">    uint64&#95;t TyNumElements;</span></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AT = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ArrayType&gt;</a>(Ty)) &#123;</span></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><span class="doxyHighlight">      ElementTy = AT-&gt;getElementType();</span></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><span class="doxyHighlight">      TyNumElements = AT-&gt;getNumElements();</span></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: This isn&#39;t right for vectors with non-byte-sized or</span></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// non-power-of-two sized elements.</span></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VT = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(Ty);</span></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><span class="doxyHighlight">      ElementTy = VT-&gt;getElementType();</span></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><span class="doxyHighlight">      TyNumElements = VT-&gt;getNumElements();</span></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><span class="doxyHighlight">    uint64&#95;t ElementSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(ElementTy).getFixedValue();</span></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><span class="doxyHighlight">    uint64&#95;t NumSkippedElements = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> / ElementSize;</span></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumSkippedElements &gt;= TyNumElements)</span></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> -= NumSkippedElements &#42; ElementSize;</span></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First check if we need to recurse.</span></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; 0 || <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt; ElementSize) &#123;</span></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Bail if the partition ends in a different array element.</span></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>) &gt; ElementSize)</span></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Recurse through the element type trying to peel off offset bytes.</span></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ad866ad1da941867a398da262103469b1">getTypePartition</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ElementTy, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> == 0);</span></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> == ElementSize)</span></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a29482246d1f1d9699e0a4786aafad1de">stripAggregateTypeWrapping</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ElementTy);</span></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; ElementSize);</span></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><span class="doxyHighlight">    uint64&#95;t NumElements = <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> / ElementSize;</span></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumElements &#42; ElementSize != <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(ElementTy, NumElements);</span></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;STy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(Ty);</span></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!STy)</span></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/structlayout">StructLayout</a> &#42;SL = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getStructLayout(STy);</span></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a7ca2273f2f77565f65ba98039c69b3a8">getSizeInBits</a>().<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt;= SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a0b6603d0838e3b40bf5c0a403c0510f2">getSizeInBytes</a>())</span></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><span class="doxyHighlight">  uint64&#95;t EndOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EndOffset &gt; SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a0b6603d0838e3b40bf5c0a403c0510f2">getSizeInBytes</a>())</span></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Index = SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a331caeb70809f50e71528de06fba7b66">getElementContainingOffset</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> -= SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a3932cc53acb297750961bfdaa86425bc">getElementOffset</a>(Index);</span></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementTy = STy-&gt;<a href="/docs/api/classes/llvm/structtype/#aee3c78d73273cb8449cd10cc15edcb83">getElementType</a>(Index);</span></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><span class="doxyHighlight">  uint64&#95;t ElementSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(ElementTy).getFixedValue();</span></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt;= ElementSize)</span></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// The offset points into alignment padding.</span></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if any partition must be contained by the element.</span></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; 0 || <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt; ElementSize) &#123;</span></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>) &gt; ElementSize)</span></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ad866ad1da941867a398da262103469b1">getTypePartition</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ElementTy, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> == 0);</span></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> == ElementSize)</span></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a29482246d1f1d9699e0a4786aafad1de">stripAggregateTypeWrapping</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ElementTy);</span></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype/#aef631c67bbe94f9b5a7b9a1292bf225f">StructType::element&#95;iterator</a> EI = STy-&gt;<a href="/docs/api/classes/llvm/structtype/#a69c7da4aea6df614c83c075aa246261a">element&#95;begin</a>() + Index,</span></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><span class="doxyHighlight">                               EE = STy-&gt;<a href="/docs/api/classes/llvm/structtype/#a1d854d7ca4568e7840af5520a9012960">element&#95;end</a>();</span></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EndOffset &lt; SL-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/memoryopremark-cpp/#a9e9c273c28528353a24278da12f4b7f3">getSizeInBytes</a>()) &#123;</span></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIndex = SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a331caeb70809f50e71528de06fba7b66">getElementContainingOffset</a>(EndOffset);</span></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Index == EndIndex)</span></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Within a single element and its padding.</span></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t try to form &quot;natural&quot; types if the elements don&#39;t line up with the</span></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// expected size.</span></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: We could potentially recurse down through the last element in the</span></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sub-struct to find a natural end point.</span></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a3932cc53acb297750961bfdaa86425bc">getElementOffset</a>(EndIndex) != EndOffset)</span></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Index &lt; EndIndex);</span></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><span class="doxyHighlight">    EE = STy-&gt;<a href="/docs/api/classes/llvm/structtype/#a69c7da4aea6df614c83c075aa246261a">element&#95;begin</a>() + EndIndex;</span></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to build up a sub-structure.</span></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;SubTy =</span></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/structtype/#a18fc4545474c6ebb6f7c547f64f4fb31">StructType::get</a>(STy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>(EI, EE), STy-&gt;<a href="/docs/api/classes/llvm/structtype/#a84b61ef997688651dd4e06cb7567cfed">isPacked</a>());</span></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/structlayout">StructLayout</a> &#42;SubSL = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getStructLayout(SubTy);</span></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> != SubSL-&gt;<a href="/docs/api/classes/llvm/structlayout/#a0b6603d0838e3b40bf5c0a403c0510f2">getSizeInBytes</a>())</span></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// The sub-struct doesn&#39;t have quite the size needed.</span></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SubTy;</span></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><span class="doxyHighlightComment">/// Pre-split loads and stores to simplify rewriting.</span></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><span class="doxyHighlightComment">/// We want to break up the splittable load+store pairs as much as</span></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><span class="doxyHighlightComment">/// possible. This is important to do as a preprocessing step, as once we</span></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><span class="doxyHighlightComment">/// start rewriting the accesses to partitions of the alloca we lose the</span></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><span class="doxyHighlightComment">/// necessary information to correctly split apart paired loads and stores</span></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><span class="doxyHighlightComment">/// which both point into this alloca. The case to consider is something like</span></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><span class="doxyHighlightComment">/// the following:</span></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><span class="doxyHighlightComment">///   %a = alloca &#91;12 x i8&#93;</span></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><span class="doxyHighlightComment">///   %gep1 = getelementptr i8, ptr %a, i32 0</span></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><span class="doxyHighlightComment">///   %gep2 = getelementptr i8, ptr %a, i32 4</span></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><span class="doxyHighlightComment">///   %gep3 = getelementptr i8, ptr %a, i32 8</span></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><span class="doxyHighlightComment">///   store float 0.0, ptr %gep1</span></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"><span class="doxyHighlightComment">///   store float 1.0, ptr %gep2</span></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><span class="doxyHighlightComment">///   %v = load i64, ptr %gep1</span></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><span class="doxyHighlightComment">///   store i64 %v, ptr %gep2</span></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><span class="doxyHighlightComment">///   %f1 = load float, ptr %gep2</span></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><span class="doxyHighlightComment">///   %f2 = load float, ptr %gep3</span></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><span class="doxyHighlightComment">/// Here we want to form 3 partitions of the alloca, each 4 bytes large, and</span></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><span class="doxyHighlightComment">/// promote everything so we recover the 2 SSA values that should have been</span></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><span class="doxyHighlightComment">/// there all along.</span></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><span class="doxyHighlightComment">/// \\returns true if any changes are made.</span></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SROA::presplitLoadsAndStores(AllocaInst &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS) &#123;</span></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Pre-splitting loads and stores\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Track the loads and stores which are candidates for pre-splitting here, in</span></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the order they first appear during the partition scan. These give stable</span></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iteration order and a basis for tracking which loads and stores we</span></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// actually split.</span></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><span class="doxyHighlight">  SmallVector&lt;LoadInst &#42;, 4&gt; Loads;</span></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;StoreInst &#42;, 4&gt;</a> Stores;</span></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to accumulate the splits required of each load or store where we</span></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can find them via a direct lookup. This is important to cross-check loads</span></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and stores against each other. We also track the slice so that we can kill</span></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all the slices that end up split.</span></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">SplitOffsets &#123;</span></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"><span class="doxyHighlight">    Slice &#42;S;</span></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><span class="doxyHighlight">    std::vector&lt;uint64&#95;t&gt; Splits;</span></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><span class="doxyHighlight">  SmallDenseMap&lt;Instruction &#42;, SplitOffsets, 8&gt; SplitOffsetsMap;</span></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Track loads out of this alloca which cannot, for any reason, be pre-split.</span></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is important as we also cannot pre-split stores of those loads!</span></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This is all pretty gross. It means that we can be more aggressive</span></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in pre-splitting when the load feeding the store happens to come from</span></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a separate alloca. Put another way, the effectiveness of SROA would be</span></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// decreased by a frontend which just concatenated all of its local allocas</span></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into one big flat alloca. But defeating such patterns is exactly the job</span></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SROA is tasked with! Sadly, to not have this discrepancy we would have</span></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// change store pre-splitting to actually force pre-splitting of the load</span></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that feeds it &#42;and all stores&#42;. That makes pre-splitting much harder, but</span></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// maybe it would make it more principled?</span></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><span class="doxyHighlight">  SmallPtrSet&lt;LoadInst &#42;, 8&gt; UnsplittableLoads;</span></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Searching for candidate loads and stores\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : AS.partitions()) &#123;</span></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &amp;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</span></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(S.getUse()-&gt;getUser());</span></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.isSplittable() || S.endOffset() &lt;= <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset()) &#123;</span></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this is a load we have to track that it can&#39;t participate in any</span></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// pre-splitting. If this is a store of a load we have to track that</span></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// that load also can&#39;t participate in any pre-splitting.</span></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><span class="doxyHighlight">          UnsplittableLoads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(LI);</span></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand()))</span></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><span class="doxyHighlight">            UnsplittableLoads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(LI);</span></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset() &gt; S.beginOffset() &amp;&amp;</span></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Empty or backwards partition!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Determine if this is a pre-splittable slice.</span></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Cannot split volatile loads!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The load must be used exclusively to store into other pointers for</span></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// us to be able to arbitrarily pre-split it. The stores must also be</span></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// simple to avoid changing semantics.</span></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsLoadSimplyStored = &#91;&#93;(LoadInst &#42;LI) &#123;</span></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;LU : LI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(LU);</span></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SI || !<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;isSimple())</span></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsLoadSimplyStored(LI)) &#123;</span></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><span class="doxyHighlight">          UnsplittableLoads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(LI);</span></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><span class="doxyHighlight">        Loads.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LI);</span></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.getUse() != &amp;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperandUse(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerOperandIndex()))</span></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Skip stores &#42;of&#42; pointers. FIXME: This shouldn&#39;t even be possible!</span></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StoredLoad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StoredLoad || !StoredLoad-&gt;isSimple())</span></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;isVolatile() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Cannot split volatile stores!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><span class="doxyHighlight">        Stores.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SI);</span></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Other uses cannot be pre-split.</span></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record the initial split.</span></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Candidate: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a> = SplitOffsetsMap&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.empty() &amp;&amp;</span></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Should not have splits the first time we see an instruction!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S = &amp;S;</span></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.push&#95;back(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset() - S.beginOffset());</span></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now scan the already split slices, and add a split for any of them which</span></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we&#39;re going to pre-split.</span></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &#42;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.splitSliceTails()) &#123;</span></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SplitOffsetsMapI =</span></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><span class="doxyHighlight">          SplitOffsetsMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(S-&gt;getUse()-&gt;getUser()));</span></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SplitOffsetsMapI == SplitOffsetsMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a> = SplitOffsetsMapI-&gt;second;</span></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S == S &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Found a mismatched slice!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.empty() &amp;&amp;</span></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Cannot have an empty set of splits on the second partition!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.back() ==</span></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset() - <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;beginOffset() &amp;&amp;</span></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Previous split does not end where this one begins!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Record each split. The last partition&#39;s end isn&#39;t needed as the size</span></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of the slice dictates that.</span></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S-&gt;endOffset() &gt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset())</span></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.push&#95;back(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset() - <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;beginOffset());</span></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We may have split loads where some of their stores are split stores. For</span></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// such loads and stores, we can only pre-split them if their splits exactly</span></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// match relative to their starting offset. We have to verify this prior to</span></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any rewriting.</span></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(Stores, &#91;&amp;UnsplittableLoads, &amp;SplitOffsetsMap&#93;(StoreInst &#42;SI) &#123;</span></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Lookup the load we are storing in our map of split</span></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// offsets.</span></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If it was completely unsplittable, then we&#39;re done,</span></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and this store can&#39;t be pre-split.</span></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnsplittableLoads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(LI))</span></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LoadOffsetsI = SplitOffsetsMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(LI);</span></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadOffsetsI == SplitOffsetsMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Unrelated loads are definitely safe.</span></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LoadOffsets = LoadOffsetsI-&gt;second;</span></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now lookup the store&#39;s offsets.</span></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;StoreOffsets = SplitOffsetsMap&#91;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>&#93;;</span></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the relative offsets of each split in the load and</span></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// store match exactly, then we can split them and we</span></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// don&#39;t need to remove them here.</span></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadOffsets.Splits == StoreOffsets.Splits)</span></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Mismatched splits for load and store:\\n&quot;</span></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;LI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;ve found a store and load that we need to split</span></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with mismatched relative splits. Just give up on them</span></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and remove both instructions from our list of</span></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// candidates.</span></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><span class="doxyHighlight">    UnsplittableLoads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(LI);</span></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we have to go &#42;back&#42; through all the stores, because a later store may</span></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have caused an earlier store&#39;s load to become unsplittable and if it is</span></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unsplittable for the later store, then we can&#39;t rely on it being split in</span></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the earlier store either.</span></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(Stores, &#91;&amp;UnsplittableLoads&#93;(StoreInst &#42;SI) &#123;</span></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UnsplittableLoads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(LI);</span></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Once we&#39;ve established all the loads that can&#39;t be split for some reason,</span></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// filter any that made it into our list out.</span></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(Loads, &#91;&amp;UnsplittableLoads&#93;(LoadInst &#42;LI) &#123;</span></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UnsplittableLoads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(LI);</span></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If no loads or stores are left, there is no pre-splitting to be done for</span></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this alloca.</span></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Loads.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; Stores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// From here on, we can&#39;t fail and will be building new accesses, so rig up</span></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// an IR builder.</span></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> IRB(&amp;AI);</span></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the new slices which we will merge into the alloca slices.</span></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Slice, 4&gt;</a> NewSlices;</span></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Track any allocas we end up splitting loads and stores for so we iterate</span></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// on them.</span></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><span class="doxyHighlight">  SmallPtrSet&lt;AllocaInst &#42;, 4&gt; ResplitPromotableAllocas;</span></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point, we have collected all of the loads and stores we can</span></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pre-split, and the specific splits needed for them. We actually do the</span></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// splitting in a specific order in order to handle when one of the loads in</span></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the value operand to one of the stores.</span></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, we rewrite all of the split loads, and just accumulate each split</span></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load in a parallel structure. We also build the slices for them and append</span></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them to the alloca slices.</span></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><span class="doxyHighlight">  SmallDenseMap&lt;LoadInst &#42;, std::vector&lt;LoadInst &#42;&gt;, 1&gt; SplitLoadsMap;</span></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><span class="doxyHighlight">  std::vector&lt;LoadInst &#42;&gt; SplitLoads;</span></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = AI.<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (LoadInst &#42;LI : Loads) &#123;</span></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><span class="doxyHighlight">    SplitLoads.clear();</span></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a> = SplitOffsetsMap&#91;LI&#93;;</span></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SliceSize = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;endOffset() - <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;beginOffset();</span></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() % 8 == 0 &amp;&amp;</span></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Load must have type size equal to store size&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() / 8 &gt;= SliceSize &amp;&amp;</span></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Load must be &gt;= slice size&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><span class="doxyHighlight">    uint64&#95;t BaseOffset = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;beginOffset();</span></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BaseOffset + SliceSize &gt; BaseOffset &amp;&amp;</span></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot represent alloca access size using 64-bit integers!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/codeview/#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">BasePtr</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>());</span></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"><span class="doxyHighlight">    IRB.SetInsertPoint(LI);</span></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Splitting load: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;LI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><span class="doxyHighlight">    uint64&#95;t PartOffset = 0, PartSize = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.front();</span></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = 0, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.size();</span></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (;;) &#123;</span></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PartTy = Type::getIntNTy(LI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), PartSize &#42; 8);</span></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AS = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PartPtrTy = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a945c21ff70f310de538153db17e7b857">getPointerOperandType</a>();</span></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><span class="doxyHighlight">      LoadInst &#42;PLoad = IRB.CreateAlignedLoad(</span></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><span class="doxyHighlight">          PartTy,</span></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><span class="doxyHighlight">          <a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(IRB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, BasePtr,</span></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"><span class="doxyHighlight">                         APInt(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexSizeInBits(AS), PartOffset),</span></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><span class="doxyHighlight">                         PartPtrTy, <a href="/docs/api/namespaces/llvm/codeview/#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">BasePtr</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><span class="doxyHighlight">          <a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a>(LI, PartOffset),</span></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;IsVolatile&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, LI-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"><span class="doxyHighlight">      PLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;LI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><span class="doxyHighlight">                                LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Append this load onto the list of split loads so we can find it later</span></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to rewrite the stores.</span></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><span class="doxyHighlight">      SplitLoads.push&#95;back(PLoad);</span></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Now build a new slice for the alloca.</span></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><span class="doxyHighlight">      NewSlices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><span class="doxyHighlight">          Slice(BaseOffset + PartOffset, BaseOffset + PartOffset + PartSize,</span></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><span class="doxyHighlight">                &amp;PLoad-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(PLoad-&gt;<a href="/docs/api/classes/llvm/loadinst/#a976e49f35fef77df271900abfdc42cd5">getPointerOperandIndex</a>()),</span></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">/&#42;IsSplittable&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    new slice &#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; NewSlices.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().beginOffset()</span></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight"> &lt;&lt; NewSlices.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().endOffset()</span></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;): &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PLoad &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// See if we&#39;ve handled all the splits.</span></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx &gt;= <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Setup the next partition.</span></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><span class="doxyHighlight">      PartOffset = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits&#91;Idx&#93;;</span></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><span class="doxyHighlight">      ++Idx;</span></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><span class="doxyHighlight">      PartSize = (Idx &lt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> ? <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits&#91;Idx&#93; : SliceSize) - PartOffset;</span></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now that we have the split loads, do the slow walk over all uses of the</span></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// load and rewrite them as split stores, or save the split loads to use</span></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// below if the store is going to be split there anyways.</span></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DeferredStores = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;LU : LI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><span class="doxyHighlight">      StoreInst &#42;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(LU);</span></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Stores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; SplitOffsetsMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SI)) &#123;</span></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><span class="doxyHighlight">        DeferredStores = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Deferred splitting of store: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SI</span></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;StoreBasePtr = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerOperand();</span></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><span class="doxyHighlight">      IRB.SetInsertPoint(SI);</span></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"><span class="doxyHighlight">      AAMDNodes AATags = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getAAMetadata();</span></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    Splitting store of load: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = 0, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = SplitLoads.size(); Idx &lt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>; ++Idx) &#123;</span></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><span class="doxyHighlight">        LoadInst &#42;PLoad = SplitLoads&#91;Idx&#93;;</span></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><span class="doxyHighlight">        uint64&#95;t PartOffset = Idx == 0 ? 0 : <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits&#91;Idx - 1&#93;;</span></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PartPtrTy = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerOperandType();</span></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"><span class="doxyHighlight">        StoreInst &#42;PStore = IRB.CreateAlignedStore(</span></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"><span class="doxyHighlight">            PLoad,</span></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><span class="doxyHighlight">            <a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(IRB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, StoreBasePtr,</span></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><span class="doxyHighlight">                           APInt(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexSizeInBits(AS), PartOffset),</span></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><span class="doxyHighlight">                           PartPtrTy, StoreBasePtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"><span class="doxyHighlight">            <a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a>(SI, PartOffset),</span></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">/&#42;IsVolatile&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"><span class="doxyHighlight">        PStore-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;SI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><span class="doxyHighlight">                                   LLVMContext::MD&#95;access&#95;group,</span></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"><span class="doxyHighlight">                                   LLVMContext::MD&#95;DIAssignID&#125;);</span></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"><span class="doxyHighlight">          PStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(</span></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"><span class="doxyHighlight">              AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a9c82bb8e10db405d4dd265c150fc52b9">adjustForAccess</a>(PartOffset, PLoad-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      +&quot;</span><span class="doxyHighlight"> &lt;&lt; PartOffset &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PStore &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We want to immediately iterate on any allocas impacted by splitting</span></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this store, and we have to track any promotable alloca (indicated by</span></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a direct store) as needing to be resplit because it is no longer</span></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// promotable.</span></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;OtherAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(StoreBasePtr)) &#123;</span></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><span class="doxyHighlight">        ResplitPromotableAllocas.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OtherAI);</span></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><span class="doxyHighlight">        Worklist.insert(OtherAI);</span></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;OtherAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(</span></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><span class="doxyHighlight">                     StoreBasePtr-&gt;<a href="/docs/api/classes/llvm/value/#a3ed745230c0e6c52f4b1ec0dae8c07fb">stripInBoundsOffsets</a>())) &#123;</span></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"><span class="doxyHighlight">        Worklist.insert(OtherAI);</span></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark the original store as dead.</span></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><span class="doxyHighlight">      DeadInsts.push&#95;back(SI);</span></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the split loads if there are deferred stores among the users.</span></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DeferredStores)</span></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"><span class="doxyHighlight">      SplitLoadsMap.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(LI, std::move(SplitLoads)));</span></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark the original load as dead and kill the original slice.</span></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676"><span class="doxyHighlight">    DeadInsts.push&#95;back(LI);</span></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;kill();</span></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Second, we rewrite all of the split stores. At this point, we know that</span></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all loads from this alloca have been split already. For stores of such</span></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loads, we can simply look up the pre-existing split loads. For stores of</span></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other loads, we split those loads first and then write split stores of</span></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them.</span></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (StoreInst &#42;SI : Stores) &#123;</span></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"><span class="doxyHighlight">    IntegerType &#42;Ty = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;<a href="/docs/api/classes/llvm/integertype/#a90b790ccb1af4ea5ccd69db4b8cd2d81">getBitWidth</a>() % 8 == 0);</span></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"><span class="doxyHighlight">    uint64&#95;t StoreSize = Ty-&gt;<a href="/docs/api/classes/llvm/integertype/#a90b790ccb1af4ea5ccd69db4b8cd2d81">getBitWidth</a>() / 8;</span></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StoreSize &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Cannot have a zero-sized integer store!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a> = SplitOffsetsMap&#91;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>&#93;;</span></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StoreSize == <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;endOffset() - <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;beginOffset() &amp;&amp;</span></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Slice size should always match load size exactly!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><span class="doxyHighlight">    uint64&#95;t BaseOffset = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;beginOffset();</span></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BaseOffset + StoreSize &gt; BaseOffset &amp;&amp;</span></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot represent alloca access size using 64-bit integers!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LoadBasePtr = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</span></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;StoreBasePtr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Splitting store: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check whether we have an already split load.</span></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SplitLoadsMapI = SplitLoadsMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(LI);</span></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"><span class="doxyHighlight">    std::vector&lt;LoadInst &#42;&gt; &#42;SplitLoads = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SplitLoadsMapI != SplitLoadsMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"><span class="doxyHighlight">      SplitLoads = &amp;SplitLoadsMapI-&gt;second;</span></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SplitLoads-&gt;size() == <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.size() + 1 &amp;&amp;</span></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Too few split loads for the number of splits in the store!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;          of load: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;LI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"><span class="doxyHighlight">    uint64&#95;t PartOffset = 0, PartSize = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.front();</span></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = 0, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits.size();</span></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (;;) &#123;</span></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PartTy = Type::getIntNTy(Ty-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), PartSize &#42; 8);</span></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoadPartPtrTy = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a945c21ff70f310de538153db17e7b857">getPointerOperandType</a>();</span></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StorePartPtrTy = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerOperandType();</span></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Either lookup a split load or create one.</span></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><span class="doxyHighlight">      LoadInst &#42;PLoad;</span></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SplitLoads) &#123;</span></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"><span class="doxyHighlight">        PLoad = (&#42;SplitLoads)&#91;Idx&#93;;</span></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"><span class="doxyHighlight">        IRB.SetInsertPoint(LI);</span></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AS = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"><span class="doxyHighlight">        PLoad = IRB.CreateAlignedLoad(</span></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><span class="doxyHighlight">            PartTy,</span></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><span class="doxyHighlight">            <a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(IRB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, LoadBasePtr,</span></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"><span class="doxyHighlight">                           APInt(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexSizeInBits(AS), PartOffset),</span></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><span class="doxyHighlight">                           LoadPartPtrTy, LoadBasePtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><span class="doxyHighlight">            <a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a>(LI, PartOffset),</span></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">/&#42;IsVolatile&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, LI-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"><span class="doxyHighlight">        PLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;LI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"><span class="doxyHighlight">                                  LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// And store this partition.</span></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"><span class="doxyHighlight">      IRB.SetInsertPoint(SI);</span></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerAddressSpace();</span></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><span class="doxyHighlight">      StoreInst &#42;PStore = IRB.CreateAlignedStore(</span></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"><span class="doxyHighlight">          PLoad,</span></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><span class="doxyHighlight">          <a href="#a51c1effcc7b2215c922b2074c54d68a5">getAdjustedPtr</a>(IRB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, StoreBasePtr,</span></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"><span class="doxyHighlight">                         APInt(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexSizeInBits(AS), PartOffset),</span></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><span class="doxyHighlight">                         StorePartPtrTy, StoreBasePtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"><span class="doxyHighlight">          <a href="#a0c1779029e78ee6d643c3319b39e3ea8">getAdjustedAlignment</a>(SI, PartOffset),</span></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;IsVolatile&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><span class="doxyHighlight">      PStore-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;SI, &#123;LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</span></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><span class="doxyHighlight">                                 LLVMContext::MD&#95;access&#95;group&#125;);</span></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Now build a new slice for the alloca.</span></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"><span class="doxyHighlight">      NewSlices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><span class="doxyHighlight">          Slice(BaseOffset + PartOffset, BaseOffset + PartOffset + PartSize,</span></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"><span class="doxyHighlight">                &amp;PStore-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(PStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#add13b402166ae4d70f5b93c3c4cfba99">getPointerOperandIndex</a>()),</span></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">/&#42;IsSplittable&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    new slice &#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; NewSlices.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().beginOffset()</span></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight"> &lt;&lt; NewSlices.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().endOffset()</span></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;): &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PStore &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SplitLoads) &#123;</span></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      of split load: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PLoad &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// See if we&#39;ve finished all the splits.</span></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx &gt;= <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)</span></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Setup the next partition.</span></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><span class="doxyHighlight">      PartOffset = <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits&#91;Idx&#93;;</span></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><span class="doxyHighlight">      ++Idx;</span></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><span class="doxyHighlight">      PartSize = (Idx &lt; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> ? <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.Splits&#91;Idx&#93; : StoreSize) - PartOffset;</span></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We want to immediately iterate on any allocas impacted by splitting</span></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this load, which is only relevant if it isn&#39;t a load of this alloca and</span></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// thus we didn&#39;t already split the loads above. We also have to keep track</span></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of any promotable allocas we split loads on as they can no longer be</span></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// promoted.</span></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SplitLoads) &#123;</span></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;OtherAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(LoadBasePtr)) &#123;</span></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OtherAI != &amp;AI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We can&#39;t re-split our own alloca!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"><span class="doxyHighlight">        ResplitPromotableAllocas.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OtherAI);</span></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"><span class="doxyHighlight">        Worklist.insert(OtherAI);</span></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;OtherAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(</span></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786"><span class="doxyHighlight">                     LoadBasePtr-&gt;<a href="/docs/api/classes/llvm/value/#a3ed745230c0e6c52f4b1ec0dae8c07fb">stripInBoundsOffsets</a>())) &#123;</span></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OtherAI != &amp;AI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We can&#39;t re-split our own alloca!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"><span class="doxyHighlight">        Worklist.insert(OtherAI);</span></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark the original store as dead now that we&#39;ve split it up and kill its</span></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// slice. Note that we leave the original load in place unless this store</span></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// was its only use. It may in turn be split up if it is an alloca load</span></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for some other alloca, but it may be a normal load. This may introduce</span></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// redundant loads, but where those can be merged the rest of the optimizer</span></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// should handle the merging, and this uncovers SSA splits which is more</span></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// important. In practice, the original loads will almost always be fully</span></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// split and removed eventually, and the splits will be merged by any</span></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trivial CSE, including instcombine.</span></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&#42;LI-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>() == SI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Single use isn&#39;t this store!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><span class="doxyHighlight">      DeadInsts.push&#95;back(LI);</span></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"><span class="doxyHighlight">    DeadInsts.push&#95;back(SI);</span></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si/kernelinputoffsets/#a58b4eae4b0a45d478c7c0f3959b04612">Offsets</a>.S-&gt;kill();</span></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the killed slices that have ben pre-split.</span></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(AS, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Slice &amp;S) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> S.isDead(); &#125;);</span></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert our new slices. This will sort and merge them into the sorted</span></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sequence.</span></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><span class="doxyHighlight">  AS.insert(NewSlices);</span></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Pre-split slices:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = AS.begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = AS.end(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(AS.print(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightStringLiteral">&quot;    &quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, don&#39;t try to promote any allocas that new require re-splitting.</span></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// They have already been added to the worklist above.</span></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"><span class="doxyHighlight">  PromotableAllocas.set&#95;subtract(ResplitPromotableAllocas);</span></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><span class="doxyHighlightComment">/// Rewrite an alloca partition&#39;s users.</span></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"><span class="doxyHighlightComment">/// This routine drives both of the rewriting goals of the SROA pass. It tries</span></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"><span class="doxyHighlightComment">/// to rewrite uses of an alloca partition to be conducive for SSA value</span></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><span class="doxyHighlightComment">/// promotion. If the partition needs a new, more refined alloca, this will</span></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><span class="doxyHighlightComment">/// build that new alloca, preserving as much type information as possible, and</span></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><span class="doxyHighlightComment">/// rewrite the uses of the old alloca to point at the new one and have the</span></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><span class="doxyHighlightComment">/// appropriate new offsets. It also evaluates how successful the rewrite was</span></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><span class="doxyHighlightComment">/// at enabling promotion and if it was successful queues the alloca to be</span></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"><span class="doxyHighlightComment">/// promoted.</span></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><span class="doxyHighlight">AllocaInst &#42;SROA::rewritePartition(AllocaInst &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS,</span></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840"><span class="doxyHighlight">                                   <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/partition">Partition</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</span></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to compute a friendly type for this partition of the alloca. This</span></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// won&#39;t always succeed, in which case we fall back to a legal integer type</span></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or an i8 array of an appropriate size.</span></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SliceTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30ba554dbd7b42f5e21acdc8a1d86120e53c">VectorType</a> &#42;SliceVecTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = AI.<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"><span class="doxyHighlight">  std::pair&lt;Type &#42;, IntegerType &#42;&gt; CommonUseTy =</span></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><span class="doxyHighlight">      <a href="#a25781ba284c79cb93c65fd0c529ebf7c">findCommonType</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.begin(), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.end(), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset());</span></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do all uses operate on the same type?</span></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonUseTy.first)</span></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(CommonUseTy.first).getFixedValue() &gt;= <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#adbff55f335d303816547f35eb6edb948">size</a>()) &#123;</span></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><span class="doxyHighlight">      SliceTy = CommonUseTy.first;</span></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"><span class="doxyHighlight">      SliceVecTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(SliceTy);</span></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If not, can we find an appropriate subtype in the original allocated type?</span></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SliceTy)</span></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TypePartitionTy = <a href="#ad866ad1da941867a398da262103469b1">getTypePartition</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(),</span></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><span class="doxyHighlight">                                                 <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset(), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.size()))</span></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"><span class="doxyHighlight">      SliceTy = TypePartitionTy;</span></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If still not, can we use the largest bitwidth integer type used?</span></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SliceTy &amp;&amp; CommonUseTy.second)</span></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(CommonUseTy.second).getFixedValue() &gt;= <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#adbff55f335d303816547f35eb6edb948">size</a>()) &#123;</span></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864"><span class="doxyHighlight">      SliceTy = CommonUseTy.second;</span></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"><span class="doxyHighlight">      SliceVecTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(SliceTy);</span></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!SliceTy || (SliceTy-&gt;<a href="/docs/api/classes/llvm/type/#a2a394517076e7dd2bdcd7dde33dfcb7d">isArrayTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><span class="doxyHighlight">                    SliceTy-&gt;<a href="/docs/api/classes/llvm/type/#a3fb19a71e602dce8ff646c3ac2f4ca0f">getArrayElementType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>())) &amp;&amp;</span></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isLegalInteger(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.size() &#42; 8)) &#123;</span></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><span class="doxyHighlight">    SliceTy = Type::getIntNTy(&#42;C, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.size() &#42; 8);</span></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the common use types are not viable for promotion then attempt to find</span></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// another type that is viable.</span></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SliceVecTy &amp;&amp; !<a href="#a73ce9bc74349e7599dd4ae32a091ede7">checkVectorTypeForPromotion</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, SliceVecTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TypePartitionTy = <a href="#ad866ad1da941867a398da262103469b1">getTypePartition</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(),</span></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"><span class="doxyHighlight">                                                 <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset(), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.size())) &#123;</span></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30ba554dbd7b42f5e21acdc8a1d86120e53c">VectorType</a> &#42;TypePartitionVecTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(TypePartitionTy);</span></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TypePartitionVecTy &amp;&amp;</span></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><span class="doxyHighlight">          <a href="#a73ce9bc74349e7599dd4ae32a091ede7">checkVectorTypeForPromotion</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, TypePartitionVecTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"><span class="doxyHighlight">        SliceTy = TypePartitionTy;</span></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SliceTy)</span></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"><span class="doxyHighlight">    SliceTy = ArrayType::get(Type::getInt8Ty(&#42;C), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.size());</span></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(SliceTy).getFixedValue() &gt;= <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#adbff55f335d303816547f35eb6edb948">size</a>());</span></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887"></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsIntegerPromotable = <a href="#a7fd9ee96f281dd94ed4119c2e45836bf">isIntegerWideningViable</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, SliceTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30ba554dbd7b42f5e21acdc8a1d86120e53c">VectorType</a> &#42;VecTy =</span></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"><span class="doxyHighlight">      IsIntegerPromotable ? nullptr : <a href="#af6735614e085435a0f3bb90aab527213">isVectorPromotionViable</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecTy)</span></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><span class="doxyHighlight">    SliceTy = VecTy;</span></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for the case where we&#39;re going to rewrite to a new alloca of the</span></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exact same type as the original, and with the same access offsets. In that</span></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case, re-use the existing alloca, but still run through the rewriter to</span></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// perform phi and select speculation.</span></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// P.beginOffset() can be non-zero even with the same type in a case with</span></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// out-of-bounds access (e.g. @PR35657 function in SROA/basictest.ll).</span></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"><span class="doxyHighlight">  AllocaInst &#42;NewAI;</span></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SliceTy == AI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>() &amp;&amp; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset() == 0) &#123;</span></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><span class="doxyHighlight">    NewAI = &amp;AI;</span></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: We should be able to bail at this point with &quot;nothing changed&quot;.</span></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: We might want to defer PHI speculation until after here.</span></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: return nullptr;</span></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure the alignment is compatible with P.beginOffset().</span></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(AI.<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset());</span></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we will get at least this much alignment from the type alone, leave</span></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the alloca&#39;s alignment unconstrained.</span></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUnconstrained = Alignment &lt;= <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getABITypeAlign(SliceTy);</span></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><span class="doxyHighlight">    NewAI = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> AllocaInst(</span></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"><span class="doxyHighlight">        SliceTy, AI.<a href="/docs/api/classes/llvm/allocainst/#ad2fb148dfac3182fce33be95fc4e9159">getAddressSpace</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"><span class="doxyHighlight">        IsUnconstrained ? <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPrefTypeAlign(SliceTy) : Alignment,</span></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><span class="doxyHighlight">        AI.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.sroa.&quot;</span><span class="doxyHighlight"> + Twine(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.begin() - AS.begin()),</span></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"><span class="doxyHighlight">        AI.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Copy the old AI debug location over to the new one.</span></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><span class="doxyHighlight">    NewAI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(AI.<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><span class="doxyHighlight">    ++NumNewAllocas;</span></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Rewriting alloca partition &quot;</span><span class="doxyHighlight"> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset()</span></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;,&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;) to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewAI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Track the high watermark on the worklist as it is only relevant for</span></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// promoted allocas. We will reset it to this point if the alloca is not in</span></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fact scheduled for promotion.</span></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PPWOldSize = PostPromotionWorklist.size();</span></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumUses = 0;</span></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"><span class="doxyHighlight">  SmallSetVector&lt;PHINode &#42;, 8&gt; PHIUsers;</span></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><span class="doxyHighlight">  SmallSetVector&lt;SelectInst &#42;, 8&gt; SelectUsers;</span></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#a79522441dc59c0a101a4e208abdf855a">AllocaSliceRewriter</a> <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AS, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, AI, &#42;NewAI, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.beginOffset(),</span></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><span class="doxyHighlight">                               <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.endOffset(), IsIntegerPromotable, VecTy,</span></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"><span class="doxyHighlight">                               PHIUsers, SelectUsers);</span></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Promotable = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &#42;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.splitSliceTails()) &#123;</span></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><span class="doxyHighlight">    Promotable &amp;= <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.visit(S);</span></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><span class="doxyHighlight">    ++NumUses;</span></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &amp;S : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</span></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><span class="doxyHighlight">    Promotable &amp;= <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.visit(&amp;S);</span></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"><span class="doxyHighlight">    ++NumUses;</span></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"><span class="doxyHighlight">  NumAllocaPartitionUses += NumUses;</span></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"><span class="doxyHighlight">  MaxUsesPerAllocaPartition.updateMax(NumUses);</span></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we&#39;ve processed all the slices in the new partition, check if any</span></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHIs or Selects would block promotion.</span></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : PHIUsers)</span></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aab37469c4748a495736ad163ac54e776">isSafePHIToSpeculate</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)) &#123;</span></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><span class="doxyHighlight">      Promotable = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><span class="doxyHighlight">      PHIUsers.clear();</span></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"><span class="doxyHighlight">      SelectUsers.<a href="/docs/api/classes/llvm/setvector/#a9c50882381abd28ec385bec769b8928b">clear</a>();</span></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;std::pair&lt;SelectInst &#42;, RewriteableMemOps&gt;</a>, 2&gt;</span></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><span class="doxyHighlight">      NewSelectsToRewrite;</span></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"><span class="doxyHighlight">  NewSelectsToRewrite.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(SelectUsers.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>());</span></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (SelectInst &#42;Sel : SelectUsers) &#123;</span></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"><span class="doxyHighlight">    std::optional&lt;RewriteableMemOps&gt; <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a> =</span></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><span class="doxyHighlight">        isSafeSelectToSpeculate(&#42;Sel, PreserveCFG);</span></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>) &#123;</span></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><span class="doxyHighlight">      Promotable = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><span class="doxyHighlight">      PHIUsers.clear();</span></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><span class="doxyHighlight">      SelectUsers.clear();</span></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><span class="doxyHighlight">      NewSelectsToRewrite.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><span class="doxyHighlight">    NewSelectsToRewrite.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(std::make&#95;pair(Sel, &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>));</span></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Promotable) &#123;</span></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &#42;U : AS.getDeadUsesIfPromotable()) &#123;</span></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;get());</span></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"><span class="doxyHighlight">      Value::dropDroppableUse(&#42;U);</span></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldInst)</span></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(OldInst))</span></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"><span class="doxyHighlight">          DeadInsts.push&#95;back(OldInst);</span></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIUsers.empty() &amp;&amp; SelectUsers.empty()) &#123;</span></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Promote the alloca.</span></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"><span class="doxyHighlight">      PromotableAllocas.insert(NewAI);</span></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we have either PHIs or Selects to speculate, add them to those</span></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// worklists and re-queue the new alloca so that we promote in on the</span></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// next iteration.</span></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (PHINode &#42;PHIUser : PHIUsers)</span></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><span class="doxyHighlight">        SpeculatablePHIs.insert(PHIUser);</span></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"><span class="doxyHighlight">      SelectsToRewrite.reserve(SelectsToRewrite.size() +</span></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><span class="doxyHighlight">                               NewSelectsToRewrite.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;KV : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">llvm::make&#95;range</a>(</span></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"><span class="doxyHighlight">               std::make&#95;move&#95;iterator(NewSelectsToRewrite.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()),</span></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"><span class="doxyHighlight">               std::make&#95;move&#95;iterator(NewSelectsToRewrite.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>())))</span></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><span class="doxyHighlight">        SelectsToRewrite.insert(std::move(KV));</span></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><span class="doxyHighlight">      Worklist.insert(NewAI);</span></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Drop any post-promotion work items if promotion didn&#39;t happen.</span></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PostPromotionWorklist.size() &gt; PPWOldSize)</span></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"><span class="doxyHighlight">      PostPromotionWorklist.pop&#95;back();</span></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We couldn&#39;t promote and we didn&#39;t create a new partition, nothing</span></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// happened.</span></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewAI == &amp;AI)</span></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we can&#39;t promote the alloca, iterate on it to check for new</span></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// refinements exposed by splitting the current alloca. Don&#39;t iterate on an</span></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alloca which didn&#39;t actually change and didn&#39;t get promoted.</span></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><span class="doxyHighlight">    Worklist.insert(NewAI);</span></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewAI;</span></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><span class="doxyHighlightComment">// There isn&#39;t a shared interface to get the &quot;address&quot; parts out of a</span></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"><span class="doxyHighlightComment">// dbg.declare and dbg.assign, so provide some wrappers now for</span></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"><span class="doxyHighlightComment">// both debug intrinsics and records.</span></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023" lineLink="#a4a30a3fae601106b8b33c0871aa3069d"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a4a30a3fae601106b8b33c0871aa3069d">getAddress</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42;DVI) &#123;</span></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgAssignIntrinsic&gt;</a>(DVI))</span></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DAI-&gt;getAddress();</span></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgDeclareInst&gt;</a>(DVI)-&gt;getAddress();</span></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029" lineLink="#a6ba7848b8dd7159c151b8c53194cc44d"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a4a30a3fae601106b8b33c0871aa3069d">getAddress</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR) &#123;</span></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8b5e9ae479c5eea5e6d9179a0c203da1">getAddress</a>();</span></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033" lineLink="#a9852adb260b49ee49d3df79aa767f145"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9852adb260b49ee49d3df79aa767f145">isKillAddress</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42;DVI) &#123;</span></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgAssignIntrinsic&gt;</a>(DVI))</span></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DAI-&gt;isKillAddress();</span></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgDeclareInst&gt;</a>(DVI)-&gt;isKillLocation();</span></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039" lineLink="#a73ba5a0ae73c1f5de375603aa29818eb"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9852adb260b49ee49d3df79aa767f145">isKillAddress</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR) &#123;</span></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a1adb590f8f0ceed777898888ed5db7ac">getType</a>() == <a href="/docs/api/classes/llvm/dbgvariablerecord/#ae2c3391c27b9fa4f64f9ed1bdbbdea4ca185b7133db22230701a857c059360cc2">DbgVariableRecord::LocationType::Assign</a>)</span></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a2f1f03934ddcc92c01e8a83acaab39b2">isKillAddress</a>();</span></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a49495d1f6880c856ab33832442a9e000">isKillLocation</a>();</span></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045" lineLink="#acb9cb49df37f70129e1f44543ffa57a0"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;<a href="#acb9cb49df37f70129e1f44543ffa57a0">getAddressExpression</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42;DVI) &#123;</span></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgAssignIntrinsic&gt;</a>(DVI))</span></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DAI-&gt;getAddressExpression();</span></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgDeclareInst&gt;</a>(DVI)-&gt;getExpression();</span></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051" lineLink="#ad4fea0532db5a2d88aadc8ca450eba93"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;<a href="#acb9cb49df37f70129e1f44543ffa57a0">getAddressExpression</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR) &#123;</span></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a1adb590f8f0ceed777898888ed5db7ac">getType</a>() == <a href="/docs/api/classes/llvm/dbgvariablerecord/#ae2c3391c27b9fa4f64f9ed1bdbbdea4ca185b7133db22230701a857c059360cc2">DbgVariableRecord::LocationType::Assign</a>)</span></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#afa6b67c30dd439d0c3a04af3e81252e6">getAddressExpression</a>();</span></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8ec5a479378113fc24b647afa2f06ee5">getExpression</a>();</span></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><span class="doxyHighlightComment">/// Create or replace an existing fragment in a DIExpression with \\p Frag.</span></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><span class="doxyHighlightComment">/// If the expression already contains a DW&#95;OP&#95;LLVM&#95;extract&#95;bits&#95;&#91;sz&#93;ext</span></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"><span class="doxyHighlightComment">/// operation, add \\p BitExtractOffset to the offset part.</span></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"><span class="doxyHighlightComment">/// Returns the new expression, or nullptr if this fails (see details below).</span></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><span class="doxyHighlightComment">/// This function is similar to DIExpression::createFragmentExpression except</span></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><span class="doxyHighlightComment">/// for 3 important distinctions:</span></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"><span class="doxyHighlightComment">///   1 The new fragment isn&#39;t relative to an existing fragment.</span></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><span class="doxyHighlightComment">///   2 It assumes the computed location is a memory location. This means we</span></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><span class="doxyHighlightComment">///      don&#39;t need to perform checks that creating the fragment preserves the</span></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><span class="doxyHighlightComment">///      expression semantics.</span></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"><span class="doxyHighlightComment">///   3 Existing extract&#95;bits are modified independently of fragment changes</span></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><span class="doxyHighlightComment">///      using \\p BitExtractOffset. A change to the fragment offset or size</span></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"><span class="doxyHighlightComment">///      may affect a bit extract. But a bit extract offset can change</span></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"><span class="doxyHighlightComment">///      independently of the fragment dimensions.</span></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><span class="doxyHighlightComment">/// Returns the new expression, or nullptr if one couldn&#39;t be created.</span></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><span class="doxyHighlightComment">/// Ideally this is only used to signal that a bit-extract has become</span></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><span class="doxyHighlightComment">/// zero-sized (and thus the new debug record has no size and can be</span></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"><span class="doxyHighlightComment">/// dropped), however, it fails for other reasons too - see the FIXME below.</span></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><span class="doxyHighlightComment">/// FIXME: To keep the change that introduces this function NFC it bails</span></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><span class="doxyHighlightComment">/// in some situations unecessarily, e.g. when fragment and bit extract</span></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><span class="doxyHighlightComment">/// sizes differ.</span></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082" lineLink="#a4c75a6c6ed9dedc2ff52927972587023"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;<a href="#a4c75a6c6ed9dedc2ff52927972587023">createOrReplaceFragment</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;Expr,</span></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> Frag,</span></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><span class="doxyHighlight">                                             int64&#95;t BitExtractOffset) &#123;</span></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 8&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</span></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasFragment = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasBitExtract = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : Expr-&gt;<a href="/docs/api/classes/llvm/diexpression/#a040fc6238a02edb543766c9d9644d35f">expr&#95;ops</a>()) &#123;</span></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getOp() == <a href="/docs/api/namespaces/llvm/dwarf/#a78e9cb1527edb3cc1d1ee577257b5f0cac09e4cb866e5aa9bc0480359be9e7953">dwarf::DW&#95;OP&#95;LLVM&#95;fragment</a>) &#123;</span></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><span class="doxyHighlight">      HasFragment = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getOp() == <a href="/docs/api/namespaces/llvm/dwarf/#a78e9cb1527edb3cc1d1ee577257b5f0ca3d02f9a2d8b9066b6c6ef1a39018de7f">dwarf::DW&#95;OP&#95;LLVM&#95;extract&#95;bits&#95;zext</a> ||</span></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getOp() == <a href="/docs/api/namespaces/llvm/dwarf/#a78e9cb1527edb3cc1d1ee577257b5f0cafa8715d4f64791c3f0b479ececa39d34">dwarf::DW&#95;OP&#95;LLVM&#95;extract&#95;bits&#95;sext</a>) &#123;</span></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"><span class="doxyHighlight">      HasBitExtract = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><span class="doxyHighlight">      int64&#95;t ExtractOffsetInBits = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getArg(0);</span></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"><span class="doxyHighlight">      int64&#95;t ExtractSizeInBits = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getArg(1);</span></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// DIExpression::createFragmentExpression doesn&#39;t know how to handle</span></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a fragment that is smaller than the extract. Copy the behaviour</span></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (bail) to avoid non-NFC changes.</span></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: Don&#39;t do this.</span></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Frag.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#af581a7bb056b2b642d6705cc4af65fa2">SizeInBits</a> &lt; uint64&#95;t(ExtractSizeInBits))</span></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BitExtractOffset &lt;= 0);</span></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><span class="doxyHighlight">      int64&#95;t AdjustedOffset = ExtractOffsetInBits + BitExtractOffset;</span></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// DIExpression::createFragmentExpression doesn&#39;t know what to do</span></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if the new extract starts &quot;outside&quot; the existing one. Copy the</span></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// behaviour (bail) to avoid non-NFC changes.</span></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: Don&#39;t do this.</span></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AdjustedOffset &lt; 0)</span></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getOp());</span></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(std::max&lt;int64&#95;t&gt;(0, AdjustedOffset));</span></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(ExtractSizeInBits);</span></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.appendToVector(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</span></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unsupported by createFragmentExpression, so don&#39;t support it here yet to</span></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preserve NFC-ness.</span></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFragment &amp;&amp; HasBitExtract)</span></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasBitExtract) &#123;</span></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/dwarf/#a78e9cb1527edb3cc1d1ee577257b5f0cac09e4cb866e5aa9bc0480359be9e7953">dwarf::DW&#95;OP&#95;LLVM&#95;fragment</a>);</span></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Frag.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#aa448040bf5ec2ebafc3dbe0eb15b6d55">OffsetInBits</a>);</span></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Frag.<a href="/docs/api/structs/llvm/dbgvariablefragmentinfo/#af581a7bb056b2b642d6705cc4af65fa2">SizeInBits</a>);</span></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIExpression::get</a>(Expr-&gt;<a href="/docs/api/classes/llvm/mdnode/#ad2fecba192de6da1578bdcb78d524169">getContext</a>(), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</span></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><span class="doxyHighlightComment">/// Insert a new dbg.declare.</span></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"><span class="doxyHighlightComment">/// \\p Orig Original to copy debug loc and variable from.</span></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><span class="doxyHighlightComment">/// \\p NewAddr Location&#39;s new base address.</span></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"><span class="doxyHighlightComment">/// \\p NewAddrExpr New expression to apply to address.</span></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><span class="doxyHighlightComment">/// \\p BeforeInst Insert position.</span></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"><span class="doxyHighlightComment">/// \\p NewFragment New fragment (absolute, non-relative).</span></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><span class="doxyHighlightComment">/// \\p BitExtractAdjustment Offset to apply to any extract&#95;bits op.</span></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146" lineLink="#ab994e75dc5cae892a87ae9a86d4b767a"><span class="doxyHighlight"><a href="#ab994e75dc5cae892a87ae9a86d4b767a">insertNewDbgInst</a>(<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;DIB, <a href="/docs/api/classes/llvm/dbgdeclareinst">DbgDeclareInst</a> &#42;Orig, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;NewAddr,</span></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;NewAddrExpr, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BeforeInst,</span></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><span class="doxyHighlight">                 std::optional&lt;DIExpression::FragmentInfo&gt; NewFragment,</span></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"><span class="doxyHighlight">                 int64&#95;t BitExtractAdjustment) &#123;</span></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewFragment)</span></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"><span class="doxyHighlight">    NewAddrExpr = <a href="#a4c75a6c6ed9dedc2ff52927972587023">createOrReplaceFragment</a>(NewAddrExpr, &#42;NewFragment,</span></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"><span class="doxyHighlight">                                          BitExtractAdjustment);</span></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewAddrExpr)</span></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><span class="doxyHighlight">  DIB.<a href="/docs/api/classes/llvm/dibuilder/#a9019e662ee1c0c04e06e9871650268c8">insertDeclare</a>(NewAddr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a854857be09a21f27fb21ba872fe6f639">getVariable</a>(), NewAddrExpr,</span></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><span class="doxyHighlight">                    Orig-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), BeforeInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><span class="doxyHighlightComment">/// Insert a new dbg.assign.</span></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"><span class="doxyHighlightComment">/// \\p Orig Original to copy debug loc, variable, value and value expression</span></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><span class="doxyHighlightComment">///    from.</span></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><span class="doxyHighlightComment">/// \\p NewAddr Location&#39;s new base address.</span></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"><span class="doxyHighlightComment">/// \\p NewAddrExpr New expression to apply to address.</span></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"><span class="doxyHighlightComment">/// \\p BeforeInst Insert position.</span></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"><span class="doxyHighlightComment">/// \\p NewFragment New fragment (absolute, non-relative).</span></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"><span class="doxyHighlightComment">/// \\p BitExtractAdjustment Offset to apply to any extract&#95;bits op.</span></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169" lineLink="#a5a020f0ab461a1f6e3b87aff314bd040"><span class="doxyHighlight"><a href="#ab994e75dc5cae892a87ae9a86d4b767a">insertNewDbgInst</a>(<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;DIB, <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> &#42;Orig, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;NewAddr,</span></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;NewAddrExpr, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BeforeInst,</span></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"><span class="doxyHighlight">                 std::optional&lt;DIExpression::FragmentInfo&gt; NewFragment,</span></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"><span class="doxyHighlight">                 int64&#95;t BitExtractAdjustment) &#123;</span></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DIBuilder::insertDbgAssign will insert the #dbg&#95;assign after NewAddr.</span></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"><span class="doxyHighlight">  (void)BeforeInst;</span></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A dbg.assign puts fragment info in the value expression only. The address</span></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expression has already been built: NewAddrExpr.</span></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;NewFragmentExpr = Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#ad1707c1c1ab1f3278424f265893c87fb">getExpression</a>();</span></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewFragment)</span></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"><span class="doxyHighlight">    NewFragmentExpr = <a href="#a4c75a6c6ed9dedc2ff52927972587023">createOrReplaceFragment</a>(NewFragmentExpr, &#42;NewFragment,</span></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><span class="doxyHighlight">                                              BitExtractAdjustment);</span></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewFragmentExpr)</span></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Apply a DIAssignID to the store if it doesn&#39;t already have it.</span></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewAddr-&gt;<a href="/docs/api/classes/llvm/instruction/#a565f546ad95bd3a9bbe9a1e5040803f0">hasMetadata</a>(LLVMContext::MD&#95;DIAssignID)) &#123;</span></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"><span class="doxyHighlight">    NewAddr-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;DIAssignID,</span></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/diassignid/#aa1a51f00d72f783f9da056877b8fe632">DIAssignID::getDistinct</a>(NewAddr-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()));</span></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewAssign = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction &#42;&gt;</a>(DIB.<a href="/docs/api/classes/llvm/dibuilder/#a5a6937fcd639ac78a93b48ab6624e957">insertDbgAssign</a>(</span></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><span class="doxyHighlight">      NewAddr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgvalueinst/#a82f5c63aa1e00276f988174976c57903">getValue</a>(), Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a854857be09a21f27fb21ba872fe6f639">getVariable</a>(), NewFragmentExpr, NewAddr,</span></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><span class="doxyHighlight">      NewAddrExpr, Orig-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>()));</span></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Created new assign intrinsic: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewAssign &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"><span class="doxyHighlight">  (void)NewAssign;</span></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"><span class="doxyHighlightComment">/// Insert a new DbgRecord.</span></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"><span class="doxyHighlightComment">/// \\p Orig Original to copy record type, debug loc and variable from, and</span></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"><span class="doxyHighlightComment">///    additionally value and value expression for dbg&#95;assign records.</span></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><span class="doxyHighlightComment">/// \\p NewAddr Location&#39;s new base address.</span></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><span class="doxyHighlightComment">/// \\p NewAddrExpr New expression to apply to address.</span></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><span class="doxyHighlightComment">/// \\p BeforeInst Insert position.</span></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"><span class="doxyHighlightComment">/// \\p NewFragment New fragment (absolute, non-relative).</span></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><span class="doxyHighlightComment">/// \\p BitExtractAdjustment Offset to apply to any extract&#95;bits op.</span></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207" lineLink="#abf39bad779191e6a85e053be5111c399"><span class="doxyHighlight"><a href="#ab994e75dc5cae892a87ae9a86d4b767a">insertNewDbgInst</a>(<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;DIB, <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;Orig, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;NewAddr,</span></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;NewAddrExpr, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BeforeInst,</span></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"><span class="doxyHighlight">                 std::optional&lt;DIExpression::FragmentInfo&gt; NewFragment,</span></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><span class="doxyHighlight">                 int64&#95;t BitExtractAdjustment) &#123;</span></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"><span class="doxyHighlight">  (void)DIB;</span></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A dbg&#95;assign puts fragment info in the value expression only. The address</span></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expression has already been built: NewAddrExpr. A dbg&#95;declare puts the</span></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// new fragment info into NewAddrExpr (as it only has one expression).</span></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;NewFragmentExpr =</span></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><span class="doxyHighlight">      Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8e44c4d5de5d1134497e3ca3b922c535">isDbgAssign</a>() ? Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8ec5a479378113fc24b647afa2f06ee5">getExpression</a>() : NewAddrExpr;</span></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewFragment)</span></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"><span class="doxyHighlight">    NewFragmentExpr = <a href="#a4c75a6c6ed9dedc2ff52927972587023">createOrReplaceFragment</a>(NewFragmentExpr, &#42;NewFragment,</span></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><span class="doxyHighlight">                                              BitExtractAdjustment);</span></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewFragmentExpr)</span></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#ac1678dcac1aa0255429f8dcee4ffabd2">isDbgDeclare</a>()) &#123;</span></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR = <a href="/docs/api/classes/llvm/dbgvariablerecord/#a8461772cf63d3b043a673a75b6b95e39">DbgVariableRecord::createDVRDeclare</a>(</span></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><span class="doxyHighlight">        NewAddr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#aa774c62045e74bb457b32713c0670696">getVariable</a>(), NewFragmentExpr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgrecord/#a3a0f4e00c3f6345c52c6acd178b3fca3">getDebugLoc</a>());</span></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><span class="doxyHighlight">    BeforeInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;insertDbgRecordBefore(DVR,</span></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"><span class="doxyHighlight">                                                   BeforeInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231"></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a0d537737d355256948200ba969a44637">isDbgValue</a>()) &#123;</span></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR = <a href="/docs/api/classes/llvm/dbgvariablerecord/#a8337b222b982e9caf0f6226efb56039c">DbgVariableRecord::createDbgVariableRecord</a>(</span></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"><span class="doxyHighlight">        NewAddr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#aa774c62045e74bb457b32713c0670696">getVariable</a>(), NewFragmentExpr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgrecord/#a3a0f4e00c3f6345c52c6acd178b3fca3">getDebugLoc</a>());</span></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Drop debug information if the expression doesn&#39;t start with a</span></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// DW&#95;OP&#95;deref. This is because without a DW&#95;OP&#95;deref, the #dbg&#95;value</span></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// describes the address of alloca rather than the value inside the alloca.</span></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewFragmentExpr-&gt;<a href="/docs/api/classes/llvm/diexpression/#a3c6397a9b21812183d69e90c3dac17f9">startsWithDeref</a>())</span></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><span class="doxyHighlight">      DVR-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a9b641aa0b6a8f401fff5ba3675467835">setKillAddress</a>();</span></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"><span class="doxyHighlight">    BeforeInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;insertDbgRecordBefore(DVR,</span></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><span class="doxyHighlight">                                                   BeforeInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Apply a DIAssignID to the store if it doesn&#39;t already have it.</span></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewAddr-&gt;<a href="/docs/api/classes/llvm/instruction/#a565f546ad95bd3a9bbe9a1e5040803f0">hasMetadata</a>(LLVMContext::MD&#95;DIAssignID)) &#123;</span></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><span class="doxyHighlight">    NewAddr-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;DIAssignID,</span></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/diassignid/#aa1a51f00d72f783f9da056877b8fe632">DIAssignID::getDistinct</a>(NewAddr-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()));</span></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;NewAssign = <a href="/docs/api/classes/llvm/dbgvariablerecord/#ae465cfd07a3ac2e84847e670d92ae8ad">DbgVariableRecord::createLinkedDVRAssign</a>(</span></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"><span class="doxyHighlight">      NewAddr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#a67997ed52b560aac60464dbdcd8cc3f0">getValue</a>(), Orig-&gt;<a href="/docs/api/classes/llvm/dbgvariablerecord/#aa774c62045e74bb457b32713c0670696">getVariable</a>(), NewFragmentExpr, NewAddr,</span></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"><span class="doxyHighlight">      NewAddrExpr, Orig-&gt;<a href="/docs/api/classes/llvm/dbgrecord/#a3a0f4e00c3f6345c52c6acd178b3fca3">getDebugLoc</a>());</span></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Created new DVRAssign: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewAssign &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><span class="doxyHighlight">  (void)NewAssign;</span></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><span class="doxyHighlightComment">/// Walks the slices of an alloca and form partitions based on them,</span></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><span class="doxyHighlightComment">/// rewriting each of their uses.</span></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SROA::splitAlloca(AllocaInst &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS) &#123;</span></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AS.begin() == AS.end())</span></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPartitions = 0;</span></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = AI.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a href="/docs/api/classes/llvm/module/#abcbe492bce3ccc16e0bbb50292576c5c">getDataLayout</a>();</span></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First try to pre-split loads and stores.</span></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= presplitLoadsAndStores(AI, AS);</span></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we have identified any pre-splitting opportunities,</span></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mark loads and stores unsplittable except for the following case.</span></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We leave a slice splittable if all other slices are disjoint or fully</span></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// included in the slice, such as whole-alloca loads and stores.</span></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we fail to split these during pre-splitting, we want to force them</span></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to be rewritten into a partition.</span></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSorted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"><span class="doxyHighlight">  uint64&#95;t AllocaSize =</span></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(AI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>()).getFixedValue();</span></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t MaxBitVectorSize = 1024;</span></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaSize &lt;= MaxBitVectorSize) &#123;</span></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If a byte boundary is included in any load or store, a slice starting or</span></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ending at the boundary is not splittable.</span></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"><span class="doxyHighlight">    SmallBitVector SplittableOffset(AllocaSize + 1, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &amp;S : AS)</span></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> O = S.beginOffset() + 1;</span></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><span class="doxyHighlight">           O &lt; S.endOffset() &amp;&amp; O &lt; AllocaSize; O++)</span></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"><span class="doxyHighlight">        SplittableOffset.reset(O);</span></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &amp;S : AS) &#123;</span></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.isSplittable())</span></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((S.beginOffset() &gt; AllocaSize || SplittableOffset&#91;S.beginOffset()&#93;) &amp;&amp;</span></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><span class="doxyHighlight">          (S.endOffset() &gt; AllocaSize || SplittableOffset&#91;S.endOffset()&#93;))</span></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(S.getUse()-&gt;getUser()) ||</span></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(S.getUse()-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><span class="doxyHighlight">        S.makeUnsplittable();</span></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"><span class="doxyHighlight">        IsSorted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We only allow whole-alloca splittable loads and stores</span></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for a large alloca to avoid creating too large BitVector.</span></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Slice &amp;S : AS) &#123;</span></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S.isSplittable())</span></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311"></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S.beginOffset() == 0 &amp;&amp; S.endOffset() &gt;= AllocaSize)</span></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(S.getUse()-&gt;getUser()) ||</span></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(S.getUse()-&gt;getUser())) &#123;</span></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"><span class="doxyHighlight">        S.makeUnsplittable();</span></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><span class="doxyHighlight">        IsSorted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSorted)</span></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(AS);</span></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326"><span class="doxyHighlightComment">  /// Describes the allocas introduced by rewritePartition in order to migrate</span></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"><span class="doxyHighlightComment">  /// the debug info.</span></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">Fragment &#123;</span></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329"><span class="doxyHighlight">    AllocaInst &#42;Alloca;</span></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><span class="doxyHighlight">    Fragment(AllocaInst &#42;AI, uint64&#95;t O, uint64&#95;t S)</span></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><span class="doxyHighlight">        : Alloca(AI), <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>), <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>(S) &#123;&#125;</span></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Fragment, 4&gt;</a> Fragments;</span></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rewrite each partition.</span></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : AS.partitions()) &#123;</span></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"><span class="doxyHighlight">    if (AllocaInst &#42;NewAI = rewritePartition(AI, AS, P)) &#123;</span></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><span class="doxyHighlight">      Changed = true;</span></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"><span class="doxyHighlight">      if (NewAI != &amp;AI) &#123;</span></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342"><span class="doxyHighlight">        uint64&#95;t SizeOfByte = 8;</span></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><span class="doxyHighlight">        uint64&#95;t AllocaSize =</span></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><span class="doxyHighlight">            DL.getTypeSizeInBits(NewAI-&gt;getAllocatedType()).getFixedValue();</span></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Don&#39;t include any padding.</span></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"><span class="doxyHighlight">        uint64&#95;t Size = std::min(AllocaSize, P.size() &#42; SizeOfByte);</span></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"><span class="doxyHighlight">        Fragments.push&#95;back(</span></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><span class="doxyHighlight">            Fragment(NewAI, P.beginOffset() &#42; SizeOfByte, Size));</span></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><span class="doxyHighlight">    ++NumPartitions;</span></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><span class="doxyHighlight">  NumAllocaPartitions += NumPartitions;</span></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"><span class="doxyHighlight">  MaxPartitionsPerAlloca.updateMax(NumPartitions);</span></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Migrate debug information from the old alloca to the new alloca(s)</span></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the individual partitions.</span></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MigrateOne = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgVariable) &#123;</span></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t overlap with undef memory.</span></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9852adb260b49ee49d3df79aa767f145">isKillAddress</a>(DbgVariable))</span></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DbgPtr = <a href="#a4a30a3fae601106b8b33c0871aa3069d">getAddress</a>(DbgVariable);</span></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/diexpression/#a2a09e6caba71ab15519f9e55ceb4d10d">DIExpression::FragmentInfo</a> VarFrag =</span></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"><span class="doxyHighlight">        DbgVariable-&gt;getFragmentOrEntireVariable();</span></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the address expression constant offset if one exists and the ops</span></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that come after it.</span></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><span class="doxyHighlight">    int64&#95;t CurrentExprOffsetInBytes = 0;</span></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"><span class="doxyHighlight">    SmallVector&lt;uint64&#95;t&gt; PostOffsetOps;</span></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#acb9cb49df37f70129e1f44543ffa57a0">getAddressExpression</a>(DbgVariable)</span></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><span class="doxyHighlight">             -&gt;extractLeadingOffset(CurrentExprOffsetInBytes, PostOffsetOps))</span></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Couldn&#39;t interpret this DIExpression - drop the var.</span></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Offset defined by a DW&#95;OP&#95;LLVM&#95;extract&#95;bits&#95;&#91;sz&#93;ext.</span></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"><span class="doxyHighlight">    int64&#95;t ExtractOffsetInBits = 0;</span></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="#acb9cb49df37f70129e1f44543ffa57a0">getAddressExpression</a>(DbgVariable)-&gt;expr&#95;ops()) &#123;</span></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getOp() == <a href="/docs/api/namespaces/llvm/dwarf/#a78e9cb1527edb3cc1d1ee577257b5f0ca3d02f9a2d8b9066b6c6ef1a39018de7f">dwarf::DW&#95;OP&#95;LLVM&#95;extract&#95;bits&#95;zext</a> ||</span></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getOp() == <a href="/docs/api/namespaces/llvm/dwarf/#a78e9cb1527edb3cc1d1ee577257b5f0cafa8715d4f64791c3f0b479ececa39d34">dwarf::DW&#95;OP&#95;LLVM&#95;extract&#95;bits&#95;sext</a>) &#123;</span></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><span class="doxyHighlight">        ExtractOffsetInBits = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getArg(0);</span></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><span class="doxyHighlight">    DIBuilder DIB(&#42;AI.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), </span><span class="doxyHighlightComment">/&#42;AllowUnresolved&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Fragment : Fragments) &#123;</span></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387"><span class="doxyHighlight">      int64&#95;t OffsetFromLocationInBits;</span></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><span class="doxyHighlight">      std::optional&lt;DIExpression::FragmentInfo&gt; NewDbgFragment;</span></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find the variable fragment that the new alloca slice covers.</span></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Drop debug info for this variable fragment if we can&#39;t compute an</span></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// intersect between it and the alloca slice.</span></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/diexpression/#a4ea8623be899e029827af260965c860d">DIExpression::calculateFragmentIntersect</a>(</span></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;AI, Fragment.Offset, Fragment.Size, DbgPtr,</span></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><span class="doxyHighlight">              CurrentExprOffsetInBytes &#42; 8, ExtractOffsetInBits, VarFrag,</span></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"><span class="doxyHighlight">              NewDbgFragment, OffsetFromLocationInBits))</span></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Do not migrate this fragment to this slice.</span></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Zero sized fragment indicates there&#39;s no intersect between the variable</span></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// fragment and the alloca slice. Skip this slice for this variable</span></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// fragment.</span></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewDbgFragment &amp;&amp; !NewDbgFragment-&gt;SizeInBits)</span></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Do not migrate this fragment to this slice.</span></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// No fragment indicates DbgVariable&#39;s variable or fragment exactly</span></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// overlaps the slice; copy its fragment (or nullopt if there isn&#39;t one).</span></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewDbgFragment)</span></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><span class="doxyHighlight">        NewDbgFragment = DbgVariable-&gt;getFragment();</span></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Reduce the new expression offset by the bit-extract offset since</span></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we&#39;ll be keeping that.</span></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"><span class="doxyHighlight">      int64&#95;t OffestFromNewAllocaInBits =</span></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><span class="doxyHighlight">          OffsetFromLocationInBits - ExtractOffsetInBits;</span></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We need to adjust an existing bit extract if the offset expression</span></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// can&#39;t eat the slack (i.e., if the new offset would be negative).</span></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"><span class="doxyHighlight">      int64&#95;t BitExtractOffset =</span></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><span class="doxyHighlight">          std::min&lt;int64&#95;t&gt;(0, OffestFromNewAllocaInBits);</span></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The magnitude of a negative value indicates the number of bits into</span></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the existing variable fragment that the memory region begins. The new</span></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// variable fragment already excludes those bits - the new DbgPtr offset</span></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// only needs to be applied if it&#39;s positive.</span></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><span class="doxyHighlight">      OffestFromNewAllocaInBits =</span></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><span class="doxyHighlight">          std::max(int64&#95;t(0), OffestFromNewAllocaInBits);</span></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Rebuild the expression:</span></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//    &#123;Offset(OffestFromNewAllocaInBits), PostOffsetOps, NewDbgFragment&#125;</span></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add NewDbgFragment later, because dbg.assigns don&#39;t want it in the</span></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// address expression but the value expression instead.</span></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"><span class="doxyHighlight">      DIExpression &#42;NewExpr = DIExpression::get(AI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), PostOffsetOps);</span></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OffestFromNewAllocaInBits &gt; 0) &#123;</span></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><span class="doxyHighlight">        int64&#95;t OffsetInBytes = (OffestFromNewAllocaInBits + 7) / 8;</span></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"><span class="doxyHighlight">        NewExpr = <a href="/docs/api/classes/llvm/diexpression/#ab804b15bb92ff685d7c1464b2816d608">DIExpression::prepend</a>(NewExpr, </span><span class="doxyHighlightComment">/&#42;flags=&#42;/</span><span class="doxyHighlight">0, OffsetInBytes);</span></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove any existing intrinsics on the new alloca describing</span></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the variable fragment.</span></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RemoveOne = &#91;DbgVariable&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldDII) &#123;</span></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SameVariableFragment = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getVariable() == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getVariable() &amp;&amp;</span></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getDebugLoc()-&gt;getInlinedAt() ==</span></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><span class="doxyHighlight">                     <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getDebugLoc()-&gt;getInlinedAt();</span></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameVariableFragment(OldDII, DbgVariable))</span></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><span class="doxyHighlight">          OldDII-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/#a19d345e6fa45d60ff4092769417b89b2">findDbgDeclares</a>(Fragment.Alloca), RemoveOne);</span></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/#ac9c256eafdc8fb849f7320bc37120a5c">findDVRDeclares</a>(Fragment.Alloca), RemoveOne);</span></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/#a8986bcfeec47c38c0078ef3d3e1c8707">findDVRValues</a>(Fragment.Alloca), RemoveOne);</span></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><span class="doxyHighlight">      <a href="#ab994e75dc5cae892a87ae9a86d4b767a">insertNewDbgInst</a>(DIB, DbgVariable, Fragment.Alloca, NewExpr, &amp;AI,</span></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"><span class="doxyHighlight">                       NewDbgFragment, BitExtractOffset);</span></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Migrate debug information from the old alloca to the new alloca(s)</span></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the individual partitions.</span></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/#a19d345e6fa45d60ff4092769417b89b2">findDbgDeclares</a>(&amp;AI), MigrateOne);</span></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/#ac9c256eafdc8fb849f7320bc37120a5c">findDVRDeclares</a>(&amp;AI), MigrateOne);</span></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/#a8986bcfeec47c38c0078ef3d3e1c8707">findDVRValues</a>(&amp;AI), MigrateOne);</span></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(&amp;AI), MigrateOne);</span></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(&amp;AI), MigrateOne);</span></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463"></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"><span class="doxyHighlightComment">/// Clobber a use with poison, deleting the used value if it becomes dead.</span></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> SROA::clobberUse(Use &amp;U) &#123;</span></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldV = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>;</span></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the use with an poison value.</span></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a> = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(OldV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for this making an instruction dead. We have to garbage collect</span></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all the dead instructions to ensure the uses of any alloca end up being</span></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// minimal.</span></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;OldI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(OldV))</span></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(OldI)) &#123;</span></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"><span class="doxyHighlight">      DeadInsts.push&#95;back(OldI);</span></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"><span class="doxyHighlightComment">/// A basic LoadAndStorePromoter that does not remove store nodes.</span></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480" lineLink="/docs/api/classes/basicloadandstorepromoter"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/basicloadandstorepromoter/#a3ded06351ad4d9d097e68d88bb46ba30">BasicLoadAndStorePromoter</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loadandstorepromoter/#a5a4040326a09f994f2b5481cf5c8da82">LoadAndStorePromoter</a> &#123;</span></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482" lineLink="/docs/api/classes/basicloadandstorepromoter/#a3ded06351ad4d9d097e68d88bb46ba30"><span class="doxyHighlight">  <a href="/docs/api/classes/basicloadandstorepromoter/#a3ded06351ad4d9d097e68d88bb46ba30">BasicLoadAndStorePromoter</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;const Instruction &#42;&gt;</a> Insts, <a href="/docs/api/classes/llvm/ssaupdater">SSAUpdater</a> &amp;S,</span></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/type">Type</a> &#42;ZeroType)</span></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/loadandstorepromoter/#a5a4040326a09f994f2b5481cf5c8da82">LoadAndStorePromoter</a>(Insts, S), ZeroType(ZeroType) &#123;&#125;</span></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485" lineLink="/docs/api/classes/basicloadandstorepromoter/#a0276bdd4b1457d63c240e65e943aa02b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/basicloadandstorepromoter/#a0276bdd4b1457d63c240e65e943aa02b">shouldDelete</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489" lineLink="/docs/api/classes/basicloadandstorepromoter/#acdcd864d0eb9e68ec66a4350b1390e26"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/basicloadandstorepromoter/#acdcd864d0eb9e68ec66a4350b1390e26">getValueToUseForAlloca</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(ZeroType);</span></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ZeroType;</span></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496"></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SROA::propagateStoredValuesToLoads(AllocaInst &amp;AI, <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/allocaslices">AllocaSlices</a> &amp;AS) &#123;</span></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look through each &quot;partition&quot;, looking for slices with the same start/end</span></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that do not overlap with any before them. The slices are sorted by</span></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// increasing beginOffset. We don&#39;t use AS.partitions(), as it will use a more</span></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sophisticated algorithm that takes splittable slices into account.</span></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PartitionBegin = AS.begin();</span></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PartitionEnd = PartitionBegin;</span></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504"><span class="doxyHighlight">  uint64&#95;t BeginOffset = PartitionBegin-&gt;beginOffset();</span></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><span class="doxyHighlight">  uint64&#95;t EndOffset = PartitionBegin-&gt;endOffset();</span></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PartitionBegin != AS.end()) &#123;</span></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllSameAndValid = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508"><span class="doxyHighlight">    SmallVector&lt;Instruction &#42;&gt; Insts;</span></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PartitionType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PartitionEnd != AS.end() &amp;&amp;</span></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><span class="doxyHighlight">           (PartitionEnd-&gt;beginOffset() &lt; EndOffset ||</span></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><span class="doxyHighlight">            PartitionEnd-&gt;endOffset() &lt;= EndOffset)) &#123;</span></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllSameAndValid) &#123;</span></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"><span class="doxyHighlight">        AllSameAndValid &amp;= PartitionEnd-&gt;beginOffset() == BeginOffset &amp;&amp;</span></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"><span class="doxyHighlight">                           PartitionEnd-&gt;endOffset() == EndOffset;</span></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">User</a> =</span></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PartitionEnd-&gt;getUse()-&gt;getUser());</span></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(User)) &#123;</span></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;UserTy = LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// LoadAndStorePromoter requires all the types to be the same.</span></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#aeb534c1a0391ce24551c226a582099a7">isSimple</a>() || (PartitionType &amp;&amp; UserTy != PartitionType))</span></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"><span class="doxyHighlight">            AllSameAndValid = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><span class="doxyHighlight">          PartitionType = UserTy;</span></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><span class="doxyHighlight">          Insts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(User);</span></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(User)) &#123;</span></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;UserTy = <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand()-&gt;getType();</span></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;isSimple() || (PartitionType &amp;&amp; UserTy != PartitionType))</span></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"><span class="doxyHighlight">            AllSameAndValid = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"><span class="doxyHighlight">          PartitionType = UserTy;</span></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><span class="doxyHighlight">          Insts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(User);</span></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a1f2f83d3af349e89d62c6277ba668b4f">isAssumeLikeIntrinsic</a>(User)) &#123;</span></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532"><span class="doxyHighlight">          AllSameAndValid = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"><span class="doxyHighlight">      EndOffset = std::max(EndOffset, PartitionEnd-&gt;endOffset());</span></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"><span class="doxyHighlight">      ++PartitionEnd;</span></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// So long as all the slices start and end offsets matched, update loads to</span></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the values stored in the partition.</span></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllSameAndValid &amp;&amp; !Insts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Propagate values on slice &#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; BeginOffset &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"><span class="doxyHighlight">                        &lt;&lt; EndOffset &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;PHINode &#42;, 4&gt;</a> NewPHIs;</span></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"><span class="doxyHighlight">      SSAUpdater <a href="/docs/api/files/lib/lib/analysis/memoryssa-cpp/#a20a60bdac22b099d87d8cb0c1d554120">SSA</a>(&amp;NewPHIs);</span></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><span class="doxyHighlight">      Insts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;AI);</span></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"><span class="doxyHighlight">      BasicLoadAndStorePromoter Promoter(Insts, <a href="/docs/api/files/lib/lib/analysis/memoryssa-cpp/#a20a60bdac22b099d87d8cb0c1d554120">SSA</a>, PartitionType);</span></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"><span class="doxyHighlight">      Promoter.run(Insts);</span></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Step on to the next partition.</span></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"><span class="doxyHighlight">    PartitionBegin = PartitionEnd;</span></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PartitionBegin == AS.end())</span></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"><span class="doxyHighlight">    BeginOffset = PartitionBegin-&gt;beginOffset();</span></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"><span class="doxyHighlight">    EndOffset = PartitionBegin-&gt;endOffset();</span></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><span class="doxyHighlightComment">/// Analyze an alloca for SROA.</span></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><span class="doxyHighlightComment">/// This analyzes the alloca to ensure we can reason about it, builds</span></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"><span class="doxyHighlightComment">/// the slices of the alloca, and then hands it off to be split and</span></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"><span class="doxyHighlightComment">/// rewritten as needed.</span></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"><span class="doxyHighlight">std::pair&lt;</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Changed&#42;/</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;CFGChanged&#42;/</span><span class="doxyHighlight">&gt;</span></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><span class="doxyHighlight">SROA::runOnAlloca(AllocaInst &amp;AI) &#123;</span></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CFGChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SROA alloca: &quot;</span><span class="doxyHighlight"> &lt;&lt; AI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"><span class="doxyHighlight">  ++NumAllocasAnalyzed;</span></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Special case dead allocas, as they&#39;re trivial.</span></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><span class="doxyHighlight">    AI.<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#125;;</span></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = AI.<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip alloca forms that this analysis can&#39;t handle.</span></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AT = AI.<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>();</span></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584"><span class="doxyHighlight">  TypeSize <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(AT);</span></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI.<a href="/docs/api/classes/llvm/allocainst/#aea74164514e7164813ab30bcc4b7c557">isArrayAllocation</a>() || !AT-&gt;isSized() || <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>.isScalable() ||</span></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>.getFixedValue() == 0)</span></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#125;;</span></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, split any FCA loads and stores touching this alloca to promote</span></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// better splitting and promotion opportunities.</span></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-sroa-cpp-/#a25b3d08de3386c79fa6533b6bd2485de">IRBuilderTy</a> IRB(&amp;AI);</span></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"><span class="doxyHighlight">  AggLoadStoreRewriter AggRewriter(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IRB);</span></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= AggRewriter.rewrite(AI);</span></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build the slices using a recursive instruction-visiting builder.</span></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"><span class="doxyHighlight">  AllocaSlices AS(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AI);</span></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(AS.print(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AS.isEscaped())</span></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#125;;</span></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AS.isEscapedReadOnly()) &#123;</span></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= propagateStoredValuesToLoads(AI, AS);</span></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#125;;</span></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete all the dead users of this alloca before splitting and rewriting it.</span></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;DeadUser : AS.getDeadUsers()) &#123;</span></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Free up everything used by this instruction.</span></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;DeadOp : DeadUser-&gt;operands())</span></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><span class="doxyHighlight">      clobberUse(DeadOp);</span></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now replace the uses of this instruction.</span></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><span class="doxyHighlight">    DeadUser-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(DeadUser-&gt;getType()));</span></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// And mark it for deletion.</span></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"><span class="doxyHighlight">    DeadInsts.push&#95;back(DeadUser);</span></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &#42;DeadOp : AS.getDeadOperands()) &#123;</span></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><span class="doxyHighlight">    clobberUse(&#42;DeadOp);</span></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No slices to split. Leave the dead alloca for a later pass to clean up.</span></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AS.begin() == AS.end())</span></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#125;;</span></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= splitAlloca(AI, AS);</span></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Speculating PHIs\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!SpeculatablePHIs.empty())</span></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"><span class="doxyHighlight">    <a href="#a80f5f1399bc814c650325a6c41e350e2">speculatePHINodeLoads</a>(IRB, &#42;SpeculatablePHIs.pop&#95;back&#95;val());</span></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Rewriting Selects\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RemainingSelectsToRewrite = SelectsToRewrite.takeVector();</span></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!RemainingSelectsToRewrite.empty()) &#123;</span></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38eaa5f3c6a11b03839d46af9fb43c97c188">K</a>, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>&#93; = RemainingSelectsToRewrite.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><span class="doxyHighlight">    CFGChanged |=</span></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><span class="doxyHighlight">        <a href="#a63ceac0fe90c6eae903dd259120cc4fd">rewriteSelectInstMemOps</a>(&#42;K, V, IRB, PreserveCFG ? </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> : DTU);</span></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#125;;</span></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><span class="doxyHighlightComment">/// Delete the dead instructions accumulated in this run.</span></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"><span class="doxyHighlightComment">/// Recursively deletes the dead instructions we&#39;ve accumulated. This is done</span></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><span class="doxyHighlightComment">/// at the very end to maximize locality of the recursive delete and to</span></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><span class="doxyHighlightComment">/// minimize the problems of invalidated instruction pointers as such pointers</span></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650"><span class="doxyHighlightComment">/// are used heavily in the intermediate stages of the algorithm.</span></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"><span class="doxyHighlightComment">/// We also record the alloca instructions deleted here so that they aren&#39;t</span></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"><span class="doxyHighlightComment">/// subsequently handed to mem2reg to promote.</span></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SROA::deleteDeadInstructions(</span></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><span class="doxyHighlight">    SmallPtrSetImpl&lt;AllocaInst &#42;&gt; &amp;DeletedAllocas) &#123;</span></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!DeadInsts.empty()) &#123;</span></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(DeadInsts.pop&#95;back&#95;val());</span></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Deleting dead instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the instruction is an alloca, find the possible dbg.declare connected</span></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to it, and remove it too. We must do this before calling RAUW or we will</span></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// not be able to find it.</span></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaInst &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"><span class="doxyHighlight">      DeletedAllocas.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(AI);</span></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (DbgDeclareInst &#42;OldDII : <a href="/docs/api/namespaces/llvm/#a19d345e6fa45d60ff4092769417b89b2">findDbgDeclares</a>(AI))</span></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><span class="doxyHighlight">        OldDII-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (DbgVariableRecord &#42;OldDII : <a href="/docs/api/namespaces/llvm/#ac9c256eafdc8fb849f7320bc37120a5c">findDVRDeclares</a>(AI))</span></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><span class="doxyHighlight">        OldDII-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/at/#acac0a0a393ce41aadc29e623549b6bfa">at::deleteAssignmentMarkers</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()));</span></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;Operand : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</span></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;U = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Operand)) &#123;</span></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Zero out the operand and see if it becomes trivially dead.</span></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680"><span class="doxyHighlight">        Operand = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(U))</span></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><span class="doxyHighlight">          DeadInsts.push&#95;back(U);</span></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684"></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><span class="doxyHighlight">    ++NumDeleted;</span></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"><span class="doxyHighlightComment">/// Promote the allocas, using the best available technique.</span></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"><span class="doxyHighlightComment">/// This attempts to promote whatever allocas have been identified as viable in</span></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><span class="doxyHighlightComment">/// the PromotableAllocas list. If that list is empty, there is nothing to do.</span></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695"><span class="doxyHighlightComment">/// This function returns whether any promotion occurred.</span></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SROA::promoteAllocas(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PromotableAllocas.empty())</span></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699"></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a1b382400b6aa5cded55f3c0d0a0f9bf8">SROASkipMem2Reg</a>) &#123;</span></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Not promoting allocas with mem2reg!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Promoting allocas with mem2reg...\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"><span class="doxyHighlight">    NumPromoted += PromotableAllocas.size();</span></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a1a4cac84457299517e69ff9764fed2db">PromoteMemToReg</a>(PromotableAllocas.getArrayRef(), DTU-&gt;getDomTree(), AC);</span></CodeLine>
<Link id="l05706" /><CodeLine lineNumber="5706"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05707" /><CodeLine lineNumber="5707"></CodeLine>
<Link id="l05708" /><CodeLine lineNumber="5708"><span class="doxyHighlight">  PromotableAllocas.clear();</span></CodeLine>
<Link id="l05709" /><CodeLine lineNumber="5709"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05710" /><CodeLine lineNumber="5710"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05711" /><CodeLine lineNumber="5711"></CodeLine>
<Link id="l05712" /><CodeLine lineNumber="5712" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#a8317779540f30fe6a5dda2359f023675"><span class="doxyHighlight">std::pair&lt;</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Changed&#42;/</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;CFGChanged&#42;/</span><span class="doxyHighlight">&gt; <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#a8317779540f30fe6a5dda2359f023675">SROA::runSROA</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l05713" /><CodeLine lineNumber="5713"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SROA function: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05714" /><CodeLine lineNumber="5714"></CodeLine>
<Link id="l05715" /><CodeLine lineNumber="5715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</span></CodeLine>
<Link id="l05716" /><CodeLine lineNumber="5716"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;EntryBB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock();</span></CodeLine>
<Link id="l05717" /><CodeLine lineNumber="5717"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = EntryBB.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = std::prev(EntryBB.<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l05718" /><CodeLine lineNumber="5718"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l05719" /><CodeLine lineNumber="5719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l05720" /><CodeLine lineNumber="5720"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>()).isScalable() &amp;&amp;</span></CodeLine>
<Link id="l05721" /><CodeLine lineNumber="5721"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a5023b360abc7a5d1612061fba30003a6">isAllocaPromotable</a>(AI))</span></CodeLine>
<Link id="l05722" /><CodeLine lineNumber="5722"><span class="doxyHighlight">        PromotableAllocas.insert(AI);</span></CodeLine>
<Link id="l05723" /><CodeLine lineNumber="5723"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05724" /><CodeLine lineNumber="5724"><span class="doxyHighlight">        Worklist.insert(AI);</span></CodeLine>
<Link id="l05725" /><CodeLine lineNumber="5725"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05726" /><CodeLine lineNumber="5726"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05727" /><CodeLine lineNumber="5727"></CodeLine>
<Link id="l05728" /><CodeLine lineNumber="5728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05729" /><CodeLine lineNumber="5729"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CFGChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05730" /><CodeLine lineNumber="5730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A set of deleted alloca instruction pointers which should be removed from</span></CodeLine>
<Link id="l05731" /><CodeLine lineNumber="5731"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the list of promotable allocas.</span></CodeLine>
<Link id="l05732" /><CodeLine lineNumber="5732"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;AllocaInst &#42;, 4&gt;</a> DeletedAllocas;</span></CodeLine>
<Link id="l05733" /><CodeLine lineNumber="5733"></CodeLine>
<Link id="l05734" /><CodeLine lineNumber="5734"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05735" /><CodeLine lineNumber="5735"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.empty()) &#123;</span></CodeLine>
<Link id="l05736" /><CodeLine lineNumber="5736"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;IterationChanged, IterationCFGChanged&#93; =</span></CodeLine>
<Link id="l05737" /><CodeLine lineNumber="5737"><span class="doxyHighlight">          runOnAlloca(&#42;Worklist.pop&#95;back&#95;val());</span></CodeLine>
<Link id="l05738" /><CodeLine lineNumber="5738"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= IterationChanged;</span></CodeLine>
<Link id="l05739" /><CodeLine lineNumber="5739"><span class="doxyHighlight">      CFGChanged |= IterationCFGChanged;</span></CodeLine>
<Link id="l05740" /><CodeLine lineNumber="5740"></CodeLine>
<Link id="l05741" /><CodeLine lineNumber="5741"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= deleteDeadInstructions(DeletedAllocas);</span></CodeLine>
<Link id="l05742" /><CodeLine lineNumber="5742"></CodeLine>
<Link id="l05743" /><CodeLine lineNumber="5743"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove the deleted allocas from various lists so that we don&#39;t try to</span></CodeLine>
<Link id="l05744" /><CodeLine lineNumber="5744"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// continue processing them.</span></CodeLine>
<Link id="l05745" /><CodeLine lineNumber="5745"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DeletedAllocas.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>()) &#123;</span></CodeLine>
<Link id="l05746" /><CodeLine lineNumber="5746"><span class="doxyHighlight">        Worklist.set&#95;subtract(DeletedAllocas);</span></CodeLine>
<Link id="l05747" /><CodeLine lineNumber="5747"><span class="doxyHighlight">        PostPromotionWorklist.set&#95;subtract(DeletedAllocas);</span></CodeLine>
<Link id="l05748" /><CodeLine lineNumber="5748"><span class="doxyHighlight">        PromotableAllocas.set&#95;subtract(DeletedAllocas);</span></CodeLine>
<Link id="l05749" /><CodeLine lineNumber="5749"><span class="doxyHighlight">        DeletedAllocas.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</span></CodeLine>
<Link id="l05750" /><CodeLine lineNumber="5750"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05751" /><CodeLine lineNumber="5751"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05752" /><CodeLine lineNumber="5752"></CodeLine>
<Link id="l05753" /><CodeLine lineNumber="5753"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= promoteAllocas(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05754" /><CodeLine lineNumber="5754"></CodeLine>
<Link id="l05755" /><CodeLine lineNumber="5755"><span class="doxyHighlight">    Worklist = PostPromotionWorklist;</span></CodeLine>
<Link id="l05756" /><CodeLine lineNumber="5756"><span class="doxyHighlight">    PostPromotionWorklist.clear();</span></CodeLine>
<Link id="l05757" /><CodeLine lineNumber="5757"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.empty());</span></CodeLine>
<Link id="l05758" /><CodeLine lineNumber="5758"></CodeLine>
<Link id="l05759" /><CodeLine lineNumber="5759"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!CFGChanged || <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can not only modify the CFG.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05760" /><CodeLine lineNumber="5760"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!CFGChanged || !PreserveCFG) &amp;&amp;</span></CodeLine>
<Link id="l05761" /><CodeLine lineNumber="5761"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Should not have modified the CFG when told to preserve it.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05762" /><CodeLine lineNumber="5762"></CodeLine>
<Link id="l05763" /><CodeLine lineNumber="5763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/#aa9ef2dbd1b7ce921093f7d4a7bd4cc5c">isAssignmentTrackingEnabled</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent())) &#123;</span></CodeLine>
<Link id="l05764" /><CodeLine lineNumber="5764"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l05765" /><CodeLine lineNumber="5765"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a08f3f942afc0ee9115a8f9fa87e9191d">RemoveRedundantDbgInstrs</a>(&amp;BB);</span></CodeLine>
<Link id="l05766" /><CodeLine lineNumber="5766"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05767" /><CodeLine lineNumber="5767"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05768" /><CodeLine lineNumber="5768"></CodeLine>
<Link id="l05769" /><CodeLine lineNumber="5769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#125;;</span></CodeLine>
<Link id="l05770" /><CodeLine lineNumber="5770"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05771" /><CodeLine lineNumber="5771"></CodeLine>
<Link id="l05772" /><CodeLine lineNumber="5772" lineLink="/docs/api/classes/llvm/sroapass/#a6cca3e145c2eb9050c6b4b94e2f760a0"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/sroapass/#a6cca3e145c2eb9050c6b4b94e2f760a0">SROAPass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l05773" /><CodeLine lineNumber="5773"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05774" /><CodeLine lineNumber="5774"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &amp;AC = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/assumptionanalysis">AssumptionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05775" /><CodeLine lineNumber="5775"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> DTU(DT, DomTreeUpdater::UpdateStrategy::Lazy);</span></CodeLine>
<Link id="l05776" /><CodeLine lineNumber="5776"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged&#93; =</span></CodeLine>
<Link id="l05777" /><CodeLine lineNumber="5777"><span class="doxyHighlight">      SROA(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext(), &amp;DTU, &amp;AC, PreserveCFG).runSROA(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05778" /><CodeLine lineNumber="5778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l05779" /><CodeLine lineNumber="5779"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l05780" /><CodeLine lineNumber="5780"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</span></CodeLine>
<Link id="l05781" /><CodeLine lineNumber="5781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CFGChanged)</span></CodeLine>
<Link id="l05782" /><CodeLine lineNumber="5782"><span class="doxyHighlight">    PA.<a href="/docs/api/classes/llvm/preservedanalyses/#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</span></CodeLine>
<Link id="l05783" /><CodeLine lineNumber="5783"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;();</span></CodeLine>
<Link id="l05784" /><CodeLine lineNumber="5784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l05785" /><CodeLine lineNumber="5785"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05786" /><CodeLine lineNumber="5786"></CodeLine>
<Link id="l05787" /><CodeLine lineNumber="5787" lineLink="/docs/api/classes/llvm/sroapass/#a83580fd53eefd840860e0b048e9f6d43"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/sroapass/#a83580fd53eefd840860e0b048e9f6d43">SROAPass::printPipeline</a>(</span></CodeLine>
<Link id="l05788" /><CodeLine lineNumber="5788"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/stringref">StringRef</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a>)&gt; MapClassName2PassName) &#123;</span></CodeLine>
<Link id="l05789" /><CodeLine lineNumber="5789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/passinfomixin">PassInfoMixin&lt;SROAPass&gt;</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)-&gt;<a href="/docs/api/classes/llvm/sroapass/#a83580fd53eefd840860e0b048e9f6d43">printPipeline</a>(</span></CodeLine>
<Link id="l05790" /><CodeLine lineNumber="5790"><span class="doxyHighlight">      OS, MapClassName2PassName);</span></CodeLine>
<Link id="l05791" /><CodeLine lineNumber="5791"><span class="doxyHighlight">  OS &lt;&lt; (PreserveCFG == <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">SROAOptions::PreserveCFG</a> ? </span><span class="doxyHighlightStringLiteral">&quot;&lt;preserve-cfg&gt;&quot;</span></CodeLine>
<Link id="l05792" /><CodeLine lineNumber="5792"><span class="doxyHighlight">                                                 : </span><span class="doxyHighlightStringLiteral">&quot;&lt;modify-cfg&gt;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05793" /><CodeLine lineNumber="5793"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05794" /><CodeLine lineNumber="5794"></CodeLine>
<Link id="l05795" /><CodeLine lineNumber="5795" lineLink="/docs/api/classes/llvm/sroapass/#ad7c554d0057ca7a875a0a8fef3d50ffa"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/sroapass/#ad7c554d0057ca7a875a0a8fef3d50ffa">SROAPass::SROAPass</a>(<a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139">SROAOptions</a> PreserveCFG) : PreserveCFG(PreserveCFG) &#123;&#125;</span></CodeLine>
<Link id="l05796" /><CodeLine lineNumber="5796"></CodeLine>
<Link id="l05797" /><CodeLine lineNumber="5797"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05798" /><CodeLine lineNumber="5798"></CodeLine>
<Link id="l05799" /><CodeLine lineNumber="5799"><span class="doxyHighlightComment">/// A legacy pass for the legacy pass manager that wraps the \\c SROA pass.</span></CodeLine>
<Link id="l05800" /><CodeLine lineNumber="5800" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a520fcf881f371ac3bae328637f513164">SROALegacyPass</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a> &#123;</span></CodeLine>
<Link id="l05801" /><CodeLine lineNumber="5801"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139">SROAOptions</a> PreserveCFG;</span></CodeLine>
<Link id="l05802" /><CodeLine lineNumber="5802"></CodeLine>
<Link id="l05803" /><CodeLine lineNumber="5803"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l05804" /><CodeLine lineNumber="5804" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a93c951bbe78e616e8ec13cae68290529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a93c951bbe78e616e8ec13cae68290529">ID</a>;</span></CodeLine>
<Link id="l05805" /><CodeLine lineNumber="5805"></CodeLine>
<Link id="l05806" /><CodeLine lineNumber="5806" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a520fcf881f371ac3bae328637f513164"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a520fcf881f371ac3bae328637f513164">SROALegacyPass</a>(<a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139">SROAOptions</a> PreserveCFG = <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">SROAOptions::PreserveCFG</a>)</span></CodeLine>
<Link id="l05807" /><CodeLine lineNumber="5807"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a93c951bbe78e616e8ec13cae68290529">ID</a>), PreserveCFG(PreserveCFG) &#123;</span></CodeLine>
<Link id="l05808" /><CodeLine lineNumber="5808"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa9565471d05a6d7bacd8d55354f973ce">initializeSROALegacyPassPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l05809" /><CodeLine lineNumber="5809"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05810" /><CodeLine lineNumber="5810"></CodeLine>
<Link id="l05811" /><CodeLine lineNumber="5811" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a8e87a8ac1e3d62aaa253240fc597f797"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a8e87a8ac1e3d62aaa253240fc597f797">runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05812" /><CodeLine lineNumber="5812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</span></CodeLine>
<Link id="l05813" /><CodeLine lineNumber="5813"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05814" /><CodeLine lineNumber="5814"></CodeLine>
<Link id="l05815" /><CodeLine lineNumber="5815"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT = <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;DominatorTreeWrapperPass&gt;</a>().getDomTree();</span></CodeLine>
<Link id="l05816" /><CodeLine lineNumber="5816"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &amp;AC =</span></CodeLine>
<Link id="l05817" /><CodeLine lineNumber="5817"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;AssumptionCacheTracker&gt;</a>().getAssumptionCache(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05818" /><CodeLine lineNumber="5818"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> DTU(DT, DomTreeUpdater::UpdateStrategy::Lazy);</span></CodeLine>
<Link id="l05819" /><CodeLine lineNumber="5819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; =</span></CodeLine>
<Link id="l05820" /><CodeLine lineNumber="5820"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa">SROA</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext(), &amp;DTU, &amp;AC, PreserveCFG).<a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroa/#a8317779540f30fe6a5dda2359f023675">runSROA</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05821" /><CodeLine lineNumber="5821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l05822" /><CodeLine lineNumber="5822"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05823" /><CodeLine lineNumber="5823"></CodeLine>
<Link id="l05824" /><CodeLine lineNumber="5824" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#aaf2dc11e06db98231687e6812f2824c0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#aaf2dc11e06db98231687e6812f2824c0">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05825" /><CodeLine lineNumber="5825"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/assumptioncachetracker">AssumptionCacheTracker</a>&gt;();</span></CodeLine>
<Link id="l05826" /><CodeLine lineNumber="5826"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l05827" /><CodeLine lineNumber="5827"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/globalsaawrapperpass">GlobalsAAWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l05828" /><CodeLine lineNumber="5828"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l05829" /><CodeLine lineNumber="5829"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05830" /><CodeLine lineNumber="5830"></CodeLine>
<Link id="l05831" /><CodeLine lineNumber="5831" lineLink="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#abd451347d0550d519218c3872cb2323d"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#abd451347d0550d519218c3872cb2323d">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;SROA&quot;</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l05832" /><CodeLine lineNumber="5832"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l05833" /><CodeLine lineNumber="5833"></CodeLine>
<Link id="l05834" /><CodeLine lineNumber="5834"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l05835" /><CodeLine lineNumber="5835"></CodeLine>
<Link id="l05836" /><CodeLine lineNumber="5836"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sroa-cpp-/sroalegacypass/#a93c951bbe78e616e8ec13cae68290529">SROALegacyPass::ID</a> = 0;</span></CodeLine>
<Link id="l05837" /><CodeLine lineNumber="5837"></CodeLine>
<Link id="l05838" /><CodeLine lineNumber="5838" lineLink="/docs/api/namespaces/llvm/#ae7e42c560dd36ec85086cc1c43b61f56"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm/#ae7e42c560dd36ec85086cc1c43b61f56">llvm::createSROAPass</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">PreserveCFG</a>) &#123;</span></CodeLine>
<Link id="l05839" /><CodeLine lineNumber="5839"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> SROALegacyPass(<a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">PreserveCFG</a> ? <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139a83b74c73aa3a3ef410382d9d1b4298a7">SROAOptions::PreserveCFG</a></span></CodeLine>
<Link id="l05840" /><CodeLine lineNumber="5840"><span class="doxyHighlight">                                        : <a href="/docs/api/namespaces/llvm/#af4e437674a39417056e3028415053139acaaa9d6e801d3edf358e569e31d9f59c">SROAOptions::ModifyCFG</a>);</span></CodeLine>
<Link id="l05841" /><CodeLine lineNumber="5841"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05842" /><CodeLine lineNumber="5842"></CodeLine>
<Link id="l05843" /><CodeLine lineNumber="5843" lineLink="#a786d5a99befacdb30b3d3b5c3b07bd30"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(SROALegacyPass, </span><span class="doxyHighlightStringLiteral">&quot;sroa&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05844" /><CodeLine lineNumber="5844"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;Scalar Replacement Of Aggregates&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l05845" /><CodeLine lineNumber="5845"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/assumptioncachetracker">AssumptionCacheTracker</a>)</span></CodeLine>
<Link id="l05846" /><CodeLine lineNumber="5846"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>)</span></CodeLine>
<Link id="l05847" /><CodeLine lineNumber="5847" lineLink="#a5b3f8e5f6c512fe6a5059dd0c51aec95"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(SROALegacyPass, </span><span class="doxyHighlightStringLiteral">&quot;sroa&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;Scalar Replacement Of Aggregates&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05848" /><CodeLine lineNumber="5848" lineLink="#acc7a95cb9fb444faf77cd626f1b8128b"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>

</ProgramListing>


</DoxygenPage>
