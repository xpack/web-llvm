---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `InstCombineCasts.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="InstCombineInternal.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ConstantFolding.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/KnownBits.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/knownbits-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/InstCombine/InstCombiner.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombiner-h"
  isLocal="true" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
</IncludesList>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9cad0d942fb5f64b2ec2ce7e7277c492">canAlwaysEvaluateInType</a> (Value &#42;V, Type &#42;Ty)</>}>
Constants and extensions/truncates from the destination type are always free to be evaluated in that type. <a href="#a9cad0d942fb5f64b2ec2ce7e7277c492">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a> (Value &#42;V, Type &#42;Ty)</>}>
Return true if we can take the specified value and return it as type Ty without inserting any new casts and without changing the value of the common low bits. <a href="#a16e1399c07ad0fea0b83eaea29c1402e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a> (Value &#42;V, Type &#42;Ty, InstCombinerImpl &amp;IC, Instruction &#42;CxtI)</>}>
Return true if we can evaluate the specified expression tree as type Ty instead of its larger type, and arrive with the same value. <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a> (Value &#42;V, Type &#42;Ty, unsigned &amp;BitsToClear, InstCombinerImpl &amp;IC, Instruction &#42;CxtI)</>}>
Determine if the specified value can be computed in the specified wider type and produce the same low bits. <a href="#a3d3ed8206aabad62293aeddd444bab9f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aaa977254b83ff622718b40f1aa81271f">canNotEvaluateInType</a> (Value &#42;V, Type &#42;Ty)</>}>
Filter out values that we can not evaluate in the destination type for free. <a href="#aaa977254b83ff622718b40f1aa81271f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a3e2793cc62829d80622b78cc681b25c2">canonicalizeBitCastExtElt</a> (BitCastInst &amp;BitCast, InstCombinerImpl &amp;IC)</>}>
Canonicalize scalar bitcasts of extracted elements into a bitcast of the vector followed by extract element. <a href="#a3e2793cc62829d80622b78cc681b25c2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a> (Value &#42;V, unsigned Shift, SmallVectorImpl&lt; Value &#42; &gt; &amp;Elements, Type &#42;VecEltTy, bool isBigEndian)</>}>
V is a value which is inserted into a vector of VecEltTy. <a href="#a01395be91e03a1a4c5fd713885d8327f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a68d58b6cb8f56c90aa445f4857a8d430">fitsInFPType</a> (ConstantFP &#42;CFP, const fltSemantics &amp;Sem)</>}>
Return a Constant&#42; for the specified floating-point constant if it fits in the specified FP type without changing its value. <a href="#a68d58b6cb8f56c90aa445f4857a8d430">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a6556e45ee27ad333bf33eda6b1f04b8a">foldBitCastBitwiseLogic</a> (BitCastInst &amp;BitCast, InstCombiner::BuilderTy &amp;Builder)</>}>
Change the type of a bitwise logic operation if we can eliminate a bitcast. <a href="#a6556e45ee27ad333bf33eda6b1f04b8a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a5d0fa3868fb321fcd4b5d632028db897">foldBitCastSelect</a> (BitCastInst &amp;BitCast, InstCombiner::BuilderTy &amp;Builder)</>}>
Change the type of a select if we can eliminate a bitcast. <a href="#a5d0fa3868fb321fcd4b5d632028db897">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a2c93d37ad765182a1bc1e43f4b967b99">foldCopySignIdioms</a> (BitCastInst &amp;CI, InstCombiner::BuilderTy &amp;Builder, const SimplifyQuery &amp;SQ)</>}>
Fold (bitcast (or (and (bitcast X to int), signmask), nneg Y) to fp) to copysign((bitcast Y to fp), X) <a href="#a2c93d37ad765182a1bc1e43f4b967b99">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a568e85197421e091a259bf80e19c6765">foldFPtoI</a> (Instruction &amp;FI, InstCombiner &amp;IC)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#aa1c33c4fbbe149ca5deb130bca410ef2">foldVecExtTruncToExtElt</a> (TruncInst &amp;Trunc, InstCombinerImpl &amp;IC)</>}>
Whenever an element is extracted from a vector, optionally shifted down, and then truncated, canonicalize by converting it to a bitcast followed by an extractelement. <a href="#aa1c33c4fbbe149ca5deb130bca410ef2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#aee3e98b16f1c8d8d8b30b9a459a6a602">foldVecTruncToExtElt</a> (TruncInst &amp;Trunc, InstCombinerImpl &amp;IC)</>}>
Given a vector that is bitcast to an integer, optionally logically right-shifted, and truncated, convert it to an extractelement. <a href="#aee3e98b16f1c8d8d8b30b9a459a6a602">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#a7bd8813787e20b5c745c2c7525ef9314">getMinimumFPType</a> (Value &#42;V, bool PreferBFloat)</>}>
Find the minimum FP type we can safely truncate to. <a href="#a7bd8813787e20b5c745c2c7525ef9314">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ac8947451998676abcce5452a1a8f5848">getTypeSizeIndex</a> (unsigned Value, Type &#42;Ty)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a24b18f2c77f69e54841c51bb3d31cad2">hasStoreUsersOnly</a> (CastInst &amp;CI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if all users of CI are StoreInsts. <a href="#a24b18f2c77f69e54841c51bb3d31cad2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aac5576a66149a9259706758d613ba555">isKnownExactCastIntToFP</a> (CastInst &amp;I, InstCombinerImpl &amp;IC)</>}>
Return true if the cast from integer to FP can be proven to be exact for all possible inputs (the conversion does not lose any precision). <a href="#aac5576a66149a9259706758d613ba555">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8efab72b40fc7836709221d3e97139c6">isMultipleOfTypeSize</a> (unsigned Value, Type &#42;Ty)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a8f948dd0c375dfeb4cdf99bc33905e66">optimizeIntegerToVectorInsertions</a> (BitCastInst &amp;CI, InstCombinerImpl &amp;IC)</>}>
If the input is an &#39;or&#39; instruction, we may be doing shifts and ors to assemble the elements of the vector manually. <a href="#a8f948dd0c375dfeb4cdf99bc33905e66">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a75e6b6bf03adf614aaf100a9afdcd612">optimizeVectorResizeWithIntegerBitCasts</a> (Value &#42;InVal, VectorType &#42;DestTy, InstCombinerImpl &amp;IC)</>}>
This input value (which is known to have vector type) is being zero extended or truncated to the specified vector type. <a href="#a75e6b6bf03adf614aaf100a9afdcd612">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#a4b773c63bff7bbf9565edd03d7864966">shrinkFPConstant</a> (ConstantFP &#42;CFP, bool PreferBFloat)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#a2f20b406ad481a5f9d33949e4ccd9f05">shrinkFPConstantVector</a> (Value &#42;V, bool PreferBFloat)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a77aac577d89abc9411adfdf918d7d539">shrinkInsertElt</a> (CastInst &amp;Trunc, InstCombiner::BuilderTy &amp;Builder)</>}>
Try to narrow the width of an insert element. <a href="#a77aac577d89abc9411adfdf918d7d539">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a40c4c6660c6d108c0202fd73c28f2834">shrinkSplatShuffle</a> (TruncInst &amp;Trunc, InstCombiner::BuilderTy &amp;Builder)</>}>
Try to narrow the width of a splat shuffle. <a href="#a40c4c6660c6d108c0202fd73c28f2834">More...</a>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### canAlwaysEvaluateInType() {#a9cad0d942fb5f64b2ec2ce7e7277c492}

<MemberDefinition
  prototype={<>static bool canAlwaysEvaluateInType (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>
Constants and extensions/truncates from the destination type are always free to be evaluated in that type.

This is a helper for canEvaluate&#42;.

Definition at line <a href="#l00231">231</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### canEvaluateSExtd() {#a16e1399c07ad0fea0b83eaea29c1402e}

<MemberDefinition
  prototype={<>static bool canEvaluateSExtd (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>
Return true if we can take the specified value and return it as type Ty without inserting any new casts and without changing the value of the common low bits.

This is used by code that tries to promote integer operations to a wider types will allow us to eliminate the extension.

This function works on both vectors and scalars.

Definition at line <a href="#l01421">1421</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### canEvaluateTruncated() {#aefd6331c5fd6ec51f6a9e5558f885f28}

<MemberDefinition
  prototype={<>static bool canEvaluateTruncated (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; CxtI)</>}
  labels = {["static"]}>
Return true if we can evaluate the specified expression tree as type Ty instead of its larger type, and arrive with the same value.

This is used by code that tries to eliminate truncates.

Ty will always be a type smaller than V. We should return true if trunc(V) can be computed by computing V in the smaller type. If V is an instruction, then trunc(inst(x,y)) can be computed as inst(trunc(x),trunc(y)), which only makes sense if x and y can be efficiently truncated.

This function works on both vectors and scalars.

Definition at line <a href="#l00267">267</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### canEvaluateZExtd() {#a3d3ed8206aabad62293aeddd444bab9f}

<MemberDefinition
  prototype={<>static bool canEvaluateZExtd (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, unsigned &amp; BitsToClear, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; CxtI)</>}
  labels = {["static"]}>
Determine if the specified value can be computed in the specified wider type and produce the same low bits.

If not, return false.

If this function returns true, it can also return a non-zero number of bits (in BitsToClear) which indicates that the value it computes is correct for the zero extend, but that the additional BitsToClear bits need to be zero&#39;d out. For example, to promote something like:

B = trunc i64 A to i32 C = lshr i32 B, 8 E = zext i32 C to i64

CanEvaluateZExtd for the &#39;lshr&#39; will return true, and BitsToClear will be set to 8 to indicate that the promoted value needs to have bits 24-31 cleared in addition to bits 32-63. Since an &#39;and&#39; will be generated to clear the top bits anyway, doing this has no extra cost.

This function works on both vectors and scalars.

Definition at line <a href="#l01066">1066</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### canNotEvaluateInType() {#aaa977254b83ff622718b40f1aa81271f}

<MemberDefinition
  prototype={<>static bool canNotEvaluateInType (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>
Filter out values that we can not evaluate in the destination type for free.

This is a helper for canEvaluate&#42;.

Definition at line <a href="#l00245">245</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### canonicalizeBitCastExtElt() {#a3e2793cc62829d80622b78cc681b25c2}

<MemberDefinition
  prototype={<>static Instruction &#42; canonicalizeBitCastExtElt (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp; BitCast, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
Canonicalize scalar bitcasts of extracted elements into a bitcast of the vector followed by extract element.

The backend tends to handle bitcasts of vectors better than bitcasts of scalars because vector registers are usually not type-specific like scalar integer or scalar floating-point.

Definition at line <a href="#l02387">2387</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### collectInsertionElements() {#a01395be91e03a1a4c5fd713885d8327f}

<MemberDefinition
  prototype={<>static bool collectInsertionElements (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, unsigned Shift, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Elements, <a href="/docs/api/classes/llvm/type">Type</a> &#42; VecEltTy, bool isBigEndian)</>}
  labels = {["static"]}>
V is a value which is inserted into a vector of VecEltTy.

Look through the value to see if we can decompose it into insertions into the vector. See the example in the comment for OptimizeIntegerToVectorInsertions for the pattern this handles. The type of V is always a non-zero multiple of VecEltTy&#39;s size. Shift is the number of bits between the lsb of V and the lsb of the vector.

This returns false if the pattern can&#39;t be matched or true if it can, filling in Elements with the elements found here.

Definition at line <a href="#l02239">2239</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### fitsInFPType() {#a68d58b6cb8f56c90aa445f4857a8d430}

<MemberDefinition
  prototype={<>static bool fitsInFPType (<a href="/docs/api/classes/llvm/constantfp">ConstantFP</a> &#42; CFP, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/fltsemantics">fltSemantics</a> &amp; Sem)</>}
  labels = {["static"]}>
Return a Constant&#42; for the specified floating-point constant if it fits in the specified FP type without changing its value.

Definition at line <a href="#l01612">1612</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### foldBitCastBitwiseLogic() {#a6556e45ee27ad333bf33eda6b1f04b8a}

<MemberDefinition
  prototype={<>static Instruction &#42; foldBitCastBitwiseLogic (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp; BitCast, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Change the type of a bitwise logic operation if we can eliminate a bitcast.

Definition at line <a href="#l02414">2414</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### foldBitCastSelect() {#a5d0fa3868fb321fcd4b5d632028db897}

<MemberDefinition
  prototype={<>static Instruction &#42; foldBitCastSelect (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp; BitCast, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Change the type of a select if we can eliminate a bitcast.

Definition at line <a href="#l02486">2486</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### foldCopySignIdioms() {#a2c93d37ad765182a1bc1e43f4b967b99}

<MemberDefinition
  prototype={<>static Value &#42; foldCopySignIdioms (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp; CI, InstCombiner::BuilderTy &amp; Builder, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp; SQ)</>}
  labels = {["static"]}>
Fold (bitcast (or (and (bitcast X to int), signmask), nneg Y) to fp) to copysign((bitcast Y to fp), X)

Definition at line <a href="#l02715">2715</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### foldFPtoI() {#a568e85197421e091a259bf80e19c6765}

<MemberDefinition
  prototype={<>static Instruction &#42; foldFPtoI (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; FI, <a href="/docs/api/classes/llvm/instcombiner">InstCombiner</a> &amp; IC)</>}
  labels = {["static"]}>

Definition at line <a href="#l01996">1996</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### foldVecExtTruncToExtElt() {#aa1c33c4fbbe149ca5deb130bca410ef2}

<MemberDefinition
  prototype={<>static Instruction &#42; foldVecExtTruncToExtElt (<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp; Trunc, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
Whenever an element is extracted from a vector, optionally shifted down, and then truncated, canonicalize by converting it to a bitcast followed by an extractelement.

Examples (little endian): trunc (extractelement &lt;4 x i64&gt; X, 0) to i32 ---&gt; extractelement &lt;8 x i32&gt; (bitcast &lt;4 x i64&gt; X to &lt;8 x i32&gt;), i32 0

trunc (lshr (extractelement &lt;4 x i32&gt; X, 0), 8) to i8 ---&gt; extractelement &lt;16 x i8&gt; (bitcast &lt;4 x i32&gt; X to &lt;16 x i8&gt;), i32 1

Definition at line <a href="#l00451">451</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### foldVecTruncToExtElt() {#aee3e98b16f1c8d8d8b30b9a459a6a602}

<MemberDefinition
  prototype={<>static Instruction &#42; foldVecTruncToExtElt (<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp; Trunc, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
Given a vector that is bitcast to an integer, optionally logically right-shifted, and truncated, convert it to an extractelement.

Example (big endian): trunc (lshr (bitcast &lt;4 x i32&gt; X to i128), 32) to i32 ---&gt; extractelement &lt;4 x i32&gt; X, 1

Definition at line <a href="#l00401">401</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### getMinimumFPType() {#a7bd8813787e20b5c745c2c7525ef9314}

<MemberDefinition
  prototype={<>static Type &#42; getMinimumFPType (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, bool PreferBFloat)</>}
  labels = {["static"]}>
Find the minimum FP type we can safely truncate to.

Definition at line <a href="#l01676">1676</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### getTypeSizeIndex() {#ac8947451998676abcce5452a1a8f5848}

<MemberDefinition
  prototype={<>static unsigned getTypeSizeIndex (unsigned Value, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>

Definition at line <a href="#l02225">2225</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### hasStoreUsersOnly() {#a24b18f2c77f69e54841c51bb3d31cad2}

<MemberDefinition
  prototype={<>static bool hasStoreUsersOnly (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp; CI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if all users of CI are StoreInsts.

Definition at line <a href="#l02529">2529</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### isKnownExactCastIntToFP() {#aac5576a66149a9259706758d613ba555}

<MemberDefinition
  prototype={<>static bool isKnownExactCastIntToFP (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp; I, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
Return true if the cast from integer to FP can be proven to be exact for all possible inputs (the conversion does not lose any precision).

Definition at line <a href="#l01704">1704</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### isMultipleOfTypeSize() {#a8efab72b40fc7836709221d3e97139c6}

<MemberDefinition
  prototype={<>static bool isMultipleOfTypeSize (unsigned Value, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>

Definition at line <a href="#l02221">2221</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### optimizeIntegerToVectorInsertions() {#a8f948dd0c375dfeb4cdf99bc33905e66}

<MemberDefinition
  prototype={<>static Value &#42; optimizeIntegerToVectorInsertions (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp; CI, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
If the input is an &#39;or&#39; instruction, we may be doing shifts and ors to assemble the elements of the vector manually.

Try to rip the code out and replace it with insertelements. This is to optimize code like this:

tmp37 = bitcast float inc to i32 tmp38 = zext i32 tmp37 to i64 tmp31 = bitcast float inc5 to i32 tmp32 = zext i32 tmp31 to i64 tmp33 = shl i64 tmp32, 32 ins35 = or i64 tmp33, tmp38 tmp43 = bitcast i64 ins35 to &lt;2 x float&gt;

Into two insertelements that do &quot;buildvector&#123;%inc, %inc5&#125;&quot;.

Definition at line <a href="#l02353">2353</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### optimizeVectorResizeWithIntegerBitCasts() {#a75e6b6bf03adf614aaf100a9afdcd612}

<MemberDefinition
  prototype={<>static Instruction &#42; optimizeVectorResizeWithIntegerBitCasts (<a href="/docs/api/classes/llvm/value">Value</a> &#42; InVal, <a href="/docs/api/classes/vectortype">VectorType</a> &#42; DestTy, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
This input value (which is known to have vector type) is being zero extended or truncated to the specified vector type.

Since the zext/trunc is done using an integer type, we have a (bitcast(cast(bitcast))) pattern, endianness will impact which end of the vector that is extended or truncated.

A vector is always stored with index 0 at the lowest address, which corresponds to the most significant bits for a big endian stored integer and the least significant bits for little endian. A trunc/zext of an integer impacts the big end of the integer. Thus, we need to add/remove elements at the front of the vector for big endian targets, and the back of the vector for little endian targets.

Try to replace it with a shuffle (and vector/vector bitcast) if possible.

The source and destination vector types may have different element types.

Definition at line <a href="#l02151">2151</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### shrinkFPConstant() {#a4b773c63bff7bbf9565edd03d7864966}

<MemberDefinition
  prototype={<>static Type &#42; shrinkFPConstant (<a href="/docs/api/classes/llvm/constantfp">ConstantFP</a> &#42; CFP, bool PreferBFloat)</>}
  labels = {["static"]}>

Definition at line <a href="#l01619">1619</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### shrinkFPConstantVector() {#a2f20b406ad481a5f9d33949e4ccd9f05}

<MemberDefinition
  prototype={<>static Type &#42; shrinkFPConstantVector (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, bool PreferBFloat)</>}
  labels = {["static"]}>

Definition at line <a href="#l01641">1641</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### shrinkInsertElt() {#a77aac577d89abc9411adfdf918d7d539}

<MemberDefinition
  prototype={<>static Instruction &#42; shrinkInsertElt (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp; Trunc, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Try to narrow the width of an insert element.

This could be generalized for any vector constant, but we limit the transform to insertion into undef to avoid potential backend problems from unsupported insertion widths. This could also be extended to handle the case of inserting a scalar constant into a vector variable.

Definition at line <a href="#l00716">716</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

### shrinkSplatShuffle() {#a40c4c6660c6d108c0202fd73c28f2834}

<MemberDefinition
  prototype={<>static Instruction &#42; shrinkSplatShuffle (<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp; Trunc, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Try to narrow the width of a splat shuffle.

This could be generalized to any shuffle with a constant operand, but we limit the transform to avoid creating a shuffle type that targets may not be able to lower effectively.

Definition at line <a href="#l00696">696</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>

Definition at line <a href="#l00026">26</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecasts-cpp">InstCombineCasts.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- InstCombineCasts.cpp -----------------------------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file implements the visit functions for cast operations.</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h">InstCombineInternal.h</a>&quot;</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h">llvm/Analysis/ConstantFolding.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/knownbits-h">llvm/Support/KnownBits.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombiner-h">llvm/Transforms/InstCombine/InstCombiner.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;instcombine&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">/// Given an expression that CanEvaluateTruncated or CanEvaluateSExtd returns</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">/// true for, actually insert the code to evaluate the expression.</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">InstCombinerImpl::EvaluateInDifferentType</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty,</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlight">                                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>) &#123;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V))</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ae45c454aff5d0478a70219bb15d369b3">ConstantFoldIntegerCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, Ty, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, it must be an instruction.</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Res = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opc = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Opc) &#123;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor:</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AShr:</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr:</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl:</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem: &#123;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>);</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>);</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlight">    Res = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>((<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a>)Opc, LHS, RHS);</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Trunc:</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ZExt:</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SExt:</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the source type of the cast is the type we&#39;re trying for then we can</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// just return the source.  There&#39;s no need to insert it because it is not</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// new.</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType() == Ty)</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, must be the same type of cast, so just reinsert a new one.</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This also handles the case of zext(trunc(x)) -&gt; zext(x).</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">    Res = <a href="/docs/api/classes/llvm/castinst/#a60c8e2860ccc428282e30bf6a4d36a2c">CastInst::CreateIntegerCast</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty,</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">                                      Opc == Instruction::SExt);</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Select: &#123;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;True = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>);</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;False = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2), Ty, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>);</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">    Res = <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), True, False);</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PHI: &#123;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OPN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(Ty, OPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>());</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = OPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V =</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(OPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i), Ty, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>);</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">      NPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(V, OPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i));</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">    Res = NPN;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPToUI:</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPToSI:</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">    Res = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a></span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(Opc), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty);</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Call:</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unsupported call!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::vscale: &#123;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getModule(), Intrinsic::vscale, &#123;Ty&#125;);</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">        Res = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Fn-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>(), Fn);</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ShuffleVector: &#123;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Ty)-&gt;getElementType();</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType());</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FixedTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(ScalarTy, VTy-&gt;getElementCount());</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), FixedTy, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>);</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op1 = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), FixedTy, <a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>);</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">    Res = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(Op0, Op1,</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">                                <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getShuffleMask());</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Can handle more cases here.</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unreachable!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">  Res-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(Res, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator());</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a></span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">InstCombinerImpl::isEliminableCastPair(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CI1,</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CI2) &#123;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = CI1-&gt;<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>();</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;MidTy = CI1-&gt;<a href="/docs/api/classes/llvm/castinst/#aeba3c4846ce91323f585f957963d8f67">getDestTy</a>();</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DstTy = CI2-&gt;<a href="/docs/api/classes/llvm/castinst/#aeba3c4846ce91323f585f957963d8f67">getDestTy</a>();</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> firstOp = CI1-&gt;<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>();</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> secondOp = CI2-&gt;<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>();</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcIntPtrTy =</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">      SrcTy-&gt;<a href="/docs/api/classes/llvm/type/#ab03652069eab17006c51f00c261a6a44">isPtrOrPtrVectorTy</a>() ? <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(SrcTy) : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;MidIntPtrTy =</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">      MidTy-&gt;<a href="/docs/api/classes/llvm/type/#ab03652069eab17006c51f00c261a6a44">isPtrOrPtrVectorTy</a>() ? <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(MidTy) : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DstIntPtrTy =</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">      DstTy-&gt;<a href="/docs/api/classes/llvm/type/#ab03652069eab17006c51f00c261a6a44">isPtrOrPtrVectorTy</a>() ? <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(DstTy) : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Res = <a href="/docs/api/classes/llvm/castinst/#a8b805c54dc1ead67b711a4b1cb72f492">CastInst::isEliminableCastPair</a>(firstOp, secondOp, SrcTy, MidTy,</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">                                                DstTy, SrcIntPtrTy, MidIntPtrTy,</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">                                                DstIntPtrTy);</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t want to form an inttoptr or ptrtoint that converts to an integer</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// type that differs from the pointer size.</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Res == Instruction::IntToPtr &amp;&amp; SrcTy != DstIntPtrTy) ||</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">      (Res == Instruction::PtrToInt &amp;&amp; DstTy != SrcIntPtrTy))</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">    Res = 0;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a>(Res);</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">/// Implement the transforms common to all CastInst visitors.</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">InstCombinerImpl::commonCastTransforms</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SrcC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(Src))</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Res = <a href="/docs/api/namespaces/llvm/#a8bf77c90e2fb57af4d4d4aab084f7052">ConstantFoldCastOperand</a>(CI.<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>(), SrcC, Ty, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>))</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(CI, Res);</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to eliminate a cast of a cast.</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CSrc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(Src)) &#123;   </span><span class="doxyHighlightComment">// A-&gt;B-&gt;C cast</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> NewOpc = isEliminableCastPair(CSrc, &amp;CI)) &#123;</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The first cast (CSrc) is eliminable so we need to fix up or replace</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the second cast (CI). CSrc will then have a good chance of being dead.</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Res = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(NewOpc, CSrc-&gt;getOperand(0), Ty);</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Point debug users of the dying cast to the new one.</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CSrc-&gt;hasOneUse())</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a9784a018b2dd6a85ee8a70f5f5ab3d02">replaceAllDbgUsesWith</a>(&#42;CSrc, &#42;Res, CI, <a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>);</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Sel = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Src)) &#123;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We are casting a select. Try to fold the cast into the select if the</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// select does not have a compare instruction with matching operand types</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or the select is likely better done in a narrow type.</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Creating a select with operands that are different sizes than its</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// condition may inhibit other folds and lead to worse codegen.</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(Sel-&gt;getCondition());</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cmp || Cmp-&gt;getOperand(0)-&gt;getType() != Sel-&gt;getType() ||</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">        (CI.<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>() == Instruction::Trunc &amp;&amp;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">         shouldChangeType(CI.<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>(), CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))) &#123;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If it&#39;s a bitcast involving vectors, make sure it has the same number</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of elements on both sides.</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI.<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>() != Instruction::BitCast ||</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;CI, <a href="/docs/api/namespaces/llvm/patternmatch/#aed04b081c4501c07d80fc69c308a0c23">m&#95;ElementWiseBitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &#123;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NV = <a href="/docs/api/classes/llvm/instcombinerimpl/#a039111728e11b1cdf25e60446ae17f2a">FoldOpIntoSelect</a>(CI, Sel)) &#123;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a9784a018b2dd6a85ee8a70f5f5ab3d02">replaceAllDbgUsesWith</a>(&#42;Sel, &#42;NV, CI, <a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>);</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NV;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are casting a PHI, then fold the cast into the PHI.</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Src)) &#123;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t do this if it would create a PHI node with an illegal type from a</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// legal type.</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Src-&gt;getType()-&gt;isIntegerTy() || !CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">        shouldChangeType(CI.<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>(), CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NV = <a href="/docs/api/classes/llvm/instcombinerimpl/#a2fc50d227d302eb98914f04bcc6634e1">foldOpIntoPhi</a>(CI, PN))</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NV;</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Canonicalize a unary shuffle after the cast if neither operation changes</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the size or element size of the input vector.</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We could allow size-changing ops if that doesn&#39;t harm codegen.</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cast (shuffle X, Mask) --&gt; shuffle (cast X), Mask</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-mask">m&#95;Mask</a>(Mask))))) &#123;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Allow scalable vectors?</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SrcTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType());</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DestTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(Ty);</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcTy &amp;&amp; DestTy &amp;&amp;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">        SrcTy-&gt;getNumElements() == DestTy-&gt;getNumElements() &amp;&amp;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">        SrcTy-&gt;getPrimitiveSizeInBits() == DestTy-&gt;getPrimitiveSizeInBits()) &#123;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastX = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateCast(CI.<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DestTy);</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(CastX, Mask);</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlightComment">/// Constants and extensions/truncates from the destination type are always</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlightComment">/// free to be evaluated in that type. This is a helper for canEvaluate&#42;.</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231" lineLink="#a9cad0d942fb5f64b2ec2ce7e7277c492"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9cad0d942fb5f64b2ec2ce7e7277c492">canAlwaysEvaluateInType</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>());</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) || <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == Ty)</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlightComment">/// Filter out values that we can not evaluate in the destination type for free.</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlightComment">/// This is a helper for canEvaluate&#42;.</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245" lineLink="#aaa977254b83ff622718b40f1aa81271f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aaa977254b83ff622718b40f1aa81271f">canNotEvaluateInType</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(V))</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t extend or shrink something that has multiple uses --  doing so</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would require duplicating the instruction which isn&#39;t profitable.</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!V-&gt;hasOneUse())</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlightComment">/// Return true if we can evaluate the specified expression tree as type Ty</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlightComment">/// instead of its larger type, and arrive with the same value.</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlightComment">/// This is used by code that tries to eliminate truncates.</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlightComment">/// Ty will always be a type smaller than V.  We should return true if trunc(V)</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlightComment">/// can be computed by computing V in the smaller type.  If V is an instruction,</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlightComment">/// then trunc(inst(x,y)) can be computed as inst(trunc(x),trunc(y)), which only</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlightComment">/// makes sense if x and y can be efficiently truncated.</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlightComment">/// This function works on both vectors and scalars.</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267" lineLink="#aefd6331c5fd6ec51f6a9e5558f885f28"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC,</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CxtI) &#123;</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9cad0d942fb5f64b2ec2ce7e7277c492">canAlwaysEvaluateInType</a>(V, Ty))</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aaa977254b83ff622718b40f1aa81271f">canNotEvaluateInType</a>(V, Ty))</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;OrigTy = V-&gt;getType();</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor:</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// These operators can all arbitrarily be extended or truncated.</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, IC, CxtI) &amp;&amp;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">           <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, IC, CxtI);</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem: &#123;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// UDiv and URem can be truncated if all the truncated bits are zero.</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">    uint32&#95;t OrigBitWidth = OrigTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">    uint32&#95;t <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Ty-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> &lt; OrigBitWidth &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected bitwidths!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> Mask = <a href="/docs/api/classes/llvm/apint/#aeaf22e8d92fd978a5eca9ab031994399">APInt::getBitsSetFrom</a>(OrigBitWidth, <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>);</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not preserve the original context instruction. Simplifying div/rem</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// based on later context may introduce a trap.</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IC.<a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Mask, 0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">        IC.<a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Mask, 0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, IC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">             <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, IC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl: &#123;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are truncating the result of this SHL, and if it&#39;s a shift of an</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// inrange amount, we can always perform a SHL in a smaller type.</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    uint32&#95;t <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Ty-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> AmtKnownBits =</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab2c2c51743fb4a1b17c59563909f3f24">llvm::computeKnownBits</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>());</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AmtKnownBits.<a href="/docs/api/structs/llvm/knownbits/#a825476b2436eb817b735fdd34ee521c4">getMaxValue</a>().<a href="/docs/api/classes/llvm/apint/#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>))</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, IC, CxtI) &amp;&amp;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">             <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, IC, CxtI);</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr: &#123;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a truncate of a logical shr, we can truncate it to a smaller</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// lshr iff we know that the bits we would otherwise be shifting in are</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// already zeros.</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: It is enough to check that the bits we would be shifting in are</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//       zero - use AmtKnownBits.getMaxValue().</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    uint32&#95;t OrigBitWidth = OrigTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    uint32&#95;t <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Ty-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> AmtKnownBits =</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab2c2c51743fb4a1b17c59563909f3f24">llvm::computeKnownBits</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>());</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> ShiftedBits = <a href="/docs/api/classes/llvm/apint/#aeaf22e8d92fd978a5eca9ab031994399">APInt::getBitsSetFrom</a>(OrigBitWidth, <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>);</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AmtKnownBits.<a href="/docs/api/structs/llvm/knownbits/#a825476b2436eb817b735fdd34ee521c4">getMaxValue</a>().<a href="/docs/api/classes/llvm/apint/#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>) &amp;&amp;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">        IC.<a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), ShiftedBits, 0, CxtI)) &#123;</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, IC, CxtI) &amp;&amp;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">             <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, IC, CxtI);</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AShr: &#123;</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a truncate of an arithmetic shr, we can truncate it to a</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// smaller ashr iff we know that all the bits from the sign bit of the</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// original type and the sign bit of the truncate type are similar.</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: It is enough to check that the bits we would be shifting in are</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//       similar to sign bit of the truncate type.</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">    uint32&#95;t OrigBitWidth = OrigTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">    uint32&#95;t <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Ty-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> AmtKnownBits =</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab2c2c51743fb4a1b17c59563909f3f24">llvm::computeKnownBits</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>());</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ShiftedBits = OrigBitWidth - <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AmtKnownBits.<a href="/docs/api/structs/llvm/knownbits/#a825476b2436eb817b735fdd34ee521c4">getMaxValue</a>().<a href="/docs/api/classes/llvm/apint/#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>) &amp;&amp;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">        ShiftedBits &lt; IC.<a href="/docs/api/classes/llvm/instcombiner/#a879221accd38e1327b8dcf596650b031">ComputeNumSignBits</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), 0, CxtI))</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, IC, CxtI) &amp;&amp;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">             <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, IC, CxtI);</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Trunc:</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trunc(trunc(x)) -&gt; trunc(x)</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ZExt:</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SExt:</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trunc(ext(x)) -&gt; ext(x) if the source type is smaller than the new dest</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trunc(ext(x)) -&gt; trunc(x) if the source type is larger than the new dest</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Select: &#123;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue(), Ty, IC, CxtI) &amp;&amp;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">           <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue(), Ty, IC, CxtI);</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PHI: &#123;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can change a phi if we can change all operands.  Note that we never</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// get into trouble with cyclic PHIs here because we only consider</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions with a single use.</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;IncValue : PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(IncValue, Ty, IC, CxtI))</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPToUI:</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPToSI: &#123;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the integer type can hold the max FP value, it is safe to cast</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// directly to that type. Otherwise, we may create poison via overflow</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that did not exist in the original code.</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;InputTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType()-&gt;getScalarType();</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fltsemantics">fltSemantics</a> &amp;Semantics = InputTy-&gt;<a href="/docs/api/classes/llvm/type/#adc21598ac33ea9d50f3a939f26a28940">getFltSemantics</a>();</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">    uint32&#95;t MinBitWidth =</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/apfloatbase/#afede4bd63799684de5d737cd51519768">APFloatBase::semanticsIntSizeInBits</a>(Semantics,</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::FPToSI);</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Ty-&gt;getScalarSizeInBits() &gt;= MinBitWidth;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ShuffleVector:</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, IC, CxtI) &amp;&amp;</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">           <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, IC, CxtI);</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Can handle more cases here.</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlightComment">/// Given a vector that is bitcast to an integer, optionally logically</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlightComment">/// right-shifted, and truncated, convert it to an extractelement.</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlightComment">/// Example (big endian):</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlightComment">///   trunc (lshr (bitcast &lt;4 x i32&gt; %X to i128), 32) to i32</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlightComment">///   ---&gt;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlightComment">///   extractelement &lt;4 x i32&gt; %X, 1</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401" lineLink="#aee3e98b16f1c8d8d8b30b9a459a6a602"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#aee3e98b16f1c8d8d8b30b9a459a6a602">foldVecTruncToExtElt</a>(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp;Trunc,</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TruncOp = Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestType = Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TruncOp-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(DestType))</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecInput = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;ShiftVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(TruncOp, <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VecInput)),</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VecInput)),</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">                                         <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(ShiftVal)))) ||</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(VecInput-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;VecType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(VecInput-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> VecWidth = VecType-&gt;getPrimitiveSizeInBits();</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestWidth = DestType-&gt;<a href="/docs/api/classes/llvm/type/#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ShiftAmount = ShiftVal ? ShiftVal-&gt;<a href="/docs/api/classes/llvm/constantint/#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>() : 0;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((VecWidth % DestWidth != 0) || (ShiftAmount % DestWidth != 0))</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the element type of the vector doesn&#39;t match the result type,</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bitcast it to a vector type that we can extract from.</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumVecElts = VecWidth / DestWidth;</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VecType-&gt;getElementType() != DestType) &#123;</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">    VecType = <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(DestType, NumVecElts);</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">    VecInput = IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(VecInput, VecType, </span><span class="doxyHighlightStringLiteral">&quot;bc&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Elt = ShiftAmount / DestWidth;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>().<a href="/docs/api/classes/llvm/datalayout/#a84c1d72001dd5f34d9a55b3a7bb8a474">isBigEndian</a>())</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">    Elt = NumVecElts - 1 - Elt;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(VecInput, IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(Elt));</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlightComment">/// Whenever an element is extracted from a vector, optionally shifted down, and</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlightComment">/// then truncated, canonicalize by converting it to a bitcast followed by an</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlightComment">/// extractelement.</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlightComment">/// Examples (little endian):</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlightComment">///   trunc (extractelement &lt;4 x i64&gt; %X, 0) to i32</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlightComment">///   ---&gt;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlightComment">///   extractelement &lt;8 x i32&gt; (bitcast &lt;4 x i64&gt; %X to &lt;8 x i32&gt;), i32 0</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlightComment">///   trunc (lshr (extractelement &lt;4 x i32&gt; %X, 0), 8) to i8</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlightComment">///   ---&gt;</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlightComment">///   extractelement &lt;16 x i8&gt; (bitcast &lt;4 x i32&gt; %X to &lt;16 x i8&gt;), i32 1</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451" lineLink="#aa1c33c4fbbe149ca5deb130bca410ef2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#aa1c33c4fbbe149ca5deb130bca410ef2">foldVecExtTruncToExtElt</a>(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp;Trunc,</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcType = Src-&gt;getType();</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DstType = Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only attempt this if we have simple aliasing of the vector elements.</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A badly fit destination size would result in an invalid cast.</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcBits = SrcType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DstBits = DstType-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TruncRatio = SrcBits / DstBits;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((SrcBits % DstBits) != 0)</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecOp;</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Cst;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;ShiftAmount = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a36633f71df7e81c6155619890e65a8b2">m&#95;ExtractElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VecOp), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(Cst)))) &amp;&amp;</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src,</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a36633f71df7e81c6155619890e65a8b2">m&#95;ExtractElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VecOp), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(Cst)),</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(ShiftAmount)))))</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VecOpTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(VecOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> VecElts = VecOpTy-&gt;getElementCount();</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">  uint64&#95;t BitCastNumElts = VecElts.getKnownMinValue() &#42; TruncRatio;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  uint64&#95;t VecOpIdx = Cst-&gt;<a href="/docs/api/classes/llvm/constantint/#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>();</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  uint64&#95;t NewIdx = IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>().<a href="/docs/api/classes/llvm/datalayout/#a84c1d72001dd5f34d9a55b3a7bb8a474">isBigEndian</a>()</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">                        ? (VecOpIdx + 1) &#42; TruncRatio - 1</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">                        : VecOpIdx &#42; TruncRatio;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust index by the whole number of truncated elements.</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShiftAmount) &#123;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check shift amount is in range and shifts a whole number of truncated</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// elements.</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShiftAmount-&gt;<a href="/docs/api/classes/llvm/apint/#af4b1ccc0b78f9da9f3f3944e06007f1d">uge</a>(SrcBits) || ShiftAmount-&gt;<a href="/docs/api/classes/llvm/apint/#a4e3a2187cacdec76028617a403c47d89">urem</a>(DstBits) != 0)</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">    uint64&#95;t IdxOfs = ShiftAmount-&gt;<a href="/docs/api/classes/llvm/apint/#a05d674becc60ba4ef8cd4dd4d38ac27a">udiv</a>(DstBits).<a href="/docs/api/classes/llvm/apint/#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>();</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">    NewIdx = IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>().<a href="/docs/api/classes/llvm/datalayout/#a84c1d72001dd5f34d9a55b3a7bb8a474">isBigEndian</a>() ? (NewIdx - IdxOfs)</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">                                              : (NewIdx + IdxOfs);</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BitCastNumElts &lt;= std::numeric&#95;limits&lt;uint32&#95;t&gt;::max() &amp;&amp;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">         NewIdx &lt;= std::numeric&#95;limits&lt;uint32&#95;t&gt;::max() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;overflow 32-bits&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BitCastTo =</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(DstType, BitCastNumElts, VecElts.isScalable());</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;BitCast = IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(VecOp, BitCastTo);</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(BitCast, IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(NewIdx));</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlightComment">/// Funnel/Rotate left/right may occur in a wider type than necessary because of</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlightComment">/// type promotion rules. Try to narrow the inputs and convert to funnel shift.</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::narrowFunnelShift(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp;Trunc) &#123;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Trunc.<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>()) ||</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">          shouldChangeType(Trunc.<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>(), Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &amp;&amp;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Don&#39;t narrow to an illegal scalar type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bail out on strange types. It is possible to handle some of these patterns</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// even with non-power-of-2 sizes, but it is not a likely scenario.</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;DestTy = Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NarrowWidth = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> WideWidth = Trunc.<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(NarrowWidth))</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, find an or&#39;d pair of opposite shifts:</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trunc (or (lshr ShVal0, ShAmt0), (shl ShVal1, ShAmt1))</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">  BinaryOperator &#42;Or0, &#42;Or1;</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae44af1eeb2e5f7a1973a4ab78963a503">m&#95;Or</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(Or0), <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(Or1)))))</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ShVal0, &#42;ShVal1, &#42;ShAmt0, &#42;ShAmt1;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Or0, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a457859e1ce3f174bb32567725e78a091">m&#95;LogicalShift</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ShVal0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ShAmt0)))) ||</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Or1, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a457859e1ce3f174bb32567725e78a091">m&#95;LogicalShift</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ShVal1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ShAmt1)))) ||</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">      Or0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Or1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>())</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Canonicalize to or(shl(ShVal0, ShAmt0), lshr(ShVal1, ShAmt1)).</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Or0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == BinaryOperator::LShr) &#123;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Or0, Or1);</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(ShVal0, ShVal1);</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(ShAmt0, ShAmt1);</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Or0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == BinaryOperator::Shl &amp;&amp;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">         Or1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == BinaryOperator::LShr &amp;&amp;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Illegal or(shift,shift) pair&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Match the shift amount operands for a funnel/rotate pattern. This always</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// matches a subtraction on the R operand.</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> matchShiftAmount = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Width) -&gt; <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42; &#123;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The shift amounts may add up to the narrow bit width:</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (shl ShVal0, L) | (lshr ShVal1, Width - L)</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a funnel shift (different operands are shifted), then the</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// shift amount can not over-shift (create poison) in the narrow type.</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxShiftAmountWidth = <a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(NarrowWidth);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">    APInt HiBitMask = ~APInt::getLowBitsSet(WideWidth, MaxShiftAmountWidth);</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShVal0 == ShVal1 || <a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(L, HiBitMask))</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(R, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(Width), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(L)))))</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The following patterns currently only work for rotation patterns.</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Add more general funnel-shift compatible patterns.</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShVal0 != ShVal1)</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The shift amount may be masked with negation:</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (shl ShVal0, (X &amp; (Width - 1))) | (lshr ShVal1, ((-X) &amp; (Width - 1)))</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = Width - 1;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(L, <a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(Mask))) &amp;&amp;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(R, <a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5d295dcffba83c3c5a17d2fb3273b434">m&#95;Neg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(Mask))))</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Same as above, but the shift amount may be extended after masking:</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(L, <a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(Mask)))) &amp;&amp;</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(R, <a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5d295dcffba83c3c5a17d2fb3273b434">m&#95;Neg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(Mask)))))</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ShAmt = matchShiftAmount(ShAmt0, ShAmt1, NarrowWidth);</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFshl = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Sub on LSHR.</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ShAmt) &#123;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    ShAmt = matchShiftAmount(ShAmt1, ShAmt0, NarrowWidth);</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">    IsFshl = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Sub on SHL.</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ShAmt)</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The right-shifted value must have high zeros in the wide type (for example</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from &#39;zext&#39;, &#39;and&#39; or &#39;shift&#39;). High bits of the left-shifted value are</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// truncated, so those do not matter.</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">  APInt HiBitMask = <a href="/docs/api/classes/llvm/apint/#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(WideWidth, WideWidth - NarrowWidth);</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(ShVal1, HiBitMask, 0, &amp;Trunc))</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust the width of ShAmt for narrowed funnel shift operation:</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - Zero-extend if ShAmt is narrower than the destination type.</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - Truncate if ShAmt is wider, discarding non-significant high-order bits.</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This prepares ShAmt for llvm.fshl.i8(trunc(ShVal), trunc(ShVal),</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// zext/trunc(ShAmt)).</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NarrowShAmt = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateZExtOrTrunc(ShAmt, DestTy);</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(ShVal0, DestTy);</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShVal0 != ShVal1)</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(ShVal1, DestTy);</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID = IsFshl ? Intrinsic::fshl : Intrinsic::fshr;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> =</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(Trunc.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), IID, DestTy);</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#123;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, NarrowShAmt&#125;);</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlightComment">/// Try to narrow the width of math or bitwise logic instructions by pulling a</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlightComment">/// truncate ahead of binary operators.</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::narrowBinOp(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp;Trunc) &#123;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SrcTy = Trunc.<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>();</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;DestTy = Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcWidth = SrcTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestWidth = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(SrcTy) &amp;&amp; !shouldChangeType(SrcTy, DestTy))</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">  BinaryOperator &#42;BinOp;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(BinOp))))</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BinOp0 = BinOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BinOp1 = BinOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>()) &#123;</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor:</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul: &#123;</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp0, <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &#123;</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (binop C, X) --&gt; binop (trunc C&#39;, X)</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;NarrowC = <a href="/docs/api/classes/llvm/constantexpr/#af238147cf5453729781a0fcc7322e1c6">ConstantExpr::getTrunc</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy);</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TruncX = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(BinOp1, DestTy);</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), NarrowC, TruncX);</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp1, <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &#123;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (binop X, C) --&gt; binop (trunc X, C&#39;)</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;NarrowC = <a href="/docs/api/classes/llvm/constantexpr/#af238147cf5453729781a0fcc7322e1c6">ConstantExpr::getTrunc</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TruncX = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(BinOp0, DestTy);</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), TruncX, NarrowC);</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp0, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy) &#123;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (binop (ext X), Y) --&gt; binop X, (trunc Y)</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NarrowOp1 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(BinOp1, DestTy);</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, NarrowOp1);</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp1, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy) &#123;</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (binop Y, (ext X)) --&gt; binop (trunc Y), X</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NarrowOp0 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(BinOp0, DestTy);</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), NarrowOp0, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr:</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AShr: &#123;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trunc (&#42;shr (trunc A), C) --&gt; trunc(&#42;shr A, C)</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp0, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp1, <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &#123;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxShiftAmt = SrcWidth - DestWidth;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the shift is small enough, all zero/sign bits created by the shift</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// are removed by the trunc.</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#afd8ce417d0ae1bee23037a373487fe42">m&#95;SpecificInt&#95;ICMP</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a>,</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">                                      APInt(SrcWidth, MaxShiftAmt)))) &#123;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldShift = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExact = OldShift-&gt;isExact();</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Constant &#42;ShAmt = <a href="/docs/api/namespaces/llvm/#ae45c454aff5d0478a70219bb15d369b3">ConstantFoldIntegerCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType(),</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">                                                      </span><span class="doxyHighlightComment">/&#42;IsSigned&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>)) &#123;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">          ShAmt = <a href="/docs/api/classes/llvm/constant/#a31dbd9cf336966a863e37c5653b6c134">Constant::mergeUndefsWith</a>(ShAmt, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Shift =</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">              OldShift-&gt;getOpcode() == Instruction::AShr</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">                  ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAShr(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, ShAmt, OldShift-&gt;getName(), IsExact)</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">                  : <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLShr(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, ShAmt, OldShift-&gt;getName(), IsExact);</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#aab3f4e42107a79ae5939cd350e77b834">CastInst::CreateTruncOrBitCast</a>(Shift, DestTy);</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">: </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;NarrowOr = narrowFunnelShift(Trunc))</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NarrowOr;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlightComment">/// Try to narrow the width of a splat shuffle. This could be generalized to any</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlightComment">/// shuffle with a constant operand, but we limit the transform to avoid</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlightComment">/// creating a shuffle type that targets may not be able to lower effectively.</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696" lineLink="#a40c4c6660c6d108c0202fd73c28f2834"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a40c4c6660c6d108c0202fd73c28f2834">shrinkSplatShuffle</a>(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp;Trunc,</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Shuf = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shuf &amp;&amp; Shuf-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ad78da75bd1f157e72100f97d1ecdc756">all&#95;equal</a>(Shuf-&gt;getShuffleMask()) &amp;&amp;</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">      Shuf-&gt;getType() == Shuf-&gt;getOperand(0)-&gt;getType()) &#123;</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trunc (shuf X, Undef, SplatMask) --&gt; shuf (trunc X), Poison, SplatMask</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trunc (shuf X, Poison, SplatMask) --&gt; shuf (trunc X), Poison, SplatMask</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowOp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(Shuf-&gt;getOperand(0), Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(NarrowOp, Shuf-&gt;getShuffleMask());</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlightComment">/// Try to narrow the width of an insert element. This could be generalized for</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlightComment">/// any vector constant, but we limit the transform to insertion into undef to</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlightComment">/// avoid potential backend problems from unsupported insertion widths. This</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlightComment">/// could also be extended to handle the case of inserting a scalar constant</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlightComment">/// into a vector variable.</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716" lineLink="#a77aac577d89abc9411adfdf918d7d539"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a77aac577d89abc9411adfdf918d7d539">shrinkInsertElt</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;Trunc,</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> Opcode = Trunc.<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>();</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == Instruction::Trunc || Opcode == Instruction::FPTrunc) &amp;&amp;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected instruction for shrinking&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InsElt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsElt || !InsElt-&gt;hasOneUse())</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestScalarTy = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>();</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecOp = InsElt-&gt;getOperand(0);</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarOp = InsElt-&gt;getOperand(1);</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Index = InsElt-&gt;getOperand(2);</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>())) &#123;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trunc   (inselt undef, X, Index) --&gt; inselt undef,   (trunc X), Index</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fptrunc (inselt undef, X, Index) --&gt; inselt undef, (fptrunc X), Index</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/undefvalue">UndefValue</a> &#42;NarrowUndef = <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(DestTy);</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowOp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5b7f6dddc76bf7954b8df6abbd974436">CreateCast</a>(Opcode, ScalarOp, DestScalarTy);</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/insertelementinst/#a3c7d92166c1f18129c2727c9dc808b29">InsertElementInst::Create</a>(NarrowUndef, NarrowOp, Index);</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a43a1d060dacb05eb645cf91ea86d7bd3"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a43a1d060dacb05eb645cf91ea86d7bd3">InstCombinerImpl::visitTrunc</a>(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &amp;Trunc) &#123;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Result = <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(Trunc))</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = Trunc.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), &#42;SrcTy = Src-&gt;getType();</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestWidth = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcWidth = SrcTy-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Attempt to truncate the entire input expression tree to the destination</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// type.   Only do this if the dest type is a simple type, don&#39;t convert the</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expression tree to something weird like i93 unless the source is also</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// strange.</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || shouldChangeType(SrcTy, DestTy)) &amp;&amp;</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">      <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(Src, DestTy, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, &amp;Trunc)) &#123;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this cast is a truncate, evaluting in a different type always</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// eliminates the cast, so it is always a win.</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;ICE: EvaluateInDifferentType converting expression type&quot;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot; to avoid cast: &quot;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">               &lt;&lt; Trunc &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(Src, DestTy, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Res-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == DestTy);</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Trunc, Res);</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For integer types, check if we can shorten the entire input expression to</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DestWidth &#42; 2, which won&#39;t allow removing the truncate, but reducing the</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// width may enable further optimizations, e.g. allowing for larger</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorization factors.</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DestITy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntegerType&gt;</a>(DestTy)) &#123;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestWidth &#42; 2 &lt; SrcWidth) &#123;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewDestTy = DestITy-&gt;getExtendedType();</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (shouldChangeType(SrcTy, NewDestTy) &amp;&amp;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">          <a href="#aefd6331c5fd6ec51f6a9e5558f885f28">canEvaluateTruncated</a>(Src, NewDestTy, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, &amp;Trunc)) &#123;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;ICE: EvaluateInDifferentType converting expression type&quot;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot; to reduce the width of operand of&quot;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">                   &lt;&lt; Trunc &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(Src, NewDestTy, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/truncinst">TruncInst</a>(Res, DestTy);</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we can simplify any instructions used by the input whose sole</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// purpose is to compute bits we don&#39;t care about.</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombinerimpl/#ab133fcc8ac42264ff3425cea7b6642bc">SimplifyDemandedInstructionBits</a>(Trunc))</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;Trunc;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestWidth == 1) &#123;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Zero = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(SrcTy);</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;C1;</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;C2;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a310fbeb4d6c1b137dfd8713d354f3d76">m&#95;Shr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a103f4e50bfeab3d598adc56e1235c241">m&#95;Power2</a>(C1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)),</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(C2))))) &#123;</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc ((C1 &lt;&lt; X) &gt;&gt; C2) to i1 --&gt; X == (C2-cttz(C1)), where C1 is pow2</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Log2C1 = ConstantInt::get(SrcTy, C1-&gt;<a href="/docs/api/classes/llvm/apint/#a6f1d5427c61a0f0159f6e85f41944c5c">exactLogBase2</a>());</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CmpC = <a href="/docs/api/classes/llvm/constantexpr/#a554ab77949b0a16670a83ec3307501eb">ConstantExpr::getSub</a>(C2, Log2C1);</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, CmpC);</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))))) &#123;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (lshr X, C) to i1 --&gt; icmp ne (and X, C&#39;), 0</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;One = ConstantInt::get(SrcTy, <a href="/docs/api/classes/llvm/apint">APInt</a>(SrcWidth, 1));</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaskC = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(One, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAnd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, MaskC);</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>, <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, Zero);</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae80cbfea2025ff7bd0770f30be6e050a">m&#95;c&#95;Or</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)),</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">                                   <a href="/docs/api/namespaces/llvm/patternmatch/#a53fc7d443cf6412add6dfddd11652e5d">m&#95;Deferred</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))))) &#123;</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (or (lshr X, C), X) to i1 --&gt; icmp ne (and X, C&#39;), 0</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;One = ConstantInt::get(SrcTy, <a href="/docs/api/classes/llvm/apint">APInt</a>(SrcWidth, 1));</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaskC = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(One, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAnd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateOr(MaskC, One));</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>, <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, Zero);</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    &#123;</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; (&#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)&#91;0&#93; == 1) &#123;</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// trunc (C &lt;&lt; X) to i1 --&gt; X == 0, where C is odd</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::Predicate::ICMP&#95;EQ</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Zero);</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Trunc.<a href="/docs/api/classes/llvm/truncinst/#aedcdbb2c0d352dd9af09e2ee3b33873c">hasNoUnsignedWrap</a>() || Trunc.<a href="/docs/api/classes/llvm/truncinst/#ab8c959a45b2f8891f96bc1242d1d41be">hasNoSignedWrap</a>()) &#123;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a1cacb72e897c55bdfd5c726d13d69af1">m&#95;Xor</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))))</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae5cf2b09af0c75d08cf9e5e8f2818a66">m&#95;SExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &#123;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AWidth = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxShiftAmt = SrcWidth - std::max(DestWidth, AWidth);</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldSh = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Src);</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExact = OldSh-&gt;isExact();</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the shift is small enough, all zero bits created by the shift are</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// removed by the trunc.</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#afd8ce417d0ae1bee23037a373487fe42">m&#95;SpecificInt&#95;ICMP</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a>,</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/apint">APInt</a>(SrcWidth, MaxShiftAmt)))) &#123;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetNewShAmt = &#91;&amp;&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Width) &#123;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;MaxAmt = ConstantInt::get(SrcTy, Width - 1, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cmp =</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a3cd3a3ec28036937ecebe767498ba55d">ConstantFoldCompareInstOperands</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, MaxAmt, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ShAmt = <a href="/docs/api/namespaces/llvm/#a11c89e0918b007ef2cf1d6b03c4b4948">ConstantFoldSelectInstruction</a>(Cmp, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, MaxAmt);</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a8bf77c90e2fb57af4d4d4aab084f7052">ConstantFoldCastOperand</a>(Instruction::Trunc, ShAmt, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType(),</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (lshr (sext A), C) --&gt; ashr A, C</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType() == DestTy) &#123;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ShAmt = GetNewShAmt(DestWidth);</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">        ShAmt = <a href="/docs/api/classes/llvm/constant/#a31dbd9cf336966a863e37c5653b6c134">Constant::mergeUndefsWith</a>(ShAmt, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsExact ? BinaryOperator::CreateExactAShr(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, ShAmt)</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">                       : BinaryOperator::CreateAShr(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, ShAmt);</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The types are mismatched, so create a cast after shifting:</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// trunc (lshr (sext A), C) --&gt; sext/trunc (ashr A, C)</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Src-&gt;hasOneUse()) &#123;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ShAmt = GetNewShAmt(AWidth);</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Shift = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAShr(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, ShAmt, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, IsExact);</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#a60c8e2860ccc428282e30bf6a4d36a2c">CastInst::CreateIntegerCast</a>(Shift, DestTy, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Mask high bits with &#39;and&#39;.</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = narrowBinOp(Trunc))</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a40c4c6660c6d108c0202fd73c28f2834">shrinkSplatShuffle</a>(Trunc, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a77aac577d89abc9411adfdf918d7d539">shrinkInsertElt</a>(Trunc, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Src-&gt;hasOneUse() &amp;&amp;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(SrcTy) || shouldChangeType(SrcTy, DestTy))) &#123;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Transform &quot;trunc (shl X, cst)&quot; -&gt; &quot;shl (trunc X), cst&quot; so long as the</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dest type is native and cst &lt; dest size.</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &amp;&amp;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a310fbeb4d6c1b137dfd8713d354f3d76">m&#95;Shr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>()))) &#123;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip shifts of shift by constants. It undoes a combine in</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FoldShiftByConstant and is the extend in reg pattern.</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> Threshold = <a href="/docs/api/classes/llvm/apint">APInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()-&gt;getScalarSizeInBits(), DestWidth);</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#afd8ce417d0ae1bee23037a373487fe42">m&#95;SpecificInt&#95;ICMP</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>, Threshold))) &#123;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewTrunc = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, DestTy, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.tr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(Instruction::Shl, NewTrunc,</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/constantexpr/#af238147cf5453729781a0fcc7322e1c6">ConstantExpr::getTrunc</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy));</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#aee3e98b16f1c8d8d8b30b9a459a6a602">foldVecTruncToExtElt</a>(Trunc, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#aa1c33c4fbbe149ca5deb130bca410ef2">foldVecExtTruncToExtElt</a>(Trunc, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trunc (ctlz&#95;i32(zext(A), B) --&gt; add(ctlz&#95;i16(A, B), C)</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::ctlz&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)),</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">                                                       <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))))) &#123;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AWidth = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AWidth == DestWidth &amp;&amp; AWidth &gt; <a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(SrcWidth)) &#123;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;WidthDiff = ConstantInt::get(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType(), SrcWidth - AWidth);</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowCtlz =</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateIntrinsic(Intrinsic::ctlz, &#123;Trunc.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()&#125;, &#123;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#125;);</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAdd(NarrowCtlz, WidthDiff);</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#aa16d8f8fe394a4a8a2fd9c0a97c616d2">m&#95;VScale</a>())) &#123;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Trunc.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>() &amp;&amp;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">        Trunc.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::VScaleRange)) &#123;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> Attr =</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">          Trunc.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(Attribute::VScaleRange);</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;unsigned&gt; MaxVScale = Attr.<a href="/docs/api/classes/llvm/attribute/#a190a29f5df3964b269383c0d6fba0ea9">getVScaleRangeMax</a>()) &#123;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(&#42;MaxVScale) &lt; DestWidth) &#123;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;VScale = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateVScale(ConstantInt::get(DestTy, 1));</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Trunc, VScale);</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestWidth == 1 &amp;&amp;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">      (Trunc.<a href="/docs/api/classes/llvm/truncinst/#aedcdbb2c0d352dd9af09e2ee3b33873c">hasNoUnsignedWrap</a>() || Trunc.<a href="/docs/api/classes/llvm/truncinst/#ab8c959a45b2f8891f96bc1242d1d41be">hasNoSignedWrap</a>()) &amp;&amp;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(Src, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;Trunc)))</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Trunc, <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(DestTy));</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Trunc.<a href="/docs/api/classes/llvm/truncinst/#ab8c959a45b2f8891f96bc1242d1d41be">hasNoSignedWrap</a>() &amp;&amp;</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instcombiner/#afe741651c79e1ff35939d1c04a3a191b">ComputeMaxSignificantBits</a>(Src, </span><span class="doxyHighlightComment">/&#42;Depth=&#42;/</span><span class="doxyHighlight">0, &amp;Trunc) &lt;= DestWidth) &#123;</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    Trunc.<a href="/docs/api/classes/llvm/truncinst/#a0032f5535d126c1dbe75d97fce9993fe">setHasNoSignedWrap</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Trunc.<a href="/docs/api/classes/llvm/truncinst/#aedcdbb2c0d352dd9af09e2ee3b33873c">hasNoUnsignedWrap</a>() &amp;&amp;</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(Src, <a href="/docs/api/classes/llvm/apint/#aeaf22e8d92fd978a5eca9ab031994399">APInt::getBitsSetFrom</a>(SrcWidth, DestWidth),</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;Depth=&#42;/</span><span class="doxyHighlight">0, &amp;Trunc)) &#123;</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">    Trunc.<a href="/docs/api/classes/llvm/truncinst/#a46376725101a52a504c685a795554d12">setHasNoUnsignedWrap</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> ? &amp;Trunc : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::transformZExtICmp(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;Cmp,</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/zextinst">ZExtInst</a> &amp;Zext) &#123;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are just checking for a icmp eq of a single bit and zext&#39;ing it</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to an integer, then shift the bit to the appropriate place and then</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cast to integer to avoid the comparison.</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This set of transforms does not check for extra uses and/or creates</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        an extra instruction (an optional final cast is not included</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        in the transform comments). We may also want to favor icmp over</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        shifts in cases of equal instructions because icmp has better</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        analysis in general (invert the transform).</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;Op1CV;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(Op1CV))) &#123;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// zext (x &lt;s  0) to i32 --&gt; x&gt;&gt;u31      true if signbit set.</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP&#95;SLT</a> &amp;&amp; Op1CV-&gt;<a href="/docs/api/classes/llvm/apint/#a49cd5939942c6665aba4cae8c220dff1">isZero</a>()) &#123;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;In = Cmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sh = ConstantInt::get(In-&gt;getType(),</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">                                   In-&gt;getType()-&gt;getScalarSizeInBits() - 1);</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">      In = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a5849d19e500f8c6713ec44889058f424">CreateLShr</a>(In, Sh, In-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.lobit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (In-&gt;getType() != Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">        In = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(In, Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;ZExt&#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Zext, In);</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// zext (X == 0) to i32 --&gt; X^1      iff X has only the low bit set.</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// zext (X == 0) to i32 --&gt; (X&gt;&gt;1)^1 iff X has only the 2nd bit set.</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// zext (X != 0) to i32 --&gt; X        iff X has only the low bit set.</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// zext (X != 0) to i32 --&gt; X&gt;&gt;1     iff X has only the 2nd bit set.</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Op1CV-&gt;<a href="/docs/api/classes/llvm/apint/#a49cd5939942c6665aba4cae8c220dff1">isZero</a>() &amp;&amp; Cmp-&gt;isEquality()) &#123;</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Exactly 1 possible 1? But not the high-bit because that is</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// canonicalized to this form.</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> Known = <a href="/docs/api/classes/llvm/instcombiner/#ae099c6fa4a0b06306ece7dd372e8d02a">computeKnownBits</a>(Cmp-&gt;getOperand(0), 0, &amp;Zext);</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> KnownZeroMask(~Known.<a href="/docs/api/structs/llvm/knownbits/#ac67bca6c764da76f5e152330d92ed916">Zero</a>);</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">      uint32&#95;t ShAmt = KnownZeroMask.logBase2();</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExpectShAmt = KnownZeroMask.isPowerOf2() &amp;&amp;</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">                           (Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/systemz/systemztargettransforminfo-cpp/#a69eeffbc38c079195008fbfb5aaad0b9">getScalarSizeInBits</a>() != ShAmt + 1);</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsExpectShAmt &amp;&amp;</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">          (Cmp-&gt;getOperand(0)-&gt;getType() == Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() ||</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">           Cmp-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> || ShAmt == 0)) &#123;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;In = Cmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShAmt) &#123;</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Perform a logical shr by shiftamt.</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Insert the shift to put the result in the low bit.</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">          In = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a5849d19e500f8c6713ec44889058f424">CreateLShr</a>(In, ConstantInt::get(In-&gt;getType(), ShAmt),</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">                                  In-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.lobit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Toggle the low bit for &quot;X == 0&quot;.</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateXor(In, ConstantInt::get(<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getType(), 1));</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getType())</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Zext, In);</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IntCast = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateIntCast(In, Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Zext, IntCast);</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;isEquality()) &#123;</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Test if a bit is clear/set using a shifted-one mask:</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// zext (icmp eq (and X, (1 &lt;&lt; ShAmt)), 0) --&gt; and (lshr (not X), ShAmt), 1</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// zext (icmp ne (and X, (1 &lt;&lt; ShAmt)), 0) --&gt; and (lshr X, ShAmt), 1</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;ShAmt;</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0),</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a1981217907f3dfb1d21e902d0396fb4d">m&#95;c&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ShAmt)), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))))) &#123;</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Shift = <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getOperand(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getOperand(0) ? 1 : 0);</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getType() ||</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate() != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> || Shift-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateNot(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Lshr = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLShr(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ShAmt);</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;And1 =</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAnd(Lshr, ConstantInt::get(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType(), 1));</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">            Zext, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateZExtOrTrunc(And1, Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlightComment">/// Determine if the specified value can be computed in the specified wider type</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlightComment">/// and produce the same low bits. If not, return false.</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlightComment">/// If this function returns true, it can also return a non-zero number of bits</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlightComment">/// (in BitsToClear) which indicates that the value it computes is correct for</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlightComment">/// the zero extend, but that the additional BitsToClear bits need to be zero&#39;d</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlightComment">/// out.  For example, to promote something like:</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlightComment">///   %B = trunc i64 %A to i32</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlightComment">///   %C = lshr i32 %B, 8</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlightComment">///   %E = zext i32 %C to i64</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlightComment">/// CanEvaluateZExtd for the &#39;lshr&#39; will return true, and BitsToClear will be</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlightComment">/// set to 8 to indicate that the promoted value needs to have bits 24-31</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlightComment">/// cleared in addition to bits 32-63.  Since an &#39;and&#39; will be generated to</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlightComment">/// clear the top bits anyway, doing this has no extra cost.</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlightComment">/// This function works on both vectors and scalars.</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066" lineLink="#a3d3ed8206aabad62293aeddd444bab9f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;BitsToClear,</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CxtI) &#123;</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">  BitsToClear = 0;</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9cad0d942fb5f64b2ec2ce7e7277c492">canAlwaysEvaluateInType</a>(V, Ty))</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aaa977254b83ff622718b40f1aa81271f">canNotEvaluateInType</a>(V, Ty))</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Tmp;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ZExt:  </span><span class="doxyHighlightComment">// zext(zext(x)) -&gt; zext(x).</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SExt:  </span><span class="doxyHighlightComment">// zext(sext(x)) -&gt; sext(x).</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Trunc: </span><span class="doxyHighlightComment">// zext(trunc(x)) -&gt; trunc(x) or zext(x)</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor:</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, BitsToClear, IC, CxtI) ||</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">        !<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, Tmp, IC, CxtI))</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// These can all be promoted if neither operand has &#39;bits to clear&#39;.</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BitsToClear == 0 &amp;&amp; Tmp == 0)</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the operation is an AND/OR/XOR and the bits to clear are zero in the</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other side, BitsToClear is ok.</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Tmp == 0 &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isBitwiseLogicOp()) &#123;</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We use MaskedValueIsZero here for generality, but the case we care</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// about the most is constant RHS.</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> VSize = V-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IC.<a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1),</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/apint/#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(VSize, BitsToClear),</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">                               0, CxtI)) &#123;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this is an And instruction and all of the BitsToClear are</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// known to be zero we can reset BitsToClear.</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::And)</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">          BitsToClear = 0;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, we don&#39;t know how to analyze this BitsToClear case yet.</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl: &#123;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can promote shl(x, cst) if we can promote x.  Since shl overwrites the</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// upper bits we can reduce BitsToClear by the shift amount.</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;Amt;</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(Amt))) &#123;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, BitsToClear, IC, CxtI))</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">      uint64&#95;t ShiftAmt = Amt-&gt;<a href="/docs/api/classes/llvm/apint/#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>();</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">      BitsToClear = ShiftAmt &lt; BitsToClear ? BitsToClear - ShiftAmt : 0;</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr: &#123;</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can promote lshr(x, cst) if we can promote x.  This requires the</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ultimate &#39;and&#39; to clear out the high zero bits we&#39;re clearing out though.</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;Amt;</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(Amt))) &#123;</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty, BitsToClear, IC, CxtI))</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">      BitsToClear += Amt-&gt;<a href="/docs/api/classes/llvm/apint/#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>();</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BitsToClear &gt; V-&gt;getType()-&gt;getScalarSizeInBits())</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">        BitsToClear = V-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Cannot promote variable LSHR.</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Select:</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty, Tmp, IC, CxtI) ||</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">        !<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2), Ty, BitsToClear, IC, CxtI) ||</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: If important, we could handle the case when the BitsToClear are</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// known zero in the disagreeing side.</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">        Tmp != BitsToClear)</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PHI: &#123;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can change a phi if we can change all operands.  Note that we never</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// get into trouble with cyclic PHIs here because we only consider</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions with a single use.</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0), Ty, BitsToClear, IC, CxtI))</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i)</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i), Ty, Tmp, IC, CxtI) ||</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// TODO: If important, we could handle the case when the BitsToClear</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// are known zero in the disagreeing input.</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">          Tmp != BitsToClear)</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Call:</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// llvm.vscale() can always be executed in larger type, because the</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value is automatically zero-extended.</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::vscale)</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Can handle more cases here.</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a2175862566372c3684fe4f7bf62e3143"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a2175862566372c3684fe4f7bf62e3143">InstCombinerImpl::visitZExt</a>(<a href="/docs/api/classes/llvm/zextinst">ZExtInst</a> &amp;Zext) &#123;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this zero extend is only used by a truncate, let the truncate be</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// eliminated before we try to optimize this zext.</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Zext.<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Zext.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Zext.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If one of the common conversion will work, do it.</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Result = <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(Zext))</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = Zext.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = Src-&gt;getType(), &#42;DestTy = Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// zext nneg bool x -&gt; 0</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcTy-&gt;isIntOrIntVectorTy(1) &amp;&amp; Zext.<a href="/docs/api/classes/llvm/instruction/#a87716cd594c6fcb3861a4044e7b594db">hasNonNeg</a>())</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Zext, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Zext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to extend the entire expression tree to the wide destination type.</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BitsToClear;</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (shouldChangeType(SrcTy, DestTy) &amp;&amp;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">      <a href="#a3d3ed8206aabad62293aeddd444bab9f">canEvaluateZExtd</a>(Src, DestTy, BitsToClear, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, &amp;Zext)) &#123;</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BitsToClear &lt;= SrcTy-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/systemz/systemztargettransforminfo-cpp/#a69eeffbc38c079195008fbfb5aaad0b9">getScalarSizeInBits</a>() &amp;&amp;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t clear more bits than in SrcTy&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, we can transform this!  Insert the new expression now.</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;ICE: EvaluateInDifferentType converting expression type&quot;</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot; to avoid zero extend: &quot;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">               &lt;&lt; Zext &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(Src, DestTy, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Res-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == DestTy);</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Preserve debug values referring to Src if the zext is its last use.</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/srcop">SrcOp</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Src))</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/srcop">SrcOp</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a9784a018b2dd6a85ee8a70f5f5ab3d02">replaceAllDbgUsesWith</a>(&#42;<a href="/docs/api/classes/llvm/srcop">SrcOp</a>, &#42;Res, Zext, <a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>);</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">    uint32&#95;t SrcBitsKept = SrcTy-&gt;getScalarSizeInBits() - BitsToClear;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">    uint32&#95;t DestBitSize = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the high bits are already filled with zeros, just replace this</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cast with the result.</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombiner/#ae506e7be0a7aaf9001e31d5fca5f2fbc">MaskedValueIsZero</a>(Res,</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/apint/#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(DestBitSize,</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">                                                DestBitSize - SrcBitsKept),</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">                             0, &amp;Zext))</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Zext, Res);</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to emit an AND to clear the high bits.</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = ConstantInt::get(Res-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/apint/#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(DestBitSize, SrcBitsKept));</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAnd(Res, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a TRUNC followed by a ZEXT then we are dealing with integral</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// types and if the sizes are just right we can convert this into a logical</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;and&#39; which will be much cheaper than the pair of casts.</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CSrc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;TruncInst&gt;</a>(Src)) &#123;   </span><span class="doxyHighlightComment">// A-&gt;B-&gt;C cast</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Subsume this into EvaluateInDifferentType.</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the sizes of the types involved.  We know that the intermediate type</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will be smaller than A or C, but don&#39;t know the relation between A and C.</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = CSrc-&gt;getOperand(0);</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcSize = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MidSize = CSrc-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DstSize = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re actually extending zero bits, then if</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SrcSize &lt;  DstSize: zext(a &amp; mask)</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SrcSize == DstSize: a &amp; mask</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SrcSize  &gt; DstSize: trunc(a) &amp; mask</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcSize &lt; DstSize) &#123;</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> AndValue(<a href="/docs/api/classes/llvm/apint/#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(SrcSize, MidSize));</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;AndConst = ConstantInt::get(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType(), AndValue);</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAnd(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, AndConst, CSrc-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/zextinst">ZExtInst</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, DestTy);</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcSize == DstSize) &#123;</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> AndValue(<a href="/docs/api/classes/llvm/apint/#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(SrcSize, MidSize));</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAnd(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, ConstantInt::get(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType(),</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">                                                           AndValue));</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcSize &gt; DstSize) &#123;</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Trunc = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, DestTy);</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> AndValue(<a href="/docs/api/classes/llvm/apint/#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(DstSize, MidSize));</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAnd(Trunc,</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">                                       ConstantInt::get(Trunc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">                                                        AndValue));</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(Src))</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> transformZExtICmp(Cmp, Zext);</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// zext(trunc(X) &amp; C) -&gt; (X &amp; zext(C)).</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy)</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAnd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateZExt(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy));</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// zext((trunc(X) &amp; C) ^ C) -&gt; ((X &amp; zext(C)) ^ zext(C)).</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>;</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a1cacb72e897c55bdfd5c726d13d69af1">m&#95;Xor</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy) &#123;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ZC = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateZExt(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy);</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateXor(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAnd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ZC), ZC);</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are truncating, masking, and then zexting back to the original type,</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that&#39;s just a mask. This is not handled by canEvaluateZextd if the</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intermediate values have extra uses. This could be generalized further for</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a non-constant mask operand.</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// zext (and (trunc X), C) --&gt; and X, (zext C)</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &amp;&amp;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy) &#123;</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ZextC = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateZExt(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy);</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAnd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ZextC);</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#aa16d8f8fe394a4a8a2fd9c0a97c616d2">m&#95;VScale</a>())) &#123;</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Zext.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>() &amp;&amp;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">        Zext.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::VScaleRange)) &#123;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> Attr =</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">          Zext.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(Attribute::VScaleRange);</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;unsigned&gt; MaxVScale = Attr.<a href="/docs/api/classes/llvm/attribute/#a190a29f5df3964b269383c0d6fba0ea9">getVScaleRangeMax</a>()) &#123;</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TypeWidth = Src-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(&#42;MaxVScale) &lt; TypeWidth) &#123;</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;VScale = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateVScale(ConstantInt::get(DestTy, 1));</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Zext, VScale);</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Zext.<a href="/docs/api/classes/llvm/instruction/#a87716cd594c6fcb3861a4044e7b594db">hasNonNeg</a>()) &#123;</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this zero extend is only used by a shift, add nneg flag.</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Zext.<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">        SrcTy-&gt;getScalarSizeInBits() &gt;</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a238ef12f09938dac4efe5ca56dc125d9">Log2&#95;64&#95;Ceil</a>(DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Zext.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aba80fdc6570c5a40cecd27fd7a06c858">m&#95;Shift</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(&amp;Zext)))) &#123;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">      Zext.<a href="/docs/api/classes/llvm/instruction/#a75e5beda8f609473a08473e574511de8">setNonNeg</a>();</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;Zext;</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(Src, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;Zext))) &#123;</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">      Zext.<a href="/docs/api/classes/llvm/instruction/#a75e5beda8f609473a08473e574511de8">setNonNeg</a>();</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;Zext;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlightComment">/// Transform (sext icmp) to bitwise / integer operations to eliminate the icmp.</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::transformSExtICmp(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;Cmp,</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/sextinst">SExtInst</a> &amp;Sext) &#123;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = Cmp-&gt;getOperand(0), &#42;Op1 = Cmp-&gt;getOperand(1);</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t bother if Op1 isn&#39;t of vector or integer type.</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Op1-&gt;getType()-&gt;isIntOrIntVectorTy())</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP&#95;SLT</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a href="/docs/api/namespaces/llvm/patternmatch/#a54d7212b9b2c57cced42037ae2fa7c61">m&#95;ZeroInt</a>())) &#123;</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sext (x &lt;s 0) --&gt; ashr x, 31 (all ones if negative)</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sh = ConstantInt::get(Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">                                 Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() - 1);</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;In = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#adc6a2686b807c18e4a7f7fc58e68d423">CreateAShr</a>(Op0, Sh, Op0-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.lobit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (In-&gt;getType() != Sext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">      In = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(In, Sext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;SExt&#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Sext, In);</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Op1C = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Op1)) &#123;</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we know that only one bit of the LHS of the icmp can be set and we</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have an equality comparison with zero or a power of 2, we can transform</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the icmp and sext into bitwise/integer operations.</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp-&gt;hasOneUse() &amp;&amp;</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">        Cmp-&gt;isEquality() &amp;&amp; (Op1C-&gt;isZero() || Op1C-&gt;getValue().isPowerOf2()))&#123;</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> Known = <a href="/docs/api/classes/llvm/instcombiner/#ae099c6fa4a0b06306ece7dd372e8d02a">computeKnownBits</a>(Op0, 0, &amp;Sext);</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> KnownZeroMask(~Known.<a href="/docs/api/structs/llvm/knownbits/#ac67bca6c764da76f5e152330d92ed916">Zero</a>);</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (KnownZeroMask.isPowerOf2()) &#123;</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;In = Cmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the icmp tests for a known zero bit we can constant fold it.</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Op1C-&gt;isZero() &amp;&amp; Op1C-&gt;getValue() != KnownZeroMask) &#123;</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> ?</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">ConstantInt::getAllOnesValue</a>(Sext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) :</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/constantint">ConstantInt</a>::getNullValue(Sext.<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>());</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Sext, V);</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Op1C-&gt;isZero() == (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>)) &#123;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// sext ((x &amp; 2^n) == 0)   -&gt; (x &gt;&gt; n) - 1</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// sext ((x &amp; 2^n) != 2^n) -&gt; (x &gt;&gt; n) - 1</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ShiftAmt = KnownZeroMask.countr&#95;zero();</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Perform a right shift to place the desired bit in the LSB.</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShiftAmt)</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLShr(In,</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">                                    ConstantInt::get(<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getType(), ShiftAmt));</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// At this point &quot;In&quot; is either 1 or 0 Subtract 1 to turn</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// &#123;1, 0&#125; -&gt; &#123;0, -1&#125;.</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAdd(In,</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">ConstantInt::getAllOnesValue</a>(<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getType()),</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;sext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// sext ((x &amp; 2^n) != 0)   -&gt; (x &lt;&lt; bitwidth-n) a&gt;&gt; bitwidth-1</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// sext ((x &amp; 2^n) == 2^n) -&gt; (x &lt;&lt; bitwidth-n) a&gt;&gt; bitwidth-1</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ShiftAmt = KnownZeroMask.countl&#95;zero();</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Perform a left shift to place the desired bit in the MSB.</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShiftAmt)</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(In,</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">                                   ConstantInt::get(<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getType(), ShiftAmt));</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Distribute the bit over the whole bit width.</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAShr(In, ConstantInt::get(<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getType(),</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">                                  KnownZeroMask.getBitWidth() - 1), </span><span class="doxyHighlightStringLiteral">&quot;sext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Sext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getType())</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Sext, In);</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#a60c8e2860ccc428282e30bf6a4d36a2c">CastInst::CreateIntegerCast</a>(In, Sext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlightComment">/&#42;SExt&#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlightComment">/// Return true if we can take the specified value and return it as type Ty</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlightComment">/// without inserting any new casts and without changing the value of the common</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlightComment">/// low bits.  This is used by code that tries to promote integer operations to</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlightComment">/// a wider types will allow us to eliminate the extension.</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlightComment">/// This function works on both vectors and scalars.</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421" lineLink="#a16e1399c07ad0fea0b83eaea29c1402e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getType()-&gt;getScalarSizeInBits() &lt; Ty-&gt;getScalarSizeInBits() &amp;&amp;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t sign extend type to a smaller type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9cad0d942fb5f64b2ec2ce7e7277c492">canAlwaysEvaluateInType</a>(V, Ty))</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aaa977254b83ff622718b40f1aa81271f">canNotEvaluateInType</a>(V, Ty))</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SExt:  </span><span class="doxyHighlightComment">// sext(sext(x)) -&gt; sext(x)</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ZExt:  </span><span class="doxyHighlightComment">// sext(zext(x)) -&gt; zext(x)</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Trunc: </span><span class="doxyHighlightComment">// sext(trunc(x)) -&gt; trunc(x) or sext(x)</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor:</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// These operators can all arbitrarily be extended if their inputs can.</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Ty) &amp;&amp;</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">           <a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty);</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//case Instruction::Shl:   TODO</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//case Instruction::LShr:  TODO</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Select:</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Ty) &amp;&amp;</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">           <a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2), Ty);</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PHI: &#123;</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can change a phi if we can change all operands.  Note that we never</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// get into trouble with cyclic PHIs here because we only consider</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions with a single use.</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;IncValue : PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a>(IncValue, Ty)) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Can handle more cases here.</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a2a5120238e6845643a37d5a4675a5342"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a2a5120238e6845643a37d5a4675a5342">InstCombinerImpl::visitSExt</a>(<a href="/docs/api/classes/llvm/sextinst">SExtInst</a> &amp;Sext) &#123;</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this sign extend is only used by a truncate, let the truncate be</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// eliminated before we try to optimize this sext.</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Sext.<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Sext.<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()))</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(Sext))</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = Sext.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = Src-&gt;getType(), &#42;DestTy = Sext.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcBitSize = SrcTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestBitSize = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the value being extended is zero or positive, use a zext instead.</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(Src, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;Sext))) &#123;</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CI = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(Instruction::ZExt, Src, DestTy);</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">    CI-&gt;setNonNeg(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CI;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to extend the entire expression tree to the wide destination type.</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (shouldChangeType(SrcTy, DestTy) &amp;&amp; <a href="#a16e1399c07ad0fea0b83eaea29c1402e">canEvaluateSExtd</a>(Src, DestTy)) &#123;</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, we can transform this!  Insert the new expression now.</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;ICE: EvaluateInDifferentType converting expression type&quot;</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot; to avoid sign extend: &quot;</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">               &lt;&lt; Sext &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab05ba39ce6e678149dabd939c9ad4c3e">EvaluateInDifferentType</a>(Src, DestTy, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Res-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == DestTy);</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the high bits are already filled with sign bit, just replace this</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cast with the result.</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombiner/#a879221accd38e1327b8dcf596650b031">ComputeNumSignBits</a>(Res, 0, &amp;Sext) &gt; DestBitSize - SrcBitSize)</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Sext, Res);</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to emit a shl + ashr to do the sign extend.</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ShAmt = ConstantInt::get(DestTy, DestBitSize-SrcBitSize);</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAShr(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(Res, ShAmt, </span><span class="doxyHighlightStringLiteral">&quot;sext&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">                                      ShAmt);</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &#123;</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the input has more sign bits than bits truncated, then convert</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// directly to final type.</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> XBitSize = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombiner/#a879221accd38e1327b8dcf596650b031">ComputeNumSignBits</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, 0, &amp;Sext) &gt; XBitSize - SrcBitSize)</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#a60c8e2860ccc428282e30bf6a4d36a2c">CastInst::CreateIntegerCast</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DestTy, </span><span class="doxyHighlightComment">/&#42; isSigned &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If input is a trunc from the destination type, then convert into shifts.</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Src-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy) &#123;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// sext (trunc X) --&gt; ashr (shl X, C), C</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ShAmt = ConstantInt::get(DestTy, DestBitSize - SrcBitSize);</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAShr(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ShAmt), ShAmt);</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are replacing shifted-in high zero bits with sign bits, convert</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the logic shift to arithmetic shift and eliminate the cast to</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// intermediate type:</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sext (trunc (lshr Y, C)) --&gt; sext/trunc (ashr Y, C)</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Src-&gt;hasOneUse() &amp;&amp;</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>),</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/patternmatch/#a3130e111d7afd5403267594141df2a46">m&#95;SpecificIntAllowPoison</a>(XBitSize - SrcBitSize)))) &#123;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ashr = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAShr(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, XBitSize - SrcBitSize);</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#a60c8e2860ccc428282e30bf6a4d36a2c">CastInst::CreateIntegerCast</a>(Ashr, DestTy, </span><span class="doxyHighlightComment">/&#42; isSigned &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(Src))</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> transformSExtICmp(Cmp, Sext);</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the input is a shl/ashr pair of a same constant, then this is a sign</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// extension from a smaller value.  If we could trust arbitrary bitwidth</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// integers, we could turn this into a truncate to the smaller bit and then</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// use a sext for the whole extension.  Since we don&#39;t, look deeper and check</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for a truncate.  If the source and dest are the same type, eliminate the</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trunc and extend and just do shifts.  For example, turn:</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %a = trunc i32 %i to i8</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %b = shl i8 %a, C</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %c = ashr i8 %b, C</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %d = sext i8 %c to i32</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into:</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %a = shl i32 %i, 32-(8-C)</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %d = ashr i32 %a, 32-(8-C)</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Eventually this could be subsumed by EvaluateInDifferentType.</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;BA = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;CA = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a0c94f3ca4234f78cf22840e79087f3f2">m&#95;AShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(BA)),</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(CA))) &amp;&amp;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">      BA-&gt;<a href="/docs/api/classes/llvm/constant/#aee0f586f3e5fc07e4c55d3e8caade9a6">isElementWiseEqual</a>(CA) &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType() == DestTy) &#123;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;WideCurrShAmt =</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a8bf77c90e2fb57af4d4d4aab084f7052">ConstantFoldCastOperand</a>(Instruction::SExt, CA, DestTy, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideCurrShAmt &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Constant folding of ImmConstant cannot fail&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NumLowbitsLeft = <a href="/docs/api/classes/llvm/constantexpr/#a554ab77949b0a16670a83ec3307501eb">ConstantExpr::getSub</a>(</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">        ConstantInt::get(DestTy, SrcTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()), WideCurrShAmt);</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewShAmt = <a href="/docs/api/classes/llvm/constantexpr/#a554ab77949b0a16670a83ec3307501eb">ConstantExpr::getSub</a>(</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">        ConstantInt::get(DestTy, DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()),</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">        NumLowbitsLeft);</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">    NewShAmt =</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant/#a31dbd9cf336966a863e37c5653b6c134">Constant::mergeUndefsWith</a>(<a href="/docs/api/classes/llvm/constant/#a31dbd9cf336966a863e37c5653b6c134">Constant::mergeUndefsWith</a>(NewShAmt, BA), CA);</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, NewShAmt, Sext.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAShr(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, NewShAmt);</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Splatting a bit of constant-index across a value:</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sext (ashr (trunc iN X to iM), M-1) to iN --&gt; ashr (shl X, N-M), N-1</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the dest type is different, use a cast (adjust use check).</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0c94f3ca4234f78cf22840e79087f3f2">m&#95;AShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)),</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(SrcBitSize - 1))))) &#123;</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;XTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType();</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> XBitSize = XTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ShlAmtC = ConstantInt::get(XTy, XBitSize - SrcBitSize);</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;AshrAmtC = ConstantInt::get(XTy, XBitSize - 1);</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XTy == DestTy)</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAShr(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ShlAmtC),</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">                                        AshrAmtC);</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(Src)-&gt;getOperand(0)-&gt;hasOneUse()) &#123;</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ashr = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAShr(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShl(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, ShlAmtC), AshrAmtC);</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#a60c8e2860ccc428282e30bf6a4d36a2c">CastInst::CreateIntegerCast</a>(Ashr, DestTy, </span><span class="doxyHighlightComment">/&#42; isSigned &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#aa16d8f8fe394a4a8a2fd9c0a97c616d2">m&#95;VScale</a>())) &#123;</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Sext.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>() &amp;&amp;</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">        Sext.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::VScaleRange)) &#123;</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> Attr =</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">          Sext.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(Attribute::VScaleRange);</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;unsigned&gt; MaxVScale = Attr.<a href="/docs/api/classes/llvm/attribute/#a190a29f5df3964b269383c0d6fba0ea9">getVScaleRangeMax</a>()) &#123;</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(&#42;MaxVScale) &lt; (SrcBitSize - 1)) &#123;</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;VScale = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateVScale(ConstantInt::get(DestTy, 1));</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Sext, VScale);</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlightComment">/// Return a Constant&#42; for the specified floating-point constant if it fits</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlightComment">/// in the specified FP type without changing its value.</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612" lineLink="#a68d58b6cb8f56c90aa445f4857a8d430"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a68d58b6cb8f56c90aa445f4857a8d430">fitsInFPType</a>(<a href="/docs/api/classes/llvm/constantfp">ConstantFP</a> &#42;CFP, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fltsemantics">fltSemantics</a> &amp;Sem) &#123;</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> losesInfo;</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apfloat">APFloat</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CFP-&gt;<a href="/docs/api/classes/llvm/constantfp/#a32aa14715eeb813d764fcf20f161f0a1">getValueAPF</a>();</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">  (void)<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.convert(Sem, <a href="/docs/api/structs/llvm/apfloatbase/#a22ed74f1ed33c4d33f524a650ea536a6">APFloat::rmNearestTiesToEven</a>, &amp;losesInfo);</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !losesInfo;</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619" lineLink="#a4b773c63bff7bbf9565edd03d7864966"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="#a4b773c63bff7bbf9565edd03d7864966">shrinkFPConstant</a>(<a href="/docs/api/classes/llvm/constantfp">ConstantFP</a> &#42;CFP, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PreferBFloat) &#123;</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CFP-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/classes/llvm/type/#a489d14cb1d049f4bcc5e3e9cdaf9c54d">Type::getPPC&#95;FP128Ty</a>(CFP-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()))</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// No constant folding of this.</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the value can be truncated to bfloat and then reextended.</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreferBFloat &amp;&amp; <a href="#a68d58b6cb8f56c90aa445f4857a8d430">fitsInFPType</a>(CFP, <a href="/docs/api/structs/llvm/apfloatbase/#ab46ff1a80ee89c9e22ca17c179a89ab1">APFloat::BFloat</a>()))</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type/#ae3aa33c6054ec18e1d6bc6466d1b4103">Type::getBFloatTy</a>(CFP-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the value can be truncated to half and then reextended.</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PreferBFloat &amp;&amp; <a href="#a68d58b6cb8f56c90aa445f4857a8d430">fitsInFPType</a>(CFP, <a href="/docs/api/structs/llvm/apfloatbase/#a86415bb448a78ef1fed893f9eb0f5d06">APFloat::IEEEhalf</a>()))</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type/#ae550f2e9436b395b614b4377ba27007f">Type::getHalfTy</a>(CFP-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the value can be truncated to float and then reextended.</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a68d58b6cb8f56c90aa445f4857a8d430">fitsInFPType</a>(CFP, <a href="/docs/api/structs/llvm/apfloatbase/#a0c5765e9acba977f6e462c2917276d8f">APFloat::IEEEsingle</a>()))</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type/#ad5e0fe0efdd88f98a5b5eb512d5351c2">Type::getFloatTy</a>(CFP-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CFP-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#aa0fd6bf3d33236279db7b707bba755f4">isDoubleTy</a>())</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// Won&#39;t shrink.</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a68d58b6cb8f56c90aa445f4857a8d430">fitsInFPType</a>(CFP, <a href="/docs/api/structs/llvm/apfloatbase/#a6ba7c3d54a5a714f7a27861ee114cce3">APFloat::IEEEdouble</a>()))</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type/#acb145f988329d1d621f73abcafea21d8">Type::getDoubleTy</a>(CFP-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t try to shrink to various long double types.</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlightComment">// Determine if this is a vector of ConstantFPs and if so, return the minimal</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlightComment">// type we can safely truncate all elements to.</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641" lineLink="#a2f20b406ad481a5f9d33949e4ccd9f05"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="#a2f20b406ad481a5f9d33949e4ccd9f05">shrinkFPConstantVector</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PreferBFloat) &#123;</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V);</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CVVTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(V-&gt;getType());</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CV || !CVVTy)</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;MinType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElts = CVVTy-&gt;getNumElements();</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For fixed-width vectors we find the minimal type by looking</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// through the constant values of the vector.</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != NumElts; ++i) &#123;</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(CV-&gt;getAggregateElement(i)))</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CFP = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ConstantFP&gt;</a>(CV-&gt;getAggregateElement(i));</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CFP)</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="#a4b773c63bff7bbf9565edd03d7864966">shrinkFPConstant</a>(CFP, PreferBFloat);</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>)</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we haven&#39;t found a type yet or this type has a larger mantissa than</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// our previous type, this is our new minimal type.</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MinType || <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;getFPMantissaWidth() &gt; MinType-&gt;<a href="/docs/api/classes/llvm/type/#ad9b99a13e459cb18bb386ddd610ecf8c">getFPMantissaWidth</a>())</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">      MinType = <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>;</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make a vector type from the minimal type.</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MinType ? <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(MinType, NumElts) : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlightComment">/// Find the minimum FP type we can safely truncate to.</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676" lineLink="#a7bd8813787e20b5c745c2c7525ef9314"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="#a7bd8813787e20b5c745c2c7525ef9314">getMinimumFPType</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PreferBFloat) &#123;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FPExt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FPExtInst&gt;</a>(V))</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FPExt-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this value is a constant, return the constant in the smallest FP type</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that can accurately represent it.  This allows us to turn</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (float)((double)X+2.0) into x+2.0f.</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CFP = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantFP&gt;</a>(V))</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="#a4b773c63bff7bbf9565edd03d7864966">shrinkFPConstant</a>(CFP, PreferBFloat))</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>;</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only correctly find a minimum type for a scalable vector when it is</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a splat. For splats of constant values the fpext is wrapped up as a</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ConstantExpr.</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FPCExt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(V))</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FPCExt-&gt;getOpcode() == Instruction::FPExt)</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FPCExt-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to shrink a vector of FP constants. This returns nullptr on scalable</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectors</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="#a2f20b406ad481a5f9d33949e4ccd9f05">shrinkFPConstantVector</a>(V, PreferBFloat))</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>;</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V-&gt;getType();</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlightComment">/// Return true if the cast from integer to FP can be proven to be exact for all</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlightComment">/// possible inputs (the conversion does not lose any precision).</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704" lineLink="#aac5576a66149a9259706758d613ba555"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aac5576a66149a9259706758d613ba555">isKnownExactCastIntToFP</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">CastInst::CastOps</a> Opcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode();</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == CastInst::SIToFP || Opcode == CastInst::UIToFP) &amp;&amp;</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0);</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = Src-&gt;getType();</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;FPTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType();</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned = Opcode == Instruction::SIToFP;</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SrcSize = (int)SrcTy-&gt;getScalarSizeInBits() - IsSigned;</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Easy case - if the source integer type has less bits than the FP mantissa,</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then the cast must be exact.</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> DestNumSigBits = FPTy-&gt;<a href="/docs/api/classes/llvm/type/#ad9b99a13e459cb18bb386ddd610ecf8c">getFPMantissaWidth</a>();</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcSize &lt;= DestNumSigBits)</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cast from FP to integer and back to FP is independent of the intermediate</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// integer width because of poison on overflow.</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#aa1ded8caa281d13280c0adcd27725c2f">m&#95;FPToSI</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))) || <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a4b144a6c82c6a71220053776b22d2c28">m&#95;FPToUI</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)))) &#123;</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is uitofp (fptosi F), the source needs an extra bit to avoid</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// potential rounding of negative FP input values.</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SrcNumSigBits = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getType()-&gt;getFPMantissaWidth();</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSigned &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#aa1ded8caa281d13280c0adcd27725c2f">m&#95;FPToSI</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">      SrcNumSigBits++;</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#91;su&#93;itofp (fpto&#91;su&#93;i F) --&gt; exact if the source type has less or equal</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// significant bits than the destination (and make sure neither type is</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// weird -- ppc&#95;fp128).</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcNumSigBits &gt; 0 &amp;&amp; DestNumSigBits &gt; 0 &amp;&amp;</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">        SrcNumSigBits &lt;= DestNumSigBits)</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO:</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try harder to find if the source integer type has less significant bits.</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For example, compute number of sign bits.</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> SrcKnown = IC.<a href="/docs/api/classes/llvm/instcombiner/#ae099c6fa4a0b06306ece7dd372e8d02a">computeKnownBits</a>(Src, 0, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SigBits = (int)SrcTy-&gt;getScalarSizeInBits() -</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">                SrcKnown.<a href="/docs/api/structs/llvm/knownbits/#a7f47812e8e75b0616a97d7004e5fb909">countMinLeadingZeros</a>() -</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">                SrcKnown.<a href="/docs/api/structs/llvm/knownbits/#a1eeff70353694cb360b2893553c18e7d">countMinTrailingZeros</a>();</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SigBits &lt;= DestNumSigBits)</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a7eb1707b3b9ea994955ac9d230535261"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a7eb1707b3b9ea994955ac9d230535261">InstCombinerImpl::visitFPTrunc</a>(<a href="/docs/api/classes/llvm/fptruncinst">FPTruncInst</a> &amp;FPT) &#123;</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(FPT))</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have fptrunc(OpI (fpextend x), (fpextend y)), we would like to</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplify this expression to avoid one or more of the trunc/extend</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operations if we can do so without changing the numerical results.</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The exact manner in which the widths of the operands interact to limit</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// what we can and cannot do safely varies from operation to operation, and</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is explained below in the various case statements.</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = FPT.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(FPT.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO &amp;&amp; BO-&gt;hasOneUse()) &#123;</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;LHSMinType =</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">        <a href="#a7bd8813787e20b5c745c2c7525ef9314">getMinimumFPType</a>(BO-&gt;getOperand(0), </span><span class="doxyHighlightComment">/&#42;PreferBFloat=&#42;/</span><span class="doxyHighlight">Ty-&gt;isBFloatTy());</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;RHSMinType =</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">        <a href="#a7bd8813787e20b5c745c2c7525ef9314">getMinimumFPType</a>(BO-&gt;getOperand(1), </span><span class="doxyHighlightComment">/&#42;PreferBFloat=&#42;/</span><span class="doxyHighlight">Ty-&gt;isBFloatTy());</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpWidth = BO-&gt;getType()-&gt;getFPMantissaWidth();</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LHSWidth = LHSMinType-&gt;<a href="/docs/api/classes/llvm/type/#ad9b99a13e459cb18bb386ddd610ecf8c">getFPMantissaWidth</a>();</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RHSWidth = RHSMinType-&gt;<a href="/docs/api/classes/llvm/type/#ad9b99a13e459cb18bb386ddd610ecf8c">getFPMantissaWidth</a>();</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcWidth = std::max(LHSWidth, RHSWidth);</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DstWidth = Ty-&gt;getFPMantissaWidth();</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (BO-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">: </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FAdd:</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FSub:</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For addition and subtraction, the infinitely precise result can</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// essentially be arbitrarily wide; proving that double rounding</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// will not occur because the result of OpI is exact (as we will for</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FMul, for example) is hopeless.  However, we &#42;can&#42; nonetheless</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// frequently know that double rounding cannot occur (or that it is</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// innocuous) by taking advantage of the specific structure of</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// infinitely-precise results that admit double rounding.</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Specifically, if OpWidth &gt;= 2&#42;DstWdith+1 and DstWidth is sufficient</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to represent both sources, we can guarantee that the double</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// rounding is innocuous (See p50 of Figueroa&#39;s 2000 PhD thesis,</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// &quot;A Rigorous Framework for Fully Supporting the IEEE Standard ...&quot;</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// for proof of this fact).</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Note: Figueroa does not consider the case where DstFormat !=</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// SrcFormat.  It&#39;s possible (likely even!) that this analysis</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// could be tightened for those cases, but they are rare (the main</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// case of interest here is (float)((double)float + float)).</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpWidth &gt;= 2&#42;DstWidth+1 &amp;&amp; DstWidth &gt;= SrcWidth) &#123;</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(0), Ty);</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(1), Ty);</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RI = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BO-&gt;getOpcode(), LHS, RHS);</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">          RI-&gt;<a href="/docs/api/classes/llvm/instruction/#a24a7664d83746bcda035bddeb773eaae">copyFastMathFlags</a>(BO);</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RI;</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FMul:</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For multiplication, the infinitely precise result has at most</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// LHSWidth + RHSWidth significant bits; if OpWidth is sufficient</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// that such a value can be exactly represented, then no double</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// rounding can possibly occur; we can safely perform the operation</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// in the destination format if it can represent both sources.</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpWidth &gt;= LHSWidth + RHSWidth &amp;&amp; DstWidth &gt;= SrcWidth) &#123;</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(0), Ty);</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(1), Ty);</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a9ed325338b1b10d9eb5d0daa29474b4d">BinaryOperator::CreateFMulFMF</a>(LHS, RHS, BO);</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FDiv:</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For division, we use again use the bound from Figueroa&#39;s</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// dissertation.  I am entirely certain that this bound can be</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// tightened in the unbalanced operand case by an analysis based on</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the diophantine rational approximation bound, but the well-known</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// condition used here is a good conservative first pass.</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: Tighten bound via rigorous analysis of the unbalanced case.</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpWidth &gt;= 2&#42;DstWidth &amp;&amp; DstWidth &gt;= SrcWidth) &#123;</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(0), Ty);</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(1), Ty);</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#ab2f94c836428e78d253e63f8b2d3e609">BinaryOperator::CreateFDivFMF</a>(LHS, RHS, BO);</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FRem: &#123;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remainder is straightforward.  Remainder is always exact, so the</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// type of OpI doesn&#39;t enter into things at all.  We simply evaluate</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// in whichever source type is larger, then convert to the</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// destination type.</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcWidth == OpWidth)</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS, &#42;RHS;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LHSWidth == SrcWidth) &#123;</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">           LHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(0), LHSMinType);</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">           RHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(1), LHSMinType);</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">           LHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(0), RHSMinType);</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">           RHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(BO-&gt;getOperand(1), RHSMinType);</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExactResult = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFRemFMF(LHS, RHS, BO);</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#a877d5d2a2a1ab4fd979e1d3de94404b7">CastInst::CreateFPCast</a>(ExactResult, Ty);</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (fptrunc (fneg x)) -&gt; (fneg (fptrunc x))</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(FPT.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasOneUse()) &#123;</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/fastmathflags">FastMathFlags</a> FMF = FPT.<a href="/docs/api/classes/llvm/instruction/#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>();</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FPMO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FPMathOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">      FMF &amp;= FPMO-&gt;getFastMathFlags();</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#aba7473bfa862dd9eadf04a6fefc6aa69">m&#95;FNeg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &#123;</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;InnerTrunc = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTruncFMF(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Ty, FMF);</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Neg = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFNegFMF(InnerTrunc, FMF);</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FPT, Neg);</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are truncating a select that has an extended operand, we can</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// narrow the other operand and do the select as a narrow op.</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a66f6b638df59d75afc83d660a173f53d">m&#95;FPExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))) &amp;&amp;</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == Ty) &#123;</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// fptrunc (select Cond, (fpext X), Y --&gt; select Cond, X, (fptrunc Y)</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowY = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTruncFMF(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Ty, FMF);</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sel =</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSelectFMF(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, NarrowY, FMF, </span><span class="doxyHighlightStringLiteral">&quot;narrow.sel&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FPT, Sel);</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a66f6b638df59d75afc83d660a173f53d">m&#95;FPExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == Ty) &#123;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// fptrunc (select Cond, Y, (fpext X) --&gt; select Cond, (fptrunc Y), X</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowY = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTruncFMF(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Ty, FMF);</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sel =</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSelectFMF(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NarrowY, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, FMF, </span><span class="doxyHighlightStringLiteral">&quot;narrow.sel&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FPT, Sel);</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(FPT.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))) &#123;</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">: </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::ceil:</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::fabs:</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::floor:</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::nearbyint:</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::rint:</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::round:</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::roundeven:</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::trunc: &#123;</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0);</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Src-&gt;hasOneUse())</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Except for fabs, this transformation requires the input of the unary FP</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// operation to be itself an fpext from the type to which we&#39;re</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// truncating.</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() != Intrinsic::fabs) &#123;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/fpextinst">FPExtInst</a> &#42;FPExtSrc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FPExtInst&gt;</a>(Src);</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FPExtSrc || FPExtSrc-&gt;<a href="/docs/api/classes/llvm/castinst/#a01cc70c1e8052996fb44f59fa63a015c">getSrcTy</a>() != Ty)</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Do unary FP operation on smaller type.</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (fptrunc (fabs x)) -&gt; (fabs (fptrunc x))</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;InnerTrunc = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFPTrunc(Src, Ty);</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;Overload = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">          FPT.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID(), Ty);</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getOperandBundlesAsDefs(OpBundles);</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewCI =</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Overload, &#123;InnerTrunc&#125;, OpBundles, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getName());</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">      NewCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a24a7664d83746bcda035bddeb773eaae">copyFastMathFlags</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewCI;</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a77aac577d89abc9411adfdf918d7d539">shrinkInsertElt</a>(FPT, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = FPT.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SIToFPInst&gt;</a>(Src) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UIToFPInst&gt;</a>(Src)) &#123;</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FPCast = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(Src);</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aac5576a66149a9259706758d613ba555">isKnownExactCastIntToFP</a>(&#42;FPCast, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(FPCast-&gt;getOpcode(), FPCast-&gt;getOperand(0), Ty);</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938" lineLink="/docs/api/classes/llvm/instcombinerimpl/#abdfda4087597a7f3a1f6af6de43c30da"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#abdfda4087597a7f3a1f6af6de43c30da">InstCombinerImpl::visitFPExt</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;FPExt) &#123;</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the source operand is a cast from integer to FP and known exact, then</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cast the integer operand directly to the destination type.</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = FPExt.getType();</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = FPExt.getOperand(0);</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SIToFPInst&gt;</a>(Src) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UIToFPInst&gt;</a>(Src)) &#123;</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FPCast = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(Src);</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aac5576a66149a9259706758d613ba555">isKnownExactCastIntToFP</a>(&#42;FPCast, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(FPCast-&gt;getOpcode(), FPCast-&gt;getOperand(0), Ty);</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(FPExt);</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlightComment">/// fpto&#123;s/u&#125;i(&#123;u/s&#125;itofp(X)) --&gt; X or zext(X) or sext(X) or trunc(X)</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlightComment">/// This is safe if the intermediate type has enough bits in its mantissa to</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlightComment">/// accurately represent all values of X.  For example, this won&#39;t work with</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlightComment">/// i64 -&gt; float -&gt; i64.</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a78d5bb4c6437373debabeb3f816645cb"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a78d5bb4c6437373debabeb3f816645cb">InstCombinerImpl::foldItoFPtoI</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;FI) &#123;</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UIToFPInst&gt;</a>(FI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SIToFPInst&gt;</a>(FI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(FI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = OpI-&gt;getOperand(0);</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;XType = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType();</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestType = FI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsOutputSigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPToSIInst&gt;</a>(FI);</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we can assume the conversion won&#39;t overflow, our decision as to</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// whether the input will fit in the float should depend on the minimum</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the input range and output range.</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This means this is also safe for a signed input and unsigned output, since</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a negative input would lead to undefined behavior.</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aac5576a66149a9259706758d613ba555">isKnownExactCastIntToFP</a>(&#42;OpI, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The first cast may not round exactly based on the source integer width</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and FP width, but the overflow UB rules can still allow this to fold.</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the destination type is narrow, that means the intermediate FP value</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// must be large enough to hold the source value exactly.</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For example, (uint8&#95;t)((float)(uint32&#95;t 16777217) is undefined behavior.</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> OutputSize = (int)DestType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutputSize &gt; OpI-&gt;getType()-&gt;getFPMantissaWidth())</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt; XType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()) &#123;</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsInputSigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SIToFPInst&gt;</a>(OpI);</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsInputSigned &amp;&amp; IsOutputSigned)</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/sextinst">SExtInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DestType);</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/zextinst">ZExtInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DestType);</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &lt; XType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>())</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/truncinst">TruncInst</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, DestType);</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(XType == DestType &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected types for int to FP to int casts&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FI, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996" lineLink="#a568e85197421e091a259bf80e19c6765"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a568e85197421e091a259bf80e19c6765">foldFPtoI</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;FI, <a href="/docs/api/classes/llvm/instcombiner">InstCombiner</a> &amp;IC) &#123;</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fpto&#123;u/s&#125;i non-norm --&gt; 0</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1d">FPClassTest</a> Mask =</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">      FI.<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::FPToUI ? <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1da052ace75708c251359ff22dd036417a6">fcPosNormal</a> : <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1dadb8c9ce3197adf47c7f889bab120b77c">fcNormal</a>;</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/knownfpclass">KnownFPClass</a> FPClass =</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ae24d4b778b2ebb07dee151d37e2ffdf3">computeKnownFPClass</a>(FI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Mask, </span><span class="doxyHighlightComment">/&#42;Depth=&#42;/</span><span class="doxyHighlight">0,</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">                          IC.<a href="/docs/api/classes/llvm/instcombiner/#af56f7a148b00922368e55ab9c4948724">getSimplifyQuery</a>().<a href="/docs/api/structs/llvm/simplifyquery/#a505cdf903e17bf9be677769bf0980adc">getWithInstruction</a>(&amp;FI));</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FPClass.<a href="/docs/api/structs/llvm/knownfpclass/#aa0fbe688ffb115395a2665499c0639a2">isKnownNever</a>(Mask))</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IC.<a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FI, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">ConstantInt::getNullValue</a>(FI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a9ac14c99f4eb098f5ee3ee89908591b3"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a9ac14c99f4eb098f5ee3ee89908591b3">InstCombinerImpl::visitFPToUI</a>(<a href="/docs/api/classes/llvm/fptouiinst">FPToUIInst</a> &amp;FI) &#123;</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a78d5bb4c6437373debabeb3f816645cb">foldItoFPtoI</a>(FI))</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a568e85197421e091a259bf80e19c6765">foldFPtoI</a>(FI, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(FI);</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a3c0817ca836dbd28642d4f5b2072705a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a3c0817ca836dbd28642d4f5b2072705a">InstCombinerImpl::visitFPToSI</a>(<a href="/docs/api/classes/llvm/fptosiinst">FPToSIInst</a> &amp;FI) &#123;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a78d5bb4c6437373debabeb3f816645cb">foldItoFPtoI</a>(FI))</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a568e85197421e091a259bf80e19c6765">foldFPtoI</a>(FI, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(FI);</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a4d45f96f90c7ddd805c6bae2949077de"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a4d45f96f90c7ddd805c6bae2949077de">InstCombinerImpl::visitUIToFP</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(CI))</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R;</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI.<a href="/docs/api/classes/llvm/instruction/#a87716cd594c6fcb3861a4044e7b594db">hasNonNeg</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>)) &#123;</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">    CI.<a href="/docs/api/classes/llvm/instruction/#a75e5beda8f609473a08473e574511de8">setNonNeg</a>();</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;CI;</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a5c5efa376b5dcc0c0b0628d89882a498"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a5c5efa376b5dcc0c0b0628d89882a498">InstCombinerImpl::visitSIToFP</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(CI))</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R;</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>)) &#123;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI =</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(Instruction::UIToFP, CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">    UI-&gt;setNonNeg(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UI;</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a9567d315d63f844326900f461f5b3d7a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a9567d315d63f844326900f461f5b3d7a">InstCombinerImpl::visitIntToPtr</a>(<a href="/docs/api/classes/llvm/inttoptrinst">IntToPtrInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the source integer type is not the intptr&#95;t type for this target, do a</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trunc or zext to the intptr&#95;t type, then inttoptr of it.  This allows the</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cast to be exposed to other transforms.</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = CI.<a href="/docs/api/classes/llvm/inttoptrinst/#a69434c1c574013fb2765bd2c5b27cc7b">getAddressSpace</a>();</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() !=</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getPointerSizeInBits(AS)) &#123;</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a8fa51d3da96615af400274e9cd272df4">getWithNewType</a>(</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIntPtrType(CI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), AS));</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateZExtOrTrunc(CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Ty);</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inttoptrinst">IntToPtrInst</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(CI))</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a50b0daca4f05a8d2af14aec07f64f3cc"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a50b0daca4f05a8d2af14aec07f64f3cc">InstCombinerImpl::visitPtrToInt</a>(<a href="/docs/api/classes/llvm/ptrtointinst">PtrToIntInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the destination integer type is not the intptr&#95;t type for this target,</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// do a ptrtoint to intptr&#95;t then do a trunc or zext.  This allows the cast</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to be exposed to other transforms.</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/srcop">SrcOp</a> = CI.<a href="/docs/api/classes/llvm/ptrtointinst/#a220f067bbc33b6db6cc2c7ff5a912902">getPointerOperand</a>();</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = <a href="/docs/api/classes/llvm/srcop">SrcOp</a>-&gt;getType();</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = CI.<a href="/docs/api/classes/llvm/ptrtointinst/#a378cf64c77de950ae67fc6e279e34620">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TySize = Ty-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PtrSize = <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getPointerSizeInBits(AS);</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TySize != PtrSize) &#123;</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntPtrTy =</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">        SrcTy-&gt;<a href="/docs/api/classes/llvm/type/#a8fa51d3da96615af400274e9cd272df4">getWithNewType</a>(<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIntPtrType(CI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), AS));</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreatePtrToInt(<a href="/docs/api/classes/llvm/srcop">SrcOp</a>, IntPtrTy);</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#a60c8e2860ccc428282e30bf6a4d36a2c">CastInst::CreateIntegerCast</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, Ty, </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (ptrtoint (ptrmask P, M))</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    -&gt; (and (ptrtoint P), M)</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is generally beneficial as &#96;and&#96; is better supported than &#96;ptrmask&#96;.</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, &#42;Mask;</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/classes/llvm/srcop">SrcOp</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::ptrmask&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>),</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">                                                            <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Mask)))) &amp;&amp;</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">      Mask-&gt;getType() == Ty)</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateAnd(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreatePtrToInt(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Ty), Mask);</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GEPOperator&gt;</a>(<a href="/docs/api/classes/llvm/srcop">SrcOp</a>)) &#123;</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fold ptrtoint(gep null, x) to multiply + constant if the GEP has one use.</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// While this can increase the number of instructions it doesn&#39;t actually</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// increase the overall complexity since the arithmetic is just part of</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the GEP otherwise.</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasOneUse() &amp;&amp;</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand())) &#123;</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(CI,</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateIntCast(EmitGEPOffset(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>), Ty,</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">                                                       </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (ptrtoint (gep (inttoptr Base), ...)) -&gt; Base + Offset</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>;</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasOneUse() &amp;&amp;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand(), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae9c3e701f938484416dc3b349c2765a3">m&#95;IntToPtr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType() == Ty) &#123;</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = EmitGEPOffset(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewOp = BinaryOperator::CreateAdd(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">      NewOp-&gt;setHasNoUnsignedWrap(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasNoUnsignedWrap());</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewOp;</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Vec, &#42;Scalar, &#42;Index;</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/classes/llvm/srcop">SrcOp</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae9c3e701f938484416dc3b349c2765a3">m&#95;IntToPtr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Vec)),</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Scalar), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Index)))) &amp;&amp;</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">      Vec-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == Ty) &#123;</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Vec-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == PtrSize &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Wrong type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Convert the scalar to int followed by insert to eliminate one cast:</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// p2i (ins (i2p Vec), Scalar, Index --&gt; ins Vec, (p2i Scalar), Index</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCast = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreatePtrToInt(Scalar, Ty-&gt;getScalarType());</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/insertelementinst/#a3c7d92166c1f18129c2727c9dc808b29">InsertElementInst::Create</a>(Vec, NewCast, Index);</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(CI);</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlightComment">/// This input value (which is known to have vector type) is being zero extended</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlightComment">/// or truncated to the specified vector type. Since the zext/trunc is done</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlightComment">/// using an integer type, we have a (bitcast(cast(bitcast))) pattern,</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlightComment">/// endianness will impact which end of the vector that is extended or</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlightComment">/// truncated.</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlightComment">/// A vector is always stored with index 0 at the lowest address, which</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlightComment">/// corresponds to the most significant bits for a big endian stored integer and</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlightComment">/// the least significant bits for little endian. A trunc/zext of an integer</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlightComment">/// impacts the big end of the integer. Thus, we need to add/remove elements at</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlightComment">/// the front of the vector for big endian targets, and the back of the vector</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlightComment">/// for little endian targets.</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlightComment">/// Try to replace it with a shuffle (and vector/vector bitcast) if possible.</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlightComment">/// The source and destination vector types may have different element types.</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151" lineLink="#a75e6b6bf03adf614aaf100a9afdcd612"><span class="doxyHighlight"><a href="#a75e6b6bf03adf614aaf100a9afdcd612">optimizeVectorResizeWithIntegerBitCasts</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal, <a href="/docs/api/classes/vectortype">VectorType</a> &#42;DestTy,</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only do this optimization if the output is a multiple of the input</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// element size, or the input is a multiple of the output element size.</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert the input type to have the same element type as the output.</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;SrcTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(InVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcTy-&gt;getElementType() != DestTy-&gt;getElementType()) &#123;</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The input types don&#39;t need to be identical, but for now they must be the</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// same size.  There is no specific reason we couldn&#39;t handle things like</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &lt;4 x i16&gt; -&gt; &lt;4 x i32&gt; by bitcasting to &lt;2 x i32&gt; but haven&#39;t gotten</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// there yet.</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcTy-&gt;getElementType()-&gt;getPrimitiveSizeInBits() !=</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">        DestTy-&gt;getElementType()-&gt;getPrimitiveSizeInBits())</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">    SrcTy =</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(DestTy-&gt;getElementType(),</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SrcTy)-&gt;getNumElements());</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">    InVal = IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(InVal, SrcTy);</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsBigEndian = IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>().<a href="/docs/api/classes/llvm/datalayout/#a84c1d72001dd5f34d9a55b3a7bb8a474">isBigEndian</a>();</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SrcElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(SrcTy)-&gt;getNumElements();</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(DestTy)-&gt;getNumElements();</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SrcElts != DestElts &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Element counts should be different.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that the element types match, get the shuffle mask and RHS of the</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// shuffle to use, which depends on whether we&#39;re increasing or decreasing the</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size of the input.</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ShuffleMaskStorage = <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">llvm::to&#95;vector&lt;16&gt;</a>(<a href="/docs/api/namespaces/llvm/#adc4eb8be6f7a12ede962987fb9cabb47">llvm::seq&lt;int&gt;</a>(0, SrcElts));</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> ShuffleMask;</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V2;</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcElts &gt; DestElts) &#123;</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re shrinking the number of elements (rewriting an integer</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// truncate), just shuffle in the elements corresponding to the least</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// significant bits from the input and use poison as the second shuffle</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// input.</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">    V2 = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(SrcTy);</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure the shuffle mask selects the &quot;least significant bits&quot; by</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// keeping elements from back of the src vector for big endian, and from the</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// front for little endian.</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">    ShuffleMask = ShuffleMaskStorage;</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsBigEndian)</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">      ShuffleMask = ShuffleMask.<a href="/docs/api/classes/llvm/arrayref/#ac1f72f67a93986bb68c8b7f8a2dba4ba">take&#95;back</a>(DestElts);</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">      ShuffleMask = ShuffleMask.<a href="/docs/api/classes/llvm/arrayref/#a33da2ddf6f447892591c86d9d3771b9c">take&#95;front</a>(DestElts);</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re increasing the number of elements (rewriting an integer zext),</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// shuffle in all of the elements from InVal. Fill the rest of the result</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// elements with zeros from a constant zero.</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">    V2 = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(SrcTy);</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Use first elt from V2 when indicating zero in the shuffle mask.</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">    uint32&#95;t NullElt = SrcElts;</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Extend with null values in the &quot;most significant bits&quot; by adding elements</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in front of the src vector for big endian, and at the back for little</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// endian.</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DeltaElts = DestElts - SrcElts;</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsBigEndian)</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">      ShuffleMaskStorage.insert(ShuffleMaskStorage.begin(), DeltaElts, NullElt);</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">      ShuffleMaskStorage.append(DeltaElts, NullElt);</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">    ShuffleMask = ShuffleMaskStorage;</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(InVal, V2, ShuffleMask);</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221" lineLink="#a8efab72b40fc7836709221d3e97139c6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a8efab72b40fc7836709221d3e97139c6">isMultipleOfTypeSize</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> % Ty-&gt;getPrimitiveSizeInBits() == 0;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225" lineLink="#ac8947451998676abcce5452a1a8f5848"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#ac8947451998676abcce5452a1a8f5848">getTypeSizeIndex</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> / Ty-&gt;getPrimitiveSizeInBits();</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlightComment">/// V is a value which is inserted into a vector of VecEltTy.</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlightComment">/// Look through the value to see if we can decompose it into</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlightComment">/// insertions into the vector.  See the example in the comment for</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlightComment">/// OptimizeIntegerToVectorInsertions for the pattern this handles.</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlightComment">/// The type of V is always a non-zero multiple of VecEltTy&#39;s size.</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlightComment">/// Shift is the number of bits between the lsb of V and the lsb of</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlightComment">/// the vector.</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlightComment">/// This returns false if the pattern can&#39;t be matched or true if it can,</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlightComment">/// filling in Elements with the elements found here.</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239" lineLink="#a01395be91e03a1a4c5fd713885d8327f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Shift,</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Value &#42;&gt;</a> &amp;Elements,</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/type">Type</a> &#42;VecEltTy, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>) &#123;</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a8efab72b40fc7836709221d3e97139c6">isMultipleOfTypeSize</a>(Shift, VecEltTy) &amp;&amp;</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Shift should be a multiple of the element type size&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Undef values never contribute useful bits to the result.</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(V)) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we got down to a value of the right type, we win, try inserting into the</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// right element.</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V-&gt;getType() == VecEltTy) &#123;</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Inserting null doesn&#39;t actually insert any elements.</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V))</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isNullValue())</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ElementIndex = <a href="#ac8947451998676abcce5452a1a8f5848">getTypeSizeIndex</a>(Shift, VecEltTy);</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>)</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">      ElementIndex = Elements.size() - ElementIndex - 1;</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fail if multiple elements are inserted into this slot.</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Elements&#91;ElementIndex&#93;)</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">    Elements&#91;ElementIndex&#93; = V;</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Figure out the # elements this provides, and bitcast it or slice it up</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as required.</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElts = <a href="#ac8947451998676abcce5452a1a8f5848">getTypeSizeIndex</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()-&gt;getPrimitiveSizeInBits(),</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">                                        VecEltTy);</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the constant is the size of a vector element, we just need to bitcast</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it to the right type so it gets properly inserted.</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumElts == 1)</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(<a href="/docs/api/classes/llvm/constantexpr/#ae79d05dd3d0b05e080e08f8c5c33f880">ConstantExpr::getBitCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, VecEltTy),</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">                                      Shift, Elements, VecEltTy, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>);</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, this is a constant that covers multiple elements.  Slice it up into</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pieces and insert each element-sized piece into the vector.</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()))</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/constantexpr/#ae79d05dd3d0b05e080e08f8c5c33f880">ConstantExpr::getBitCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(V-&gt;getContext(),</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">                                       <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()-&gt;getPrimitiveSizeInBits()));</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ElementSize = VecEltTy-&gt;<a href="/docs/api/classes/llvm/type/#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementIntTy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getContext(), ElementSize);</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != NumElts; ++i) &#123;</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ShiftI = i &#42; ElementSize;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Piece = <a href="/docs/api/namespaces/llvm/#af6674e64f01f197cffff55abcc6d2050">ConstantFoldBinaryInstruction</a>(</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">          Instruction::LShr, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, ConstantInt::get(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType(), ShiftI));</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Piece)</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">      Piece = <a href="/docs/api/classes/llvm/constantexpr/#af238147cf5453729781a0fcc7322e1c6">ConstantExpr::getTrunc</a>(Piece, ElementIntTy);</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(Piece, ShiftI + Shift, Elements, VecEltTy,</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>))</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!V-&gt;hasOneUse()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">: </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Unhandled case.</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::BitCast:</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType()-&gt;isVectorTy())</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Shift, Elements, VecEltTy,</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>);</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ZExt:</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a8efab72b40fc7836709221d3e97139c6">isMultipleOfTypeSize</a>(</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">                          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType()-&gt;getPrimitiveSizeInBits(),</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><span class="doxyHighlight">                              VecEltTy))</span></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Shift, Elements, VecEltTy,</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>);</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Shift, Elements, VecEltTy,</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>) &amp;&amp;</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">           <a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Shift, Elements, VecEltTy,</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>);</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl: &#123;</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Must be shifting by a constant that is a multiple of the element size.</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlight">    Shift += CI-&gt;<a href="/docs/api/classes/llvm/constantint/#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>();</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a8efab72b40fc7836709221d3e97139c6">isMultipleOfTypeSize</a>(Shift, VecEltTy)) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Shift, Elements, VecEltTy,</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/combinerhelper-cpp/#aad6842fbf58844d974611a4915a00aae">isBigEndian</a>);</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlightComment">/// If the input is an &#39;or&#39; instruction, we may be doing shifts and ors to</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlightComment">/// assemble the elements of the vector manually.</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><span class="doxyHighlightComment">/// Try to rip the code out and replace it with insertelements.  This is to</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlightComment">/// optimize code like this:</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlightComment">///    %tmp37 = bitcast float %inc to i32</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlightComment">///    %tmp38 = zext i32 %tmp37 to i64</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlightComment">///    %tmp31 = bitcast float %inc5 to i32</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlightComment">///    %tmp32 = zext i32 %tmp31 to i64</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlightComment">///    %tmp33 = shl i64 %tmp32, 32</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlightComment">///    %ins35 = or i64 %tmp33, %tmp38</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlightComment">///    %tmp43 = bitcast i64 %ins35 to &lt;2 x float&gt;</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlightComment">/// Into two insertelements that do &quot;buildvector&#123;%inc, %inc5&#125;&quot;.</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353" lineLink="#a8f948dd0c375dfeb4cdf99bc33905e66"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a8f948dd0c375dfeb4cdf99bc33905e66">optimizeIntegerToVectorInsertions</a>(<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp;CI,</span></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DestVecTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IntInput = CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if the int input is just an undef value do not try to optimize to vector</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// insertions as it will prevent undef propagation</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(IntInput))</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;, 8&gt;</a> Elements(DestVecTy-&gt;getNumElements());</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a01395be91e03a1a4c5fd713885d8327f">collectInsertionElements</a>(IntInput, 0, Elements,</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">                                DestVecTy-&gt;getElementType(),</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight">                                IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>().<a href="/docs/api/classes/llvm/datalayout/#a84c1d72001dd5f34d9a55b3a7bb8a474">isBigEndian</a>()))</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we succeeded, we know that all of the element are specified by Elements</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or are zero if Elements has a null entry.  Recast this as a set of</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// insertions.</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Result = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = Elements.size(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Elements&#91;i&#93;) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// Unset element.</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">    Result = IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a17320ebd77e834577a5ebd1063039625">CreateInsertElement</a>(Result, Elements&#91;i&#93;,</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">                                            IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(i));</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlightComment">/// Canonicalize scalar bitcasts of extracted elements into a bitcast of the</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlightComment">/// vector followed by extract element. The backend tends to handle bitcasts of</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlightComment">/// vectors better than bitcasts of scalars because vector registers are</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlightComment">/// usually not type-specific like scalar integer or scalar floating-point.</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387" lineLink="#a3e2793cc62829d80622b78cc681b25c2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a3e2793cc62829d80622b78cc681b25c2">canonicalizeBitCastExtElt</a>(<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp;BitCast,</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VecOp, &#42;Index;</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BitCast.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0),</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a36633f71df7e81c6155619890e65a8b2">m&#95;ExtractElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VecOp), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Index)))))</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The bitcast must be to a vectorizable type, otherwise we can&#39;t make a new</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// type to extract from.</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestType = BitCast.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">  <a href="/docs/api/classes/vectortype">VectorType</a> &#42;VecType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(VecOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vectortype/#aa6a2194fc011669faabe43322d7c6c5f">VectorType::isValidElementType</a>(DestType)) &#123;</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewVecType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(DestType, VecType);</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewBC = IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(VecOp, NewVecType, </span><span class="doxyHighlightStringLiteral">&quot;bc&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/extractelementinst/#a686bd809f72a2701d97b1bbd17f7db9f">ExtractElementInst::Create</a>(NewBC, Index);</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only solve DestType is vector to avoid inverse transform in visitBitCast.</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bitcast (extractelement &lt;1 x elt&gt;, dest) -&gt; bitcast(&lt;1 x elt&gt;, dest)</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FixedVType = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(VecType);</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestType-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; FixedVType &amp;&amp; FixedVType-&gt;getNumElements() == 1)</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(Instruction::BitCast, VecOp, DestType);</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlightComment">/// Change the type of a bitwise logic operation if we can eliminate a bitcast.</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414" lineLink="#a6556e45ee27ad333bf33eda6b1f04b8a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a6556e45ee27ad333bf33eda6b1f04b8a">foldBitCastBitwiseLogic</a>(<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp;BitCast,</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = BitCast.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO;</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BitCast.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(BO))) ||</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">      !BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a2d0036d2d7b30f510927731ba7a4f4b9">isBitwiseLogicOp</a>())</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This transform is restricted to vector types to avoid backend</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// problems caused by creating potentially illegal operations. If a fix-up is</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// added to handle that situation, we can remove this check.</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !BO-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestTy-&gt;<a href="/docs/api/classes/llvm/type/#ad0709baa705ae62c4e09cdd47fb4b420">isFPOrFPVectorTy</a>()) &#123;</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast(logic(bitcast(X), bitcast(Y))) -&gt; bitcast&#39;(logic(bitcast&#39;(X), Y))</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))))) &#123;</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;isFPOrFPVectorTy() &amp;&amp;</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType()-&gt;isIntOrIntVectorTy()) &#123;</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedOp =</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType());</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), CastedOp, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(NewBO, DestTy);</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;isIntOrIntVectorTy() &amp;&amp;</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType()-&gt;isFPOrFPVectorTy()) &#123;</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedOp =</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType());</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), CastedOp, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(NewBO, DestTy);</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a34ee40bb2f4f5ece47ef19e5f1f57e3c">isIntOrIntVectorTy</a>())</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)) &#123;</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast(logic(bitcast(X), Y)) --&gt; logic&#39;(X, bitcast(Y))</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedOp1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), DestTy);</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, CastedOp1);</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp;</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)) &#123;</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast(logic(Y, bitcast(X))) --&gt; logic&#39;(bitcast(Y), X)</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedOp0 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), DestTy);</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), CastedOp0, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Canonicalize vector bitcasts to come before vector bitwise logic with a</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constant. This eases recognition of special constants for later ops.</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Example:</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// icmp u/s (a ^ signmask), (b ^ signmask) --&gt; icmp s/u a, b</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &#123;</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast (logic X, C) --&gt; logic (bitcast X, C&#39;)</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedOp0 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), DestTy);</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedC = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy);</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), CastedOp0, CastedC);</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlightComment">/// Change the type of a select if we can eliminate a bitcast.</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486" lineLink="#a5d0fa3868fb321fcd4b5d632028db897"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a5d0fa3868fb321fcd4b5d632028db897">foldBitCastSelect</a>(<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp;BitCast,</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;TVal, &#42;FVal;</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BitCast.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0),</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(TVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(FVal)))))</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A vector select must maintain the same number of elements in its operands.</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CondTy = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType();</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = BitCast.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondVTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(CondTy))</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() ||</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">        CondVTy-&gt;getElementCount() !=</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(DestTy)-&gt;getElementCount())</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This transform is restricted from changing the select between</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// scalars and vectors to avoid backend problems caused by creating</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// potentially illegal operations. If a fix-up is added to handle that</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// situation, we can remove this check.</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() != TVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Sel = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(BitCast.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(TVal, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy &amp;&amp;</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)) &#123;</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast(select(Cond, bitcast(X), Y)) --&gt; select&#39;(Cond, X, bitcast(Y))</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(FVal, DestTy);</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, CastedVal, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Sel);</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(FVal, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy &amp;&amp;</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)) &#123;</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast(select(Cond, Y, bitcast(X))) --&gt; select&#39;(Cond, bitcast(Y), X)</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(TVal, DestTy);</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, CastedVal, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Sel);</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlightComment">/// Check if all users of CI are StoreInsts.</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529" lineLink="#a24b18f2c77f69e54841c51bb3d31cad2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a24b18f2c77f69e54841c51bb3d31cad2">hasStoreUsersOnly</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CI.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(U))</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlightComment">/// This function handles following case</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlightComment">///     A  -&gt;  B    cast</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlightComment">///     PHI</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlightComment">///     B  -&gt;  A    cast</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlightComment">/// All the related PHI nodes can be replaced by new PHI nodes with type A.</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlightComment">/// The uses of \\p CI can be changed to the new PHI node corresponding to \\p PN.</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::optimizeBitCastFromPhi(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &amp;CI,</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">                                                      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123;</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BitCast used by Store can be handled in InstCombineLoadStoreAlloca.cpp.</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a24b18f2c77f69e54841c51bb3d31cad2">hasStoreUsersOnly</a>(CI))</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;SrcTy = <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;getType();         </span><span class="doxyHighlightComment">// Type B</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;DestTy = CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();          </span><span class="doxyHighlightComment">// Type A</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;PHINode &#42;, 4&gt;</a> PhiWorklist;</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlight">  SmallSetVector&lt;PHINode &#42;, 4&gt; OldPhiNodes;</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find all of the A-&gt;B casts and PHI nodes.</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to inspect all related PHI nodes, but PHIs can be cyclic, so</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OldPhiNodes is used to track all known PHI nodes, before adding a new</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI to PhiWorklist, it is checked against and added to OldPhiNodes first.</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">  PhiWorklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PN);</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">  OldPhiNodes.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(PN);</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!PhiWorklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldPN = PhiWorklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IncValue : OldPN-&gt;incoming&#95;values()) &#123;</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(IncValue))</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(IncValue)) &#123;</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If there is a sequence of one or more load instructions, each loaded</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// value is used as address of later load instruction, bitcast is</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// necessary to change the value type, don&#39;t optimize it. For</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// simplicity we give up if the load address comes from another load.</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr = LI-&gt;getOperand(0);</span></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Addr == &amp;CI || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(Addr))</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Don&#39;t tranform &quot;load &lt;256 x i32&gt;, &lt;256 x i32&gt;&#42;&quot; to</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// &quot;load x86&#95;amx, x86&#95;amx&#42;&quot;, because x86&#95;amx&#42; is invalid.</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: Remove this check when bitcast between vector and x86&#95;amx</span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// is replaced with a specific intrinsic.</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestTy-&gt;<a href="/docs/api/classes/llvm/type/#ab549082d9dfb91ec9a8dc06601d54855">isX86&#95;AMXTy</a>())</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;hasOneUse() &amp;&amp; LI-&gt;isSimple())</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If a LoadInst has more than one use, changing the type of loaded</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// value may create another bitcast.</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PNode = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(IncValue)) &#123;</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldPhiNodes.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(PNode))</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">          PhiWorklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PNode);</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(IncValue);</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We can&#39;t handle other instructions.</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BCI)</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Verify it&#39;s a A-&gt;B cast.</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TyA = BCI-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TyB = BCI-&gt;getType();</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TyA != DestTy || TyB != SrcTy)</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that each user of each old PHI node is something that we can</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// rewrite, so that all of the old PHI nodes can be cleaned up afterwards.</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldPN : OldPhiNodes) &#123;</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;V : OldPN-&gt;users()) &#123;</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;isSimple() || <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperand(0) != OldPN)</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Verify it&#39;s a B-&gt;A cast.</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TyB = BCI-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TyA = BCI-&gt;getType();</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TyA != DestTy || TyB != SrcTy)</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// As long as the user is another old PHI node, then even if we don&#39;t</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// rewrite it, the PHI web we&#39;re considering won&#39;t have any users</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// outside itself, so it&#39;ll be dead.</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OldPhiNodes.contains(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>))</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each old PHI node, create a corresponding new PHI node with a type A.</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">  SmallDenseMap&lt;PHINode &#42;, PHINode &#42;&gt; NewPNodes;</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldPN : OldPhiNodes) &#123;</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(OldPN);</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">    PHINode &#42;NewPN = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreatePHI(DestTy, OldPN-&gt;getNumOperands());</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">    NewPNodes&#91;OldPN&#93; = NewPN;</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fill in the operands of new PHI nodes.</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldPN : OldPhiNodes) &#123;</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">    PHINode &#42;NewPN = NewPNodes&#91;OldPN&#93;;</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> j = 0, e = OldPN-&gt;getNumOperands(); j != e; ++j) &#123;</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = OldPN-&gt;getOperand(j);</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">        NewV = <a href="/docs/api/classes/llvm/constantexpr/#ae79d05dd3d0b05e080e08f8c5c33f880">ConstantExpr::getBitCast</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, DestTy);</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Explicitly perform load combine to make sure no opposing transform</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// can remove the bitcast in the meantime and trigger an infinite loop.</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(LI);</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">        NewV = <a href="/docs/api/classes/llvm/instcombinerimpl/#ad7586c4efa39c8f9162c7608ff9a57cf">combineLoadToNewType</a>(&#42;LI, DestTy);</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remove the old load and its use in the old phi, which itself becomes</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// dead once the whole transform finishes.</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;LI, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(LI-&gt;getType()));</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;LI);</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">        NewV = BCI-&gt;getOperand(0);</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PrevPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">        NewV = NewPNodes&#91;PrevPN&#93;;</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewV);</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewV, OldPN-&gt;getIncomingBlock(j));</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse all accumulated PHI nodes and process its users,</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which are Stores and BitcCasts. Without this processing</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NewPHI nodes could be replicated and could lead to extra</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// moves generated after DeSSA.</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is a store with type B, change it to type A.</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace users of BitCast B-&gt;A with NewPHI. These will help</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// later to get rid off a closure formed by OldPHI nodes.</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;RetVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldPN : OldPhiNodes) &#123;</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><span class="doxyHighlight">    PHINode &#42;NewPN = NewPNodes&#91;OldPN&#93;;</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;V : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(OldPN-&gt;users())) &#123;</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;isSimple() &amp;&amp; <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getOperand(0) == OldPN);</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(SI);</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewBC =</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BitCastInst&gt;</a>(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBitCast(NewPN, SrcTy));</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;setOperand(0, NewBC);</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push(SI);</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a24b18f2c77f69e54841c51bb3d31cad2">hasStoreUsersOnly</a>(&#42;NewBC));</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TyB = BCI-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TyA = BCI-&gt;getType();</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TyA == DestTy &amp;&amp; TyB == SrcTy);</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">        (void) TyA;</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">        (void) TyB;</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;BCI, NewPN);</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BCI == &amp;CI)</span></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">          RetVal = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldPhiNodes.contains(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>));</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">        (void) <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;all uses should be handled&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RetVal;</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlightComment">/// Fold (bitcast (or (and (bitcast X to int), signmask), nneg Y) to fp) to</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlightComment">/// copysign((bitcast Y to fp), X)</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715" lineLink="#a2c93d37ad765182a1bc1e43f4b967b99"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a2c93d37ad765182a1bc1e43f4b967b99">foldCopySignIdioms</a>(<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp;CI,</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder,</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;SQ) &#123;</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;FTy = CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FTy-&gt;<a href="/docs/api/classes/llvm/type/#ad0709baa705ae62c4e09cdd47fb4b420">isFPOrFPVectorTy</a>())</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;CI, <a href="/docs/api/namespaces/llvm/patternmatch/#aed04b081c4501c07d80fc69c308a0c23">m&#95;ElementWiseBitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae80cbfea2025ff7bd0770f30be6e050a">m&#95;c&#95;Or</a>(</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aed04b081c4501c07d80fc69c308a0c23">m&#95;ElementWiseBitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#a0c2ec502cbe0e39c4b7641f648b3a615">m&#95;SignMask</a>()),</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)))))</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() != FTy)</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, SQ))</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a999b90b0f59e9a5e21aa170bc71e2a09">CreateCopySign</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, FTy), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a89ab5eaec7693029761c8d0b3ded3b00"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a89ab5eaec7693029761c8d0b3ded3b00">InstCombinerImpl::visitBitCast</a>(<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the operands are integer typed then apply the integer transforms,</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// otherwise just apply the common ones.</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src = CI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = Src-&gt;getType();</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get rid of casts from one type to the same type. These are useless and can</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be replaced by the operand.</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestTy == Src-&gt;getType())</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(CI, Src);</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FixedVectorType&gt;</a>(DestTy)) &#123;</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(SrcTy)) &#123;</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is a cast from an integer to vector, check to see if the input</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// is a trunc or zext of a bitcast from vector.  If so, we can replace all</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the casts with a shuffle and (potentially) a bitcast.</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Src) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Src)) &#123;</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;SrcCast = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(Src);</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BCIn = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(SrcCast-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(BCIn-&gt;getOperand(0)-&gt;getType()))</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a75e6b6bf03adf614aaf100a9afdcd612">optimizeVectorResizeWithIntegerBitCasts</a>(</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">                    BCIn-&gt;getOperand(0), <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(DestTy), &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the input is an &#39;or&#39; instruction, we may be doing shifts and ors to</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// assemble the elements of the vector manually.  Try to rip the code out</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and replace it with insertelements.</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="#a8f948dd0c375dfeb4cdf99bc33905e66">optimizeIntegerToVectorInsertions</a>(CI, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(CI, V);</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/fixedvectortype">FixedVectorType</a> &#42;SrcVTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(SrcTy)) &#123;</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcVTy-&gt;getNumElements() == 1) &#123;</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If our destination is not a vector, then make this a straight</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// scalar-scalar cast.</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>()) &#123;</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Elem =</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractElement(Src,</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(CI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>())));</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(Instruction::BitCast, Elem, DestTy);</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise, see if our source is an insert. If so, then use the scalar</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// component directly:</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// bitcast (inselt &lt;1 x elt&gt; V, X, 0) to &lt;n x m&gt; --&gt; bitcast X to &lt;n x m&gt;</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InsElt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertElementInst&gt;</a>(Src))</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(InsElt-&gt;getOperand(1), DestTy);</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Convert an artificial vector insert into more analyzable bitwise logic.</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">    uint64&#95;t IndexC;</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aec67d7d9e090f41ec66d0d10169a440e">m&#95;InsertElt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))),</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(IndexC)))) &amp;&amp;</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">        DestTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == DestTy &amp;&amp;</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType()-&gt;isIntegerTy() &amp;&amp; isDesirableIntType(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)) &#123;</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Adjust for big endian - the LSBs are at the high index.</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isBigEndian())</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">        IndexC = SrcVTy-&gt;getNumElements() - 1 - IndexC;</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We only handle (endian-normalized) insert to index 0 Any other insert</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// would require a left-shift, so that is an extra instruction.</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IndexC == 0) &#123;</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// bitcast (inselt (bitcast X), Y, 0) --&gt; or (and X, MaskC), (zext Y)</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EltWidth = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/apint">APInt</a> MaskC = <a href="/docs/api/classes/llvm/apint/#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - EltWidth);</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;AndX = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAnd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, MaskC);</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;ZextY = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateZExt(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, DestTy);</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOperator::CreateOr(AndX, ZextY);</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Shuf = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ShuffleVectorInst&gt;</a>(Src)) &#123;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, we have (bitcast (shuffle ..)).  Check to see if this is</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a bitcast to a vector with the same # elts.</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ShufOp0 = Shuf-&gt;getOperand(0);</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ShufOp1 = Shuf-&gt;getOperand(1);</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ShufElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Shuf-&gt;getType())-&gt;getElementCount();</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SrcVecElts = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(ShufOp0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getElementCount();</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shuf-&gt;hasOneUse() &amp;&amp; DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(DestTy)-&gt;getElementCount() == ShufElts &amp;&amp;</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">        ShufElts == SrcVecElts) &#123;</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;Tmp;</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If either of the operands is a cast from CI.getType(), then</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// evaluating the shuffle in the casted destination&#39;s type will allow</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// us to eliminate at least one cast.</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (((Tmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(ShufOp0)) &amp;&amp;</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">           Tmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == DestTy) ||</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">          ((Tmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(ShufOp1)) &amp;&amp;</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">           Tmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == DestTy)) &#123;</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBitCast(ShufOp0, DestTy);</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBitCast(ShufOp1, DestTy);</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Return a new shuffle vector.  Use the same element ID&#39;s, as we</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// know the vector types match #elts.</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(LHS, RHS, Shuf-&gt;getShuffleMask());</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A bitcasted-to-scalar and byte/bit reversing shuffle is better recognized</span></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as a byte/bit swap:</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast &lt;N x i8&gt; (shuf X, undef, &lt;N, N-1,...0&gt;) -&gt; bswap (bitcast X)</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bitcast &lt;N x i1&gt; (shuf X, undef, &lt;N, N-1,...0&gt;) -&gt; bitreverse (bitcast X)</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DestTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; ShufElts.getKnownMinValue() % 2 == 0 &amp;&amp;</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><span class="doxyHighlight">        Shuf-&gt;hasOneUse() &amp;&amp; Shuf-&gt;isReverse()) &#123;</span></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IntrinsicNum = 0;</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isLegalInteger(DestTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()) &amp;&amp;</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">          SrcTy-&gt;getScalarSizeInBits() == 8) &#123;</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlight">        IntrinsicNum = Intrinsic::bswap;</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcTy-&gt;getScalarSizeInBits() == 1) &#123;</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">        IntrinsicNum = Intrinsic::bitreverse;</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntrinsicNum != 0) &#123;</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ShufOp0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == SrcTy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected shuffle mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ShufOp1, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>()) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected shuffle op&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/function">Function</a> &#42;BswapOrBitreverse = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">            CI.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), IntrinsicNum, DestTy);</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarX = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBitCast(ShufOp0, DestTy);</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(BswapOrBitreverse, &#123;ScalarX&#125;);</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle the A-&gt;B-&gt;A cast, and there is an intervening PHI node.</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Src))</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = optimizeBitCastFromPhi(CI, PN))</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a3e2793cc62829d80622b78cc681b25c2">canonicalizeBitCastExtElt</a>(CI, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a6556e45ee27ad333bf33eda6b1f04b8a">foldBitCastBitwiseLogic</a>(CI, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a5d0fa3868fb321fcd4b5d632028db897">foldBitCastSelect</a>(CI, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="#a2c93d37ad765182a1bc1e43f4b967b99">foldCopySignIdioms</a>(CI, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;CI)))</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(CI, V);</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(CI);</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a27c23cfa31727788250c1b6bb11e70e9"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a27c23cfa31727788250c1b6bb11e70e9">InstCombinerImpl::visitAddrSpaceCast</a>(<a href="/docs/api/classes/llvm/addrspacecastinst">AddrSpaceCastInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6adc65f05e61f4929966c0e4429c6fc7">commonCastTransforms</a>(CI);</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
