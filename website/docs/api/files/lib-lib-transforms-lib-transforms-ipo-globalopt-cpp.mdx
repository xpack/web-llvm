---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `GlobalOpt.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/IPO/GlobalOpt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/ipo/globalopt-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Twine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/iterator_range.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ConstantFolding.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemoryBuiltins.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memorybuiltins-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/BinaryFormat/Dwarf.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/binaryformat/dwarf-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CallingConv.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalAlias.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalalias-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalValue.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/AtomicOrdering.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/atomicordering-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/IPO.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/ipo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/CtorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ctorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Evaluator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/evaluator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/GlobalStatus.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/globalstatus-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-globalopt-cpp-">anonymous&#123;GlobalOpt.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/globalpart">GlobalPart</a></>}>
Part of the global at a specific offset, which is only accessed through loads and stores with the given type. <a href="/docs/api/structs/globalpart/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused">LLVMUsed</a></>}>
An easy to access representation of llvm.used and llvm.compiler.used. <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#ac56b393332f3a3fbe7322e181eebe16f">ChangeableCCCacheTy</a> = <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/classes/llvm/function">Function</a> &#42;, bool, 8 &gt;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a8e68884ca018dde6dfadf535637290d0">allUsesOfLoadAndStores</a> (GlobalVariable &#42;GV, SmallVector&lt; Value &#42;, 4 &gt; &amp;Uses)</>}>
Get all the loads/store uses for global variable <code>GV</code>. <a href="#a8e68884ca018dde6dfadf535637290d0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a26f6a2c21d213fbcbe99a2c09d88a2c4">allUsesOfLoadedValueWillTrapIfNull</a> (const GlobalVariable &#42;GV)</>}>
Return true if all uses of any loads from GV will trap if the loaded value is null. <a href="#a26f6a2c21d213fbcbe99a2c09d88a2c4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a2cf59a15a8b7603c5d66d8fdb117ecec">AllUsesOfValueWillTrapIfNull</a> (const Value &#42;V, SmallPtrSetImpl&lt; const PHINode &#42; &gt; &amp;PHIs)</>}>
Return true if all users of the specified value will trap if the value is dynamically null. <a href="#a2cf59a15a8b7603c5d66d8fdb117ecec">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7e0dd0687cbb3cdc252710877b323c29">callInstIsMemcpy</a> (CallInst &#42;CI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a7b97d3981d965c0884878bca5be437ff">ChangeCalleesToFastCall</a> (Function &#42;F)</>}>
Walk all of the direct calls of the specified function, changing them to FastCC. <a href="#a7b97d3981d965c0884878bca5be437ff">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9ed5060153ed9e3ca21cb567997d527c">changeCallSitesToColdCC</a> (Function &#42;F)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ac3cf098d54027ac28278b060376bdcbd">CleanupConstantGlobalUsers</a> (GlobalVariable &#42;GV, const DataLayout &amp;DL)</>}>
We just marked GV constant. <a href="#ac3cf098d54027ac28278b060376bdcbd">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adc803f628b45e58e3de84b46dd0b7d83">CleanupPointerRootUsers</a> (GlobalVariable &#42;GV, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI)</>}>
This GV is a pointer root. <a href="#adc803f628b45e58e3de84b46dd0b7d83">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4062c17e282cb2667cf0d52150c67fea">collectSRATypes</a> (DenseMap&lt; uint64&#95;t, GlobalPart &gt; &amp;Parts, GlobalVariable &#42;GV, const DataLayout &amp;DL)</>}>
Look at all uses of the global and determine which (offset, type) pairs it can be split into. <a href="#a4062c17e282cb2667cf0d52150c67fea">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adb4afc63a9a9aa3f185854b0cd009b44">collectVersions</a> (TargetTransformInfo &amp;TTI, Value &#42;V, SmallVectorImpl&lt; Function &#42; &gt; &amp;Versions)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="int"
  name={<><a href="#ad9ef9dbac3fbf9cc30e63d86bf9d7e34">compareNames</a> (Constant &#42;const &#42;A, Constant &#42;const &#42;B)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a1c6c0f8bb397fee19be6ef20f299afdf">ConstantPropUsersOf</a> (Value &#42;V, const DataLayout &amp;DL, TargetLibraryInfo &#42;TLI)</>}>
Walk the use list of V, constant folding all of the instructions that are foldable. <a href="#a1c6c0f8bb397fee19be6ef20f299afdf">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a444e6b7fcf191b54052704a41c55fe70">DeleteDeadIFuncs</a> (Module &amp;M, SmallPtrSetImpl&lt; const Comdat &#42; &gt; &amp;NotDiscardableComdats)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a5a50ba4ab5027d4013cf6bc2edf66085">deleteIfDead</a> (GlobalValue &amp;GV, SmallPtrSetImpl&lt; const Comdat &#42; &gt; &amp;NotDiscardableComdats, function&#95;ref&lt; void(Function &amp;)&gt; DeleteFnCallback=nullptr)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af3e1fd8c444e23d60cbfdfa3d0279cb4">destArrayCanBeWidened</a> (CallInst &#42;CI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#abf4eceb96c86c97477d4bcf8eec661e5">EvaluateStaticConstructor</a> (Function &#42;F, const DataLayout &amp;DL, TargetLibraryInfo &#42;TLI)</>}>
Evaluate static constructors in the function, if we can. <a href="#abf4eceb96c86c97477d4bcf8eec661e5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/function">Function</a> &#42;</>}
  name={<><a href="#a0a93e5a229615932f4e2ba47f55a3ba0">FindAtExitLibFunc</a> (Module &amp;M, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI, LibFunc Func)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad15d45b871d3111e8da4f9b394d7c83f">forwardStoredOnceStore</a> (GlobalVariable &#42;GV, const StoreInst &#42;StoredOnceStore, function&#95;ref&lt; DominatorTree &amp;(Function &amp;)&gt; LookupDomTree)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4fa5d8c51daf085fa06664ea9ca50da3">hasChangeableCC</a> (Function &#42;F, ChangeableCCCacheTy &amp;ChangeableCCCache)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a288312671e8284952698171f0466c22e">hasChangeableCCImpl</a> (Function &#42;F)</>}>
Return true if this is a calling convention that we&#39;d like to change. <a href="#a288312671e8284952698171f0466c22e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aacd456f21a2be87fdf19ab7e266b3a40">hasInvokeCallers</a> (Function &#42;F)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7e0090207d4b1da753ad2d3bbb51fc4d">hasMustTailCallers</a> (Function &#42;F)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a23cf1bbd780f1998b4c61acbf5a35a78">hasOnlyColdCalls</a> (Function &amp;F, function&#95;ref&lt; BlockFrequencyInfo &amp;(Function &amp;)&gt; GetBFI, ChangeableCCCacheTy &amp;ChangeableCCCache)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/function">Function</a> &#42;</>}
  name={<><a href="#a18d5638ef4590bc32bb8c69017352c1b">hasSideeffectFreeStaticResolution</a> (GlobalIFunc &amp;IF)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#afa93649aba5a7b6388adff903a4a6085">hasUseOtherThanLLVMUsed</a> (GlobalAlias &amp;GA, const LLVMUsed &amp;U)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae17d0aeb924fa0611500eb8cb09a70d9">hasUsesToReplace</a> (GlobalAlias &amp;GA, const LLVMUsed &amp;U, bool &amp;RenameTarget)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a652ede21e988a4de569cdbc7863ea234">isColdCallSite</a> (CallBase &amp;CB, BlockFrequencyInfo &amp;CallerBFI)</>}>
Return true if the block containing the call site has a <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> of less than ColdCCRelFreq% of the entry block. <a href="#a652ede21e988a4de569cdbc7863ea234">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3d10b9d22b94edf6deb16010eb260cdc">IsEmptyAtExitFunction</a> (const Function &amp;Fn)</>}>
Returns whether the given function is an empty C++ destructor or atexit handler and can therefore be eliminated. <a href="#a3d10b9d22b94edf6deb16010eb260cdc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a> (GlobalVariable &#42;GV)</>}>
Is this global variable possibly used by a leak checker as a root? <a href="#ace2885fc42e68606f270bfd3180d5f26">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ade4086b409f00a755cfc6c0b03f67413">isPointerValueDeadOnEntryToFunction</a> (const Function &#42;F, GlobalValue &#42;GV, function&#95;ref&lt; DominatorTree &amp;(Function &amp;)&gt; LookupDomTree)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a02c022baa01fdb4920060a670898b55a">IsSafeComputationToRemove</a> (Value &#42;V, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI)</>}>
Given a value that is stored to a global but never read, determine whether it&#39;s safe to remove the store and the chain of computation that feeds the store. <a href="#a02c022baa01fdb4920060a670898b55a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab9256893dbe8440acbad9879ae65180d">isValidCandidateForColdCC</a> (Function &amp;F, function&#95;ref&lt; BlockFrequencyInfo &amp;(Function &amp;)&gt; GetBFI, const std::vector&lt; Function &#42; &gt; &amp;AllCallsCold)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a99e004d21cf0169cd780274146e9f773">mayHaveOtherReferences</a> (GlobalValue &amp;GV, const LLVMUsed &amp;U)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab7fe47fe1b533f4c9bdd23baf28f3c8c">OptimizeAwayTrappingUsesOfLoads</a> (GlobalVariable &#42;GV, Constant &#42;LV, const DataLayout &amp;DL, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI)</>}>
The specified global has only one non-null value stored into it. <a href="#ab7fe47fe1b533f4c9bdd23baf28f3c8c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a> (Value &#42;V, Constant &#42;NewV)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a996275d837998b396728990f8be0ef3a">OptimizeEmptyGlobalAtExitDtors</a> (Function &#42;CXAAtExitFn, bool isCXX)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a42820c4a63faae2568e3db2ac69af37d">OptimizeFunctions</a> (Module &amp;M, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI, function&#95;ref&lt; TargetTransformInfo &amp;(Function &amp;)&gt; GetTTI, function&#95;ref&lt; BlockFrequencyInfo &amp;(Function &amp;)&gt; GetBFI, function&#95;ref&lt; DominatorTree &amp;(Function &amp;)&gt; LookupDomTree, SmallPtrSetImpl&lt; const Comdat &#42; &gt; &amp;NotDiscardableComdats, function&#95;ref&lt; void(Function &amp;F)&gt; ChangedCFGCallback, function&#95;ref&lt; void(Function &amp;F)&gt; DeleteFnCallback)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</>}
  name={<><a href="#a31b17b67a86749cfd99e97041c819791">OptimizeGlobalAddressOfAllocation</a> (GlobalVariable &#42;GV, CallInst &#42;CI, uint64&#95;t AllocSize, Constant &#42;InitVal, const DataLayout &amp;DL, TargetLibraryInfo &#42;TLI)</>}>
This function takes the specified global variable, and transforms the program as if it always contained the result of the specified malloc. <a href="#a31b17b67a86749cfd99e97041c819791">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6c0ba55113b40b07b869ba9c06db6ca1">OptimizeGlobalAliases</a> (Module &amp;M, SmallPtrSetImpl&lt; const Comdat &#42; &gt; &amp;NotDiscardableComdats)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aba35cb55d089d58ace72978cb0249dc8">optimizeGlobalsInModule</a> (Module &amp;M, const DataLayout &amp;DL, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI, function&#95;ref&lt; TargetTransformInfo &amp;(Function &amp;)&gt; GetTTI, function&#95;ref&lt; BlockFrequencyInfo &amp;(Function &amp;)&gt; GetBFI, function&#95;ref&lt; DominatorTree &amp;(Function &amp;)&gt; LookupDomTree, function&#95;ref&lt; void(Function &amp;F)&gt; ChangedCFGCallback, function&#95;ref&lt; void(Function &amp;F)&gt; DeleteFnCallback)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8d20a7c0aa0ef76c738e2ca9e21d35d5">OptimizeGlobalVars</a> (Module &amp;M, function&#95;ref&lt; TargetTransformInfo &amp;(Function &amp;)&gt; GetTTI, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI, function&#95;ref&lt; DominatorTree &amp;(Function &amp;)&gt; LookupDomTree, SmallPtrSetImpl&lt; const Comdat &#42; &gt; &amp;NotDiscardableComdats)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8b1b5c42e2e99bb24a27219f8df7294d">OptimizeNonTrivialIFuncs</a> (Module &amp;M, function&#95;ref&lt; TargetTransformInfo &amp;(Function &amp;)&gt; GetTTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a13c72931678c2da267fc265c7a2afdfb">optimizeOnceStoredGlobal</a> (GlobalVariable &#42;GV, Value &#42;StoredOnceVal, const DataLayout &amp;DL, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a22693120b14b0f18e6a09812dc4a86eb">OptimizeStaticIFuncs</a> (Module &amp;M)</>}>
Find IFuncs that have resolvers that always point at the same statically known callee, and replace their callers with a direct call. <a href="#a22693120b14b0f18e6a09812dc4a86eb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a5cb8771722bfd8bcbdeb391b17e6cfd6">processGlobal</a> (GlobalValue &amp;GV, function&#95;ref&lt; TargetTransformInfo &amp;(Function &amp;)&gt; GetTTI, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI, function&#95;ref&lt; DominatorTree &amp;(Function &amp;)&gt; LookupDomTree)</>}>
Analyze the specified global variable and optimize it if possible. <a href="#a5cb8771722bfd8bcbdeb391b17e6cfd6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adf0a129dd6c07827f4a8a5914f2d8b5b">processInternalGlobal</a> (GlobalVariable &#42;GV, const GlobalStatus &amp;GS, function&#95;ref&lt; TargetTransformInfo &amp;(Function &amp;)&gt; GetTTI, function&#95;ref&lt; TargetLibraryInfo &amp;(Function &amp;)&gt; GetTLI, function&#95;ref&lt; DominatorTree &amp;(Function &amp;)&gt; LookupDomTree)</>}>
Analyze the specified global variable and optimize it if possible. <a href="#adf0a129dd6c07827f4a8a5914f2d8b5b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4e385793d373a822cffdeaa9ee8f3e19">RemoveAttribute</a> (Function &#42;F, Attribute::AttrKind A)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5b064b03163c5f9304d4b702da5fa1e4">RemovePreallocated</a> (Function &#42;F)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aaf604b7b4ff087fce0b71852f5ddefbe">setUsedInitializer</a> (GlobalVariable &amp;V, const SmallPtrSetImpl&lt; GlobalValue &#42; &gt; &amp;Init)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</>}
  name={<><a href="#af376f4f0e0b55e40407912678b736863">SRAGlobal</a> (GlobalVariable &#42;GV, const DataLayout &amp;DL)</>}>
Perform scalar replacement of aggregates on the specified global variable. <a href="#af376f4f0e0b55e40407912678b736863">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2ce047bd3b73d0b94458a60f124f12d7">STATISTIC</a> (NumMarked, &quot;Number of globals marked constant&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a0efc89c9ff056bfa445f1929fe37ce89">STATISTIC</a> (NumUnnamed, &quot;Number of globals marked unnamed&#95;addr&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3aee52c132b8aa10180a02d2d39d66c4">STATISTIC</a> (NumSRA, &quot;Number of aggregate globals broken into scalars&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6747c5fc541c115ca1d7e3e13b94d4ed">STATISTIC</a> (NumSubstitute,&quot;Number of globals with initializers stored into them&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af855113127877ca0718ac42f0f60857b">STATISTIC</a> (NumDeleted, &quot;Number of globals deleted&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4f1517231327a0e87ffc3398375cd311">STATISTIC</a> (NumGlobUses, &quot;Number of global uses devirtualized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a26d9f0e88519553cdfe7785816b389d2">STATISTIC</a> (NumLocalized, &quot;Number of globals localized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af36921999cf94d9515aca54815619a75">STATISTIC</a> (NumShrunkToBool, &quot;Number of global vars shrunk to booleans&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aaca9eb9916493a6893d9a43a29f12ddd">STATISTIC</a> (NumFastCallFns, &quot;Number of functions converted to fastcc&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aedaee79130250bc0e00471350097db5a">STATISTIC</a> (NumCtorsEvaluated, &quot;Number of static ctors evaluated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab21431bf1728c7f36c84a5d05a26c5c1">STATISTIC</a> (NumNestRemoved, &quot;Number of nest attributes removed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#afc735675e52dea6a26820f7c31c34d6b">STATISTIC</a> (NumAliasesResolved, &quot;Number of global aliases resolved&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a81a0cfaee4cab8ab00f56eef69c5c876">STATISTIC</a> (NumAliasesRemoved, &quot;Number of global aliases eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aed15be76ff97e1272897da9e86f15b2a">STATISTIC</a> (NumCXXDtorsRemoved, &quot;Number of global C++ destructors removed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a519278257d65fea2c4a99971a60bee6c">STATISTIC</a> (NumAtExitRemoved, &quot;Number of atexit handlers removed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a16394d34a1e2b7aee955e64c65473bd9">STATISTIC</a> (NumInternalFunc, &quot;Number of internal functions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a937f3694892fd8ceca0c28fb9792ae74">STATISTIC</a> (NumColdCC, &quot;Number of functions marked coldcc&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a1ff870adc9b468218517f1ccdbb16be0">STATISTIC</a> (NumIFuncsResolved, &quot;Number of statically resolved IFuncs&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a9db81645742019befea55f72056466da">STATISTIC</a> (NumIFuncsDeleted, &quot;Number of IFuncs removed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2435d32a29cd861d30b3fb0d1e492e6c">STATISTIC</a> (NumGlobalArraysPadded, &quot;Number of global arrays padded to alignment boundary&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="AttributeList"
  name={<><a href="#aa5d09b628a436d6957b7a0f7751bb54f">StripAttr</a> (LLVMContext &amp;C, AttributeList Attrs, Attribute::AttrKind A)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a6989fb54b0ff045520a716621e13067d">transferSRADebugInfo</a> (GlobalVariable &#42;GV, GlobalVariable &#42;NGV, uint64&#95;t FragmentOffsetInBits, uint64&#95;t FragmentSizeInBits, uint64&#95;t VarSize)</>}>
Copy over the debug info for a variable to its SRA replacements. <a href="#a6989fb54b0ff045520a716621e13067d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1ae624f5747718933b1dabc6a03689aa">tryToOptimizeStoreOfAllocationToGlobal</a> (GlobalVariable &#42;GV, CallInst &#42;CI, const DataLayout &amp;DL, TargetLibraryInfo &#42;TLI)</>}>
If we have a global that is only initialized with a fixed size allocation try to transform the program to use global memory instead of heap allocated memory. <a href="#a1ae624f5747718933b1dabc6a03689aa">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a77de6d50432bef62e38fd24f2030026c">TryToShrinkGlobalToBoolean</a> (GlobalVariable &#42;GV, Constant &#42;OtherVal)</>}>
At this point, we have learned that the only two values ever stored into GV are its initializer and OtherVal. <a href="#a77de6d50432bef62e38fd24f2030026c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a2b081ab710b9eb7fcb8dff225d41cf1f">tryWidenGlobalArrayAndDests</a> (Function &#42;F, GlobalVariable &#42;SourceVar, const unsigned NumBytesToPad, const unsigned NumBytesToCopy, ConstantInt &#42;BytesToCopyOp, ConstantDataArray &#42;SourceDataArray)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4f18aa17f81c88c8fa89c76563a6d510">tryWidenGlobalArraysUsedByMemcpy</a> (GlobalVariable &#42;GV, function&#95;ref&lt; TargetTransformInfo &amp;(Function &amp;)&gt; GetTTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a406d93c10bd410f7ef8af5c00b037b8b">valueIsOnlyUsedLocallyOrStoredToOneGlobal</a> (const CallInst &#42;CI, const GlobalVariable &#42;GV)</>}>
Scan the use-list of GV checking to make sure that there are no complex uses of GV. <a href="#a406d93c10bd410f7ef8af5c00b037b8b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a960e756e8b2f056fbba7baa5bdcfb769">widenDestArray</a> (CallInst &#42;CI, const unsigned NumBytesToPad, const unsigned NumBytesToCopy, ConstantDataArray &#42;SourceDataArray)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</>}
  name={<><a href="#a2b81e19b3ddf7ec786c5105ba5470153">widenGlobalVariable</a> (GlobalVariable &#42;OldVar, Function &#42;F, unsigned NumBytesToPad, unsigned NumBytesToCopy)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; int &gt;</>}
  name={<><a href="#ab9e99a7c308a604345dfa345a45b7cdd">ColdCCRelFreq</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a6b2485a1a60621f310de38c14eb31024">EnableColdCCStressTest</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a5caa683daa02aed3ab67c3f5d81db300">OptimizeNonFMVCallers</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;globalopt&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### ChangeableCCCacheTy {#ac56b393332f3a3fbe7322e181eebe16f}

<MemberDefinition
  prototype={<>using ChangeableCCCacheTy =  SmallDenseMap&lt;Function &#42;, bool, 8&gt;</>}>

Definition at line <a href="#l01734">1734</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### allUsesOfLoadAndStores() {#a8e68884ca018dde6dfadf535637290d0}

<MemberDefinition
  prototype={<>static void allUsesOfLoadAndStores (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, 4 &gt; &amp; Uses)</>}
  labels = {["static"]}>
Get all the loads/store uses for global variable <code>GV</code>.

Definition at line <a href="#l00749">749</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### allUsesOfLoadedValueWillTrapIfNull() {#a26f6a2c21d213fbcbe99a2c09d88a2c4}

<MemberDefinition
  prototype={<>static bool allUsesOfLoadedValueWillTrapIfNull (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV)</>}
  labels = {["static"]}>
Return true if all uses of any loads from GV will trap if the loaded value is null.

Note that this also permits comparisons of the loaded value against null, as a special case.

Definition at line <a href="#l00715">715</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### AllUsesOfValueWillTrapIfNull() {#a2cf59a15a8b7603c5d66d8fdb117ecec}

<MemberDefinition
  prototype={<>static bool AllUsesOfValueWillTrapIfNull (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; &gt; &amp; PHIs)</>}
  labels = {["static"]}>
Return true if all users of the specified value will trap if the value is dynamically null.

PHIs keeps track of any phi nodes we&#39;ve seen to avoid reprocessing them.

Definition at line <a href="#l00661">661</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### callInstIsMemcpy() {#a7e0dd0687cbb3cdc252710877b323c29}

<MemberDefinition
  prototype={<>static bool callInstIsMemcpy (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02044">2044</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### ChangeCalleesToFastCall() {#a7b97d3981d965c0884878bca5be437ff}

<MemberDefinition
  prototype={<>static void ChangeCalleesToFastCall (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F)</>}
  labels = {["static"]}>
Walk all of the direct calls of the specified function, changing them to FastCC.

Definition at line <a href="#l01672">1672</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### changeCallSitesToColdCC() {#a9ed5060153ed9e3ca21cb567997d527c}

<MemberDefinition
  prototype={<>static void changeCallSitesToColdCC (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F)</>}
  labels = {["static"]}>

Definition at line <a href="#l01781">1781</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### CleanupConstantGlobalUsers() {#ac3cf098d54027ac28278b060376bdcbd}

<MemberDefinition
  prototype={<>static bool CleanupConstantGlobalUsers (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
We just marked GV constant.

<a href="/docs/api/classes/llvm/loop">Loop</a> over all users of the global, cleaning up the obvious ones. This is largely just a quick scan over the use list to clean up the easy and obvious cruft. This returns true if it made a change.

Definition at line <a href="#l00278">278</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### CleanupPointerRootUsers() {#adc803f628b45e58e3de84b46dd0b7d83}

<MemberDefinition
  prototype={<>static bool CleanupPointerRootUsers (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI)</>}
  labels = {["static"]}>
This GV is a pointer root.

<a href="/docs/api/classes/llvm/loop">Loop</a> over all users of the global and clean up any that obviously don&#39;t assign the global a value that isn&#39;t dynamically allocated.

Definition at line <a href="#l00200">200</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### collectSRATypes() {#a4062c17e282cb2667cf0d52150c67fea}

<MemberDefinition
  prototype={<>static bool collectSRATypes (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; uint64&#95;t, <a href="/docs/api/structs/globalpart">GlobalPart</a> &gt; &amp; Parts, <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Look at all uses of the global and determine which (offset, type) pairs it can be split into.

Definition at line <a href="#l00357">357</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### collectVersions() {#adb4afc63a9a9aa3f185854b0cd009b44}

<MemberDefinition
  prototype={<>static bool collectVersions (<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/function">Function</a> &#42; &gt; &amp; Versions)</>}
  labels = {["static"]}>

Definition at line <a href="#l02657">2657</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### compareNames() {#ad9ef9dbac3fbf9cc30e63d86bf9d7e34}

<MemberDefinition
  prototype={<>static int compareNames (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> &#42; A, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> &#42; B)</>}
  labels = {["static"]}>

Definition at line <a href="#l02271">2271</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### ConstantPropUsersOf() {#a1c6c0f8bb397fee19be6ef20f299afdf}

<MemberDefinition
  prototype={<>static void ConstantPropUsersOf (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI)</>}
  labels = {["static"]}>
Walk the use list of V, constant folding all of the instructions that are foldable.

Definition at line <a href="#l00903">903</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### DeleteDeadIFuncs() {#a444e6b7fcf191b54052704a41c55fe70}

<MemberDefinition
  prototype={<>static bool DeleteDeadIFuncs (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42; &gt; &amp; NotDiscardableComdats)</>}
  labels = {["static"]}>

Definition at line <a href="#l02643">2643</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### deleteIfDead() {#a5a50ba4ab5027d4013cf6bc2edf66085}

<MemberDefinition
  prototype={<>static bool deleteIfDead (<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &amp; GV, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42; &gt; &amp; NotDiscardableComdats, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; void(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; DeleteFnCallback=nullptr)</>}
  labels = {["static"]}>

Definition at line <a href="#l01323">1323</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### destArrayCanBeWidened() {#af3e1fd8c444e23d60cbfdfa3d0279cb4}

<MemberDefinition
  prototype={<>static bool destArrayCanBeWidened (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02055">2055</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### EvaluateStaticConstructor() {#abf4eceb96c86c97477d4bcf8eec661e5}

<MemberDefinition
  prototype={<>static bool EvaluateStaticConstructor (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI)</>}
  labels = {["static"]}>
Evaluate static constructors in the function, if we can.

Return true if we can, false otherwise.

Definition at line <a href="#l02243">2243</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### FindAtExitLibFunc() {#a0a93e5a229615932f4e2ba47f55a3ba0}

<MemberDefinition
  prototype={<>static Function &#42; FindAtExitLibFunc (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI, <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> Func)</>}
  labels = {["static"]}>

Definition at line <a href="#l02506">2506</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### forwardStoredOnceStore() {#ad15d45b871d3111e8da4f9b394d7c83f}

<MemberDefinition
  prototype={<>static bool forwardStoredOnceStore (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42; StoredOnceStore, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree)</>}
  labels = {["static"]}>

Definition at line <a href="#l01423">1423</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasChangeableCC() {#a4fa5d8c51daf085fa06664ea9ca50da3}

<MemberDefinition
  prototype={<>static bool hasChangeableCC (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="#ac56b393332f3a3fbe7322e181eebe16f">ChangeableCCCacheTy</a> &amp; ChangeableCCCache)</>}
  labels = {["static"]}>

Definition at line <a href="#l01735">1735</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasChangeableCCImpl() {#a288312671e8284952698171f0466c22e}

<MemberDefinition
  prototype={<>static bool hasChangeableCCImpl (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F)</>}
  labels = {["static"]}>
Return true if this is a calling convention that we&#39;d like to change.

The idea here is that we don&#39;t want to mess with the convention if the user explicitly requested something with performance implications like coldcc, GHC, or anyregcc.

Definition at line <a href="#l01702">1702</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasInvokeCallers() {#aacd456f21a2be87fdf19ab7e266b3a40}

<MemberDefinition
  prototype={<>static bool hasInvokeCallers (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F)</>}
  labels = {["static"]}>

Definition at line <a href="#l01839">1839</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasMustTailCallers() {#a7e0090207d4b1da753ad2d3bbb51fc4d}

<MemberDefinition
  prototype={<>static bool hasMustTailCallers (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F)</>}
  labels = {["static"]}>

Definition at line <a href="#l01825">1825</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasOnlyColdCalls() {#a23cf1bbd780f1998b4c61acbf5a35a78}

<MemberDefinition
  prototype={<>static bool hasOnlyColdCalls (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI, <a href="#ac56b393332f3a3fbe7322e181eebe16f">ChangeableCCCacheTy</a> &amp; ChangeableCCCache)</>}
  labels = {["static"]}>

Definition at line <a href="#l01793">1793</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasSideeffectFreeStaticResolution() {#a18d5638ef4590bc32bb8c69017352c1b}

<MemberDefinition
  prototype={<>static Function &#42; hasSideeffectFreeStaticResolution (<a href="/docs/api/classes/llvm/globalifunc">GlobalIFunc</a> &amp; IF)</>}
  labels = {["static"]}>

Definition at line <a href="#l02598">2598</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasUseOtherThanLLVMUsed() {#afa93649aba5a7b6388adff903a4a6085}

<MemberDefinition
  prototype={<>static bool hasUseOtherThanLLVMUsed (<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &amp; GA, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> LLVMUsed &amp; U)</>}
  labels = {["static"]}>

Definition at line <a href="#l02373">2373</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### hasUsesToReplace() {#ae17d0aeb924fa0611500eb8cb09a70d9}

<MemberDefinition
  prototype={<>static bool hasUsesToReplace (<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &amp; GA, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> LLVMUsed &amp; U, bool &amp; RenameTarget)</>}
  labels = {["static"]}>

Definition at line <a href="#l02396">2396</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### isColdCallSite() {#a652ede21e988a4de569cdbc7863ea234}

<MemberDefinition
  prototype={<>static bool isColdCallSite (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp; CallerBFI)</>}
  labels = {["static"]}>
Return true if the block containing the call site has a <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> of less than ColdCCRelFreq% of the entry block.

Definition at line <a href="#l01745">1745</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### IsEmptyAtExitFunction() {#a3d10b9d22b94edf6deb16010eb260cdc}

<MemberDefinition
  prototype={<>static bool IsEmptyAtExitFunction (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/function">Function</a> &amp; Fn)</>}
  labels = {["static"]}>
Returns whether the given function is an empty C++ destructor or atexit handler and can therefore be eliminated.

Note that we assume that other optimization passes have already simplified the code so we simply check for &#39;ret&#39;.

Definition at line <a href="#l02537">2537</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### isLeakCheckerRoot() {#ace2885fc42e68606f270bfd3180d5f26}

<MemberDefinition
  prototype={<>static bool isLeakCheckerRoot (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV)</>}
  labels = {["static"]}>
Is this global variable possibly used by a leak checker as a root?

If so, we might not really want to eliminate the stores to it.

Definition at line <a href="#l00119">119</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### isPointerValueDeadOnEntryToFunction() {#ade4086b409f00a755cfc6c0b03f67413}

<MemberDefinition
  prototype={<>static bool isPointerValueDeadOnEntryToFunction (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42; GV, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree)</>}
  labels = {["static"]}>

Definition at line <a href="#l01354">1354</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### IsSafeComputationToRemove() {#a02c022baa01fdb4920060a670898b55a}

<MemberDefinition
  prototype={<>static bool IsSafeComputationToRemove (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI)</>}
  labels = {["static"]}>
Given a value that is stored to a global but never read, determine whether it&#39;s safe to remove the store and the chain of computation that feeds the store.

Definition at line <a href="#l00169">169</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### isValidCandidateForColdCC() {#ab9256893dbe8440acbad9879ae65180d}

<MemberDefinition
  prototype={<>static bool isValidCandidateForColdCC (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/function">Function</a> &#42; &gt; &amp; AllCallsCold)</>}
  labels = {["static"]}>

Definition at line <a href="#l01759">1759</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### mayHaveOtherReferences() {#a99e004d21cf0169cd780274146e9f773}

<MemberDefinition
  prototype={<>static bool mayHaveOtherReferences (<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &amp; GV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> LLVMUsed &amp; U)</>}
  labels = {["static"]}>

Definition at line <a href="#l02389">2389</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeAwayTrappingUsesOfLoads() {#ab7fe47fe1b533f4c9bdd23baf28f3c8c}

<MemberDefinition
  prototype={<>static bool OptimizeAwayTrappingUsesOfLoads (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; LV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI)</>}
  labels = {["static"]}>
The specified global has only one non-null value stored into it.

If there are uses of the loaded value that would trap if the loaded value is dynamically null, then we know that they cannot be reachable with a null optimize away the load.

Definition at line <a href="#l00838">838</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeAwayTrappingUsesOfValue() {#aef572ae661cf9f5b14651ef952629c10}

<MemberDefinition
  prototype={<>static bool OptimizeAwayTrappingUsesOfValue (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; NewV)</>}
  labels = {["static"]}>

Definition at line <a href="#l00768">768</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeEmptyGlobalAtExitDtors() {#a996275d837998b396728990f8be0ef3a}

<MemberDefinition
  prototype={<>static bool OptimizeEmptyGlobalAtExitDtors (<a href="/docs/api/classes/llvm/function">Function</a> &#42; CXAAtExitFn, bool isCXX)</>}
  labels = {["static"]}>

Definition at line <a href="#l02553">2553</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeFunctions() {#a42820c4a63faae2568e3db2ac69af37d}

<MemberDefinition
  prototype={<>static bool OptimizeFunctions (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42; &gt; &amp; NotDiscardableComdats, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; void(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; ChangedCFGCallback, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; void(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; DeleteFnCallback)</>}
  labels = {["static"]}>

Definition at line <a href="#l01928">1928</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeGlobalAddressOfAllocation() {#a31b17b67a86749cfd99e97041c819791}

<MemberDefinition
  prototype={<>static GlobalVariable &#42; OptimizeGlobalAddressOfAllocation (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI, uint64&#95;t AllocSize, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; InitVal, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI)</>}
  labels = {["static"]}>
This function takes the specified global variable, and transforms the program as if it always contained the result of the specified malloc.

Because it is always the result of the specified malloc, there is no reason to actually DO the malloc. Instead, turn the malloc into a global, and any loads of GV as uses of the new global.

Definition at line <a href="#l00925">925</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeGlobalAliases() {#a6c0ba55113b40b07b869ba9c06db6ca1}

<MemberDefinition
  prototype={<>static bool OptimizeGlobalAliases (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42; &gt; &amp; NotDiscardableComdats)</>}
  labels = {["static"]}>

Definition at line <a href="#l02427">2427</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### optimizeGlobalsInModule() {#aba35cb55d089d58ace72978cb0249dc8}

<MemberDefinition
  prototype={<>static bool optimizeGlobalsInModule (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; void(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; ChangedCFGCallback, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; void(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; DeleteFnCallback)</>}
  labels = {["static"]}>

Definition at line <a href="#l02820">2820</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeGlobalVars() {#a8d20a7c0aa0ef76c738e2ca9e21d35d5}

<MemberDefinition
  prototype={<>static bool OptimizeGlobalVars (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42; &gt; &amp; NotDiscardableComdats)</>}
  labels = {["static"]}>

Definition at line <a href="#l02204">2204</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeNonTrivialIFuncs() {#a8b1b5c42e2e99bb24a27219f8df7294d}

<MemberDefinition
  prototype={<>static bool OptimizeNonTrivialIFuncs (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02696">2696</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### optimizeOnceStoredGlobal() {#a13c72931678c2da267fc265c7a2afdfb}

<MemberDefinition
  prototype={<>static bool optimizeOnceStoredGlobal (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/value">Value</a> &#42; StoredOnceVal, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI)</>}
  labels = {["static"]}>

Definition at line <a href="#l01128">1128</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeStaticIFuncs() {#a22693120b14b0f18e6a09812dc4a86eb}

<MemberDefinition
  prototype={<>static bool OptimizeStaticIFuncs (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M)</>}
  labels = {["static"]}>
Find IFuncs that have resolvers that always point at the same statically known callee, and replace their callers with a direct call.

Definition at line <a href="#l02628">2628</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### processGlobal() {#a5cb8771722bfd8bcbdeb391b17e6cfd6}

<MemberDefinition
  prototype={<>static bool processGlobal (<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &amp; GV, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree)</>}
  labels = {["static"]}>
Analyze the specified global variable and optimize it if possible.

If we make a change, return true.

Definition at line <a href="#l01632">1632</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### processInternalGlobal() {#adf0a129dd6c07827f4a8a5914f2d8b5b}

<MemberDefinition
  prototype={<>static bool processInternalGlobal (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/globalstatus">GlobalStatus</a> &amp; GS, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree)</>}
  labels = {["static"]}>
Analyze the specified global variable and optimize it if possible.

If we make a change, return true.

Definition at line <a href="#l01459">1459</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### RemoveAttribute() {#a4e385793d373a822cffdeaa9ee8f3e19}

<MemberDefinition
  prototype={<>static void RemoveAttribute (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, Attribute::AttrKind A)</>}
  labels = {["static"]}>

Definition at line <a href="#l01688">1688</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### RemovePreallocated() {#a5b064b03163c5f9304d4b702da5fa1e4}

<MemberDefinition
  prototype={<>static void RemovePreallocated (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F)</>}
  labels = {["static"]}>

Definition at line <a href="#l01846">1846</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### setUsedInitializer() {#aaf604b7b4ff087fce0b71852f5ddefbe}

<MemberDefinition
  prototype={<>static void setUsedInitializer (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &amp; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42; &gt; &amp; Init)</>}
  labels = {["static"]}>

Definition at line <a href="#l02277">2277</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### SRAGlobal() {#af376f4f0e0b55e40407912678b736863}

<MemberDefinition
  prototype={<>static GlobalVariable &#42; SRAGlobal (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Perform scalar replacement of aggregates on the specified global variable.

This opens the door for other optimizations by exposing the behavior of the program in a more fine-grained way. We have determined that this transformation is safe already. We return the first global variable we insert so that the caller can reprocess it.

Definition at line <a href="#l00526">526</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2ce047bd3b73d0b94458a60f124f12d7}

<MemberDefinition
  prototype={<>STATISTIC (NumMarked, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxcontainerglobals-cpp/#ace9918659ef4a022d158646784619514">globals</a> marked constant&quot;)</>}>

Definition at line <a href="#l00076">76</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a0efc89c9ff056bfa445f1929fe37ce89}

<MemberDefinition
  prototype={<>STATISTIC (NumUnnamed, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxcontainerglobals-cpp/#ace9918659ef4a022d158646784619514">globals</a> marked unnamed&#95;addr&quot;)</>}>

Definition at line <a href="#l00077">77</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3aee52c132b8aa10180a02d2d39d66c4}

<MemberDefinition
  prototype={<>STATISTIC (NumSRA, &quot;Number of aggregate <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxcontainerglobals-cpp/#ace9918659ef4a022d158646784619514">globals</a> broken into scalars&quot;)</>}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a6747c5fc541c115ca1d7e3e13b94d4ed}

<MemberDefinition
  prototype={<>STATISTIC (NumSubstitute, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxcontainerglobals-cpp/#ace9918659ef4a022d158646784619514">globals</a> with initializers stored into them&quot;)</>}>

Definition at line <a href="#l00079">79</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#af855113127877ca0718ac42f0f60857b}

<MemberDefinition
  prototype={<>STATISTIC (NumDeleted, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxcontainerglobals-cpp/#ace9918659ef4a022d158646784619514">globals</a> deleted&quot;)</>}>

Definition at line <a href="#l00080">80</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4f1517231327a0e87ffc3398375cd311}

<MemberDefinition
  prototype={<>STATISTIC (NumGlobUses, &quot;Number of global uses devirtualized&quot;)</>}>

Definition at line <a href="#l00081">81</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a26d9f0e88519553cdfe7785816b389d2}

<MemberDefinition
  prototype={<>STATISTIC (NumLocalized, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxcontainerglobals-cpp/#ace9918659ef4a022d158646784619514">globals</a> localized&quot;)</>}>

Definition at line <a href="#l00082">82</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#af36921999cf94d9515aca54815619a75}

<MemberDefinition
  prototype={<>STATISTIC (NumShrunkToBool, &quot;Number of global vars shrunk to booleans&quot;)</>}>

Definition at line <a href="#l00083">83</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aaca9eb9916493a6893d9a43a29f12ddd}

<MemberDefinition
  prototype={<>STATISTIC (NumFastCallFns, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> converted to fastcc&quot;)</>}>

Definition at line <a href="#l00084">84</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aedaee79130250bc0e00471350097db5a}

<MemberDefinition
  prototype={<>STATISTIC (NumCtorsEvaluated, &quot;Number of static ctors evaluated&quot;)</>}>

Definition at line <a href="#l00085">85</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab21431bf1728c7f36c84a5d05a26c5c1}

<MemberDefinition
  prototype={<>STATISTIC (NumNestRemoved, &quot;Number of nest attributes removed&quot;)</>}>

Definition at line <a href="#l00086">86</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#afc735675e52dea6a26820f7c31c34d6b}

<MemberDefinition
  prototype={<>STATISTIC (NumAliasesResolved, &quot;Number of global aliases resolved&quot;)</>}>

Definition at line <a href="#l00087">87</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a81a0cfaee4cab8ab00f56eef69c5c876}

<MemberDefinition
  prototype={<>STATISTIC (NumAliasesRemoved, &quot;Number of global aliases eliminated&quot;)</>}>

Definition at line <a href="#l00088">88</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aed15be76ff97e1272897da9e86f15b2a}

<MemberDefinition
  prototype={<>STATISTIC (NumCXXDtorsRemoved, &quot;Number of global <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a1960c14773241d6a238d2db593abe552">C</a>++ destructors removed&quot;)</>}>

Definition at line <a href="#l00089">89</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a519278257d65fea2c4a99971a60bee6c}

<MemberDefinition
  prototype={<>STATISTIC (NumAtExitRemoved, &quot;Number of atexit handlers removed&quot;)</>}>

Definition at line <a href="#l00090">90</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a16394d34a1e2b7aee955e64c65473bd9}

<MemberDefinition
  prototype={<>STATISTIC (NumInternalFunc, &quot;Number of internal functions&quot;)</>}>

Definition at line <a href="#l00091">91</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a937f3694892fd8ceca0c28fb9792ae74}

<MemberDefinition
  prototype={<>STATISTIC (NumColdCC, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> marked coldcc&quot;)</>}>

Definition at line <a href="#l00092">92</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a1ff870adc9b468218517f1ccdbb16be0}

<MemberDefinition
  prototype={<>STATISTIC (NumIFuncsResolved, &quot;Number of statically resolved IFuncs&quot;)</>}>

Definition at line <a href="#l00093">93</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a9db81645742019befea55f72056466da}

<MemberDefinition
  prototype={<>STATISTIC (NumIFuncsDeleted, &quot;Number of IFuncs removed&quot;)</>}>

Definition at line <a href="#l00094">94</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2435d32a29cd861d30b3fb0d1e492e6c}

<MemberDefinition
  prototype={<>STATISTIC (NumGlobalArraysPadded, &quot;Number of global arrays padded to alignment boundary&quot;)</>}>

Definition at line <a href="#l00095">95</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### StripAttr() {#aa5d09b628a436d6957b7a0f7751bb54f}

<MemberDefinition
  prototype={<>static AttributeList StripAttr (<a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp; C, AttributeList Attrs, Attribute::AttrKind A)</>}
  labels = {["static"]}>

Definition at line <a href="#l01680">1680</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### transferSRADebugInfo() {#a6989fb54b0ff045520a716621e13067d}

<MemberDefinition
  prototype={<>static void transferSRADebugInfo (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; NGV, uint64&#95;t FragmentOffsetInBits, uint64&#95;t FragmentSizeInBits, uint64&#95;t VarSize)</>}
  labels = {["static"]}>
Copy over the debug info for a variable to its SRA replacements.

Definition at line <a href="#l00446">446</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### tryToOptimizeStoreOfAllocationToGlobal() {#a1ae624f5747718933b1dabc6a03689aa}

<MemberDefinition
  prototype={<>static bool tryToOptimizeStoreOfAllocationToGlobal (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI)</>}
  labels = {["static"]}>
If we have a global that is only initialized with a fixed size allocation try to transform the program to use global memory instead of heap allocated memory.

This eliminates dynamic allocation, avoids an indirection accessing the data, and exposes the resultant global to further GlobalOpt.

Definition at line <a href="#l01081">1081</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### TryToShrinkGlobalToBoolean() {#a77de6d50432bef62e38fd24f2030026c}

<MemberDefinition
  prototype={<>static bool TryToShrinkGlobalToBoolean (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; OtherVal)</>}
  labels = {["static"]}>
At this point, we have learned that the only two values ever stored into GV are its initializer and OtherVal.

See if we can shrink the global into a boolean and select between the two values whenever it is used. This exposes the values to other scalar optimizations.

Definition at line <a href="#l01164">1164</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### tryWidenGlobalArrayAndDests() {#a2b081ab710b9eb7fcb8dff225d41cf1f}

<MemberDefinition
  prototype={<>static bool tryWidenGlobalArrayAndDests (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; SourceVar, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> unsigned NumBytesToPad, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> unsigned NumBytesToCopy, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; BytesToCopyOp, <a href="/docs/api/classes/llvm/constantdataarray">ConstantDataArray</a> &#42; SourceDataArray)</>}
  labels = {["static"]}>

Definition at line <a href="#l02121">2121</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### tryWidenGlobalArraysUsedByMemcpy() {#a4f18aa17f81c88c8fa89c76563a6d510}

<MemberDefinition
  prototype={<>static bool tryWidenGlobalArraysUsedByMemcpy (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02152">2152</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### valueIsOnlyUsedLocallyOrStoredToOneGlobal() {#a406d93c10bd410f7ef8af5c00b037b8b}

<MemberDefinition
  prototype={<>static bool valueIsOnlyUsedLocallyOrStoredToOneGlobal (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; GV)</>}
  labels = {["static"]}>
Scan the use-list of GV checking to make sure that there are no complex uses of GV.

We permit simple things like dereferencing the pointer, but not storing through the address, unless it is to the specified global.

Definition at line <a href="#l01042">1042</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### widenDestArray() {#a960e756e8b2f056fbba7baa5bdcfb769}

<MemberDefinition
  prototype={<>static void widenDestArray (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> unsigned NumBytesToPad, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> unsigned NumBytesToCopy, <a href="/docs/api/classes/llvm/constantdataarray">ConstantDataArray</a> &#42; SourceDataArray)</>}
  labels = {["static"]}>

Definition at line <a href="#l02101">2101</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### widenGlobalVariable() {#a2b81e19b3ddf7ec786c5105ba5470153}

<MemberDefinition
  prototype={<>static GlobalVariable &#42; widenGlobalVariable (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42; OldVar, <a href="/docs/api/classes/llvm/function">Function</a> &#42; F, unsigned NumBytesToPad, unsigned NumBytesToCopy)</>}
  labels = {["static"]}>

Definition at line <a href="#l02071">2071</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### ColdCCRelFreq {#ab9e99a7c308a604345dfa345a45b7cdd}

<MemberDefinition
  prototype={<>cl::opt&lt; int &gt; ColdCCRelFreq(&quot;coldcc-rel-freq&quot;, cl::Hidden, cl::init(2), cl::desc( &quot;Maximum block frequency, expressed as a percentage of caller&#39;s &quot; &quot;entry frequency, for a call site to be considered cold for enabling &quot; &quot;coldcc&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00110">110</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### EnableColdCCStressTest {#a6b2485a1a60621f310de38c14eb31024}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableColdCCStressTest(&quot;enable-coldcc-stress-test&quot;, cl::desc(&quot;Enable stress test of coldcc by adding &quot; &quot;calling conv to all internal functions.&quot;), cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00105">105</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

### OptimizeNonFMVCallers {#a5caa683daa02aed3ab67c3f5d81db300}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; OptimizeNonFMVCallers(&quot;optimize-non-fmv-callers&quot;, cl::desc(&quot;Statically resolve calls to versioned &quot; &quot;functions from non-versioned callers.&quot;), cl::init(true), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00099">99</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;globalopt&quot;</>}>

Definition at line <a href="#l00074">74</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/globalopt-cpp">GlobalOpt.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- GlobalOpt.cpp - Optimize Global Variables --------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This pass transforms simple global variables that never have their address</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// taken.  If obviously true, it marks read/write globals as constant, deletes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">// variables only stored to, etc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/ipo/globalopt-h">llvm/Transforms/IPO/GlobalOpt.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h">llvm/ADT/Twine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h">llvm/ADT/iterator&#95;range.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h">llvm/Analysis/ConstantFolding.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memorybuiltins-h">llvm/Analysis/MemoryBuiltins.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/binaryformat/dwarf-h">llvm/BinaryFormat/Dwarf.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h">llvm/IR/CallingConv.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalalias-h">llvm/IR/GlobalAlias.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h">llvm/IR/GlobalValue.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/atomicordering-h">llvm/Support/AtomicOrdering.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/ipo-h">llvm/Transforms/IPO.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ctorutils-h">llvm/Transforms/Utils/CtorUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/evaluator-h">llvm/Transforms/Utils/Evaluator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/globalstatus-h">llvm/Transforms/Utils/GlobalStatus.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;optional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;vector&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;globalopt&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76" lineLink="#a2ce047bd3b73d0b94458a60f124f12d7"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMarked    , </Highlight><Highlight kind="stringliteral">&quot;Number of globals marked constant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77" lineLink="#a0efc89c9ff056bfa445f1929fe37ce89"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumUnnamed   , </Highlight><Highlight kind="stringliteral">&quot;Number of globals marked unnamed&#95;addr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#a3aee52c132b8aa10180a02d2d39d66c4"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSRA       , </Highlight><Highlight kind="stringliteral">&quot;Number of aggregate globals broken into scalars&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79" lineLink="#a6747c5fc541c115ca1d7e3e13b94d4ed"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSubstitute,</Highlight><Highlight kind="stringliteral">&quot;Number of globals with initializers stored into them&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80" lineLink="#af855113127877ca0718ac42f0f60857b"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDeleted   , </Highlight><Highlight kind="stringliteral">&quot;Number of globals deleted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81" lineLink="#a4f1517231327a0e87ffc3398375cd311"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumGlobUses  , </Highlight><Highlight kind="stringliteral">&quot;Number of global uses devirtualized&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82" lineLink="#a26d9f0e88519553cdfe7785816b389d2"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLocalized , </Highlight><Highlight kind="stringliteral">&quot;Number of globals localized&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83" lineLink="#af36921999cf94d9515aca54815619a75"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumShrunkToBool  , </Highlight><Highlight kind="stringliteral">&quot;Number of global vars shrunk to booleans&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84" lineLink="#aaca9eb9916493a6893d9a43a29f12ddd"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFastCallFns   , </Highlight><Highlight kind="stringliteral">&quot;Number of functions converted to fastcc&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85" lineLink="#aedaee79130250bc0e00471350097db5a"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCtorsEvaluated, </Highlight><Highlight kind="stringliteral">&quot;Number of static ctors evaluated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="#ab21431bf1728c7f36c84a5d05a26c5c1"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumNestRemoved   , </Highlight><Highlight kind="stringliteral">&quot;Number of nest attributes removed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="#afc735675e52dea6a26820f7c31c34d6b"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAliasesResolved, </Highlight><Highlight kind="stringliteral">&quot;Number of global aliases resolved&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88" lineLink="#a81a0cfaee4cab8ab00f56eef69c5c876"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAliasesRemoved, </Highlight><Highlight kind="stringliteral">&quot;Number of global aliases eliminated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89" lineLink="#aed15be76ff97e1272897da9e86f15b2a"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCXXDtorsRemoved, </Highlight><Highlight kind="stringliteral">&quot;Number of global C++ destructors removed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90" lineLink="#a519278257d65fea2c4a99971a60bee6c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumAtExitRemoved, </Highlight><Highlight kind="stringliteral">&quot;Number of atexit handlers removed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91" lineLink="#a16394d34a1e2b7aee955e64c65473bd9"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumInternalFunc, </Highlight><Highlight kind="stringliteral">&quot;Number of internal functions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92" lineLink="#a937f3694892fd8ceca0c28fb9792ae74"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumColdCC, </Highlight><Highlight kind="stringliteral">&quot;Number of functions marked coldcc&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="#a1ff870adc9b468218517f1ccdbb16be0"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumIFuncsResolved, </Highlight><Highlight kind="stringliteral">&quot;Number of statically resolved IFuncs&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94" lineLink="#a9db81645742019befea55f72056466da"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumIFuncsDeleted, </Highlight><Highlight kind="stringliteral">&quot;Number of IFuncs removed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95" lineLink="#a2435d32a29cd861d30b3fb0d1e492e6c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumGlobalArraysPadded,</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of global arrays padded to alignment boundary&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="#a5caa683daa02aed3ab67c3f5d81db300"><Highlight kind="normal">    <a href="#a5caa683daa02aed3ab67c3f5d81db300">OptimizeNonFMVCallers</a>(</Highlight><Highlight kind="stringliteral">&quot;optimize-non-fmv-callers&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal">                          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Statically resolve calls to versioned &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal">                                   </Highlight><Highlight kind="stringliteral">&quot;functions from non-versioned callers.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105" lineLink="#a6b2485a1a60621f310de38c14eb31024"><Highlight kind="normal">    <a href="#a6b2485a1a60621f310de38c14eb31024">EnableColdCCStressTest</a>(</Highlight><Highlight kind="stringliteral">&quot;enable-coldcc-stress-test&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal">                           <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable stress test of coldcc by adding &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal">                                    </Highlight><Highlight kind="stringliteral">&quot;calling conv to all internal functions.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal">                           <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="#ab9e99a7c308a604345dfa345a45b7cdd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;int&gt;</a> <a href="#ab9e99a7c308a604345dfa345a45b7cdd">ColdCCRelFreq</a>(</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;coldcc-rel-freq&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2),</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Maximum block frequency, expressed as a percentage of caller&#39;s &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;entry frequency, for a call site to be considered cold for enabling &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;coldcc&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="comment">/// Is this global variable possibly used by a leak checker as a root?  If so,</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="comment">/// we might not really want to eliminate the stores to it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="#ace2885fc42e68606f270bfd3180d5f26"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV) &#123;</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A global variable is a root if it is a pointer, or could plausibly contain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a pointer.  There are two challenges; one is that we could have a struct</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the has an inner member which is a pointer.  We recurse through the type to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// detect these (up to a point).  The other is that we may actually be a union</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of a pointer and another type, and so our LLVM type is an integer which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// gets converted into a pointer, or our type is an &#91;i8 x #&#93; with a pointer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// potentially contained here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3ed4c5535997ad77ffee00f92430b576">hasPrivateLinkage</a>())</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;, 4&gt;</a> Types;</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal">  Types.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>());</Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Limit = 20;</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = Types.pop&#95;back&#95;val();</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Ty-&gt;getTypeID()) &#123;</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">: </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a5e9e1c0dd93557be1b4ad72860f3cbdaae68df805bc15b023748c2a78b80563ff">Type::PointerTyID</a>:</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a5e9e1c0dd93557be1b4ad72860f3cbdaa98aa825426dd4de2d19a3de9983a2d5d">Type::FixedVectorTyID</a>:</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a5e9e1c0dd93557be1b4ad72860f3cbdaa6188e4e2fb839d904debf0cbe7fc11f6">Type::ScalableVectorTyID</a>:</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Ty)-&gt;getElementType()-&gt;<a href="/docs/api/namespaces/llvm/#a7db94a9fa353cc7a297edd4e8601b184">isPointerTy</a>())</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554">Type::ArrayTyID</a>:</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">        Types.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ArrayType&gt;</a>(Ty)-&gt;getElementType());</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156">Type::StructTyID</a>: &#123;</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;STy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StructType&gt;</a>(Ty);</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (STy-&gt;<a href="/docs/api/classes/llvm/structtype/#aec7c3cecd0559788b36c46df1b2181c1">isOpaque</a>()) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;InnerTy : STy-&gt;<a href="/docs/api/classes/llvm/structtype/#a339ac1c5133ca49e7a5fb1e37ce0a308">elements</a>()) &#123;</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PointerType&gt;</a>(InnerTy)) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StructType&gt;</a>(InnerTy) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ArrayType&gt;</a>(InnerTy) ||</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(InnerTy))</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal">            Types.push&#95;back(InnerTy);</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (--Limit == 0) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Types.empty());</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="comment">/// Given a value that is stored to a global but never read, determine whether</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="comment">/// it&#39;s safe to remove the store and the chain of computation that feeds the</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="comment">/// store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169" lineLink="#a02c022baa01fdb4920060a670898b55a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a02c022baa01fdb4920060a670898b55a">IsSafeComputationToRemove</a>(</Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI) &#123;</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!V-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(V) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(V) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(V) ||</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#accaca14b419cbac91ca6170523084a04">isAllocationFn</a>(V, GetTLI))</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects())</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllConstantIndices())</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands() != 1) &#123;</Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">    V = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="comment">/// This GV is a pointer root.  Loop over all users of the global and clean up</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="comment">/// any that obviously don&#39;t assign the global a value that isn&#39;t dynamically</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="comment">/// allocated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200" lineLink="#adc803f628b45e58e3de84b46dd0b7d83"><Highlight kind="normal"><a href="#adc803f628b45e58e3de84b46dd0b7d83">CleanupPointerRootUsers</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV,</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI) &#123;</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A brief explanation of leak checkers.  The goal is to find bugs where</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// pointers are forgotten, causing an accumulating growth in memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// usage over time.  The common strategy for leak checkers is to explicitly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allow the memory pointed to by globals at exit.  This is popular because it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// also solves another problem where the main thread of a C++ program may shut</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// down before other threads that are still expecting to use those globals. To</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// handle that case, we expect the program may create a singleton and never</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// destroy it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If Dead&#91;n&#93;.first is the only use of a malloc result, we can delete its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// chain of computation and the store to the global in Dead&#91;n&#93;.second.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;Instruction &#42;, Instruction &#42;&gt;</a>, 32&gt; Dead;</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;User &#42;&gt;</a> Worklist(GV-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>());</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Constants can&#39;t be pointers to dynamically allocated memory.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/user">User</a> &#42;U = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand();</Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">          Dead.push&#95;back(std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>));</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/memsetinst">MemSetInst</a> &#42;MSI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemSetInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(MSI-&gt;getValue())) &#123;</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">        MSI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(MSI-&gt;getValue())) &#123;</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal">          Dead.push&#95;back(std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MSI));</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/memtransferinst">MemTransferInst</a> &#42;MTI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemTransferInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;MemSrc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(MTI-&gt;getSource());</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemSrc &amp;&amp; MemSrc-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aa859e108741fa64681b63f0c0c672512">isConstant</a>()) &#123;</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">        MTI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(MTI-&gt;getSource())) &#123;</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">          Dead.push&#95;back(std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MTI));</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantexpr">ConstantExpr</a> &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GEPOperator&gt;</a>(CE))</Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Worklist, CE-&gt;users());</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> i = 0, e = Dead.size(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a02c022baa01fdb4920060a670898b55a">IsSafeComputationToRemove</a>(Dead&#91;i&#93;.first, GetTLI)) &#123;</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal">      Dead&#91;i&#93;.second-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Dead&#91;i&#93;.first;</Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#accaca14b419cbac91ca6170523084a04">isAllocationFn</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, GetTLI))</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;J = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!J)</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = J;</Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/constant/#a960620248182018e566b095f06a605df">removeDeadConstantUsers</a>();</Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="comment">/// We just marked GV constant.  Loop over all users of the global, cleaning up</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="comment">/// the obvious ones.  This is largely just a quick scan over the use list to</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="comment">/// clean up the easy and obvious cruft.  This returns true if it made a change.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278" lineLink="#ac3cf098d54027ac28278b060376bdcbd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ac3cf098d54027ac28278b060376bdcbd">CleanupConstantGlobalUsers</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV,</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/classes/llvm/init">Init</a> = GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>();</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;User &#42;, 8&gt;</a> WorkList(GV-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>());</Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;User &#42;, 8&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH&gt;</a> MaybeDeadInsts;</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> EraseFromParent = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">        MaybeDeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpI);</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/user">User</a> &#42;U = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(U).second)</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastOperator&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(WorkList, BO-&gt;users());</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ASC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AddrSpaceCastOperator&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(WorkList, ASC-&gt;users());</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GEPOperator&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(WorkList, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;users());</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// A load from a uniform value is always the same, regardless of any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// applied offset.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = LI-&gt;getType();</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Res = <a href="/docs/api/namespaces/llvm/#a65bb0005c2f40b94623bae2e9a51fe48">ConstantFoldLoadFromUniformValue</a>(<a href="/docs/api/classes/llvm/init">Init</a>, Ty, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">        LI-&gt;replaceAllUsesWith(Res);</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">        EraseFromParent(LI);</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;PtrOp = LI-&gt;getPointerOperand();</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(PtrOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), 0);</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">      PtrOp = PtrOp-&gt;<a href="/docs/api/classes/llvm/value/#a23c582e2452eeb2b2cf6e0c43eca617e">stripAndAccumulateConstantOffsets</a>(</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </Highlight><Highlight kind="comment">/&#42; AllowNonInbounds &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(PtrOp)) &#123;</Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::threadlocal&#95;address)</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">          PtrOp = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0);</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PtrOp == GV) &#123;</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/classes/llvm/value">Value</a> = <a href="/docs/api/namespaces/llvm/#a8f2a6934eba2671f2fe2a121f2e9e4e9">ConstantFoldLoadFromConst</a>(<a href="/docs/api/classes/llvm/init">Init</a>, Ty, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">          LI-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/value">Value</a>);</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">          EraseFromParent(LI);</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Store must be unreachable or storing Init into the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">      EraseFromParent(<a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/memintrinsic">MemIntrinsic</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemIntrinsic&gt;</a>(U)) &#123; </Highlight><Highlight kind="comment">// memset/cpy/mv</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getRawDest()) == GV)</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">        EraseFromParent(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::threadlocal&#95;address)</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(WorkList, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;users());</Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |=</Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#abca8e2c525d8162fbcbb5b444cf04d21">RecursivelyDeleteTriviallyDeadInstructionsPermissive</a>(MaybeDeadInsts);</Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/constant/#a960620248182018e566b095f06a605df">removeDeadConstantUsers</a>();</Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="comment">/// Part of the global at a specific offset, which is only accessed through</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="comment">/// loads and stores with the given type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348" lineLink="/docs/api/structs/globalpart"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/globalpart">GlobalPart</a> &#123;</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349" lineLink="/docs/api/structs/globalpart/#acbba05937c52073db4faee7b8da398c7"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/structs/globalpart/#acbba05937c52073db4faee7b8da398c7">Ty</a>;</Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350" lineLink="/docs/api/structs/globalpart/#a5c4685db9d86c571d15bd150d0ad202e"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/structs/globalpart/#a5c4685db9d86c571d15bd150d0ad202e">Initializer</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351" lineLink="/docs/api/structs/globalpart/#aaf412764f257b95b2c815e560d341a7f"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/globalpart/#aaf412764f257b95b2c815e560d341a7f">IsLoaded</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352" lineLink="/docs/api/structs/globalpart/#a307cf132661ebc6f18cdbf3004c58b6e"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/globalpart/#a307cf132661ebc6f18cdbf3004c58b6e">IsStored</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="comment">/// Look at all uses of the global and determine which (offset, type) pairs it</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="comment">/// can be split into.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357" lineLink="#a4062c17e282cb2667cf0d52150c67fea"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a4062c17e282cb2667cf0d52150c67fea">collectSRATypes</a>(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;uint64&#95;t, GlobalPart&gt;</a> &amp;Parts,</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Use &#42;, 16&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Use &#42;, 16&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AppendUses = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : V-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>())</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;U).second)</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;U);</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">  AppendUses(GV);</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/use">Use</a> &#42;U = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/user">User</a> &#42;V = U-&gt;getUser();</Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GEPOperator&gt;</a>(V);</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastOperator&gt;</a>(V) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AddrSpaceCastOperator&gt;</a>(V) ||</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">        (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllConstantIndices())) &#123;</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal">      AppendUses(V);</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This is storing the global address into somewhere, not storing into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(V) &amp;&amp; U-&gt;getOperandNo() == 0)</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType()), 0);</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;stripAndAccumulateConstantOffsets(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">                                                   </Highlight><Highlight kind="comment">/&#42; AllowNonInbounds &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> != GV || <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getActiveBits() &gt;= 64)</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: We currently require that all accesses at a given offset must</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// use the same type. This could be relaxed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(V);</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;It, Inserted&#93; =</Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">          Parts.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue(), <a href="/docs/api/structs/globalpart">GlobalPart</a>&#123;Ty&#125;);</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ty != It-&gt;second.Ty)</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inserted) &#123;</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">        It-&gt;second.Initializer =</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a8f2a6934eba2671f2fe2a121f2e9e4e9">ConstantFoldLoadFromConst</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>(), Ty, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!It-&gt;second.Initializer) &#123;</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Global SRA: Failed to evaluate initializer of &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">                            &lt;&lt; &#42;GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with type &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Ty &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; at offset &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">                            &lt;&lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue());</Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Scalable types not currently supported.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ty-&gt;isScalableTy())</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsStored = &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Initializer) &#123;</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>)</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;StoredConst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!StoredConst)</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Don&#39;t consider stores that only write the initializer value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Initializer != StoredConst;</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">      &#125;;</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">      It-&gt;second.IsLoaded |= <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal">      It-&gt;second.IsStored |= IsStored(V, It-&gt;second.Initializer);</Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ignore dead constant users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a6b369f94d5ebc6e107a988f17b42b3eb">isSafeToDestroyConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Unknown user.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="comment">/// Copy over the debug info for a variable to its SRA replacements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446" lineLink="#a6989fb54b0ff045520a716621e13067d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a6989fb54b0ff045520a716621e13067d">transferSRADebugInfo</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;NGV,</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">                                 uint64&#95;t FragmentOffsetInBits,</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">                                 uint64&#95;t FragmentSizeInBits,</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">                                 uint64&#95;t VarSize) &#123;</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DIGlobalVariableExpression &#42;, 1&gt;</a> GVs;</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a7bd3c333fa06c8fae17d52a78db3fde2">getDebugInfo</a>(GVs);</Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GVE : GVs) &#123;</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/divariable">DIVariable</a> &#42;Var = GVE-&gt;getVariable();</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;Expr = GVE-&gt;getExpression();</Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal">    int64&#95;t CurVarOffsetInBytes = 0;</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">    uint64&#95;t CurVarOffsetInBits = 0;</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal">    uint64&#95;t FragmentEndInBits = FragmentOffsetInBits + FragmentSizeInBits;</Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Calculate the offset (Bytes), Continue if unknown.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Expr-&gt;<a href="/docs/api/classes/llvm/diexpression/#a25ddc726fd7cdca07f747a5394c7c492">extractIfOffset</a>(CurVarOffsetInBytes))</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ignore negative offset.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarOffsetInBytes &lt; 0)</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Convert offset to bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">    CurVarOffsetInBits = CHAR&#95;BIT &#42; (uint64&#95;t)CurVarOffsetInBytes;</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Current var starts after the fragment, ignore.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarOffsetInBits &gt;= FragmentEndInBits)</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">    uint64&#95;t CurVarSize = Var-&gt;<a href="/docs/api/classes/llvm/divariable/#adab9179b79371579b407e31155a32366">getType</a>()-&gt;<a href="/docs/api/classes/llvm/ditype/#a8b53bdd5b8f1d8cd12a392c256cb54f3">getSizeInBits</a>();</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">    uint64&#95;t CurVarEndInBits = CurVarOffsetInBits + CurVarSize;</Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Current variable ends before start of fragment, ignore.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarSize != 0 &amp;&amp; </Highlight><Highlight kind="comment">/&#42; CurVarSize is known &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">        CurVarEndInBits &lt;= FragmentOffsetInBits)</Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Current variable fits in (not greater than) the fragment,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// does not need fragment expression.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarSize != 0 &amp;&amp; </Highlight><Highlight kind="comment">/&#42; CurVarSize is known &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">        CurVarOffsetInBits &gt;= FragmentOffsetInBits &amp;&amp;</Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">        CurVarEndInBits &lt;= FragmentEndInBits) &#123;</Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">      uint64&#95;t CurVarOffsetInFragment =</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">          (CurVarOffsetInBits - FragmentOffsetInBits) / 8;</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarOffsetInFragment != 0)</Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">        Expr = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIExpression::get</a>(Expr-&gt;<a href="/docs/api/classes/llvm/mdnode/#ad2fecba192de6da1578bdcb78d524169">getContext</a>(), &#123;dwarf::DW&#95;OP&#95;plus&#95;uconst,</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">                                                      CurVarOffsetInFragment&#125;);</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">        Expr = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIExpression::get</a>(Expr-&gt;<a href="/docs/api/classes/llvm/mdnode/#ad2fecba192de6da1578bdcb78d524169">getContext</a>(), &#123;&#125;);</Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NGVE =</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIGlobalVariableExpression::get</a>(GVE-&gt;getContext(), Var, Expr);</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">      NGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aebcc339b418cae92442b394b33359705">addDebugInfo</a>(NGVE);</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Current variable does not fit in single fragment,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// emit a fragment expression.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FragmentSizeInBits &lt; VarSize) &#123;</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarOffsetInBits &gt; FragmentOffsetInBits)</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">      uint64&#95;t CurVarFragmentOffsetInBits =</Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">          FragmentOffsetInBits - CurVarOffsetInBits;</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">      uint64&#95;t CurVarFragmentSizeInBits = FragmentSizeInBits;</Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarSize != 0 &amp;&amp; CurVarEndInBits &lt; FragmentEndInBits)</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">        CurVarFragmentSizeInBits -= (FragmentEndInBits - CurVarEndInBits);</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurVarOffsetInBits)</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">        Expr = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIExpression::get</a>(Expr-&gt;<a href="/docs/api/classes/llvm/mdnode/#ad2fecba192de6da1578bdcb78d524169">getContext</a>(), &#123;&#125;);</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/classes/llvm/diexpression/#ab2fc167f75191e1d22e12e8e382605bb">DIExpression::createFragmentExpression</a>(</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">              Expr, CurVarFragmentOffsetInBits, CurVarFragmentSizeInBits))</Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">        Expr = &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NGVE = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIGlobalVariableExpression::get</a>(GVE-&gt;getContext(), Var, Expr);</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">    NGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aebcc339b418cae92442b394b33359705">addDebugInfo</a>(NGVE);</Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="comment">/// Perform scalar replacement of aggregates on the specified global variable.</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="comment">/// This opens the door for other optimizations by exposing the behavior of the</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="comment">/// program in a more fine-grained way.  We have determined that this</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="comment">/// transformation is safe already.  We return the first global variable we</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="comment">/// insert so that the caller can reprocess it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526" lineLink="#af376f4f0e0b55e40407912678b736863"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;<a href="#af376f4f0e0b55e40407912678b736863">SRAGlobal</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>());</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect types to split into.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;uint64&#95;t, GlobalPart&gt;</a> Parts;</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a4062c17e282cb2667cf0d52150c67fea">collectSRATypes</a>(Parts, GV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) || Parts.<a href="/docs/api/classes/llvm/densemapbase/#a49c487a9395a6c384be8544cfb2cfccf">empty</a>())</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure we don&#39;t SRA back to the same type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Parts.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() == 1 &amp;&amp; Parts.<a href="/docs/api/classes/llvm/densemapbase/#a50d461a887e200e704e5157d3b21514d">begin</a>()-&gt;second.Ty == GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>())</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t perform SRA if we would have to split into many globals. Ignore</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// parts that are either only loaded or only stored, because we expect them</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to be optimized away.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumParts = <a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">count&#95;if</a>(Parts, &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair) &#123;</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Pair.second.IsLoaded &amp;&amp; Pair.second.IsStored;</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumParts &gt; 16)</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort by offset.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::tuple&lt;uint64&#95;t, Type &#42;, Constant &#42;&gt;</a>, 16&gt; TypesVector;</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair : Parts) &#123;</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">    TypesVector.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">        &#123;Pair.first, Pair.second.Ty, Pair.second.Initializer&#125;);</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(TypesVector, <a href="/docs/api/structs/llvm/less-first">llvm::less&#95;first</a>());</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that the types are non-overlapping.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">  uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 0;</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;OffsetForTy, Ty, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; : TypesVector) &#123;</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Overlaps with previous type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OffsetForTy &lt; <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = OffsetForTy + <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(Ty);</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Some accesses go beyond the end of the global, don&#39;t bother.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()))</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;PERFORMING GLOBAL SRA ON: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the alignment of the global, either explicit or target-specific.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/align">Align</a> StartAlignment =</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getValueOrABITypeAlignment(GV-&gt;<a href="/docs/api/classes/llvm/globalobject/#a115ac0121663aa8365e095d095d0c633">getAlign</a>(), GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>());</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">  uint64&#95;t VarSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>());</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create replacement globals.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;uint64&#95;t, GlobalVariable &#42;&gt;</a> NewGlobals;</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NameSuffix = 0;</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;OffsetForTy, Ty, Initializer&#93; : TypesVector) &#123;</Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;NGV = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">        &#42;GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>(), Ty, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">        Initializer, GV-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.&quot;</Highlight><Highlight kind="normal"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(NameSuffix++), GV,</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">        GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a52126ae2091b18cecfd5ad0f0012839a">getThreadLocalMode</a>(), GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a702d4986803a1782ba305b1c7a0f1c21">getAddressSpace</a>());</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Start out by copying attributes from the original, including alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">    NGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a53f47ebcc1a7ac4553ba2a2eeca596e5">copyAttributesFrom</a>(GV);</Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">    NewGlobals.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;OffsetForTy, NGV&#125;);</Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Calculate the known alignment of the field.  If the original aggregate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// had 256 byte alignment for example, then the element at a given offset</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// may also have a known alignment, and something might depend on that:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// propagate info to each field.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/align">Align</a> NewAlign = <a href="/docs/api/namespaces/llvm/#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(StartAlignment, OffsetForTy);</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">    NGV-&gt;<a href="/docs/api/classes/llvm/globalobject/#a49b398b1c83ef4d42c8f7756b443f61f">setAlignment</a>(NewAlign);</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Copy over the debug info for the variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">    <a href="#a6989fb54b0ff045520a716621e13067d">transferSRADebugInfo</a>(GV, NGV, OffsetForTy &#42; 8,</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">                         <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSizeInBits(Ty), VarSize);</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace uses of the original global with uses of the new global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 16&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 16&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 16&gt;</a> DeadInsts;</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AppendUsers = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : V-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(U).second)</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(U);</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">  AppendUsers(GV);</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastOperator&gt;</a>(V) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AddrSpaceCastOperator&gt;</a>(V) ||</Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GEPOperator&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">      AppendUsers(V);</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">        DeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(V);</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType()), 0);</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;stripAndAccumulateConstantOffsets(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">                                                   </Highlight><Highlight kind="comment">/&#42; AllowNonInbounds &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == GV &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Load/store must be from/to global&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;NGV = NewGlobals&#91;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.getZExtValue()&#93;;</Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NGV &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must have replacement global for this offset&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Update the pointer operand and recalculate alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/align">Align</a> PrefAlign = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPrefTypeAlign(<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(V));</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/align">Align</a> NewAlign =</Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a6e7b79b3933def717c2a0f2fc6fa38e0">getOrEnforceKnownAlignment</a>(NGV, PrefAlign, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V));</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">        LI-&gt;setOperand(0, NGV);</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">        LI-&gt;setAlignment(NewAlign);</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setOperand(1, NGV);</Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setAlignment(NewAlign);</Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a6b369f94d5ebc6e107a988f17b42b3eb">isSafeToDestroyConstant</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(V)) &amp;&amp;</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Other users can only be dead constants&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Delete old instructions and global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(DeadInsts);</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/constant/#a960620248182018e566b095f06a605df">removeDeadConstantUsers</a>();</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">  ++NumSRA;</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewGlobals.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() &gt; 0);</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewGlobals.<a href="/docs/api/classes/llvm/densemapbase/#a50d461a887e200e704e5157d3b21514d">begin</a>()-&gt;second;</Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="comment">/// Return true if all users of the specified value will trap if the value is</Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="comment">/// dynamically null.  PHIs keeps track of any phi nodes we&#39;ve seen to avoid</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="comment">/// reprocessing them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661" lineLink="#a2cf59a15a8b7603c5d66d8fdb117ecec"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a2cf59a15a8b7603c5d66d8fdb117ecec">AllUsesOfValueWillTrapIfNull</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;const PHINode&#42;&gt;</a> &amp;PHIs) &#123;</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : V-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If null pointer is considered valid, then all uses are non-trapping.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Non address-space 0 globals have already been pruned by the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction()))</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Will trap.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(0) == V) &#123;</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;  </Highlight><Highlight kind="comment">// Storing the value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;getCalledOperand() != V) &#123;</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;  </Highlight><Highlight kind="comment">// Not calling the ptr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getCalledOperand() != V) &#123;</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;  </Highlight><Highlight kind="comment">// Not calling the ptr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/addrspacecastinst">AddrSpaceCastInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AddrSpaceCastInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2cf59a15a8b7603c5d66d8fdb117ecec">AllUsesOfValueWillTrapIfNull</a>(CI, PHIs))</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;GEPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2cf59a15a8b7603c5d66d8fdb117ecec">AllUsesOfValueWillTrapIfNull</a>(GEPI, PHIs)) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we&#39;ve already seen this phi node, ignore it, it has already been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// checked.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHIs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PN).second &amp;&amp; !<a href="#a2cf59a15a8b7603c5d66d8fdb117ecec">AllUsesOfValueWillTrapIfNull</a>(PN, PHIs))</Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ICmpInst&gt;</a>(U) &amp;&amp;</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">               !<a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">ICmpInst::isSigned</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(U)-&gt;getPredicate()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(U-&gt;getOperand(0)) &amp;&amp;</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(U-&gt;getOperand(1))) &#123;</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(U-&gt;getOperand(0))</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">                                  -&gt;getPointerOperand()</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">                                  -&gt;stripPointerCasts()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Should be GlobalVariable&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This and only this kind of non-signed ICmpInst is to be replaced with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the comparing of the value of the created global init bool later in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// optimizeGlobalAddressOfAllocation for the global variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="comment">/// Return true if all uses of any loads from GV will trap if the loaded value</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="comment">/// is null.  Note that this also permits comparisons of the loaded value</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="comment">/// against null, as a special case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715" lineLink="#a26f6a2c21d213fbcbe99a2c09d88a2c4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a26f6a2c21d213fbcbe99a2c09d88a2c4">allUsesOfLoadedValueWillTrapIfNull</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV) &#123;</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(GV);</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LI-&gt;isSimple())</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const PHINode &#42;, 8&gt;</a> PHIs;</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2cf59a15a8b7603c5d66d8fdb117ecec">AllUsesOfValueWillTrapIfNull</a>(LI, PHIs))</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isSimple())</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Ignore stores to the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand() != <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>)</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CE-&gt;stripPointerCasts() != GV)</Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Check further the ConstantExpr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CE);</Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We don&#39;t know or understand this user, bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="comment">/// Get all the loads/store uses for global variable \\p GV.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749" lineLink="#a8e68884ca018dde6dfadf535637290d0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8e68884ca018dde6dfadf535637290d0">allUsesOfLoadAndStores</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV,</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> &amp;<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>) &#123;</Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(GV);</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CE);</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(U) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(U)) &amp;&amp;</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Expect only load or store instructions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(U);</Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768" lineLink="#aef572ae661cf9f5b14651ef952629c10"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewV) &#123;</Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> UI = V-&gt;user&#95;begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = V-&gt;user&#95;end(); UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ) &#123;</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;UI++);</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Uses are non-trapping if null pointer is considered valid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Non address-space 0 globals are already pruned by the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction()))</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal">      LI-&gt;setOperand(0, NewV);</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(1) == V) &#123;</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setOperand(1, NewV);</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>() == V) &#123;</Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Calling through the pointer!  Turn into a direct call, but be careful</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// that the pointer is not also being passed as an argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">        CB-&gt;<a href="/docs/api/classes/llvm/callbase/#ad70fe60b7ed052c6a74863944b518251">setCalledOperand</a>(NewV);</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> PassedAsArg = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = CB-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>(); i != e; ++i)</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(i) == V) &#123;</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">            PassedAsArg = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">            CB-&gt;<a href="/docs/api/classes/llvm/callbase/#abc10b887caad109288ffceb230493a85">setArgOperand</a>(i, NewV);</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PassedAsArg) &#123;</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Being passed as an argument also.  Be careful to not invalidate UI!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal">          UI = V-&gt;user&#95;begin();</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/addrspacecastinst">AddrSpaceCastInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AddrSpaceCastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal">          CI, <a href="/docs/api/classes/llvm/constantexpr/#acac8bfd6018661b40690c621bece1540">ConstantExpr::getAddrSpaceCast</a>(NewV, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;use&#95;empty()) &#123;</Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">        CI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;GEPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Should handle GEP here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant&#42;, 8&gt;</a> Idxs;</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal">      Idxs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(GEPI-&gt;getNumOperands()-1);</Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user/#a0126e6f10273e8db07142833979a0c8f">User::op&#95;iterator</a> i = GEPI-&gt;op&#95;begin() + 1, e = GEPI-&gt;op&#95;end();</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">           i != e; ++i)</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(&#42;i))</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">          Idxs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Idxs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == GEPI-&gt;getNumOperands()-1)</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">            GEPI, <a href="/docs/api/classes/llvm/constantexpr/#ae4d4490a35a575d97166684fb15f8662">ConstantExpr::getGetElementPtr</a>(GEPI-&gt;getSourceElementType(),</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">                                                 NewV, Idxs));</Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPI-&gt;use&#95;empty()) &#123;</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">        GEPI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="comment">/// The specified global has only one non-null value stored into it.  If there</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="comment">/// are uses of the loaded value that would trap if the loaded value is</Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="comment">/// dynamically null, then we know that they cannot be reachable with a null</Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="comment">/// optimize away the load.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838" lineLink="#ab7fe47fe1b533f4c9bdd23baf28f3c8c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ab7fe47fe1b533f4c9bdd23baf28f3c8c">OptimizeAwayTrappingUsesOfLoads</a>(</Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;LV, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI) &#123;</Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Keep track of whether we are able to remove all the uses of the global</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// other than the store that defines it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllNonStoreUsesGone = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace all uses of loads with uses of uses of the stored value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;GlobalUser : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())) &#123;</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(GlobalUser)) &#123;</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(LI, LV);</Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we were able to delete all uses of the loads</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LI-&gt;use&#95;empty()) &#123;</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">        LI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">        AllNonStoreUsesGone = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(GlobalUser)) &#123;</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Ignore the store that stores &quot;LV&quot; to the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GlobalUser-&gt;getOperand(1) == GV &amp;&amp;</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Must be storing &#42;to&#42; the global&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">      AllNonStoreUsesGone = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we get here we could have other crazy uses that are transitively</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// loaded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(GlobalUser) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(GlobalUser) ||</Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantExpr&gt;</a>(GlobalUser) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(GlobalUser) ||</Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(GlobalUser) ||</Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(GlobalUser) ||</Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AddrSpaceCastInst&gt;</a>(GlobalUser)) &amp;&amp;</Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Only expect load and stores!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>) &#123;</Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;OPTIMIZED LOADS FROM STORED ONCE POINTER: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;GV</Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal">    ++NumGlobUses;</Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we nuked all of the loads, then none of the stores are needed either,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// nor is the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllNonStoreUsesGone) &#123;</Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a>(GV)) &#123;</Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#adc803f628b45e58e3de84b46dd0b7d83">CleanupPointerRootUsers</a>(GV, GetTLI);</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">      <a href="#ac3cf098d54027ac28278b060376bdcbd">CleanupConstantGlobalUsers</a>(GV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  &#42;&#42;&#42; GLOBAL NOW DEAD!\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">      ++NumDeleted;</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="comment">/// Walk the use list of V, constant folding all of the instructions that are</Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="comment">/// foldable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903" lineLink="#a1c6c0f8bb397fee19be6ef20f299afdf"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a1c6c0f8bb397fee19be6ef20f299afdf">ConstantPropUsersOf</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI) &#123;</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> UI = V-&gt;user&#95;begin(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = V-&gt;user&#95;end(); UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; )</Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(&#42;UI++))</Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewC = <a href="/docs/api/namespaces/llvm/#ab6be6270337c6f7620007555247401ce">ConstantFoldInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLI)) &#123;</Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(NewC);</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Advance UI to the next non-I use to avoid invalidating it!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Instructions could multiply use V.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (UI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> &amp;&amp; &#42;UI == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">          ++UI;</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLI))</Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="comment">/// This function takes the specified global variable, and transforms the</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="comment">/// program as if it always contained the result of the specified malloc.</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="comment">/// Because it is always the result of the specified malloc, there is no reason</Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="comment">/// to actually DO the malloc.  Instead, turn the malloc into a global, and any</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="comment">/// loads of GV as uses of the new global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925" lineLink="#a31b17b67a86749cfd99e97041c819791"><Highlight kind="normal"><a href="#a31b17b67a86749cfd99e97041c819791">OptimizeGlobalAddressOfAllocation</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">                                  uint64&#95;t AllocSize, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;InitVal,</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI) &#123;</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;PROMOTING GLOBAL: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  CALL = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;CI</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create global of type &#91;AllocSize x i8&#93;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;GlobalType = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/classes/llvm/type/#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()),</Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal">                                    AllocSize);</Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the new global variable.  The contents of the allocated memory is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// undefined initially, so initialize with an undef value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;NewGV = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(</Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">      &#42;GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>(), GlobalType, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(GlobalType), GV-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.body&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a52126ae2091b18cecfd5ad0f0012839a">getThreadLocalMode</a>());</Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Initialize the global at the point of the original call.  Note that this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is a different point from the initialization referred to below for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// nullability handling.  Sublety: We have not proven the original global was</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// only initialized once.  As such, we can not fold this into the initializer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the new global as may need to re-init the storage multiple times.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(InitVal)) &#123;</Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Use alignment above if align!=1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4910aab8d7c5528c1a3ac747856c3186">CreateMemSet</a>(NewGV, InitVal, AllocSize, std::nullopt);</Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update users of the allocation to use the new global instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">  CI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewGV);</Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is a comparison against null, we will insert a global bool to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// keep track of whether the global was initialized yet or not.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;InitBool = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()), </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()), GV-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.init&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a52126ae2091b18cecfd5ad0f0012839a">getThreadLocalMode</a>(), GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a702d4986803a1782ba305b1c7a0f1c21">getAddressSpace</a>());</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InitBoolUsed = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loop over all instruction uses of GV, processing them in turn.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> Guses;</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal">  <a href="#a8e68884ca018dde6dfadf535637290d0">allUsesOfLoadAndStores</a>(GV, Guses);</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : Guses) &#123;</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The global is initialized when the store to it occurs. If the stored</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// value is null value, the global bool is set to false, otherwise true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a>(<a href="/docs/api/classes/llvm/constantint/#afe7d477c6022fe7123b90e3b39c58e69">ConstantInt::getBool</a>(</Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">                        GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(),</Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">                        !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand())),</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">                    InitBool, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/align">Align</a>(1), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOrdering(),</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">                    <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getSyncScopeID(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!LI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/use">Use</a> &amp;LoadUse = &#42;LI-&gt;<a href="/docs/api/classes/llvm/value/#a413abcab8dbc3900fc2fde96a5d8fca6">use&#95;begin</a>();</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(LoadUse.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>());</Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ICI) &#123;</Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">        LoadUse.<a href="/docs/api/classes/llvm/use/#a40360b4fa7b8e6920a68e5a8a0814f1f">set</a>(NewGV);</Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Replace the cmp X, 0 with a use of the bool value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;LV = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a>(InitBool-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>(), InitBool,</Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">                               InitBool-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.val&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/align">Align</a>(1),</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">                               LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>(), LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#aca6c2de6950cb093f509ed2b67e02da2">getSyncScopeID</a>(),</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">                               LI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">      InitBoolUsed = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>()) &#123;</Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">: <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Unknown ICmp Predicate!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>: </Highlight><Highlight kind="comment">// X &lt; null -&gt; always false</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">        LV = <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba573bcd571c938fce863525330bbfc4b8">ICmpInst::ICMP&#95;UGE</a>: </Highlight><Highlight kind="comment">// X &gt;= null -&gt; always true</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">        LV = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a>:</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>:</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">        LV = <a href="/docs/api/classes/llvm/binaryoperator/#a8578626ceb87974ed94fd56b56a37346">BinaryOperator::CreateNot</a>(LV, </Highlight><Highlight kind="stringliteral">&quot;notinit&quot;</Highlight><Highlight kind="normal">, ICI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>:</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>:</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;  </Highlight><Highlight kind="comment">// no change.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">      ICI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(LV);</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">      ICI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">    LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the initialization boolean was used, insert it, otherwise delete it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InitBoolUsed) &#123;</Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!InitBool-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())  </Highlight><Highlight kind="comment">// Delete initializations</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(InitBool-&gt;<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>())-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">delete</Highlight><Highlight kind="normal"> InitBool;</Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal">    GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/module/#aac75aa0b7583c039e8a9d4ccae280769">insertGlobalVariable</a>(GV-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), InitBool);</Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now the GV is dead, nuke it and the allocation..</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal">  CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To further other optimizations, loop over all users of NewGV and try to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constant prop them.  This will promote GEP instructions with constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// indices into GEP constant-exprs, which will allow global-opt to hack on it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">  <a href="#a1c6c0f8bb397fee19be6ef20f299afdf">ConstantPropUsersOf</a>(NewGV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLI);</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewGV;</Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="comment">/// Scan the use-list of GV checking to make sure that there are no complex uses</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="comment">/// of GV.  We permit simple things like dereferencing the pointer, but not</Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="comment">/// storing through the address, unless it is to the specified global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042" lineLink="#a406d93c10bd410f7ef8af5c00b037b8b"><Highlight kind="normal"><a href="#a406d93c10bd410f7ef8af5c00b037b8b">valueIsOnlyUsedLocallyOrStoredToOneGlobal</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal">                                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV) &#123;</Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 4&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(V).second)</Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;VUse : V-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U = VUse.getUser();</Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(U) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Fine, ignore.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand() == V &amp;&amp;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand()-&gt;stripPointerCasts() != GV)</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Storing the pointer not into GV... bad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Otherwise, storing through it, or storing into GV... fine.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GEPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(GEPI);</Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="comment">/// If we have a global that is only initialized with a fixed size allocation</Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="comment">/// try to transform the program to use global memory instead of heap</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="comment">/// allocated memory. This eliminates dynamic allocation, avoids an indirection</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="comment">/// accessing the data, and exposes the resultant global to further GlobalOpt.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081" lineLink="#a1ae624f5747718933b1dabc6a03689aa"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a1ae624f5747718933b1dabc6a03689aa">tryToOptimizeStoreOfAllocationToGlobal</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV,</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">                                                   </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI) &#123;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a2787d1134842ab0b9be8694d95ccbdd7">isRemovableAlloc</a>(CI, TLI))</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Must be able to remove the call when we get done..</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Int8Ty = <a href="/docs/api/classes/llvm/type/#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>());</Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;InitVal = <a href="/docs/api/namespaces/llvm/#a108b6e33f153eda5019d322f0ac909b0">getInitialValueOfAllocation</a>(CI, TLI, Int8Ty);</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InitVal)</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Must be able to emit a memset for initialization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">  uint64&#95;t AllocSize;</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a62ba0e5ee2d86f663c6de4efda6082a7">getObjectSize</a>(CI, AllocSize, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLI, <a href="/docs/api/structs/llvm/objectsizeopts">ObjectSizeOpts</a>()))</Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Restrict this transformation to only working on small allocations</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (2048 bytes currently), as we don&#39;t want to introduce a 16M global or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// something.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllocSize &gt;= 2048)</Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can&#39;t optimize this global unless all uses of it are &#42;known&#42; to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the malloc value, not of the null initializer value (consider a use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that compares the global&#39;s value against zero to see if the malloc has</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// been reached).  To do this, we check to see if all uses of the global</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// would trap if the global were null: this proves that they must all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// happen after the malloc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a26f6a2c21d213fbcbe99a2c09d88a2c4">allUsesOfLoadedValueWillTrapIfNull</a>(GV))</Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can&#39;t optimize this if the malloc itself is used in a complex way,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for example, being stored into multiple globals.  This allows the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// malloc to be stored into the specified global, loaded, gep, icmp&#39;d.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// These are all things we could transform to using the global for.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a406d93c10bd410f7ef8af5c00b037b8b">valueIsOnlyUsedLocallyOrStoredToOneGlobal</a>(CI, GV))</Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">  <a href="#a31b17b67a86749cfd99e97041c819791">OptimizeGlobalAddressOfAllocation</a>(GV, CI, AllocSize, InitVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLI);</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Try to optimize globals based on the knowledge that only one value (besides</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal"></Highlight><Highlight kind="comment">// its initializer) is ever stored to the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128" lineLink="#a13c72931678c2da267fc265c7a2afdfb"><Highlight kind="normal"><a href="#a13c72931678c2da267fc265c7a2afdfb">optimizeOnceStoredGlobal</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoredOnceVal,</Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">                         </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">                         <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI) &#123;</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ignore no-op GEPs and bitcasts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal">  StoredOnceVal = StoredOnceVal-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we are dealing with a pointer global that is initialized to null and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// only has one (non-null) value stored into it, then we can optimize any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// users of the loaded value (often calls and loads) that would trap if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value was null.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>()-&gt;<a href="/docs/api/classes/llvm/constant/#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">      StoredOnceVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42; F &#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">          GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>())) &#123;</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SOVC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(StoredOnceVal)) &#123;</Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Optimize away any trapping uses of the loaded value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ab7fe47fe1b533f4c9bdd23baf28f3c8c">OptimizeAwayTrappingUsesOfLoads</a>(GV, SOVC, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, GetTLI))</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#accaca14b419cbac91ca6170523084a04">isAllocationFn</a>(StoredOnceVal, GetTLI)) &#123;</Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(StoredOnceVal)) &#123;</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;TLI = &amp;GetTLI(&#42;CI-&gt;getFunction());</Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a1ae624f5747718933b1dabc6a03689aa">tryToOptimizeStoreOfAllocationToGlobal</a>(GV, CI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLI))</Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="comment">/// At this point, we have learned that the only two values ever stored into GV</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="comment">/// are its initializer and OtherVal.  See if we can shrink the global into a</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="comment">/// boolean and select between the two values whenever it is used.  This exposes</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="comment">/// the values to other scalar optimizations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164" lineLink="#a77de6d50432bef62e38fd24f2030026c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a77de6d50432bef62e38fd24f2030026c">TryToShrinkGlobalToBoolean</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OtherVal) &#123;</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;GVElType = GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>();</Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If GVElType is already i1, it is already shrunk.  If the type of the GV is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// an FP value, pointer or vector, don&#39;t do this optimization because a select</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// between them is very expensive and unlikely to lead to later</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// simplification.  In these cases, we typically end up with &quot;cond ? v1 : v2&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// where v1 and v2 both require constant pool loads, a big loss.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GVElType == <a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()) ||</Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal">      GVElType-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() ||</Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">      GVElType-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() || GVElType-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk the use list of the global seeing if all the uses are load or store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is anything else, bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : GV-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(U) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(U) != GVElType)</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;   &#42;&#42;&#42; SHRINKING TO BOOL: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the new global, initializing it to false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;NewGV = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()),</Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">                                             </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()),</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">                                             GV-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()+</Highlight><Highlight kind="stringliteral">&quot;.b&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">                                             GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a52126ae2091b18cecfd5ad0f0012839a">getThreadLocalMode</a>(),</Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">                                             GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a913a5d4b2cddde762446bd494e81a3f2">getType</a>()-&gt;<a href="/docs/api/classes/llvm/pointertype/#af8aeced5e71d2589fa3e9791043af5cb">getAddressSpace</a>());</Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">  NewGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a53f47ebcc1a7ac4553ba2a2eeca596e5">copyAttributesFrom</a>(GV);</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/module/#aac75aa0b7583c039e8a9d4ccae280769">insertGlobalVariable</a>(GV-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), NewGV);</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;InitVal = GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>();</Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InitVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != <a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;No reason to shrink to bool!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DIGlobalVariableExpression &#42;, 1&gt;</a> GVs;</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a7bd3c333fa06c8fae17d52a78db3fde2">getDebugInfo</a>(GVs);</Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If initialized to zero and storing one into the global, we can use a cast</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instead of a select to synthesize the desired value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsOneZero = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EmitOneOrZero = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(OtherVal);</Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI &amp;&amp; CI-&gt;getValue().getActiveBits() &lt;= 64) &#123;</Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal">    IsOneZero = InitVal-&gt;<a href="/docs/api/classes/llvm/constant/#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>() &amp;&amp; CI-&gt;isOne();</Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CIInit = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>());</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CIInit &amp;&amp; CIInit-&gt;getValue().getActiveBits() &lt;= 64) &#123;</Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">      uint64&#95;t ValInit = CIInit-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">      uint64&#95;t ValOther = CI-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">      uint64&#95;t ValMinus = ValOther - ValInit;</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal">(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GVe : GVs)&#123;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/diglobalvariable">DIGlobalVariable</a> &#42;DGV = GVe-&gt;getVariable();</Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = GVe-&gt;getExpression();</Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#aa5d2c67dadc073dac78224224ee89350">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SizeInOctets =</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSizeInBits(NewGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()) / 8;</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// It is expected that the address of global optimized variable is on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// top of the stack. After optimization, value of that variable will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// be ether 0 for initial value or 1 for other value. The following</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// expression should return constant integer value depending on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// value at global object address:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// val &#42; (ValOther - ValInit) + ValInit:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// DW&#95;OP&#95;deref DW&#95;OP&#95;constu &lt;ValMinus&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// DW&#95;OP&#95;mul DW&#95;OP&#95;constu &lt;ValInit&gt; DW&#95;OP&#95;plus DW&#95;OP&#95;stack&#95;value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 12&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a> = &#123;</Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">            dwarf::DW&#95;OP&#95;deref&#95;size, SizeInOctets,</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">            dwarf::DW&#95;OP&#95;constu, ValMinus,</Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">            dwarf::DW&#95;OP&#95;mul, dwarf::DW&#95;OP&#95;constu, ValInit,</Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">            dwarf::DW&#95;OP&#95;plus&#125;;</Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> WithStackValue = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/classes/llvm/diexpression/#af3a48df3735933cf1621760019e5fd8c">DIExpression::prependOpcodes</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, WithStackValue);</Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/diglobalvariableexpression">DIGlobalVariableExpression</a> &#42;DGVE =</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DIGlobalVariableExpression::get</a>(NewGV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), DGV, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>);</Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal">        NewGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aebcc339b418cae92442b394b33359705">addDebugInfo</a>(DGVE);</Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">     &#125;</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">     EmitOneOrZero = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EmitOneOrZero) &#123;</Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal">     </Highlight><Highlight kind="comment">// FIXME: This will only emit address for debugger on which will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">     </Highlight><Highlight kind="comment">// be written only 0 or 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">     </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal">(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GV : GVs)</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">       NewGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aebcc339b418cae92442b394b33359705">addDebugInfo</a>(GV);</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal">   &#125;</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!GV-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>());</Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(UI)) &#123;</Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Change the store into a boolean store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> StoringOther = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(0) == OtherVal;</Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Only do this if we weren&#39;t storing a loaded value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoreVal;</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StoringOther || <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(0) == InitVal) &#123;</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">        StoreVal = ConstantInt::get(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()),</Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">                                    StoringOther);</Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Otherwise, we are storing a previously loaded copy.  To do this,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// change the copy from copying the original value to just copying the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// bool.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StoredVal = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we&#39;ve already replaced the input, StoredVal will be a cast or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// select instruction.  If not, it will be a load of the original</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(StoredVal)) &#123;</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI-&gt;getOperand(0) == GV &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Not a copy!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Insert a new load, to preserve the saved value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">          StoreVal =</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">              </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a>(NewGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>(), NewGV, LI-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.b&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/align">Align</a>(1), LI-&gt;getOrdering(),</Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">                           LI-&gt;getSyncScopeID(), LI-&gt;getIterator());</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CastInst&gt;</a>(StoredVal) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(StoredVal)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;This is not a form that we understand!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">          StoreVal = StoredVal-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(StoreVal) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Not a load of NewGV!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;NSI =</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a>(StoreVal, NewGV, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/align">Align</a>(1), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOrdering(),</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">                        <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getSyncScopeID(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">      NSI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Change the load into a load of bool then a select.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(UI);</Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;NLI = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a>(</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">          NewGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>(), NewGV, LI-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.b&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/align">Align</a>(1),</Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">          LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>(), LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#aca6c2de6950cb093f509ed2b67e02da2">getSyncScopeID</a>(), LI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NSI;</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsOneZero)</Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">        NSI = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/zextinst">ZExtInst</a>(NLI, LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, LI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">        NSI = <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(NLI, OtherVal, InitVal, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, LI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">      NSI-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(LI);</Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Since LI is split into two instructions, NLI and NSI both inherit the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// same DebugLoc</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal">      NLI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">      NSI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">      LI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NSI);</Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">    UI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Retain the name of the old global variable. People who are debugging their</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// programs may expect these variables to be named the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">  NewGV-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(GV);</Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">  GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323" lineLink="#a5a50ba4ab5027d4013cf6bc2edf66085"><Highlight kind="normal"><a href="#a5a50ba4ab5027d4013cf6bc2edf66085">deleteIfDead</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &amp;GV,</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">             <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;const Comdat &#42;&gt;</a> &amp;NotDiscardableComdats,</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">             <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal">(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; DeleteFnCallback = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">  GV.<a href="/docs/api/classes/llvm/constant/#a960620248182018e566b095f06a605df">removeDeadConstantUsers</a>();</Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV.<a href="/docs/api/classes/llvm/globalvalue/#adcb86d621c23938671ad526d3bd1f9bd">isDiscardableIfUnused</a>() &amp;&amp; !GV.<a href="/docs/api/classes/llvm/globalvalue/#a32e606ac4c88f71f14212e42b808e7f4">isDeclaration</a>())</Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = GV.<a href="/docs/api/classes/llvm/globalvalue/#a43721e1e88567116e8fca545125d86bf">getComdat</a>())</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV.<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>() &amp;&amp; NotDiscardableComdats.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Dead;</Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(&amp;GV))</Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">    Dead = (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;use&#95;empty()) || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDefTriviallyDead();</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">    Dead = GV.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>();</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Dead)</Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;GLOBAL DEAD: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(&amp;GV)) &#123;</Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DeleteFnCallback)</Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal">      DeleteFnCallback(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/replaceablemetadataimpl/#a26887fb6f8b3127e6b28c2075dacbc11">ReplaceableMetadataImpl::SalvageDebugInfo</a>(GV);</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">  GV.<a href="/docs/api/classes/llvm/globalvalue/#a7c733400ba8d113fd2976d4fea0db981">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">  ++NumDeleted;</Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354" lineLink="#ade4086b409f00a755cfc6c0b03f67413"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ade4086b409f00a755cfc6c0b03f67413">isPointerValueDeadOnEntryToFunction</a>(</Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV,</Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree) &#123;</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find all uses of GV. We expect them all to be in F, and if we can&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// identify any of the uses we bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// On each of these uses, identify if the memory that GV points to is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// used/required/live at the start of the function. If it is not, for example</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if the first thing the function does is store to the GV, the GV can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// possibly be demoted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We don&#39;t do an exhaustive search for memory operations - simply look</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// through bitcasts as they&#39;re quite common and benign.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#aa5d2c67dadc073dac78224224ee89350">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;LoadInst &#42;, 4&gt;</a> Loads;</Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;StoreInst &#42;, 4&gt;</a> Stores;</Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : GV-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;getParent() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">      Loads.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LI);</Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">      Stores.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We have identified all uses of GV into loads and stores. Now check if all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of them are known not to depend on the value of the global at the function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// entry point. We do this by ensuring that every load is dominated by at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// least one store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DT = LookupDomTree(&#42;</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The below check is quadratic. Check we&#39;re not going to do too many tests.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Even though this will always have worst-case quadratic time, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// could put effort into minimizing the average time by putting stores that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// have been shown to dominate at least one load at the beginning of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Stores array, making subsequent dominance checks more likely to succeed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// early.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The threshold here is fairly large because global-&gt;local demotion is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// very powerful optimization should it fire.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Threshold = 100;</Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Loads.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &#42; Stores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; Threshold)</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;L : Loads) &#123;</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LTy = L-&gt;getType();</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(Stores, &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;S) &#123;</Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;STy = S-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// The load is only dominated by the store if DomTree says so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// and the number of bits loaded in L is less than or equal to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// the number of bits stored in S.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> DT.dominates(S, L) &amp;&amp;</Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">                 <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(LTy).getFixedValue() &lt;=</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">                     <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(STy).getFixedValue();</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All loads have known dependences inside F, so the global can be localized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal"></Highlight><Highlight kind="comment">// For a global variable with one store, if the store dominates any loads,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal"></Highlight><Highlight kind="comment">// those loads will always load the stored value (as opposed to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal"></Highlight><Highlight kind="comment">// initializer), even in the presence of recursion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423" lineLink="#ad15d45b871d3111e8da4f9b394d7c83f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ad15d45b871d3111e8da4f9b394d7c83f">forwardStoredOnceStore</a>(</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;StoredOnceStore,</Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree) &#123;</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoredOnceValue = StoredOnceStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>();</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can do this optimization for non-constants in nosync + norecurse</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// functions, but globals used in exactly one norecurse functions are already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// promoted to an alloca.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(StoredOnceValue))</Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = StoredOnceStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;LoadInst &#42;&gt;</a> Loads;</Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : GV-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LI-&gt;getFunction() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">          LI-&gt;getType() == StoredOnceValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp; LI-&gt;isSimple())</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal">        Loads.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LI);</Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only compute DT if we have any loads to examine.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Loads.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DT = LookupDomTree(&#42;</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LI : Loads) &#123;</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DT.dominates(StoredOnceStore, LI)) &#123;</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">        LI-&gt;replaceAllUsesWith(</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(StoredOnceValue));</Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">        LI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal">        MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeChange;</Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="comment">/// Analyze the specified global variable and optimize</Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="comment">/// it if possible.  If we make a change, return true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459" lineLink="#adf0a129dd6c07827f4a8a5914f2d8b5b"><Highlight kind="normal"><a href="#adf0a129dd6c07827f4a8a5914f2d8b5b">processInternalGlobal</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/globalstatus">GlobalStatus</a> &amp;GS,</Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI,</Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI,</Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree) &#123;</Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#aa5d2c67dadc073dac78224224ee89350">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is a first class global and has only one accessing function and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this function is non-recursive, we replace the global with a local alloca</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in this function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NOTE: It doesn&#39;t make sense to promote non-single-value types since we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// are just replacing static memory to stack memory.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the global is in different address space, don&#39;t bring it to stack.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GS.HasMultipleAccessingFunctions &amp;&amp;</Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal">      GS.AccessingFunction &amp;&amp;</Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a913a5d4b2cddde762446bd494e81a3f2">getType</a>()-&gt;<a href="/docs/api/classes/llvm/pointertype/#af8aeced5e71d2589fa3e9791043af5cb">getAddressSpace</a>() == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace() &amp;&amp;</Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">      !GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0f6dab3350ff78735031a6a62f344f18">isExternallyInitialized</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal">      GS.AccessingFunction-&gt;doesNotRecurse() &amp;&amp;</Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal">      <a href="#ade4086b409f00a755cfc6c0b03f67413">isPointerValueDeadOnEntryToFunction</a>(GS.AccessingFunction, GV,</Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal">                                          LookupDomTree)) &#123;</Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#aa5d2c67dadc073dac78224224ee89350">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LOCALIZING GLOBAL: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> FirstI =</Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">        GS.AccessingFunction-&gt;getEntryBlock().begin().getNonConst();</Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElemTy = GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>();</Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: Pass Global&#39;s alignment when globals have alignment</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a>(ElemTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace(),</Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal">                                        </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, GV-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(), FirstI);</Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>()))</Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>(), Alloca, FirstI);</Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">    GV-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Alloca);</Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">    GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">    ++NumLocalized;</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the global is never loaded (but may be stored to), it is dead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Delete it now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GS.IsLoaded) &#123;</Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;GLOBAL NEVER LOADED: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a>(GV)) &#123;</Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Delete any constant stores to the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = <a href="#adc803f628b45e58e3de84b46dd0b7d83">CleanupPointerRootUsers</a>(GV, GetTLI);</Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Delete any stores we can find to the global.  We may not be able to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// make it completely dead though.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = <a href="#ac3cf098d54027ac28278b060376bdcbd">CleanupConstantGlobalUsers</a>(GV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the global is dead now, delete it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal">      ++NumDeleted;</Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GS.StoredType &lt;= <a href="/docs/api/structs/llvm/globalstatus/#abe8cd5e07daf1b2bf532174823523ee7adcbfa969dc654b5812a05827152a42c5">GlobalStatus::InitializerStored</a>) &#123;</Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;MARKING CONSTANT: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;GV &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t actually mark a global constant if it&#39;s atomic because atomic loads</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// are implemented by a trivial cmpxchg in some edge-cases and that usually</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// requires write access to the variable even if it&#39;s not actually changed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GS.Ordering == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a>) &#123;</Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aa859e108741fa64681b63f0c0c672512">isConstant</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a non-constant global&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a40ae67d31da67ca17ed016839faf3390">setConstant</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Clean up any obviously simplifiable users now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#ac3cf098d54027ac28278b060376bdcbd">CleanupConstantGlobalUsers</a>(GV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the global is dead now, just nuke it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;   &#42;&#42;&#42; Marking constant allowed us to simplify &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;all users and delete global!\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">      ++NumDeleted;</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Fall through to the next check; see if we can optimize further.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">    ++NumMarked;</Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>()) &#123;</Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#aa5d2c67dadc073dac78224224ee89350">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#af376f4f0e0b55e40407912678b736863">SRAGlobal</a>(GV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoredOnceValue = GS.getStoredOnceValue();</Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GS.StoredType == <a href="/docs/api/structs/llvm/globalstatus/#abe8cd5e07daf1b2bf532174823523ee7aecd55f74522361f4b8056f8b6b745699">GlobalStatus::StoredOnce</a> &amp;&amp; StoredOnceValue) &#123;</Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &amp;StoreFn =</Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a> &amp;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(&#42;GS.StoredOnceStore-&gt;getFunction());</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CanHaveNonUndefGlobalInitializer =</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">        GetTTI(StoreFn).canHaveNonUndefGlobalInitializerInAddressSpace(</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal">            GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a913a5d4b2cddde762446bd494e81a3f2">getType</a>()-&gt;<a href="/docs/api/classes/llvm/pointertype/#af8aeced5e71d2589fa3e9791043af5cb">getAddressSpace</a>());</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the initial value for the global was an undef value, and if only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// one other value was stored into it, we can just change the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// initializer to be the stored value, then delete all stores to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// global.  This allows us to mark it constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This is restricted to address spaces that allow globals to have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// initializers. NVPTX, for example, does not support initializers for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// shared memory (AS 3).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SOVConstant = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(StoredOnceValue);</Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SOVConstant &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(SOVConstant-&gt;getType()) ==</Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">        CanHaveNonUndefGlobalInitializer) &#123;</Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SOVConstant-&gt;getType() == GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()) &#123;</Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Change the initializer in place.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">        GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(SOVConstant);</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Create a new global with adjusted type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NGV = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(</Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">            &#42;GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>(), SOVConstant-&gt;getType(), GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aa859e108741fa64681b63f0c0c672512">isConstant</a>(),</Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">            GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3547d58a060ee2e4a29cbea85bef91af">getLinkage</a>(), SOVConstant, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, GV, GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a52126ae2091b18cecfd5ad0f0012839a">getThreadLocalMode</a>(),</Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">            GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a702d4986803a1782ba305b1c7a0f1c21">getAddressSpace</a>());</Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">        NGV-&gt;takeName(GV);</Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">        NGV-&gt;copyAttributesFrom(GV);</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal">        GV-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NGV);</Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">        GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">        GV = NGV;</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Clean up any obviously simplifiable users now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">      <a href="#ac3cf098d54027ac28278b060376bdcbd">CleanupConstantGlobalUsers</a>(GV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;   &#42;&#42;&#42; Substituting initializer allowed us to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;simplify all users and delete global!\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">        GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal">        ++NumDeleted;</Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal">      ++NumSubstitute;</Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to optimize globals based on the knowledge that only one value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (besides its initializer) is ever stored to the global.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a13c72931678c2da267fc265c7a2afdfb">optimizeOnceStoredGlobal</a>(GV, StoredOnceValue, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, GetTLI))</Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to forward the store to any loads. If we have more than one store, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// may have a store of the initializer between StoredOnceStore and a load.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GS.NumStores == 1)</Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ad15d45b871d3111e8da4f9b394d7c83f">forwardStoredOnceStore</a>(GV, GS.StoredOnceStore, LookupDomTree))</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, if the global was not a boolean, we can shrink it to be a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// boolean. Skip this optimization for AS that doesn&#39;t allow an initializer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SOVConstant &amp;&amp; GS.Ordering == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">        (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>()) ||</Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">         CanHaveNonUndefGlobalInitializer)) &#123;</Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a77de6d50432bef62e38fd24f2030026c">TryToShrinkGlobalToBoolean</a>(GV, SOVConstant)) &#123;</Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">        ++NumShrunkToBool;</Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="comment">/// Analyze the specified global variable and optimize it if possible.  If we</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="comment">/// make a change, return true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632" lineLink="#a5cb8771722bfd8bcbdeb391b17e6cfd6"><Highlight kind="normal"><a href="#a5cb8771722bfd8bcbdeb391b17e6cfd6">processGlobal</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &amp;GV,</Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI,</Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI,</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree) &#123;</Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>().<a href="/docs/api/classes/llvm/stringref/#a2cd8968ff703aaeb395dcd63f6805ff1">starts&#95;with</a>(</Highlight><Highlight kind="stringliteral">&quot;llvm.&quot;</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/globalstatus">GlobalStatus</a> GS;</Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/globalstatus/#ae58ea7b3b03443e976cbef09ac25cf00">GlobalStatus::analyzeGlobal</a>(&amp;GV, GS))</Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GS.IsCompared &amp;&amp; !GV.<a href="/docs/api/classes/llvm/globalvalue/#ac18f876b955434599bd93fd50aad53b8">hasGlobalUnnamedAddr</a>()) &#123;</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewUnnamedAddr = GV.<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>() ? <a href="/docs/api/classes/llvm/globalvalue/#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">GlobalValue::UnnamedAddr::Global</a></Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal">                                               : <a href="/docs/api/classes/llvm/globalvalue/#ae8df4be75bfc50b1eadd74e85c25fa45a509820290d57f333403f490dde7316f4">GlobalValue::UnnamedAddr::Local</a>;</Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewUnnamedAddr != GV.<a href="/docs/api/classes/llvm/globalvalue/#ac2417a3c6edd0db7a9ad84b82c4054b7">getUnnamedAddr</a>()) &#123;</Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">      GV.<a href="/docs/api/classes/llvm/globalvalue/#a38c97622dccff7ae31fe0be3b21c9b3d">setUnnamedAddr</a>(NewUnnamedAddr);</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">      NumUnnamed++;</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do more involved optimizations if the global is internal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV.<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>())</Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GVar = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(&amp;GV);</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GVar)</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GVar-&gt;isConstant() || !GVar-&gt;hasInitializer())</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#adf0a129dd6c07827f4a8a5914f2d8b5b">processInternalGlobal</a>(GVar, GS, GetTTI, GetTLI, LookupDomTree) ||</Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal">         <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="comment">/// Walk all of the direct calls of the specified function, changing them to</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="comment">/// FastCC.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672" lineLink="#a7b97d3981d965c0884878bca5be437ff"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a7b97d3981d965c0884878bca5be437ff">ChangeCalleesToFastCall</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(U)-&gt;setCallingConv(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cabc8e2ee40a84687a9e12fd08784b87ba">CallingConv::Fast</a>);</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680" lineLink="#aa5d09b628a436d6957b7a0f7751bb54f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> AttributeList <a href="#aa5d09b628a436d6957b7a0f7751bb54f">StripAttr</a>(<a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, AttributeList Attrs,</Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60e">Attribute::AttrKind</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &#123;</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AttrIndex;</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Attrs.hasAttrSomewhere(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &amp;AttrIndex))</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Attrs.removeAttributeAtIndex(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, AttrIndex, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Attrs;</Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688" lineLink="#a4e385793d373a822cffdeaa9ee8f3e19"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a4e385793d373a822cffdeaa9ee8f3e19">RemoveAttribute</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60e">Attribute::AttrKind</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &#123;</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;setAttributes(<a href="#aa5d09b628a436d6957b7a0f7751bb54f">StripAttr</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>));</Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">    CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(<a href="#aa5d09b628a436d6957b7a0f7751bb54f">StripAttr</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), CB-&gt;<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>));</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="comment">/// Return true if this is a calling convention that we&#39;d like to change.  The</Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="comment">/// idea here is that we don&#39;t want to mess with the convention if the user</Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="comment">/// explicitly requested something with performance implications like coldcc,</Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="comment">/// GHC, or anyregcc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702" lineLink="#a288312671e8284952698171f0466c22e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a288312671e8284952698171f0466c22e">hasChangeableCCImpl</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">CallingConv::ID</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a77c69067ae8279bc00ab8757731e90d7">CC</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getCallingConv();</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Is it worth transforming x86&#95;stdcallcc and x86&#95;fastcallcc?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a77c69067ae8279bc00ab8757731e90d7">CC</a> != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">CallingConv::C</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a77c69067ae8279bc00ab8757731e90d7">CC</a> != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca97109ccd68cac64fb38dbd24fc4589c6">CallingConv::X86&#95;ThisCall</a>)</Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isVarArg())</Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Change CC for the whole chain of musttail calls when possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can&#39;t change CC of the function that either has musttail calls, or is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// musttail callee itself</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a>&#42; CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI)</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;<a href="/docs/api/classes/llvm/callinst/#ad3c897ba734b78e973db4622dff7bdcb">isMustTailCall</a>())</Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB.getTerminatingMustTailCall())</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasAddressTaken();</Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734" lineLink="#ac56b393332f3a3fbe7322e181eebe16f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="#ac56b393332f3a3fbe7322e181eebe16f">ChangeableCCCacheTy</a> = <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Function &#42;, bool, 8&gt;</a>;</Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735" lineLink="#a4fa5d8c51daf085fa06664ea9ca50da3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a4fa5d8c51daf085fa06664ea9ca50da3">hasChangeableCC</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">                            <a href="#ac56b393332f3a3fbe7322e181eebe16f">ChangeableCCCacheTy</a> &amp;ChangeableCCCache) &#123;</Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Res = ChangeableCCCache.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Res.second)</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">    Res.first-&gt;second = <a href="#a288312671e8284952698171f0466c22e">hasChangeableCCImpl</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Res.first-&gt;second;</Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="comment">/// Return true if the block containing the call site has a BlockFrequency of</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="comment">/// less than ColdCCRelFreq% of the entry block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745" lineLink="#a652ede21e988a4de569cdbc7863ea234"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a652ede21e988a4de569cdbc7863ea234">isColdCallSite</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;CallerBFI) &#123;</Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> ColdProb(<a href="#ab9e99a7c308a604345dfa345a45b7cdd">ColdCCRelFreq</a>, 100);</Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CallSiteBB = CB.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CallSiteFreq = CallerBFI.<a href="/docs/api/classes/llvm/blockfrequencyinfo/#ab8b72c18add22acd827f7a6cd1ff1bff">getBlockFreq</a>(CallSiteBB);</Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CallerEntryFreq =</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">      CallerBFI.<a href="/docs/api/classes/llvm/blockfrequencyinfo/#ab8b72c18add22acd827f7a6cd1ff1bff">getBlockFreq</a>(&amp;(CB.<a href="/docs/api/classes/llvm/callbase/#afac5b39bcbb90d660f83d9b4bd8c6d95">getCaller</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>()));</Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CallSiteFreq &lt; CallerEntryFreq &#42; ColdProb;</Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This function checks if the input function F is cold at all call sites. It</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal"></Highlight><Highlight kind="comment">// also looks each call site&#39;s containing function, returning false if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal"></Highlight><Highlight kind="comment">// caller function contains other non cold calls. The input vector AllCallsCold</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal"></Highlight><Highlight kind="comment">// contains a list of functions that only have call sites in cold blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759" lineLink="#ab9256893dbe8440acbad9879ae65180d"><Highlight kind="normal"><a href="#ab9256893dbe8440acbad9879ae65180d">isValidCandidateForColdCC</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">                          <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI,</Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::vector&lt;Function &#42;&gt; &amp;AllCallsCold) &#123;</Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.user&#95;empty())</Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.users()) &#123;</Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(&#42;U);</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;CallerFunc = CB.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent();</Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;CallerBFI = GetBFI(&#42;CallerFunc);</Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a652ede21e988a4de569cdbc7863ea234">isColdCallSite</a>(CB, CallerBFI))</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(AllCallsCold, CallerFunc))</Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781" lineLink="#a9ed5060153ed9e3ca21cb567997d527c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a9ed5060153ed9e3ca21cb567997d527c">changeCallSitesToColdCC</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(U)-&gt;setCallingConv(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca94ec9273479164e4aec1d5d91b71dc85">CallingConv::Cold</a>);</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This function iterates over all the call instructions in the input Function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal"></Highlight><Highlight kind="comment">// and checks that all call sites are in cold blocks and are allowed to use the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal"></Highlight><Highlight kind="comment">// coldcc calling convention.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793" lineLink="#a23cf1bbd780f1998b4c61acbf5a35a78"><Highlight kind="normal"><a href="#a23cf1bbd780f1998b4c61acbf5a35a78">hasOnlyColdCalls</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="normal">                 <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI,</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal">                 <a href="#ac56b393332f3a3fbe7322e181eebe16f">ChangeableCCCacheTy</a> &amp;ChangeableCCCache) &#123;</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Skip over isline asm instructions since they aren&#39;t function calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;isInlineAsm())</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFn = CI-&gt;getCalledFunction();</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CalledFn)</Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Skip over intrinsics since they won&#39;t remain as function calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Important to do this check before the linkage check below so we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// won&#39;t bail out on debug intrinsics, possibly making the generated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// code dependent on the presence of debug info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledFn-&gt;<a href="/docs/api/classes/llvm/function/#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() != <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>)</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CalledFn-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>())</Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Check if it&#39;s valid to use coldcc calling convention.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a4fa5d8c51daf085fa06664ea9ca50da3">hasChangeableCC</a>(CalledFn, ChangeableCCCache))</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;CallerBFI = GetBFI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a652ede21e988a4de569cdbc7863ea234">isColdCallSite</a>(&#42;CI, CallerBFI))</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825" lineLink="#a7e0090207d4b1da753ad2d3bbb51fc4d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a7e0090207d4b1da753ad2d3bbb51fc4d">hasMustTailCallers</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB) &#123;</Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(U) &amp;&amp;</Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Expected either CallBase or BlockAddress&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a50426b12f4acb3d9f74d0778948e9597">isMustTailCall</a>())</Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839" lineLink="#aacd456f21a2be87fdf19ab7e266b3a40"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#aacd456f21a2be87fdf19ab7e266b3a40">hasInvokeCallers</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;users())</Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846" lineLink="#a5b064b03163c5f9304d4b702da5fa1e4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a5b064b03163c5f9304d4b702da5fa1e4">RemovePreallocated</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal">  <a href="#a4e385793d373a822cffdeaa9ee8f3e19">RemoveAttribute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Attribute::Preallocated);</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(M-&gt;getContext());</Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cannot modify users() while iterating over it, so make a copy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;User &#42;, 4&gt;</a> PreallocatedCalls(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;users());</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : PreallocatedCalls) &#123;</Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB)</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">        !CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a50426b12f4acb3d9f74d0778948e9597">isMustTailCall</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Shouldn&#39;t call RemotePreallocated() on a musttail preallocated call&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create copy of call without &quot;preallocated&quot; operand bundle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">    CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a19263fff7f5b3a9d22b48151fa0d85d0">getOperandBundlesAsDefs</a>(OpBundles);</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;PreallocatedSetup = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;It = OpBundles.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(); It != OpBundles.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>(); ++It) &#123;</Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It-&gt;getTag() == </Highlight><Highlight kind="stringliteral">&quot;preallocated&quot;</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">        PreallocatedSetup = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(&#42;It-&gt;input&#95;begin());</Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">        OpBundles.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(It);</Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PreallocatedSetup &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Did not find preallocated bundle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">    uint64&#95;t ArgCount =</Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(PreallocatedSetup-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0))-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(CB) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(CB)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Unknown indirect call type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;NewCB = <a href="/docs/api/classes/llvm/callbase/#aca631a010bfa5a055b7a07fe9e68f7e9">CallBase::Create</a>(CB, OpBundles, CB-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal">    CB-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewCB);</Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">    NewCB-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(CB);</Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">    CB-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PreallocatedSetup);</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StackSave = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1f41fdcdad0b0b862da8b557701b4bff">CreateStackSave</a>();</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(NewCB-&gt;<a href="/docs/api/classes/llvm/instruction/#a91bd28adea418a08cec78b72413d9d45">getNextNonDebugInstruction</a>());</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#acd200f2f1bf30751d0489584a0565243">CreateStackRestore</a>(StackSave);</Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace @llvm.call.preallocated.arg() with alloca.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Cannot modify users() while iterating over it, so make a copy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// @llvm.call.preallocated.arg() can be called with the same index multiple</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// times. So for each @llvm.call.preallocated.arg(), we see if we have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// already created a Value&#42; for the index, and if not, create an alloca and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bitcast right after the @llvm.call.preallocated.setup() so that it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// dominates all uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> ArgAllocas(ArgCount);</Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;User &#42;, 2&gt;</a> PreallocatedArgs(PreallocatedSetup-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>());</Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/classes/llvm/user">User</a> : PreallocatedArgs) &#123;</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UseCall = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UseCall-&gt;getCalledFunction()-&gt;getIntrinsicID() ==</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">                 Intrinsic::call&#95;preallocated&#95;arg &amp;&amp;</Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;preallocated token use was not a llvm.call.preallocated.arg&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">      uint64&#95;t AllocArgIndex =</Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UseCall-&gt;getArgOperand(1))-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;AllocaReplacement = ArgAllocas&#91;AllocArgIndex&#93;;</Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllocaReplacement) &#123;</Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/nvptxas/#ad7d00b71af84502be65ae2de3f8d91dc">AddressSpace</a> = UseCall-&gt;getType()-&gt;getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ArgType =</Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">            UseCall-&gt;getFnAttr(Attribute::Preallocated).getValueAsType();</Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InsertBefore = PreallocatedSetup-&gt;<a href="/docs/api/classes/llvm/instruction/#a91bd28adea418a08cec78b72413d9d45">getNextNonDebugInstruction</a>();</Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(InsertBefore);</Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Alloca =</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ArgType, <a href="/docs/api/namespaces/llvm/nvptxas/#ad7d00b71af84502be65ae2de3f8d91dc">AddressSpace</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;paarg&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">        ArgAllocas&#91;AllocArgIndex&#93; = Alloca;</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">        AllocaReplacement = Alloca;</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">      UseCall-&gt;replaceAllUsesWith(AllocaReplacement);</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">      UseCall-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove @llvm.call.preallocated.setup().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PreallocatedSetup)-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928" lineLink="#a42820c4a63faae2568e3db2ac69af37d"><Highlight kind="normal"><a href="#a42820c4a63faae2568e3db2ac69af37d">OptimizeFunctions</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI,</Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI,</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI,</Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree,</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;const Comdat &#42;&gt;</a> &amp;NotDiscardableComdats,</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal">(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; ChangedCFGCallback,</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal">(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; DeleteFnCallback) &#123;</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">  <a href="#ac56b393332f3a3fbe7322e181eebe16f">ChangeableCCCacheTy</a> ChangeableCCCache;</Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">  std::vector&lt;Function &#42;&gt; AllCallsCold;</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(M))</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a23cf1bbd780f1998b4c61acbf5a35a78">hasOnlyColdCalls</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, GetBFI, ChangeableCCCache))</Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">      AllCallsCold.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Optimize functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(M)) &#123;</Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t perform global opt pass on naked functions; we don&#39;t want fast</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// calling conventions for naked functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::Naked))</Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Functions without names cannot be referenced outside this module.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasName() &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasLocalLinkage())</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setLinkage(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>);</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5a50ba4ab5027d4013cf6bc2edf66085">deleteIfDead</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NotDiscardableComdats, DeleteFnCallback)) &#123;</Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// LLVM&#39;s definition of dominance allows instructions that are cyclic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// in unreachable blocks, e.g.:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// %pat = select i1 %condition, @global, i16&#42; %pat</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// because any instruction dominates an instruction in a block that&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// not reachable from entry.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// So, remove unreachable blocks from the function, because a) there&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// no point in analyzing them and b) GlobalOpt should otherwise grow</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// some more complicated logic to break these cycles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Notify the analysis manager that we&#39;ve modified the function&#39;s CFG.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration()) &#123;</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aec88b7682025edff7984c3b6c8da8ac9">removeUnreachableBlocks</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">        ChangedCFGCallback(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#a5cb8771722bfd8bcbdeb391b17e6cfd6">processGlobal</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, GetTTI, GetTLI, LookupDomTree);</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasLocalLinkage())</Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have an inalloca parameter that we can safely remove the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inalloca attribute from, do so. This unlocks optimizations that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// wouldn&#39;t be safe in the presence of inalloca.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: We should also hoist alloca affected by this to the entry</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// block if possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getAttributes().hasAttrSomewhere(Attribute::InAlloca) &amp;&amp;</Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">        !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasAddressTaken() &amp;&amp; !<a href="#a7e0090207d4b1da753ad2d3bbb51fc4d">hasMustTailCallers</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isVarArg()) &#123;</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">      <a href="#a4e385793d373a822cffdeaa9ee8f3e19">RemoveAttribute</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Attribute::InAlloca);</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: handle invokes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: handle musttail</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getAttributes().hasAttrSomewhere(Attribute::Preallocated)) &#123;</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasAddressTaken() &amp;&amp; !<a href="#a7e0090207d4b1da753ad2d3bbb51fc4d">hasMustTailCallers</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal">          !<a href="#aacd456f21a2be87fdf19ab7e266b3a40">hasInvokeCallers</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">        <a href="#a5b064b03163c5f9304d4b702da5fa1e4">RemovePreallocated</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a4fa5d8c51daf085fa06664ea9ca50da3">hasChangeableCC</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ChangeableCCCache)) &#123;</Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">      NumInternalFunc++;</Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = GetTTI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Change the calling convention to coldcc if either stress testing is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// enabled or the target would like to use coldcc on functions which are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// cold at all call sites and the callers contain no other non coldcc</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a6b2485a1a60621f310de38c14eb31024">EnableColdCCStressTest</a> ||</Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal">          (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.useColdCCForColdCall(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">           <a href="#ab9256893dbe8440acbad9879ae65180d">isValidCandidateForColdCC</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, GetBFI, AllCallsCold))) &#123;</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal">        ChangeableCCCache.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setCallingConv(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca94ec9273479164e4aec1d5d91b71dc85">CallingConv::Cold</a>);</Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal">        <a href="#a9ed5060153ed9e3ca21cb567997d527c">changeCallSitesToColdCC</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal">        NumColdCC++;</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a4fa5d8c51daf085fa06664ea9ca50da3">hasChangeableCC</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ChangeableCCCache)) &#123;</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this function has a calling convention worth changing, is not a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// varargs function, and is only called directly, promote it to use the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Fast calling convention.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setCallingConv(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cabc8e2ee40a84687a9e12fd08784b87ba">CallingConv::Fast</a>);</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">      <a href="#a7b97d3981d965c0884878bca5be437ff">ChangeCalleesToFastCall</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">      ++NumFastCallFns;</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getAttributes().hasAttrSomewhere(Attribute::Nest) &amp;&amp;</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">        !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasAddressTaken()) &#123;</Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The function is not used by a trampoline intrinsic, so it is safe</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to remove the &#39;nest&#39; attribute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">      <a href="#a4e385793d373a822cffdeaa9ee8f3e19">RemoveAttribute</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Attribute::Nest);</Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">      ++NumNestRemoved;</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044" lineLink="#a7e0dd0687cbb3cdc252710877b323c29"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a7e0dd0687cbb3cdc252710877b323c29">callInstIsMemcpy</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI) &#123;</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI)</Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isIntrinsic() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIntrinsicID() != Intrinsic::memcpy)</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055" lineLink="#af3e1fd8c444e23d60cbfdfa3d0279cb4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#af3e1fd8c444e23d60cbfdfa3d0279cb4">destArrayCanBeWidened</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI) &#123;</Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IsVolatile = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(3));</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Alloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0));</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Alloca || !IsVolatile || IsVolatile-&gt;isOne())</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Alloca-&gt;isStaticAlloca())</Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Alloca-&gt;getAllocatedType()-&gt;isArrayTy())</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071" lineLink="#a2b81e19b3ddf7ec786c5105ba5470153"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;<a href="#a2b81e19b3ddf7ec786c5105ba5470153">widenGlobalVariable</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;OldVar, <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">                                           </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToPad,</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">                                           </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToCopy) &#123;</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OldVar-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a1c66d4eff947253e7610a66379974d63">hasInitializer</a>())</Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantdataarray">ConstantDataArray</a> &#42;DataArray =</Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantDataArray&gt;</a>(OldVar-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>());</Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DataArray)</Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update to be word aligned (memcpy(...,X,...))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// create replacement with padded null bytes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/namespaces/llvm/#aa20539e89704d20b98b97e9c3feac934">Data</a> = DataArray-&gt;<a href="/docs/api/classes/llvm/constantdatasequential/#afd2c2acb776ce93380256b041323cc6d">getRawDataValues</a>();</Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">  std::vector&lt;uint8&#95;t&gt; StrData(<a href="/docs/api/namespaces/llvm/#aa20539e89704d20b98b97e9c3feac934">Data</a>.begin(), <a href="/docs/api/namespaces/llvm/#aa20539e89704d20b98b97e9c3feac934">Data</a>.end());</Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> p = 0; p &lt; NumBytesToPad; p++)</Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">    StrData.push&#95;back(</Highlight><Highlight kind="charliteral">&#39;\\0&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Arr = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(StrData.data(), NumBytesToCopy + NumBytesToPad);</Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create new padded version of global variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SourceReplace = <a href="/docs/api/classes/llvm/constantdataarray/#a4a1000e5803e731e9dcc572042a98a0b">ConstantDataArray::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), Arr);</Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;NewGV = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="normal">      &#42;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent()), SourceReplace-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, OldVar-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3547d58a060ee2e4a29cbea85bef91af">getLinkage</a>(),</Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="normal">      SourceReplace, SourceReplace-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Copy any other attributes from original global variable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// e.g. unamed&#95;addr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal">  NewGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a53f47ebcc1a7ac4553ba2a2eeca596e5">copyAttributesFrom</a>(OldVar);</Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal">  NewGV-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(OldVar);</Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewGV;</Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101" lineLink="#a960e756e8b2f056fbba7baa5bdcfb769"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a960e756e8b2f056fbba7baa5bdcfb769">widenDestArray</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToPad,</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToCopy,</Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/constantdataarray">ConstantDataArray</a> &#42;SourceDataArray) &#123;</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Alloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0));</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Alloca) &#123;</Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ElementByteWidth = SourceDataArray-&gt;<a href="/docs/api/classes/llvm/constantdatasequential/#a5f05216ba8b34865b434e7fc8c96d9d4">getElementByteSize</a>();</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> TotalBytes = NumBytesToCopy + NumBytesToPad;</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElementsToCopy = <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(TotalBytes, ElementByteWidth);</Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update destination array to be word aligned (memcpy(X,...,...))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> BuildAlloca(Alloca);</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;NewAlloca = BuildAlloca.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(<a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal">        Alloca-&gt;getAllocatedType()-&gt;getArrayElementType(), NumElementsToCopy));</Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="normal">    NewAlloca-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(Alloca);</Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="normal">    NewAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(Alloca-&gt;getAlign());</Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="normal">    Alloca-&gt;replaceAllUsesWith(NewAlloca);</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="normal">    Alloca-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121" lineLink="#a2b081ab710b9eb7fcb8dff225d41cf1f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a2b081ab710b9eb7fcb8dff225d41cf1f">tryWidenGlobalArrayAndDests</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;SourceVar,</Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="normal">                                        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToPad,</Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="normal">                                        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToCopy,</Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;BytesToCopyOp,</Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/constantdataarray">ConstantDataArray</a> &#42;SourceDataArray) &#123;</Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewSourceGV =</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="normal">      <a href="#a2b81e19b3ddf7ec786c5105ba5470153">widenGlobalVariable</a>(SourceVar, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NumBytesToPad, NumBytesToCopy);</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewSourceGV)</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update arguments of remaining uses  that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// are memcpys.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/classes/llvm/user">User</a> : SourceVar-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a7e0dd0687cbb3cdc252710877b323c29">callInstIsMemcpy</a>(CI) || !<a href="#af3e1fd8c444e23d60cbfdfa3d0279cb4">destArrayCanBeWidened</a>(CI))</Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;getArgOperand(1) != SourceVar)</Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal">    <a href="#a960e756e8b2f056fbba7baa5bdcfb769">widenDestArray</a>(CI, NumBytesToPad, NumBytesToCopy, SourceDataArray);</Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal">    CI-&gt;setArgOperand(2, ConstantInt::get(BytesToCopyOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal">                                          NumBytesToCopy + NumBytesToPad));</Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal">  SourceVar-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewSourceGV);</Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal">  NumGlobalArraysPadded++;</Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152" lineLink="#a4f18aa17f81c88c8fa89c76563a6d510"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a4f18aa17f81c88c8fa89c76563a6d510">tryWidenGlobalArraysUsedByMemcpy</a>(</Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV,</Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI) &#123;</Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a1c66d4eff947253e7610a66379974d63">hasInitializer</a>() || !GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aa859e108741fa64681b63f0c0c672512">isConstant</a>() || !GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>() ||</Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal">      !GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#ac18f876b955434599bd93fd50aad53b8">hasGlobalUnnamedAddr</a>())</Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/classes/llvm/user">User</a> : GV-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a7e0dd0687cbb3cdc252710877b323c29">callInstIsMemcpy</a>(CI) || !<a href="#af3e1fd8c444e23d60cbfdfa3d0279cb4">destArrayCanBeWidened</a>(CI))</Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BytesToCopyOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(2));</Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BytesToCopyOp)</Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constantdataarray">ConstantDataArray</a> &#42;SourceDataArray =</Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantDataArray&gt;</a>(GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>());</Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SourceDataArray)</Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToCopy = BytesToCopyOp-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Alloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0));</Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><Highlight kind="normal">    uint64&#95;t DZSize = Alloca-&gt;getAllocatedType()-&gt;getArrayNumElements();</Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="normal">    uint64&#95;t SZSize = SourceDataArray-&gt;<a href="/docs/api/classes/llvm/constantdataarray/#af25529592c7a7bbffe7acbc752d513c0">getType</a>()-&gt;<a href="/docs/api/classes/llvm/arraytype/#a1c35bd7a4fa08845607033aecc94423d">getNumElements</a>();</Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ElementByteWidth = SourceDataArray-&gt;<a href="/docs/api/classes/llvm/constantdatasequential/#a5f05216ba8b34865b434e7fc8c96d9d4">getElementByteSize</a>();</Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Calculate the number of elements to copy while avoiding floored</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// division of integers returning wrong values i.e. copying one byte</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// from an array of i16 would yield 0 elements to copy as supposed to 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElementsToCopy = <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(NumBytesToCopy, ElementByteWidth);</Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For safety purposes lets add a constraint and only pad when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// NumElementsToCopy == destination array size ==</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// source which is a constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumElementsToCopy != DZSize || DZSize != SZSize)</Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumBytesToPad = GetTTI(&#42;F).getNumBytesToPadGlobalArray(</Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal">        NumBytesToCopy, SourceDataArray-&gt;<a href="/docs/api/classes/llvm/constantdataarray/#af25529592c7a7bbffe7acbc752d513c0">getType</a>());</Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumBytesToPad) &#123;</Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a2b081ab710b9eb7fcb8dff225d41cf1f">tryWidenGlobalArrayAndDests</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, GV, NumBytesToPad, NumBytesToCopy,</Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">                                         BytesToCopyOp, SourceDataArray);</Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204" lineLink="#a8d20a7c0aa0ef76c738e2ca9e21d35d5"><Highlight kind="normal"><a href="#a8d20a7c0aa0ef76c738e2ca9e21d35d5">OptimizeGlobalVars</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="normal">                   <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI,</Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="normal">                   <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI,</Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><Highlight kind="normal">                   <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree,</Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="normal">                   <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;const Comdat &#42;&gt;</a> &amp;NotDiscardableComdats) &#123;</Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &amp;GV : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(M.globals())) &#123;</Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Global variables without names cannot be referenced outside this module.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV.<a href="/docs/api/classes/llvm/value/#ad9d88ae321b98d8a3b7f394977ae6d7f">hasName</a>() &amp;&amp; !GV.<a href="/docs/api/classes/llvm/globalvalue/#a32e606ac4c88f71f14212e42b808e7f4">isDeclaration</a>() &amp;&amp; !GV.<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>())</Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="normal">      GV.<a href="/docs/api/classes/llvm/globalvalue/#a687973de03d041e04b50a76d19d4fd36">setLinkage</a>(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>);</Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Simplify the initializer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GV.<a href="/docs/api/classes/llvm/globalvariable/#a1c66d4eff947253e7610a66379974d63">hasInitializer</a>())</Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(GV.<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>())) &#123;</Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = M.getDataLayout();</Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// TLI is not used in the case of a Constant, so use default nullptr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// for that optional parameter, since we don&#39;t have a Function to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// provide GetTLI anyway.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;New = <a href="/docs/api/namespaces/llvm/#a5e655fd99a56d50b071fc26d8db5fd5b">ConstantFoldConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </Highlight><Highlight kind="comment">/&#42;TLI&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (New != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal">          GV.<a href="/docs/api/classes/llvm/globalvariable/#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(New);</Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5a50ba4ab5027d4013cf6bc2edf66085">deleteIfDead</a>(GV, NotDiscardableComdats)) &#123;</Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For global variable arrays called in a memcpy</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we try to pad to nearest valid alignment boundary</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#a4f18aa17f81c88c8fa89c76563a6d510">tryWidenGlobalArraysUsedByMemcpy</a>(&amp;GV, GetTTI);</Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="#a5cb8771722bfd8bcbdeb391b17e6cfd6">processGlobal</a>(GV, GetTTI, GetTLI, LookupDomTree);</Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="comment">/// Evaluate static constructors in the function, if we can.  Return true if we</Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="comment">/// can, false otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243" lineLink="#abf4eceb96c86c97477d4bcf8eec661e5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#abf4eceb96c86c97477d4bcf8eec661e5">EvaluateStaticConstructor</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI) &#123;</Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Skip external functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration())</Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Call the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/evaluator">Evaluator</a> Eval(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLI);</Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;RetValDummy;</Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EvalSuccess = Eval.<a href="/docs/api/classes/llvm/evaluator/#aac9fd94c18d93885c8d947121ab9721e">EvaluateFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, RetValDummy,</Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant&#42;, 0&gt;</a>());</Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EvalSuccess) &#123;</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal">    ++NumCtorsEvaluated;</Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We succeeded at evaluation: commit the result.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewInitializers = Eval.<a href="/docs/api/classes/llvm/evaluator/#a7453e86423554598c4bc680679ad6287">getMutatedInitializers</a>();</Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;FULLY EVALUATED GLOBAL CTOR FUNCTION &#39;&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#39; to &quot;</Highlight><Highlight kind="normal"> &lt;&lt; NewInitializers.size()</Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; stores.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair : NewInitializers)</Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal">      Pair.first-&gt;setInitializer(Pair.second);</Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV : Eval.<a href="/docs/api/classes/llvm/evaluator/#adb90b074529faf1b1a1e29b7845aecd5">getInvariants</a>())</Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">      GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a40ae67d31da67ca17ed016839faf3390">setConstant</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EvalSuccess;</Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271" lineLink="#ad9ef9dbac3fbf9cc30e63d86bf9d7e34"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> <a href="#ad9ef9dbac3fbf9cc30e63d86bf9d7e34">compareNames</a>(<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;AStripped = (&#42;A)-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;BStripped = (&#42;B)-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AStripped-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>().<a href="/docs/api/classes/llvm/stringref/#ae0c6424784f132b91eb387a3ee0b57c9">compare</a>(BStripped-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277" lineLink="#aaf604b7b4ff087fce0b71852f5ddefbe"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#aaf604b7b4ff087fce0b71852f5ddefbe">setUsedInitializer</a>(<a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &amp;V,</Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="normal">                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;GlobalValue &#42;&gt;</a> &amp;<a href="/docs/api/classes/llvm/init">Init</a>) &#123;</Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/init">Init</a>.empty()) &#123;</Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="normal">    V.eraseFromParent();</Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get address space of pointers in the array of pointers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;UsedArrayType = V.getValueType();</Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VAT = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ArrayType&gt;</a>(UsedArrayType);</Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VEPT = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PointerType&gt;</a>(VAT-&gt;getArrayElementType());</Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Type of pointer to the array of pointers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal">  <a href="/docs/api/classes/pointertype">PointerType</a> &#42;PtrTy =</Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(V.getContext(), VEPT-&gt;getAddressSpace());</Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 8&gt;</a> UsedArray;</Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV : <a href="/docs/api/classes/llvm/init">Init</a>) &#123;</Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cast = <a href="/docs/api/classes/llvm/constantexpr/#a28bf8984fbfb08fd27df435e631e6832">ConstantExpr::getPointerBitCastOrAddrSpaceCast</a>(GV, PtrTy);</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal">    UsedArray.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Cast);</Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort to get deterministic order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(UsedArray.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), UsedArray.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>(), <a href="#ad9ef9dbac3fbf9cc30e63d86bf9d7e34">compareNames</a>);</Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">  <a href="/docs/api/classes/arraytype">ArrayType</a> &#42;ATy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(PtrTy, UsedArray.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = V.getParent();</Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">  V.removeFromParent();</Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;NV =</Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(&#42;M, ATy, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca96ad6314ba9210b223b93dc3e15baf99">GlobalValue::AppendingLinkage</a>,</Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="normal">                         <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(ATy, UsedArray), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="normal">  NV-&gt;takeName(&amp;V);</Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="normal">  NV-&gt;setSection(</Highlight><Highlight kind="stringliteral">&quot;llvm.metadata&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">delete</Highlight><Highlight kind="normal"> &amp;V;</Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313" lineLink="/docs/api/namespaces/anonymous-globalopt-cpp-"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="comment">/// An easy to access representation of llvm.used and llvm.compiler.used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ab0be9add964b354b741b4881efc2b40e">LLVMUsed</a> &#123;</Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;GlobalValue &#42;, 4&gt;</a> Used;</Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;GlobalValue &#42;, 4&gt;</a> CompilerUsed;</Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;UsedV;</Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;CompilerUsedV;</Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ab0be9add964b354b741b4881efc2b40e"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ab0be9add964b354b741b4881efc2b40e">LLVMUsed</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GlobalValue &#42;, 4&gt;</a> Vec;</Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">    UsedV = <a href="/docs/api/namespaces/llvm/#afd1cdae0d7a12aa1861ac142c059f5d2">collectUsedGlobalVariables</a>(M, Vec, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal">    Used = &#123;Vec.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Vec.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()&#125;;</Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal">    Vec.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal">    CompilerUsedV = <a href="/docs/api/namespaces/llvm/#afd1cdae0d7a12aa1861ac142c059f5d2">collectUsedGlobalVariables</a>(M, Vec, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="normal">    CompilerUsed = &#123;Vec.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Vec.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()&#125;;</Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ad429a00780c198b889781df06bd2af8f"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ad429a00780c198b889781df06bd2af8f">iterator</a> = <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;GlobalValue &#42;, 4&gt;::iterator</a>;</Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aaa20a27e634f963ae1a9eb1a077e402e"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aaa20a27e634f963ae1a9eb1a077e402e">used&#95;iterator&#95;range</a> = <a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range&lt;iterator&gt;</a>;</Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a4953c5d9e395e1dec055122e168c3ada"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ad429a00780c198b889781df06bd2af8f">iterator</a> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a4953c5d9e395e1dec055122e168c3ada">usedBegin</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Used.begin(); &#125;</Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a10fad65c0fb9a5a4251587777a00810b"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ad429a00780c198b889781df06bd2af8f">iterator</a> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a10fad65c0fb9a5a4251587777a00810b">usedEnd</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Used.end(); &#125;</Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#accddef43152f3cc82507efc674524fa6"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aaa20a27e634f963ae1a9eb1a077e402e">used&#95;iterator&#95;range</a> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#accddef43152f3cc82507efc674524fa6">used</a>() &#123;</Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aaa20a27e634f963ae1a9eb1a077e402e">used&#95;iterator&#95;range</a>(<a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a4953c5d9e395e1dec055122e168c3ada">usedBegin</a>(), <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a10fad65c0fb9a5a4251587777a00810b">usedEnd</a>());</Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aa633bfd3db216fab587b01bcf974bd0a"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ad429a00780c198b889781df06bd2af8f">iterator</a> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aa633bfd3db216fab587b01bcf974bd0a">compilerUsedBegin</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CompilerUsed.begin(); &#125;</Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a7f79ff953613954af44c00a617ee0e63"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ad429a00780c198b889781df06bd2af8f">iterator</a> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a7f79ff953613954af44c00a617ee0e63">compilerUsedEnd</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CompilerUsed.end(); &#125;</Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aa49489050dc58d7b073c866f5efc2482"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aaa20a27e634f963ae1a9eb1a077e402e">used&#95;iterator&#95;range</a> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aa49489050dc58d7b073c866f5efc2482">compilerUsed</a>() &#123;</Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aaa20a27e634f963ae1a9eb1a077e402e">used&#95;iterator&#95;range</a>(<a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#aa633bfd3db216fab587b01bcf974bd0a">compilerUsedBegin</a>(), <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a7f79ff953613954af44c00a617ee0e63">compilerUsedEnd</a>());</Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a80a425c3c967f6d01e16509d5d98f82e"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a80a425c3c967f6d01e16509d5d98f82e">usedCount</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Used.count(GV); &#125;</Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#adbee6b5a6c96f3605d0c8b4e689a9848"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#adbee6b5a6c96f3605d0c8b4e689a9848">compilerUsedCount</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CompilerUsed.count(GV);</Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a78c9fd69ca96d8c5762ad548630c6a74"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a78c9fd69ca96d8c5762ad548630c6a74">usedErase</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Used.erase(GV); &#125;</Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a646e7833c249a85e9d204b62b327e2f6"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a646e7833c249a85e9d204b62b327e2f6">compilerUsedErase</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CompilerUsed.erase(GV); &#125;</Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a8167398a291b1083f9d35e63e05f6b93"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a8167398a291b1083f9d35e63e05f6b93">usedInsert</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Used.insert(GV).second; &#125;</Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a4b045ee522e61360505379fdebe1b509"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#a4b045ee522e61360505379fdebe1b509">compilerUsedInsert</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV) &#123;</Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CompilerUsed.insert(GV).second;</Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363" lineLink="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ade84ec913e0993a6867caee33921afe8"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ade84ec913e0993a6867caee33921afe8">syncVariablesAndSets</a>() &#123;</Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UsedV)</Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="normal">      <a href="#aaf604b7b4ff087fce0b71852f5ddefbe">setUsedInitializer</a>(&#42;UsedV, Used);</Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CompilerUsedV)</Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">      <a href="#aaf604b7b4ff087fce0b71852f5ddefbe">setUsedInitializer</a>(&#42;CompilerUsedV, CompilerUsed);</Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373" lineLink="#afa93649aba5a7b6388adff903a4a6085"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#afa93649aba5a7b6388adff903a4a6085">hasUseOtherThanLLVMUsed</a>(<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &amp;GA, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ab0be9add964b354b741b4881efc2b40e">LLVMUsed</a> &amp;U) &#123;</Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GA.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) </Highlight><Highlight kind="comment">// No use at all.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!U.usedCount(&amp;GA) || !U.compilerUsedCount(&amp;GA)) &amp;&amp;</Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;We should have removed the duplicated &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;element from llvm.compiler.used&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GA.<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Strictly more than one use. So at least one is not in llvm.used and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// llvm.compiler.used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Exactly one use. Check if it is in llvm.used or llvm.compiler.used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !U.usedCount(&amp;GA) &amp;&amp; !U.compilerUsedCount(&amp;GA);</Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389" lineLink="#a99e004d21cf0169cd780274146e9f773"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a99e004d21cf0169cd780274146e9f773">mayHaveOtherReferences</a>(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &amp;GV, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ab0be9add964b354b741b4881efc2b40e">LLVMUsed</a> &amp;U) &#123;</Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV.<a href="/docs/api/classes/llvm/globalvalue/#a3ba1af4b9d9faa4a33729bbbecee83d1">hasLocalLinkage</a>())</Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> U.usedCount(&amp;GV) || U.compilerUsedCount(&amp;GV);</Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396" lineLink="#ae17d0aeb924fa0611500eb8cb09a70d9"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ae17d0aeb924fa0611500eb8cb09a70d9">hasUsesToReplace</a>(<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &amp;GA, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ab0be9add964b354b741b4881efc2b40e">LLVMUsed</a> &amp;U,</Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="normal">                             </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &amp;RenameTarget) &#123;</Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GA.<a href="/docs/api/classes/llvm/globalvalue/#ac291102760c543c8e045e829d57d3341">isWeakForLinker</a>())</Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal">  RenameTarget = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Ret = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#afa93649aba5a7b6388adff903a4a6085">hasUseOtherThanLLVMUsed</a>(GA, U))</Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">    Ret = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the alias is externally visible, we may still be able to simplify it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a99e004d21cf0169cd780274146e9f773">mayHaveOtherReferences</a>(GA, U))</Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Ret;</Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the aliasee has internal linkage and no other references (e.g.,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// @llvm.used, @llvm.compiler.used), give it the name and linkage of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// alias, and delete the alias. This turns:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   define internal ... @f(...)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   @a = alias ... @f</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   define ... @a(...)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Aliasee = GA.<a href="/docs/api/classes/llvm/globalalias/#a7666cc7bd9294c7ae9992c41c591e08b">getAliasee</a>();</Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;<a href="/docs/api/classes/llvm/target">Target</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GlobalValue&gt;</a>(Aliasee-&gt;<a href="/docs/api/classes/llvm/constant/#a6c6af867b9eca0a16600b50e31df0e33">stripPointerCasts</a>());</Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a99e004d21cf0169cd780274146e9f773">mayHaveOtherReferences</a>(&#42;<a href="/docs/api/classes/llvm/target">Target</a>, U))</Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Ret;</Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">  RenameTarget = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427" lineLink="#a6c0ba55113b40b07b869ba9c06db6ca1"><Highlight kind="normal"><a href="#a6c0ba55113b40b07b869ba9c06db6ca1">OptimizeGlobalAliases</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;const Comdat &#42;&gt;</a> &amp;NotDiscardableComdats) &#123;</Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-globalopt-cpp-/llvmused/#ab0be9add964b354b741b4881efc2b40e">LLVMUsed</a> Used(M);</Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;GV : Used.used())</Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal">    Used.compilerUsedErase(GV);</Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Return whether GV is explicitly or implicitly dso&#95;local and not replaceable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// by another definition in the current linkage unit.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsModuleLocal = &#91;&#93;(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &amp;GV) &#123;</Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/classes/llvm/globalvalue/#aabf6932ed41fc64e17c0030c44eda44e">GlobalValue::isInterposableLinkage</a>(GV.<a href="/docs/api/classes/llvm/globalvalue/#a3547d58a060ee2e4a29cbea85bef91af">getLinkage</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal">           (GV.<a href="/docs/api/classes/llvm/globalvalue/#a19db81b6f3d3ab342972dce7756fb077">isDSOLocal</a>() || GV.<a href="/docs/api/classes/llvm/globalvalue/#a2df2f2e94b5493e9434dbf1c483dbc72">isImplicitDSOLocal</a>());</Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &amp;J : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(M.aliases())) &#123;</Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Aliases without names cannot be referenced outside this module.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!J.hasName() &amp;&amp; !J.isDeclaration() &amp;&amp; !J.hasLocalLinkage())</Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="normal">      J.setLinkage(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>);</Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5a50ba4ab5027d4013cf6bc2edf66085">deleteIfDead</a>(J, NotDiscardableComdats)) &#123;</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the alias can change at link time, nothing can be done - bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsModuleLocal(J))</Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Aliasee = J.getAliasee();</Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;<a href="/docs/api/classes/llvm/target">Target</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalValue&gt;</a>(Aliasee-&gt;<a href="/docs/api/classes/llvm/constant/#a6c6af867b9eca0a16600b50e31df0e33">stripPointerCasts</a>());</Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We can&#39;t trivially replace the alias with the aliasee if the aliasee is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// non-trivial in some way. We also can&#39;t replace the alias with the aliasee</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if the aliasee may be preemptible at runtime. On ELF, a non-preemptible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// alias can be used to access the definition as if preemption did not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// happen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Try to handle non-zero GEPs of local aliasees.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/target">Target</a> || !IsModuleLocal(&#42;<a href="/docs/api/classes/llvm/target">Target</a>))</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/target">Target</a>-&gt;removeDeadConstantUsers();</Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make all users of the alias use the aliasee instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RenameTarget;</Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ae17d0aeb924fa0611500eb8cb09a70d9">hasUsesToReplace</a>(J, Used, RenameTarget))</Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal">    J.replaceAllUsesWith(Aliasee);</Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">    ++NumAliasesResolved;</Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RenameTarget) &#123;</Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Give the aliasee the name, linkage and other attributes of the alias.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/target">Target</a>-&gt;takeName(&amp;J);</Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/target">Target</a>-&gt;setLinkage(J.getLinkage());</Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/target">Target</a>-&gt;setDSOLocal(J.isDSOLocal());</Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/target">Target</a>-&gt;setVisibility(J.getVisibility());</Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/target">Target</a>-&gt;setDLLStorageClass(J.getDLLStorageClass());</Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Used.usedErase(&amp;J))</Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="normal">        Used.usedInsert(<a href="/docs/api/classes/llvm/target">Target</a>);</Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Used.compilerUsedErase(&amp;J))</Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="normal">        Used.compilerUsedInsert(<a href="/docs/api/classes/llvm/target">Target</a>);</Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a99e004d21cf0169cd780274146e9f773">mayHaveOtherReferences</a>(J, Used))</Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Delete the alias.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal">    M.eraseAlias(&amp;J);</Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="normal">    ++NumAliasesRemoved;</Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="normal">  Used.syncVariablesAndSets();</Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;</Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506" lineLink="#a0a93e5a229615932f4e2ba47f55a3ba0"><Highlight kind="normal"><a href="#a0a93e5a229615932f4e2ba47f55a3ba0">FindAtExitLibFunc</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI,</Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">                  <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> Func) &#123;</Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Hack to get a default TLI before we have actual Function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FuncIter = M.<a href="/docs/api/classes/llvm/function/#a88a5e60837674780a9d812d661897ac5">begin</a>();</Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FuncIter == M.end())</Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;TLI = &amp;GetTLI(&#42;FuncIter);</Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;has(Func))</Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = M.<a href="/docs/api/classes/llvm/function/#a8743c58384e11cb6228f6f871304ad35">getFunction</a>(TLI-&gt;getName(Func));</Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Fn)</Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now get the actual TLI for Fn.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal">  TLI = &amp;GetTLI(&#42;Fn);</Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure that the function has the correct prototype.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TLI-&gt;getLibFunc(&#42;Fn, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> != Func)</Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Fn;</Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="comment">/// Returns whether the given function is an empty C++ destructor or atexit</Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="comment">/// handler and can therefore be eliminated. Note that we assume that other</Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="comment">/// optimization passes have already simplified the code so we simply check for</Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="comment">/// &#39;ret&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537" lineLink="#a3d10b9d22b94edf6deb16010eb260cdc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a3d10b9d22b94edf6deb16010eb260cdc">IsEmptyAtExitFunction</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;Fn) &#123;</Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: We could eliminate C++ destructors if they&#39;re readonly/readnone and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// nounwind, but that doesn&#39;t seem worth doing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Fn.<a href="/docs/api/classes/llvm/globalvalue/#a32e606ac4c88f71f14212e42b808e7f4">isDeclaration</a>())</Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Fn.<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>()) &#123;</Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isDebugOrPseudoInst())</Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ReturnInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553" lineLink="#a996275d837998b396728990f8be0ef3a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a996275d837998b396728990f8be0ef3a">OptimizeEmptyGlobalAtExitDtors</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;CXAAtExitFn, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isCXX) &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="comment">  /// Itanium C++ ABI p3.3.5:</Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><Highlight kind="comment">  ///   After constructing a global (or local static) object, that will require</Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><Highlight kind="comment">  ///   destruction on exit, a termination function is registered as follows:</Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="comment">  ///   extern &quot;C&quot; int &#95;&#95;cxa&#95;atexit ( void (&#42;f)(void &#42;), void &#42;p, void &#42;d );</Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="comment">  ///   This registration, e.g. &#95;&#95;cxa&#95;atexit(f,p,d), is intended to cause the</Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="comment">  ///   call f(p) when DSO d is unloaded, before all such termination calls</Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="comment">  ///   registered before this one. It returns zero if registration is</Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="comment">  ///   successful, nonzero on failure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This pass will look for calls to &#95;&#95;cxa&#95;atexit or atexit where the function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is trivial and remove them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(CXAAtExitFn-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())) &#123;</Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We&#39;re only interested in calls. Theoretically, we could handle invoke</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions as well, but neither llvm-gcc nor clang generate invokes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to &#95;&#95;cxa&#95;atexit.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI)</Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;DtorFn =</Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>());</Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DtorFn || !<a href="#a3d10b9d22b94edf6deb16010eb260cdc">IsEmptyAtExitFunction</a>(&#42;DtorFn))</Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Just remove the call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">    CI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">    CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isCXX)</Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal">      ++NumCXXDtorsRemoved;</Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal">      ++NumAtExitRemoved;</Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598" lineLink="#a18d5638ef4590bc32bb8c69017352c1b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="#a18d5638ef4590bc32bb8c69017352c1b">hasSideeffectFreeStaticResolution</a>(<a href="/docs/api/classes/llvm/globalifunc">GlobalIFunc</a> &amp;IF) &#123;</Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IF.isInterposable())</Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/llvm/resolver">Resolver</a> = IF.getResolverFunction();</Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/resolver">Resolver</a>)</Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/resolver">Resolver</a>-&gt;isInterposable())</Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only handle functions that have been optimized into a single basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = <a href="/docs/api/classes/llvm/resolver">Resolver</a>-&gt;begin();</Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (++It != <a href="/docs/api/classes/llvm/resolver">Resolver</a>-&gt;end())</Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB = <a href="/docs/api/classes/llvm/resolver">Resolver</a>-&gt;getEntryBlock();</Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(BB, &#91;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayHaveSideEffects(); &#125;))</Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ret = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ret)</Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(Ret-&gt;getReturnValue());</Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="comment">/// Find IFuncs that have resolvers that always point at the same statically</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="comment">/// known callee, and replace their callers with a direct call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628" lineLink="#a22693120b14b0f18e6a09812dc4a86eb"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a22693120b14b0f18e6a09812dc4a86eb">OptimizeStaticIFuncs</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalifunc">GlobalIFunc</a> &amp;IF : M.ifuncs())</Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee = <a href="#a18d5638ef4590bc32bb8c69017352c1b">hasSideeffectFreeStaticResolution</a>(IF))</Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IF.use&#95;empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal">          (!Callee-&gt;isDeclaration() ||</Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(IF.users(), &#91;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123; return isa&lt;GlobalAlias&gt;(U); &#125;))) &#123;</Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal">        IF.replaceAllUsesWith(Callee);</Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">        NumIFuncsResolved++;</Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643" lineLink="#a444e6b7fcf191b54052704a41c55fe70"><Highlight kind="normal"><a href="#a444e6b7fcf191b54052704a41c55fe70">DeleteDeadIFuncs</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="normal">                 <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;const Comdat &#42;&gt;</a> &amp;NotDiscardableComdats) &#123;</Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalifunc">GlobalIFunc</a> &amp;IF : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(M.ifuncs()))</Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5a50ba4ab5027d4013cf6bc2edf66085">deleteIfDead</a>(IF, NotDiscardableComdats)) &#123;</Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="normal">      NumIFuncsDeleted++;</Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Follows the use-def chain of \\p V backwards until it finds a Function,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal"></Highlight><Highlight kind="comment">// in which case it collects in \\p Versions. Return true on successful</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal"></Highlight><Highlight kind="comment">// use-def chain traversal, false otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657" lineLink="#adb4afc63a9a9aa3f185854b0cd009b44"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#adb4afc63a9a9aa3f185854b0cd009b44">collectVersions</a>(<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Function &#42;&gt;</a> &amp;Versions) &#123;</Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.isMultiversionedFunction(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><Highlight kind="normal">    Versions.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Sel = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#adb4afc63a9a9aa3f185854b0cd009b44">collectVersions</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, Sel-&gt;getTrueValue(), Versions))</Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#adb4afc63a9a9aa3f185854b0cd009b44">collectVersions</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, Sel-&gt;getFalseValue(), Versions))</Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Phi-&gt;getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#adb4afc63a9a9aa3f185854b0cd009b44">collectVersions</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, Phi-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Versions))</Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Unknown instruction type. Bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Bypass the IFunc Resolver of MultiVersioned functions when possible. To</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal"></Highlight><Highlight kind="comment">// deduce whether the optimization is legal we need to compare the target</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal"></Highlight><Highlight kind="comment">// features between caller and callee versions. The criteria for bypassing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the resolver are the following:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal"></Highlight><Highlight kind="comment">// &#42; If the callee&#39;s feature set is a subset of the caller&#39;s feature set,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   then the callee is a candidate for direct call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal"></Highlight><Highlight kind="comment">// &#42; Among such candidates the one of highest priority is the best match</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   and it shall be picked, unless there is a version of the callee with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   higher priority than the best match which cannot be picked from a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   higher priority caller (directly or through the resolver).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal"></Highlight><Highlight kind="comment">// &#42; For every higher priority callee version than the best match, there</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   is a higher priority caller version whose feature set availability</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   is implied by the callee&#39;s feature set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696" lineLink="#a8b1b5c42e2e99bb24a27219f8df7294d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a8b1b5c42e2e99bb24a27219f8df7294d">OptimizeNonTrivialIFuncs</a>(</Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI) &#123;</Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cache containing the mask constructed from a function&#39;s target features.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Function &#42;, uint64&#95;t&gt;</a> FeatureMask;</Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalifunc">GlobalIFunc</a> &amp;IF : M.ifuncs()) &#123;</Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IF.isInterposable())</Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/llvm/resolver">Resolver</a> = IF.getResolverFunction();</Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/resolver">Resolver</a>)</Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/resolver">Resolver</a>-&gt;isInterposable())</Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = GetTTI(&#42;<a href="/docs/api/classes/llvm/resolver">Resolver</a>);</Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Discover the callee versions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Function &#42;&gt;</a> Callees;</Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(&#42;<a href="/docs/api/classes/llvm/resolver">Resolver</a>, &#91;&amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, &amp;Callees&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB) &#123;</Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ret = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ReturnInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#adb4afc63a9a9aa3f185854b0cd009b44">collectVersions</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, Ret-&gt;getReturnValue(), Callees))</Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Callees.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expecting successful collection of versions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Statically resolving calls to function &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/classes/llvm/resolver">Resolver</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Cache the feature mask for each callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee : Callees) &#123;</Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;It, Inserted&#93; = FeatureMask.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(Callee);</Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inserted)</Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="normal">        It-&gt;second = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getFeatureMask(&#42;Callee);</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Sort the callee versions in decreasing priority order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(Callees, &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FeatureMask&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>&#93; &gt; FeatureMask&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>&#93;;</Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find the callsites and cache the feature mask for each caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Function &#42;&gt;</a> Callers;</Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Function &#42;, SmallVector&lt;CallBase &#42;&gt;</a>&gt; CallSites;</Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : IF.users()) &#123;</Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB-&gt;getCalledOperand() == &amp;IF) &#123;</Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/function">Function</a> &#42;Caller = CB-&gt;getFunction();</Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;FeatIt, FeatInserted&#93; = FeatureMask.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(Caller);</Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FeatInserted)</Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="normal">            FeatIt-&gt;second = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getFeatureMask(&#42;Caller);</Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;CallIt, CallInserted&#93; = CallSites.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(Caller);</Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallInserted)</Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">            Callers.push&#95;back(Caller);</Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">          CallIt-&gt;second.push&#95;back(CB);</Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Sort the caller versions in decreasing priority order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(Callers, &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FeatureMask&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>&#93; &gt; FeatureMask&#91;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>&#93;;</Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> implies = &#91;&#93;(uint64&#95;t <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, uint64&#95;t <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> &amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>; &#125;;</Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Index to the highest priority candidate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now try to redirect calls starting from higher priority callers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;Caller : Callers) &#123;</Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Callees.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Found callers of equal priority&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee = Callees&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal">      uint64&#95;t CallerBits = FeatureMask&#91;Caller&#93;;</Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">      uint64&#95;t CalleeBits = FeatureMask&#91;Callee&#93;;</Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// In the case of FMV callers, we know that all higher priority callers</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// than the current one did not get selected at runtime, which helps</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// reason about the callees (if they have versions that mandate presence</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// of the features which we already know are unavailable on this target).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.isMultiversionedFunction(&#42;Caller)) &#123;</Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the feature set of the caller implies the feature set of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// highest priority candidate then it shall be picked. In case of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// identical sets advance the candidate index one position.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallerBits == CalleeBits)</Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">          ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!implies(CallerBits, CalleeBits)) &#123;</Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Keep advancing the candidate index as long as the caller&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// features are a subset of the current candidate&#39;s.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (implies(CalleeBits, CallerBits)) &#123;</Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == Callees.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>())</Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><Highlight kind="normal">            CalleeBits = FeatureMask&#91;Callees&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;&#93;;</Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We can&#39;t reason much about non-FMV callers. Just pick the highest</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// priority callee if it matches, otherwise bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a5caa683daa02aed3ab67c3f5d81db300">OptimizeNonFMVCallers</a> || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt; 0 || !implies(CallerBits, CalleeBits))</Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Calls = CallSites&#91;Caller&#93;;</Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CS : Calls) &#123;</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Redirecting call &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Caller-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal">                          &lt;&lt; Callee-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">        CS-&gt;setCalledOperand(Callee);</Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IF.use&#95;empty() ||</Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(IF.users(), &#91;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123; return isa&lt;GlobalAlias&gt;(U); &#125;))</Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal">      NumIFuncsResolved++;</Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820" lineLink="#aba35cb55d089d58ace72978cb0249dc8"><Highlight kind="normal"><a href="#aba35cb55d089d58ace72978cb0249dc8">optimizeGlobalsInModule</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTLI,</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetTTI,</Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GetBFI,</Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; LookupDomTree,</Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal">(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; ChangedCFGCallback,</Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal">(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)&gt; DeleteFnCallback) &#123;</Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Comdat &#42;, 8&gt;</a> NotDiscardableComdats;</Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LocalChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><Highlight kind="normal">  std::optional&lt;uint32&#95;t&gt; FirstNotFullyEvaluatedPriority;</Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (LocalChange) &#123;</Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal">    LocalChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal">    NotDiscardableComdats.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &amp;GV : M.globals())</Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = GV.<a href="/docs/api/classes/llvm/globalobject/#a98140bed34afff96a44ab31ef977f5ec">getComdat</a>())</Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GV.<a href="/docs/api/classes/llvm/globalvalue/#adcb86d621c23938671ad526d3bd1f9bd">isDiscardableIfUnused</a>() || !GV.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal">          NotDiscardableComdats.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M)</Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getComdat())</Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDefTriviallyDead())</Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="normal">          NotDiscardableComdats.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &amp;GA : M.aliases())</Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = GA.getComdat())</Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GA.isDiscardableIfUnused() || !GA.use&#95;empty())</Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="normal">          NotDiscardableComdats.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Delete functions that are trivially dead, ccc -&gt; fastcc</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="normal">    LocalChange |= <a href="#a42820c4a63faae2568e3db2ac69af37d">OptimizeFunctions</a>(M, GetTLI, GetTTI, GetBFI, LookupDomTree,</Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="normal">                                     NotDiscardableComdats, ChangedCFGCallback,</Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="normal">                                     DeleteFnCallback);</Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Optimize global&#95;ctors list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="normal">    LocalChange |=</Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a71b27c25d18516bdcb3f3a44ebf6185b">optimizeGlobalCtorsList</a>(M, &#91;&amp;&#93;(uint32&#95;t Priority, <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstNotFullyEvaluatedPriority &amp;&amp;</Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><Highlight kind="normal">              &#42;FirstNotFullyEvaluatedPriority != Priority)</Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Evaluated = <a href="#abf4eceb96c86c97477d4bcf8eec661e5">EvaluateStaticConstructor</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;GetTLI(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Evaluated)</Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="normal">            FirstNotFullyEvaluatedPriority = Priority;</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Evaluated;</Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="normal">        &#125;);</Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Optimize non-address-taken globals.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="normal">    LocalChange |= <a href="#a8d20a7c0aa0ef76c738e2ca9e21d35d5">OptimizeGlobalVars</a>(M, GetTTI, GetTLI, LookupDomTree,</Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="normal">                                      NotDiscardableComdats);</Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Resolve aliases, when possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="normal">    LocalChange |= <a href="#a6c0ba55113b40b07b869ba9c06db6ca1">OptimizeGlobalAliases</a>(M, NotDiscardableComdats);</Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to remove trivial global destructors if they are not removed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;CXAAtExitFn =</Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal">            <a href="#a0a93e5a229615932f4e2ba47f55a3ba0">FindAtExitLibFunc</a>(M, GetTLI, LibFunc&#95;cxa&#95;atexit))</Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">      LocalChange |= <a href="#a996275d837998b396728990f8be0ef3a">OptimizeEmptyGlobalAtExitDtors</a>(CXAAtExitFn, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;AtExitFn = <a href="#a0a93e5a229615932f4e2ba47f55a3ba0">FindAtExitLibFunc</a>(M, GetTLI, LibFunc&#95;atexit))</Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal">      LocalChange |= <a href="#a996275d837998b396728990f8be0ef3a">OptimizeEmptyGlobalAtExitDtors</a>(AtExitFn, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Optimize IFuncs whose callee&#39;s are statically known.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">    LocalChange |= <a href="#a22693120b14b0f18e6a09812dc4a86eb">OptimizeStaticIFuncs</a>(M);</Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Optimize IFuncs based on the target features of the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><Highlight kind="normal">    LocalChange |= <a href="#a8b1b5c42e2e99bb24a27219f8df7294d">OptimizeNonTrivialIFuncs</a>(M, GetTTI);</Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove any IFuncs that are now dead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">    LocalChange |= <a href="#a444e6b7fcf191b54052704a41c55fe70">DeleteDeadIFuncs</a>(M, NotDiscardableComdats);</Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= LocalChange;</Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Move all global ctors functions to the end of the module for code</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// layout.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900" lineLink="/docs/api/classes/llvm/globaloptpass/#a0be1afba37502be6858f2a1c38955be8"><Highlight kind="normal"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/globaloptpass/#a0be1afba37502be6858f2a1c38955be8">GlobalOptPass::run</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/namespaces/llvm/#af9c9208365fd9ce11392b4d79485e259">ModuleAnalysisManager</a> &amp;AM) &#123;</Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = M.getDataLayout();</Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a> =</Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal">        AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a4143e067711d3c7795276b225a8d6eb9">FunctionAnalysisManagerModuleProxy</a>&gt;(M).getManager();</Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> LookupDomTree = &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;&#123;</Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetTLI = &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp; &#123;</Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetTTI = &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; &#123;</Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetBFI = &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &amp; &#123;</Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/blockfrequencyanalysis">BlockFrequencyAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ChangedCFGCallback = &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.invalidate(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/preservedanalyses/#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>());</Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DeleteFnCallback = &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123; <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.clear(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()); &#125;;</Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#aba35cb55d089d58ace72978cb0249dc8">optimizeGlobalsInModule</a>(M, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, GetTLI, GetTTI, GetBFI, LookupDomTree,</Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal">                                 ChangedCFGCallback, DeleteFnCallback))</Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA = <a href="/docs/api/classes/llvm/preservedanalyses/#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>();</Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We made sure to clear analyses for deleted functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">    PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/namespaces/llvm/#a4143e067711d3c7795276b225a8d6eb9">FunctionAnalysisManagerModuleProxy</a>&gt;();</Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The only place we modify the CFG is when calling</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// removeUnreachableBlocks(), but there we make sure to invalidate analyses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for modified functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal">    PA.<a href="/docs/api/classes/llvm/preservedanalyses/#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PA;</Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
