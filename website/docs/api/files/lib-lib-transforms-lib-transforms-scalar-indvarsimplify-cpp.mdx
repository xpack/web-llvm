---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `IndVarSimplify.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Scalar/IndVarSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/indvarsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APFloat.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apfloat-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/iterator_range.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/looppass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSA.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSAUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolution.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolutionExpressions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ConstantRange.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/MathExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Scalar/SimpleLoopUnswitch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/simpleloopunswitch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ScalarEvolutionExpander.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SimplifyIndVar.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifyindvar-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-indvarsimplify-cpp-">anonymous&#123;IndVarSimplify.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify">IndVarSimplify</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor">IndVarSimplifyVisitor</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#af945460922a5750a0d075b6344608e27">ConvertToSInt</a> (const APFloat &amp;APF, int64&#95;t &amp;IntVal)</>}>
Convert APF to an integer, if possible. <a href="#af945460922a5750a0d075b6344608e27">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</>}
  name={<><a href="#abba5b02b3dfb44e87915fcf6af38e3fb">createFoldedExitCond</a> (const Loop &#42;L, BasicBlock &#42;ExitingBB, bool IsTaken)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a741f7bb1cc23d5c9d8917e1c7970c732">createInvariantCond</a> (const Loop &#42;L, BasicBlock &#42;ExitingBB, const ScalarEvolution::LoopInvariantPredicate &amp;LIP, SCEVExpander &amp;Rewriter)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt;</>}
  name={<><a href="#a8160c4d5a8fc34f6085af951980dbaa6">createReplacement</a> (ICmpInst &#42;ICmp, const Loop &#42;L, BasicBlock &#42;ExitingBB, const SCEV &#42;MaxIter, bool Inverted, bool SkipLastIter, ScalarEvolution &#42;SE, SCEVExpander &amp;Rewriter)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;</>}
  name={<><a href="#adc183a6edc37f305ee9ca5ff0bc33a6e">FindLoopCounter</a> (Loop &#42;L, BasicBlock &#42;ExitingBB, const SCEV &#42;BECount, ScalarEvolution &#42;SE, DominatorTree &#42;DT)</>}>
Search the loop header for a loop counter (anadd rec w/step of one) suitable for use by LFTR. <a href="#adc183a6edc37f305ee9ca5ff0bc33a6e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aa42477bdea230fb3cc4ea230c1125941">foldExit</a> (const Loop &#42;L, BasicBlock &#42;ExitingBB, bool IsTaken, SmallVectorImpl&lt; WeakTrackingVH &gt; &amp;DeadInsts)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a14bc7872374f530d4ed193d9921825c5">genLoopLimit</a> (PHINode &#42;IndVar, BasicBlock &#42;ExitingBB, const SCEV &#42;ExitCount, bool UsePostInc, Loop &#42;L, SCEVExpander &amp;Rewriter, ScalarEvolution &#42;SE)</>}>
Insert an IR expression which computes the value held by the IV IndVar (which must be an loop counter w/unit stride) after the backedge of loop L is taken ExitCount times. <a href="#a14bc7872374f530d4ed193d9921825c5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;</>}
  name={<><a href="#ab8fbf8890afc93e88d19a28877c13fad">getLoopPhiForCounter</a> (Value &#42;IncV, Loop &#42;L)</>}>
Given an <a href="/docs/api/classes/llvm/value">Value</a> which is hoped to be part of an add recurance in the given loop, return the associated Phi node if so. <a href="#ab8fbf8890afc93e88d19a28877c13fad">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9cc6c5ed9edaa15e526e2a5ad24d1413">hasConcreteDef</a> (Value &#42;V)</>}>
Return true if the given value is concrete. <a href="#a9cc6c5ed9edaa15e526e2a5ad24d1413">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9504a92a00083831f812fb8317b1d9a0">hasConcreteDefImpl</a> (Value &#42;V, SmallPtrSetImpl&lt; Value &#42; &gt; &amp;Visited, unsigned Depth)</>}>
Recursive helper for <a href="#a9cc6c5ed9edaa15e526e2a5ad24d1413">hasConcreteDef()</a>. <a href="#a9504a92a00083831f812fb8317b1d9a0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7803cd22b4405090d0cb0b87d697a612">isLoopCounter</a> (PHINode &#42;Phi, Loop &#42;L, ScalarEvolution &#42;SE)</>}>
Return true if the given phi is a &quot;counter&quot; in L. <a href="#a7803cd22b4405090d0cb0b87d697a612">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a23d78b7d4dbea0ecc84dc55313ad1f25">isLoopExitTestBasedOn</a> (Value &#42;V, BasicBlock &#42;ExitingBB)</>}>
Whether the current loop exit test is based on this value. <a href="#a23d78b7d4dbea0ecc84dc55313ad1f25">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6a2f2b3d9153487f51dae119c07f8461">needsLFTR</a> (Loop &#42;L, BasicBlock &#42;ExitingBB)</>}>
linearFunctionTestReplace policy. <a href="#a6a2f2b3d9153487f51dae119c07f8461">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a740a442f349b36821071c21e265e23e1">optimizeLoopExitWithUnknownExitCount</a> (const Loop &#42;L, BranchInst &#42;BI, BasicBlock &#42;ExitingBB, const SCEV &#42;MaxIter, bool SkipLastIter, ScalarEvolution &#42;SE, SCEVExpander &amp;Rewriter, SmallVectorImpl&lt; WeakTrackingVH &gt; &amp;DeadInsts)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a16b4faf9802df251058f89443ca35a6c">replaceExitCond</a> (BranchInst &#42;BI, Value &#42;NewCond, SmallVectorImpl&lt; WeakTrackingVH &gt; &amp;DeadInsts)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a649ac561acbab510055b0e8f48ca0617">replaceLoopPHINodesWithPreheaderValues</a> (LoopInfo &#42;LI, Loop &#42;L, SmallVectorImpl&lt; WeakTrackingVH &gt; &amp;DeadInsts, ScalarEvolution &amp;SE)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac9d34a2a7fa6eabd57ae7b773d741331">STATISTIC</a> (NumWidened, &quot;Number of indvars widened&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a5aadc254a77a8bc0be7329363bef08bb">STATISTIC</a> (NumReplaced, &quot;Number of exit values replaced&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad75703997f13d19720ea15d220f68496">STATISTIC</a> (NumLFTR, &quot;Number of loop exit tests replaced&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a30f8e488a4a345e5dfeef7bcae2e3c92">STATISTIC</a> (NumElimExt, &quot;Number of IV sign/zero extends eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a5c26e913bb0fe2a47bb5c9bfb627eecb">STATISTIC</a> (NumElimIV, &quot;Number of congruent IVs eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a57aff0646c7151c4158d839c386332cc">visitIVCast</a> (CastInst &#42;Cast, WideIVInfo &amp;WI, ScalarEvolution &#42;SE, const TargetTransformInfo &#42;TTI)</>}>
Update information about the induction variable that is extended by this sign or zero extend operation. <a href="#a57aff0646c7151c4158d839c386332cc">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aea2c111bf1f82fd672acaad1931e7e2d">AllowIVWidening</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1fa311ace7bbfa6e7713cf18baa65f8e">DisableLFTR</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#afd24bd142b192aff5be237d10c2c4691">LoopPredication</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986">ReplaceExitVal</a> &gt;</>}
  name={<><a href="#a321d169dcb80429e5c3fdf455c4517ec">ReplaceExitValue</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#accc15a102c8ad5b2f46c6b23ca331f4c">UsePostIncrementRanges</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;indvars&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### ConvertToSInt() {#af945460922a5750a0d075b6344608e27}

<MemberDefinition
  prototype={<>static bool ConvertToSInt (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/apfloat">APFloat</a> &amp; APF, int64&#95;t &amp; IntVal)</>}
  labels = {["static"]}>
Convert APF to an integer, if possible.

Definition at line <a href="#l00184">184</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### createFoldedExitCond() {#abba5b02b3dfb44e87915fcf6af38e3fb}

<MemberDefinition
  prototype={<>static Constant &#42; createFoldedExitCond (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB, bool IsTaken)</>}
  labels = {["static"]}>

Definition at line <a href="#l01188">1188</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### createInvariantCond() {#a741f7bb1cc23d5c9d8917e1c7970c732}

<MemberDefinition
  prototype={<>static Value &#42; createInvariantCond (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/scalarevolution/loopinvariantpredicate">ScalarEvolution::LoopInvariantPredicate</a> &amp; LIP, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp; Rewriter)</>}
  labels = {["static"]}>

Definition at line <a href="#l01243">1243</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### createReplacement() {#a8160c4d5a8fc34f6085af951980dbaa6}

<MemberDefinition
  prototype={<>static std::optional&lt; Value &#42; &gt; createReplacement (<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42; ICmp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; MaxIter, bool Inverted, bool SkipLastIter, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp; Rewriter)</>}
  labels = {["static"]}>

Definition at line <a href="#l01262">1262</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### FindLoopCounter() {#adc183a6edc37f305ee9ca5ff0bc33a6e}

<MemberDefinition
  prototype={<>static PHINode &#42; FindLoopCounter (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; BECount, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT)</>}
  labels = {["static"]}>
Search the loop header for a loop counter (anadd rec w/step of one) suitable for use by LFTR.

If multiple counters are available, select the &quot;best&quot; one based profitable heuristics.

BECount may be an i8&#42; pointer type. The pointer difference is already valid count without scaling the address stride, so it remains a pointer expression as far as <a href="/docs/api/classes/llvm/scev">SCEV</a> is concerned.

Definition at line <a href="#l00833">833</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### foldExit() {#aa42477bdea230fb3cc4ea230c1125941}

<MemberDefinition
  prototype={<>static void foldExit (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB, bool IsTaken, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> &gt; &amp; DeadInsts)</>}
  labels = {["static"]}>

Definition at line <a href="#l01197">1197</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### genLoopLimit() {#a14bc7872374f530d4ed193d9921825c5}

<MemberDefinition
  prototype={<>static Value &#42; genLoopLimit (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; IndVar, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; ExitCount, bool UsePostInc, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp; Rewriter, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE)</>}
  labels = {["static"]}>
Insert an IR expression which computes the value held by the IV IndVar (which must be an loop counter w/unit stride) after the backedge of loop L is taken ExitCount times.

Definition at line <a href="#l00913">913</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### getLoopPhiForCounter() {#ab8fbf8890afc93e88d19a28877c13fad}

<MemberDefinition
  prototype={<>static PHINode &#42; getLoopPhiForCounter (<a href="/docs/api/classes/llvm/value">Value</a> &#42; IncV, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L)</>}
  labels = {["static"]}>
Given an <a href="/docs/api/classes/llvm/value">Value</a> which is hoped to be part of an add recurance in the given loop, return the associated Phi node if so.

Otherwise, return null. Note that this is less general than SCEVs AddRec checking.

Definition at line <a href="#l00661">661</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### hasConcreteDef() {#a9cc6c5ed9edaa15e526e2a5ad24d1413}

<MemberDefinition
  prototype={<>static bool hasConcreteDef (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>
Return true if the given value is concrete.

We must prove that undef can never reach it.

TODO: If we decide that this is a good approach to checking for undef, we may factor it into a common location.

Definition at line <a href="#l00795">795</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### hasConcreteDefImpl() {#a9504a92a00083831f812fb8317b1d9a0}

<MemberDefinition
  prototype={<>static bool hasConcreteDefImpl (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Visited, unsigned Depth)</>}
  labels = {["static"]}>
Recursive helper for <a href="#a9cc6c5ed9edaa15e526e2a5ad24d1413">hasConcreteDef()</a>.

Unfortunately, this currently boils down to checking that all operands are constant and listing instructions that may hide undef.

Definition at line <a href="#l00762">762</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### isLoopCounter() {#a7803cd22b4405090d0cb0b87d697a612}

<MemberDefinition
  prototype={<>static bool isLoopCounter (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; Phi, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE)</>}
  labels = {["static"]}>
Return true if the given phi is a &quot;counter&quot; in L.

A counter is an add recurance (of integer or pointer type) with an arbitrary start, and a step of 1. Note that L must have exactly one latch.

Definition at line <a href="#l00804">804</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### isLoopExitTestBasedOn() {#a23d78b7d4dbea0ecc84dc55313ad1f25}

<MemberDefinition
  prototype={<>static bool isLoopExitTestBasedOn (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB)</>}
  labels = {["static"]}>
Whether the current loop exit test is based on this value.

Currently this is limited to a direct use in the loop condition.

Definition at line <a href="#l00699">699</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### needsLFTR() {#a6a2f2b3d9153487f51dae119c07f8461}

<MemberDefinition
  prototype={<>static bool needsLFTR (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB)</>}
  labels = {["static"]}>
linearFunctionTestReplace policy.

Return true unless we can show that the current exit test is already sufficiently canonical.

Definition at line <a href="#l00712">712</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### optimizeLoopExitWithUnknownExitCount() {#a740a442f349b36821071c21e265e23e1}

<MemberDefinition
  prototype={<>static bool optimizeLoopExitWithUnknownExitCount (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExitingBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; MaxIter, bool SkipLastIter, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp; Rewriter, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> &gt; &amp; DeadInsts)</>}
  labels = {["static"]}>

Definition at line <a href="#l01319">1319</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### replaceExitCond() {#a16b4faf9802df251058f89443ca35a6c}

<MemberDefinition
  prototype={<>static void replaceExitCond (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; NewCond, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> &gt; &amp; DeadInsts)</>}
  labels = {["static"]}>

Definition at line <a href="#l01178">1178</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### replaceLoopPHINodesWithPreheaderValues() {#a649ac561acbab510055b0e8f48ca0617}

<MemberDefinition
  prototype={<>static void replaceLoopPHINodesWithPreheaderValues (<a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> &gt; &amp; DeadInsts, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp; SE)</>}
  labels = {["static"]}>

Definition at line <a href="#l01204">1204</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac9d34a2a7fa6eabd57ae7b773d741331}

<MemberDefinition
  prototype={<>STATISTIC (NumWidened, &quot;Number of indvars widened&quot;)</>}>

Definition at line <a href="#l00085">85</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a5aadc254a77a8bc0be7329363bef08bb}

<MemberDefinition
  prototype={<>STATISTIC (NumReplaced, &quot;Number of exit values replaced&quot;)</>}>

Definition at line <a href="#l00086">86</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad75703997f13d19720ea15d220f68496}

<MemberDefinition
  prototype={<>STATISTIC (NumLFTR, &quot;Number of loop exit tests replaced&quot;)</>}>

Definition at line <a href="#l00087">87</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a30f8e488a4a345e5dfeef7bcae2e3c92}

<MemberDefinition
  prototype={<>STATISTIC (NumElimExt, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> sign/<a href="/docs/api/files/lib/lib/objectyaml/elfemitter-cpp/#aa15f84f0499130c4cec8c17e7f7376ce">zero</a> extends eliminated&quot;)</>}>

Definition at line <a href="#l00088">88</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a5c26e913bb0fe2a47bb5c9bfb627eecb}

<MemberDefinition
  prototype={<>STATISTIC (NumElimIV, &quot;Number of congruent IVs eliminated&quot;)</>}>

Definition at line <a href="#l00089">89</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### visitIVCast() {#a57aff0646c7151c4158d839c386332cc}

<MemberDefinition
  prototype={<>static void visitIVCast (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42; Cast, <a href="/docs/api/structs/llvm/wideivinfo">WideIVInfo</a> &amp; WI, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI)</>}
  labels = {["static"]}>
Update information about the induction variable that is extended by this sign or zero extend operation.

This is used to determine the final width of the IV before actually widening it.

Definition at line <a href="#l00509">509</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### AllowIVWidening {#aea2c111bf1f82fd672acaad1931e7e2d}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AllowIVWidening(&quot;indvars-widen-indvars&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow widening of indvars to eliminate s/zext&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00121">121</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### DisableLFTR {#a1fa311ace7bbfa6e7713cf18baa65f8e}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableLFTR(&quot;disable-lftr&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable Linear Function Test Replace optimization&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00113">113</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### LoopPredication {#afd24bd142b192aff5be237d10c2c4691}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; LoopPredication(&quot;indvars-predicate-loops&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Predicate conditions in read only loops&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00117">117</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### ReplaceExitValue {#a321d169dcb80429e5c3fdf455c4517ec}

<MemberDefinition
  prototype={<>cl::opt&lt; ReplaceExitVal &gt; ReplaceExitValue(&quot;replexitval&quot;, cl::Hidden, cl::init(OnlyCheapRepl), cl::desc(&quot;Choose the strategy to replace exit value in IndVarSimplify&quot;), cl::values( clEnumValN(NeverRepl, &quot;never&quot;, &quot;never replace exit value&quot;), clEnumValN(OnlyCheapRepl, &quot;cheap&quot;, &quot;only replace exit value when the cost is cheap&quot;), clEnumValN( UnusedIndVarInLoop, &quot;unusedindvarinloop&quot;, &quot;only replace exit value when it is an unused &quot; &quot;induction variable in the loop and has cheap replacement cost&quot;), clEnumValN(NoHardUse, &quot;noharduse&quot;, &quot;only replace exit values when loop def likely dead&quot;), clEnumValN(AlwaysRepl, &quot;always&quot;, &quot;always replace exit value whenever possible&quot;)))</>}
  labels = {["static"]}>

Definition at line <a href="#l00091">91</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

### UsePostIncrementRanges {#accc15a102c8ad5b2f46c6b23ca331f4c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UsePostIncrementRanges(&quot;indvars-post-increment-ranges&quot;, cl::Hidden, cl::desc(&quot;Use post increment control-dependent ranges in IndVarSimplify&quot;), cl::init(true))</>}
  labels = {["static"]}>

Definition at line <a href="#l00107">107</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;indvars&quot;</>}>

Definition at line <a href="#l00083">83</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp">IndVarSimplify.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- IndVarSimplify.cpp - Induction Variable Elimination ----------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This transformation analyzes and transforms the induction variables (and</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// computations derived from them) into simpler forms suitable for subsequent</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// analysis and transformation.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// If the trip count of a loop is computable, this pass also makes the following</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// changes:</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">//   1 The exit condition for the loop is canonicalized to compare the</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">//      induction value against the exit value.  This turns loops like:</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">//        &#39;for (i = 7; i&#42;i &lt; 1000; ++i)&#39; into &#39;for (i = 0; i != 25; ++i)&#39;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">//   2 Any use outside of the loop of an expression derived from the indvar</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">//      is changed to compute the derived value outside of the loop, eliminating</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">//      the dependence on the exit value of the induction variable.  If the only</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">//      purpose of the loop is to compute the exit value of some derived</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">//      expression, this transformation will make the loop dead.</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/indvarsimplify-h">llvm/Transforms/Scalar/IndVarSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apfloat-h">llvm/ADT/APFloat.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h">llvm/ADT/SmallSet.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h">llvm/ADT/iterator&#95;range.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/looppass-h">llvm/Analysis/LoopPass.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h">llvm/Analysis/MemorySSA.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h">llvm/Analysis/MemorySSAUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h">llvm/Analysis/ScalarEvolution.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h">llvm/IR/ConstantRange.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h">llvm/Support/MathExtras.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/simpleloopunswitch-h">llvm/Transforms/Scalar/SimpleLoopUnswitch.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h">llvm/Transforms/Utils/LoopUtils.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h">llvm/Transforms/Utils/ScalarEvolutionExpander.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifyindvar-h">llvm/Transforms/Utils/SimplifyIndVar.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;indvars&quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85" lineLink="#ac9d34a2a7fa6eabd57ae7b773d741331"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumWidened     , </span><span class="doxyHighlightStringLiteral">&quot;Number of indvars widened&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="#a5aadc254a77a8bc0be7329363bef08bb"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumReplaced    , </span><span class="doxyHighlightStringLiteral">&quot;Number of exit values replaced&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="#ad75703997f13d19720ea15d220f68496"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLFTR        , </span><span class="doxyHighlightStringLiteral">&quot;Number of loop exit tests replaced&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88" lineLink="#a30f8e488a4a345e5dfeef7bcae2e3c92"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumElimExt     , </span><span class="doxyHighlightStringLiteral">&quot;Number of IV sign/zero extends eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89" lineLink="#a5c26e913bb0fe2a47bb5c9bfb627eecb"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumElimIV      , </span><span class="doxyHighlightStringLiteral">&quot;Number of congruent IVs eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91" lineLink="#a321d169dcb80429e5c3fdf455c4517ec"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;ReplaceExitVal&gt;</a> <a href="#a321d169dcb80429e5c3fdf455c4517ec">ReplaceExitValue</a>(</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;replexitval&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986a1e6c3ab87bc6c3b3ee4b5a64e3a99963">OnlyCheapRepl</a>),</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Choose the strategy to replace exit value in IndVarSimplify&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a8fa743aa76b6902028f8a643dfb87171">cl::values</a>(</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986a4f92864a2edbc4ee6aa6d5abcb995fdd">NeverRepl</a>, </span><span class="doxyHighlightStringLiteral">&quot;never&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;never replace exit value&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986a1e6c3ab87bc6c3b3ee4b5a64e3a99963">OnlyCheapRepl</a>, </span><span class="doxyHighlightStringLiteral">&quot;cheap&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;only replace exit value when the cost is cheap&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986a0cba5d71f8085f5b0bd4c61555d86bb6">UnusedIndVarInLoop</a>, </span><span class="doxyHighlightStringLiteral">&quot;unusedindvarinloop&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;only replace exit value when it is an unused &quot;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;induction variable in the loop and has cheap replacement cost&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986a83cddaf900262d84aed9055c0a1f0203">NoHardUse</a>, </span><span class="doxyHighlightStringLiteral">&quot;noharduse&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;only replace exit values when loop def likely dead&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986add1840394cd7a4e7d080482f42e7b424">AlwaysRepl</a>, </span><span class="doxyHighlightStringLiteral">&quot;always&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;always replace exit value whenever possible&quot;</span><span class="doxyHighlight">)));</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#accc15a102c8ad5b2f46c6b23ca331f4c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#accc15a102c8ad5b2f46c6b23ca331f4c">UsePostIncrementRanges</a>(</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">  </span><span class="doxyHighlightStringLiteral">&quot;indvars-post-increment-ranges&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Use post increment control-dependent ranges in IndVarSimplify&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="#a1fa311ace7bbfa6e7713cf18baa65f8e"><span class="doxyHighlight"><a href="#a1fa311ace7bbfa6e7713cf18baa65f8e">DisableLFTR</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-lftr&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">            <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable Linear Function Test Replace optimization&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117" lineLink="#afd24bd142b192aff5be237d10c2c4691"><span class="doxyHighlight"><a href="#afd24bd142b192aff5be237d10c2c4691">LoopPredication</a>(</span><span class="doxyHighlightStringLiteral">&quot;indvars-predicate-loops&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">                <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Predicate conditions in read only loops&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121" lineLink="#aea2c111bf1f82fd672acaad1931e7e2d"><span class="doxyHighlight"><a href="#aea2c111bf1f82fd672acaad1931e7e2d">AllowIVWidening</a>(</span><span class="doxyHighlightStringLiteral">&quot;indvars-widen-indvars&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">                <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow widening of indvars to eliminate s/zext&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124" lineLink="/docs/api/namespaces/anonymous-indvarsimplify-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify/#ae31c19c6270ac93356cd7a98c7965525">IndVarSimplify</a> &#123;</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  std::unique&#95;ptr&lt;MemorySSAUpdater&gt; MSSAU;</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 16&gt;</a> DeadInsts;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> WidenIndVars;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RunUnswitching = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleFloatingPointIV(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PH);</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> rewriteNonIntegerIVs(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L);</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyAndExtend(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI);</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">  /// Try to improve our exit conditions by converting condition from signed</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightComment">  /// to unsigned or rotating computation out of the loop.</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightComment">  /// (See inline comment about why this is duplicated from simplifyAndExtend)</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> canonicalizeExitCondition(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L);</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlightComment">  /// Try to eliminate loop exits based on analyzeable exit counts</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> optimizeLoopExits(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightComment">  /// Try to form loop invariant tests for loop exits by changing how many</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlightComment">  /// iterations of the loop run when that is unobservable.</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> predicateLoopExits(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> rewriteFirstIterationLoopExitValues(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L);</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> linearFunctionTestReplace(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB,</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount,</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IndVar, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> sinkUnusedInvariants(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L);</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify/#ae31c19c6270ac93356cd7a98c7965525"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify/#ae31c19c6270ac93356cd7a98c7965525">IndVarSimplify</a>(<a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> WidenIndVars)</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">      : LI(LI), SE(SE), DT(DT), DL(DL), TLI(TLI), TTI(TTI),</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">        WidenIndVars(WidenIndVars) &#123;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSA)</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">      MSSAU = std::make&#95;unique&lt;MemorySSAUpdater&gt;(MSSA);</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> run(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L);</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify/#aacd77ced9632726e39b77cc2a78c9f7d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify/#aacd77ced9632726e39b77cc2a78c9f7d">runUnswitching</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RunUnswitching; &#125;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlightComment">// rewriteNonIntegerIVs and helpers. Prefer integer IVs.</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlightComment">/// Convert APF to an integer, if possible.</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184" lineLink="#af945460922a5750a0d075b6344608e27"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af945460922a5750a0d075b6344608e27">ConvertToSInt</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apfloat">APFloat</a> &amp;APF, int64&#95;t &amp;IntVal) &#123;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isExact = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we can convert this to an int64&#95;t</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">  uint64&#95;t UIntVal;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (APF.<a href="/docs/api/classes/llvm/apfloat/#aae1f09de4bf1aab27149a7d328715e30">convertToInteger</a>(<a href="/docs/api/classes/llvm/mutablearrayref">MutableArrayRef</a>(UIntVal), 64, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">                           <a href="/docs/api/structs/llvm/apfloatbase/#a482d9cf95b588eb05cefeaa5c05be9a3">APFloat::rmTowardZero</a>, &amp;isExact) != <a href="/docs/api/structs/llvm/apfloatbase/#aee544c332088dbef348a0c1c97e21a6aa8092c6b52c0412d8198a63bc995761e9">APFloat::opOK</a> ||</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">      !isExact)</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">  IntVal = UIntVal;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlightComment">/// If the loop has floating induction variable then insert corresponding</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlightComment">/// integer induction variable if possible.</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlightComment">/// For example,</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlightComment">/// for(double i = 0; i &lt; 10000; ++i)</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlightComment">///   bar(i)</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlightComment">/// is converted into</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlightComment">/// for(int i = 0; i &lt; 10000; ++i)</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlightComment">///   bar((double)i);</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::handleFloatingPointIV(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IncomingEdge = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(0));</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BackEdge     = IncomingEdge^1;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check incoming value.</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InitValueVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantFP&gt;</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(IncomingEdge));</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  int64&#95;t InitValue;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InitValueVal || !<a href="#af945460922a5750a0d075b6344608e27">ConvertToSInt</a>(InitValueVal-&gt;getValueAPF(), InitValue))</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check IV increment. Reject this PN if increment operation is not</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// an add or increment value can not be represented by an integer.</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Incr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(BackEdge));</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Incr == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> || Incr-&gt;getOpcode() != Instruction::FAdd) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is not an add of the PHI with a constantfp, or if the constant fp</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is not an integer, bail out.</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantfp">ConstantFP</a> &#42;IncValueVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantFP&gt;</a>(Incr-&gt;getOperand(1));</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  int64&#95;t IncValue;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncValueVal == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> || Incr-&gt;getOperand(0) != PN ||</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">      !<a href="#af945460922a5750a0d075b6344608e27">ConvertToSInt</a>(IncValueVal-&gt;<a href="/docs/api/classes/llvm/constantfp/#a32aa14715eeb813d764fcf20f161f0a1">getValueAPF</a>(), IncValue))</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check Incr uses. One user is PN and the other user is an exit condition</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// used by the conditional terminator.</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value/#acd2fbee42afeb868be98aaae56528636">Value::user&#95;iterator</a> IncrUse = Incr-&gt;user&#95;begin();</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;U1 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;IncrUse++);</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncrUse == Incr-&gt;user&#95;end()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;U2 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;IncrUse++);</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncrUse != Incr-&gt;user&#95;end()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find exit condition, which is an fcmp.  If it doesn&#39;t exist, or if it isn&#39;t</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only used by a branch, we can&#39;t transform it.</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/fcmpinst">FCmpInst</a> &#42;<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FCmpInst&gt;</a>(U1);</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Compare)</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FCmpInst&gt;</a>(U2);</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Compare || !<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;hasOneUse() ||</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;user&#95;back()))</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;TheBr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;user&#95;back());</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to verify that the branch actually controls the iteration count</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the loop.  If not, the new IV can overflow and no one will notice.</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The branch block must be in the loop and one of the successors must be out</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the loop.</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TheBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t use fcmp if not conditional&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(TheBr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) ||</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(TheBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) &amp;&amp;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(TheBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))))</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it isn&#39;t a comparison with an integer-as-fp (the exit value), we can&#39;t</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transform it.</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantfp">ConstantFP</a> &#42;ExitValueVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantFP&gt;</a>(<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  int64&#95;t ExitValue;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitValueVal == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> ||</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">      !<a href="#af945460922a5750a0d075b6344608e27">ConvertToSInt</a>(ExitValueVal-&gt;<a href="/docs/api/classes/llvm/constantfp/#a32aa14715eeb813d764fcf20f161f0a1">getValueAPF</a>(), ExitValue))</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find new predicate for integer comparison.</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> NewPred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>;</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;getPredicate()) &#123;</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">: </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// Unknown comparison.</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba024db78a5ed74f64666f3ca4955e6eca">CmpInst::FCMP&#95;OEQ</a>:</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba919643b83ce3c9af2e4296ed5e413a1f">CmpInst::FCMP&#95;UEQ</a>: NewPred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba8a80b27ca29fe2076b9bbdee02c65464">CmpInst::FCMP&#95;ONE</a>:</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad601460c9371d0f0ada5ae006bdba2bd">CmpInst::FCMP&#95;UNE</a>: NewPred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP&#95;NE</a>; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba4c399f525bbcf03d72af4b303e6eeca8">CmpInst::FCMP&#95;OGT</a>:</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba959268ceeae23abe5c9ad9e895669d0c">CmpInst::FCMP&#95;UGT</a>: NewPred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">CmpInst::ICMP&#95;SGT</a>; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba541533f34077bbbcfb703a90f6d2da9b">CmpInst::FCMP&#95;OGE</a>:</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bae51609fc6a425f849d37c28cb9bc0344">CmpInst::FCMP&#95;UGE</a>: NewPred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac1aa7b798ba11d2e497d5cce6ce6d3dc">CmpInst::ICMP&#95;SGE</a>; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba326bee0a4a424cef21c1cf8adb8b8dd8">CmpInst::FCMP&#95;OLT</a>:</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba75016d5872d90adf89cc1cbf5763f474">CmpInst::FCMP&#95;ULT</a>: NewPred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">CmpInst::ICMP&#95;SLT</a>; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba9835cfe02fb5027680bd7203b024f77a">CmpInst::FCMP&#95;OLE</a>:</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba396dda2571cd3c575f1d9cb44dc2cc09">CmpInst::FCMP&#95;ULE</a>: NewPred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba2751d6136a2819749dcef65dc19a4246">CmpInst::ICMP&#95;SLE</a>; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We convert the floating point induction variable to a signed i32 value if</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can.  This is only safe if the comparison will not overflow in a way</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that won&#39;t be trapped by the integer equivalent operations.  Check for this</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// now.</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We could use i64 if it is native and the range requires it.</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The start/stride/exit values must all fit in signed i32.</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a1a1e51a5952c3afa00875df90e7ae6f8">isInt&lt;32&gt;</a>(InitValue) || !<a href="/docs/api/namespaces/llvm/#a1a1e51a5952c3afa00875df90e7ae6f8">isInt&lt;32&gt;</a>(IncValue) || !<a href="/docs/api/namespaces/llvm/#a1a1e51a5952c3afa00875df90e7ae6f8">isInt&lt;32&gt;</a>(ExitValue))</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If not actually striding (add x, 0.0), avoid touching the code.</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncValue == 0)</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Positive and negative strides have different safety conditions.</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncValue &gt; 0) &#123;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have a positive stride, we require the init to be less than the</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exit value.</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InitValue &gt;= ExitValue)</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">    uint32&#95;t <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> = uint32&#95;t(ExitValue-InitValue);</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check for infinite loop, either:</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// while (i &lt;= Exit) or until (i &gt; Exit)</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba2751d6136a2819749dcef65dc19a4246">CmpInst::ICMP&#95;SLE</a> || NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">CmpInst::ICMP&#95;SGT</a>) &#123;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (++<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> == 0) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// Range overflows.</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Leftover = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> % uint32&#95;t(IncValue);</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is an equality comparison, we require that the strided value</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exactly land on the exit value, otherwise the IV condition will wrap</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// around and do things the fp IV wouldn&#39;t.</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a> || NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP&#95;NE</a>) &amp;&amp;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">        Leftover != 0)</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the stride would wrap around the i32 before exiting, we can&#39;t</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// transform the IV.</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Leftover != 0 &amp;&amp; int32&#95;t(ExitValue+IncValue) &lt; ExitValue)</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have a negative stride, we require the init to be greater than the</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exit value.</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InitValue &lt;= ExitValue)</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">    uint32&#95;t <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> = uint32&#95;t(InitValue-ExitValue);</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check for infinite loop, either:</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// while (i &gt;= Exit) or until (i &lt; Exit)</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac1aa7b798ba11d2e497d5cce6ce6d3dc">CmpInst::ICMP&#95;SGE</a> || NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">CmpInst::ICMP&#95;SLT</a>) &#123;</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (++<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> == 0) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// Range overflows.</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Leftover = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> % uint32&#95;t(-IncValue);</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is an equality comparison, we require that the strided value</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exactly land on the exit value, otherwise the IV condition will wrap</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// around and do things the fp IV wouldn&#39;t.</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a> || NewPred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP&#95;NE</a>) &amp;&amp;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">        Leftover != 0)</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the stride would wrap around the i32 before exiting, we can&#39;t</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// transform the IV.</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Leftover != 0 &amp;&amp; int32&#95;t(ExitValue+IncValue) &gt; ExitValue)</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a> = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(PN-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert new integer induction variable.</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPHI =</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a>, 2, PN-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.int&quot;</span><span class="doxyHighlight">, PN-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  NewPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a>, InitValue),</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">                      PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(IncomingEdge));</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  NewPHI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewAdd = BinaryOperator::CreateAdd(</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">      NewPHI, <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a>, IncValue),</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">      Incr-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.int&quot;</span><span class="doxyHighlight">, Incr-&gt;getIterator());</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  NewAdd-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Incr-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  NewPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewAdd, PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(BackEdge));</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;NewCompare = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">      TheBr-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), NewPred, NewAdd,</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a>, ExitValue), <a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;getName());</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  NewCompare-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the following deletions, PN may become dead and may be deleted.</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use a WeakTrackingVH to observe whether this happens.</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> WeakPH = PN;</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete the old floating point exit comparison.  The branch starts using the</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// new comparison.</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">  NewCompare-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(Compare);</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>-&gt;replaceAllUsesWith(NewCompare);</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Compare, TLI, MSSAU.get());</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete the old floating point increment.</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  Incr-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Incr-&gt;getType()));</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Incr, TLI, MSSAU.get());</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the FP induction variable still has uses, this is because something else</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the loop uses its value.  In order to canonicalize the induction</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// variable, we chose to eliminate the IV and rewrite it in terms of an</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// int-&gt;fp cast.</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We give preference to sitofp over uitofp because it is faster on most</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// platforms.</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WeakPH) &#123;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Conv = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/sitofpinst">SIToFPInst</a>(NewPHI, PN-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;indvar.conv&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">                                       PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">    Conv-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Conv);</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(PN, TLI, MSSAU.get());</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::rewriteNonIntegerIVs(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First step.  Check to see if there are any floating-point recurrences.</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are, change them into integer recurrences, permitting analysis by</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the SCEV routines.</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Header = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getHeader();</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 8&gt;</a> PHIs;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Header-&gt;phis())</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">    PHIs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;PN);</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : PHIs)</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;PHINode&gt;</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>))</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= handleFloatingPointIV(L, PN);</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the loop previously had floating-point IV, ScalarEvolution</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// may not have been able to compute a trip count. Now that we&#39;ve done some</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// re-writing, the trip count may be computable.</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">    SE-&gt;forgetLoop(L);</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlightComment">//===---------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlightComment">// rewriteFirstIterationLoopExitValues: Rewrite loop exit values if we know</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlightComment">// they will exit at the first iteration.</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlightComment">//===---------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlightComment">/// Check to see if this loop has loop invariant conditions which lead to loop</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlightComment">/// exits. If so, we know that if the exit path is taken, it is at the first</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlightComment">/// loop iteration. This lets us predict exit values of PHI nodes that live in</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlightComment">/// loop header.</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::rewriteFirstIterationLoopExitValues(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verify the input to the pass is already in LCSSA form.</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLCSSAForm(&#42;DT));</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> ExitBlocks;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getUniqueExitBlocks(ExitBlocks);</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeAnyChanges = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitBB : ExitBlocks) &#123;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are no more PHI nodes in this exit block, then no more</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// values defined inside the loop are used on this path.</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : ExitBB-&gt;phis()) &#123;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IncomingValIdx = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">           IncomingValIdx != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++IncomingValIdx) &#123;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingBB = PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(IncomingValIdx);</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Can we prove that the exit must run on the first iteration if it</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// runs at all?  (i.e. early exits are fine for our purposes, but</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// traces which lead to this exit being taken on the 2nd iteration</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// aren&#39;t.)  Note that this is about whether the exit branch is</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// executed, not about whether it is taken.</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch() ||</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">            !DT-&gt;dominates(IncomingBB, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch()))</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Get condition that leads to the exit path.</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TermInst = IncomingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TermInst)) &#123;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Must be a conditional branch, otherwise the block</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// should not be in the loop.</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI-&gt;getCondition();</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(TermInst))</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(IncomingValIdx));</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Only deal with PHIs in the loop header.</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExitVal || ExitVal-&gt;getParent() != <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getHeader())</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If ExitVal is a PHI on the loop header, then we know its</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// value along this exit because the exit can only be taken</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// on the first iteration.</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoopPreheader = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopPreheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> PreheaderIdx = ExitVal-&gt;getBasicBlockIndex(LoopPreheader);</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreheaderIdx != -1) &#123;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitVal-&gt;getParent() == <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getHeader() &amp;&amp;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;ExitVal must be in loop header&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">          MadeAnyChanges = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">          PN.<a href="/docs/api/classes/llvm/phinode/#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(IncomingValIdx,</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">                              ExitVal-&gt;getIncomingValue(PreheaderIdx));</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">          SE-&gt;forgetValue(&amp;PN);</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeAnyChanges;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlightComment">//  IV Widening - Extend the width of an IV to cover its widest uses.</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlightComment">/// Update information about the induction variable that is extended by this</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlightComment">/// sign or zero extend operation. This is used to determine the final width of</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlightComment">/// the IV before actually widening it.</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509" lineLink="#a57aff0646c7151c4158d839c386332cc"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a57aff0646c7151c4158d839c386332cc">visitIVCast</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;Cast, <a href="/docs/api/structs/llvm/wideivinfo">WideIVInfo</a> &amp;WI,</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE,</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned = Cast-&gt;<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>() == Instruction::SExt;</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSigned &amp;&amp; Cast-&gt;<a href="/docs/api/classes/llvm/castinst/#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>() != Instruction::ZExt)</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = Cast-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">  uint64&#95;t Width = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(Ty);</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cast-&gt;<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>().<a href="/docs/api/classes/llvm/datalayout/#a4865a13a415f04576388b969d04d1541">isLegalInteger</a>(Width))</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that &#96;Cast&#96; actually extends the induction variable (we rely on this</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// later).  This takes care of cases where &#96;Cast&#96; is extending a truncation of</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the narrow induction variable, and thus can end up being narrower than the</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;narrow&quot; induction variable.</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  uint64&#95;t NarrowIVWidth = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(WI.<a href="/docs/api/structs/llvm/wideivinfo/#a882fc540d5e5234ddf6a9f880e3f5a9b">NarrowIV</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NarrowIVWidth &gt;= Width)</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cast is either an sext or zext up to this point.</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We should not widen an indvar if arithmetics on the wider indvar are more</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expensive than those on the narrower indvar. We check only the cost of ADD</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because at least an ADD is required to increment the induction variable. We</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// could compute more comprehensively the cost of all instructions on the</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// induction variable when necessary.</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> &amp;&amp;</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getArithmeticInstrCost(Instruction::Add, Ty) &gt;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getArithmeticInstrCost(Instruction::Add,</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">                                      Cast-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())) &#123;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WI.<a href="/docs/api/structs/llvm/wideivinfo/#a2bd973d7992b3f205e8d270d1a4183cd">WidestNativeType</a> ||</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">      Width &gt; SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(WI.<a href="/docs/api/structs/llvm/wideivinfo/#a2bd973d7992b3f205e8d270d1a4183cd">WidestNativeType</a>)) &#123;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">    WI.<a href="/docs/api/structs/llvm/wideivinfo/#a2bd973d7992b3f205e8d270d1a4183cd">WidestNativeType</a> = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a6dcfa69ce27cf214caaf50f21bfe1f2f">getEffectiveSCEVType</a>(Ty);</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">    WI.<a href="/docs/api/structs/llvm/wideivinfo/#a45b4503c5e229503d60cc68c034286ab">IsSigned</a> = IsSigned;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We extend the IV to satisfy the sign of its user(s), or &#39;signed&#39;</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if there are multiple users with both sign- and zero extensions,</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in order not to introduce nondeterministic behaviour based on the</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unspecified order of a PHI nodes&#39; users-iterator.</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">  WI.<a href="/docs/api/structs/llvm/wideivinfo/#a45b4503c5e229503d60cc68c034286ab">IsSigned</a> |= IsSigned;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlightComment">//  Live IV Reduction - Minimize IVs live across the loop.</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlightComment">//  Simplification of IV users based on SCEV evaluation.</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a1678bb22f6944c1d96d64e30d538a77d">IndVarSimplifyVisitor</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/ivvisitor/#a3514f750bbc476c7918e33012ab7eab8">IVVisitor</a> &#123;</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE;</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI;</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IVPhi;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a4d76bd241ce90449b4c3f56a39f2d98a"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/wideivinfo">WideIVInfo</a> <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a4d76bd241ce90449b4c3f56a39f2d98a">WI</a>;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a1678bb22f6944c1d96d64e30d538a77d"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a1678bb22f6944c1d96d64e30d538a77d">IndVarSimplifyVisitor</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;<a href="/docs/api/classes/llvm/scev">SCEV</a>,</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI,</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DTree)</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    : SE(<a href="/docs/api/classes/llvm/scev">SCEV</a>), TTI(TTI), IVPhi(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>) &#123;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/ivvisitor/#a2bf79e79a66baf07734df167944a427f">DT</a> = DTree;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a4d76bd241ce90449b4c3f56a39f2d98a">WI</a>.NarrowIV = IVPhi;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Implement the interface used by simplifyUsersOfIV.</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#af73b2da13101a790b28ff3203068fe85"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#af73b2da13101a790b28ff3203068fe85">visitCast</a>(<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;Cast)</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123; <a href="#a57aff0646c7151c4158d839c386332cc">visitIVCast</a>(Cast, <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a4d76bd241ce90449b4c3f56a39f2d98a">WI</a>, SE, TTI); &#125;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlightComment">/// Iteratively perform simplification on a worklist of IV users. Each</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlightComment">/// successive simplification may push more users which may themselves be</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlightComment">/// candidates for simplification.</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlightComment">/// Sign/Zero extend elimination is interleaved with IV simplification.</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::simplifyAndExtend(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>,</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI) &#123;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WideIVInfo, 8&gt;</a> WideIVs;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GuardDecl = <a href="/docs/api/namespaces/llvm/intrinsic/#aa1731508126b77035ab3ba9d71d5374b">Intrinsic::getDeclarationIfExists</a>(</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getBlocks()&#91;0&#93;-&gt;getModule(), Intrinsic::experimental&#95;guard);</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasGuards = GuardDecl &amp;&amp; !GuardDecl-&gt;use&#95;empty();</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 8&gt;</a> LoopPhis;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getHeader()-&gt;phis())</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    LoopPhis.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;PN);</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Each round of simplification iterates through the SimplifyIVUsers worklist</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for all current phis, then determines whether any IVs can be</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// widened. Widening adds new phis to LoopPhis, inducing another round of</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplification on the wide IVs.</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!LoopPhis.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Evaluate as many IV expressions as possible before widening any IVs. This</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// forces SCEV to set no-wrap flags before evaluating sign/zero</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// extension. The first time SCEV attempts to normalize sign/zero extension,</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the result becomes final. So for the most predictable results, we delay</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// evaluation of sign/zero extend evaluation until needed, and avoid running</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other SCEV based analysis prior to simplifyAndExtend.</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CurrIV = LoopPhis.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Information about sign/zero extensions of CurrIV.</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplifyvisitor/#a1678bb22f6944c1d96d64e30d538a77d">IndVarSimplifyVisitor</a> Visitor(CurrIV, SE, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DT);</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, U&#93; = <a href="/docs/api/namespaces/llvm/#a9796363223b02a1db7a9a7dca91e833f">simplifyUsersOfIV</a>(CurrIV, SE, DT, LI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DeadInsts,</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">                                             <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, &amp;Visitor);</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">      RunUnswitching |= U;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visitor.WI.WidestNativeType) &#123;</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">        WideIVs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Visitor.WI);</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight">(!LoopPhis.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>());</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Continue if we disallowed widening.</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WidenIndVars)</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; !WideIVs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>(); WideIVs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#ad97688dfe9cd802e2a0691cbe620218a">pop&#95;back</a>()) &#123;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ElimExt;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Widened;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;WidePhi = <a href="/docs/api/namespaces/llvm/#a35edc71a3e9b62bcfa5b80ae369515d9">createWideIV</a>(WideIVs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>(), LI, SE, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>,</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">                                          DT, DeadInsts, ElimExt, Widened,</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">                                          HasGuards, <a href="#accc15a102c8ad5b2f46c6b23ca331f4c">UsePostIncrementRanges</a>)) &#123;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">        NumElimExt += ElimExt;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">        NumWidened += Widened;</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">        LoopPhis.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(WidePhi);</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlightComment">//  linearFunctionTestReplace and its kin. Rewrite the loop exit condition.</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlightComment">/// Given an Value which is hoped to be part of an add recurance in the given</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlightComment">/// loop, return the associated Phi node if so.  Otherwise, return null.  Note</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlightComment">/// that this is less general than SCEVs AddRec checking.</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661" lineLink="#ab8fbf8890afc93e88d19a28877c13fad"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="#ab8fbf8890afc93e88d19a28877c13fad">getLoopPhiForCounter</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;IncV, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IncI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(IncV);</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IncI)</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (IncI-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>()) &#123;</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::GetElementPtr:</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// An IV counter must preserve its type.</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncI-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>() == 2)</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(IncI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi &amp;&amp; Phi-&gt;getParent() == L-&gt;getHeader()) &#123;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L-&gt;isLoopInvariant(IncI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Phi;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncI-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::GetElementPtr)</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allow add/sub to be commuted.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">  Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(IncI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi &amp;&amp; Phi-&gt;getParent() == L-&gt;getHeader()) &#123;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L-&gt;isLoopInvariant(IncI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Phi;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlightComment">/// Whether the current loop exit test is based on this value.  Currently this</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlightComment">/// is limited to a direct use in the loop condition.</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699" lineLink="#a23d78b7d4dbea0ecc84dc55313ad1f25"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a23d78b7d4dbea0ecc84dc55313ad1f25">isLoopExitTestBasedOn</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB) &#123;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Allow non-icmp loop test.</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ICmp)</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Allow indirect use.</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == V || ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == V;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlightComment">/// linearFunctionTestReplace policy. Return true unless we can show that the</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlightComment">/// current exit test is already sufficiently canonical.</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712" lineLink="#a6a2f2b3d9153487f51dae119c07f8461"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a6a2f2b3d9153487f51dae119c07f8461">needsLFTR</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB) &#123;</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;getLoopLatch() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must be in simplified form&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid converting a constant or loop invariant test back to a runtime</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// test.  This is critical for when SCEV&#39;s cached ExitCount is less precise</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// than the current IR (such as after we&#39;ve proven a particular exit is</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// actually dead and thus the BE count never reaches our ExitCount.)</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L-&gt;isLoopInvariant(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()))</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do LFTR to simplify the exit condition to an ICMP.</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do LFTR to simplify the exit ICMP to EQ/NE</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getPredicate();</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> &amp;&amp; Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for a loop invariant RHS</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getOperand(1);</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)) &#123;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for a simple IV counter LHS</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Phi)</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">    Phi = <a href="#ab8fbf8890afc93e88d19a28877c13fad">getLoopPhiForCounter</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, L);</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Phi)</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do LFTR if PHI node is defined in the loop, but is &#42;not&#42; a counter.</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = Phi-&gt;getBasicBlockIndex(L-&gt;getLoopLatch());</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx &lt; 0)</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do LFTR if the exit condition&#39;s IV is &#42;not&#42; a simple counter.</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncV = Phi-&gt;getIncomingValue(Idx);</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Phi != <a href="#ab8fbf8890afc93e88d19a28877c13fad">getLoopPhiForCounter</a>(IncV, L);</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlightComment">/// Recursive helper for hasConcreteDef(). Unfortunately, this currently boils</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlightComment">/// down to checking that all operands are constant and listing instructions</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlightComment">/// that may hide undef.</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762" lineLink="#a9504a92a00083831f812fb8317b1d9a0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9504a92a00083831f812fb8317b1d9a0">hasConcreteDefImpl</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Value&#42;&gt;</a> &amp;Visited,</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) &#123;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(V);</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt;= 6)</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Conservatively handle non-constant non-instructions. For example, Arguments</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// may be undef.</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Load and return values may be undef.</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimistically handle other instructions.</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) &#123;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>).second)</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a9504a92a00083831f812fb8317b1d9a0">hasConcreteDefImpl</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, Visited, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>+1))</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlightComment">/// Return true if the given value is concrete. We must prove that undef can</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlightComment">/// never reach it.</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlightComment">/// TODO: If we decide that this is a good approach to checking for undef, we</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlightComment">/// may factor it into a common location.</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795" lineLink="#a9cc6c5ed9edaa15e526e2a5ad24d1413"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9cc6c5ed9edaa15e526e2a5ad24d1413">hasConcreteDef</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value&#42;, 8&gt;</a> Visited;</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">  Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(V);</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a9504a92a00083831f812fb8317b1d9a0">hasConcreteDefImpl</a>(V, Visited, 0);</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlightComment">/// Return true if the given phi is a &quot;counter&quot; in L.  A counter is an</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlightComment">/// add recurance (of integer or pointer type) with an arbitrary start, and a</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlightComment">/// step of 1  Note that L must have exactly one latch.</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804" lineLink="#a7803cd22b4405090d0cb0b87d697a612"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7803cd22b4405090d0cb0b87d697a612">isLoopCounter</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a>&#42; Phi, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE) &#123;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Phi-&gt;getParent() == L-&gt;getHeader());</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;getLoopLatch());</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a6d8769a72303e2b06ef63129cb231855">isSCEVable</a>(Phi-&gt;getType()))</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Phi));</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AR || AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != L || !AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a54bb7394d874cbbef1d81e6bea89d4f3">isAffine</a>())</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Step = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a4049f7040a4628b15f182c3c9aaf802a">getStepRecurrence</a>(&#42;SE));</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Step || !Step-&gt;<a href="/docs/api/classes/llvm/scev/#a1ecb726f4e7b445057b795ed500546a0">isOne</a>())</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> LatchIdx = Phi-&gt;getBasicBlockIndex(L-&gt;getLoopLatch());</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncV = Phi-&gt;getIncomingValue(LatchIdx);</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="#ab8fbf8890afc93e88d19a28877c13fad">getLoopPhiForCounter</a>(IncV, L) == Phi &amp;&amp;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(IncV)));</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlightComment">/// Search the loop header for a loop counter (anadd rec w/step of one)</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlightComment">/// suitable for use by LFTR.  If multiple counters are available, select the</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlightComment">/// &quot;best&quot; one based profitable heuristics.</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlightComment">/// BECount may be an i8&#42; pointer type. The pointer difference is already</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlightComment">/// valid count without scaling the address stride, so it remains a pointer</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlightComment">/// expression as far as SCEV is concerned.</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833" lineLink="#adc183a6edc37f305ee9ca5ff0bc33a6e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="#adc183a6edc37f305ee9ca5ff0bc33a6e">FindLoopCounter</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB,</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount,</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT) &#123;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">  uint64&#95;t BCWidth = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(BECount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>());</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())-&gt;getCondition();</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop over all of the PHI nodes, looking for a simple counter.</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;BestPhi = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BestInit = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LatchBlock = L-&gt;getLoopLatch();</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LatchBlock &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must be in simplified form&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = L-&gt;getHeader()-&gt;getDataLayout();</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = L-&gt;getHeader()-&gt;begin(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7803cd22b4405090d0cb0b87d697a612">isLoopCounter</a>(Phi, L, SE))</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Phi));</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AR may be a pointer type, while BECount is an integer type.</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AR may be wider than BECount. With eq/ne tests overflow is immaterial.</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AR may not be a narrower type, or we may never exit.</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">    uint64&#95;t PhiWidth = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(AR-&gt;getType());</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiWidth &lt; BCWidth || !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isLegalInteger(PhiWidth))</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Avoid reusing a potentially undef value to compute other values that may</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have originally had a concrete definition.</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a9cc6c5ed9edaa15e526e2a5ad24d1413">hasConcreteDef</a>(Phi)) &#123;</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We explicitly allow unknown phis as long as they are already used by</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the loop exit test.  This is legal since performing LFTR could not</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// increase the number of undef users.</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncPhi = Phi-&gt;getIncomingValueForBlock(LatchBlock);</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a23d78b7d4dbea0ecc84dc55313ad1f25">isLoopExitTestBasedOn</a>(Phi, ExitingBB) &amp;&amp;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">          !<a href="#a23d78b7d4dbea0ecc84dc55313ad1f25">isLoopExitTestBasedOn</a>(IncPhi, ExitingBB))</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Avoid introducing undefined behavior due to poison which didn&#39;t exist in</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the original program.  (Annoyingly, the rules for poison and undef</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// propagation are distinct, so this does NOT cover the undef case above.)</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have to ensure that we don&#39;t introduce UB by introducing a use on an</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// iteration where said IV produces poison.  Our strategy here differs for</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointers and integer IVs.  For integers, we strip and reinfer as needed,</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// see code in linearFunctionTestReplace.  For pointers, we restrict</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// transforms as there is no good way to reinfer inbounds once lost.</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Phi-&gt;getType()-&gt;isIntegerTy() &amp;&amp;</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/#a023f82db84f5e5ed13398308496689e7">mustExecuteUBIfPoisonOnPathTo</a>(Phi, ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), DT))</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/classes/llvm/init">Init</a> = AR-&gt;getStart();</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BestPhi &amp;&amp; !<a href="/docs/api/namespaces/llvm/#aca57f75a6554ba9ed3bc72ef7b7540de">isAlmostDeadIV</a>(BestPhi, LatchBlock, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t force a live loop counter if another IV can be used.</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aca57f75a6554ba9ed3bc72ef7b7540de">isAlmostDeadIV</a>(Phi, LatchBlock, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Prefer to count-from-zero. This is a more &quot;canonical&quot; counter form. It</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// also prefers integer to pointer IVs.</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BestInit-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>() != <a href="/docs/api/classes/llvm/init">Init</a>-&gt;isZero()) &#123;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BestInit-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>())</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If two IVs both count from zero or both count from nonzero then the</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// narrower is likely a dead phi that has been widened. Use the wider phi</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to allow the other to be eliminated.</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiWidth &lt;= SE-&gt;getTypeSizeInBits(BestPhi-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">    BestPhi = Phi;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">    BestInit = <a href="/docs/api/classes/llvm/init">Init</a>;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BestPhi;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlightComment">/// Insert an IR expression which computes the value held by the IV IndVar</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlightComment">/// (which must be an loop counter w/unit stride) after the backedge of loop L</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlightComment">/// is taken ExitCount times.</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913" lineLink="#a14bc7872374f530d4ed193d9921825c5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a14bc7872374f530d4ed193d9921825c5">genLoopLimit</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IndVar, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB,</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsePostInc, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE) &#123;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a7803cd22b4405090d0cb0b87d697a612">isLoopCounter</a>(IndVar, L, SE));</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;exit count must be integer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(IndVar));</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a4049f7040a4628b15f182c3c9aaf802a">getStepRecurrence</a>(&#42;SE)-&gt;<a href="/docs/api/classes/llvm/scev/#a1ecb726f4e7b445057b795ed500546a0">isOne</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;only handles unit stride&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For integer IVs, truncate the IV before computing the limit unless we</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// know apriori that the limit must be a constant when evaluated in the</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bitwidth of the IV.  We prefer (potentially) keeping a truncate of the</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// IV in the loop over a (potentially) expensive expansion of the widened</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exit count add(zext(add)) expression.</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">      SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a1596600146d065022af8b9c4a1d0b427">getType</a>()) &gt;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(ExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>())) &#123;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;IVInit = AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a19c13fe96d59c787e900b7bbf7173263">getStart</a>();</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVConstant&gt;</a>(IVInit) || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVConstant&gt;</a>(ExitCount))</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">      AR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a83c084b0947edf4ae748f9a73babf7b8">getTruncateExpr</a>(AR, ExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()));</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;ARBase = UsePostInc ? AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a8e3dc6f52dcd0a9cf61508d5703cbe57">getPostIncExpr</a>(&#42;SE) : AR;</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;IVLimit = ARBase-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a33583576f220997d1c415df033559a57">evaluateAtIteration</a>(ExitCount, &#42;SE);</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(IVLimit, L) &amp;&amp;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Computed iteration count is not loop invariant!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.expandCodeFor(IVLimit, ARBase-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a1596600146d065022af8b9c4a1d0b427">getType</a>(),</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">                                ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlightComment">/// This method rewrites the exit condition of the loop to be a canonical !=</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlightComment">/// comparison against the incremented loop induction variable.  This pass is</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlightComment">/// able to rewrite the exit tests of any loop where the SCEV analysis can</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlightComment">/// determine a loop-invariant trip count of the loop, which is actually a much</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlightComment">/// broader range than just linear tests.</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">linearFunctionTestReplace(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB,</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount,</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IndVar, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>) &#123;</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop no longer in simplified form?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a7803cd22b4405090d0cb0b87d697a612">isLoopCounter</a>(IndVar, L, SE));</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> IncVar =</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(IndVar-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch()));</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize CmpIndVar to the preincremented IV.</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpIndVar = IndVar;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsePostInc = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the exiting block is the same as the backedge block, we prefer to</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compare against the post-incremented value, otherwise we must compare</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// against the preincremented value.</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitingBB == <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch()) &#123;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For pointer IVs, we chose to not strip inbounds which requires us not</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to add a potentially UB introducing use.  We need to either a) show</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the loop test we&#39;re modifying is already in post-inc form, or b) show</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that adding a use must not introduce UB.</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SafeToPostInc =</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">        IndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">        <a href="#a23d78b7d4dbea0ecc84dc55313ad1f25">isLoopExitTestBasedOn</a>(IncVar, ExitingBB) ||</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a023f82db84f5e5ed13398308496689e7">mustExecuteUBIfPoisonOnPathTo</a>(IncVar, ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), DT);</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SafeToPostInc) &#123;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">      UsePostInc = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">      CmpIndVar = IncVar;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It may be necessary to drop nowrap flags on the incrementing instruction</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if either LFTR moves from a pre-inc check to a post-inc check (in which</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case the increment might have previously been poison on the last iteration</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only) or if LFTR switches to a different IV that was previously dynamically</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dead (and as such may be arbitrarily poison). We remove any nowrap flags</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that SCEV didn&#39;t infer for the post-inc addrec (even if we use a pre-inc</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// check), because the pre-inc addrec flags may be adopted from the original</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction, while SCEV has to explicitly prove the post-inc nowrap flags.</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: This handling is inaccurate for one case: If we switch to a</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dynamically dead IV that wraps on the first loop iteration only, which is</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not covered by the post-inc addrec. (If the new IV was not dynamically</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dead, it could not be poison on the first iteration in the first place.)</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(IncVar)) &#123;</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;getSCEV(IncVar));</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO-&gt;hasNoUnsignedWrap())</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">      BO-&gt;setHasNoUnsignedWrap(AR-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#a09cc70290a71475141063b6dff42a5d2">hasNoUnsignedWrap</a>());</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO-&gt;hasNoSignedWrap())</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">      BO-&gt;setHasNoSignedWrap(AR-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#a71deee7ef49ab5407b7e1aa758b6ec0a">hasNoSignedWrap</a>());</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExitCnt = <a href="#a14bc7872374f530d4ed193d9921825c5">genLoopLimit</a>(</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">      IndVar, ExitingBB, ExitCount, UsePostInc, L, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, SE);</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitCnt-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() ==</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">             IndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;genLoopLimit missed a cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert a new icmp&#95;ne or icmp&#95;eq instruction before the branch.</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)))</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(BI);</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The new loop exit condition should reuse the debug location of the</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// original loop exit condition.</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()))</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">    Builder.SetCurrentDebugLocation(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For integer IVs, if we evaluated the limit in the narrower bitwidth to</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// avoid the expensive expansion of the limit expression in the wider type,</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// emit a truncate to narrow the IV to the ExitCount type.  This is safe</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// since we know (from the exit count bitwidth), that we can&#39;t self-wrap in</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the narrower type.</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CmpIndVarSize = SE-&gt;getTypeSizeInBits(CmpIndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExitCntSize = SE-&gt;getTypeSizeInBits(ExitCnt-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CmpIndVarSize &gt; ExitCntSize) &#123;</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CmpIndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">           !ExitCnt-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>());</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Before resorting to actually inserting the truncate, use the same</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reasoning as from SimplifyIndvar::eliminateTrunc to see if we can extend</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the other side of the comparison instead.  We still evaluate the limit</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in the narrower bitwidth, we just prefer a zext/sext outside the loop to</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a truncate within in.</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefaf23578fcd2a868168854ab714e7de537">Extended</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = SE-&gt;getSCEV(CmpIndVar);</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TruncatedIV = SE-&gt;getTruncateExpr(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, ExitCnt-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ZExtTrunc =</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">      SE-&gt;getZeroExtendExpr(TruncatedIV, CmpIndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ZExtTrunc == <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>) &#123;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefaf23578fcd2a868168854ab714e7de537">Extended</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">      ExitCnt = Builder.CreateZExt(ExitCnt, IndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">                                   </span><span class="doxyHighlightStringLiteral">&quot;wide.trip.count&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;SExtTrunc =</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">        SE-&gt;getSignExtendExpr(TruncatedIV, CmpIndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SExtTrunc == <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>) &#123;</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefaf23578fcd2a868168854ab714e7de537">Extended</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">        ExitCnt = Builder.CreateSExt(ExitCnt, IndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">                                     </span><span class="doxyHighlightStringLiteral">&quot;wide.trip.count&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Extended) &#123;</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Discard;</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;makeLoopInvariant(ExitCnt, Discard);</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">      CmpIndVar = Builder.CreateTrunc(CmpIndVar, ExitCnt-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">                                      </span><span class="doxyHighlightStringLiteral">&quot;lftr.wideiv&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Rewriting loop exit condition to:\\n&quot;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      LHS:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;CmpIndVar &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;       op:\\t&quot;</span><span class="doxyHighlight"> &lt;&lt; (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> ? </span><span class="doxyHighlightStringLiteral">&quot;!=&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;==&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;      RHS:\\t&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ExitCnt &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;ExitCount:\\t&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ExitCount &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  was: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = Builder.CreateICmp(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, CmpIndVar, ExitCnt, </span><span class="doxyHighlightStringLiteral">&quot;exitcond&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s tempting to use replaceAllUsesWith here to fully replace the old</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// comparison, but that&#39;s not immediately safe, since users of the old</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// comparison may not be dominated by the new comparison. Instead, just</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// update the branch to use the new comparison; in the common case this</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will make old comparison dead.</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">  BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(OrigCond);</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">  ++NumLFTR;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlightComment">//  sinkUnusedInvariants. A late subpass to cleanup loop preheaders.</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlightComment">/// If there&#39;s a single exit block, sink any loop-invariant values that</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlightComment">/// were defined in the preheader but not used inside the loop into the</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlightComment">/// exit block to reduce register pressure in the loop.</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::sinkUnusedInvariants(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBlock = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getExitBlock();</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExitBlock) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Preheader) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeAnyChanges = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = ExitBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) &#123;</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">    --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// New instructions were inserted at the end of the preheader.</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t move instructions which might have side effects, since the side</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// effects need to complete before instructions inside the loop.  Also don&#39;t</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// move instructions which might read memory, since the loop may modify</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// memory. Note that it&#39;s okay if the instruction might have undefined</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// behavior: LoopSimplify guarantees that the preheader dominates the exit</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory())</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip debug info intrinsics.</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip eh pad instructions.</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isEHPad())</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t sink alloca: we never want to sink static alloca&#39;s out of the</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// entry block, and correctly sinking dynamic alloca&#39;s requires</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// checks for stacksave/stackrestore intrinsics.</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Refactor this check somehow?</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if there is a use in or before the loop (direct or</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// otherwise).</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsedInLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) &#123;</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UseBB = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent();</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i =</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/phinode/#aca414c43a6d42c13998208463637a20d">PHINode::getIncomingValueNumForOperand</a>(U.getOperandNo());</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">        UseBB = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;getIncomingBlock(i);</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseBB == Preheader || <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(UseBB)) &#123;</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">        UsedInLoop = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is, the def must remain in the preheader.</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedInLoop)</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, sink it to the exit block.</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ToMove = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a233737223c9a3dba810df5b91bc91d1fabbb9957d8adae962b153273c16bce571">Done</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) &#123;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip debug info intrinsics.</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">        --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isDebugOrPseudoInst() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isDebugOrPseudoInst() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a233737223c9a3dba810df5b91bc91d1fabbb9957d8adae962b153273c16bce571">Done</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a233737223c9a3dba810df5b91bc91d1fabbb9957d8adae962b153273c16bce571">Done</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">    MadeAnyChanges = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">    ToMove-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&#42;ExitBlock, InsertPt);</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    SE-&gt;forgetValue(ToMove);</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a233737223c9a3dba810df5b91bc91d1fabbb9957d8adae962b153273c16bce571">Done</a>) </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">    InsertPt = ToMove-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeAnyChanges;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178" lineLink="#a16b4faf9802df251058f89443ca35a6c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a16b4faf9802df251058f89443ca35a6c">replaceExitCond</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCond,</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DeadInsts) &#123;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Replacing condition of loop-exiting branch &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BI</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewCond &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(NewCond);</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldCond-&gt;use&#95;empty())</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">    DeadInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(OldCond);</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188" lineLink="#abba5b02b3dfb44e87915fcf6af38e3fb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="#abba5b02b3dfb44e87915fcf6af38e3fb">createFoldedExitCond</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB,</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsTaken) &#123;</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ExitIfTrue = !L-&gt;contains(&#42;<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(ExitingBB));</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstantInt::get(OldCond-&gt;getType(),</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">                          IsTaken ? ExitIfTrue : !ExitIfTrue);</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197" lineLink="#aa42477bdea230fb3cc4ea230c1125941"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#aa42477bdea230fb3cc4ea230c1125941">foldExit</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsTaken,</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DeadInsts) &#123;</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewCond = <a href="#abba5b02b3dfb44e87915fcf6af38e3fb">createFoldedExitCond</a>(L, ExitingBB, IsTaken);</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">  <a href="#a16b4faf9802df251058f89443ca35a6c">replaceExitCond</a>(BI, NewCond, DeadInsts);</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204" lineLink="#a649ac561acbab510055b0e8f48ca0617"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a649ac561acbab510055b0e8f48ca0617">replaceLoopPHINodesWithPreheaderValues</a>(</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DeadInsts,</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE) &#123;</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isLoopSimplifyForm() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should only do it in simplify form!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoopPreheader = L-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoopHeader = L-&gt;getHeader();</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;&gt;</a> Worklist;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PN : LoopHeader-&gt;phis()) &#123;</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreheaderIncoming = PN.<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(LoopPreheader);</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : PN.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">    SE.<a href="/docs/api/classes/llvm/scalarevolution/#a804545e5b568edec8b970da32cd37359">forgetValue</a>(&amp;PN);</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    PN.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(PreheaderIncoming);</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">    DeadInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(&amp;PN);</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replacing with the preheader value will often allow IV users to simplify</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (especially if the preheader value is a constant).</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 16&gt;</a> Visited;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>());</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t simplify instructions outside the loop.</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDataLayout());</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Res &amp;&amp; LI-&gt;<a href="/docs/api/classes/llvm/loopinfo/#ab12b535502b86394c84bfd24d58e4657">replacementPreservesLCSSAForm</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Res)) &#123;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users())</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Res);</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">      DeadInsts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243" lineLink="#a741f7bb1cc23d5c9d8917e1c7970c732"><span class="doxyHighlight"><a href="#a741f7bb1cc23d5c9d8917e1c7970c732">createInvariantCond</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB,</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/scalarevolution/loopinvariantpredicate">ScalarEvolution::LoopInvariantPredicate</a> &amp;LIP,</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>) &#123;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> InvariantPred = LIP.<a href="/docs/api/structs/llvm/scalarevolution/loopinvariantpredicate/#aed2a47d2a30f4899b0d6fe79d554fd4a">Pred</a>;</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = L-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Preheader doesn&#39;t exist&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.setInsertPoint(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LHSV = <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.expandCodeFor(LIP.<a href="/docs/api/structs/llvm/scalarevolution/loopinvariantpredicate/#a5323282e3d6c729af571683ea754c535">LHS</a>);</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RHSV = <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.expandCodeFor(LIP.<a href="/docs/api/structs/llvm/scalarevolution/loopinvariantpredicate/#a956e454e7abca6ff0409d5466cf0870b">RHS</a>);</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ExitIfTrue = !L-&gt;contains(&#42;<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(ExitingBB));</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitIfTrue)</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">    InvariantPred = <a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">ICmpInst::getInversePredicate</a>(InvariantPred);</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(InvariantPred, LHSV, RHSV,</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">                            BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;Value &#42;&gt;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262" lineLink="#a8160c4d5a8fc34f6085af951980dbaa6"><span class="doxyHighlight"><a href="#a8160c4d5a8fc34f6085af951980dbaa6">createReplacement</a>(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB,</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MaxIter, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Inverted, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipLastIter,</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>) &#123;</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = ICmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>();</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;LHS pred RHS&#39; should now mean that we stay in loop.</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inverted)</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">CmpInst::getInversePredicate</a>(Pred);</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LHSS = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a21d6ee82eed29080d911dbb548a8bb68">getSCEVAtScope</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, L);</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RHSS = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a21d6ee82eed29080d911dbb548a8bb68">getSCEVAtScope</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, L);</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can we prove it to be trivially true or false?</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EV = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a4bfb461a6adf8414747571a5f94a77fc">evaluatePredicateAt</a>(Pred, LHSS, RHSS, BI))</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#abba5b02b3dfb44e87915fcf6af38e3fb">createFoldedExitCond</a>(L, ExitingBB, </span><span class="doxyHighlightComment">/&#42;IsTaken&#42;/</span><span class="doxyHighlight"> !&#42;EV);</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ARTy = LHSS-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>();</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MaxIterTy = MaxIter-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>();</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If possible, adjust types.</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(ARTy) &gt; SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(MaxIterTy))</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">    MaxIter = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a6d745b25efdc69435508f1e936919f8b">getZeroExtendExpr</a>(MaxIter, ARTy);</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(ARTy) &lt; SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2c96114e89e8cf2122ebe8bc4d929c7c">getTypeSizeInBits</a>(MaxIterTy)) &#123;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MinusOne = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a8d5202095ab1b8b726dd1e9db728b997">getMinusOne</a>(ARTy);</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MaxAllowedIter = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a6d745b25efdc69435508f1e936919f8b">getZeroExtendExpr</a>(MinusOne, MaxIterTy);</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#aeaae2161ba70381e225ac6800af5d961">isKnownPredicateAt</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a>, MaxIter, MaxAllowedIter, BI))</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">      MaxIter = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a83c084b0947edf4ae748f9a73babf7b8">getTruncateExpr</a>(MaxIter, ARTy);</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SkipLastIter) &#123;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Semantically skip last iter is &quot;subtract 1, do not bother about unsigned</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// wrap&quot;. getLoopInvariantExitCondDuringFirstIterations knows how to deal</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with umin in a smart way, but umin(a, b) - 1 will likely not simplify.</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// So we manually construct umin(a - 1, b - 1).</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const SCEV &#42;, 4&gt;</a> Elements;</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">UMin</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVUMinExpr&gt;</a>(MaxIter)) &#123;</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">UMin</a>-&gt;operands())</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">        Elements.push&#95;back(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a8bcb86d8d126d95b0dc05f09e8f3df96">getMinusSCEV</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a3fbe8f529d36d76730550905d730a2a7">getOne</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType())));</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">      MaxIter = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a9aba96071c763c3233ab9f7cea03f395">getUMinFromMismatchedTypes</a>(Elements);</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">      MaxIter = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a8bcb86d8d126d95b0dc05f09e8f3df96">getMinusSCEV</a>(MaxIter, SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a3fbe8f529d36d76730550905d730a2a7">getOne</a>(MaxIter-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()));</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if there is a loop-invariant predicate equivalent to our check.</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LIP = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a1039aac093f6da8816c9dd415a711a20">getLoopInvariantExitCondDuringFirstIterations</a>(Pred, LHSS, RHSS,</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">                                                               L, BI, MaxIter);</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LIP)</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can we prove it to be trivially true?</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#aeaae2161ba70381e225ac6800af5d961">isKnownPredicateAt</a>(LIP-&gt;Pred, LIP-&gt;LHS, LIP-&gt;RHS, BI))</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#abba5b02b3dfb44e87915fcf6af38e3fb">createFoldedExitCond</a>(L, ExitingBB, </span><span class="doxyHighlightComment">/&#42;IsTaken&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a741f7bb1cc23d5c9d8917e1c7970c732">createInvariantCond</a>(L, ExitingBB, &#42;LIP, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319" lineLink="#a740a442f349b36821071c21e265e23e1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a740a442f349b36821071c21e265e23e1">optimizeLoopExitWithUnknownExitCount</a>(</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MaxIter,</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipLastIter, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>,</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DeadInsts) &#123;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">      (L-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) != L-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))) &amp;&amp;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Not a loop exit!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For branch that stays in loop by TRUE condition, go through AND. For branch</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that stays in loop by FALSE condition, go through OR. Both gives the</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// similar logic: &quot;stay in loop iff all conditions are true(false)&quot;.</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Inverted = L-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1));</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ICmpInst &#42;, 4&gt;</a> LeafConditions;</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> Worklist;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 4&gt;</a> Visited;</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;OldCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">  Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OldCond);</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OldCond);</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GoThrough = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inverted) &#123;</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))))</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))))</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>).second)</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>).second)</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Curr = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Go through AND/OR conditions. Collect leaf ICMPs. We only care about</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// those with one use, to avoid instruction duplication.</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Curr-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GoThrough(Curr))</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ICmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(Curr))</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">          LeafConditions.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ICmp);</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>());</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the current basic block has the same exit count as the whole loop, and</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it consists of multiple icmp&#39;s, try to collect all icmp&#39;s that give exact</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same exit count. For all other icmp&#39;s, we could use one less iteration,</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because their value on the last iteration doesn&#39;t really matter.</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;ICmpInst &#42;, 4&gt;</a> ICmpsFailingOnLastIter;</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SkipLastIter &amp;&amp; LeafConditions.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 1 &amp;&amp;</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">      SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#ab24add5df0874cdfa47b47b1d9926e9e">getExitCount</a>(L, ExitingBB,</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/scalarevolution/#ace535ba3b8cc110f49b5db48a945ecefa007c52805d507c0cc6d53cbea782eaf4">ScalarEvolution::ExitCountKind::SymbolicMaximum</a>) ==</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">          MaxIter)</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ICmp : LeafConditions) &#123;</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EL = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a26b05f5967d446ef422d44a79334542c">computeExitLimitFromCond</a>(L, ICmp, Inverted,</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">                                             </span><span class="doxyHighlightComment">/&#42;ControlsExit&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitMax = EL.SymbolicMaxNotTaken;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(ExitMax))</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// They could be of different types (specifically this happens after</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// IV widening).</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WiderType =</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">          SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a10cde7087f90dc664b6799814aa28584">getWiderType</a>(ExitMax-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>(), MaxIter-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>());</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideExitMax = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a933eb87303a6ce51c8894e431fbc389b">getNoopOrZeroExtend</a>(ExitMax, WiderType);</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideMaxIter = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a933eb87303a6ce51c8894e431fbc389b">getNoopOrZeroExtend</a>(MaxIter, WiderType);</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WideExitMax == WideMaxIter)</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">        ICmpsFailingOnLastIter.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ICmp);</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldCond : LeafConditions) &#123;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip last iteration for this icmp under one of two conditions:</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// - We do it for all conditions;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// - There is another ICmp that would fail on last iter, so this one doesn&#39;t</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// really matter.</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimisticSkipLastIter = SkipLastIter;</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OptimisticSkipLastIter) &#123;</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICmpsFailingOnLastIter.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() &gt; 1)</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">        OptimisticSkipLastIter = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICmpsFailingOnLastIter.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 1)</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">        OptimisticSkipLastIter = !ICmpsFailingOnLastIter.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OldCond);</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Replaced =</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">            <a href="#a8160c4d5a8fc34f6085af951980dbaa6">createReplacement</a>(OldCond, L, ExitingBB, MaxIter, Inverted,</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">                              OptimisticSkipLastIter, SE, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>)) &#123;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewCond = &#42;Replaced;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(NewCond)) &#123;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">        NCI-&gt;setName(OldCond-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.first&#95;iter&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Unknown exit count: Replacing &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OldCond</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewCond &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldCond-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must be!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">      OldCond-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewCond);</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">      DeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OldCond);</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure we no longer consider this condition as failing on last</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// iteration.</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">      ICmpsFailingOnLastIter.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(OldCond);</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::canonicalizeExitCondition(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: This is duplicating a particular part on SimplifyIndVars reasoning.</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to duplicate it because given icmp zext(small-iv), C, IVUsers</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// never reaches the icmp since the zext doesn&#39;t fold to an AddRec unless</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it already has flags.  The alternative to this would be to extending the</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// set of &quot;interesting&quot; IV users to include the icmp, but doing that</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// regresses results in practice by querying SCEVs before trip counts which</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// rely on them which results in SCEV caching sub-optimal answers.  The</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// concern about caching sub-optimal results is why we only query SCEVs of</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop invariant RHS here.</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 16&gt;</a> ExitingBlocks;</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getExitingBlocks(ExitingBlocks);</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitingBB : ExitingBlocks) &#123;</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI)</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;exit branch must be conditional&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ICmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ICmp || !ICmp-&gt;hasOneUse())</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = ICmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = ICmp-&gt;getOperand(1);</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For the range reasoning, avoid computing SCEVs in the loop to avoid</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// poisoning cache with sub-optimal results.  For the must-execute case,</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this is a neccessary precondition for correctness.</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)) &#123;</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Same logic applies for the inverse case</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Match (icmp signed-cond zext, RHS)</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHSOp = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(LHSOp))) || !ICmp-&gt;isSigned())</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InnerBitWidth = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(LHSOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OuterBitWidth = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType());</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FullCR = ConstantRange::getFull(InnerBitWidth);</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">    FullCR = FullCR.zeroExtend(OuterBitWidth);</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RHSCR = SE-&gt;getUnsignedRange(SE-&gt;applyLoopGuards(SE-&gt;getSCEV(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>), L));</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FullCR.contains(RHSCR)) &#123;</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We have now matched icmp signed-cond zext(X), zext(Y&#39;), and can thus</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// replace the signed condition with the unsigned version.</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">      ICmp-&gt;setPredicate(ICmp-&gt;getUnsignedPredicate());</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note: No SCEV invalidation needed.  We&#39;ve changed the predicate, but</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// have not changed exit counts, or the values produced by the compare.</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we&#39;ve canonicalized the condition to match the extend,</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// see if we can rotate the extend out of the loop.</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitingBB : ExitingBlocks) &#123;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI)</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;exit branch must be conditional&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ICmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ICmp || !ICmp-&gt;hasOneUse() || !ICmp-&gt;isUnsigned())</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Swapped = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = ICmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = ICmp-&gt;getOperand(1);</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) == <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Nothing to rotate</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>)) &#123;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Same logic applies for the inverse case until we actually pick</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// which operand of the compare to update.</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">      Swapped = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>));</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Match (icmp unsigned-cond zext, RHS)</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Extend to handle corresponding sext/signed-cmp case</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Extend to other invertible functions</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHSOp = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(LHSOp))))</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In general, we only rotate if we can do so without increasing the number</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of instructions.  The exception is when we have an zext(add-rec).  The</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reason for allowing this exception is that we know we need to get rid</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the zext for SCEV to be able to compute a trip count for said loops;</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we consider the new trip count valuable enough to increase instruction</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// count by one.</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;hasOneUse() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;getSCEV(LHSOp)))</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Given a icmp unsigned-cond zext(Op) where zext(trunc(RHS)) == RHS</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// replace with an icmp of the form icmp unsigned-cond Op, trunc(RHS)</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// when zext is loop varying and RHS is loop invariant.  This converts</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop varying work to loop-invariant work.</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> doRotateTransform = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ICmp-&gt;isUnsigned() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;must have proven unsigned already&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewRHS = <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">          Instruction::Trunc, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, LHSOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopPreheader()-&gt;getTerminator()-&gt;getIterator());</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">      ICmp-&gt;setOperand(Swapped ? 1 : 0, LHSOp);</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">      ICmp-&gt;setOperand(Swapped ? 0 : 1, NewRHS);</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Samesign flag cannot be preserved after narrowing the compare.</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">      ICmp-&gt;setSameSign(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;use&#95;empty())</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">        DeadInsts.push&#95;back(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InnerBitWidth = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(LHSOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OuterBitWidth = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType());</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FullCR = ConstantRange::getFull(InnerBitWidth);</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">    FullCR = FullCR.zeroExtend(OuterBitWidth);</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RHSCR = SE-&gt;getUnsignedRange(SE-&gt;applyLoopGuards(SE-&gt;getSCEV(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>), L));</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FullCR.contains(RHSCR)) &#123;</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">      doRotateTransform();</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note, we are leaving SCEV in an unfortunately imprecise case here</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// as rotation tends to reveal information about trip counts not</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// previously visible.</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::optimizeLoopExits(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>) &#123;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 16&gt;</a> ExitingBlocks;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getExitingBlocks(ExitingBlocks);</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove all exits which aren&#39;t both rewriteable and execute on every</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iteration.</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(ExitingBlocks, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB) &#123;</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If our exitting block exits multiple loops, we can only rewrite the</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// innermost one.  Otherwise, we&#39;re changing how many times the innermost</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop runs before it exits.</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(ExitingBB) != L)</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t rewrite non-branch yet.</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI)</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Likewise, the loop latch must be dominated by the exiting BB.</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;dominates(ExitingBB, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch()))</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>())) &#123;</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If already constant, nothing to do. However, if this is an</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// unconditional exit, we can still replace header phis with their</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// preheader value.</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(CI-&gt;isNullValue())))</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">        <a href="#a649ac561acbab510055b0e8f48ca0617">replaceLoopPHINodesWithPreheaderValues</a>(LI, L, DeadInsts, &#42;SE);</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitingBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get a symbolic upper bound on the loop backedge taken count.</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MaxBECount = SE-&gt;getSymbolicMaxBackedgeTakenCount(L);</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(MaxBECount))</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Visit our exit blocks in order of dominance. We know from the fact that</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all exits must dominate the latch, so there is a total dominance order</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// between them.</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(ExitingBlocks, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">               </span><span class="doxyHighlightComment">// std::sort sorts in ascending order, so we want the inverse of</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">               </span><span class="doxyHighlightComment">// the normal dominance relation.</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">               </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">               </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT-&gt;properlyDominates(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">               </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;properlyDominates(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &amp;&amp;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">                        </span><span class="doxyHighlightStringLiteral">&quot;expected total dominance order!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">               &#125;</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlightPreprocessor">#ifdef ASSERT</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1; i &lt; ExitingBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); i++) &#123;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;dominates(ExitingBlocks&#91;i-1&#93;, ExitingBlocks&#91;i&#93;));</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipLastIter = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;CurrMaxExit = SE-&gt;getCouldNotCompute();</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UpdateSkipLastIter = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MaxExitCount) &#123;</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SkipLastIter || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(MaxExitCount))</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(CurrMaxExit))</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">      CurrMaxExit = MaxExitCount;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">      CurrMaxExit = SE-&gt;getUMinFromMismatchedTypes(CurrMaxExit, MaxExitCount);</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the loop has more than 1 iteration, all further checks will be</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// executed 1 iteration less.</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrMaxExit == MaxBECount)</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">      SkipLastIter = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;const SCEV &#42;, 8&gt;</a> DominatingExactExitCounts;</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB : ExitingBlocks) &#123;</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExactExitCount = SE-&gt;getExitCount(L, ExitingBB);</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MaxExitCount = SE-&gt;getExitCount(</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">        L, ExitingBB, <a href="/docs/api/classes/llvm/scalarevolution/#ace535ba3b8cc110f49b5db48a945ecefa007c52805d507c0cc6d53cbea782eaf4">ScalarEvolution::ExitCountKind::SymbolicMaximum</a>);</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(ExactExitCount)) &#123;</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Okay, we do not know the exit count here. Can we at least prove that it</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// will remain the same within iteration space?</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> OptimizeCond = &#91;&amp;&#93;(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipLastIter) &#123;</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a740a442f349b36821071c21e265e23e1">optimizeLoopExitWithUnknownExitCount</a>(L, BI, ExitingBB,</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">                                                    MaxBECount, SkipLastIter,</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">                                                    SE, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, DeadInsts);</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: We might have proved that we can skip the last iteration for</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this check. In this case, we only want to check the condition on the</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// pre-last iteration (MaxBECount - 1). However, there is a nasty</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// corner case:</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   for (i = len; i != 0; i--) &#123; ... check (i ult X) ... &#125;</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we could not prove that len != 0, then we also could not prove that</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (len - 1) is not a UINT&#95;MAX. If we simply query (len - 1), then</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// OptimizeCond will likely not prove anything for it, even if it could</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// prove the same fact for len.</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// As a temporary solution, we query both last and pre-last iterations in</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// hope that we will be able to prove triviality for at least one of</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// them. We can stop querying MaxBECount for this case once SCEV</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// understands that (MaxBECount - 1) will not overflow here.</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OptimizeCond(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SkipLastIter &amp;&amp; OptimizeCond(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">      UpdateSkipLastIter(MaxExitCount);</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">    UpdateSkipLastIter(ExactExitCount);</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we know we&#39;d exit on the first iteration, rewrite the exit to</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reflect this.  This does not imply the loop must exit through this</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exit; there may be an earlier one taken on the first iteration.</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We know that the backedge can&#39;t be taken, so we replace all</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the header PHIs with values coming from the preheader.</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExactExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>()) &#123;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">      <a href="#aa42477bdea230fb3cc4ea230c1125941">foldExit</a>(L, ExitingBB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, DeadInsts);</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">      <a href="#a649ac561acbab510055b0e8f48ca0617">replaceLoopPHINodesWithPreheaderValues</a>(LI, L, DeadInsts, &#42;SE);</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExactExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">           MaxBECount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Exit counts must be integers&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;WiderType =</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">        SE-&gt;getWiderType(MaxBECount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>(), ExactExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>());</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">    ExactExitCount = SE-&gt;getNoopOrZeroExtend(ExactExitCount, WiderType);</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">    MaxBECount = SE-&gt;getNoopOrZeroExtend(MaxBECount, WiderType);</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MaxBECount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>() == ExactExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>());</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can we prove that some other exit must be taken strictly before this</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// one?</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;isLoopEntryGuardedByCond(L, <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">CmpInst::ICMP&#95;ULT</a>, MaxBECount,</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">                                     ExactExitCount)) &#123;</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">      <a href="#aa42477bdea230fb3cc4ea230c1125941">foldExit</a>(L, ExitingBB, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, DeadInsts);</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// As we run, keep track of which exit counts we&#39;ve encountered.  If we</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// find a duplicate, we&#39;ve found an exit which would have exited on the</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exiting iteration, but (from the visit order) strictly follows another</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which does the same and is thus dead.</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DominatingExactExitCounts.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(ExactExitCount).second) &#123;</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">      <a href="#aa42477bdea230fb3cc4ea230c1125941">foldExit</a>(L, ExitingBB, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, DeadInsts);</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: There might be another oppurtunity to leverage SCEV&#39;s reasoning</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// here.  If we kept track of the min of dominanting exits so far, we could</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// discharge exits with EC &gt;= MDEC. This is less powerful than the existing</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// transform (since later exits aren&#39;t considered), but potentially more</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// powerful for any case where SCEV can prove a &gt;=u b, but neither a == b</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or a &gt;u b.  Such a case is not currently known.</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IndVarSimplify::predicateLoopExits(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>) &#123;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 16&gt;</a> ExitingBlocks;</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getExitingBlocks(ExitingBlocks);</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, see if we can rewrite our exit conditions into a loop invariant</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// form. If we have a read-only loop, and we can tell that we must exit down</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a path which does not need any of the values computed within the loop, we</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can rewrite the loop to exit on the first iteration.  Note that this</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// doesn&#39;t either a) tell us the loop exits on the first iteration (unless</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#42;all&#42; exits are predicateable) or b) tell us &#42;which&#42; exit might be taken.</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This transformation looks a lot like a restricted form of dead loop</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// elimination, but restricted to read-only loops and without neccesssarily</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// needing to kill the loop entirely.</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#afd24bd142b192aff5be237d10c2c4691">LoopPredication</a>)</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: ExactBTC is the exact backedge taken count &#42;iff&#42; the loop exits</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// through &#42;explicit&#42; control flow.  We have to eliminate the possibility of</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// implicit exits (see below) before we know it&#39;s truly exact.</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExactBTC = SE-&gt;getBackedgeTakenCount(L);</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(ExactBTC) || !<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.isSafeToExpand(ExactBTC))</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE-&gt;isLoopInvariant(ExactBTC, L) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;BTC must be loop invariant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExactBTC-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;BTC must be integer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BadExit = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB) &#123;</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If our exiting block exits multiple loops, we can only rewrite the</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// innermost one.  Otherwise, we&#39;re changing how many times the innermost</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop runs before it exits.</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(ExitingBB) != L)</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t rewrite non-branch yet.</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI)</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If already constant, nothing to do.</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()))</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the exit block has phis, we need to be able to compute the values</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// within the loop which contains them.  This assumes trivially lcssa phis</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have already been removed; TODO: generalize</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBlock =</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) ? 1 : 0);</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExitBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>().empty())</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount = SE-&gt;getExitCount(L, ExitingBB);</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(ExitCount) ||</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">        !<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.isSafeToExpand(ExitCount))</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE-&gt;isLoopInvariant(ExitCount, L) &amp;&amp;</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Exit count must be loop invariant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Exit count must be integer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure all exits dominate the latch. This means there is a linear chain</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of exits. We check this before sorting so we have a total order.</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Latch = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopLatch();</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB : ExitingBlocks)</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;dominates(ExitingBB, Latch))</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have any exits which can&#39;t be predicated themselves, than we can&#39;t</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predicate any exit which isn&#39;t guaranteed to execute before it.  Consider</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// two exits (a) and (b) which would both exit on the same iteration.  If we</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can predicate (b), but not (a), and (a) preceeds (b) along some path, then</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we could convert a loop from exiting through (a) to one exiting through</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (b).  Note that this problem exists only for exits with the same exit</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// count, and we could be more aggressive when exit counts are known inequal.</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(ExitingBlocks, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// llvm::sort sorts in ascending order, so we want the inverse of</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the normal dominance relation.</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT-&gt;properlyDominates(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT-&gt;properlyDominates(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Should have total dominance order&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure our exit blocks are really a total order (i.e. a linear chain of</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exits before the backedge).</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1; i &lt; ExitingBlocks.size(); i++)</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;dominates(ExitingBlocks&#91;i - 1&#93;, ExitingBlocks&#91;i&#93;) &amp;&amp;</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Not sorted by dominance&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Given our sorted total order, we know that exit&#91;j&#93; must be evaluated</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// after all exit&#91;i&#93; such j &gt; i.</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = ExitingBlocks.size(); i &lt; e; i++)</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BadExit(ExitingBlocks&#91;i&#93;)) &#123;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">      ExitingBlocks.resize(i);</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitingBlocks.empty())</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point, ExitingBlocks consists of only those blocks which are</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predicatable.  Given that, we know we have at least one exit we can</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predicate if the loop is doesn&#39;t have side effects and doesn&#39;t have any</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// implicit exits (because then our exact BTC isn&#39;t actually exact).</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// @Reviewers - As structured, this is O(I^2) for loop nests.  Any</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// suggestions on how to improve this?  I can obviously bail out for outer</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loops, but that seems less than ideal.  MemorySSA can find memory writes,</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is that enough for &#42;all&#42; side effects?</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;blocks())</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO:isGuaranteedToTransfer</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayHaveSideEffects())</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, do the actual predication for all predicatable blocks.  A couple</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of notes here:</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1) We don&#39;t bother to constant fold dominated exits with identical exit</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    counts; that&#39;s simply a form of CSE/equality propagation and we leave</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    it for dedicated passes.</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2) We insert the comparison at the branch.  Hoisting introduces additional</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    legality constraints and we leave that to dedicated logic.  We want to</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    predicate even if we can&#39;t insert a loop invariant expression as</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    peeling or unrolling will likely reduce the cost of the otherwise loop</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    varying check.</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.setInsertPoint(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopPreheader()-&gt;getTerminator());</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopPreheader()-&gt;getTerminator());</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExactBTCV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Lazily generated if needed.</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB : ExitingBlocks) &#123;</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount = SE-&gt;getExitCount(L, ExitingBB);</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCond;</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitCount == ExactBTC) &#123;</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">      NewCond = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) ?</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getFalse() : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getTrue();</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ECV = <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.expandCodeFor(ExitCount);</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExactBTCV)</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">        ExactBTCV = <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.expandCodeFor(ExactBTC);</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = ExactBTCV;</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ECV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType()) &#123;</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;WiderTy = SE-&gt;getWiderType(ECV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType());</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">        ECV = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateZExt(ECV, WiderTy);</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateZExt(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, WiderTy);</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Pred = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;contains(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) ?</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>;</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">      NewCond = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateICmp(Pred, ECV, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OldCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(NewCond);</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldCond-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">      DeadInsts.emplace&#95;back(OldCond);</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">    RunUnswitching = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlightComment">//  IndVarSimplify driver. Manage several subpasses of IV simplification.</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898" lineLink="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify/#a145b6ea5ff08ca6373ed24389ca97c40"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-indvarsimplify-cpp-/indvarsimplify/#a145b6ea5ff08ca6373ed24389ca97c40">IndVarSimplify::run</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need (and expect!) the incoming loop to be in LCSSA.</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isRecursivelyLCSSAForm(&#42;DT, &#42;LI) &amp;&amp;</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;LCSSA required to run indvars!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If LoopSimplify form is not available, stay out of trouble. Some notes:</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  - LSR currently only supports LoopSimplify-form loops. Indvars&#39;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    canonicalization can be a pessimization without LSR to &quot;clean up&quot;</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    afterwards.</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  - We depend on having a preheader; in particular,</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    Loop::getCanonicalInductionVariable only supports loops with preheaders,</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    and we&#39;re in trouble if we can&#39;t find the induction variable even when</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    we&#39;ve manually inserted one.</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  - LFTR relies on having a single backedge.</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;isLoopSimplifyForm())</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are any floating-point recurrences, attempt to</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transform them to use integer recurrences.</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= rewriteNonIntegerIVs(L);</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a rewriter object which we&#39;ll use to transform the code with.</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>(&#42;SE, DL, </span><span class="doxyHighlightStringLiteral">&quot;indvars&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlightPreprocessor">#if LLVM&#95;ENABLE&#95;ABI&#95;BREAKING&#95;CHECKS</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.setDebugType(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>);</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eliminate redundant IV users.</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Simplification works best when run before other consumers of SCEV. We</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// attempt to avoid evaluating SCEVs for sign/zero extend operations until</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other expressions involving loop IVs have been evaluated. This helps SCEV</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// set no-wrap flags before normalizing sign/zero extension.</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.disableCanonicalMode();</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= simplifyAndExtend(L, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, LI);</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if we can compute the final value of any expressions</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that are recurrent in the loop, and substitute the exit values from the</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop into any instructions outside of the loop that use the final values</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the current expressions.</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a321d169dcb80429e5c3fdf455c4517ec">ReplaceExitValue</a> != <a href="/docs/api/namespaces/llvm/#ad711012ae6f56de75424c48f31538986a4f92864a2edbc4ee6aa6d5abcb995fdd">NeverRepl</a>) &#123;</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Rewrites = <a href="/docs/api/namespaces/llvm/#acb5b48f89efd60ea799bb09abc1971ba">rewriteLoopExitValues</a>(L, LI, TLI, SE, TTI, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, DT,</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">                                             <a href="#a321d169dcb80429e5c3fdf455c4517ec">ReplaceExitValue</a>, DeadInsts)) &#123;</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">      NumReplaced += Rewrites;</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eliminate redundant IV cycles.</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">  NumElimIV += <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.replaceCongruentIVs(L, DT, DeadInsts, TTI);</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to convert exit conditions to unsigned and rotate computation</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// out of the loop.  Note: Handles invalidation internally if needed.</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= canonicalizeExitCondition(L);</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to eliminate loop exits based on analyzeable exit counts</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (optimizeLoopExits(L, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>))  &#123;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Given we&#39;ve changed exit counts, notify SCEV</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Some nested loops may share same folded exit basic block,</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// thus we need to notify top most loop.</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">    SE-&gt;forgetTopmostLoop(L);</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to form loop invariant tests for loop exits by changing how many</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterations of the loop run when that is unobservable.</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (predicateLoopExits(L, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>)) &#123;</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Given we&#39;ve changed exit counts, notify SCEV</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">    SE-&gt;forgetLoop(L);</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have a trip count expression, rewrite the loop&#39;s exit condition</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// using it.</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a1fa311ace7bbfa6e7713cf18baa65f8e">DisableLFTR</a>) &#123;</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PreHeader = L-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 16&gt;</a> ExitingBlocks;</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    L-&gt;getExitingBlocks(ExitingBlocks);</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB : ExitingBlocks) &#123;</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Can&#39;t rewrite non-branch yet.</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(ExitingBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If our exitting block exits multiple loops, we can only rewrite the</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// innermost one.  Otherwise, we&#39;re changing how many times the innermost</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// loop runs before it exits.</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;getLoopFor(ExitingBB) != L)</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a6a2f2b3d9153487f51dae119c07f8461">needsLFTR</a>(L, ExitingBB))</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount = SE-&gt;getExitCount(L, ExitingBB);</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(ExitCount))</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This was handled above, but as we form SCEVs, we can sometimes refine</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// existing ones; this allows exit counts to be folded to zero which</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// weren&#39;t when optimizeLoopExits saw them.  Arguably, we should iterate</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// until stable to handle cases like this better.</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitCount-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>())</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IndVar = <a href="#adc183a6edc37f305ee9ca5ff0bc33a6e">FindLoopCounter</a>(L, ExitingBB, ExitCount, SE, DT);</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IndVar)</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Avoid high cost expansions.  Note: This heuristic is questionable in</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// that our definition of &quot;high cost&quot; is not exactly principled.</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.isHighCostExpansion(ExitCount, L, <a href="/docs/api/namespaces/llvm/#a837209d51e75f7afcfdf457b20e59493">SCEVCheapExpansionBudget</a>,</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">                                       TTI, PreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.isSafeToExpand(ExitCount))</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= linearFunctionTestReplace(L, ExitingBB,</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">                                           ExitCount, IndVar,</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">                                           <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clear the rewriter cache, because values that are in the rewriter&#39;s cache</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can be deleted in the loop below, causing the AssertingVH in the cache to</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trigger.</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.clear();</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we&#39;re done iterating through lists, clean up any instructions</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which are now dead.</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!DeadInsts.empty()) &#123;</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = DeadInsts.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;PHINode&gt;</a>(V))</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#ad3cf19784335900227e275fd488e4727">RecursivelyDeleteDeadPHINode</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, TLI, MSSAU.get());</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(V))</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |=</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Inst, TLI, MSSAU.get());</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The Rewriter may not be used from this point on.</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop-invariant instructions in the preheader that aren&#39;t used in the</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop may be sunk below the loop to reduce register pressure.</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= sinkUnusedInvariants(L);</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// rewriteFirstIterationLoopExitValues does not rely on the computation of</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trip count and therefore can further simplify exit values in addition to</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// rewriteLoopExitValues.</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= rewriteFirstIterationLoopExitValues(L);</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clean up dead instructions.</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#a64ecdacbd49f696216e772782a109945">DeleteDeadPHIs</a>(L-&gt;getHeader(), TLI, MSSAU.get());</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check a post-condition.</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isRecursivelyLCSSAForm(&#42;DT, &#42;LI) &amp;&amp;</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Indvars did not preserve LCSSA!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a> &amp;&amp; MSSAU)</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">    MSSAU-&gt;getMemorySSA()-&gt;verifyMemorySSA();</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061" lineLink="/docs/api/classes/llvm/indvarsimplifypass/#a00bd6521a4f23d764d5d1403e7728e8f"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/indvarsimplifypass/#a00bd6521a4f23d764d5d1403e7728e8f">IndVarSimplifyPass::run</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/namespaces/llvm/#a58dde534a0ea2a23cb6c779c5c283f75">LoopAnalysisManager</a> &amp;AM,</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">                                          <a href="/docs/api/structs/llvm/loopstandardanalysisresults">LoopStandardAnalysisResults</a> &amp;AR,</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/lpmupdater">LPMUpdater</a> &amp;) &#123;</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = L.getHeader()-&gt;getParent();</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout();</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">  IndVarSimplify IVS(&amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aa09379aa4435be95eb717dd9b5d8b4c5">LI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a124376878e24aef4252795ba9fea420f">SE</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aaa96df870a1b3d7ffc56bec3eb0b0cff">DT</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a9e363c1eaf112166372e2d52704981fb">TLI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a3444a9359f5f17f1694f82c41d5fd574">TTI</a>, AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>,</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">                     WidenIndVars &amp;&amp; <a href="#aea2c111bf1f82fd672acaad1931e7e2d">AllowIVWidening</a>);</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IVS.run(&amp;L))</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PA = <a href="/docs/api/namespaces/llvm/#ac7294ba4e105807674fe3a394437fcc1">getLoopPassPreservedAnalyses</a>();</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">  PA.preserveSet&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVS.runUnswitching()) &#123;</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">    AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/structs/llvm/shouldrunextrasimpleloopunswitch">ShouldRunExtraSimpleLoopUnswitch</a>&gt;(L, AR);</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">    PA.preserve&lt;<a href="/docs/api/structs/llvm/shouldrunextrasimpleloopunswitch">ShouldRunExtraSimpleLoopUnswitch</a>&gt;();</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>)</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">    PA.preserve&lt;<a href="/docs/api/classes/llvm/memoryssaanalysis">MemorySSAAnalysis</a>&gt;();</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
