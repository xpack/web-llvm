---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/utils/callpromotionutils-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `CallPromotionUtils.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Utils/CallPromotionUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/callpromotionutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CtxProfAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/ctxprofanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/Loads.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TypeMetadataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/typemetadatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/AttributeMask.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributemask-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ProfileData/PGOCtxProfReader.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/profiledata/pgoctxprofreader-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
</IncludesList>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a8c9ae0be5e6bcad90cdf141962a117f3">createRetBitCast</a> (CallBase &amp;CB, Type &#42;RetTy, CastInst &#42;&#42;RetBitCast)</>}>
Cast a call or invoke instruction to the given type. <a href="#a8c9ae0be5e6bcad90cdf141962a117f3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#abdf3ba57973320bd702d3b12b0b8fa8c">createRetPHINode</a> (Instruction &#42;OrigInst, Instruction &#42;NewInst, BasicBlock &#42;MergeBlock, IRBuilder&lt;&gt; &amp;Builder)</>}>
Create a phi node for the returned value of a call or invoke instruction. <a href="#abdf3ba57973320bd702d3b12b0b8fa8c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a51ff57d75f102e980e39535df6ff00bb">fixupPHINodeForNormalDest</a> (InvokeInst &#42;Invoke, BasicBlock &#42;OrigBlock, BasicBlock &#42;MergeBlock)</>}>
Fix-up phi nodes in an invoke instruction&#39;s normal destination. <a href="#a51ff57d75f102e980e39535df6ff00bb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a59b92d3bbd9b21b61a2afbb73c10c3b0">fixupPHINodeForUnwindDest</a> (InvokeInst &#42;Invoke, BasicBlock &#42;OrigBlock, BasicBlock &#42;ThenBlock, BasicBlock &#42;ElseBlock)</>}>
Fix-up phi nodes in an invoke instruction&#39;s unwind destination. <a href="#a59b92d3bbd9b21b61a2afbb73c10c3b0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;</>}
  name={<><a href="#aaabc735841282ccafdf43b7c165b030e">versionCallSiteWithCond</a> (CallBase &amp;CB, Value &#42;Cond, MDNode &#42;BranchWeights)</>}>
<a href="/docs/api/classes/predicate">Predicate</a> and clone the given call site. <a href="#aaabc735841282ccafdf43b7c165b030e">More...</a>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;call-promotion-utils&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### createRetBitCast() {#a8c9ae0be5e6bcad90cdf141962a117f3}

<MemberDefinition
  prototype={<>static void createRetBitCast (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/classes/llvm/type">Type</a> &#42; RetTy, <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;&#42; RetBitCast)</>}
  labels = {["static"]}>
Cast a call or invoke instruction to the given type.

When promoting a call site, the return type of the call site might not match that of the callee. If this is the case, we have to cast the returned value to the correct type. The location of the cast depends on if we have a call or invoke instruction.

For example, if the call instruction below requires a bitcast after promotion:

orig&#95;bb: t0 = call i32 @func() ...

The bitcast is placed after the call instruction:

orig&#95;bb: ; Uses of the original return value are replaced by uses of the bitcast. t0 = call i32 @func() t1 = bitcast i32 t0 to ... ...

A similar transformation is performed for invoke instructions. However, since invokes are terminating, a new block is created for the bitcast. For example, if the invoke instruction below requires a bitcast after promotion:

orig&#95;bb: t0 = invoke i32 @func() to label normal&#95;dst unwind label unwind&#95;dst

The edge between the original block and the invoke&#39;s normal destination is split, and the bitcast is placed there:

orig&#95;bb: t0 = invoke i32 @func() to label split&#95;bb unwind label unwind&#95;dst

split&#95;bb: ; Uses of the original return value are replaced by uses of the bitcast. t1 = bitcast i32 t0 to ... br label normal&#95;dst

Definition at line <a href="#l00168">168</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/callpromotionutils-cpp">CallPromotionUtils.cpp</a>.
</MemberDefinition>

### createRetPHINode() {#abdf3ba57973320bd702d3b12b0b8fa8c}

<MemberDefinition
  prototype={<>static void createRetPHINode (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; OrigInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; NewInst, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; MergeBlock, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder)</>}
  labels = {["static"]}>
Create a phi node for the returned value of a call or invoke instruction.

After versioning a call or invoke instruction that returns a value, we have to merge the value of the original and new instructions. We do this by creating a phi node and replacing uses of the original instruction with this phi node.

For example, if <code>OrigInst</code> is defined in &quot;else&#95;bb&quot; and <code>NewInst</code> is defined in &quot;then&#95;bb&quot;, we create the following phi node:

; Uses of the original instruction are replaced by uses of the phi node. t0 = phi i32 &#91; orig&#95;inst, else&#95;bb &#93;, &#91; new&#95;inst, then&#95;bb &#93;,

Definition at line <a href="#l00113">113</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/callpromotionutils-cpp">CallPromotionUtils.cpp</a>.
</MemberDefinition>

### fixupPHINodeForNormalDest() {#a51ff57d75f102e980e39535df6ff00bb}

<MemberDefinition
  prototype={<>static void fixupPHINodeForNormalDest (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42; Invoke, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; OrigBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; MergeBlock)</>}
  labels = {["static"]}>
Fix-up phi nodes in an invoke instruction&#39;s normal destination.

After versioning an invoke instruction, values coming from the original block will now be coming from the &quot;merge&quot; block. For example, in the code below:

then&#95;bb: t0 = invoke i32 ptr() to label merge&#95;bb unwind label unwind&#95;dst

else&#95;bb: t1 = invoke i32 ptr() to label merge&#95;bb unwind label unwind&#95;dst

merge&#95;bb: t2 = phi i32 &#91; t0, then&#95;bb &#93;, &#91; t1, else&#95;bb &#93; br normal&#95;dst

normal&#95;dst: t3 = phi i32 &#91; x, orig&#95;bb &#93;, ...

&quot;orig&#95;bb&quot; is no longer a predecessor of &quot;normal&#95;dst&quot;, so the phi nodes in &quot;normal&#95;dst&quot; must be fixed to refer to &quot;merge&#95;bb&quot;:

normal&#95;dst: t3 = phi i32 &#91; x, merge&#95;bb &#93;, ...

Definition at line <a href="#l00056">56</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/callpromotionutils-cpp">CallPromotionUtils.cpp</a>.
</MemberDefinition>

### fixupPHINodeForUnwindDest() {#a59b92d3bbd9b21b61a2afbb73c10c3b0}

<MemberDefinition
  prototype={<>static void fixupPHINodeForUnwindDest (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42; Invoke, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; OrigBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ThenBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ElseBlock)</>}
  labels = {["static"]}>
Fix-up phi nodes in an invoke instruction&#39;s unwind destination.

After versioning an invoke instruction, values coming from the original block will now be coming from either the &quot;then&quot; block or the &quot;else&quot; block. For example, in the code below:

then&#95;bb: t0 = invoke i32 ptr() to label merge&#95;bb unwind label unwind&#95;dst

else&#95;bb: t1 = invoke i32 ptr() to label merge&#95;bb unwind label unwind&#95;dst

unwind&#95;dst: t3 = phi i32 &#91; x, orig&#95;bb &#93;, ...

&quot;orig&#95;bb&quot; is no longer a predecessor of &quot;unwind&#95;dst&quot;, so the phi nodes in &quot;unwind&#95;dst&quot; must be fixed to refer to &quot;then&#95;bb&quot; and &quot;else&#95;bb&quot;:

unwind&#95;dst: t3 = phi i32 &#91; x, then&#95;bb &#93;, &#91; x, else&#95;bb &#93;, ...

Definition at line <a href="#l00087">87</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/callpromotionutils-cpp">CallPromotionUtils.cpp</a>.
</MemberDefinition>

### versionCallSiteWithCond() {#aaabc735841282ccafdf43b7c165b030e}

<MemberDefinition
  prototype={<>static CallBase &amp; versionCallSiteWithCond (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Cond, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; BranchWeights)</>}
  labels = {["static"]}>
<a href="/docs/api/classes/predicate">Predicate</a> and clone the given call site.

This function creates an if-then-else structure at the location of the call site. The &quot;if&quot; condition is specified by <code>Cond</code>. The original call site is moved into the &quot;else&quot; block, and a clone of the call site is placed in the &quot;then&quot; block. The cloned instruction is returned.

For example, the call instruction below:

orig&#95;bb: t0 = call i32 ptr() ...

Is replace by the following:

orig&#95;bb: cond = Cond br i1 cond, then&#95;bb, else&#95;bb

then&#95;bb: ; The clone of the original call instruction is placed in the &quot;then&quot; ; block. It is not yet promoted. t1 = call i32 ptr() br merge&#95;bb

else&#95;bb: ; The original call instruction is moved to the &quot;else&quot; block. t0 = call i32 ptr() br merge&#95;bb

merge&#95;bb: ; Uses of the original call instruction are replaced by uses of the phi ; node. t2 = phi i32 &#91; t0, else&#95;bb &#93;, &#91; t1, then&#95;bb &#93; ...

A similar transformation is performed for invoke instructions. However, since invokes are terminating, more work is required. For example, the invoke instruction below:

orig&#95;bb: t0 = invoke ptr() to label normal&#95;dst unwind label unwind&#95;dst

Is replace by the following:

orig&#95;bb: cond = Cond br i1 cond, then&#95;bb, else&#95;bb

then&#95;bb: ; The clone of the original invoke instruction is placed in the &quot;then&quot; ; block, and its normal destination is set to the &quot;merge&quot; block. It is ; not yet promoted. t1 = invoke i32 ptr() to label merge&#95;bb unwind label unwind&#95;dst

else&#95;bb: ; The original invoke instruction is moved into the &quot;else&quot; block, and ; its normal destination is set to the &quot;merge&quot; block. t0 = invoke i32 ptr() to label merge&#95;bb unwind label unwind&#95;dst

merge&#95;bb: ; Uses of the original invoke instruction are replaced by uses of the ; phi node, and the merge block branches to the normal destination. t2 = phi i32 &#91; t0, else&#95;bb &#93;, &#91; t1, then&#95;bb &#93; br normal&#95;dst

An indirect musttail call is processed slightly differently in that:
<ul>
<li>No merge block needed for the orginal and the cloned callsite, since either one ends the flow. No phi node is needed either.</li>
<li>The return statement following the original call site is duplicated too and placed immediately after the cloned call site per the IR convention.</li>
</ul>


For example, the musttail call instruction below:

orig&#95;bb: t0 = musttail call i32 ptr() ...

Is replaced by the following:

cond&#95;bb: cond = Cond br i1 cond, then&#95;bb, orig&#95;bb

then&#95;bb: ; The clone of the original call instruction is placed in the &quot;then&quot; ; block. It is not yet promoted. t1 = musttail call i32 ptr() ret t1

orig&#95;bb: ; The original call instruction stays in its original block. t0 = musttail call i32 ptr() ret t0

Definition at line <a href="#l00287">287</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/callpromotionutils-cpp">CallPromotionUtils.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;call-promotion-utils&quot;</>}>

Definition at line <a href="#l00029">29</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/callpromotionutils-cpp">CallPromotionUtils.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- CallPromotionUtils.cpp - Utilities for call promotion ----&#42;- C++ -&#42;-===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This file implements utilities useful for promoting indirect call sites to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// direct call sites.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/callpromotionutils-h">llvm/Transforms/Utils/CallPromotionUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/ctxprofanalysis-h">llvm/Analysis/CtxProfAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h">llvm/Analysis/Loads.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/typemetadatautils-h">llvm/Analysis/TypeMetadataUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributemask-h">llvm/IR/AttributeMask.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/profiledata/pgoctxprofreader-h">llvm/ProfileData/PGOCtxProfReader.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;call-promotion-utils&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="comment">/// Fix-up phi nodes in an invoke instruction&#39;s normal destination.</Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="comment">/// After versioning an invoke instruction, values coming from the original</Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="comment">/// block will now be coming from the &quot;merge&quot; block. For example, in the code</Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="comment">/// below:</Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="comment">///   then&#95;bb:</Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="comment">///     %t0 = invoke i32 %ptr() to label %merge&#95;bb unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="comment">///   else&#95;bb:</Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="comment">///     %t1 = invoke i32 %ptr() to label %merge&#95;bb unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="comment">///   merge&#95;bb:</Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="comment">///     %t2 = phi i32 &#91; %t0, %then&#95;bb &#93;, &#91; %t1, %else&#95;bb &#93;</Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="comment">///     br %normal&#95;dst</Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="comment">///   normal&#95;dst:</Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="comment">///     %t3 = phi i32 &#91; %x, %orig&#95;bb &#93;, ...</Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="comment">/// &quot;orig&#95;bb&quot; is no longer a predecessor of &quot;normal&#95;dst&quot;, so the phi nodes in</Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="comment">/// &quot;normal&#95;dst&quot; must be fixed to refer to &quot;merge&#95;bb&quot;:</Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="comment">///    normal&#95;dst:</Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="comment">///      %t3 = phi i32 &#91; %x, %merge&#95;bb &#93;, ...</Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56" lineLink="#a51ff57d75f102e980e39535df6ff00bb"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a51ff57d75f102e980e39535df6ff00bb">fixupPHINodeForNormalDest</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;Invoke, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigBlock,</Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MergeBlock) &#123;</Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : Invoke-&gt;<a href="/docs/api/classes/llvm/invokeinst/#abefe36dd5104481a69ddd11d409abc10">getNormalDest</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> Idx = Phi.getBasicBlockIndex(OrigBlock);</Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Idx == -1)</Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal">    Phi.setIncomingBlock(Idx, MergeBlock);</Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="comment">/// Fix-up phi nodes in an invoke instruction&#39;s unwind destination.</Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="comment">/// After versioning an invoke instruction, values coming from the original</Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="comment">/// block will now be coming from either the &quot;then&quot; block or the &quot;else&quot; block.</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="comment">/// For example, in the code below:</Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="comment">///   then&#95;bb:</Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="comment">///     %t0 = invoke i32 %ptr() to label %merge&#95;bb unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="comment">///   else&#95;bb:</Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="comment">///     %t1 = invoke i32 %ptr() to label %merge&#95;bb unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="comment">///   unwind&#95;dst:</Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="comment">///     %t3 = phi i32 &#91; %x, %orig&#95;bb &#93;, ...</Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="comment">/// &quot;orig&#95;bb&quot; is no longer a predecessor of &quot;unwind&#95;dst&quot;, so the phi nodes in</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="comment">/// &quot;unwind&#95;dst&quot; must be fixed to refer to &quot;then&#95;bb&quot; and &quot;else&#95;bb&quot;:</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="comment">///   unwind&#95;dst:</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="comment">///     %t3 = phi i32 &#91; %x, %then&#95;bb &#93;, &#91; %x, %else&#95;bb &#93;, ...</Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="#a59b92d3bbd9b21b61a2afbb73c10c3b0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a59b92d3bbd9b21b61a2afbb73c10c3b0">fixupPHINodeForUnwindDest</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;Invoke, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigBlock,</Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBlock,</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ElseBlock) &#123;</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : Invoke-&gt;<a href="/docs/api/classes/llvm/invokeinst/#a07cd85c19a9298b5a4fe2abbe29472aa">getUnwindDest</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> Idx = Phi.getBasicBlockIndex(OrigBlock);</Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Idx == -1)</Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V = Phi.getIncomingValue(Idx);</Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal">    Phi.setIncomingBlock(Idx, ThenBlock);</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal">    Phi.addIncoming(V, ElseBlock);</Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="comment">/// Create a phi node for the returned value of a call or invoke instruction.</Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="comment">/// After versioning a call or invoke instruction that returns a value, we have</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="comment">/// to merge the value of the original and new instructions. We do this by</Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="comment">/// creating a phi node and replacing uses of the original instruction with this</Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="comment">/// phi node.</Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="comment">/// For example, if \\p OrigInst is defined in &quot;else&#95;bb&quot; and \\p NewInst is</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="comment">/// defined in &quot;then&#95;bb&quot;, we create the following phi node:</Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="comment">///   ; Uses of the original instruction are replaced by uses of the phi node.</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="comment">///   %t0 = phi i32 &#91; %orig&#95;inst, %else&#95;bb &#93;, &#91; %new&#95;inst, %then&#95;bb &#93;,</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="#abdf3ba57973320bd702d3b12b0b8fa8c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#abdf3ba57973320bd702d3b12b0b8fa8c">createRetPHINode</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OrigInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewInst,</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MergeBlock, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() || OrigInst-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(MergeBlock, MergeBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(OrigInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0);</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;User &#42;, 16&gt;</a> UsersToUpdate(OrigInst-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>());</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : UsersToUpdate)</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal">    U-&gt;replaceUsesOfWith(OrigInst, Phi);</Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">  Phi-&gt;addIncoming(OrigInst, OrigInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">  Phi-&gt;addIncoming(NewInst, NewInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="comment">/// Cast a call or invoke instruction to the given type.</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="comment">/// When promoting a call site, the return type of the call site might not match</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="comment">/// that of the callee. If this is the case, we have to cast the returned value</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="comment">/// to the correct type. The location of the cast depends on if we have a call</Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="comment">/// or invoke instruction.</Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="comment">/// For example, if the call instruction below requires a bitcast after</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="comment">/// promotion:</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="comment">///     %t0 = call i32 @func()</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="comment">///     ...</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="comment">/// The bitcast is placed after the call instruction:</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="comment">///     ; Uses of the original return value are replaced by uses of the bitcast.</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="comment">///     %t0 = call i32 @func()</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="comment">///     %t1 = bitcast i32 %t0 to ...</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="comment">///     ...</Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="comment">/// A similar transformation is performed for invoke instructions. However,</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="comment">/// since invokes are terminating, a new block is created for the bitcast. For</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="comment">/// example, if the invoke instruction below requires a bitcast after promotion:</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="comment">///     %t0 = invoke i32 @func() to label %normal&#95;dst unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="comment">/// The edge between the original block and the invoke&#39;s normal destination is</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="comment">/// split, and the bitcast is placed there:</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="comment">///     %t0 = invoke i32 @func() to label %split&#95;bb unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="comment">///   split&#95;bb:</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="comment">///     ; Uses of the original return value are replaced by uses of the bitcast.</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="comment">///     %t1 = bitcast i32 %t0 to ...</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="comment">///     br label %normal&#95;dst</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168" lineLink="#a8c9ae0be5e6bcad90cdf141962a117f3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8c9ae0be5e6bcad90cdf141962a117f3">createRetBitCast</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy, <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;&#42;RetBitCast) &#123;</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Save the users of the calling instruction. These uses will be changed to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// use the bitcast after we create it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;User &#42;, 16&gt;</a> UsersToUpdate(CB.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>());</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine an appropriate location to create the bitcast for the return</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value. The location depends on if we have a call or invoke instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertBefore;</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Invoke = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(&amp;CB))</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">    InsertBefore =</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#adf83581f514774264d616eef5706cf6e">SplitEdge</a>(Invoke-&gt;getParent(), Invoke-&gt;getNormalDest())-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">    InsertBefore = std::next(CB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bitcast the return value to the correct type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cast = <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(&amp;CB, RetTy, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, InsertBefore);</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RetBitCast)</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">    &#42;RetBitCast = Cast;</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace all the original uses of the calling instruction with the bitcast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : UsersToUpdate)</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">    U-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(&amp;CB, Cast);</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="comment">/// Predicate and clone the given call site.</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="comment">/// This function creates an if-then-else structure at the location of the call</Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="comment">/// site. The &quot;if&quot; condition is specified by &#96;Cond&#96;.</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="comment">/// The original call site is moved into the &quot;else&quot; block, and a clone of the</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="comment">/// call site is placed in the &quot;then&quot; block. The cloned instruction is returned.</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="comment">/// For example, the call instruction below:</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="comment">///     %t0 = call i32 %ptr()</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="comment">///     ...</Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="comment">/// Is replace by the following:</Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="comment">///     %cond = Cond</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="comment">///     br i1 %cond, %then&#95;bb, %else&#95;bb</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="comment">///   then&#95;bb:</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="comment">///     ; The clone of the original call instruction is placed in the &quot;then&quot;</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="comment">///     ; block. It is not yet promoted.</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="comment">///     %t1 = call i32 %ptr()</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="comment">///     br merge&#95;bb</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="comment">///   else&#95;bb:</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="comment">///     ; The original call instruction is moved to the &quot;else&quot; block.</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="comment">///     %t0 = call i32 %ptr()</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="comment">///     br merge&#95;bb</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="comment">///   merge&#95;bb:</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="comment">///     ; Uses of the original call instruction are replaced by uses of the phi</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="comment">///     ; node.</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="comment">///     %t2 = phi i32 &#91; %t0, %else&#95;bb &#93;, &#91; %t1, %then&#95;bb &#93;</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="comment">///     ...</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="comment">/// A similar transformation is performed for invoke instructions. However,</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="comment">/// since invokes are terminating, more work is required. For example, the</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="comment">/// invoke instruction below:</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="comment">///     %t0 = invoke %ptr() to label %normal&#95;dst unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="comment">/// Is replace by the following:</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="comment">///     %cond = Cond</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="comment">///     br i1 %cond, %then&#95;bb, %else&#95;bb</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="comment">///   then&#95;bb:</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="comment">///     ; The clone of the original invoke instruction is placed in the &quot;then&quot;</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="comment">///     ; block, and its normal destination is set to the &quot;merge&quot; block. It is</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="comment">///     ; not yet promoted.</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="comment">///     %t1 = invoke i32 %ptr() to label %merge&#95;bb unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="comment">///   else&#95;bb:</Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="comment">///     ; The original invoke instruction is moved into the &quot;else&quot; block, and</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="comment">///     ; its normal destination is set to the &quot;merge&quot; block.</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="comment">///     %t0 = invoke i32 %ptr() to label %merge&#95;bb unwind label %unwind&#95;dst</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="comment">///   merge&#95;bb:</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="comment">///     ; Uses of the original invoke instruction are replaced by uses of the</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="comment">///     ; phi node, and the merge block branches to the normal destination.</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="comment">///     %t2 = phi i32 &#91; %t0, %else&#95;bb &#93;, &#91; %t1, %then&#95;bb &#93;</Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="comment">///     br %normal&#95;dst</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="comment">/// An indirect musttail call is processed slightly differently in that:</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="comment">/// 1 No merge block needed for the orginal and the cloned callsite, since</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="comment">///    either one ends the flow. No phi node is needed either.</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="comment">/// 2 The return statement following the original call site is duplicated too</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="comment">///    and placed immediately after the cloned call site per the IR convention.</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="comment">/// For example, the musttail call instruction below:</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="comment">///     %t0 = musttail call i32 %ptr()</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="comment">///     ...</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="comment">/// Is replaced by the following:</Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="comment">///   cond&#95;bb:</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="comment">///     %cond = Cond</Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="comment">///     br i1 %cond, %then&#95;bb, %orig&#95;bb</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="comment">///   then&#95;bb:</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="comment">///     ; The clone of the original call instruction is placed in the &quot;then&quot;</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="comment">///     ; block. It is not yet promoted.</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="comment">///     %t1 = musttail call i32 %ptr()</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="comment">///     ret %t1</Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="comment">///   orig&#95;bb:</Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="comment">///     ; The original call instruction stays in its original block.</Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="comment">///     %t0 = musttail call i32 %ptr()</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="comment">///     ret %t0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287" lineLink="#aaabc735841282ccafdf43b7c165b030e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;<a href="#aaabc735841282ccafdf43b7c165b030e">versionCallSiteWithCond</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>,</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;BranchWeights) &#123;</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(&amp;CB);</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;OrigInst = &amp;CB;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigBlock = OrigInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigInst-&gt;<a href="/docs/api/classes/llvm/callbase/#a50426b12f4acb3d9f74d0778948e9597">isMustTailCall</a>()) &#123;</Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create an if-then structure. The original instruction stays in its block,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and a clone of the original instruction is placed in the &quot;then&quot; block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ThenTerm =</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ad957413955739c91204c96e33e0cc933">SplitBlockAndInsertIfThen</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &amp;CB, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, BranchWeights);</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBlock = ThenTerm-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">    ThenBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;if.true.direct&#95;targ&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;NewInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(OrigInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">    NewInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(ThenTerm-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Place a clone of the optional bitcast after the new call site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewRetVal = NewInst;</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a> = OrigInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>();</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BitCast = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;BitCastInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a>)) &#123;</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BitCast-&gt;getOperand(0) == OrigInst &amp;&amp;</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;bitcast following musttail call must use the call&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewBitCast = BitCast-&gt;clone();</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">      NewBitCast-&gt;replaceUsesOfWith(OrigInst, NewInst);</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">      NewBitCast-&gt;insertBefore(ThenTerm-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal">      NewRetVal = NewBitCast;</Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a> = BitCast-&gt;getNextNode();</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Place a clone of the return instruction after the new call site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;Ret = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ReturnInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a>);</Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ret &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;musttail call must precede a ret with an optional bitcast&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewRet = Ret-&gt;clone();</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ret-&gt;getReturnValue())</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">      NewRet-&gt;replaceUsesOfWith(Ret-&gt;getReturnValue(), NewRetVal);</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">    NewRet-&gt;insertBefore(ThenTerm-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A return instructions is terminating, so we don&#39;t need the terminator</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction just created.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">    ThenTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;NewInst;</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create an if-then-else structure. The original instruction is moved into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the &quot;else&quot; block, and a clone of the original instruction is placed in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &quot;then&quot; block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ThenTerm = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ElseTerm = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a7ac00229d8c59902686f52ed061cdc80">SplitBlockAndInsertIfThenElse</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &amp;CB, &amp;ThenTerm, &amp;ElseTerm, BranchWeights);</Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBlock = ThenTerm-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ElseBlock = ElseTerm-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MergeBlock = OrigInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">  ThenBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;if.true.direct&#95;targ&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal">  ElseBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;if.false.orig&#95;indirect&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">  MergeBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;if.end.icp&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;NewInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(OrigInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">  OrigInst-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(ElseTerm-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">  NewInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(ThenTerm-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the original call site is an invoke instruction, we have extra work to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// do since invoke instructions are terminating. We have to fix-up phi nodes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in the invoke&#39;s normal and unwind destinations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OrigInvoke = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(OrigInst)) &#123;</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewInvoke = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InvokeInst&gt;</a>(NewInst);</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Invoke instructions are terminating, so we don&#39;t need the terminator</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions that were just created.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">    ThenTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">    ElseTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Branch from the &quot;merge&quot; block to the original normal destination.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(MergeBlock);</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(OrigInvoke-&gt;getNormalDest());</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Fix-up phi nodes in the original invoke&#39;s normal and unwind destinations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">    <a href="#a51ff57d75f102e980e39535df6ff00bb">fixupPHINodeForNormalDest</a>(OrigInvoke, OrigBlock, MergeBlock);</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">    <a href="#a59b92d3bbd9b21b61a2afbb73c10c3b0">fixupPHINodeForUnwindDest</a>(OrigInvoke, MergeBlock, ThenBlock, ElseBlock);</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now set the normal destinations of the invoke instructions to be the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &quot;merge&quot; block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">    OrigInvoke-&gt;setNormalDest(MergeBlock);</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">    NewInvoke-&gt;setNormalDest(MergeBlock);</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a phi node for the returned value of the call site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">  <a href="#abdf3ba57973320bd702d3b12b0b8fa8c">createRetPHINode</a>(OrigInst, NewInst, MergeBlock, Builder);</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;NewInst;</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Predicate and clone the given call site using condition &#96;CB.callee ==</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Callee&#96;. See the comment &#96;versionCallSiteWithCond&#96; for the transformation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383" lineLink="/docs/api/namespaces/llvm/#a84163d559062da6b736ab943644e0a16"><Highlight kind="normal"><a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;<a href="/docs/api/namespaces/llvm/#a84163d559062da6b736ab943644e0a16">llvm::versionCallSite</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Callee,</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;BranchWeights) &#123;</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(&amp;CB);</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the compare. The called value and callee must have the same type to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be compared.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != Callee-&gt;getType())</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">    Callee = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Callee, CB.<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(CB.<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>(), Callee);</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#aaabc735841282ccafdf43b7c165b030e">versionCallSiteWithCond</a>(CB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, BranchWeights);</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397" lineLink="/docs/api/namespaces/llvm/#a0e5b9e42ea84622605acea0b0d721fda"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a0e5b9e42ea84622605acea0b0d721fda">llvm::isLegalToPromote</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee,</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> &#42;&#42;FailureReason) &#123;</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Only indirect call sites can be promoted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Callee-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the return type. The callee&#39;s return value type must be bitcast</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// compatible with the call site&#39;s type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CallRetTy = CB.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;FuncRetTy = Callee-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallRetTy != FuncRetTy)</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/castinst/#a94f850488e8bda1d1b400821d6d61bd1">CastInst::isBitOrNoopPointerCastable</a>(FuncRetTy, CallRetTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FailureReason)</Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">        &#42;FailureReason = </Highlight><Highlight kind="stringliteral">&quot;Return type mismatch&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The number of formal arguments of the callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumParams = Callee-&gt;getFunctionType()-&gt;getNumParams();</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The number of actual arguments in the call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumArgs = CB.<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>();</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the number of arguments. The callee and call site must agree on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// number of arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumArgs != NumParams &amp;&amp; !Callee-&gt;isVarArg()) &#123;</Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FailureReason)</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">      &#42;FailureReason = </Highlight><Highlight kind="stringliteral">&quot;The number of arguments mismatch&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the argument types. The callee&#39;s formal argument types must be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bitcast compatible with the corresponding actual argument types of the call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumParams; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure that the callee and call agree on byval/inalloca. The types do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// not have to match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Callee-&gt;hasParamAttribute(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ByVal) !=</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">        CB.<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>().hasParamAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ByVal)) &#123;</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FailureReason)</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">        &#42;FailureReason = </Highlight><Highlight kind="stringliteral">&quot;byval mismatch&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Callee-&gt;hasParamAttribute(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::InAlloca) !=</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">        CB.<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>().hasParamAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::InAlloca)) &#123;</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FailureReason)</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal">        &#42;FailureReason = </Highlight><Highlight kind="stringliteral">&quot;inalloca mismatch&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;FormalTy = Callee-&gt;getFunctionType()-&gt;getFunctionParamType(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ActualTy = CB.<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FormalTy == ActualTy)</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/castinst/#a94f850488e8bda1d1b400821d6d61bd1">CastInst::isBitOrNoopPointerCastable</a>(ActualTy, FormalTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FailureReason)</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal">        &#42;FailureReason = </Highlight><Highlight kind="stringliteral">&quot;Argument type mismatch&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// MustTail call needs stricter type match. See</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Verifier::verifyMustTailCall().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a50426b12f4acb3d9f74d0778948e9597">isMustTailCall</a>()) &#123;</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/pointertype">PointerType</a> &#42;PF = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PointerType&gt;</a>(FormalTy);</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/pointertype">PointerType</a> &#42;PA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PointerType&gt;</a>(ActualTy);</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PF || !PA || PF-&gt;<a href="/docs/api/classes/llvm/pointertype/#af8aeced5e71d2589fa3e9791043af5cb">getAddressSpace</a>() != PA-&gt;<a href="/docs/api/classes/llvm/pointertype/#af8aeced5e71d2589fa3e9791043af5cb">getAddressSpace</a>()) &#123;</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FailureReason)</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">          &#42;FailureReason = </Highlight><Highlight kind="stringliteral">&quot;Musttail call Argument type mismatch&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumArgs; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Vararg functions can have more arguments than parameters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Callee-&gt;isVarArg());</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a4cbb2344996abd4332716e76178ad4f4">paramHasAttr</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::StructRet)) &#123;</Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FailureReason)</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">        &#42;FailureReason = </Highlight><Highlight kind="stringliteral">&quot;SRet arg to vararg function&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483" lineLink="/docs/api/namespaces/llvm/#a90c1755a8480ebc1dcc4f05d56271b00"><Highlight kind="normal"><a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;<a href="/docs/api/namespaces/llvm/#a90c1755a8480ebc1dcc4f05d56271b00">llvm::promoteCall</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee,</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;&#42;RetBitCast) &#123;</Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Only indirect call sites can be promoted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set the called function of the call site to be the given callee (but don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// change the type).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">  CB.<a href="/docs/api/classes/llvm/callbase/#ad70fe60b7ed052c6a74863944b518251">setCalledOperand</a>(Callee);</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since the call site will no longer be direct, we must clear metadata that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is only appropriate for indirect calls. This includes !prof and !callees</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">  CB.<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;prof, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">  CB.<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;callees, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the function type of the call site matches that of the callee, no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// additional work is required.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#ac3c35bd078a268a207f607d0f57dadba">getFunctionType</a>() == Callee-&gt;getFunctionType())</Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CB;</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Save the return types of the call site and callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CallSiteRetTy = CB.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CalleeRetTy = Callee-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Change the function type of the call site the match that of the callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">  CB.<a href="/docs/api/classes/llvm/callbase/#aba272b7337f4e135f28eeb0bcc69adbb">mutateFunctionType</a>(Callee-&gt;getFunctionType());</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Inspect the arguments of the call site. If an argument&#39;s type doesn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// match the corresponding formal argument&#39;s type in the callee, bitcast it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the correct type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CalleeType = Callee-&gt;getFunctionType();</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CalleeParamNum = CalleeType-&gt;getNumParams();</Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = Callee-&gt;getContext();</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> AttributeList &amp;CallerPAL = CB.<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>();</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The new list of argument attributes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AttributeSet, 4&gt;</a> NewArgAttrs;</Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AttributeChanged = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgNo = 0; ArgNo &lt; CalleeParamNum; ++ArgNo) &#123;</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Arg = CB.<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(ArgNo);</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;FormalTy = CalleeType-&gt;getParamType(ArgNo);</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ActualTy = Arg-&gt;getType();</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FormalTy != ActualTy) &#123;</Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cast =</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(Arg, FormalTy, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, CB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal">      CB.<a href="/docs/api/classes/llvm/callbase/#abc10b887caad109288ffceb230493a85">setArgOperand</a>(ArgNo, Cast);</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Remove any incompatible attributes for the argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">      AttrBuilder ArgAttrs(Ctx, CallerPAL.getParamAttrs(ArgNo));</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">      ArgAttrs.remove(AttributeFuncs::typeIncompatible(</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">          FormalTy, CallerPAL.getParamAttrs(ArgNo)));</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We may have a different byval/inalloca type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ArgAttrs.getByValType())</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">        ArgAttrs.addByValAttr(Callee-&gt;getParamByValType(ArgNo));</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ArgAttrs.getInAllocaType())</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">        ArgAttrs.addInAllocaAttr(Callee-&gt;getParamInAllocaType(ArgNo));</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">      NewArgAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/attributeset/#ae8ed437b15a7ca943716e5284a9cb9a6">AttributeSet::get</a>(Ctx, ArgAttrs));</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">      AttributeChanged = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal">      NewArgAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CallerPAL.getParamAttrs(ArgNo));</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the return type of the call site doesn&#39;t match that of the callee, cast</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the returned value to the appropriate type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove any incompatible return value attribute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">  AttrBuilder RAttrs(Ctx, CallerPAL.getRetAttrs());</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CallSiteRetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp; CallSiteRetTy != CalleeRetTy) &#123;</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">    <a href="#a8c9ae0be5e6bcad90cdf141962a117f3">createRetBitCast</a>(CB, CallSiteRetTy, RetBitCast);</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">    RAttrs.remove(</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">        AttributeFuncs::typeIncompatible(CalleeRetTy, CallerPAL.getRetAttrs()));</Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">    AttributeChanged = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set the new callsite attribute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AttributeChanged)</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">    CB.<a href="/docs/api/classes/llvm/callbase/#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(AttributeList::get(Ctx, CallerPAL.getFnAttrs(),</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/attributeset/#ae8ed437b15a7ca943716e5284a9cb9a6">AttributeSet::get</a>(Ctx, RAttrs),</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">                                        NewArgAttrs));</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CB;</Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567" lineLink="/docs/api/namespaces/llvm/#a23c23396eb61a7a78555e926700dbf47"><Highlight kind="normal"><a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;<a href="/docs/api/namespaces/llvm/#a23c23396eb61a7a78555e926700dbf47">llvm::promoteCallWithIfThenElse</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee,</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;BranchWeights) &#123;</Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Version the indirect call site. If the called value is equal to the given</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// callee, &#39;NewInst&#39; will be executed, otherwise the original call site will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be executed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;NewInst = <a href="/docs/api/namespaces/llvm/#a84163d559062da6b736ab943644e0a16">versionCallSite</a>(CB, Callee, BranchWeights);</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Promote &#39;NewInst&#39; so that it directly calls the desired function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a90c1755a8480ebc1dcc4f05d56271b00">promoteCall</a>(NewInst, Callee);</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579" lineLink="/docs/api/namespaces/llvm/#a9469fd548994812c12e4c10d42ec82a3"><Highlight kind="normal"><a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/namespaces/llvm/#a23c23396eb61a7a78555e926700dbf47">llvm::promoteCallWithIfThenElse</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/function">Function</a> &amp;Callee,</Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/pgocontextualprofile">PGOContextualProfile</a> &amp;CtxProf) &#123;</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CB.<a href="/docs/api/classes/llvm/callbase/#a574efc7d85ff014d5f15e077f3c82e6b">isIndirectCall</a>());</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#af33a9e09888e910edab4b81d2b601f80">isFunctionKnown</a>(Callee))</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Caller = &#42;CB.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CSInstr = <a href="/docs/api/classes/llvm/ctxprofanalysis/#aa20d83f600303548f2e24aa2fc98e377">CtxProfAnalysis::getCallsiteInstrumentation</a>(CB);</Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CSInstr)</Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint64&#95;t CSIndex = CSInstr-&gt;getIndex()-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024caf8d0d4845b0b074d9f2e0f2ace6683da">DirectCall</a> = <a href="/docs/api/namespaces/llvm/#a90c1755a8480ebc1dcc4f05d56271b00">promoteCall</a>(</Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a84163d559062da6b736ab943644e0a16">versionCallSite</a>(CB, &amp;Callee, </Highlight><Highlight kind="comment">/&#42;BranchWeights=&#42;/</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">), &amp;Callee);</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">  CSInstr-&gt;moveBefore(CB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewCSID = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#ac3c5b4f301446a93ad24380ce9108e4e">allocateNextCallsiteIndex</a>(Caller);</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewCSInstr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InstrProfCallsite&gt;</a>(CSInstr-&gt;clone());</Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">  NewCSInstr-&gt;setIndex(NewCSID);</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">  NewCSInstr-&gt;setCallee(&amp;Callee);</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">  NewCSInstr-&gt;insertBefore(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024caf8d0d4845b0b074d9f2e0f2ace6683da">DirectCall</a>.getIterator());</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DirectBB = &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024caf8d0d4845b0b074d9f2e0f2ace6683da">DirectCall</a>.getParent();</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;IndirectBB = &#42;CB.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/ctxprofanalysis/#a3a31a6be1881280b30e349edabc9ca43">CtxProfAnalysis::getBBInstrumentation</a>(IndirectBB) == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &amp;&amp;</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;The ICP direct BB is new, it shouldn&#39;t have instrumentation&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/ctxprofanalysis/#a3a31a6be1881280b30e349edabc9ca43">CtxProfAnalysis::getBBInstrumentation</a>(DirectBB) == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &amp;&amp;</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;The ICP indirect BB is new, it shouldn&#39;t have instrumentation&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Allocate counters for the new basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint32&#95;t DirectID = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#a84796b39de9d068136440712aa81fdc2">allocateNextCounterIndex</a>(Caller);</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint32&#95;t IndirectID = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#a84796b39de9d068136440712aa81fdc2">allocateNextCounterIndex</a>(Caller);</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EntryBBIns =</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/ctxprofanalysis/#a3a31a6be1881280b30e349edabc9ca43">CtxProfAnalysis::getBBInstrumentation</a>(Caller.getEntryBlock());</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DirectBBIns = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InstrProfCntrInstBase&gt;</a>(EntryBBIns-&gt;clone());</Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">  DirectBBIns-&gt;setIndex(DirectID);</Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">  DirectBBIns-&gt;insertInto(&amp;DirectBB, DirectBB.getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndirectBBIns = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InstrProfCntrInstBase&gt;</a>(EntryBBIns-&gt;clone());</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">  IndirectBBIns-&gt;setIndex(IndirectID);</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal">  IndirectBBIns-&gt;insertInto(&amp;IndirectBB, IndirectBB.getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/globalvalue/#a3af0428ec6e48cb2f05c199b7b9f7e07">GlobalValue::GUID</a> CalleeGUID = <a href="/docs/api/classes/llvm/assignguidpass/#a00cd72af35cb6bdeae06467500b531ae">AssignGUIDPass::getGUID</a>(Callee);</Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint32&#95;t NewCountersSize = IndirectID + 1;</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ProfileUpdater = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/pgoctxprofcontext">PGOCtxProfContext</a> &amp;Ctx) &#123;</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ctx.guid() == <a href="/docs/api/classes/llvm/assignguidpass/#a00cd72af35cb6bdeae06467500b531ae">AssignGUIDPass::getGUID</a>(Caller));</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewCountersSize - 2 == Ctx.counters().size());</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All the ctx-es belonging to a function must have the same size counters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">    Ctx.resizeCounters(NewCountersSize);</Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Maybe in this context, the indirect callsite wasn&#39;t observed at all. That</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// would make both direct and indirect BBs cold - which is what we already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// have from resising the counters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ctx.hasCallsite(CSIndex))</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;CSData = Ctx.callsite(CSIndex);</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">    uint64&#95;t TotalCount = 0;</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>, V&#93; : CSData)</Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal">      TotalCount += V.getEntrycount();</Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">    uint64&#95;t DirectCount = 0;</Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we called the direct target, update the DirectCount. If we didn&#39;t, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// still want to update the indirect BB (to which the TotalCount goes, in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that case).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = CSData.find(CalleeGUID); It != CSData.end()) &#123;</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CalleeGUID == It-&gt;second.guid());</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">      DirectCount = It-&gt;second.getEntrycount();</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This direct target needs to be moved to this caller under the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// newly-allocated callsite index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ctx.callsites().count(NewCSID) == 0);</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">      Ctx.ingestContext(NewCSID, std::move(It-&gt;second));</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">      CSData.erase(CalleeGUID);</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TotalCount &gt;= DirectCount);</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">    uint64&#95;t IndirectCount = TotalCount - DirectCount;</Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The ICP&#39;s effect is as-if the direct BB would have been taken DirectCount</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// times, and the indirect BB, IndirectCount times</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">    Ctx.counters()&#91;DirectID&#93; = DirectCount;</Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">    Ctx.counters()&#91;IndirectID&#93; = IndirectCount;</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">  CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#a4c63680ee62ec8bd5918b4389e26bcd1">update</a>(ProfileUpdater, Caller);</Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024caf8d0d4845b0b074d9f2e0f2ace6683da">DirectCall</a>;</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664" lineLink="/docs/api/namespaces/llvm/#ae529107c3b550f7e2fe6128a26c8f1da"><Highlight kind="normal"><a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;<a href="/docs/api/namespaces/llvm/#ae529107c3b550f7e2fe6128a26c8f1da">llvm::promoteCallWithVTableCmp</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;VPtr,</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee,</Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Constant &#42;&gt;</a> AddressPoints,</Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;BranchWeights) &#123;</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!AddressPoints.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Caller should guarantee&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(&amp;CB);</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 2&gt;</a> ICmps;</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;AddressPoint : AddressPoints)</Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="normal">    ICmps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(VPtr, AddressPoint));</Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Perform tree height reduction if the number of ICmps is high.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(ICmps);</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Version the indirect call site. If Cond is true, &#39;NewInst&#39; will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// executed, otherwise the original call site will be executed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;NewInst = <a href="#aaabc735841282ccafdf43b7c165b030e">versionCallSiteWithCond</a>(CB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, BranchWeights);</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Promote &#39;NewInst&#39; so that it directly calls the desired function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a90c1755a8480ebc1dcc4f05d56271b00">promoteCall</a>(NewInst, Callee);</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685" lineLink="/docs/api/namespaces/llvm/#ad3219f7b717320ae52f53ccb09ad5a84"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ad3219f7b717320ae52f53ccb09ad5a84">llvm::tryPromoteCall</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB) &#123;</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>());</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = CB.<a href="/docs/api/classes/llvm/callbase/#afac5b39bcbb90d660f83d9b4bd8c6d95">getCaller</a>()-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>();</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = M-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Callee = CB.<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>();</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;VTableEntryLoad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(Callee);</Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VTableEntryLoad)</Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Not a vtable entry load.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VTableEntryPtr = VTableEntryLoad-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> VTableOffset(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(VTableEntryPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), 0);</Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VTableBasePtr = VTableEntryPtr-&gt;<a href="/docs/api/classes/llvm/value/#a23c582e2452eeb2b2cf6e0c43eca617e">stripAndAccumulateConstantOffsets</a>(</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, VTableOffset, </Highlight><Highlight kind="comment">/&#42; AllowNonInbounds &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;VTablePtrLoad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(VTableBasePtr);</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VTablePtrLoad)</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Not a vtable load.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Object = VTablePtrLoad-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> ObjectOffset(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(Object-&gt;getType()), 0);</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ObjectBase = Object-&gt;stripAndAccumulateConstantOffsets(</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ObjectOffset, </Highlight><Highlight kind="comment">/&#42; AllowNonInbounds &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(ObjectBase) &amp;&amp; ObjectOffset == 0))</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Not an Alloca or the offset isn&#39;t zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look for the vtable pointer store into the object by the ctor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI(VTablePtrLoad);</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VTablePtr = <a href="/docs/api/namespaces/llvm/#a459b627931605e520bf7d14e074af7c1">FindAvailableLoadedValue</a>(</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal">      VTablePtrLoad, VTablePtrLoad-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), BBI, 0, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VTablePtr || !VTablePtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>())</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// No vtable found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> VTableOffsetGVBase(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(VTablePtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), 0);</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VTableGVBase = VTablePtr-&gt;<a href="/docs/api/classes/llvm/value/#a23c582e2452eeb2b2cf6e0c43eca617e">stripAndAccumulateConstantOffsets</a>(</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, VTableOffsetGVBase, </Highlight><Highlight kind="comment">/&#42; AllowNonInbounds &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalVariable&gt;</a>(VTableGVBase);</Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!(GV &amp;&amp; GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aa859e108741fa64681b63f0c0c672512">isConstant</a>() &amp;&amp; GV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#aec2d700d8b1e57f830a673c39a1f30dc">hasDefinitiveInitializer</a>()))</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Not in the form of a global constant variable with an initializer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> VTableGVOffset = VTableOffsetGVBase + VTableOffset;</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!(VTableGVOffset.<a href="/docs/api/classes/llvm/apint/#a3015474e70e59c0a3ed4f9f0e8644b75">getActiveBits</a>() &lt;= 64))</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Out of range.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;DirectCallee = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">  std::tie(DirectCallee, std::ignore) =</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#afc0a5ead9186ecbdc82f6ebe331c25ee">getFunctionAtVTableOffset</a>(GV, VTableGVOffset.<a href="/docs/api/classes/llvm/apint/#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>(), &#42;M);</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DirectCallee)</Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// No function pointer found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a0e5b9e42ea84622605acea0b0d721fda">isLegalToPromote</a>(CB, DirectCallee))</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Success.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a90c1755a8480ebc1dcc4f05d56271b00">promoteCall</a>(CB, DirectCallee);</Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#undef DEBUG&#95;TYPE</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
