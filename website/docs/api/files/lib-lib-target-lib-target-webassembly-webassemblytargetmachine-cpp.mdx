---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `WebAssemblyTargetMachine.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This file defines the WebAssembly-specific subclass of <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a>. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="WebAssemblyTargetMachine.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="MCTargetDesc/WebAssemblyMCTargetDesc.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/lib/target/webassembly/mctargetdesc/webassemblymctargetdesc-h"
  isLocal="true" />
<IncludesListItem
  filePath="TargetInfo/WebAssemblyTargetInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/lib/target/webassembly/targetinfo/webassemblytargetinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="WebAssembly.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassembly-h"
  isLocal="true" />
<IncludesListItem
  filePath="WebAssemblyISelLowering.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyisellowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="WebAssemblyMachineFunctionInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblymachinefunctioninfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="WebAssemblyTargetObjectFile.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetobjectfile-h"
  isLocal="true" />
<IncludesListItem
  filePath="WebAssemblyTargetTransformInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="WebAssemblyUtilities.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyutilities-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MIRParser/MIParser.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/include/llvm/codegen/mirparser/miparser-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/Passes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/passes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/RegAllocRegistry.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/regallocregistry-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetPassConfig.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/MCAsmInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/mcasminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/TargetRegistry.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/targetregistry-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetOptions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Scalar.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/scalar-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Scalar/LowerAtomicPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/loweratomicpass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/utils-h"
  isLocal="true" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-webassemblytargetmachine-cpp-">anonymous&#123;WebAssemblyTargetMachine.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics">CoalesceFeaturesAndStripAtomics</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig">WebAssemblyPassConfig</a></>}>
<a href="/docs/api/namespaces/llvm/webassembly">WebAssembly</a> Code Generator <a href="/docs/api/classes/llvm/pass">Pass</a> Configuration Options. <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a563cec1174cd4374050fc2c3007b26a9">basicCheckForEHAndSjLj</a> (TargetMachine &#42;TM)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/reloc/#af59f6dc86e80aaf56f1afd155eebf568">Reloc::Model</a></>}
  name={<><a href="#a225188450747cb01da5afaea151ff9db">getEffectiveRelocModel</a> (std::optional&lt; Reloc::Model &gt; RM, const Triple &amp;TT)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#adeb6f14d9f377993d79fae2efb34ecac">LLVM&#95;EXTERNAL&#95;VISIBILITY</a> void</>}
  name={<><a href="#a5193d47b6ee96653d85049ae1ab002e9">LLVMInitializeWebAssemblyTarget</a> ()</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac16f99939d8bae4daf4d01bda3e30382">WasmDisableExplicitLocals</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af9ca35b245dba6c3ae892b4bb4d79ea4">WasmDisableFixIrreducibleControlFlowPass</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;wasm&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This file defines the WebAssembly-specific subclass of <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a>.

<SectionDefinition>

## Functions

### basicCheckForEHAndSjLj() {#a563cec1174cd4374050fc2c3007b26a9}

<MemberDefinition
  prototype={<>static void basicCheckForEHAndSjLj (<a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &#42; TM)</>}
  labels = {["static"]}>

Definition at line <a href="#l00406">406</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-cpp">WebAssemblyTargetMachine.cpp</a>.
</MemberDefinition>

### getEffectiveRelocModel() {#a225188450747cb01da5afaea151ff9db}

<MemberDefinition
  prototype={<>static Reloc::Model getEffectiveRelocModel (std::optional&lt; <a href="/docs/api/namespaces/llvm/reloc/#af59f6dc86e80aaf56f1afd155eebf568">Reloc::Model</a> &gt; RM, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/triple">Triple</a> &amp; TT)</>}
  labels = {["static"]}>

Definition at line <a href="#l00099">99</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-cpp">WebAssemblyTargetMachine.cpp</a>.
</MemberDefinition>

### LLVMInitializeWebAssemblyTarget() {#a5193d47b6ee96653d85049ae1ab002e9}

<MemberDefinition
  prototype={<>LLVM&#95;EXTERNAL&#95;VISIBILITY void LLVMInitializeWebAssemblyTarget ()</>}>

Definition at line <a href="#l00056">56</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-cpp">WebAssemblyTargetMachine.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### WasmDisableExplicitLocals {#ac16f99939d8bae4daf4d01bda3e30382}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; WasmDisableExplicitLocals(&quot;wasm-disable-explicit-locals&quot;, cl::Hidden, cl::desc(&quot;WebAssembly: output implicit locals in&quot; &quot; instruction output for test purposes only.&quot;), cl::init(false))</>}
  labels = {["static"]}>

Definition at line <a href="#l00044">44</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-cpp">WebAssemblyTargetMachine.cpp</a>.
</MemberDefinition>

### WasmDisableFixIrreducibleControlFlowPass {#af9ca35b245dba6c3ae892b4bb4d79ea4}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; WasmDisableFixIrreducibleControlFlowPass(&quot;wasm-disable-fix-irreducible-control-flow-pass&quot;, cl::Hidden, cl::desc(&quot;webassembly: disables the fix &quot; &quot; irreducible control flow optimization pass&quot;), cl::init(false))</>}
  labels = {["static"]}>

Definition at line <a href="#l00050">50</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-cpp">WebAssemblyTargetMachine.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;wasm&quot;</>}>

Definition at line <a href="#l00038">38</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-cpp">WebAssemblyTargetMachine.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- WebAssemblyTargetMachine.cpp - Define TargetMachine for WebAssembly -==//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This file defines the WebAssembly-specific subclass of TargetMachine.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetmachine-h">WebAssemblyTargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/lib/target/webassembly/mctargetdesc/webassemblymctargetdesc-h">MCTargetDesc/WebAssemblyMCTargetDesc.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/lib/target/webassembly/targetinfo/webassemblytargetinfo-h">TargetInfo/WebAssemblyTargetInfo.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassembly-h">WebAssembly.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyisellowering-h">WebAssemblyISelLowering.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblymachinefunctioninfo-h">WebAssemblyMachineFunctionInfo.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargetobjectfile-h">WebAssemblyTargetObjectFile.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblytargettransforminfo-h">WebAssemblyTargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyutilities-h">WebAssemblyUtilities.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/include/llvm/codegen/mirparser/miparser-h">llvm/CodeGen/MIRParser/MIParser.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/passes-h">llvm/CodeGen/Passes.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/regallocregistry-h">llvm/CodeGen/RegAllocRegistry.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/mcasminfo-h">llvm/MC/MCAsmInfo.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/targetregistry-h">llvm/MC/TargetRegistry.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h">llvm/Target/TargetOptions.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/scalar-h">llvm/Transforms/Scalar.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/loweratomicpass-h">llvm/Transforms/Scalar/LowerAtomicPass.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/utils-h">llvm/Transforms/Utils.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;wasm&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">// A command-line option to keep implicit locals</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">// for the purpose of testing with lit/llc ONLY.</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightComment">// This produces output which is not valid WebAssembly, and is not supported</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightComment">// by assemblers/disassemblers and other MC based tools.</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44" lineLink="#ac16f99939d8bae4daf4d01bda3e30382"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ac16f99939d8bae4daf4d01bda3e30382">WasmDisableExplicitLocals</a>(</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;wasm-disable-explicit-locals&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;WebAssembly: output implicit locals in&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot; instruction output for test purposes only.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50" lineLink="#af9ca35b245dba6c3ae892b4bb4d79ea4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#af9ca35b245dba6c3ae892b4bb4d79ea4">WasmDisableFixIrreducibleControlFlowPass</a>(</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;wasm-disable-fix-irreducible-control-flow-pass&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;webassembly: disables the fix &quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot; irreducible control flow optimization pass&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56" lineLink="#a5193d47b6ee96653d85049ae1ab002e9"><span class="doxyHighlightKeyword">extern</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;C&quot;</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#adeb6f14d9f377993d79fae2efb34ecac">LLVM&#95;EXTERNAL&#95;VISIBILITY</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a5193d47b6ee96653d85049ae1ab002e9">LLVMInitializeWebAssemblyTarget</a>() &#123;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Register the target.</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/registertargetmachine">RegisterTargetMachine&lt;WebAssemblyTargetMachine&gt;</a> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>(</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7eaefe3d08d9d3f62944e9074df84ba6">getTheWebAssemblyTarget32</a>());</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/registertargetmachine">RegisterTargetMachine&lt;WebAssemblyTargetMachine&gt;</a> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>(</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aaa7fdcba17ac3f1f7aebc5edfe48c13a">getTheWebAssemblyTarget64</a>());</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Register backend passes</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PR = &#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>();</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a2fe4e6215508febed5776106a5331a9e">initializeWebAssemblyAddMissingPrototypesPass</a>(PR);</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9eb3911cac32d8629a434068e8d16733">initializeWebAssemblyLowerEmscriptenEHSjLjPass</a>(PR);</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7950583043c424c49e7b5a97bee319d2">initializeLowerGlobalDtorsLegacyPassPass</a>(PR);</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac4bbf1036f6aca39416fab45f2084c81">initializeFixFunctionBitcastsPass</a>(PR);</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a015eb75232a3da03c5a2680a6339d986">initializeOptimizeReturnedPass</a>(PR);</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ad55a4c24509199a39f45fab37256dcac">initializeWebAssemblyRefTypeMem2LocalPass</a>(PR);</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#af93dd8c36a1ffb34c1042819a71f9d5a">initializeWebAssemblyArgumentMovePass</a>(PR);</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#af0512b1c7b8e688e606e6d1224047226">initializeWebAssemblySetP2AlignOperandsPass</a>(PR);</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#afed9c1f4c108bac348ddd9be3858d78f">initializeWebAssemblyReplacePhysRegsPass</a>(PR);</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a981585f13eb8a8cd4a2cd8807a434804">initializeWebAssemblyOptimizeLiveIntervalsPass</a>(PR);</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab1cc778918ea20a2daf42371b2b4f1d9">initializeWebAssemblyMemIntrinsicResultsPass</a>(PR);</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8613fe7739c0449d0f541b7a3475c2f5">initializeWebAssemblyRegStackifyPass</a>(PR);</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a5f6b80327d26479b479a0536fee4a7f6">initializeWebAssemblyRegColoringPass</a>(PR);</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7f8b47ac93d917e30c0690bee9425987">initializeWebAssemblyNullifyDebugValueListsPass</a>(PR);</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a846594b95f81a54e9db912dce2552fd2">initializeWebAssemblyFixIrreducibleControlFlowPass</a>(PR);</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a2c10081f972d305e7c15620119c377c0">initializeWebAssemblyLateEHPreparePass</a>(PR);</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a3e3f450b1f8c41aadd499a4d94952d70">initializeWebAssemblyExceptionInfoPass</a>(PR);</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ae0dc9c7fa2c3e7c7680c8143ec7cf0ae">initializeWebAssemblyCFGSortPass</a>(PR);</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aefbb98e8ecfe7ac6dd40c5ab36ec2609">initializeWebAssemblyCFGStackifyPass</a>(PR);</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab27dfdb3309c48d5943b339fed0b7e27">initializeWebAssemblyExplicitLocalsPass</a>(PR);</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a05775b3c0e84fbe056684e28747b8e44">initializeWebAssemblyLowerBrUnlessPass</a>(PR);</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a43066d1437e59118e1bc255e972e3179">initializeWebAssemblyRegNumberingPass</a>(PR);</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#af1454441604dc893e72f95494c51bf1f">initializeWebAssemblyDebugFixupPass</a>(PR);</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ad4c61f4be737c7ea117ee0c9371f0f45">initializeWebAssemblyPeepholePass</a>(PR);</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab2178295feee430d3f86953224706e09">initializeWebAssemblyMCLowerPrePassPass</a>(PR);</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a450ae16b83753088c7b369e67bada03a">initializeWebAssemblyLowerRefTypesIntPtrConvPass</a>(PR);</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ae490ea3e56f9a9a7ee2c623295f2de93">initializeWebAssemblyFixBrTableDefaultsPass</a>(PR);</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a45527dc95857578fcf1f7ec960700eb9">initializeWebAssemblyDAGToDAGISelLegacyPass</a>(PR);</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlightComment">// WebAssembly Lowering public interface.</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="#a225188450747cb01da5afaea151ff9db"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/reloc/#af59f6dc86e80aaf56f1afd155eebf568">Reloc::Model</a> <a href="/docs/api/namespaces/llvm/#a63737748f52c9cdcd469b63a01cc454a">getEffectiveRelocModel</a>(std::optional&lt;Reloc::Model&gt; RM,</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/triple">Triple</a> &amp;TT) &#123;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RM) &#123;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Default to static relocation model.  This should always be more optimial</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// than PIC since the static linker can determine all global addresses and</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// assume direct function calls.</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/reloc/#af59f6dc86e80aaf56f1afd155eebf568a2102fa713297236bf4339c5f0bf0f39d">Reloc::Static</a>;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;RM;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlightComment">/// Create an WebAssembly architecture model.</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a39f4b4edb8abb1954310e3b6915afc81"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/webassemblytargetmachine/#a39f4b4edb8abb1954310e3b6915afc81">WebAssemblyTargetMachine::WebAssemblyTargetMachine</a>(</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/target">Target</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/triple">Triple</a> &amp;TT, <a href="/docs/api/classes/llvm/stringref">StringRef</a> CPU, <a href="/docs/api/classes/llvm/stringref">StringRef</a> FS,</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetoptions">TargetOptions</a> &amp;<a href="/docs/api/classes/llvm/targetmachine/#ab1fb67187fc37e569cc5171cbebba873">Options</a>, std::optional&lt;Reloc::Model&gt; <a href="/docs/api/classes/llvm/targetmachine/#a588867fa922c392886b07e0ad42038b4">RM</a>,</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">    std::optional&lt;CodeModel::Model&gt; CM, <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2">CodeGenOptLevel</a> OL, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> JIT)</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">    : <a href="/docs/api/classes/llvm/codegentargetmachineimpl/#a4480a9aa1ec7c3115acc998e187f5ab3">CodeGenTargetMachineImpl</a>(</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>,</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">          TT.isArch64Bit()</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">              ? (TT.isOSEmscripten() ? </span><span class="doxyHighlightStringLiteral">&quot;e-m:e-p:64:64-p10:8:8-p20:8:8-i64:64-&quot;</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">                                       </span><span class="doxyHighlightStringLiteral">&quot;i128:128-f128:64-n32:64-S128-ni:1:10:20&quot;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">                                     : </span><span class="doxyHighlightStringLiteral">&quot;e-m:e-p:64:64-p10:8:8-p20:8:8-i64:64-&quot;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">                                       </span><span class="doxyHighlightStringLiteral">&quot;i128:128-n32:64-S128-ni:1:10:20&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">              : (TT.isOSEmscripten() ? </span><span class="doxyHighlightStringLiteral">&quot;e-m:e-p:32:32-p10:8:8-p20:8:8-i64:64-&quot;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">                                       </span><span class="doxyHighlightStringLiteral">&quot;i128:128-f128:64-n32:64-S128-ni:1:10:20&quot;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">                                     : </span><span class="doxyHighlightStringLiteral">&quot;e-m:e-p:32:32-p10:8:8-p20:8:8-i64:64-&quot;</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">                                       </span><span class="doxyHighlightStringLiteral">&quot;i128:128-n32:64-S128-ni:1:10:20&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">          TT, CPU, FS, <a href="/docs/api/classes/llvm/targetmachine/#ab1fb67187fc37e569cc5171cbebba873">Options</a>, <a href="/docs/api/namespaces/llvm/#a63737748f52c9cdcd469b63a01cc454a">getEffectiveRelocModel</a>(<a href="/docs/api/classes/llvm/targetmachine/#a588867fa922c392886b07e0ad42038b4">RM</a>, TT),</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a6849e9de7afb5b350a241595d9ed1911">getEffectiveCodeModel</a>(CM, <a href="/docs/api/namespaces/llvm/codemodel">CodeModel</a>::Large), OL),</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">      TLOF(new <a href="/docs/api/classes/llvm/webassemblytargetobjectfile">WebAssemblyTargetObjectFile</a>()),</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">      UsesMultivalueABI(<a href="/docs/api/classes/llvm/targetmachine/#ab1fb67187fc37e569cc5171cbebba873">Options</a>.MCOptions.getABIName() == </span><span class="doxyHighlightStringLiteral">&quot;experimental-mv&quot;</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// WebAssembly type-checks instructions, but a noreturn function with a return</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// type that doesn&#39;t match the context will cause a check failure. So we lower</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LLVM &#39;unreachable&#39; to ISD::TRAP and then lower that to WebAssembly&#39;s</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;unreachable&#39; instructions which is meant for that case. Formerly, we also</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// needed to add checks to SP failure emission in the instruction selection</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// backends, but this has since been tied to TrapUnreachable and is no longer</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// necessary.</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  this-&gt;Options.<a href="/docs/api/classes/llvm/targetoptions/#ae511cb5018c52294bcff10ccde3f6789">TrapUnreachable</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  this-&gt;Options.<a href="/docs/api/classes/llvm/targetoptions/#acd83fce25de1ac9f6c975135a8235c22">NoTrapAfterNoreturn</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// WebAssembly treats each function as an independent unit. Force</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// -ffunction-sections, effectively, so that we can emit them independently.</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  this-&gt;Options.<a href="/docs/api/classes/llvm/targetoptions/#abb646e2505e21a891497f665187963b3">FunctionSections</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  this-&gt;Options.<a href="/docs/api/classes/llvm/targetoptions/#ad0c7f9f16d88de8a481dd162ead65c7f">DataSections</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">  this-&gt;Options.<a href="/docs/api/classes/llvm/targetoptions/#aaeee4d390f75162b6cf22adb0f1fbb78">UniqueSectionNames</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/codegentargetmachineimpl/#a85849733e753fbf08f1c487b153c754b">initAsmInfo</a>();</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that we don&#39;t use setRequiresStructuredCFG(true). It disables</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimizations than we&#39;re ok with, and want, such as critical edge</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// splitting and tail merging.</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/webassemblytargetmachine/#a93070052836fb225c17940ec8b370417">WebAssemblyTargetMachine::~WebAssemblyTargetMachine</a>() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// anchor.</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/webassemblysubtarget">WebAssemblySubtarget</a> &#42;<a href="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157">WebAssemblyTargetMachine::getSubtargetImpl</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157">getSubtargetImpl</a>(std::string(<a href="/docs/api/classes/llvm/targetmachine/#a8d4930d9bba5bf85a86c2177b950c10f">getTargetCPU</a>()),</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">                          std::string(<a href="/docs/api/classes/llvm/targetmachine/#a81b02eb89292775ff6e6a2ece94f961f">getTargetFeatureString</a>()));</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/webassemblysubtarget">WebAssemblySubtarget</a> &#42;</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a4e77be6f302bb2cc258a5f5ee0a8fd44"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157">WebAssemblyTargetMachine::getSubtargetImpl</a>(std::string CPU,</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">                                           std::string FS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SubtargetMap&#91;CPU + FS&#93;;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = std::make&#95;unique&lt;WebAssemblySubtarget&gt;(<a href="/docs/api/classes/llvm/targetmachine/#a05856d96e88224279af8b29edfd1c9ad">TargetTriple</a>, CPU, FS, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.get();</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/webassemblysubtarget">WebAssemblySubtarget</a> &#42;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#ac5c975b4faf36ed756851c7a84d870ea"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157">WebAssemblyTargetMachine::getSubtargetImpl</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/attribute">Attribute</a> CPUAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFnAttribute(</span><span class="doxyHighlightStringLiteral">&quot;target-cpu&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/attribute">Attribute</a> FSAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFnAttribute(</span><span class="doxyHighlightStringLiteral">&quot;target-features&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">  std::string CPU =</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">      CPUAttr.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>() ? CPUAttr.<a href="/docs/api/classes/llvm/attribute/#a968930aea9d9efa8d46dd890fce75643">getValueAsString</a>().<a href="/docs/api/classes/llvm/stringref/#a223dd14e7d12bc5cea01889b972a98b2">str</a>() : <a href="/docs/api/classes/llvm/targetmachine/#a9ca45577ddb8efe4904398939fae28d1">TargetCPU</a>;</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">  std::string FS =</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">      FSAttr.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>() ? FSAttr.<a href="/docs/api/classes/llvm/attribute/#a968930aea9d9efa8d46dd890fce75643">getValueAsString</a>().<a href="/docs/api/classes/llvm/stringref/#a223dd14e7d12bc5cea01889b972a98b2">str</a>() : <a href="/docs/api/classes/llvm/targetmachine/#a795cc09ce82b6ef057e5400a5cee7d68">TargetFS</a>;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This needs to be done before we create a new subtarget since any</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// creation will depend on the TM and the code generation flags on the</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function that reside in TargetOptions.</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetmachine/#af0a50afebb9bed07d36be2bac4c6f729">resetTargetOptions</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157">getSubtargetImpl</a>(CPU, FS);</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190" lineLink="/docs/api/namespaces/anonymous-webassemblytargetmachine-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics/#a48f7eaf78175a2b858b6f141946555ca">CoalesceFeaturesAndStripAtomics</a> final : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a> &#123;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Take the union of all features used in the module and use it for each</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function individually, since having multiple feature sets in one module</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// currently does not make sense for WebAssembly. If atomics are not enabled,</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// also strip atomic operations and thread local storage.</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> ID;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/webassemblytargetmachine">WebAssemblyTargetMachine</a> &#42;WasmTM;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics/#a48f7eaf78175a2b858b6f141946555ca"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics/#a48f7eaf78175a2b858b6f141946555ca">CoalesceFeaturesAndStripAtomics</a>(<a href="/docs/api/classes/llvm/webassemblytargetmachine">WebAssemblyTargetMachine</a> &#42;WasmTM)</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a>(ID), WasmTM(WasmTM) &#123;&#125;</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics/#a4fa539d2c44702a7226adb07abecf5ed"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics/#a4fa539d2c44702a7226adb07abecf5ed">runOnModule</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M)</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/featurebitset">FeatureBitset</a> Features = coalesceFeatures(M);</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">    std::string FeatureStr = getFeatureString(Features);</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    WasmTM-&gt;setTargetFeatureString(FeatureStr);</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M)</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">      replaceFeatures(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, FeatureStr);</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> StrippedAtomics = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> StrippedTLS = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Features&#91;WebAssembly::FeatureAtomics&#93;) &#123;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">      StrippedAtomics = stripAtomics(M);</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">      StrippedTLS = stripThreadLocals(M);</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Features&#91;WebAssembly::FeatureBulkMemory&#93;) &#123;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">      StrippedTLS |= stripThreadLocals(M);</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StrippedAtomics &amp;&amp; !StrippedTLS)</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">      stripThreadLocals(M);</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StrippedTLS &amp;&amp; !StrippedAtomics)</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">      stripAtomics(M);</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">    recordFeatures(M, Features, StrippedAtomics || StrippedTLS);</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Conservatively assume we have made some change</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/featurebitset">FeatureBitset</a> coalesceFeatures(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Union the features of all defined functions. Start with an empty set, so</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that if a feature is disabled in every function, we&#39;ll compute it as</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// disabled. If any function lacks a target-features attribute, it&#39;ll</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// default to the target CPU from the &#96;TargetMachine&#96;.</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/featurebitset">FeatureBitset</a> Features;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AnyDefinedFuncs = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M) &#123;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration())</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">      Features |= WasmTM-&gt;<a href="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157">getSubtargetImpl</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)-&gt;getFeatureBits();</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">      AnyDefinedFuncs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have no defined functions, use the target CPU from the</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#96;TargetMachine&#96;.</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AnyDefinedFuncs) &#123;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">      Features =</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">          WasmTM</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">              -&gt;<a href="/docs/api/classes/llvm/webassemblytargetmachine/#a719713d67ba4d30b964d4a4f3228e157">getSubtargetImpl</a>(std::string(WasmTM-&gt;<a href="/docs/api/classes/llvm/targetmachine/#a8d4930d9bba5bf85a86c2177b950c10f">getTargetCPU</a>()),</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">                                 std::string(WasmTM-&gt;<a href="/docs/api/classes/llvm/targetmachine/#a81b02eb89292775ff6e6a2ece94f961f">getTargetFeatureString</a>()))</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">              -&gt;getFeatureBits();</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Features;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::string getFeatureString(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FeatureBitset &amp;Features) &#123;</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    std::string <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SubtargetFeatureKV &amp;KV : <a href="/docs/api/namespaces/llvm/#a1cd80a76d76bf507862c05650c5b16e9">WebAssemblyFeatureKV</a>) &#123;</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Features&#91;KV.Value&#93;)</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a> += (StringRef(</span><span class="doxyHighlightStringLiteral">&quot;+&quot;</span><span class="doxyHighlight">) + KV.Key + </span><span class="doxyHighlightStringLiteral">&quot;,&quot;</span><span class="doxyHighlight">).str();</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a> += (StringRef(</span><span class="doxyHighlightStringLiteral">&quot;-&quot;</span><span class="doxyHighlight">) + KV.Key + </span><span class="doxyHighlightStringLiteral">&quot;,&quot;</span><span class="doxyHighlight">).str();</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> replaceFeatures(Function &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::string &amp;Features) &#123;</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.removeFnAttr(</span><span class="doxyHighlightStringLiteral">&quot;target-features&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.removeFnAttr(</span><span class="doxyHighlightStringLiteral">&quot;target-cpu&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.addFnAttr(</span><span class="doxyHighlightStringLiteral">&quot;target-features&quot;</span><span class="doxyHighlight">, Features);</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> stripAtomics(<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Detect whether any atomics will be lowered, since there is no way to tell</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// whether the LowerAtomic pass lowers e.g. stores.</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Stripped = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M) &#123;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isAtomic()) &#123;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">            Stripped = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> done;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">  done:</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Stripped)</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">    LowerAtomicPass Lowerer;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M)</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">      Lowerer.<a href="/docs/api/classes/llvm/loweratomicpass/#aa6367f2b0be097467a383973068b444e">run</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> stripThreadLocals(<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Stripped = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;GV : <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.globals()) &#123;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GV.isThreadLocal()) &#123;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// replace &#96;@llvm.threadlocal.address.pX(GV)&#96; with &#96;GV&#96;.</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(GV.uses())) &#123;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntrinsicInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser())) &#123;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::threadlocal&#95;address &amp;&amp;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0) == &amp;GV) &#123;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;replaceAllUsesWith(&amp;GV);</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">        Stripped = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">        GV.setThreadLocal(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Stripped;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> recordFeatures(<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a> &amp;M, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> FeatureBitset &amp;Features, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Stripped) &#123;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SubtargetFeatureKV &amp;KV : <a href="/docs/api/namespaces/llvm/#a1cd80a76d76bf507862c05650c5b16e9">WebAssemblyFeatureKV</a>) &#123;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Features&#91;KV.Value&#93;) &#123;</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Mark features as used</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">        std::string MDKey = (StringRef(</span><span class="doxyHighlightStringLiteral">&quot;wasm-feature-&quot;</span><span class="doxyHighlight">) + KV.Key).str();</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.addModuleFlag(Module::ModFlagBehavior::Error, MDKey,</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/wasm/#a6930b5cc89dc0d84d4e96776acd477e1a08aa52c6ef848bafb5206058227544e5">wasm::WASM&#95;FEATURE&#95;PREFIX&#95;USED</a>);</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Code compiled without atomics or bulk-memory may have had its atomics or</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// thread-local data lowered to nonatomic operations or non-thread-local</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// data. In that case, we mark the pseudo-feature &quot;shared-mem&quot; as disallowed</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to tell the linker that it would be unsafe to allow this code ot be used</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in a module with shared memory.</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Stripped) &#123;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.addModuleFlag(Module::ModFlagBehavior::Error, </span><span class="doxyHighlightStringLiteral">&quot;wasm-feature-shared-mem&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/wasm/#a6930b5cc89dc0d84d4e96776acd477e1aafc5c5d2970fdd289dc771afef420e99">wasm::WASM&#95;FEATURE&#95;PREFIX&#95;DISALLOWED</a>);</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> CoalesceFeaturesAndStripAtomics::ID = 0;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlightComment">/// WebAssembly Code Generator Pass Configuration Options.</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a0ac785ca646202e2d20beed2eeb06351">WebAssemblyPassConfig</a> final : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetpassconfig/#abfe879f7efa8851adee88ab786516d59">TargetPassConfig</a> &#123;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a0ac785ca646202e2d20beed2eeb06351"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a0ac785ca646202e2d20beed2eeb06351">WebAssemblyPassConfig</a>(<a href="/docs/api/classes/llvm/webassemblytargetmachine">WebAssemblyTargetMachine</a> &amp;<a href="/docs/api/classes/llvm/targetpassconfig/#a0e43f614336b22347dfdb6f20ea792df">TM</a>, <a href="/docs/api/classes/llvm/legacy/passmanagerbase">PassManagerBase</a> &amp;PM)</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/targetpassconfig/#abfe879f7efa8851adee88ab786516d59">TargetPassConfig</a>(<a href="/docs/api/classes/llvm/targetpassconfig/#a0e43f614336b22347dfdb6f20ea792df">TM</a>, PM) &#123;&#125;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#ab4d67bca5947563e8d8a263a99f4222d"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/webassemblytargetmachine">WebAssemblyTargetMachine</a> &amp;<a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#ab4d67bca5947563e8d8a263a99f4222d">getWebAssemblyTargetMachine</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/simachinefunctioninfo-cpp/#a6c3673d61ea1313b5546587d80bdbe83">getTM&lt;WebAssemblyTargetMachine&gt;</a>();</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;createTargetRegisterAllocator(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addIRPasses() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addISelPrepare() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> addInstSelector() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addOptimizedRegAlloc() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addPostRegAlloc() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a0ec2f7b926c14185ae68634f64675d50"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a0ec2f7b926c14185ae68634f64675d50">addGCPasses</a>()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addPreEmitPass() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> addPreISel() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No reg alloc</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a6c7db547424baa0e88ca233c404a6a1b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a6c7db547424baa0e88ca233c404a6a1b">addRegAssignAndRewriteFast</a>()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No reg alloc</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a04f0d553e3e7b77d295673ff1e44691b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a04f0d553e3e7b77d295673ff1e44691b">addRegAssignAndRewriteOptimized</a>()</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a82e19c7266681b3283fe1ce9ec23e180"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/machinefunctioninfo">MachineFunctionInfo</a> &#42;<a href="/docs/api/classes/llvm/webassemblytargetmachine/#a82e19c7266681b3283fe1ce9ec23e180">WebAssemblyTargetMachine::createMachineFunctionInfo</a>(</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8e612822d4ba7bb36c9c79582a567108">BumpPtrAllocator</a> &amp;Allocator, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetsubtargetinfo">TargetSubtargetInfo</a> &#42;<a href="/docs/api/classes/llvm/targetmachine/#aaebd1c0e5f028848cc0e548bf015aaf1">STI</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/machinefunctioninfo/#a06ad8b2e5a8e3c0f81f05c7870fb3b23">WebAssemblyFunctionInfo::create&lt;WebAssemblyFunctionInfo&gt;</a>(Allocator, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">                                                                  <a href="/docs/api/classes/llvm/targetmachine/#aaebd1c0e5f028848cc0e548bf015aaf1">STI</a>);</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a></span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a9bf333c6c83111588f567e7f191dc984"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/webassemblytargetmachine/#a9bf333c6c83111588f567e7f191dc984">WebAssemblyTargetMachine::getTargetTransformInfo</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a>(<a href="/docs/api/classes/llvm/webassemblyttiimpl">WebAssemblyTTIImpl</a>(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a> &#42;</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a4740e3f15f0d96477caddde4b1b199ae"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/webassemblytargetmachine/#a4740e3f15f0d96477caddde4b1b199ae">WebAssemblyTargetMachine::createPassConfig</a>(<a href="/docs/api/classes/llvm/legacy/passmanagerbase">PassManagerBase</a> &amp;PM) &#123;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> WebAssemblyPassConfig(&#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, PM);</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a9eb82e354d23248e7a99cecc1fb98e55"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a9eb82e354d23248e7a99cecc1fb98e55">WebAssemblyPassConfig::createTargetRegisterAllocator</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// No reg alloc</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/webassembly/#a83d68f56b86e580ac9d156b47af53c2c">WebAssembly::WasmEnableEH</a>;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/webassembly/#a9d507b0cb1cf288e6fe831666a8b8668">WebAssembly::WasmEnableEmEH</a>;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/webassembly/#aab16d00c5762ae8f5a89ce045b44b07e">WebAssembly::WasmEnableEmSjLj</a>;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/webassembly/#a877b8fcf196f226d4f2289ebdb1f276b">WebAssembly::WasmEnableSjLj</a>;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/webassembly/#a66b0b93d22f984ea3f11e3fc04dbe744">WebAssembly::WasmUseLegacyEH</a>;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406" lineLink="#a563cec1174cd4374050fc2c3007b26a9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a563cec1174cd4374050fc2c3007b26a9">basicCheckForEHAndSjLj</a>(<a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &#42;TM) &#123;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// You can&#39;t enable two modes of EH at the same time</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WasmEnableEmEH &amp;&amp; WasmEnableEH)</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;-enable-emscripten-cxx-exceptions not allowed with -wasm-enable-eh&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// You can&#39;t enable two modes of SjLj at the same time</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WasmEnableEmSjLj &amp;&amp; WasmEnableSjLj)</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;-enable-emscripten-sjlj not allowed with -wasm-enable-sjlj&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// You can&#39;t mix Emscripten EH with Wasm SjLj.</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WasmEnableEmEH &amp;&amp; WasmEnableSjLj)</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;-enable-emscripten-cxx-exceptions not allowed with -wasm-enable-sjlj&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Here we make sure TargetOptions.ExceptionModel is the same as</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// MCAsmInfo.ExceptionsType. Normally these have to be the same, because clang</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores the exception model info in LangOptions, which is later transferred</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to TargetOptions and MCAsmInfo. But when clang compiles bitcode directly,</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// clang&#39;s LangOptions is not used and thus the exception model info is not</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// correctly transferred to TargetOptions and MCAsmInfo, so we make sure we</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have the correct exception model in WebAssemblyMCAsmInfo constructor. But</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in this case TargetOptions is still not updated, so we make sure they are</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the same.</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  TM-&gt;Options.ExceptionModel = TM-&gt;getMCAsmInfo()-&gt;getExceptionHandlingType();</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Basic Correctness checking related to -exception-model</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TM-&gt;Options.ExceptionModel != <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84a6adf97f83acf6453d4a6a4b1070f3754">ExceptionHandling::None</a> &amp;&amp;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">      TM-&gt;Options.ExceptionModel != <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84af93da81fd23e2eeaf8de29b04bb2399f">ExceptionHandling::Wasm</a>)</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;-exception-model should be either &#39;none&#39; or &#39;wasm&#39;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WasmEnableEmEH &amp;&amp; TM-&gt;Options.ExceptionModel == <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84af93da81fd23e2eeaf8de29b04bb2399f">ExceptionHandling::Wasm</a>)</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;-exception-model=wasm not allowed with &quot;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;-enable-emscripten-cxx-exceptions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WasmEnableEH &amp;&amp; TM-&gt;Options.ExceptionModel != <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84af93da81fd23e2eeaf8de29b04bb2399f">ExceptionHandling::Wasm</a>)</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;-wasm-enable-eh only allowed with -exception-model=wasm&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WasmEnableSjLj &amp;&amp; TM-&gt;Options.ExceptionModel != <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84af93da81fd23e2eeaf8de29b04bb2399f">ExceptionHandling::Wasm</a>)</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;-wasm-enable-sjlj only allowed with -exception-model=wasm&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!WasmEnableEH &amp;&amp; !WasmEnableSjLj) &amp;&amp;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">      TM-&gt;Options.ExceptionModel == <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84af93da81fd23e2eeaf8de29b04bb2399f">ExceptionHandling::Wasm</a>)</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;-exception-model=wasm only allowed with at least one of &quot;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;-wasm-enable-eh or -wasm-enable-sjlj&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Currently it is allowed to mix Wasm EH with Emscripten SjLj as an interim</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// measure, but some code will error out at compile time in this combination.</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See WebAssemblyLowerEmscriptenEHSjLj pass for details.</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlightComment">// The following functions are called from lib/CodeGen/Passes.cpp to modify</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlightComment">// the CodeGen pass sequence.</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#aeb170544eb9997045ad3d9084cccccc0"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#aeb170544eb9997045ad3d9084cccccc0">WebAssemblyPassConfig::addIRPasses</a>() &#123;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add signatures to prototype-less function declarations</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a158a1a60588742d800b39d3ce0429e89">createWebAssemblyAddMissingPrototypes</a>());</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lower .llvm.global&#95;dtors into .llvm.global&#95;ctors with &#95;&#95;cxa&#95;atexit calls.</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a72bec3f3cf93a5fed57e2de639a2c58e">createLowerGlobalDtorsLegacyPass</a>());</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fix function bitcasts, as WebAssembly requires caller and callee signatures</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to match.</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#ac190cf7a0c3d21937ee46d261fdbeee4">createWebAssemblyFixFunctionBitcasts</a>());</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimize &quot;returned&quot; function attributes.</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/targetpassconfig/#a4c36a5c58e6e55c962d2d9bed0bb3ba7">getOptLevel</a>() != <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2a6adf97f83acf6453d4a6a4b1070f3754">CodeGenOptLevel::None</a>)</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a8ee885d3546e34b315b9c7730779188a">createWebAssemblyOptimizeReturned</a>());</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  <a href="#a563cec1174cd4374050fc2c3007b26a9">basicCheckForEHAndSjLj</a>(<a href="/docs/api/classes/llvm/targetpassconfig/#a0e43f614336b22347dfdb6f20ea792df">TM</a>);</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If exception handling is not enabled and setjmp/longjmp handling is</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// enabled, we lower invokes into calls and delete unreachable landingpad</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks. Lowering invokes when there is no EH support is done in</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TargetPassConfig::addPassesToHandleExceptions, but that runs after these IR</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// passes and Emscripten SjLj handling expects all invokes to be lowered</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// before.</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WasmEnableEmEH &amp;&amp; !WasmEnableEH) &#123;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a73866a00fb633fea123b83d0dec2c073">createLowerInvokePass</a>());</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The lower invoke pass may create unreachable code. Remove it in order not</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to process dead blocks in setjmp/longjmp handling.</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a12d11d4d4e6bb3d883283ad219cfe6d7">createUnreachableBlockEliminationPass</a>());</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle exceptions and setjmp/longjmp if enabled. Unlike Wasm EH preparation</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// done in WasmEHPrepare pass, Wasm SjLj preparation shares libraries and</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transformation algorithms with Emscripten SjLj, so we run</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LowerEmscriptenEHSjLj pass also when Wasm SjLj is enabled.</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WasmEnableEmEH || WasmEnableEmSjLj || WasmEnableSjLj)</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a9df37103568a509baca10e4fc7357a5e">createWebAssemblyLowerEmscriptenEHSjLj</a>());</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Expand indirectbr instructions to switches.</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a052f90e5e4af6a011adf970b4a504aa1">createIndirectBrExpandPass</a>());</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a835d2863dbd2cfd8c184a6a94923b61f">TargetPassConfig::addIRPasses</a>();</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a92398eff530e8269aeaa926aa01b7fb5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a92398eff530e8269aeaa926aa01b7fb5">WebAssemblyPassConfig::addISelPrepare</a>() &#123;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to move reference type allocas to WASM&#95;ADDRESS&#95;SPACE&#95;VAR so that</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loads and stores are promoted to local.gets/local.sets.</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a94f8bfbe825939e6e82f45e2d7095426">createWebAssemblyRefTypeMem2Local</a>());</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lower atomics and TLS if necessary</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/coalescefeaturesandstripatomics">CoalesceFeaturesAndStripAtomics</a>(&amp;<a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#ab4d67bca5947563e8d8a263a99f4222d">getWebAssemblyTargetMachine</a>()));</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is a no-op if atomics are not used in the module</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#adebabb5e491a19ce4466a326d41641e0">createAtomicExpandLegacyPass</a>());</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#acd370e6335630ad711de582b8bb2fd72">TargetPassConfig::addISelPrepare</a>();</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a9cdafbe47c009568275c8908a24275e3"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a9cdafbe47c009568275c8908a24275e3">WebAssemblyPassConfig::addInstSelector</a>() &#123;</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  (void)<a href="/docs/api/classes/llvm/targetpassconfig/#a45c2bcfa7777e420dc7c979b639afaf9">TargetPassConfig::addInstSelector</a>();</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a856e61e272d0f1021fe331fe12bf9e87">createWebAssemblyISelDag</a>(<a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#ab4d67bca5947563e8d8a263a99f4222d">getWebAssemblyTargetMachine</a>(), <a href="/docs/api/classes/llvm/targetpassconfig/#a4c36a5c58e6e55c962d2d9bed0bb3ba7">getOptLevel</a>()));</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Run the argument-move pass immediately after the ScheduleDAG scheduler</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so that we can fix up the ARGUMENT instructions before anything else</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sees them in the wrong place.</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#aa4921d475e5ec77dd27b415732f9332f">createWebAssemblyArgumentMove</a>());</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the p2align operands. This information is present during ISel, however</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it&#39;s inconvenient to collect. Collect it now, and update the immediate</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operands.</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a9b5102a65a75df00b435532bc0f5f7e1">createWebAssemblySetP2AlignOperands</a>());</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eliminate range checks and add default targets to br&#95;table instructions.</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a2d48c5e621cd205d741f520816391b27">createWebAssemblyFixBrTableDefaults</a>());</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unreachable is terminator, non-terminator instruction after it is not</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allowed.</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a96d74c1aa5860b8366cbce34d25a2b1e">createWebAssemblyCleanCodeAfterTrap</a>());</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a9f6b6d0dd0f7cd87c0f0942670254d75"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a9f6b6d0dd0f7cd87c0f0942670254d75">WebAssemblyPassConfig::addOptimizedRegAlloc</a>() &#123;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Currently RegisterCoalesce degrades wasm debug info quality by a</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// significant margin. As a quick fix, disable this for -O1, which is often</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// used for debugging large applications. Disabling this increases code size</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of Emscripten core benchmarks by ~5%, which is acceptable for -O1, which is</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// usually not used for production builds.</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO Investigate why RegisterCoalesce degrades debug info quality and fix</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it properly</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/targetpassconfig/#a4c36a5c58e6e55c962d2d9bed0bb3ba7">getOptLevel</a>() == <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2a1cfdf0e8d0c87a228c1f40d9bee7888b">CodeGenOptLevel::Less</a>)</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a1a97dc750eaae6c6c05a7f2ab03cdffc">RegisterCoalescerID</a>);</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a6481662c2fc1eb7d95b5a32939e24b94">TargetPassConfig::addOptimizedRegAlloc</a>();</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a78f5786247e095df8dd18dbd7325b56d"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a78f5786247e095df8dd18dbd7325b56d">WebAssemblyPassConfig::addPostRegAlloc</a>() &#123;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: The following CodeGen passes don&#39;t currently support code containing</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// virtual registers. Consider removing their restrictions and re-enabling</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them.</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// These functions all require the NoVRegs property.</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a6d504656f6cc4feb09837a202a4bac92">MachineLateInstrsCleanupID</a>);</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#af5dc78ed1fd5966782d85bf389333790">MachineCopyPropagationID</a>);</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a8d5462b10402ee83291fda8b0b74f437">PostRAMachineSinkingID</a>);</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a3f5fd09bcdb3ea958016747ab1e9f4f7">PostRASchedulerID</a>);</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a85d339220c3769c26cc027fe4cc4dfee">FuncletLayoutID</a>);</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a805432189f97152d1899d08945204faa">StackMapLivenessID</a>);</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a3ddae16561e646c4cbadec7e4fb5308b">PatchableFunctionID</a>);</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a6bfbf70fac2ed039c8bd6b3b0d168117">ShrinkWrapID</a>);</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#a40e93d6a1c6ab9b6b1b7ba3a391336cf">RemoveLoadsIntoFakeUsesID</a>);</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This pass hurts code size for wasm because it can generate irreducible</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// control flow.</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a978dba92612e01044c907d34c66f65b0">disablePass</a>(&amp;<a href="/docs/api/namespaces/llvm/#adc14e69cab3ee0a21fdfdd40632b7ee1">MachineBlockPlacementID</a>);</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a40a9d9de0a8ca42af17c54cf1272fd11">TargetPassConfig::addPostRegAlloc</a>();</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#ab4beb7113336e36d1a81ae2ca8ca6d52"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#ab4beb7113336e36d1a81ae2ca8ca6d52">WebAssemblyPassConfig::addPreEmitPass</a>() &#123;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a665aaee703109520c639696e02283bb8">TargetPassConfig::addPreEmitPass</a>();</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Nullify DBG&#95;VALUE&#95;LISTs that we cannot handle.</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#aee08bf9374b83dcbcaa5ecbca0ab0e8b">createWebAssemblyNullifyDebugValueLists</a>());</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eliminate multiple-entry loops.</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#af9ca35b245dba6c3ae892b4bb4d79ea4">WasmDisableFixIrreducibleControlFlowPass</a>)</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#ab4082580a16cdd0171d1c17c3d03535f">createWebAssemblyFixIrreducibleControlFlow</a>());</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do various transformations for exception handling.</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Every CFG-changing optimizations should come before this.</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/targetpassconfig/#a0e43f614336b22347dfdb6f20ea792df">TM</a>-&gt;Options.ExceptionModel == <a href="/docs/api/namespaces/llvm/#a2ca3855108426698ff21517a7c884c84af93da81fd23e2eeaf8de29b04bb2399f">ExceptionHandling::Wasm</a>)</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a1b34b4bdfacbc367ce389cbd3fb22abf">createWebAssemblyLateEHPrepare</a>());</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we have a prologue and epilogue and all frame indices are</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// rewritten, eliminate SP and FP. This allows them to be stackified,</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// colored, and numbered with the rest of the registers.</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a53fb2b9c991b9bb819e83e832ab08fbc">createWebAssemblyReplacePhysRegs</a>());</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Preparations and optimizations related to register stackification.</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/targetpassconfig/#a4c36a5c58e6e55c962d2d9bed0bb3ba7">getOptLevel</a>() != <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2a6adf97f83acf6453d4a6a4b1070f3754">CodeGenOptLevel::None</a>) &#123;</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Depend on LiveIntervals and perform some optimizations on it.</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a8be5057891baee5adc419b8eb8f00761">createWebAssemblyOptimizeLiveIntervals</a>());</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Prepare memory intrinsic calls for register stackifying.</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a68b9826bc2af8da490dc149adea748b0">createWebAssemblyMemIntrinsicResults</a>());</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark registers as representing wasm&#39;s value stack. This is a key</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// code-compression technique in WebAssembly. We run this pass (and</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MemIntrinsicResults above) very late, so that it sees as much code as</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// possible, including code emitted by PEI and expanded by late tail</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// duplication.</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#adf7b86fff2d721a15fa770725b1aed20">createWebAssemblyRegStackify</a>());</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Run the register coloring pass to reduce the total number of registers.</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This runs after stackification so that it doesn&#39;t consider registers</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that become stackified.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#acd0fc1dbfadc0283e0538c9504d4c121">createWebAssemblyRegColoring</a>());</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort the blocks of the CFG into topological order, a prerequisite for</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BLOCK and LOOP markers.</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#adf9103686d41f4a217562f0bf8eddd9f">createWebAssemblyCFGSort</a>());</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert BLOCK and LOOP markers.</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a8acc0cde2aca7b9cb00194eb3dc0434d">createWebAssemblyCFGStackify</a>());</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert explicit local.get and local.set operators.</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ac16f99939d8bae4daf4d01bda3e30382">WasmDisableExplicitLocals</a>)</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#aa818251d10a37ed7bf44d481a91e84d2">createWebAssemblyExplicitLocals</a>());</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lower br&#95;unless into br&#95;if.</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#ac426e330c55fa7ddb80983694dbf8d74">createWebAssemblyLowerBrUnless</a>());</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Perform the very last peephole optimizations on the code.</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/targetpassconfig/#a4c36a5c58e6e55c962d2d9bed0bb3ba7">getOptLevel</a>() != <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2a6adf97f83acf6453d4a6a4b1070f3754">CodeGenOptLevel::None</a>)</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#afdda771c29c731ed97c8f8c9ca72afe5">createWebAssemblyPeephole</a>());</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a mapping from LLVM CodeGen virtual registers to wasm registers.</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a0fc3701c4bf3de3a7654a55456282f4f">createWebAssemblyRegNumbering</a>());</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fix debug&#95;values whose defs have been stackified.</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ac16f99939d8bae4daf4d01bda3e30382">WasmDisableExplicitLocals</a>)</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a70893708760a1240a62799b05f9c056e">createWebAssemblyDebugFixup</a>());</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect information to prepare for MC lowering / asm printing.</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#ad4fce2f188b884af3d5825755e000e4e">createWebAssemblyMCLowerPrePass</a>());</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646" lineLink="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a8f9c04ecca87ed6772df9d6bb27c836b"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-webassemblytargetmachine-cpp-/webassemblypassconfig/#a8f9c04ecca87ed6772df9d6bb27c836b">WebAssemblyPassConfig::addPreISel</a>() &#123;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#a4c4939ec0b463c69e5776eb3f336a964">TargetPassConfig::addPreISel</a>();</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig/#ab2ca200281996a1a8bc064d21d4aa238">addPass</a>(<a href="/docs/api/namespaces/llvm/#a0f4ddc2e50b58934940fdd548c9b8655">createWebAssemblyLowerRefTypesIntPtrConv</a>());</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/yaml/machinefunctioninfo">yaml::MachineFunctionInfo</a> &#42;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a0195626aaa892d3e13e560237694ab6e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/webassemblytargetmachine/#a0195626aaa892d3e13e560237694ab6e">WebAssemblyTargetMachine::createDefaultFuncInfoYAML</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/yaml/webassemblyfunctioninfo">yaml::WebAssemblyFunctionInfo</a>();</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#aad505019362a8cf081bda4ca50f0092d"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/yaml/machinefunctioninfo">yaml::MachineFunctionInfo</a> &#42;<a href="/docs/api/classes/llvm/webassemblytargetmachine/#aad505019362a8cf081bda4ca50f0092d">WebAssemblyTargetMachine::convertFuncInfoToYAML</a>(</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/webassemblyfunctioninfo">WebAssemblyFunctionInfo</a>&gt;();</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/yaml/webassemblyfunctioninfo">yaml::WebAssemblyFunctionInfo</a>(MF, &#42;MFI);</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663" lineLink="/docs/api/classes/llvm/webassemblytargetmachine/#a1f105b1ab02dcb52f17181b399c004f2"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/webassemblytargetmachine/#a1f105b1ab02dcb52f17181b399c004f2">WebAssemblyTargetMachine::parseMachineFunctionInfo</a>(</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/yaml/machinefunctioninfo">yaml::MachineFunctionInfo</a> &amp;MFI, <a href="/docs/api/structs/llvm/perfunctionmiparsingstate">PerFunctionMIParsingState</a> &amp;PFS,</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smdiagnostic">SMDiagnostic</a> &amp;<a href="/docs/api/classes/llvm/error">Error</a>, <a href="/docs/api/classes/llvm/smrange">SMRange</a> &amp;SourceRange)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;YamlMFI = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeyword">const </span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/yaml/webassemblyfunctioninfo">yaml::WebAssemblyFunctionInfo</a> &amp;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(MFI);</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF = PFS.<a href="/docs/api/structs/llvm/perfunctionmiparsingstate/#ae7f8c6f160583712d2adaafb4cca24fe">MF</a>;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/webassemblyfunctioninfo">WebAssemblyFunctionInfo</a>&gt;()-&gt;initializeBaseYamlFields(MF, YamlMFI);</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
