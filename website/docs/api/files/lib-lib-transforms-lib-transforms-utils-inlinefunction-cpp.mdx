---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `InlineFunction.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/iterator_range.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CallGraph.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/callgraph-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CaptureTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/capturetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CtxProfAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/ctxprofanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/IndirectCallVisitor.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/indirectcallvisitor-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemoryProfileInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryprofileinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ObjCARCAnalysisUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcanalysisutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ObjCARCUtil.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcutil-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Argument.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/AttributeMask.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributemask-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ConstantRange.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugLoc.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/EHPersonalities.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InlineAsm.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/inlineasm-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ProfDataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/AssumeBundleBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/assumebundlebuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Cloning.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ValueMapper.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/valuemapper-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="deque"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="limits"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="string"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-inlinefunction-cpp-">anonymous&#123;InlineFunction.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo">LandingPadInliningInfo</a></>}>
A class for recording information about inlining a landing pad. <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner">ScopedAliasMetadataDeepCloner</a></>}>
Utility for cloning !noalias and !alias.scope metadata. <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> = <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#aa35af336fee32786b6551e23d5b55fcf">AddAliasScopeMetadata</a> (CallBase &amp;CB, ValueToValueMapTy &amp;VMap, const DataLayout &amp;DL, AAResults &#42;CalleeAAR, ClonedCodeInfo &amp;InlinedFunctionInfo)</>}>
If the inlined function has noalias arguments, then add new alias scopes for each noalias argument, tag the mapped noalias parameters with noalias metadata specifying the new scope, and tag all non-derived loads, stores and memory intrinsics with the new alias scopes. <a href="#aa35af336fee32786b6551e23d5b55fcf">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae54a643a9f9d83374bb4d7d22d4662d7">AddAlignmentAssumptions</a> (CallBase &amp;CB, InlineFunctionInfo &amp;IFI)</>}>
If the inlined function has non-byval align arguments, then add @llvm.assume-based alignment assumptions to preserve this information. <a href="#ae54a643a9f9d83374bb4d7d22d4662d7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af1986bc1d2d700807f4c8ef167bf6fdd">AddParamAndFnBasicAttributes</a> (const CallBase &amp;CB, ValueToValueMapTy &amp;VMap, ClonedCodeInfo &amp;InlinedFunctionInfo)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8843a51d7d6aaf2e81c17ae86f86d3f6">AddReturnAttributes</a> (CallBase &amp;CB, ValueToValueMapTy &amp;VMap, ClonedCodeInfo &amp;InlinedFunctionInfo)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad19c97a069133d179234826fc95c3bde">allocaWouldBeStaticInEntry</a> (const AllocaInst &#42;AI)</>}>
Return the result of AI-&gt;isStaticAlloca() if AI were moved to the entry block. <a href="#ad19c97a069133d179234826fc95c3bde">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/at/#ae216cdb7393c1e862a61c8da9c1508ed">at::StorageToVarsMap</a></>}
  name={<><a href="#a2ebf7459caf9252729048bd9c5231f6c">collectEscapedLocals</a> (const DataLayout &amp;DL, const CallBase &amp;CB)</>}>
Find Alloca and linked <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> for locals escaped by <code>CB</code>. <a href="#a2ebf7459caf9252729048bd9c5231f6c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ac6ad5b09bf38c4fc9d0c8a5b598fde3c">fixupAssignments</a> (Function::iterator Start, Function::iterator End)</>}>
Update inlined instructions&#39; <a href="/docs/api/classes/llvm/diassignid">DIAssignID</a> metadata. <a href="#ac6ad5b09bf38c4fc9d0c8a5b598fde3c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a2ed4f37fbda15a9c05f333fde59e9fbb">fixupLineNumbers</a> (Function &#42;Fn, Function::iterator FI, Instruction &#42;TheCall, bool CalleeHasDebugInfo)</>}>
Update inlined instructions&#39; line numbers to to encode location where these instructions are inlined. <a href="#a2ed4f37fbda15a9c05f333fde59e9fbb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;</>}
  name={<><a href="#aac60599e6b45dd035fa354b12afdd195">getConvergenceEntry</a> (BasicBlock &amp;BB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a> (Value &#42;EHPad)</>}>
Helper for getUnwindDestToken/getUnwindDestTokenHelper. <a href="#ac12dacafa8a30b2f9bfed5f3a022a612">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a3cc72cfbc837c8e89491b6357c358778">getUnwindDestToken</a> (Instruction &#42;EHPad, UnwindDestMemoTy &amp;MemoMap)</>}>
Given an EH pad, find where it unwinds. <a href="#a3cc72cfbc837c8e89491b6357c358778">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a4e19285f051b80099ed8b36c5c94eaf2">getUnwindDestTokenHelper</a> (Instruction &#42;EHPad, UnwindDestMemoTy &amp;MemoMap)</>}>
Helper for getUnwindDestToken that does the descendant-ward part of the search. <a href="#a4e19285f051b80099ed8b36c5c94eaf2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ae2ebbbbc990e3d932da5d0d0ea255f42">HandleByValArgument</a> (Type &#42;ByValType, Value &#42;Arg, Instruction &#42;TheCall, const Function &#42;CalledFunc, InlineFunctionInfo &amp;IFI, MaybeAlign ByValAlignment)</>}>
When inlining a call site that has a byval argument, we have to make the implicit memcpy explicit by adding it. <a href="#ae2ebbbbc990e3d932da5d0d0ea255f42">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a94b383e649f60242503ff47c799fd22e">HandleByValArgumentInit</a> (Type &#42;ByValType, Value &#42;Dst, Value &#42;Src, Module &#42;M, BasicBlock &#42;InsertBlock, InlineFunctionInfo &amp;IFI, Function &#42;CalledFunc)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</>}
  name={<><a href="#a4ea5b2388bd9dc7e7fc902b5bd1e35e4">HandleCallsInBlockInlinedThroughInvoke</a> (BasicBlock &#42;BB, BasicBlock &#42;UnwindEdge, UnwindDestMemoTy &#42;FuncletUnwindMap=nullptr)</>}>
When we inline a basic block into an invoke, we have to turn all of the calls that can throw into invokes. <a href="#a4ea5b2388bd9dc7e7fc902b5bd1e35e4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aac69c9cf4e552a52d5065e94dc023f82">HandleInlinedEHPad</a> (InvokeInst &#42;II, BasicBlock &#42;FirstNewBlock, ClonedCodeInfo &amp;InlinedCodeInfo)</>}>
If we inlined an invoke site, we need to convert calls in the body of the inlined function into invokes. <a href="#aac69c9cf4e552a52d5065e94dc023f82">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4cbd6aad6f6b93f79dc435feab77550e">HandleInlinedLandingPad</a> (InvokeInst &#42;II, BasicBlock &#42;FirstNewBlock, ClonedCodeInfo &amp;InlinedCodeInfo)</>}>
If we inlined an invoke site, we need to convert calls in the body of the inlined function into invokes. <a href="#a4cbd6aad6f6b93f79dc435feab77550e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#afaa78d0b3224d3175937f997dc2bc688">hasLifetimeMarkers</a> (AllocaInst &#42;AI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af7016ec74e60284d198d9b70ec8f1ab2">haveCommonPrefix</a> (MDNode &#42;MIBStackContext, MDNode &#42;CallsiteStackContext)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="AttrBuilder"
  name={<><a href="#a7e0764cee9d3754f276a61e53da1c2b4">IdentifyValidPoisonGeneratingAttributes</a> (CallBase &amp;CB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="AttrBuilder"
  name={<><a href="#a006ce5c0c5ec18c589454f270a335a3c">IdentifyValidUBGeneratingAttributes</a> (CallBase &amp;CB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/debugloc">DebugLoc</a></>}
  name={<><a href="#a5217abbfbac8873d22a2dd6cdbb0bcc1">inlineDebugLoc</a> (DebugLoc OrigDL, DILocation &#42;InlinedAt, LLVMContext &amp;Ctx, DenseMap&lt; const MDNode &#42;, MDNode &#42; &gt; &amp;IANodes)</>}>
Returns a <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> for a new <a href="/docs/api/classes/llvm/dilocation">DILocation</a> which is a clone of <code>OrigDL</code> inlined at <code>InlinedAt</code>. <a href="#a5217abbfbac8873d22a2dd6cdbb0bcc1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#abf4fabc264b52dbd503f04805135a40e">inlineRetainOrClaimRVCalls</a> (CallBase &amp;CB, objcarc::ARCInstKind RVCallKind, const SmallVectorImpl&lt; ReturnInst &#42; &gt; &amp;Returns)</>}>
An operand bundle &quot;clang.arc.attachedcall&quot; on a call indicates the call result is implicitly consumed by a call to retainRV or claimRV immediately after the call. <a href="#abf4fabc264b52dbd503f04805135a40e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae21f217cd2f8044e639f13111a0b37db">isUsedByLifetimeMarker</a> (Value &#42;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a91afe718c3cb2b248f39e1fd250ac91a">MayContainThrowingOrExitingCallAfterCB</a> (CallBase &#42;Begin, ReturnInst &#42;End)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a74b8b820b4b2d53dd53ba32821887473">PropagateCallSiteMetadata</a> (CallBase &amp;CB, Function::iterator FStart, Function::iterator FEnd)</>}>
When inlining a call site that has !llvm.mem.parallel&#95;loop&#95;access, !llvm.access.group, !alias.scope or !noalias metadata, that metadata should be propagated to all memory-accessing cloned instructions. <a href="#a74b8b820b4b2d53dd53ba32821887473">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a380713e3d0da9090dbc68193076703b7">propagateMemProfHelper</a> (const CallBase &#42;OrigCall, CallBase &#42;ClonedCall, MDNode &#42;InlinedCallsiteMD)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a81fe0543b342a120ede7c69eeed77729">propagateMemProfMetadata</a> (Function &#42;Callee, CallBase &amp;CB, bool ContainsMemProfMetadata, const ValueMap&lt; const Value &#42;, WeakTrackingVH &gt; &amp;VMap)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af939eab05ffe67221645aab1342156b2">PropagateOperandBundles</a> (Function::iterator InlinedBB, Instruction &#42;CallSiteEHPad)</>}>
Bundle operands of the inlined function must be added to inlined call sites. <a href="#af939eab05ffe67221645aab1342156b2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> std::pair&lt; <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; int64&#95;t &gt;, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; int64&#95;t &gt; &gt;</>}
  name={<><a href="#aa46864b5ba9d7d71163e2f00ab1cddf5">remapIndices</a> (Function &amp;Caller, BasicBlock &#42;StartBB, PGOContextualProfile &amp;CtxProf, uint32&#95;t CalleeCounters, uint32&#95;t CalleeCallsites)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a32f2884ce25dcf448fbb3fb0a57396ff">removeCallsiteMetadata</a> (CallBase &#42;Call)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae2c447e52415219501221037474b9893">removeMemProfMetadata</a> (CallBase &#42;Call)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae71573dba191b26eda0d5ea27b81ef62">trackInlinedStores</a> (Function::iterator Start, Function::iterator End, const CallBase &amp;CB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a83a2e4a8c4f5b3b8dee5407d55e8872d">updateCallerBFI</a> (BasicBlock &#42;CallSiteBlock, const ValueToValueMapTy &amp;VMap, BlockFrequencyInfo &#42;CallerBFI, BlockFrequencyInfo &#42;CalleeBFI, const BasicBlock &amp;CalleeEntryBlock)</>}>
Update the block frequencies of the caller after a callee has been inlined. <a href="#a83a2e4a8c4f5b3b8dee5407d55e8872d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8385c2a142c1616d8d486bcb93213649">updateCallProfile</a> (Function &#42;Callee, const ValueToValueMapTy &amp;VMap, const ProfileCount &amp;CalleeEntryCount, const CallBase &amp;TheCall, ProfileSummaryInfo &#42;PSI, BlockFrequencyInfo &#42;CallerBFI)</>}>
Update the branch metadata for cloned call instructions. <a href="#a8385c2a142c1616d8d486bcb93213649">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#afbf6d60618e520079ded1612a2941fbe">updateMemprofMetadata</a> (CallBase &#42;CI, const std::vector&lt; Metadata &#42; &gt; &amp;MIBList)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a9925d445b976109ecb491c6faa297dc3">EnableNoAliasConversion</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#aec465f9b6ed2ec0a1a2ff413df2f0bb7">InlinerAttributeWindow</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a4224e0e010bb5413dc74243c276724f5">PreserveAlignmentAssumptions</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a5b2763517e31bab717a06a5137de8f72">UseNoAliasIntrinsic</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;inline-function&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;assignment-tracking&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;inline-function&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### UnwindDestMemoTy {#a2af37358cf937d4298f5c5198bf91d34}

<MemberDefinition
  prototype={<>using UnwindDestMemoTy =  DenseMap&lt;Instruction &#42;, Value &#42;&gt;</>}>

Definition at line <a href="#l00261">261</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### AddAliasScopeMetadata() {#aa35af336fee32786b6551e23d5b55fcf}

<MemberDefinition
  prototype={<>static void AddAliasScopeMetadata (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp; VMap, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42; CalleeAAR, <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp; InlinedFunctionInfo)</>}
  labels = {["static"]}>
If the inlined function has noalias arguments, then add new alias scopes for each noalias argument, tag the mapped noalias parameters with noalias metadata specifying the new scope, and tag all non-derived loads, stores and memory intrinsics with the new alias scopes.

Definition at line <a href="#l01113">1113</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### AddAlignmentAssumptions() {#ae54a643a9f9d83374bb4d7d22d4662d7}

<MemberDefinition
  prototype={<>static void AddAlignmentAssumptions (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp; IFI)</>}
  labels = {["static"]}>
If the inlined function has non-byval align arguments, then add @llvm.assume-based alignment assumptions to preserve this information.

Definition at line <a href="#l01664">1664</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### AddParamAndFnBasicAttributes() {#af1986bc1d2d700807f4c8ef167bf6fdd}

<MemberDefinition
  prototype={<>static void AddParamAndFnBasicAttributes (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp; VMap, <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp; InlinedFunctionInfo)</>}
  labels = {["static"]}>

Definition at line <a href="#l01369">1369</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### AddReturnAttributes() {#a8843a51d7d6aaf2e81c17ae86f86d3f6}

<MemberDefinition
  prototype={<>static void AddReturnAttributes (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp; VMap, <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp; InlinedFunctionInfo)</>}
  labels = {["static"]}>

Definition at line <a href="#l01541">1541</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### allocaWouldBeStaticInEntry() {#ad19c97a069133d179234826fc95c3bde}

<MemberDefinition
  prototype={<>static bool allocaWouldBeStaticInEntry (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; AI)</>}
  labels = {["static"]}>
Return the result of AI-&gt;isStaticAlloca() if AI were moved to the entry block.

Allocas used in inalloca calls and allocas of dynamic array size cannot be static.

Definition at line <a href="#l01808">1808</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### collectEscapedLocals() {#a2ebf7459caf9252729048bd9c5231f6c}

<MemberDefinition
  prototype={<>static at::StorageToVarsMap collectEscapedLocals (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB)</>}
  labels = {["static"]}>
Find Alloca and linked <a href="/docs/api/classes/llvm/dbgassignintrinsic">DbgAssignIntrinsic</a> for locals escaped by <code>CB</code>.

Definition at line <a href="#l01933">1933</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### fixupAssignments() {#ac6ad5b09bf38c4fc9d0c8a5b598fde3c}

<MemberDefinition
  prototype={<>static void fixupAssignments (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> Start, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> End)</>}
  labels = {["static"]}>
Update inlined instructions&#39; <a href="/docs/api/classes/llvm/diassignid">DIAssignID</a> metadata.

We need to do this otherwise a function inlined more than once into the same function will cause <a href="/docs/api/classes/llvm/diassignid">DIAssignID</a> to be shared by many instructions.

Definition at line <a href="#l01995">1995</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### fixupLineNumbers() {#a2ed4f37fbda15a9c05f333fde59e9fbb}

<MemberDefinition
  prototype={<>static void fixupLineNumbers (<a href="/docs/api/classes/llvm/function">Function</a> &#42; Fn, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; TheCall, bool CalleeHasDebugInfo)</>}
  labels = {["static"]}>
Update inlined instructions&#39; line numbers to to encode location where these instructions are inlined.

Definition at line <a href="#l01824">1824</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### getConvergenceEntry() {#aac60599e6b45dd035fa354b12afdd195}

<MemberDefinition
  prototype={<>static IntrinsicInst &#42; getConvergenceEntry (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; BB)</>}
  labels = {["static"]}>

Definition at line <a href="#l00186">186</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### getParentPad() {#ac12dacafa8a30b2f9bfed5f3a022a612}

<MemberDefinition
  prototype={<>static Value &#42; getParentPad (<a href="/docs/api/classes/llvm/value">Value</a> &#42; EHPad)</>}
  labels = {["static"]}>
Helper for getUnwindDestToken/getUnwindDestTokenHelper.

Definition at line <a href="#l00255">255</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### getUnwindDestToken() {#a3cc72cfbc837c8e89491b6357c358778}

<MemberDefinition
  prototype={<>static Value &#42; getUnwindDestToken (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; EHPad, <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> &amp; MemoMap)</>}
  labels = {["static"]}>
Given an EH pad, find where it unwinds.

If it unwinds to an EH pad, return that pad instruction. If it unwinds to caller, return <a href="/docs/api/classes/llvm/constanttokennone">ConstantTokenNone</a>. If it does not have a definitive unwind destination, return nullptr.

This routine gets invoked for calls in funclets in inlinees when inlining an invoke. Since many funclets don&#39;t have calls inside them, it&#39;s queried on-demand rather than building a map of pads to unwind dests up front. Determining a funclet&#39;s unwind dest may require recursively searching its descendants, and also ancestors and cousins if the descendants don&#39;t provide an answer. Since most funclets will have their unwind dest immediately available as the unwind dest of a catchswitch or cleanupret, this routine searches top-down from the given pad and then up. To avoid worst-case quadratic run-time given that approach, it uses a memo map to avoid re-processing funclet trees. The callers that rewrite the IR as they go take advantage of this, for correctness, by checking/forcing rewritten pads&#39; entries to match the original callee view.

Definition at line <a href="#l00417">417</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### getUnwindDestTokenHelper() {#a4e19285f051b80099ed8b36c5c94eaf2}

<MemberDefinition
  prototype={<>static Value &#42; getUnwindDestTokenHelper (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; EHPad, <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> &amp; MemoMap)</>}
  labels = {["static"]}>
Helper for getUnwindDestToken that does the descendant-ward part of the search.

Definition at line <a href="#l00265">265</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### HandleByValArgument() {#ae2ebbbbc990e3d932da5d0d0ea255f42}

<MemberDefinition
  prototype={<>static Value &#42; HandleByValArgument (<a href="/docs/api/classes/llvm/type">Type</a> &#42; ByValType, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Arg, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; TheCall, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/function">Function</a> &#42; CalledFunc, <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp; IFI, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> ByValAlignment)</>}
  labels = {["static"]}>
When inlining a call site that has a byval argument, we have to make the implicit memcpy explicit by adding it.

Definition at line <a href="#l01726">1726</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### HandleByValArgumentInit() {#a94b383e649f60242503ff47c799fd22e}

<MemberDefinition
  prototype={<>static void HandleByValArgumentInit (<a href="/docs/api/classes/llvm/type">Type</a> &#42; ByValType, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Dst, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Src, <a href="/docs/api/classes/llvm/module">Module</a> &#42; M, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; InsertBlock, <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp; IFI, <a href="/docs/api/classes/llvm/function">Function</a> &#42; CalledFunc)</>}
  labels = {["static"]}>

Definition at line <a href="#l01701">1701</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### HandleCallsInBlockInlinedThroughInvoke() {#a4ea5b2388bd9dc7e7fc902b5bd1e35e4}

<MemberDefinition
  prototype={<>static BasicBlock &#42; HandleCallsInBlockInlinedThroughInvoke (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; UnwindEdge, <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> &#42; FuncletUnwindMap=nullptr)</>}
  labels = {["static"]}>
When we inline a basic block into an invoke, we have to turn all of the calls that can throw into invokes.

This function analyze BB to see if there are any calls, and if so, it rewrites them to be invokes that jump to InvokeDest and fills in the PHI nodes in that block with the values specified in InvokeDestPHIValues.

Definition at line <a href="#l00561">561</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### HandleInlinedEHPad() {#aac69c9cf4e552a52d5065e94dc023f82}

<MemberDefinition
  prototype={<>static void HandleInlinedEHPad (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42; II, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; FirstNewBlock, <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp; InlinedCodeInfo)</>}
  labels = {["static"]}>
If we inlined an invoke site, we need to convert calls in the body of the inlined function into invokes.

II is the invoke instruction being inlined. FirstNewBlock is the first block of the inlined code (the last block is the end of the function), and InlineCodeInfo is information about the code that got inlined.

Definition at line <a href="#l00677">677</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### HandleInlinedLandingPad() {#a4cbd6aad6f6b93f79dc435feab77550e}

<MemberDefinition
  prototype={<>static void HandleInlinedLandingPad (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42; II, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; FirstNewBlock, <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp; InlinedCodeInfo)</>}
  labels = {["static"]}>
If we inlined an invoke site, we need to convert calls in the body of the inlined function into invokes.

II is the invoke instruction being inlined. FirstNewBlock is the first block of the inlined code (the last block is the end of the function), and InlineCodeInfo is information about the code that got inlined.

Definition at line <a href="#l00620">620</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### hasLifetimeMarkers() {#afaa78d0b3224d3175937f997dc2bc688}

<MemberDefinition
  prototype={<>static bool hasLifetimeMarkers (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; AI)</>}
  labels = {["static"]}>

Definition at line <a href="#l01788">1788</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### haveCommonPrefix() {#af7016ec74e60284d198d9b70ec8f1ab2}

<MemberDefinition
  prototype={<>static bool haveCommonPrefix (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; MIBStackContext, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; CallsiteStackContext)</>}
  labels = {["static"]}>

Definition at line <a href="#l00800">800</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### IdentifyValidPoisonGeneratingAttributes() {#a7e0764cee9d3754f276a61e53da1c2b4}

<MemberDefinition
  prototype={<>static AttrBuilder IdentifyValidPoisonGeneratingAttributes (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01530">1530</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### IdentifyValidUBGeneratingAttributes() {#a006ce5c0c5ec18c589454f270a335a3c}

<MemberDefinition
  prototype={<>static AttrBuilder IdentifyValidUBGeneratingAttributes (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01515">1515</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### inlineDebugLoc() {#a5217abbfbac8873d22a2dd6cdbb0bcc1}

<MemberDefinition
  prototype={<>static DebugLoc inlineDebugLoc (<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> OrigDL, <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42; InlinedAt, <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp; Ctx, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; &gt; &amp; IANodes)</>}
  labels = {["static"]}>
Returns a <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> for a new <a href="/docs/api/classes/llvm/dilocation">DILocation</a> which is a clone of <code>OrigDL</code> inlined at <code>InlinedAt</code>.

<code>IANodes</code> is an inlined-at cache.

Definition at line <a href="#l01814">1814</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### inlineRetainOrClaimRVCalls() {#abf4fabc264b52dbd503f04805135a40e}

<MemberDefinition
  prototype={<>static void inlineRetainOrClaimRVCalls (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">objcarc::ARCInstKind</a> RVCallKind, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42; &gt; &amp; Returns)</>}
  labels = {["static"]}>
An operand bundle &quot;clang.arc.attachedcall&quot; on a call indicates the call result is implicitly consumed by a call to retainRV or claimRV immediately after the call.

This function inlines the retainRV/claimRV calls.

There are three cases to consider:


<ul>
<li>If there is a call to autoreleaseRV that takes a pointer to the returned object in the callee return block, the autoreleaseRV call and the retainRV/claimRV call in the caller cancel out. If the call in the caller is a claimRV call, a call to objc&#95;release is emitted.</li>
<li>If there is a call in the callee return block that doesn&#39;t have operand bundle &quot;clang.arc.attachedcall&quot;, the operand bundle on the original call is transferred to the call in the callee.</li>
<li>Otherwise, a call to objc&#95;retain is inserted if the call in the caller is a retainRV call.</li>
</ul>

Definition at line <a href="#l02132">2132</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### isUsedByLifetimeMarker() {#ae21f217cd2f8044e639f13111a0b37db}

<MemberDefinition
  prototype={<>static bool isUsedByLifetimeMarker (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l01778">1778</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### MayContainThrowingOrExitingCallAfterCB() {#a91afe718c3cb2b248f39e1fd250ac91a}

<MemberDefinition
  prototype={<>static bool MayContainThrowingOrExitingCallAfterCB (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42; Begin, <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42; End)</>}
  labels = {["static"]}>

Definition at line <a href="#l01356">1356</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### PropagateCallSiteMetadata() {#a74b8b820b4b2d53dd53ba32821887473}

<MemberDefinition
  prototype={<>static void PropagateCallSiteMetadata (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FStart, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FEnd)</>}
  labels = {["static"]}>
When inlining a call site that has !llvm.mem.parallel&#95;loop&#95;access, !llvm.access.group, !alias.scope or !noalias metadata, that metadata should be propagated to all memory-accessing cloned instructions.

Definition at line <a href="#l00934">934</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### propagateMemProfHelper() {#a380713e3d0da9090dbc68193076703b7}

<MemberDefinition
  prototype={<>static void propagateMemProfHelper (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42; OrigCall, <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42; ClonedCall, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; InlinedCallsiteMD)</>}
  labels = {["static"]}>

Definition at line <a href="#l00848">848</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### propagateMemProfMetadata() {#a81fe0543b342a120ede7c69eeed77729}

<MemberDefinition
  prototype={<>static void propagateMemProfMetadata (<a href="/docs/api/classes/llvm/function">Function</a> &#42; Callee, <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, bool ContainsMemProfMetadata, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/valuemap">ValueMap</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> &gt; &amp; VMap)</>}
  labels = {["static"]}>

Definition at line <a href="#l00902">902</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### PropagateOperandBundles() {#af939eab05ffe67221645aab1342156b2}

<MemberDefinition
  prototype={<>static void PropagateOperandBundles (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> InlinedBB, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; CallSiteEHPad)</>}
  labels = {["static"]}>
Bundle operands of the inlined function must be added to inlined call sites.

Definition at line <a href="#l00975">975</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### remapIndices() {#aa46864b5ba9d7d71163e2f00ab1cddf5}

<MemberDefinition
  prototype={<>static const std::pair&lt; std::vector&lt; int64&#95;t &gt;, std::vector&lt; int64&#95;t &gt; &gt; remapIndices (<a href="/docs/api/classes/llvm/function">Function</a> &amp; Caller, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; StartBB, <a href="/docs/api/classes/llvm/pgocontextualprofile">PGOContextualProfile</a> &amp; CtxProf, uint32&#95;t CalleeCounters, uint32&#95;t CalleeCallsites)</>}
  labels = {["static"]}>

Definition at line <a href="#l02226">2226</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### removeCallsiteMetadata() {#a32f2884ce25dcf448fbb3fb0a57396ff}

<MemberDefinition
  prototype={<>static void removeCallsiteMetadata (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42; Call)</>}
  labels = {["static"]}>

Definition at line <a href="#l00825">825</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### removeMemProfMetadata() {#ae2c447e52415219501221037474b9893}

<MemberDefinition
  prototype={<>static void removeMemProfMetadata (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42; Call)</>}
  labels = {["static"]}>

Definition at line <a href="#l00821">821</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### trackInlinedStores() {#ae71573dba191b26eda0d5ea27b81ef62}

<MemberDefinition
  prototype={<>static void trackInlinedStores (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> Start, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> End, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01983">1983</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### updateCallerBFI() {#a83a2e4a8c4f5b3b8dee5407d55e8872d}

<MemberDefinition
  prototype={<>static void updateCallerBFI (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; CallSiteBlock, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp; VMap, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; CallerBFI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; CalleeBFI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; CalleeEntryBlock)</>}
  labels = {["static"]}>
Update the block frequencies of the caller after a callee has been inlined.

Each block cloned into the caller has its block frequency scaled by the ratio of CallSiteFreq/CalleeEntryFreq. This ensures that the cloned copy of callee&#39;s entry block gets the same frequency as the callsite block and the relative frequencies of all cloned blocks remain the same after cloning.

Definition at line <a href="#l02013">2013</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### updateCallProfile() {#a8385c2a142c1616d8d486bcb93213649}

<MemberDefinition
  prototype={<>static void updateCallProfile (<a href="/docs/api/classes/llvm/function">Function</a> &#42; Callee, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp; VMap, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/namespaces/llvm/#a854ac9cfc31bb306b1495a508707dc26">ProfileCount</a> &amp; CalleeEntryCount, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; TheCall, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; CallerBFI)</>}
  labels = {["static"]}>
Update the branch metadata for cloned call instructions.

Definition at line <a href="#l02041">2041</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### updateMemprofMetadata() {#afbf6d60618e520079ded1612a2941fbe}

<MemberDefinition
  prototype={<>static void updateMemprofMetadata (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42; CI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &gt; &amp; MIBList)</>}
  labels = {["static"]}>

Definition at line <a href="#l00829">829</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### EnableNoAliasConversion {#a9925d445b976109ecb491c6faa297dc3}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableNoAliasConversion(&quot;enable-noalias-to-md-conversion&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Convert noalias attributes to metadata during inlining.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00093">93</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### InlinerAttributeWindow {#aec465f9b6ed2ec0a1a2ff413df2f0bb7}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; InlinerAttributeWindow(&quot;max-inst-checked-for-throw-during-inlining&quot;, cl::Hidden, cl::desc(&quot;the maximum number of instructions analyzed for may throw during &quot; &quot;attribute inference in inlined body&quot;), cl::init(4))</>}
  labels = {["static"]}>

Definition at line <a href="#l00111">111</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### PreserveAlignmentAssumptions {#a4224e0e010bb5413dc74243c276724f5}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; PreserveAlignmentAssumptions(&quot;preserve-alignment-assumptions-during-inlining&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Convert align attributes to assumptions during inlining.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00107">107</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### UseNoAliasIntrinsic {#a5b2763517e31bab717a06a5137de8f72}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseNoAliasIntrinsic(&quot;use-noalias-intrinsic-during-inlining&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Use the llvm.experimental.noalias.scope.decl &quot; &quot;intrinsic during inlining.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00098">98</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;inline-function&quot;</>}>

Definition at line <a href="#l00086">86</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;assignment-tracking&quot;</>}>

Definition at line <a href="#l01931">1931</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;inline-function&quot;</>}>

Definition at line <a href="#l02005">2005</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/inlinefunction-cpp">InlineFunction.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- InlineFunction.cpp - Code to perform function inlining -------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This file implements inlining of a function into a call site, resolving</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// parameters and the return value as appropriate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringextras-h">llvm/ADT/StringExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h">llvm/ADT/iterator&#95;range.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h">llvm/Analysis/AliasAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/callgraph-h">llvm/Analysis/CallGraph.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/capturetracking-h">llvm/Analysis/CaptureTracking.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/ctxprofanalysis-h">llvm/Analysis/CtxProfAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/indirectcallvisitor-h">llvm/Analysis/IndirectCallVisitor.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryprofileinfo-h">llvm/Analysis/MemoryProfileInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcanalysisutils-h">llvm/Analysis/ObjCARCAnalysisUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/objcarcutil-h">llvm/Analysis/ObjCARCUtil.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h">llvm/IR/Argument.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributemask-h">llvm/IR/AttributeMask.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h">llvm/IR/ConstantRange.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h">llvm/IR/DebugLoc.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h">llvm/IR/EHPersonalities.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/inlineasm-h">llvm/IR/InlineAsm.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h">llvm/IR/ProfDataUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/assumebundlebuilder-h">llvm/Transforms/Utils/AssumeBundleBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h">llvm/Transforms/Utils/Cloning.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/valuemapper-h">llvm/Transforms/Utils/ValueMapper.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;algorithm&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;deque&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;iterator&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;limits&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;optional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;string&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;vector&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;inline-function&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/memprof">llvm::memprof</a>;</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/#a854ac9cfc31bb306b1495a508707dc26">ProfileCount</a> = <a href="/docs/api/classes/llvm/function/profilecount">Function::ProfileCount</a>;</Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="#a9925d445b976109ecb491c6faa297dc3"><Highlight kind="normal"><a href="#a9925d445b976109ecb491c6faa297dc3">EnableNoAliasConversion</a>(</Highlight><Highlight kind="stringliteral">&quot;enable-noalias-to-md-conversion&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Convert noalias attributes to metadata during inlining.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="#a5b2763517e31bab717a06a5137de8f72"><Highlight kind="normal">    <a href="#a5b2763517e31bab717a06a5137de8f72">UseNoAliasIntrinsic</a>(</Highlight><Highlight kind="stringliteral">&quot;use-noalias-intrinsic-during-inlining&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal">                        <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal">                        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Use the llvm.experimental.noalias.scope.decl &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal">                                 </Highlight><Highlight kind="stringliteral">&quot;intrinsic during inlining.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Disabled by default, because the added alignment assumptions may increase</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal"></Highlight><Highlight kind="comment">// compile-time and block optimizations. This option is not suitable for use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight><Highlight kind="comment">// with frontends that emit comprehensive parameter alignment annotations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#a4224e0e010bb5413dc74243c276724f5"><Highlight kind="normal"><a href="#a4224e0e010bb5413dc74243c276724f5">PreserveAlignmentAssumptions</a>(</Highlight><Highlight kind="stringliteral">&quot;preserve-alignment-assumptions-during-inlining&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Convert align attributes to assumptions during inlining.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111" lineLink="#aec465f9b6ed2ec0a1a2ff413df2f0bb7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#aec465f9b6ed2ec0a1a2ff413df2f0bb7">InlinerAttributeWindow</a>(</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;max-inst-checked-for-throw-during-inlining&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;the maximum number of instructions analyzed for may throw during &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;attribute inference in inlined body&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(4));</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117" lineLink="/docs/api/namespaces/anonymous-inlinefunction-cpp-"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="comment">  /// A class for recording information about inlining a landing pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a95303df5888c9384c3ba02c12ca9cb3e">LandingPadInliningInfo</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="comment">    /// Destination of the invoke&#39;s unwind.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OuterResumeDest;</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="comment">    /// Destination for the callee&#39;s resume.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InnerResumeDest = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="comment">    /// LandingPadInst associated with the invoke.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;CallerLPad = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="comment">    /// PHI for EH values from landingpad insts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;InnerEHValuesPHI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;, 8&gt;</a> UnwindDestPHIValues;</Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a95303df5888c9384c3ba02c12ca9cb3e"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a95303df5888c9384c3ba02c12ca9cb3e">LandingPadInliningInfo</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">        : OuterResumeDest(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest()) &#123;</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If there are PHI nodes in the unwind destination block, we need to keep</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// track of which values came into them from the invoke before removing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the edge from this block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InvokeBB = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OuterResumeDest-&gt;begin();</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Save the value to use for this edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">        UnwindDestPHIValues.push&#95;back(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValueForBlock(InvokeBB));</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">      CallerLPad = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LandingPadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="comment">    /// The outer unwind destination is the target of</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="comment">    /// unwind edges introduced for calls within the inlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a100e0ffc3bc367581b416e2cd64fb6e5"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a100e0ffc3bc367581b416e2cd64fb6e5">getOuterResumeDest</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OuterResumeDest;</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;getInnerResumeDest();</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a41035abb310168a776d59519a7a9f60b"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;<a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a41035abb310168a776d59519a7a9f60b">getLandingPadInst</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CallerLPad; &#125;</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="comment">    /// Forward the &#39;resume&#39; instruction to the caller&#39;s landing pad block.</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="comment">    /// When the landing pad block has only one predecessor, this is</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="comment">    /// a simple branch. When there is more than one predecessor, we need to</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="comment">    /// split the landing pad block after the landingpad instruction and jump</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="comment">    /// to there.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> forwardResume(<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI,</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">                       <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;LandingPadInst&#42;&gt;</a> &amp;InlinedLPads);</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="comment">    /// Add incoming-PHI values to the unwind destination block for the given</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="comment">    /// basic block, using the values for the original invoke&#39;s source block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#aaa376f123b4952dc22ed5c17a2b9402a"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#aaa376f123b4952dc22ed5c17a2b9402a">addIncomingPHIValuesFor</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#aa02431ef258154c74a391cc3c5fd7f8d">addIncomingPHIValuesForInto</a>(BB, OuterResumeDest);</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#aa02431ef258154c74a391cc3c5fd7f8d"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#aa02431ef258154c74a391cc3c5fd7f8d">addIncomingPHIValuesForInto</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;src, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;dest)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = UnwindDestPHIValues.size(); i != e; ++i, ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;phi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">        phi-&gt;addIncoming(UnwindDestPHIValues&#91;i&#93;, src);</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186" lineLink="#aac60599e6b45dd035fa354b12afdd195"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="#aac60599e6b45dd035fa354b12afdd195">getConvergenceEntry</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB) &#123;</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = BB.<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (It != BB.<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IntrinsicCall = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConvergenceControlInst&gt;</a>(It)) &#123;</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrinsicCall-&gt;isEntry()) &#123;</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IntrinsicCall;</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">    It = std::next(It);</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="comment">/// Get or create a target for the branch from ResumeInsts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a232bc3cdcfa2bab0574af9b47ff90c41"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a232bc3cdcfa2bab0574af9b47ff90c41">LandingPadInliningInfo::getInnerResumeDest</a>() &#123;</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InnerResumeDest) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> InnerResumeDest;</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Split the landing pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SplitPoint = ++CallerLPad-&gt;getIterator();</Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">  InnerResumeDest =</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">    OuterResumeDest-&gt;splitBasicBlock(SplitPoint,</Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">                                     OuterResumeDest-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.body&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The number of incoming edges we expect to the inner landing pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> PHICapacity = 2;</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create corresponding new PHIs for all the PHIs in the outer landing pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/classes/llvm/irbuilder">InsertPoint</a> = InnerResumeDest-&gt;begin();</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OuterResumeDest-&gt;begin();</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = UnwindDestPHIValues.size(); i != e; ++i, ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OuterPHI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;InnerPHI = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(OuterPHI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), PHICapacity,</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">                                        OuterPHI-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.lpad-body&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">    InnerPHI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(<a href="/docs/api/classes/llvm/irbuilder">InsertPoint</a>);</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">    OuterPHI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(InnerPHI);</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal">    InnerPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(OuterPHI, OuterResumeDest);</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a PHI for the exception values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">  InnerEHValuesPHI =</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(CallerLPad-&gt;getType(), PHICapacity, </Highlight><Highlight kind="stringliteral">&quot;eh.lpad-body&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">  InnerEHValuesPHI-&gt;insertBefore(<a href="/docs/api/classes/llvm/irbuilder">InsertPoint</a>);</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">  CallerLPad-&gt;replaceAllUsesWith(InnerEHValuesPHI);</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">  InnerEHValuesPHI-&gt;addIncoming(CallerLPad, OuterResumeDest);</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> InnerResumeDest;</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="comment">/// Forward the &#39;resume&#39; instruction to the caller&#39;s landing pad block.</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="comment">/// When the landing pad block has only one predecessor, this is a simple</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="comment">/// branch. When there is more than one predecessor, we need to split the</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="comment">/// landing pad block after the landingpad instruction and jump to there.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#adcbc4d7e8bf9926797b48a2b3603e3a4"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#adcbc4d7e8bf9926797b48a2b3603e3a4">LandingPadInliningInfo::forwardResume</a>(</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;LandingPadInst &#42;&gt;</a> &amp;InlinedLPads) &#123;</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dest = <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a232bc3cdcfa2bab0574af9b47ff90c41">getInnerResumeDest</a>();</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src = RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Dest, Src);</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the PHIs in the destination. They were inserted in an order which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// makes this work.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#aa02431ef258154c74a391cc3c5fd7f8d">addIncomingPHIValuesForInto</a>(Src, Dest);</Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">  InnerEHValuesPHI-&gt;addIncoming(RI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), Src);</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">  RI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="comment">/// Helper for getUnwindDestToken/getUnwindDestTokenHelper.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255" lineLink="#ac12dacafa8a30b2f9bfed5f3a022a612"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;EHPad) &#123;</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FuncletPadInst&gt;</a>(EHPad))</Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FPI-&gt;getParentPad();</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CatchSwitchInst&gt;</a>(EHPad)-&gt;getParentPad();</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261" lineLink="#a2af37358cf937d4298f5c5198bf91d34"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, Value &#42;&gt;</a>;</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="comment">/// Helper for getUnwindDestToken that does the descendant-ward part of</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="comment">/// the search.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265" lineLink="#a4e19285f051b80099ed8b36c5c94eaf2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a4e19285f051b80099ed8b36c5c94eaf2">getUnwindDestTokenHelper</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;EHPad,</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal">                                       <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> &amp;MemoMap) &#123;</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> Worklist(1, EHPad);</Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CurrentPad = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We only put pads on the worklist that aren&#39;t in the MemoMap.  When</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we find an unwind dest for a pad we may update its ancestors, but</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the queue only ever contains uncles/great-uncles/etc. of CurrentPad,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// so they should never get updated while queued on the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(CurrentPad));</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;UnwindDestToken = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CatchSwitch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchSwitchInst&gt;</a>(CurrentPad)) &#123;</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CatchSwitch-&gt;hasUnwindDest()) &#123;</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">        UnwindDestToken = &amp;&#42;CatchSwitch-&gt;getUnwindDest()-&gt;getFirstNonPHIIt();</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Catchswitch doesn&#39;t have a &#39;nounwind&#39; variant, and one might be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// annotated as &quot;unwinds to caller&quot; when really it&#39;s nounwind (see</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// e.g. SimplifyCFGOpt::SimplifyUnreachable), so we can&#39;t infer the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// parent&#39;s unwind dest from this.  We can check its catchpads&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// descendants, since they might include a cleanuppad with an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// &quot;unwinds to caller&quot; cleanupret, which can be trusted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> HI = CatchSwitch-&gt;handler&#95;begin(),</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">                  HE = CatchSwitch-&gt;handler&#95;end();</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">             HI != HE &amp;&amp; !UnwindDestToken; ++HI) &#123;</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HandlerBlock = &#42;HI;</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CatchPad =</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CatchPadInst&gt;</a>(&amp;&#42;HandlerBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;Child : CatchPad-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Intentionally ignore invokes here -- since the catchswitch is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// marked &quot;unwind to caller&quot;, it would be a verifier error if it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// contained an invoke which unwinds out of it, so any invoke we&#39;d</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// encounter must unwind to some child of the catch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CleanupPadInst&gt;</a>(Child) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(Child))</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ChildPad = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Child);</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Memo = MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(ChildPad);</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Memo == MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">              </Highlight><Highlight kind="comment">// Haven&#39;t figured out this child pad yet; queue it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">              Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ChildPad);</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// We&#39;ve already checked this child, but might have found that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// it offers no proof either way.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;ChildUnwindDestToken = Memo-&gt;second;</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ChildUnwindDestToken)</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// We already know the child&#39;s unwind dest, which can either</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// be ConstantTokenNone to indicate unwind to caller, or can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// be another child of the catchpad.  Only the former indicates</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// the unwind dest of the catchswitch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantTokenNone&gt;</a>(ChildUnwindDestToken)) &#123;</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal">              UnwindDestToken = ChildUnwindDestToken;</Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(ChildUnwindDestToken) == CatchPad);</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CleanupPad = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CleanupPadInst&gt;</a>(CurrentPad);</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CleanupPad-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CleanupRet = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupReturnInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RetUnwindDest = CleanupRet-&gt;getUnwindDest())</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">            UnwindDestToken = &amp;&#42;RetUnwindDest-&gt;getFirstNonPHIIt();</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">            UnwindDestToken = <a href="/docs/api/classes/llvm/constanttokennone/#a8e29fb8e39fb67b3bb746dbba47fcb29">ConstantTokenNone::get</a>(CleanupPad-&gt;getContext());</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;ChildUnwindDestToken;</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Invoke = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">          ChildUnwindDestToken = &amp;&#42;Invoke-&gt;getUnwindDest()-&gt;getFirstNonPHIIt();</Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CleanupPadInst&gt;</a>(U) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ChildPad = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Memo = MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(ChildPad);</Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Memo == MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Haven&#39;t resolved this child yet; queue it and keep searching.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ChildPad);</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We&#39;ve checked this child, but still need to ignore it if it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// had no proof either way.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">          ChildUnwindDestToken = Memo-&gt;second;</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ChildUnwindDestToken)</Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Not a relevant user of the cleanuppad</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// In a well-formed program, the child/invoke must either unwind to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// an(other) child of the cleanup, or exit the cleanup.  In the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// first case, continue searching.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(ChildUnwindDestToken) &amp;&amp;</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">            <a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(ChildUnwindDestToken) == CleanupPad)</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">        UnwindDestToken = ChildUnwindDestToken;</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we haven&#39;t found an unwind dest for CurrentPad, we may have queued its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// children, so move on to the next in the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UnwindDestToken)</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now we know that CurrentPad unwinds to UnwindDestToken.  It also exits</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// any ancestors of CurrentPad up to but not including UnwindDestToken&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// parent pad.  Record this in the memo map, and check to see if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// original EHPad being queried is one of the ones exited.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;UnwindParent;</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UnwindPad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(UnwindDestToken))</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">      UnwindParent = <a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(UnwindPad);</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">      UnwindParent = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ExitedOriginalPad = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExitedPad = CurrentPad;</Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">         ExitedPad &amp;&amp; ExitedPad != UnwindParent;</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">         ExitedPad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(ExitedPad))) &#123;</Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip over catchpads since they just follow their catchswitches.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchPadInst&gt;</a>(ExitedPad))</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">      MemoMap&#91;ExitedPad&#93; = UnwindDestToken;</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">      ExitedOriginalPad |= (ExitedPad == EHPad);</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitedOriginalPad)</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UnwindDestToken;</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Continue the search.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// No definitive information is contained within this funclet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="comment">/// Given an EH pad, find where it unwinds.  If it unwinds to an EH pad,</Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="comment">/// return that pad instruction.  If it unwinds to caller, return</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="comment">/// ConstantTokenNone.  If it does not have a definitive unwind destination,</Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="comment">/// return nullptr.</Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="comment">/// This routine gets invoked for calls in funclets in inlinees when inlining</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="comment">/// an invoke.  Since many funclets don&#39;t have calls inside them, it&#39;s queried</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="comment">/// on-demand rather than building a map of pads to unwind dests up front.</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="comment">/// Determining a funclet&#39;s unwind dest may require recursively searching its</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="comment">/// descendants, and also ancestors and cousins if the descendants don&#39;t provide</Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="comment">/// an answer.  Since most funclets will have their unwind dest immediately</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="comment">/// available as the unwind dest of a catchswitch or cleanupret, this routine</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="comment">/// searches top-down from the given pad and then up. To avoid worst-case</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="comment">/// quadratic run-time given that approach, it uses a memo map to avoid</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="comment">/// re-processing funclet trees.  The callers that rewrite the IR as they go</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="comment">/// take advantage of this, for correctness, by checking/forcing rewritten</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="comment">/// pads&#39; entries to match the original callee view.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417" lineLink="#a3cc72cfbc837c8e89491b6357c358778"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a3cc72cfbc837c8e89491b6357c358778">getUnwindDestToken</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;EHPad,</Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">                                 <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> &amp;MemoMap) &#123;</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Catchpads unwind to the same place as their catchswitch;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// redirct any queries on catchpads so the code below can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// deal with just catchswitches and cleanuppads.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchPadInst&gt;</a>(EHPad))</Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">    EHPad = CPI-&gt;getCatchSwitch();</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we&#39;ve already determined the unwind dest for this pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Memo = MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(EHPad);</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Memo != MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Memo-&gt;second;</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Search EHPad and, if necessary, its descendants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;UnwindDestToken = <a href="#a4e19285f051b80099ed8b36c5c94eaf2">getUnwindDestTokenHelper</a>(EHPad, MemoMap);</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((UnwindDestToken == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) != (MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(EHPad) != 0));</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UnwindDestToken)</Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UnwindDestToken;</Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// No information is available for this EHPad from itself or any of its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// descendants.  An unwind all the way out to a pad in the caller would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// need also to agree with the unwind dest of the parent funclet, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// search up the chain to try to find a funclet with information.  Put</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// null entries in the memo map to avoid re-processing as we go up.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">  MemoMap&#91;EHPad&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 4&gt;</a> TempMemos;</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal">  TempMemos.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(EHPad);</Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LastUselessPad = EHPad;</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;AncestorToken;</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (AncestorToken = <a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(EHPad);</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">       </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AncestorPad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(AncestorToken);</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">       AncestorToken = <a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(AncestorToken)) &#123;</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip over catchpads since they just follow their catchswitches.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchPadInst&gt;</a>(AncestorPad))</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the MemoMap had an entry mapping AncestorPad to nullptr, since we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// haven&#39;t yet called getUnwindDestTokenHelper for AncestorPad in this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// call to getUnwindDestToken, that would mean that AncestorPad had no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// information in itself, its descendants, or its ancestors.  If that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// were the case, then we should also have recorded the lack of information</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for the descendant that we&#39;re coming from.  So assert that we don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// find a null entry in the MemoMap for AncestorPad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(AncestorPad) || MemoMap&#91;AncestorPad&#93;);</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AncestorMemo = MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(AncestorPad);</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AncestorMemo == MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">      UnwindDestToken = <a href="#a4e19285f051b80099ed8b36c5c94eaf2">getUnwindDestTokenHelper</a>(AncestorPad, MemoMap);</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">      UnwindDestToken = AncestorMemo-&gt;second;</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UnwindDestToken)</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">    LastUselessPad = AncestorPad;</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">    MemoMap&#91;LastUselessPad&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal">    TempMemos.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(LastUselessPad);</Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We know that getUnwindDestTokenHelper was called on LastUselessPad and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// returned nullptr (and likewise for EHPad and any of its ancestors up to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// LastUselessPad), so LastUselessPad has no information from below.  Since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// getUnwindDestTokenHelper must investigate all downward paths through</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// no-information nodes to prove that a node has no information like this,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and since any time it finds information it records it in the MemoMap for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not just the immediately-containing funclet but also any ancestors also</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// exited, it must be the case that, walking downward from LastUselessPad,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// visiting just those nodes which have not been mapped to an unwind dest</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// by getUnwindDestTokenHelper (the nullptr TempMemos notwithstanding, since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// they are just used to keep getUnwindDestTokenHelper from repeating work),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any node visited must have been exhaustively searched with no information</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for it found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> Worklist(1, LastUselessPad);</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UselessPad = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Memo = MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(UselessPad);</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Memo != MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; Memo-&gt;second) &#123;</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Here the name &#39;UselessPad&#39; is a bit of a misnomer, because we&#39;ve found</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that it is a funclet that does have information about unwinding to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// a particular destination; its parent was a useless pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Since its parent has no information, the unwind edge must not escape</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the parent, and must target a sibling of this pad.  This local unwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// gives us no information about EHPad.  Leave it and the subtree rooted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// at it alone.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(Memo-&gt;second) == <a href="/docs/api/files/lib/lib/ir/verifier-cpp/#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(UselessPad));</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We know we don&#39;t have information for UselesPad.  If it has an entry in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the MemoMap (mapping it to nullptr), it must be one of the TempMemos</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// added on this invocation of getUnwindDestToken; if a previous invocation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// recorded nullptr, it would have had to prove that the ancestors of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// UselessPad, which include LastUselessPad, had no information, and that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// in turn would have required proving that the descendants of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// LastUselesPad, which include EHPad, have no information about</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// LastUselessPad, which would imply that EHPad was mapped to nullptr in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the MemoMap on that invocation, which isn&#39;t the case if we got here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!MemoMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(UselessPad) || TempMemos.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(UselessPad));</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Assert as we enumerate users that &#39;UselessPad&#39; doesn&#39;t have any unwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// information that we&#39;d be contradicting by making a map entry for it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (which is something that getUnwindDestTokenHelper must have proved for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// us to get here).  Just assert on is direct users here; the checks in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this downward walk at its descendants will verify that they don&#39;t have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// any unwind edges that exit &#39;UselessPad&#39; either (i.e. they either have no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// unwind edges or unwind to a sibling).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">    MemoMap&#91;UselessPad&#93; = UnwindDestToken;</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CatchSwitch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchSwitchInst&gt;</a>(UselessPad)) &#123;</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CatchSwitch-&gt;getUnwindDest() == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected useless pad&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HandlerBlock : CatchSwitch-&gt;handlers()) &#123;</Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CatchPad = &amp;&#42;HandlerBlock-&gt;getFirstNonPHIIt();</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CatchPad-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(U) ||</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">                  (<a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(&amp;&#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InvokeInst&gt;</a>(U)</Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">                                      -&gt;getUnwindDest()</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">                                      -&gt;getFirstNonPHIIt()) == CatchPad)) &amp;&amp;</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;Expected useless pad&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(U) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CleanupPadInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CleanupPadInst&gt;</a>(UselessPad));</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : UselessPad-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CleanupReturnInst&gt;</a>(U) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected useless pad&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">            (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(U) ||</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">             (<a href="#ac12dacafa8a30b2f9bfed5f3a022a612">getParentPad</a>(</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal">                  &amp;&#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InvokeInst&gt;</a>(U)-&gt;getUnwindDest()-&gt;getFirstNonPHIIt()) ==</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">              UselessPad)) &amp;&amp;</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;Expected useless pad&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(U) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CleanupPadInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UnwindDestToken;</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="comment">/// When we inline a basic block into an invoke,</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="comment">/// we have to turn all of the calls that can throw into invokes.</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="comment">/// This function analyze BB to see if there are any calls, and if so,</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="comment">/// it rewrites them to be invokes that jump to InvokeDest and fills in the PHI</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="comment">/// nodes in that block with the values specified in InvokeDestPHIValues.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561" lineLink="#a4ea5b2388bd9dc7e7fc902b5bd1e35e4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="#a4ea5b2388bd9dc7e7fc902b5bd1e35e4">HandleCallsInBlockInlinedThroughInvoke</a>(</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnwindEdge,</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">    <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> &#42;FuncletUnwindMap = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We only need to check for function calls: inlined invoke</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions require no special handling.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI || CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aa87fae97a8c702741eca5a95748af49d">doesNotThrow</a>())</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We do not need to (and in fact, cannot) convert possibly throwing calls</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to @llvm.experimental&#95;deoptimize (resp. @llvm.experimental.guard) into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// invokes.  The caller&#39;s &quot;segment&quot; of the deoptimization continuation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// attached to the newly inlined @llvm.experimental&#95;deoptimize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (resp. @llvm.experimental.guard) call should contain the exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// handling logic, if any.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>())</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIntrinsicID() == Intrinsic::experimental&#95;deoptimize ||</Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIntrinsicID() == Intrinsic::experimental&#95;guard)</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FuncletBundle = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a23ab5f34fb7b9476d45da0102ecbfae6">getOperandBundle</a>(<a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca8997c6b0930e2c05209e95e7172c6cf3">LLVMContext::OB&#95;funclet</a>)) &#123;</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This call is nested inside a funclet.  If that funclet has an unwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// destination within the inlinee, then unwinding out of this call would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// be UB.  Rewriting this call to an invoke which targets the inlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// invoke&#39;s unwind dest would give the call&#39;s parent funclet multiple</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// unwind destinations, which is something that subsequent EH table</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// generation can&#39;t handle and that the veirifer rejects.  So when we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// see such a call, leave it as a call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FuncletPad = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(FuncletBundle-&gt;Inputs&#91;0&#93;);</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;UnwindDestToken =</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">          <a href="#a3cc72cfbc837c8e89491b6357c358778">getUnwindDestToken</a>(FuncletPad, &#42;FuncletUnwindMap);</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UnwindDestToken &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantTokenNone&gt;</a>(UnwindDestToken))</Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;MemoKey;</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CatchPad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchPadInst&gt;</a>(FuncletPad))</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">        MemoKey = CatchPad-&gt;getCatchSwitch();</Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">        MemoKey = FuncletPad;</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FuncletUnwindMap-&gt;count(MemoKey) &amp;&amp;</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">             (&#42;FuncletUnwindMap)&#91;MemoKey&#93; == UnwindDestToken &amp;&amp;</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;must get memoized to avoid confusing later searches&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif </Highlight><Highlight kind="comment">// NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a1481db7804704b4beb48e8c2ad4c94b2">changeToInvokeAndSplitBasicBlock</a>(CI, UnwindEdge);</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BB;</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="comment">/// If we inlined an invoke site, we need to convert calls</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="comment">/// in the body of the inlined function into invokes.</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="comment">/// II is the invoke instruction being inlined.  FirstNewBlock is the first</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="comment">/// block of the inlined code (the last block is the end of the function),</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="comment">/// and InlineCodeInfo is information about the code that got inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620" lineLink="#a4cbd6aad6f6b93f79dc435feab77550e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a4cbd6aad6f6b93f79dc435feab77550e">HandleInlinedLandingPad</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FirstNewBlock,</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">                                    <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp;InlinedCodeInfo) &#123;</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InvokeDest = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest();</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Caller = FirstNewBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The inlined code is currently at the end of the function, scan from the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// start of the inlined code to its end, checking for stuff we need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// rewrite.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/landingpadinlininginfo/#a95303df5888c9384c3ba02c12ca9cb3e">LandingPadInliningInfo</a> Invoke(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get all of the inlined landing pad instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;LandingPadInst&#42;, 16&gt;</a> InlinedLPads;</Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = FirstNewBlock-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Caller-&gt;end();</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getTerminator()))</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">      InlinedLPads.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getLandingPadInst());</Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Append the clauses from the outer landing pad instruction into the inlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// landing pad instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;OuterLPad = Invoke.getLandingPadInst();</Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;InlinedLPad : InlinedLPads) &#123;</Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OuterNum = OuterLPad-&gt;<a href="/docs/api/classes/llvm/landingpadinst/#a1d25e478c9de2656ce4c793a8b80e537">getNumClauses</a>();</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal">    InlinedLPad-&gt;reserveClauses(OuterNum);</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OuterIdx = 0; OuterIdx != OuterNum; ++OuterIdx)</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">      InlinedLPad-&gt;addClause(OuterLPad-&gt;<a href="/docs/api/classes/llvm/landingpadinst/#a836dacc5f24807bbc216145ff7de36ab">getClause</a>(OuterIdx));</Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OuterLPad-&gt;<a href="/docs/api/classes/llvm/landingpadinst/#a0966e2f38f20609a643b5d5e3da8bae5">isCleanup</a>())</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">      InlinedLPad-&gt;setCleanup(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> BB = FirstNewBlock-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Caller-&gt;end();</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal">       BB != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++BB) &#123;</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedCodeInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a6bbe5e652464ac9213907e3446874900">ContainsCalls</a>)</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="#a4ea5b2388bd9dc7e7fc902b5bd1e35e4">HandleCallsInBlockInlinedThroughInvoke</a>(</Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">              &amp;&#42;BB, Invoke.getOuterResumeDest()))</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Update any PHI nodes in the exceptional block to indicate that there</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// is now a new entry in them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">        Invoke.addIncomingPHIValuesFor(NewBB);</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Forward any resumes that are remaining here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ResumeInst&gt;</a>(BB-&gt;getTerminator()))</Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">      Invoke.forwardResume(RI, InlinedLPads);</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that everything is happy, we have one final detail.  The PHI nodes in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the exception destination block still have entries due to the original</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// invoke instruction. Eliminate these entries (which might even delete the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PHI node) now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">  InvokeDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent());</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="comment">/// If we inlined an invoke site, we need to convert calls</Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="comment">/// in the body of the inlined function into invokes.</Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="comment">/// II is the invoke instruction being inlined.  FirstNewBlock is the first</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="comment">/// block of the inlined code (the last block is the end of the function),</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="comment">/// and InlineCodeInfo is information about the code that got inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677" lineLink="#aac69c9cf4e552a52d5065e94dc023f82"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#aac69c9cf4e552a52d5065e94dc023f82">HandleInlinedEHPad</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FirstNewBlock,</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">                               <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp;InlinedCodeInfo) &#123;</Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnwindDest = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest();</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Caller = FirstNewBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>()-&gt;isEHPad() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;unexpected BasicBlock!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are PHI nodes in the unwind destination block, we need to keep</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// track of which values came into them from the invoke before removing the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// edge from this block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 8&gt;</a> UnwindDestPHIValues;</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InvokeBB = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Save the value to use for this edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal">    UnwindDestPHIValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValueForBlock(InvokeBB));</Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add incoming-PHI values to the unwind destination block for the given basic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block, using the values for the original invoke&#39;s source block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/basicblockutils-cpp/#a4fd3bc9dead8a151c4cdf8c60d497931">UpdatePHINodes</a> = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src) &#123;</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : UnwindDestPHIValues) &#123;</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(V, Src);</Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">      ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This connects all the instructions which &#39;unwind to caller&#39; to the invoke</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// destination.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">  <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> FuncletUnwindMap;</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> BB = FirstNewBlock-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Caller-&gt;end();</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">       BB != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++BB) &#123;</Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupReturnInst&gt;</a>(BB-&gt;getTerminator())) &#123;</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CRI-&gt;unwindsToCaller()) &#123;</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CleanupPad = CRI-&gt;getCleanupPad();</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/cleanupreturninst/#a7e19664720f1c4693b788b018d08758c">CleanupReturnInst::Create</a>(CleanupPad, UnwindDest, CRI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">        CRI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/basicblockutils-cpp/#a4fd3bc9dead8a151c4cdf8c60d497931">UpdatePHINodes</a>(&amp;&#42;BB);</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Finding a cleanupret with an unwind destination would confuse</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// subsequent calls to getUnwindDestToken, so map the cleanuppad</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to short-circuit any such calls and recognize this as an &quot;unwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to caller&quot; cleanup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!FuncletUnwindMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(CleanupPad) ||</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantTokenNone&gt;</a>(FuncletUnwindMap&#91;CleanupPad&#93;));</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">        FuncletUnwindMap&#91;CleanupPad&#93; =</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/constanttokennone/#a8e29fb8e39fb67b3bb746dbba47fcb29">ConstantTokenNone::get</a>(Caller-&gt;getContext());</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;getFirstNonPHIIt();</Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Replacement = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CatchSwitch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchSwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CatchSwitch-&gt;unwindsToCaller()) &#123;</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;UnwindDestToken;</Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ParentPad =</Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">                <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(CatchSwitch-&gt;getParentPad())) &#123;</Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// This catchswitch is nested inside another funclet.  If that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// funclet has an unwind destination within the inlinee, then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// unwinding out of this catchswitch would be UB.  Rewriting this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// catchswitch to unwind to the inlined invoke&#39;s unwind dest would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// give the parent funclet multiple unwind destinations, which is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// something that subsequent EH table generation can&#39;t handle and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// that the veirifer rejects.  So when we see such a call, leave it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// as &quot;unwind to caller&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">          UnwindDestToken = <a href="#a3cc72cfbc837c8e89491b6357c358778">getUnwindDestToken</a>(ParentPad, FuncletUnwindMap);</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UnwindDestToken &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantTokenNone&gt;</a>(UnwindDestToken))</Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// This catchswitch has no parent to inherit constraints from, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// none of its descendants can have an unwind edge that exits it and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// targets another funclet in the inlinee.  It may or may not have a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// descendant that definitively has an unwind to caller.  In either</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// case, we&#39;ll have to assume that any unwinds out of it may need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// be routed to the caller, so treat it as though it has a definitive</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// unwind to caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">          UnwindDestToken = <a href="/docs/api/classes/llvm/constanttokennone/#a8e29fb8e39fb67b3bb746dbba47fcb29">ConstantTokenNone::get</a>(Caller-&gt;getContext());</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewCatchSwitch = <a href="/docs/api/classes/llvm/catchswitchinst/#acf9b80aee9ba7ec6b77416f8e5227e88">CatchSwitchInst::Create</a>(</Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">            CatchSwitch-&gt;getParentPad(), UnwindDest,</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">            CatchSwitch-&gt;getNumHandlers(), CatchSwitch-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(),</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">            CatchSwitch-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PadBB : CatchSwitch-&gt;handlers())</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal">          NewCatchSwitch-&gt;addHandler(PadBB);</Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Propagate info for the old catchswitch over to the new one in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the unwind map.  This also serves to short-circuit any subsequent</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// checks for the unwind dest of this catchswitch, which would get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// confused if they found the outer handler in the callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal">        FuncletUnwindMap&#91;NewCatchSwitch&#93; = UnwindDestToken;</Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">        Replacement = NewCatchSwitch;</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FuncletPadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;unexpected EHPad!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Replacement) &#123;</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal">      Replacement-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Replacement);</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/basicblockutils-cpp/#a4fd3bc9dead8a151c4cdf8c60d497931">UpdatePHINodes</a>(&amp;&#42;BB);</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedCodeInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a6bbe5e652464ac9213907e3446874900">ContainsCalls</a>)</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> BB = FirstNewBlock-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(),</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">                            <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Caller-&gt;end();</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">         BB != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++BB)</Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="#a4ea5b2388bd9dc7e7fc902b5bd1e35e4">HandleCallsInBlockInlinedThroughInvoke</a>(</Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">              &amp;&#42;BB, UnwindDest, &amp;FuncletUnwindMap))</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Update any PHI nodes in the exceptional block to indicate that there</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// is now a new entry in them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/basicblockutils-cpp/#a4fd3bc9dead8a151c4cdf8c60d497931">UpdatePHINodes</a>(NewBB);</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that everything is happy, we have one final detail.  The PHI nodes in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the exception destination block still have entries due to the original</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// invoke instruction. Eliminate these entries (which might even delete the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PHI node) now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="normal">  UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(InvokeBB);</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800" lineLink="#af7016ec74e60284d198d9b70ec8f1ab2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#af7016ec74e60284d198d9b70ec8f1ab2">haveCommonPrefix</a>(<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MIBStackContext,</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;CallsiteStackContext) &#123;</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MIBStackContext-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>() &gt; 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">         CallsiteStackContext-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>() &gt; 0);</Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Because of the context trimming performed during matching, the callsite</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// context could have more stack ids than the MIB. We match up to the end of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the shortest stack context.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MIBStackIter = MIBStackContext-&gt;<a href="/docs/api/classes/llvm/mdnode/#ac9a44b78ebdc1a9be01a96cc5e3bbb59">op&#95;begin</a>(),</Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">            CallsiteStackIter = CallsiteStackContext-&gt;<a href="/docs/api/classes/llvm/mdnode/#ac9a44b78ebdc1a9be01a96cc5e3bbb59">op&#95;begin</a>();</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">       MIBStackIter != MIBStackContext-&gt;<a href="/docs/api/classes/llvm/mdnode/#a679e07915a76a131faa1460665755151">op&#95;end</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">       CallsiteStackIter != CallsiteStackContext-&gt;<a href="/docs/api/classes/llvm/mdnode/#a679e07915a76a131faa1460665755151">op&#95;end</a>();</Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">       MIBStackIter++, CallsiteStackIter++) &#123;</Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Val1 = <a href="/docs/api/namespaces/llvm/mdconst/#ad7ca5290dc5789cbeae763690e6edccf">mdconst::dyn&#95;extract&lt;ConstantInt&gt;</a>(&#42;MIBStackIter);</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Val2 = <a href="/docs/api/namespaces/llvm/mdconst/#ad7ca5290dc5789cbeae763690e6edccf">mdconst::dyn&#95;extract&lt;ConstantInt&gt;</a>(&#42;CallsiteStackIter);</Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Val1 &amp;&amp; Val2);</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Val1-&gt;getZExtValue() != Val2-&gt;getZExtValue())</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821" lineLink="#ae2c447e52415219501221037474b9893"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ae2c447e52415219501221037474b9893">removeMemProfMetadata</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>) &#123;</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setMetadata(LLVMContext::MD&#95;memprof, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825" lineLink="#a32f2884ce25dcf448fbb3fb0a57396ff"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a32f2884ce25dcf448fbb3fb0a57396ff">removeCallsiteMetadata</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>) &#123;</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setMetadata(LLVMContext::MD&#95;callsite, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829" lineLink="#afbf6d60618e520079ded1612a2941fbe"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#afbf6d60618e520079ded1612a2941fbe">updateMemprofMetadata</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CI,</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::vector&lt;Metadata &#42;&gt; &amp;MIBList) &#123;</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!MIBList.empty());</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove existing memprof, which will either be replaced or may not be needed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if we are able to use a single allocation type function attribute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">  <a href="#ae2c447e52415219501221037474b9893">removeMemProfMetadata</a>(CI);</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/memprof/callstacktrie">CallStackTrie</a> <a href="/docs/api/classes/llvm/memprof/callstack">CallStack</a>;</Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;MIB : MIBList)</Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/memprof/callstack">CallStack</a>.addCallStack(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDNode&gt;</a>(MIB));</Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MemprofMDAttached = <a href="/docs/api/classes/llvm/memprof/callstack">CallStack</a>.buildAndAttachMIBMetadata(CI);</Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MemprofMDAttached == CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a565f546ad95bd3a9bbe9a1e5040803f0">hasMetadata</a>(LLVMContext::MD&#95;memprof));</Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MemprofMDAttached)</Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we used a function attribute remove the callsite metadata as well.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">    <a href="#a32f2884ce25dcf448fbb3fb0a57396ff">removeCallsiteMetadata</a>(CI);</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Update the metadata on the inlined copy ClonedCall of a call OrigCall in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal"></Highlight><Highlight kind="comment">// inlined callee body, based on the callsite metadata InlinedCallsiteMD from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the call that was inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848" lineLink="#a380713e3d0da9090dbc68193076703b7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a380713e3d0da9090dbc68193076703b7">propagateMemProfHelper</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;OrigCall,</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;ClonedCall,</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;InlinedCallsiteMD) &#123;</Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;OrigCallsiteMD = ClonedCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;callsite);</Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;ClonedCallsiteMD = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the call originally had callsite metadata, and update it for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// new call in the inlined body.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigCallsiteMD) &#123;</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The cloned call&#39;s context is now the concatenation of the original call&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// callsite metadata and the callsite metadata on the call where it was</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">    ClonedCallsiteMD = <a href="/docs/api/classes/llvm/mdnode/#a3279d6d110c594673e692308fce00fab">MDNode::concatenate</a>(OrigCallsiteMD, InlinedCallsiteMD);</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">    ClonedCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;callsite, ClonedCallsiteMD);</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update any memprof metadata on the cloned call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;OrigMemProfMD = ClonedCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;memprof);</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OrigMemProfMD)</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We currently expect that allocations with memprof metadata also have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// callsite metadata for the allocation&#39;s part of the context.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigCallsiteMD);</Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// New call&#39;s MIB list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">  std::vector&lt;Metadata &#42;&gt; NewMIBList;</Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For each MIB metadata, check if its call stack context starts with the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// new clone&#39;s callsite metadata. If so, that MIB goes onto the cloned call in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the inlined body. If not, it stays on the out-of-line original call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MIBOp : OrigMemProfMD-&gt;<a href="/docs/api/classes/llvm/mdnode/#a571612461ea4af620bc4c441d61579a3">operands</a>()) &#123;</Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MIB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(MIBOp);</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Stack is first operand of MIB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;StackMD = <a href="/docs/api/namespaces/llvm/memprof/#ab5636c9dedf3853480a075cefc7cc1fa">getMIBStackNode</a>(MIB);</Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StackMD);</Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// See if the new cloned callsite context matches this profiled context.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#af7016ec74e60284d198d9b70ec8f1ab2">haveCommonPrefix</a>(StackMD, ClonedCallsiteMD))</Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add it to the cloned call&#39;s MIB list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">      NewMIBList.push&#95;back(MIB);</Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewMIBList.empty()) &#123;</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">    <a href="#ae2c447e52415219501221037474b9893">removeMemProfMetadata</a>(ClonedCall);</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">    <a href="#a32f2884ce25dcf448fbb3fb0a57396ff">removeCallsiteMetadata</a>(ClonedCall);</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewMIBList.size() &lt; OrigMemProfMD-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>())</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">    <a href="#afbf6d60618e520079ded1612a2941fbe">updateMemprofMetadata</a>(ClonedCall, NewMIBList);</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Update memprof related metadata (!memprof and !callsite) based on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal"></Highlight><Highlight kind="comment">// inlining of Callee into the callsite at CB. The updates include merging the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal"></Highlight><Highlight kind="comment">// inlined callee&#39;s callsite metadata with that of the inlined call,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal"></Highlight><Highlight kind="comment">// and moving the subset of any memprof contexts to the inlined callee</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal"></Highlight><Highlight kind="comment">// allocations if they match the new inlined call stack.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902" lineLink="#a81fe0543b342a120ede7c69eeed77729"><Highlight kind="normal"><a href="#a81fe0543b342a120ede7c69eeed77729">propagateMemProfMetadata</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee, <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB,</Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">                         </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ContainsMemProfMetadata,</Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">                         </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/valuemap">ValueMap&lt;const Value &#42;, WeakTrackingVH&gt;</a> &amp;VMap) &#123;</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;CallsiteMD = CB.<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;callsite);</Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only need to update if the inlined callsite had callsite metadata, or if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// there was any memprof metadata inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CallsiteMD &amp;&amp; !ContainsMemProfMetadata)</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Propagate metadata onto the cloned calls in the inlined callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Entry : VMap) &#123;</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// See if this is a call that has been inlined and remapped, and not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// simplified away in the process.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OrigCall = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallBase&gt;</a>(Entry.first);</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ClonedCall = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallBase&gt;</a>(Entry.second);</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OrigCall || !ClonedCall)</Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the inlined callsite did not have any callsite metadata, then it isn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// involved in any profiled call contexts, and we can remove any memprof</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// metadata on the cloned call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CallsiteMD) &#123;</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">      <a href="#ae2c447e52415219501221037474b9893">removeMemProfMetadata</a>(ClonedCall);</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">      <a href="#a32f2884ce25dcf448fbb3fb0a57396ff">removeCallsiteMetadata</a>(ClonedCall);</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">    <a href="#a380713e3d0da9090dbc68193076703b7">propagateMemProfHelper</a>(OrigCall, ClonedCall, CallsiteMD);</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="comment">/// When inlining a call site that has !llvm.mem.parallel&#95;loop&#95;access,</Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="comment">/// !llvm.access.group, !alias.scope or !noalias metadata, that metadata should</Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="comment">/// be propagated to all memory-accessing cloned instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934" lineLink="#a74b8b820b4b2d53dd53ba32821887473"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a74b8b820b4b2d53dd53ba32821887473">PropagateCallSiteMetadata</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FStart,</Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FEnd) &#123;</Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MemParallelLoopAccess =</Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">      CB.<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access);</Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;AccessGroup = CB.<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;access&#95;group);</Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;AliasScope = CB.<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;alias&#95;scope);</Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NoAlias = CB.<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;noalias);</Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MemParallelLoopAccess &amp;&amp; !AccessGroup &amp;&amp; !AliasScope &amp;&amp; !NoAlias)</Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(FStart, FEnd)) &#123;</Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This metadata is only relevant for instructions that access memory.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemParallelLoopAccess) &#123;</Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// TODO: This probably should not overwrite MemParalleLoopAccess.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal">        MemParallelLoopAccess = <a href="/docs/api/classes/llvm/mdnode/#a3279d6d110c594673e692308fce00fab">MDNode::concatenate</a>(</Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access),</Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">            MemParallelLoopAccess);</Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD&#95;mem&#95;parallel&#95;loop&#95;access,</Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">                      MemParallelLoopAccess);</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AccessGroup)</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD&#95;access&#95;group, <a href="/docs/api/namespaces/llvm/#ab307a287351370b59786ef96c73738cb">uniteAccessGroups</a>(</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;access&#95;group), AccessGroup));</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AliasScope)</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD&#95;alias&#95;scope, <a href="/docs/api/classes/llvm/mdnode/#a3279d6d110c594673e692308fce00fab">MDNode::concatenate</a>(</Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;alias&#95;scope), AliasScope));</Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NoAlias)</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD&#95;noalias, <a href="/docs/api/classes/llvm/mdnode/#a3279d6d110c594673e692308fce00fab">MDNode::concatenate</a>(</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;noalias), NoAlias));</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="comment">/// Bundle operands of the inlined function must be added to inlined call sites.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975" lineLink="#af939eab05ffe67221645aab1342156b2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#af939eab05ffe67221645aab1342156b2">PropagateOperandBundles</a>(<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> InlinedBB,</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CallSiteEHPad) &#123;</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;InlinedBB)) &#123;</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip call sites which already have a &quot;funclet&quot; bundle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperandBundle(<a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca8997c6b0930e2c05209e95e7172c6cf3">LLVMContext::OB&#95;funclet</a>))</Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip call sites which are nounwind intrinsics (as long as they don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// lower into regular function calls in the course of IR transformations).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CalledFn =</Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCalledOperand()-&gt;stripPointerCasts());</Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledFn &amp;&amp; CalledFn-&gt;isIntrinsic() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;doesNotThrow() &amp;&amp;</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">        !<a href="/docs/api/classes/llvm/intrinsicinst/#a04df6c03772f85899d30bdcd06cbcd06">IntrinsicInst::mayLowerToFunctionCall</a>(CalledFn-&gt;getIntrinsicID()))</Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperandBundlesAsDefs(OpBundles);</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">    OpBundles.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(</Highlight><Highlight kind="stringliteral">&quot;funclet&quot;</Highlight><Highlight kind="normal">, CallSiteEHPad);</Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewInst = <a href="/docs/api/classes/llvm/callbase/#aca631a010bfa5a055b7a07fe9e68f7e9">CallBase::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OpBundles, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">    NewInst-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(NewInst);</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="comment">/// Utility for cloning !noalias and !alias.scope metadata. When a code region</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="comment">/// using scoped alias metadata is inlined, the aliasing relationships may not</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="comment">/// hold between the two version. It is necessary to create a deep clone of the</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="comment">/// metadata, putting the two versions in separate scope domains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a2cdcb38580357989c748de8d118013b5">ScopedAliasMetadataDeepCloner</a> &#123;</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">MetadataMap = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MDNode &#42;, TrackingMDNodeRef&gt;</a>;</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;const MDNode &#42;&gt;</a> MD;</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">  MetadataMap MDMap;</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> addRecursiveMetadataUses();</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a2cdcb38580357989c748de8d118013b5">ScopedAliasMetadataDeepCloner</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="comment">  /// Create a new clone of the scoped alias metadata, which will be used by</Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="comment">  /// subsequent remap() calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a7bc92ff74f9a62146656fbaf0732c09a">clone</a>();</Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="comment">  /// Remap instructions in the given range from the original to the cloned</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="comment">  /// metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#af4f0e689813422794af2e1877d4d3541">remap</a>(<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FStart, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FEnd);</Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a2cdcb38580357989c748de8d118013b5"><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a2cdcb38580357989c748de8d118013b5">ScopedAliasMetadataDeepCloner::ScopedAliasMetadataDeepCloner</a>(</Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;alias&#95;scope))</Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">        MD.insert(M);</Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;noalias))</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">        MD.insert(M);</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We also need to clone the metadata in noalias intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Decl = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;NoAliasScopeDeclInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal">        MD.insert(Decl-&gt;getScopeList());</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">  addRecursiveMetadataUses();</Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> ScopedAliasMetadataDeepCloner::addRecursiveMetadataUses() &#123;</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Metadata &#42;, 16&gt;</a> Queue(MD.begin(), MD.end());</Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Queue.empty()) &#123;</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;M = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDNode&gt;</a>(Queue.pop&#95;back&#95;val());</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : M-&gt;operands())</Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;OpMD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MD.insert(OpMD))</Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">          Queue.push&#95;back(OpMD);</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a7bc92ff74f9a62146656fbaf0732c09a"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a7bc92ff74f9a62146656fbaf0732c09a">ScopedAliasMetadataDeepCloner::clone</a>() &#123;</Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MDMap.empty() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;clone() already called ?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;TempMDTuple, 16&gt;</a> DummyNodes;</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : MD) &#123;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">    DummyNodes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/mdtuple/#ac2e84f7e25af6e1de8cb811a57c6ee29">MDTuple::getTemporary</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext(), &#123;&#125;));</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">    MDMap&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.reset(DummyNodes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().get());</Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create new metadata nodes to replace the dummy nodes, replacing old</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// metadata references with either a dummy node or an already-created new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 4&gt;</a> NewOps;</Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : MD) &#123;</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) &#123;</Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;M = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">        NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MDMap&#91;M&#93;);</Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">        NewOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>));</Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewM = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext(), NewOps);</Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdtuple">MDTuple</a> &#42;TempM = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDTuple&gt;</a>(MDMap&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TempM-&gt;<a href="/docs/api/classes/llvm/mdnode/#a4a3aafff3f29eba4c6d639e6648c330c">isTemporary</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected temporary node&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">    TempM-&gt;<a href="/docs/api/classes/llvm/mdnode/#a2e9fe39301fbac7276c8d9f3e1884dc2">replaceAllUsesWith</a>(NewM);</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal">    NewOps.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085" lineLink="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#af4f0e689813422794af2e1877d4d3541"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#af4f0e689813422794af2e1877d4d3541">ScopedAliasMetadataDeepCloner::remap</a>(<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FStart,</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FEnd) &#123;</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MDMap.empty())</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(FStart, FEnd)) &#123;</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: The null checks for the MDMap.lookup() results should no longer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// be necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;alias&#95;scope))</Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MNew = MDMap.lookup(M))</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD&#95;alias&#95;scope, MNew);</Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD&#95;noalias))</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MNew = MDMap.lookup(M))</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD&#95;noalias, MNew);</Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Decl = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;NoAliasScopeDeclInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MNew = MDMap.lookup(Decl-&gt;getScopeList()))</Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal">          Decl-&gt;setScopeList(MNew);</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="comment">/// If the inlined function has noalias arguments,</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="comment">/// then add new alias scopes for each noalias argument, tag the mapped noalias</Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="comment">/// parameters with noalias metadata specifying the new scope, and tag all</Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="comment">/// non-derived loads, stores and memory intrinsics with the new alias scopes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113" lineLink="#aa35af336fee32786b6551e23d5b55fcf"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#aa35af336fee32786b6551e23d5b55fcf">AddAliasScopeMetadata</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;VMap,</Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;CalleeAAR,</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">                                  <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp;InlinedFunctionInfo) &#123;</Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a9925d445b976109ecb491c6faa297dc3">EnableNoAliasConversion</a>)</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFunc = CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Argument &#42;, 4&gt;</a> NoAliasArgs;</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;Arg : CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a49e6c89ce42a55a93ddf38d21bbd198e">args</a>())</Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a4cbb2344996abd4332716e76178ad4f4">paramHasAttr</a>(Arg.getArgNo(), Attribute::NoAlias) &amp;&amp; !Arg.use&#95;empty())</Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">      NoAliasArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;Arg);</Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NoAliasArgs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To do a good job, if a noalias variable is captured, we need to know if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the capture point dominates the particular use we&#39;re considering.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> DT;</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal">  DT.<a href="/docs/api/classes/llvm/dominatortreebase/#aa0641ae965656ff9988d67a35140e4d9">recalculate</a>(</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a>&amp;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(&#42;CalledFunc));</Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// noalias indicates that pointer values based on the argument do not alias</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// pointer values which are not based on it. So we add a new &quot;scope&quot; for each</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// noalias function argument. Accesses using pointers based on that argument</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// become part of that alias scope, accesses using pointers not based on that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// argument are tagged as noalias with that scope.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const Argument &#42;, MDNode &#42;&gt;</a> NewScopes;</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdbuilder">MDBuilder</a> MDB(CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>());</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a new scope domain for this function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewDomain =</Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">    MDB.<a href="/docs/api/classes/llvm/mdbuilder/#ae2c00c06e087680961c2e70ef16e1f8f">createAnonymousAliasScopeDomain</a>(CalledFunc-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = NoAliasArgs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = NoAliasArgs&#91;i&#93;;</Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">    std::string Name = std::string(CalledFunc-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasName()) &#123;</Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal">      Name += </Highlight><Highlight kind="stringliteral">&quot;: %&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">      Name += <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getName();</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">      Name += </Highlight><Highlight kind="stringliteral">&quot;: argument &quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">      Name += <a href="/docs/api/namespaces/llvm/#a41972fe6f3fab862543b7b835a714f9b">utostr</a>(i);</Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: We always create a new anonymous root here. This is true regardless</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of the linkage of the callee because the aliasing &quot;scope&quot; is not just a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// property of the callee, but also all control dependencies in the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewScope = MDB.<a href="/docs/api/classes/llvm/mdbuilder/#a29982864b11594aec54699f962f650ec">createAnonymousAliasScope</a>(NewDomain, Name);</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal">    NewScopes.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, NewScope));</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5b2763517e31bab717a06a5137de8f72">UseNoAliasIntrinsic</a>) &#123;</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Introduce a llvm.experimental.noalias.scope.decl for the noalias</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;AScopeList = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>(), NewScope);</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NoAliasDecl =</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a>(&amp;CB).CreateNoAliasScopeDeclaration(AScopeList);</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Ignore the result for now. The result will be used when the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// llvm.noalias intrinsic is introduced.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">      (void)NoAliasDecl;</Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over all new instructions in the map; for all memory-access</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions, add the alias scope metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/valuemap/#a1ac0e866aa7870ec9d1439e829e8e901">ValueToValueMapTy::iterator</a> VMI = VMap.<a href="/docs/api/classes/llvm/valuemap/#a799baf755bd1d5589995e78dbb9a4ced">begin</a>(), VMIE = VMap.<a href="/docs/api/classes/llvm/valuemap/#ab871e2d0ebded563edfebd6766fc1a04">end</a>();</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">       VMI != VMIE; ++VMI) &#123;</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(VMI-&gt;first)) &#123;</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VMI-&gt;second)</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(VMI-&gt;second);</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NI || InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a6711ec71d15ab34fb6eedc26d5b5da80">isSimplified</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NI))</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsArgMemOnlyCall = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, IsFuncCall = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 2&gt;</a> PtrArgs;</Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">        PtrArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LI-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">        PtrArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vaarginst">VAArgInst</a> &#42;VAAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VAArgInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">        PtrArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VAAI-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/atomiccmpxchginst">AtomicCmpXchgInst</a> &#42;CXI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicCmpXchgInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal">        PtrArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CXI-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/atomicrmwinst">AtomicRMWInst</a> &#42;RMWI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AtomicRMWInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">        PtrArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(RMWI-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we know that the call does not access memory, then we&#39;ll still</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// know that about the inlined clone of this call site, and we don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// need to add metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;doesNotAccessMemory())</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">        IsFuncCall = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalleeAAR) &#123;</Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a44ad2b29af9ebe3d12a99843a7594757">MemoryEffects</a> ME = CalleeAAR-&gt;<a href="/docs/api/classes/llvm/aaresults/#a98f54e18da022cdb497fbbeed4488276">getMemoryEffects</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We&#39;ll retain this knowledge without additional metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ME.<a href="/docs/api/classes/llvm/memoryeffectsbase/#a636d669d76e435e9d71cdc417c89a30c">onlyAccessesInaccessibleMem</a>())</Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ME.<a href="/docs/api/classes/llvm/memoryeffectsbase/#a8bc927c80d7734e7e0baef13efd08bc5">onlyAccessesArgPointees</a>())</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">            IsArgMemOnlyCall = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg : <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;args()) &#123;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Only care about pointer arguments. If a noalias argument is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// accessed through a non-pointer argument, it must be captured</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// first (e.g. via ptrtoint), and we protect against captures below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Arg-&gt;getType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">          PtrArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Arg);</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we found no pointers, then this instruction is not suitable for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// pairing with an instruction to receive aliasing metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// However, if this is a call, this we might just alias with none of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// noalias arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PtrArgs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; !IsFuncCall)</Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It is possible that there is only one underlying object, but you</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// need to go through several PHIs to see it, and thus could be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// repeated in the Objects list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 4&gt;</a> ObjSet;</Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 4&gt;</a> Scopes, <a href="/docs/api/files/lib/lib/target/lib/target/csky/lib/target/csky/mctargetdesc/cskyinstprinter-cpp/#a52cd65064f7f66f605566c65946a77df">NoAliases</a>;</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : PtrArgs) &#123;</Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> Objects;</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#acc66c148bcd950ffcc3ab83989eb70bd">getUnderlyingObjects</a>(V, Objects, </Highlight><Highlight kind="comment">/&#42; LI = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;O : Objects)</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">          ObjSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(O);</Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Figure out if we&#39;re derived from anything that is not a noalias</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RequiresNoCaptureBefore = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, UsesAliasingPtr = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal">           UsesUnknownObject = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : ObjSet) &#123;</Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Is this value a constant that cannot be derived from any pointer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// value (we need to exclude constant expressions, for example, that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// are formed from arithmetic on global symbols).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsNonPtrConst = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(V) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(V) ||</Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(V) ||</Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantDataVector&gt;</a>(V) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(V);</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsNonPtrConst)</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If this is anything other than a noalias argument, then we cannot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// completely describe the aliasing properties using alias.scope</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// metadata (and, thus, won&#39;t add any).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB.<a href="/docs/api/classes/llvm/callbase/#a4cbb2344996abd4332716e76178ad4f4">paramHasAttr</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getArgNo(), Attribute::NoAlias))</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">            UsesAliasingPtr = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">          UsesAliasingPtr = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac03ea7d56bf43713b1c15ccf95081d6a">isEscapeSource</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// An escape source can only alias with a noalias argument if it has</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// been captured beforehand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">          RequiresNoCaptureBefore = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(V) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#aed2c5dd2a303159f87771db83f54352b">isIdentifiedObject</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// If this is neither an escape source, nor some identified object</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// (which cannot directly alias a noalias argument), nor some other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// argument (which, by definition, also cannot alias a noalias</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// argument), conservatively do not make any assumptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">          UsesUnknownObject = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Nothing we can do if the used underlying object cannot be reliably</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// determined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UsesUnknownObject)</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// A function call can always get captured noalias pointers (via other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// parameters, globals, etc.).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsFuncCall &amp;&amp; !IsArgMemOnlyCall)</Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">        RequiresNoCaptureBefore = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// First, we want to figure out all of the sets with which we definitely</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// don&#39;t alias. Iterate over all noalias set, and add those for which:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   1 The noalias argument is not in the set of objects from which we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      definitely derive.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   2 The noalias argument has not yet been captured.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// An arbitrary function that might load pointers could see captured</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// noalias arguments via other noalias arguments or globals, and so we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// must always check for prior capture.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : NoAliasArgs) &#123;</Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ObjSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))</Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// May be based on a noalias argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// It might be tempting to skip the PointerMayBeCapturedBefore check if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// A-&gt;hasNoCaptureAttr() is true, but this is incorrect because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// nocapture only guarantees that no copies outlive the function, not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// that the value cannot be locally captured.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RequiresNoCaptureBefore ||</Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">            !<a href="/docs/api/namespaces/llvm/#a3693cec8e936224ad3e5748debe73b75">PointerMayBeCapturedBefore</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </Highlight><Highlight kind="comment">/&#42; ReturnCaptures &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">                                        </Highlight><Highlight kind="comment">/&#42; StoreCaptures &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;DT))</Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/csky/lib/target/csky/mctargetdesc/cskyinstprinter-cpp/#a52cd65064f7f66f605566c65946a77df">NoAliases</a>.push&#95;back(NewScopes&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>&#93;);</Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/csky/lib/target/csky/mctargetdesc/cskyinstprinter-cpp/#a52cd65064f7f66f605566c65946a77df">NoAliases</a>.empty())</Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">        NI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;noalias,</Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/mdnode/#a3279d6d110c594673e692308fce00fab">MDNode::concatenate</a>(</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">                            NI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;noalias),</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/csky/lib/target/csky/mctargetdesc/cskyinstprinter-cpp/#a52cd65064f7f66f605566c65946a77df">NoAliases</a>)));</Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Next, we want to figure out all of the sets to which we might belong.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We might belong to a set if the noalias argument is in the set of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// underlying objects. If there is some non-noalias argument in our list</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// of underlying objects, then we cannot add a scope because the fact</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that some access does not alias with any set of our noalias arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// cannot itself guarantee that it does not alias with this access</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// (because there is some pointer of unknown origin involved and the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// other access might also depend on this pointer). We also cannot add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// scopes to arbitrary functions unless we know they don&#39;t access any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// non-parameter pointer-values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CanAddScopes = !UsesAliasingPtr;</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CanAddScopes &amp;&amp; IsFuncCall)</Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">        CanAddScopes = IsArgMemOnlyCall;</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CanAddScopes)</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : NoAliasArgs) &#123;</Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ObjSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))</Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">            Scopes.push&#95;back(NewScopes&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>&#93;);</Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Scopes.empty())</Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">        NI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">            LLVMContext::MD&#95;alias&#95;scope,</Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/mdnode/#a3279d6d110c594673e692308fce00fab">MDNode::concatenate</a>(NI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;alias&#95;scope),</Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>(), Scopes)));</Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356" lineLink="#a91afe718c3cb2b248f39e1fd250ac91a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a91afe718c3cb2b248f39e1fd250ac91a">MayContainThrowingOrExitingCallAfterCB</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;Begin,</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;End) &#123;</Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Begin-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == End-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expected to be in same basic block!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BeginIt = Begin-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BeginIt != End-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Non-empty BB has empty iterator&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">llvm::isGuaranteedToTransferExecutionToSuccessor</a>(</Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">      ++BeginIt, End-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), <a href="#aec465f9b6ed2ec0a1a2ff413df2f0bb7">InlinerAttributeWindow</a> + 1);</Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Add attributes from CB params and Fn attributes that can always be propagated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal"></Highlight><Highlight kind="comment">// to the corresponding argument / inner callbases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369" lineLink="#af1986bc1d2d700807f4c8ef167bf6fdd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#af1986bc1d2d700807f4c8ef167bf6fdd">AddParamAndFnBasicAttributes</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB,</Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">                                         <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;VMap,</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">                                         <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp;InlinedFunctionInfo) &#123;</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CalledFunction = CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Context = CalledFunction-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect valid attributes for all params.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AttrBuilder&gt;</a> ValidObjParamAttrs, ValidExactParamAttrs;</Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasAttrToPropagate = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Attributes we can only propagate if the exact parameter is forwarded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can propagate both poison generating and UB generating attributes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// without any extra checks. The only attribute that is tricky to propagate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is &#96;noundef&#96; (skipped for now) as that can create new UB where previous</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// behavior was just using a poison value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60e">Attribute::AttrKind</a> ExactAttrsToPropagate&#91;&#93; = &#123;</Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">      Attribute::Dereferenceable, Attribute::DereferenceableOrNull,</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">      Attribute::NonNull, Attribute::Alignment, Attribute::Range&#125;;</Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = CB.<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal">    ValidObjParamAttrs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(AttrBuilder&#123;CB.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()&#125;);</Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal">    ValidExactParamAttrs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(AttrBuilder&#123;CB.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()&#125;);</Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Access attributes can be propagated to any param with the same underlying</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// object as the argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a4cbb2344996abd4332716e76178ad4f4">paramHasAttr</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadNone))</Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal">      ValidObjParamAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().addAttribute(Attribute::ReadNone);</Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a4cbb2344996abd4332716e76178ad4f4">paramHasAttr</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadOnly))</Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal">      ValidObjParamAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().addAttribute(Attribute::ReadOnly);</Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60e">Attribute::AttrKind</a> AK : ExactAttrsToPropagate) &#123;</Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> Attr = CB.<a href="/docs/api/classes/llvm/callbase/#a50b4d34365cf704260dd9e43796144ea">getParamAttr</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, AK);</Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Attr.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>())</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal">        ValidExactParamAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().addAttribute(Attr);</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">    HasAttrToPropagate |= ValidObjParamAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().hasAttributes();</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal">    HasAttrToPropagate |= ValidExactParamAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>().hasAttributes();</Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Won&#39;t be able to propagate anything.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HasAttrToPropagate)</Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : &#42;CalledFunction) &#123;</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Ins : BB) &#123;</Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InnerCB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(&amp;Ins);</Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InnerCB)</Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewInnerCB = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallBase&gt;</a>(VMap.<a href="/docs/api/classes/llvm/valuemap/#a15f92579a5fc316dab8cd1fad51015ef">lookup</a>(InnerCB));</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewInnerCB)</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The InnerCB might have be simplified during the inlining</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// process which can make propagation incorrect.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a6711ec71d15ab34fb6eedc26d5b5da80">isSimplified</a>(InnerCB, NewInnerCB))</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal">      AttributeList AL = NewInnerCB-&gt;getAttributes();</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = InnerCB-&gt;arg&#95;size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// It&#39;s unsound or requires special handling to propagate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// attributes to byval arguments. Even if CalledFunction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// doesn&#39;t e.g. write to the argument (readonly), the call to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// NewInnerCB may write to its by-value copy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewInnerCB-&gt;paramHasAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ByVal))</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Don&#39;t bother propagating attrs to constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(NewInnerCB-&gt;getArgOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal">                  <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">llvm::PatternMatch::m&#95;ImmConstant</a>()))</Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Check if the underlying value for the parameter is an argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;Arg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(InnerCB-&gt;getArgOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgNo;</Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Arg) &#123;</Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal">          ArgNo = Arg-&gt;<a href="/docs/api/classes/llvm/argument/#ab205d366b1137026c32f5678f7cc2726">getArgNo</a>();</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// For dereferenceable, dereferenceable&#95;or&#95;null, align, etc...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// we don&#39;t want to propagate if the existing param has the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// attribute with &quot;better&quot; constraints. So  remove from the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// new AL if the region of the existing param is larger than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// what we can propagate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal">          AttrBuilder NewAB&#123;</Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">              Context, <a href="/docs/api/classes/llvm/attributeset/#ae8ed437b15a7ca943716e5284a9cb9a6">AttributeSet::get</a>(Context, ValidExactParamAttrs&#91;ArgNo&#93;)&#125;;</Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AL.getParamDereferenceableBytes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &gt;</Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">              NewAB.getDereferenceableBytes())</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">            NewAB.removeAttribute(Attribute::Dereferenceable);</Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AL.getParamDereferenceableOrNullBytes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &gt;</Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal">              NewAB.getDereferenceableOrNullBytes())</Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal">            NewAB.removeAttribute(Attribute::DereferenceableOrNull);</Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AL.getParamAlignment(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).valueOrOne() &gt;</Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">              NewAB.getAlignment().valueOrOne())</Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal">            NewAB.removeAttribute(Attribute::Alignment);</Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ExistingRange = AL.getParamRange(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewRange = NewAB.getRange()) &#123;</Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/constantrange">ConstantRange</a> CombinedRange =</Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal">                  ExistingRange-&gt;<a href="/docs/api/classes/llvm/constantrange/#ac098fe4f07549fb029fbf950dbe78fd3">intersectWith</a>(&#42;NewRange);</Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal">              NewAB.removeAttribute(Attribute::Range);</Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">              NewAB.addRangeAttr(CombinedRange);</Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">          AL = AL.addParamAttributes(Context, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NewAB);</Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewInnerCB-&gt;getArgOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getType()-&gt;isPointerTy()) &#123;</Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Check if the underlying value for the parameter is an argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;UnderlyingV =</Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(InnerCB-&gt;getArgOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal">          Arg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(UnderlyingV);</Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Arg)</Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">          ArgNo = Arg-&gt;<a href="/docs/api/classes/llvm/argument/#ab205d366b1137026c32f5678f7cc2726">getArgNo</a>();</Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If so, propagate its access attributes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal">        AL = AL.addParamAttributes(Context, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ValidObjParamAttrs&#91;ArgNo&#93;);</Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We can have conflicting attributes from the inner callsite and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to-be-inlined callsite. In that case, choose the most</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// restrictive.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// readonly + writeonly means we can never deref so make readnone.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AL.hasParamAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadOnly) &amp;&amp;</Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">            AL.hasParamAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::WriteOnly))</Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">          AL = AL.addParamAttribute(Context, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadNone);</Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If have readnone, need to clear readonly/writeonly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AL.hasParamAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadNone)) &#123;</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">          AL = AL.removeParamAttribute(Context, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadOnly);</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal">          AL = AL.removeParamAttribute(Context, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::WriteOnly);</Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Writable cannot exist in conjunction w/ readonly/readnone</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AL.hasParamAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadOnly) ||</Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">            AL.hasParamAttr(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::ReadNone))</Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">          AL = AL.removeParamAttribute(Context, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Attribute::Writable);</Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal">      NewInnerCB-&gt;setAttributes(AL);</Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Only allow these white listed attributes to be propagated back to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal"></Highlight><Highlight kind="comment">// callee. This is because other attributes may only be valid on the call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal"></Highlight><Highlight kind="comment">// itself, i.e. attributes such as signext and zeroext.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Attributes that are always okay to propagate as if they are violated its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal"></Highlight><Highlight kind="comment">// immediate UB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515" lineLink="#a006ce5c0c5ec18c589454f270a335a3c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> AttrBuilder <a href="#a006ce5c0c5ec18c589454f270a335a3c">IdentifyValidUBGeneratingAttributes</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB) &#123;</Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">  AttrBuilder Valid(CB.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DerefBytes = CB.<a href="/docs/api/classes/llvm/callbase/#ab114d0e71d6a1db826bade5d22b0028c">getRetDereferenceableBytes</a>())</Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal">    Valid.addDereferenceableAttr(DerefBytes);</Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DerefOrNullBytes = CB.<a href="/docs/api/classes/llvm/callbase/#acf32f4feeff0b07e12c42c614a4791c1">getRetDereferenceableOrNullBytes</a>())</Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">    Valid.addDereferenceableOrNullAttr(DerefOrNullBytes);</Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a330471067c17061b7c2152d75102f24a">hasRetAttr</a>(Attribute::NoAlias))</Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal">    Valid.addAttribute(Attribute::NoAlias);</Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a330471067c17061b7c2152d75102f24a">hasRetAttr</a>(Attribute::NoUndef))</Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">    Valid.addAttribute(Attribute::NoUndef);</Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Valid;</Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Attributes that need additional checks as propagating them may change</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal"></Highlight><Highlight kind="comment">// behavior or cause new UB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530" lineLink="#a7e0764cee9d3754f276a61e53da1c2b4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> AttrBuilder <a href="#a7e0764cee9d3754f276a61e53da1c2b4">IdentifyValidPoisonGeneratingAttributes</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB) &#123;</Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">  AttrBuilder Valid(CB.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a330471067c17061b7c2152d75102f24a">hasRetAttr</a>(Attribute::NonNull))</Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal">    Valid.addAttribute(Attribute::NonNull);</Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a330471067c17061b7c2152d75102f24a">hasRetAttr</a>(Attribute::Alignment))</Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal">    Valid.addAlignmentAttr(CB.<a href="/docs/api/classes/llvm/callbase/#a16d457bc91b566b5fdcb785dfc8862e7">getRetAlign</a>());</Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (std::optional&lt;ConstantRange&gt; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> = CB.<a href="/docs/api/classes/llvm/callbase/#aa64b47f684944bcb9aea2c1350440cd7">getRange</a>())</Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal">    Valid.addRangeAttr(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Valid;</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541" lineLink="#a8843a51d7d6aaf2e81c17ae86f86d3f6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8843a51d7d6aaf2e81c17ae86f86d3f6">AddReturnAttributes</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;VMap,</Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal">                                <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> &amp;InlinedFunctionInfo) &#123;</Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">  AttrBuilder ValidUB = <a href="#a006ce5c0c5ec18c589454f270a335a3c">IdentifyValidUBGeneratingAttributes</a>(CB);</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">  AttrBuilder ValidPG = <a href="#a7e0764cee9d3754f276a61e53da1c2b4">IdentifyValidPoisonGeneratingAttributes</a>(CB);</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ValidUB.hasAttributes() &amp;&amp; !ValidPG.hasAttributes())</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CalledFunction = CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Context = CalledFunction-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;BB : &#42;CalledFunction) &#123;</Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(BB.getTerminator());</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RI || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallBase&gt;</a>(RI-&gt;getOperand(0)))</Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RetVal = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(RI-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check that the cloned RetVal exists and is a call, otherwise we cannot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// add the attributes on the cloned RetVal. Simplification during inlining</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// could have transformed the cloned instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewRetVal = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallBase&gt;</a>(VMap.<a href="/docs/api/classes/llvm/valuemap/#a15f92579a5fc316dab8cd1fad51015ef">lookup</a>(RetVal));</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewRetVal)</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The RetVal might have be simplified during the inlining</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// process which can make propagation incorrect.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a6711ec71d15ab34fb6eedc26d5b5da80">isSimplified</a>(RetVal, NewRetVal))</Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Backward propagation of attributes to the returned value may be incorrect</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if it is control flow dependent.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Consider:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// @callee &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  %rv = call @foo()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  %rv2 = call @bar()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  if (%rv2 != null)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    return %rv2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  if (%rv == null)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    exit()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  return %rv</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// caller() &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   %val = call nonnull @callee()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Here we cannot add the nonnull attribute on either foo or bar. So, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// limit the check to both RetVal and RI are in the same basic block and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// there are no throwing/exiting instructions between these instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RI-&gt;getParent() != RetVal-&gt;getParent() ||</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal">        <a href="#a91afe718c3cb2b248f39e1fd250ac91a">MayContainThrowingOrExitingCallAfterCB</a>(RetVal, RI))</Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add to the existing attributes of NewRetVal, i.e. the cloned call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// NB! When we have the same attribute already existing on NewRetVal, but</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// with a differing value, the AttributeList&#39;s merge API honours the already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// existing attribute value (i.e. attributes such as dereferenceable,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// dereferenceable&#95;or&#95;null etc). See AttrBuilder::merge for more details.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">    AttributeList AL = NewRetVal-&gt;getAttributes();</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ValidUB.getDereferenceableBytes() &lt; AL.getRetDereferenceableBytes())</Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">      ValidUB.removeAttribute(Attribute::Dereferenceable);</Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ValidUB.getDereferenceableOrNullBytes() &lt;</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal">        AL.getRetDereferenceableOrNullBytes())</Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">      ValidUB.removeAttribute(Attribute::DereferenceableOrNull);</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal">    AttributeList NewAL = AL.addRetAttributes(Context, ValidUB);</Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Attributes that may generate poison returns are a bit tricky. If we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// propagate them, other uses of the callsite might have their behavior</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// change or cause UB (if they have noundef) b.c of the new potential</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Take the following three cases:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// define nonnull ptr @foo() &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   %p = call ptr @bar()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   call void @use(ptr %p) willreturn nounwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   ret ptr %p</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// define noundef nonnull ptr @foo() &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   %p = call ptr @bar()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   call void @use(ptr %p) willreturn nounwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   ret ptr %p</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 3)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// define nonnull ptr @foo() &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   %p = call noundef ptr @bar()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   ret ptr %p</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In case 1, we can&#39;t propagate nonnull because poison value in @use may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// change behavior or trigger UB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In case 2, we don&#39;t need to be concerned about propagating nonnull, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// any new poison at @use will trigger UB anyways.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In case 3, we can never propagate nonnull because it may create UB due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the noundef on @bar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ValidPG.getAlignment().valueOrOne() &lt; AL.getRetAlignment().valueOrOne())</Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="normal">      ValidPG.removeAttribute(Attribute::Alignment);</Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ValidPG.hasAttributes()) &#123;</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> CBRange = ValidPG.getAttribute(Attribute::Range);</Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CBRange.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>()) &#123;</Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/attribute">Attribute</a> NewRange = AL.getRetAttr(Attribute::Range);</Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewRange.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>()) &#123;</Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">          ValidPG.addRangeAttr(</Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal">              CBRange.<a href="/docs/api/classes/llvm/attribute/#a10eb642c38648a5edb4a6bc7ce217a17">getRange</a>().<a href="/docs/api/classes/llvm/constantrange/#ac098fe4f07549fb029fbf950dbe78fd3">intersectWith</a>(NewRange.<a href="/docs/api/classes/llvm/attribute/#a10eb642c38648a5edb4a6bc7ce217a17">getRange</a>()));</Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Three checks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the callsite has &#96;noundef&#96;, then a poison due to violating the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// return attribute will create UB anyways so we can always propagate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Otherwise, if the return value (callee to be inlined) has &#96;noundef&#96;, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// can&#39;t propagate as a new poison return will cause UB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Finally, check if the return value has no uses whose behavior may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// change/may cause UB if we potentially return poison. At the moment this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// is implemented overly conservatively with a single-use check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Update the single-use check to iterate through uses and only bail</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// if we have a potentially dangerous use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a330471067c17061b7c2152d75102f24a">hasRetAttr</a>(Attribute::NoUndef) ||</Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal">          (RetVal-&gt;hasOneUse() &amp;&amp; !RetVal-&gt;hasRetAttr(Attribute::NoUndef)))</Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal">        NewAL = NewAL.addRetAttributes(Context, ValidPG);</Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">    NewRetVal-&gt;setAttributes(NewAL);</Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="comment">/// If the inlined function has non-byval align arguments, then</Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="comment">/// add @llvm.assume-based alignment assumptions to preserve this information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664" lineLink="#ae54a643a9f9d83374bb4d7d22d4662d7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ae54a643a9f9d83374bb4d7d22d4662d7">AddAlignmentAssumptions</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp;IFI) &#123;</Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a4224e0e010bb5413dc74243c276724f5">PreserveAlignmentAssumptions</a> || !IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a>)</Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC = &amp;IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a>(&#42;CB.<a href="/docs/api/classes/llvm/callbase/#afac5b39bcbb90d660f83d9b4bd8c6d95">getCaller</a>());</Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = CB.<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To avoid inserting redundant assumptions, we should check for assumptions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// already in the caller. To do this, we might need a DT of the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> DT;</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> DTCalculated = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFunc = CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/argument">Argument</a> &amp;Arg : CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a49e6c89ce42a55a93ddf38d21bbd198e">args</a>()) &#123;</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Arg.getType()-&gt;isPointerTy() || Arg.hasPassPointeeByValueCopyAttr() ||</Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">        Arg.hasNUses(0))</Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> Alignment = Arg.getParamAlign();</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Alignment)</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DTCalculated) &#123;</Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">      DT.<a href="/docs/api/classes/llvm/dominatortreebase/#aa0641ae965656ff9988d67a35140e4d9">recalculate</a>(&#42;CB.<a href="/docs/api/classes/llvm/callbase/#afac5b39bcbb90d660f83d9b4bd8c6d95">getCaller</a>());</Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal">      DTCalculated = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we can already prove the asserted alignment in the context of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// caller, then don&#39;t bother inserting the assumption.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ArgVal = CB.<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(Arg.getArgNo());</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a607b7fac55adc5ea9ed40a78e48a5b00">getKnownAlignment</a>(ArgVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;CB, AC, &amp;DT) &gt;= &#42;Alignment)</Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewAsmp = <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a>(&amp;CB).CreateAlignmentAssumption(</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ArgVal, Alignment-&gt;value());</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal">    AC-&gt;<a href="/docs/api/classes/llvm/assumptioncache/#a23187618f079555e127ba0e7b4581530">registerAssumption</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AssumeInst&gt;</a>(NewAsmp));</Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701" lineLink="#a94b383e649f60242503ff47c799fd22e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a94b383e649f60242503ff47c799fd22e">HandleByValArgumentInit</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;ByValType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Dst, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src,</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/module">Module</a> &#42;M, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBlock,</Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp;IFI,</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFunc) &#123;</Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertBlock, InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> =</Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(M-&gt;getDataLayout().getTypeStoreSize(ByValType));</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Always generate a memcpy of alignment 1 here because we don&#39;t know</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the alignment of the src pointer.  Other optimizations can infer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// better alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(Dst, </Highlight><Highlight kind="comment">/&#42;DstAlign&#42;/</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/align">Align</a>(1), Src,</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal">                                      </Highlight><Highlight kind="comment">/&#42;SrcAlign&#42;/</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/align">Align</a>(1), <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The verifier requires that all calls of debug-info-bearing functions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from debug-info-bearing functions have a debug location (for inlining</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// purposes). Assign a dummy location to satisfy the constraint.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>() &amp;&amp; InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a4d834f9897d15e3a6349063b5d637cd8">getSubprogram</a>())</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a4d834f9897d15e3a6349063b5d637cd8">getSubprogram</a>())</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal">      CI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(SP-&gt;getContext(), 0, 0, SP));</Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="comment">/// When inlining a call site that has a byval argument,</Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="comment">/// we have to make the implicit memcpy explicit by adding it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726" lineLink="#ae2ebbbbc990e3d932da5d0d0ea255f42"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ae2ebbbbc990e3d932da5d0d0ea255f42">HandleByValArgument</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;ByValType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg,</Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TheCall,</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFunc,</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp;IFI,</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal">                                  <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> ByValAlignment) &#123;</Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Caller = TheCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Caller-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the called function is readonly, then it could not mutate the caller&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// copy of the byval&#39;d memory.  In this case, it is safe to elide the copy and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// temporary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#af7736e14235372b75b72e119f852c280">onlyReadsMemory</a>()) &#123;</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the byval argument has a specified alignment that is greater than the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// passed in pointer, then we either have to round up the input pointer or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// give up on this transformation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ByValAlignment.<a href="/docs/api/structs/llvm/maybealign/#a06846474be3ab85f8d30c388faf3b116">valueOrOne</a>() == 1)</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Arg;</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC =</Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal">        IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a> ? &amp;IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a>(&#42;Caller) : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the pointer is already known to be sufficiently aligned, or if we can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// round it up to a larger alignment, then we don&#39;t need a temporary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a6e7b79b3933def717c2a0f2fc6fa38e0">getOrEnforceKnownAlignment</a>(Arg, &#42;ByValAlignment, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TheCall, AC) &gt;=</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">        &#42;ByValAlignment)</Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Arg;</Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, we have to make a memcpy to get a safe alignment.  This is bad</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for code quality, but rarely happens and is required for correctness.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the alloca.  If we have DataLayout, use nice alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPrefTypeAlign(ByValType);</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the byval had an alignment specified, we &#42;must&#42; use at least that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// alignment, as it is required by the byval argument (and uses of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// pointer inside the callee).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ByValAlignment)</Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">    Alignment = std::max(Alignment, &#42;ByValAlignment);</Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;NewAlloca =</Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a>(ByValType, Arg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>(),</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal">                     </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, Alignment, Arg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal">  NewAlloca-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(Caller-&gt;begin()-&gt;begin());</Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="normal">  IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a9c259c76065eb3b4ce3697ce346008ce">StaticAllocas</a>.push&#95;back(NewAlloca);</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Uses of the argument in the function should use our new alloca</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewAlloca;</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Check whether this Value is used by a lifetime intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778" lineLink="#ae21f217cd2f8044e639f13111a0b37db"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ae21f217cd2f8044e639f13111a0b37db">isUsedByLifetimeMarker</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : V-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isLifetimeStartOrEnd())</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Check whether the given alloca already has</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="normal"></Highlight><Highlight kind="comment">// lifetime.start or lifetime.end intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788" lineLink="#afaa78d0b3224d3175937f997dc2bc688"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#afaa78d0b3224d3175937f997dc2bc688">hasLifetimeMarkers</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI) &#123;</Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a5d19f3955a23e8eb2a974efcc8fb19da">getType</a>();</Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Int8PtrTy =</Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(Ty-&gt;getContext(), Ty-&gt;getPointerAddressSpace());</Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ty == Int8PtrTy)</Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#ae21f217cd2f8044e639f13111a0b37db">isUsedByLifetimeMarker</a>(AI);</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do a scan to find all the casts to i8&#42;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U-&gt;getType() != Int8PtrTy) </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U-&gt;stripPointerCasts() != AI) </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ae21f217cd2f8044e639f13111a0b37db">isUsedByLifetimeMarker</a>(U))</Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="comment">/// Return the result of AI-&gt;isStaticAlloca() if AI were moved to the entry</Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="comment">/// block. Allocas used in inalloca calls and allocas of dynamic array size</Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="comment">/// cannot be static.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808" lineLink="#ad19c97a069133d179234826fc95c3bde"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ad19c97a069133d179234826fc95c3bde">allocaWouldBeStaticInEntry</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI ) &#123;</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#af4283a4cef4e2b88f565d827d5857e14">getArraySize</a>()) &amp;&amp; !AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9bb98c4ac4cf77f5782e5e41f2c6f38a">isUsedWithInAlloca</a>();</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="comment">/// Returns a DebugLoc for a new DILocation which is a clone of \\p OrigDL</Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="comment">/// inlined at \\p InlinedAt. \\p IANodes is an inlined-at cache.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814" lineLink="#a5217abbfbac8873d22a2dd6cdbb0bcc1"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="#a5217abbfbac8873d22a2dd6cdbb0bcc1">inlineDebugLoc</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> OrigDL, <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;InlinedAt,</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx,</Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MDNode &#42;, MDNode &#42;&gt;</a> &amp;IANodes) &#123;</Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IA = <a href="/docs/api/classes/llvm/debugloc/#a55acf718f2931a7050c4ed39eb0434e7">DebugLoc::appendInlinedAt</a>(OrigDL, InlinedAt, Ctx, IANodes);</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(Ctx, OrigDL.<a href="/docs/api/classes/llvm/debugloc/#a427c256af834975c7869ad28fac00563">getLine</a>(), OrigDL.<a href="/docs/api/classes/llvm/debugloc/#a98eca4d65070b40322af34cf08842d8c">getCol</a>(),</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">                         OrigDL.<a href="/docs/api/classes/llvm/debugloc/#a51e7213ee467c71c8feec9ff30a580bd">getScope</a>(), IA);</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="comment">/// Update inlined instructions&#39; line numbers to</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="comment">/// to encode location where these instructions are inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824" lineLink="#a2ed4f37fbda15a9c05f333fde59e9fbb"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a2ed4f37fbda15a9c05f333fde59e9fbb">fixupLineNumbers</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FI,</Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TheCall, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CalleeHasDebugInfo) &#123;</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;TheCallDL = TheCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TheCallDL)</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Ctx = Fn-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;InlinedAtNode = TheCallDL;</Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a unique call site, not to be confused with any other call from the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// same location.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">  InlinedAtNode = <a href="/docs/api/classes/llvm/mdnode/#a21a975fd58c287a6ca3f1c89c048e7d3">DILocation::getDistinct</a>(</Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal">      Ctx, InlinedAtNode-&gt;getLine(), InlinedAtNode-&gt;getColumn(),</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal">      InlinedAtNode-&gt;getScope(), InlinedAtNode-&gt;getInlinedAt());</Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cache the inlined-at nodes as they&#39;re built so they are reused, without</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this every instruction&#39;s inlined-at chain would become distinct from each</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// other.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MDNode &#42;, MDNode &#42;&gt;</a> IANodes;</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we are not generating inline line tables and want to use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the call site location instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NoInlineLineTables = Fn-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(</Highlight><Highlight kind="stringliteral">&quot;no-inline-line-tables&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Helper-util for updating the metadata attached to an instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> UpdateInst = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Loop metadata needs to be updated so that the start and end locs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reference inlined-at locations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> updateLoopInfoLoc = &#91;&amp;Ctx, &amp;InlinedAtNode,</Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">                              &amp;IANodes&#93;(<a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;MD) -&gt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/loc">Loc</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;DILocation&gt;</a>(MD))</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a5217abbfbac8873d22a2dd6cdbb0bcc1">inlineDebugLoc</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, InlinedAtNode, Ctx, IANodes).<a href="/docs/api/classes/llvm/debugloc/#a4ff1bb484be62f8dac94fc087f72f524">get</a>();</Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MD;</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aecd4ed57fa6a20d048310d43f5c96da9">updateLoopMetadataDebugLocations</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, updateLoopInfoLoc);</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NoInlineLineTables)</Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc()) &#123;</Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> IDL =</Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal">            <a href="#a5217abbfbac8873d22a2dd6cdbb0bcc1">inlineDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, InlinedAtNode, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getContext(), IANodes);</Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setDebugLoc(IDL);</Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalleeHasDebugInfo &amp;&amp; !NoInlineLineTables)</Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the inlined instruction has no line number, or if inline info</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is not being generated, make it look as if it originates from the call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// location. This is important for ((&#95;&#95;always&#95;inline, &#95;&#95;nodebug&#95;&#95;))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// functions which must use caller location for all instructions in their</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// function body.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t update static allocas, as they may get moved later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ad19c97a069133d179234826fc95c3bde">allocaWouldBeStaticInEntry</a>(AI))</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do not force a debug loc for pseudo probes, since they do not need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// be debuggable, and also they are expected to have a zero/null dwarf</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// discriminator at this point which could be violated otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PseudoProbeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setDebugLoc(TheCallDL);</Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Helper-util for updating debug-info records attached to instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> UpdateDVR = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a> &#42;DVR) &#123;</Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DVR-&gt;getDebugLoc() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Debug Value must have debug loc&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NoInlineLineTables) &#123;</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">      DVR-&gt;setDebugLoc(TheCallDL);</Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = DVR-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> IDL =</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">        <a href="#a5217abbfbac8873d22a2dd6cdbb0bcc1">inlineDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, InlinedAtNode,</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">                       DVR-&gt;getMarker()-&gt;getParent()-&gt;<a href="/docs/api/classes/llvm/mdnode/#ad2fecba192de6da1578bdcb78d524169">getContext</a>(), IANodes);</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">    DVR-&gt;setDebugLoc(IDL);</Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over all instructions, updating metadata and debug-info records.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; FI != Fn-&gt;<a href="/docs/api/classes/llvm/function/#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); ++FI) &#123;</Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;FI) &#123;</Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal">      UpdateInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a> &amp;DVR : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDbgRecordRange()) &#123;</Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">        UpdateDVR(&amp;DVR);</Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove debug info intrinsics if we&#39;re not keeping inline info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NoInlineLineTables) &#123;</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BI = FI-&gt;begin();</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (BI != FI-&gt;end()) &#123;</Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BI)) &#123;</Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">          BI = BI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">          BI-&gt;dropDbgRecords();</Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">        ++BI;</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#undef DEBUG&#95;TYPE</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;assignment-tracking&quot;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="comment">/// Find Alloca and linked DbgAssignIntrinsic for locals escaped by \\p CB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933" lineLink="#a2ebf7459caf9252729048bd9c5231f6c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/at/#ae216cdb7393c1e862a61c8da9c1508ed">at::StorageToVarsMap</a> <a href="#a2ebf7459caf9252729048bd9c5231f6c">collectEscapedLocals</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">                                                 </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB) &#123;</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/at/#ae216cdb7393c1e862a61c8da9c1508ed">at::StorageToVarsMap</a> EscapedLocals;</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 4&gt;</a> SeenBases;</Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;# Finding caller local variables escaped by callee\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg : CB.<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>()) &#123;</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;INSPECT: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Arg &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Arg-&gt;getType()-&gt;isPointerTy()) &#123;</Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; | SKIP: Not a pointer\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Arg);</Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; | SKIP: Not result of instruction\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Walk back to the base storage.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Arg-&gt;getType()-&gt;isPtrOrPtrVectorTy());</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> TmpOffset(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(Arg-&gt;getType()), 0, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(</Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">        Arg-&gt;stripAndAccumulateConstantOffsets(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TmpOffset, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) &#123;</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; | SKIP: Couldn&#39;t walk back to base storage\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; | BASE: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We only need to process each base address once - skip any duplicates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SeenBases.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>).second)</Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find all local variables associated with the backing storage.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CollectAssignsForStorage = &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DbgAssign) &#123;</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip variables from inlined functions - they are not local variables.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DbgAssign-&gt;getDebugLoc().getInlinedAt())</Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &gt; DEF : &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;DbgAssign &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">      EscapedLocals&#91;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>&#93;.insert(<a href="/docs/api/structs/llvm/at/varrecord">at::VarRecord</a>(DbgAssign));</Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>), CollectAssignsForStorage);</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>), CollectAssignsForStorage);</Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EscapedLocals;</Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983" lineLink="#ae71573dba191b26eda0d5ea27b81ef62"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ae71573dba191b26eda0d5ea27b81ef62">trackInlinedStores</a>(<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> <a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a>, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> End,</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB) &#123;</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;trackInlinedStores into &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">                    &lt;&lt; <a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a>-&gt;getParent()-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; from &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">                    &lt;&lt; CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = CB.<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/at/#a5c4090098e3eaedb61973431af4898b1">at::trackAssignments</a>(<a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a>, End, <a href="#a2ebf7459caf9252729048bd9c5231f6c">collectEscapedLocals</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CB), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="comment">/// Update inlined instructions&#39; DIAssignID metadata. We need to do this</Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="comment">/// otherwise a function inlined more than once into the same function</Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="comment">/// will cause DIAssignID to be shared by many instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995" lineLink="#ac6ad5b09bf38c4fc9d0c8a5b598fde3c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ac6ad5b09bf38c4fc9d0c8a5b598fde3c">fixupAssignments</a>(<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> <a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a>, <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> End) &#123;</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;DIAssignID &#42;, DIAssignID &#42;&gt;</a> Map;</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loop over all the inlined instructions. If we find a DIAssignID</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// attachment or use, replace it with a new version.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BBI = <a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a>; BBI != End; ++BBI) &#123;</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BBI)</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/at/#a64974d467d808a48c21d2b455ce3ecdd">at::remapAssignID</a>(Map, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#undef DEBUG&#95;TYPE</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;inline-function&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="comment">/// Update the block frequencies of the caller after a callee has been inlined.</Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="comment">/// Each block cloned into the caller has its block frequency scaled by the</Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="comment">/// ratio of CallSiteFreq/CalleeEntryFreq. This ensures that the cloned copy of</Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="comment">/// callee&#39;s entry block gets the same frequency as the callsite block and the</Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="comment">/// relative frequencies of all cloned blocks remain the same after cloning.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013" lineLink="#a83a2e4a8c4f5b3b8dee5407d55e8872d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a83a2e4a8c4f5b3b8dee5407d55e8872d">updateCallerBFI</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CallSiteBlock,</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal">                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;VMap,</Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;CallerBFI,</Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;CalleeBFI,</Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;CalleeEntryBlock) &#123;</Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> ClonedBBs;</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Entry : VMap) &#123;</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BasicBlock&gt;</a>(Entry.first) || !Entry.second)</Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OrigBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(Entry.first);</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ClonedBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(Entry.second);</Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Freq = CalleeBFI-&gt;<a href="/docs/api/classes/llvm/blockfrequencyinfo/#ab8b72c18add22acd827f7a6cd1ff1bff">getBlockFreq</a>(OrigBB);</Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ClonedBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ClonedBB).second) &#123;</Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Multiple blocks in the callee might get mapped to one cloned block in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the caller since we prune the callee as we clone it. When that happens,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we want to use the maximum among the original blocks&#39; frequencies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> NewFreq = CallerBFI-&gt;<a href="/docs/api/classes/llvm/blockfrequencyinfo/#ab8b72c18add22acd827f7a6cd1ff1bff">getBlockFreq</a>(ClonedBB);</Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewFreq &gt; Freq)</Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">        Freq = NewFreq;</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">    CallerBFI-&gt;<a href="/docs/api/classes/llvm/blockfrequencyinfo/#a13f090421b36f5795113215ab6c507ce">setBlockFreq</a>(ClonedBB, Freq);</Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EntryClone = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BasicBlock&gt;</a>(VMap.<a href="/docs/api/classes/llvm/valuemap/#a15f92579a5fc316dab8cd1fad51015ef">lookup</a>(&amp;CalleeEntryBlock));</Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">  CallerBFI-&gt;<a href="/docs/api/classes/llvm/blockfrequencyinfo/#a79d23612ec0c59f4c30ccfabfc2b312c">setBlockFreqAndScale</a>(</Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">      EntryClone, CallerBFI-&gt;<a href="/docs/api/classes/llvm/blockfrequencyinfo/#ab8b72c18add22acd827f7a6cd1ff1bff">getBlockFreq</a>(CallSiteBlock), ClonedBBs);</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="comment">/// Update the branch metadata for cloned call instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041" lineLink="#a8385c2a142c1616d8d486bcb93213649"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8385c2a142c1616d8d486bcb93213649">updateCallProfile</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;VMap,</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">                              </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a854ac9cfc31bb306b1495a508707dc26">ProfileCount</a> &amp;CalleeEntryCount,</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">                              </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;TheCall, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI,</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">                              <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;CallerBFI) &#123;</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalleeEntryCount.<a href="/docs/api/classes/llvm/function/profilecount/#a849a5f56eb7de1aceefc2f566c9931d8">isSynthetic</a>() || CalleeEntryCount.<a href="/docs/api/classes/llvm/function/profilecount/#a3f91c16432464ed01d0ff1b380786f9b">getCount</a>() &lt; 1)</Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CallSiteCount =</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">      PSI ? PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a37e70e7a7b5e8ebe792ecaec8639d16e">getProfileCount</a>(TheCall, CallerBFI) : std::nullopt;</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">  int64&#95;t CallCount =</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">      std::min(CallSiteCount.value&#95;or(0), CalleeEntryCount.<a href="/docs/api/classes/llvm/function/profilecount/#a3f91c16432464ed01d0ff1b380786f9b">getCount</a>());</Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aa7cd2cc36098475563ad0fd3371df2a6">updateProfileCallee</a>(Callee, -CallCount, &amp;VMap);</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054" lineLink="/docs/api/namespaces/llvm/#aa7cd2cc36098475563ad0fd3371df2a6"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#aa7cd2cc36098475563ad0fd3371df2a6">llvm::updateProfileCallee</a>(</Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee, int64&#95;t EntryDelta,</Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/valuemap">ValueMap&lt;const Value &#42;, WeakTrackingVH&gt;</a> &#42;VMap) &#123;</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CalleeCount = Callee-&gt;getEntryCount();</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CalleeCount)</Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint64&#95;t PriorEntryCount = CalleeCount-&gt;getCount();</Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since CallSiteCount is an estimate, it could exceed the original callee</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// count and has to be set to 0 so guard against underflow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint64&#95;t NewEntryCount =</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal">      (EntryDelta &lt; 0 &amp;&amp; static&#95;cast&lt;uint64&#95;t&gt;(-EntryDelta) &gt; PriorEntryCount)</Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal">          ? 0</Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="normal">          : PriorEntryCount + EntryDelta;</Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> updateVTableProfWeight = &#91;&#93;(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint64&#95;t NewEntryCount,</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">                                   </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint64&#95;t PriorEntryCount) &#123;</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;VPtr = <a href="/docs/api/structs/llvm/pgoindirectcallvisitor/#aba025734aa83b5cacf35c35bd572ee0e">PGOIndirectCallVisitor::tryGetVTableInstruction</a>(CB);</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPtr)</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#af38c031cd1488ca8f80ada31b3df9eac">scaleProfData</a>(&#42;VPtr, NewEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// During inlining ?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VMap) &#123;</Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">    uint64&#95;t CloneEntryCount = PriorEntryCount - NewEntryCount;</Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Entry : &#42;VMap) &#123;</Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(Entry.first))</Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(Entry.second)) &#123;</Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">          CI-&gt;updateProfWeight(CloneEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">          updateVTableProfWeight(CI, CloneEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(Entry.first))</Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;InvokeInst&gt;</a>(Entry.second)) &#123;</Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;updateProfWeight(CloneEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal">          updateVTableProfWeight(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, CloneEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EntryDelta) &#123;</Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal">    Callee-&gt;setEntryCount(NewEntryCount);</Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : &#42;Callee)</Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// No need to update the callsite if it is pruned during inlining.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VMap || VMap-&gt;<a href="/docs/api/classes/llvm/valuemap/#a3b82484785487f544dc6ef1c2b6a0ffd">count</a>(&amp;BB))</Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">            CI-&gt;updateProfWeight(NewEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal">            updateVTableProfWeight(CI, NewEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;updateProfWeight(NewEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">            updateVTableProfWeight(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, NewEntryCount, PriorEntryCount);</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="comment">/// An operand bundle &quot;clang.arc.attachedcall&quot; on a call indicates the call</Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="comment">/// result is implicitly consumed by a call to retainRV or claimRV immediately</Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="comment">/// after the call. This function inlines the retainRV/claimRV calls.</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="comment">/// There are three cases to consider:</Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="comment">/// 1 If there is a call to autoreleaseRV that takes a pointer to the returned</Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="comment">///    object in the callee return block, the autoreleaseRV call and the</Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="comment">///    retainRV/claimRV call in the caller cancel out. If the call in the caller</Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="comment">///    is a claimRV call, a call to objc&#95;release is emitted.</Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="comment">/// 2 If there is a call in the callee return block that doesn&#39;t have operand</Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="comment">///    bundle &quot;clang.arc.attachedcall&quot;, the operand bundle on the original call</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="comment">///    is transferred to the call in the callee.</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="comment">/// 3 Otherwise, a call to objc&#95;retain is inserted if the call in the caller is</Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="comment">///    a retainRV call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132" lineLink="#abf4fabc264b52dbd503f04805135a40e"><Highlight kind="normal"><a href="#abf4fabc264b52dbd503f04805135a40e">inlineRetainOrClaimRVCalls</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">objcarc::ARCInstKind</a> RVCallKind,</Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ReturnInst &#42;&gt;</a> &amp;Returns) &#123;</Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/objcarc/#ab3161a6067eaed051be4376266e9ac03">objcarc::isRetainOrClaimRV</a>(RVCallKind) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;unexpected ARC function&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsRetainRV = RVCallKind == <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2aa1226b5450384ce6ea5ed47c317303ee">objcarc::ARCInstKind::RetainRV</a>,</Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">       IsUnsafeClaimRV = !IsRetainRV;</Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RI : Returns) &#123;</Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetOpnd = <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">objcarc::GetRCIdentityRoot</a>(RI-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InsertRetainCall = IsRetainRV;</Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(RI-&gt;getContext());</Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Walk backwards through the basic block looking for either a matching</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// autoreleaseRV call or an unannotated call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> InstRange = <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">llvm::make&#95;range</a>(++(RI-&gt;getIterator().getReverse()),</Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal">                                      RI-&gt;getParent()-&gt;rend());</Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(InstRange)) &#123;</Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Ignore casts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() != Intrinsic::objc&#95;autoreleaseReturnValue ||</Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="normal">            !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;hasNUses(0) ||</Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">objcarc::GetRCIdentityRoot</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getOperand(0)) != RetOpnd)</Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we&#39;ve found a matching authoreleaseRV call:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// - If claimRV is attached to the call, insert a call to objc&#95;release</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//   and erase the autoreleaseRV call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// - If retainRV is attached to the call, just erase the autoreleaseRV</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//   call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsUnsafeClaimRV) &#123;</Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="normal">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><Highlight kind="normal">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(Intrinsic::objc&#95;release, &#123;&#125;, RetOpnd);</Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">        InsertRetainCall = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI)</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/objcarc/#ac5d623f0353e96c824196d6f6abc2dca">objcarc::GetRCIdentityRoot</a>(CI) != RetOpnd ||</Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/objcarc/#aefba9af2f61452f20f4c947b4c2e5f4e">objcarc::hasAttachedCallOpBundle</a>(CI))</Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we&#39;ve found an unannotated call that defines RetOpnd, add a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// &quot;clang.arc.attachedcall&quot; operand bundle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;BundleArgs&#91;&#93; = &#123;&#42;<a href="/docs/api/namespaces/llvm/objcarc/#aaa634580f5cb9e54209fa554bf8fb388">objcarc::getAttachedARCFunction</a>(&amp;CB)&#125;;</Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa97c65466bdd34abda6772dd32eb5d19">OperandBundleDef</a> OB(</Highlight><Highlight kind="stringliteral">&quot;clang.arc.attachedcall&quot;</Highlight><Highlight kind="normal">, BundleArgs);</Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewCall = <a href="/docs/api/classes/llvm/callbase/#a70d8ffa4f0ffa07bd736cb74d178d917">CallBase::addOperandBundle</a>(</Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal">          CI, <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca6c03d5e52bbdefc8c392e3ed77c7d6a1">LLVMContext::OB&#95;clang&#95;arc&#95;attachedcall</a>, OB, CI-&gt;getIterator());</Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal">      NewCall-&gt;copyMetadata(&#42;CI);</Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">      CI-&gt;replaceAllUsesWith(NewCall);</Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal">      CI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal">      InsertRetainCall = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsertRetainCall) &#123;</Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The retainRV is attached to the call and we&#39;ve failed to find a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// matching autoreleaseRV or an annotated call in the callee. Emit a call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to objc&#95;retain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(RI);</Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(Intrinsic::objc&#95;retain, &#123;&#125;, RetOpnd);</Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><Highlight kind="normal"></Highlight><Highlight kind="comment">// In contextual profiling, when an inline succeeds, we want to remap the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="normal"></Highlight><Highlight kind="comment">// indices of the callee into the index space of the caller. We can&#39;t just leave</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="normal"></Highlight><Highlight kind="comment">// them as-is because the same callee may appear in other places in this caller</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (other callsites), and its (callee&#39;s) counters and sub-contextual profile</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="normal"></Highlight><Highlight kind="comment">// tree would be potentially different.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Not all BBs of the callee may survive the opportunistic DCE InlineFunction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="normal"></Highlight><Highlight kind="comment">// does (same goes for callsites in the callee).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="normal"></Highlight><Highlight kind="comment">// We will return a pair of vectors, one for basic block IDs and one for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><Highlight kind="normal"></Highlight><Highlight kind="comment">// callsites. For such a vector V, V&#91;Idx&#93; will be -1 if the callee</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instrumentation with index Idx did not survive inlining, and a new value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="normal"></Highlight><Highlight kind="comment">// otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This function will update the caller&#39;s instrumentation intrinsics</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><Highlight kind="normal"></Highlight><Highlight kind="comment">// accordingly, mapping indices as described above. We also replace the &quot;name&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal"></Highlight><Highlight kind="comment">// operand because we use it to distinguish between &quot;own&quot; instrumentation and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal"></Highlight><Highlight kind="comment">// &quot;from callee&quot; instrumentation when performing the traversal of the CFG of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal"></Highlight><Highlight kind="comment">// caller. We traverse depth-first from the callsite&#39;s BB and up to the point we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal"></Highlight><Highlight kind="comment">// hit BBs owned by the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The return values will be then used to update the contextual</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal"></Highlight><Highlight kind="comment">// profile. Note: we only update the &quot;name&quot; and &quot;index&quot; operands in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instrumentation intrinsics, we leave the hash and total nr of indices as-is,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal"></Highlight><Highlight kind="comment">// it&#39;s not worth updating those.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::pair&lt;std::vector&lt;int64&#95;t&gt;, std::vector&lt;int64&#95;t&gt;&gt;</Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226" lineLink="#aa46864b5ba9d7d71163e2f00ab1cddf5"><Highlight kind="normal"><a href="#aa46864b5ba9d7d71163e2f00ab1cddf5">remapIndices</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;Caller, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;StartBB,</Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal">             <a href="/docs/api/classes/llvm/pgocontextualprofile">PGOContextualProfile</a> &amp;CtxProf, uint32&#95;t CalleeCounters,</Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal">             uint32&#95;t CalleeCallsites) &#123;</Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We&#39;ll allocate a new ID to imported callsite counters and callsites. We&#39;re</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// using -1 to indicate a counter we delete. Most likely the entry ID, for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// example, will be deleted - we don&#39;t want 2 IDs in the same BB, and the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// entry would have been cloned in the callsite&#39;s old BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="normal">  std::vector&lt;int64&#95;t&gt; CalleeCounterMap;</Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="normal">  std::vector&lt;int64&#95;t&gt; CalleeCallsiteMap;</Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="normal">  CalleeCounterMap.resize(CalleeCounters, -1);</Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="normal">  CalleeCallsiteMap.resize(CalleeCallsites, -1);</Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RewriteInstrIfNeeded = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instrprofincrementinst">InstrProfIncrementInst</a> &amp;Ins) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ins.getNameValue() == &amp;Caller)</Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> OldID = </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal">uint32&#95;t</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(Ins.getIndex()-&gt;getZExtValue());</Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalleeCounterMap&#91;OldID&#93; == -1)</Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><Highlight kind="normal">      CalleeCounterMap&#91;OldID&#93; = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#a84796b39de9d068136440712aa81fdc2">allocateNextCounterIndex</a>(Caller);</Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewID = </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal">uint32&#95;t</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(CalleeCounterMap&#91;OldID&#93;);</Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">    Ins.setNameValue(&amp;Caller);</Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">    Ins.setIndex(NewID);</Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RewriteCallsiteInsIfNeeded = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instrprofcallsite">InstrProfCallsite</a> &amp;Ins) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ins.getNameValue() == &amp;Caller)</Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> OldID = </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal">uint32&#95;t</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(Ins.getIndex()-&gt;getZExtValue());</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalleeCallsiteMap&#91;OldID&#93; == -1)</Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal">      CalleeCallsiteMap&#91;OldID&#93; = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#ac3c5b4f301446a93ad24380ce9108e4e">allocateNextCallsiteIndex</a>(Caller);</Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewID = </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal">uint32&#95;t</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(CalleeCallsiteMap&#91;OldID&#93;);</Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">    Ins.setNameValue(&amp;Caller);</Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal">    Ins.setIndex(NewID);</Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">  std::deque&lt;BasicBlock &#42;&gt; Worklist;</Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;const BasicBlock &#42;&gt;</a> Seen;</Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We will traverse the BBs starting from the callsite BB. The callsite BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will have at least a BB ID - maybe its own, and in any case the one coming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from the cloned function&#39;s entry BB. The other BBs we&#39;ll start seeing from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// there on may or may not have BB IDs. BBs with IDs belonging to our caller</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// are definitely not coming from the imported function and form a boundary</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// past which we don&#39;t need to traverse anymore. BBs may have no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instrumentation (because we originally inserted instrumentation as per</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// MST), in which case we&#39;ll traverse past them. An invariant we&#39;ll keep is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that a BB will have at most 1 BB ID. For example, in the callsite BB, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will delete the callee BB&#39;s instrumentation. This doesn&#39;t result in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// information loss: the entry BB of the callee will have the same count as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the callsite&#39;s BB. At the end of this traversal, all the callee&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instrumentation would be mapped into the caller&#39;s instrumentation index</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// space. Some of the callee&#39;s counters may be deleted (as mentioned, this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// should result in no loss of information).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><Highlight kind="normal">  Worklist.push&#95;back(StartBB);</Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.empty()) &#123;</Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BB = Worklist.front();</Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal">    Worklist.pop&#95;front();</Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BBID = <a href="/docs/api/classes/llvm/ctxprofanalysis/#a3a31a6be1881280b30e349edabc9ca43">CtxProfAnalysis::getBBInstrumentation</a>(&#42;BB);</Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BBID) &#123;</Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= RewriteInstrIfNeeded(&#42;BBID);</Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// this may be the entryblock from the inlined callee, coming into a BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that didn&#39;t have instrumentation because of MST decisions. Let&#39;s make</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// sure it&#39;s placed accordingly. This is a noop elsewhere.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal">      BBID-&gt;moveBefore(BB-&gt;getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InstrProfIncrementInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InstrProfIncrementInstStep&gt;</a>(Inc)) &#123;</Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Step instrumentation is used for select instructions. Inlining may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// have propagated a constant resulting in the condition of the select</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// being resolved, case in which function cloning resolves the value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// of the select, and elides the select instruction. If that is the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// case, the step parameter of the instrumentation will reflect that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We can delete the instrumentation in that case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Inc-&gt;getStep())) &#123;</Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Inc-&gt;getNextNode() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(Inc-&gt;getNextNode()));</Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal">            Inc-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="normal">          &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a4956305191cdba7f9995569d011a5ab7">isa&#95;and&#95;nonnull&lt;SelectInst&gt;</a>(Inc-&gt;getNextNode()));</Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="normal">            RewriteInstrIfNeeded(&#42;Inc);</Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inc != BBID) &#123;</Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// If we&#39;re here it means that the BB had more than 1 IDs, presumably</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// some coming from the callee. We &quot;made up our mind&quot; to keep the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// first one (which may or may not have been originally the caller&#39;s).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// All the others are superfluous and we delete them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="normal">          Inc-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><Highlight kind="normal">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CS = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InstrProfCallsite&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= RewriteCallsiteInsIfNeeded(&#42;CS);</Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BBID || <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB))</Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Seen.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(Succ).second)</Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">          Worklist.push&#95;back(Succ);</Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(CalleeCounterMap, &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;V) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> V != 0; &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Counter index mapping should be either to -1 or to non-zero index, &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;because the 0 &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;index corresponds to the entry BB of the caller&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(CalleeCallsiteMap, &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;V) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> V != 0; &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Callsite index mapping should be either to -1 or to non-zero index, &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;because there should have been at least a callsite - the inlined one &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;- which would have had a 0 index.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;std::move(CalleeCounterMap), std::move(CalleeCallsiteMap)&#125;;</Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Inline. If successful, update the contextual profile (if a valid one is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><Highlight kind="normal"></Highlight><Highlight kind="comment">// given).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The contextual profile data is organized in trees, as follows:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - each node corresponds to a function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - the root of each tree corresponds to an &quot;entrypoint&quot; - e.g.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    RPC handler for server side</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - the path from the root to a node is a particular call path</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - the counters stored in a node are counter values observed in that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    particular call path (&quot;context&quot;)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - the edges between nodes are annotated with callsite IDs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Updating the contextual profile after an inlining means, at a high level,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal"></Highlight><Highlight kind="comment">// copying over the data of the callee, &#42;&#42;intentionally without any value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><Highlight kind="normal"></Highlight><Highlight kind="comment">// scaling&#42;&#42;, and copying over the callees of the inlined callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356" lineLink="/docs/api/namespaces/llvm/#a9031658af970d96ad739450ec380d86a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/inlineresult">llvm::InlineResult</a> <a href="/docs/api/namespaces/llvm/#ab5a3ac0a249da0743dac1bd816d8e5d5">llvm::InlineFunction</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp;IFI,</Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/pgocontextualprofile">PGOContextualProfile</a> &amp;CtxProf,</Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MergeAttributes,</Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;CalleeAAR,</Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InsertLifetime,</Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/function">Function</a> &#42;ForwardVarArgsTo) &#123;</Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CtxProf)</Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5a3ac0a249da0743dac1bd816d8e5d5">InlineFunction</a>(CB, IFI, MergeAttributes, CalleeAAR, InsertLifetime,</Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="normal">                          ForwardVarArgsTo);</Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Caller = &#42;CB.<a href="/docs/api/classes/llvm/callbase/#afac5b39bcbb90d660f83d9b4bd8c6d95">getCaller</a>();</Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Callee = &#42;CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StartBB = CB.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get some preliminary data about the callsite before it might get inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Inlining shouldn&#39;t delete the callee, but it&#39;s cleaner (and low-cost) to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// get this data upfront and rely less on InlineFunction&#39;s behavior.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CalleeGUID = <a href="/docs/api/classes/llvm/assignguidpass/#a00cd72af35cb6bdeae06467500b531ae">AssignGUIDPass::getGUID</a>(Callee);</Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CallsiteIDIns = <a href="/docs/api/classes/llvm/ctxprofanalysis/#aa20d83f600303548f2e24aa2fc98e377">CtxProfAnalysis::getCallsiteInstrumentation</a>(CB);</Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CallsiteID =</Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal">uint32&#95;t</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(CallsiteIDIns-&gt;getIndex()-&gt;getZExtValue());</Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NumCalleeCounters = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#a79c320c14c6573f80c9b7fb61309025c">getNumCounters</a>(Callee);</Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NumCalleeCallsites = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#ac2f3cabd4e72d9ef095e567a4be43756">getNumCallsites</a>(Callee);</Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Ret = <a href="/docs/api/namespaces/llvm/#ab5a3ac0a249da0743dac1bd816d8e5d5">InlineFunction</a>(CB, IFI, MergeAttributes, CalleeAAR, InsertLifetime,</Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="normal">                            ForwardVarArgsTo);</Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ret.isSuccess())</Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Ret;</Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Inlining succeeded, we don&#39;t need the instrumentation of the inlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// callsite.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="normal">  CallsiteIDIns-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Assinging Maps and then capturing references into it in the lambda because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// captured structured bindings are a C++20 extension. We do also need a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// capture here, though.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IndicesMaps = <a href="#aa46864b5ba9d7d71163e2f00ab1cddf5">remapIndices</a>(Caller, StartBB, CtxProf,</Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">                                        NumCalleeCounters, NumCalleeCallsites);</Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint32&#95;t NewCountersSize = CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#a79c320c14c6573f80c9b7fb61309025c">getNumCounters</a>(Caller);</Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Updater = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/pgoctxprofcontext">PGOCtxProfContext</a> &amp;Ctx) &#123;</Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ctx.guid() == <a href="/docs/api/classes/llvm/assignguidpass/#a00cd72af35cb6bdeae06467500b531ae">AssignGUIDPass::getGUID</a>(Caller));</Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;CalleeCounterMap, CalleeCallsiteMap&#93; = IndicesMaps;</Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal">        (Ctx.counters().size() +</Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">llvm::count&#95;if</a>(CalleeCounterMap, &#91;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> V) &#123; return V != -1; &#125;) ==</Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal">         NewCountersSize) &amp;&amp;</Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;The caller&#39;s counters size should have grown by the number of new &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;distinct counters inherited from the inlined callee.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal">    Ctx.resizeCounters(NewCountersSize);</Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the callsite wasn&#39;t exercised in this context, the value of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// counters coming from it is 0 - which it is right now, after resizing them</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// - and so we&#39;re done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CSIt = Ctx.callsites().find(CallsiteID);</Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CSIt == Ctx.callsites().end())</Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CalleeCtxIt = CSIt-&gt;second.find(CalleeGUID);</Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The callsite was exercised, but not with this callee (so presumably this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is an indirect callsite). Again, we&#39;re done here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalleeCtxIt == CSIt-&gt;second.end())</Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Let&#39;s pull in the counter values and the subcontexts coming from the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlined callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;CalleeCtx = CalleeCtxIt-&gt;second;</Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CalleeCtx.guid() == CalleeGUID);</Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0U; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; CalleeCtx.counters().<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmreflect-cpp/#ac934769d93af95250952646a3829df4c">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> int64&#95;t NewIndex = CalleeCounterMap&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewIndex &gt;= 0) &#123;</Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewIndex != 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;counter index mapping shouldn&#39;t happen to a 0 &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">                                </Highlight><Highlight kind="stringliteral">&quot;index, that&#39;s the caller&#39;s entry BB&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal">        Ctx.counters()&#91;NewIndex&#93; = CalleeCtx.counters()&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OtherSet&#93; : CalleeCtx.callsites()) &#123;</Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> int64&#95;t NewCSIdx = CalleeCallsiteMap&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewCSIdx &gt;= 0) &#123;</Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewCSIdx != 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;callsite index mapping shouldn&#39;t happen to a 0 index, the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;caller must&#39;ve had at least one callsite (with such an index)&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">        Ctx.ingestAllContexts(NewCSIdx, std::move(OtherSet));</Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We know the traversal is preorder, so it wouldn&#39;t have yet looked at the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// sub-contexts of this context that it&#39;s currently visiting. Meaning, the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// erase below invalidates no iterators.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a5fe6005bf6e415c950c011fb65f12b8f">Deleted</a> = Ctx.callsites().erase(CallsiteID);</Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a5fe6005bf6e415c950c011fb65f12b8f">Deleted</a>);</Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><Highlight kind="normal">    (void)<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopdeletion-cpp/#a0f1c83c3d08d80b12c424962a5e94ce8a5fe6005bf6e415c950c011fb65f12b8f">Deleted</a>;</Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="normal">  CtxProf.<a href="/docs/api/classes/llvm/pgocontextualprofile/#a4c63680ee62ec8bd5918b4389e26bcd1">update</a>(Updater, Caller);</Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Ret;</Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><Highlight kind="comment">/// This function inlines the called function into the basic block of the</Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="comment">/// caller. This returns false if it is not possible to inline this call.</Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="comment">/// The program is still in a well defined state if this occurs though.</Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="comment">/// Note that this only does one level of inlining.  For example, if the</Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><Highlight kind="comment">/// instruction &#39;call B&#39; is inlined, and &#39;B&#39; calls &#39;C&#39;, then the call to &#39;C&#39; now</Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="comment">/// exists in the instruction stream.  Similarly this will inline a recursive</Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="comment">/// function by one level.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460" lineLink="/docs/api/namespaces/llvm/#ab5a3ac0a249da0743dac1bd816d8e5d5"><Highlight kind="normal"><a href="/docs/api/classes/llvm/inlineresult">llvm::InlineResult</a> <a href="/docs/api/namespaces/llvm/#ab5a3ac0a249da0743dac1bd816d8e5d5">llvm::InlineFunction</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/inlinefunctioninfo">InlineFunctionInfo</a> &amp;IFI,</Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MergeAttributes,</Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/aaresults">AAResults</a> &#42;CalleeAAR,</Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InsertLifetime,</Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/function">Function</a> &#42;ForwardVarArgsTo) &#123;</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CB.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() &amp;&amp; CB.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Instruction not in function!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: we don&#39;t inline callbr yet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallBrInst&gt;</a>(CB))</Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight><Highlight kind="stringliteral">&quot;We don&#39;t inline callbr yet.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If IFI has any state in it, zap it before we fill it in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><Highlight kind="normal">  IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#acbbc7320e82682aed3c325a08b187a2f">reset</a>();</Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFunc = CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CalledFunc ||               </Highlight><Highlight kind="comment">// Can&#39;t inline external function or indirect</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal">      CalledFunc-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a32e606ac4c88f71f14212e42b808e7f4">isDeclaration</a>()) </Highlight><Highlight kind="comment">// call!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight><Highlight kind="stringliteral">&quot;external or indirect&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The inliner does not know how to inline through calls with operand bundles</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in general ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ConvergenceControlToken = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#aecc0c27ae96638bc9d8fa4caffa92c31">hasOperandBundles</a>()) &#123;</Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> i = 0, e = CB.<a href="/docs/api/classes/llvm/callbase/#a35b3798829fba58f145ea59e4214e84a">getNumOperandBundles</a>(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> OBUse = CB.<a href="/docs/api/classes/llvm/callbase/#a1b38c4ecbbce4814b679f08b72b1d67f">getOperandBundleAt</a>(i);</Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="normal">      uint32&#95;t <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343ac101058e7ea21bbbf2a5ac893088e90b">Tag</a> = OBUse.getTagID();</Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// ... but it knows how to inline through &quot;deopt&quot; operand bundles ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343ac101058e7ea21bbbf2a5ac893088e90b">Tag</a> == <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB&#95;deopt</a>)</Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// ... and &quot;funclet&quot; operand bundles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343ac101058e7ea21bbbf2a5ac893088e90b">Tag</a> == <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca8997c6b0930e2c05209e95e7172c6cf3">LLVMContext::OB&#95;funclet</a>)</Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343ac101058e7ea21bbbf2a5ac893088e90b">Tag</a> == <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca6c03d5e52bbdefc8c392e3ed77c7d6a1">LLVMContext::OB&#95;clang&#95;arc&#95;attachedcall</a>)</Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343ac101058e7ea21bbbf2a5ac893088e90b">Tag</a> == <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9cadb925bc2eb2c117b3ec0b76d1e267127">LLVMContext::OB&#95;kcfi</a>)</Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343ac101058e7ea21bbbf2a5ac893088e90b">Tag</a> == <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9cacdf8ff962c6163eb5fae1f9b2fb5142a">LLVMContext::OB&#95;convergencectrl</a>) &#123;</Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="normal">        ConvergenceControlToken = OBUse.Inputs&#91;0&#93;.get();</Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight><Highlight kind="stringliteral">&quot;unsupported operand bundle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: The check below is redundant and incomplete. According to spec, if a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// convergent call is missing a token, then the caller is using uncontrolled</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// convergence. If the callee has an entry intrinsic, then the callee is using</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// controlled convergence, and the call cannot be inlined. A proper</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// implemenation of this check requires a whole new analysis that identifies</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// convergence in every function. For now, we skip that and just do this one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cursory check. The underlying assumption is that in a compiler flow that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fully implements convergence control tokens, there is no mixing of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// controlled and uncontrolled convergent operations in the whole program.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#ac32c9ebab7dfd3db749d0ab5e6e58b3e">isConvergent</a>()) &#123;</Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ConvergenceControlToken &amp;&amp;</Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal">        <a href="#aac60599e6b45dd035fa354b12afdd195">getConvergenceEntry</a>(CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>())) &#123;</Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;convergent call needs convergencectrl operand&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the call to the callee cannot throw, set the &#39;nounwind&#39; flag on any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// calls that we inline.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MarkNoUnwind = CB.<a href="/docs/api/classes/llvm/callbase/#aa87fae97a8c702741eca5a95748af49d">doesNotThrow</a>();</Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigBB = CB.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Caller = OrigBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// GC poses two hazards to inlining, which only occur when the callee has GC:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  1 If the caller has no GC, then the callee&#39;s GC must be propagated to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  2 If the caller has a differing GC, it is invalid to inline.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a5e63b88c979e47ac7da57890a45bd2c2">hasGC</a>()) &#123;</Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Caller-&gt;hasGC())</Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="normal">      Caller-&gt;setGC(CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa180549a789e99a98e599e8e183c4773">getGC</a>());</Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa180549a789e99a98e599e8e183c4773">getGC</a>() != Caller-&gt;getGC())</Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight><Highlight kind="stringliteral">&quot;incompatible GC&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the personality function from the callee if it contains a landing pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CalledPersonality =</Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal">      CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a6a0f6312963ee6fb0969243607174949">hasPersonalityFn</a>()</Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal">          ? CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a6f77e4e800ba4dffd63e8ddb330062aa">getPersonalityFn</a>()-&gt;<a href="/docs/api/classes/llvm/constant/#a6c6af867b9eca0a16600b50e31df0e33">stripPointerCasts</a>()</Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal">          : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the personality function used by the landing pads of the caller. If it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// exists, then check to see that it matches the personality function used in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CallerPersonality =</Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="normal">      Caller-&gt;hasPersonalityFn()</Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="normal">          ? Caller-&gt;getPersonalityFn()-&gt;stripPointerCasts()</Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="normal">          : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledPersonality) &#123;</Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CallerPersonality)</Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="normal">      Caller-&gt;setPersonalityFn(CalledPersonality);</Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the personality functions match, then we can perform the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlining. Otherwise, we can&#39;t inline.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: This isn&#39;t 100% true. Some personality functions are proper</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//       supersets of others and can be used in place of the other.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledPersonality != CallerPersonality)</Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight><Highlight kind="stringliteral">&quot;incompatible personality&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need to figure out which funclet the callsite was in so that we may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// properly nest the callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CallSiteEHPad = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallerPersonality) &#123;</Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6a">EHPersonality</a> Personality = <a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(CallerPersonality);</Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a5309dbf19ec5ccffe3072c6087e106d3">isScopedEHPersonality</a>(Personality)) &#123;</Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">      std::optional&lt;OperandBundleUse&gt; ParentFunclet =</Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal">          CB.<a href="/docs/api/classes/llvm/callbase/#a23ab5f34fb7b9476d45da0102ecbfae6">getOperandBundle</a>(<a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca8997c6b0930e2c05209e95e7172c6cf3">LLVMContext::OB&#95;funclet</a>);</Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ParentFunclet)</Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><Highlight kind="normal">        CallSiteEHPad = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FuncletPadInst&gt;</a>(ParentFunclet-&gt;Inputs.front());</Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// OK, the inlining site is legal.  What about the target function?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallSiteEHPad) &#123;</Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Personality == <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aab34bedfd8d86f0adbefe4ae0e708f428">EHPersonality::MSVC&#95;CXX</a>) &#123;</Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// The MSVC personality cannot tolerate catches getting inlined into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// cleanup funclets.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CleanupPadInst&gt;</a>(CallSiteEHPad)) &#123;</Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Ok, the call site is within a cleanuppad.  Let&#39;s check the callee</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// for catchpads.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;CalledBB : &#42;CalledFunc) &#123;</Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(CalledBB.getFirstNonPHIIt()))</Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal">                </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight><Highlight kind="stringliteral">&quot;catch in cleanup funclet&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab9c9fb92464f96c0e0f326d624e82eab">isAsynchronousEHPersonality</a>(Personality)) &#123;</Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// SEH is even less tolerant, there may not be any sort of exceptional</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// funclet in the callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;CalledBB : &#42;CalledFunc) &#123;</Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CalledBB.isEHPad())</Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a77027fdc657b15aa5dd3d022e0fc07d3">InlineResult::failure</a>(</Highlight><Highlight kind="stringliteral">&quot;SEH in cleanup funclet&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine if we are dealing with a call in an EHPad which does not unwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EHPadForCallUnwindsLocally = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallSiteEHPad &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(CB)) &#123;</Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal">    <a href="#a2af37358cf937d4298f5c5198bf91d34">UnwindDestMemoTy</a> FuncletUnwindMap;</Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CallSiteUnwindDestToken =</Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">        <a href="#a3cc72cfbc837c8e89491b6357c358778">getUnwindDestToken</a>(CallSiteEHPad, FuncletUnwindMap);</Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">    EHPadForCallUnwindsLocally =</Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal">        CallSiteUnwindDestToken &amp;&amp;</Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantTokenNone&gt;</a>(CallSiteUnwindDestToken);</Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get an iterator to the last basic block in the function, which will have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the new function inlined after it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> LastBlock = --Caller-&gt;end();</Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure to capture all of the return instructions from the cloned</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ReturnInst&#42;, 8&gt;</a> Returns;</Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/clonedcodeinfo">ClonedCodeInfo</a> InlinedFunctionInfo;</Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> FirstNewBlock;</Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">  &#123; </Highlight><Highlight kind="comment">// Scope to destroy VMap after cloning.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> VMap;</Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal">ByValInit &#123;</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Dst;</Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src;</Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty;</Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Keep a list of pair (dst, src) to emit byval initializations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ByValInit, 4&gt;</a> ByValInits;</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// When inlining a function that contains noalias scope metadata,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this metadata needs to be cloned so that the inlined blocks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// have different &quot;unique scopes&quot; at every call site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Track the metadata that must be cloned. Do this before other changes to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the function, so that we do not get in trouble when inlining caller ==</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// callee.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-inlinefunction-cpp-/scopedaliasmetadatadeepcloner/#a2cdcb38580357989c748de8d118013b5">ScopedAliasMetadataDeepCloner</a> SAMetadataCloner(CB.<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>());</Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Caller-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Calculate the vector of arguments to pass into the function cloner, which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// matches up the formal to the actual argument values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AI = CB.<a href="/docs/api/classes/llvm/callbase/#a4fb513d744ca72275932b2c7003f16f6">arg&#95;begin</a>();</Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgNo = 0;</Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function/#a1c9f2f058966db1f8ca270398bda8362">Function::arg&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>(),</Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal">         E = CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a8300ac1ef141b8a7c63c13fa9369d976">arg&#95;end</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++AI, ++ArgNo) &#123;</Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ActualArg = &#42;AI;</Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// When byval arguments actually inlined, we need to make the copy implied</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// by them explicit.  However, we don&#39;t do this if the callee is readonly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// or readnone, because the copy would be unneeded: the callee doesn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// modify the struct.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/callbase/#a610f151afe638890b21bea434a26821d">isByValArgument</a>(ArgNo)) &#123;</Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><Highlight kind="normal">        ActualArg = <a href="#ae2ebbbbc990e3d932da5d0d0ea255f42">HandleByValArgument</a>(CB.<a href="/docs/api/classes/llvm/callbase/#a88cc5fa65ff17e62b49dc5fb4401f813">getParamByValType</a>(ArgNo), ActualArg,</Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal">                                        &amp;CB, CalledFunc, IFI,</Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="normal">                                        CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a97fb0bcc88f78900c3d4780d963540e0">getParamAlign</a>(ArgNo));</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ActualArg != &#42;AI)</Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="normal">          ByValInits.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><Highlight kind="normal">              &#123;ActualArg, (<a href="/docs/api/classes/llvm/value">Value</a> &#42;)&#42;AI, CB.<a href="/docs/api/classes/llvm/callbase/#a88cc5fa65ff17e62b49dc5fb4401f813">getParamByValType</a>(ArgNo)&#125;);</Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">      VMap&#91;&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = ActualArg;</Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Remove this when users have been updated to the assume bundles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add alignment assumptions if necessary. We do this before the inlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions are actually cloned into the caller so that we can easily</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// check what will be known at the start of the inlined code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="normal">    <a href="#ae54a643a9f9d83374bb4d7d22d4662d7">AddAlignmentAssumptions</a>(CB, IFI);</Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC =</Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal">        IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a> ? &amp;IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a>(&#42;Caller) : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="comment">    /// Preserve all attributes on of the call and its parameters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa5df9c7cb06c08a066a30482d77cc1d9">salvageKnowledge</a>(&amp;CB, AC);</Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We want the inliner to prune the code as it copies.  We would LOVE to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// have no dead or constant instructions leftover after inlining occurs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (which can happen, e.g., because an argument was constant), but we&#39;ll be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// happy with whatever the cloner can do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7a6386c071e1087512cdc8a4071a02b5">CloneAndPruneFunctionInto</a>(Caller, CalledFunc, VMap,</Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal">                              </Highlight><Highlight kind="comment">/&#42;ModuleLevelChanges=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, Returns, </Highlight><Highlight kind="stringliteral">&quot;.i&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal">                              &amp;InlinedFunctionInfo);</Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remember the first block that is newly cloned over.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal">    FirstNewBlock = LastBlock; ++FirstNewBlock;</Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Insert retainRV/clainRV runtime calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2">objcarc::ARCInstKind</a> RVCallKind = <a href="/docs/api/namespaces/llvm/objcarc/#a0174304150a18968bb6e6436f5c675f2">objcarc::getAttachedARCFunctionKind</a>(&amp;CB);</Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RVCallKind != <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a6adf97f83acf6453d4a6a4b1070f3754">objcarc::ARCInstKind::None</a>)</Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal">      <a href="#abf4fabc264b52dbd503f04805135a40e">inlineRetainOrClaimRVCalls</a>(CB, RVCallKind, Returns);</Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Updated caller/callee profiles only when requested. For sample loader</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlining, the context-sensitive inlinee profile doesn&#39;t need to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// subtracted from callee profile, and the inlined clone also doesn&#39;t need</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to be scaled based on call site count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a2479f3ea47eee2627b24bddfa6333415">UpdateProfile</a>) &#123;</Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#ad01658587132e4b44ba8414b3a87fde5">CallerBFI</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a82c69d5928263cabdebf13ea93008be4">CalleeBFI</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Update the BFI of blocks cloned into the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal">        <a href="#a83a2e4a8c4f5b3b8dee5407d55e8872d">updateCallerBFI</a>(OrigBB, VMap, IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#ad01658587132e4b44ba8414b3a87fde5">CallerBFI</a>, IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a82c69d5928263cabdebf13ea93008be4">CalleeBFI</a>,</Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">                        CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a3ec0b920bf30d0e15bace383192691da">front</a>());</Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/codegen/mirsampleprofile-cpp/#a009775794ead70aa23c76df46ab4ed8a">Profile</a> = CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac154f7a85081237665c89b83bbd3d7e2">getEntryCount</a>())</Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal">        <a href="#a8385c2a142c1616d8d486bcb93213649">updateCallProfile</a>(CalledFunc, VMap, &#42;<a href="/docs/api/files/lib/lib/codegen/mirsampleprofile-cpp/#a009775794ead70aa23c76df46ab4ed8a">Profile</a>, CB, IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a200d08643d2038b04aa16716e8cd154b">PSI</a>,</Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal">                          IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#ad01658587132e4b44ba8414b3a87fde5">CallerBFI</a>);</Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Inject byval arguments initialization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (ByValInit &amp;<a href="/docs/api/classes/llvm/init">Init</a> : ByValInits)</Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal">      <a href="#a94b383e649f60242503ff47c799fd22e">HandleByValArgumentInit</a>(<a href="/docs/api/classes/llvm/init">Init</a>.Ty, <a href="/docs/api/classes/llvm/init">Init</a>.Dst, <a href="/docs/api/classes/llvm/init">Init</a>.Src, Caller-&gt;getParent(),</Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal">                              &amp;&#42;FirstNewBlock, IFI, CalledFunc);</Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal">    std::optional&lt;OperandBundleUse&gt; ParentDeopt =</Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal">        CB.<a href="/docs/api/classes/llvm/callbase/#a23ab5f34fb7b9476d45da0102ecbfae6">getOperandBundle</a>(<a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB&#95;deopt</a>);</Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ParentDeopt) &#123;</Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 2&gt;</a> OpDefs;</Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;VH : InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#aee51f754e9da74f168cd4d12e1eb5c7b">OperandBundleCallSites</a>) &#123;</Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;ICS = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallBase&gt;</a>(VH);</Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ICS)</Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// instruction was DCE&#39;d or RAUW&#39;ed to undef</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="normal">        OpDefs.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="normal">        OpDefs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(ICS-&gt;<a href="/docs/api/classes/llvm/callbase/#a35b3798829fba58f145ea59e4214e84a">getNumOperandBundles</a>());</Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> COBi = 0, COBe = ICS-&gt;<a href="/docs/api/classes/llvm/callbase/#a35b3798829fba58f145ea59e4214e84a">getNumOperandBundles</a>(); COBi &lt; COBe;</Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="normal">             ++COBi) &#123;</Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ChildOB = ICS-&gt;<a href="/docs/api/classes/llvm/callbase/#a1b38c4ecbbce4814b679f08b72b1d67f">getOperandBundleAt</a>(COBi);</Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ChildOB.getTagID() != <a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB&#95;deopt</a>) &#123;</Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// If the inlined call has other operand bundles, let them be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="normal">            OpDefs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(ChildOB);</Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// It may be useful to separate this logic (of handling operand</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// bundles) out to a separate &quot;policy&quot; component if this gets crowded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Prepend the parent&#39;s deoptimization continuation to the newly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// inlined call&#39;s deoptimization continuation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="normal">          std::vector&lt;Value &#42;&gt; MergedDeoptArgs;</Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="normal">          MergedDeoptArgs.reserve(ParentDeopt-&gt;Inputs.size() +</Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="normal">                                  ChildOB.Inputs.size());</Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">llvm::append&#95;range</a>(MergedDeoptArgs, ParentDeopt-&gt;Inputs);</Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">llvm::append&#95;range</a>(MergedDeoptArgs, ChildOB.Inputs);</Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="normal">          OpDefs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(</Highlight><Highlight kind="stringliteral">&quot;deopt&quot;</Highlight><Highlight kind="normal">, std::move(MergedDeoptArgs));</Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewI = <a href="/docs/api/classes/llvm/callbase/#aca631a010bfa5a055b7a07fe9e68f7e9">CallBase::Create</a>(ICS, OpDefs, ICS-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Note: the RAUW does the appropriate fixup in VMap, so we need to do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// this even if the call returns void.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">        ICS-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewI);</Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal">        VH = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">        ICS-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For &#39;nodebug&#39; functions, the associated DISubprogram is always null.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Conservatively avoid propagating the callsite debug location to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions inlined from a function whose DISubprogram is not null.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">    <a href="#a2ed4f37fbda15a9c05f333fde59e9fbb">fixupLineNumbers</a>(Caller, FirstNewBlock, &amp;CB,</Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal">                     CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a4d834f9897d15e3a6349063b5d637cd8">getSubprogram</a>() != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aa9ef2dbd1b7ce921093f7d4a7bd4cc5c">isAssignmentTrackingEnabled</a>(&#42;Caller-&gt;getParent())) &#123;</Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Interpret inlined stores to caller-local variables as assignments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">      <a href="#ae71573dba191b26eda0d5ea27b81ef62">trackInlinedStores</a>(FirstNewBlock, Caller-&gt;end(), CB);</Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Update DIAssignID metadata attachments and uses so that they are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// unique to this inlined instance.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal">      <a href="#ac6ad5b09bf38c4fc9d0c8a5b598fde3c">fixupAssignments</a>(FirstNewBlock, Caller-&gt;end());</Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now clone the inlined noalias scope metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal">    SAMetadataCloner.clone();</Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><Highlight kind="normal">    SAMetadataCloner.remap(FirstNewBlock, Caller-&gt;end());</Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add noalias metadata if necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal">    <a href="#aa35af336fee32786b6551e23d5b55fcf">AddAliasScopeMetadata</a>(CB, VMap, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CalleeAAR, InlinedFunctionInfo);</Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Clone return attributes on the callsite into the calls within the inlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// function which feed into its return value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">    <a href="#a8843a51d7d6aaf2e81c17ae86f86d3f6">AddReturnAttributes</a>(CB, VMap, InlinedFunctionInfo);</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Clone attributes on the params of the callsite to calls within the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlined function which use the same param.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal">    <a href="#af1986bc1d2d700807f4c8ef167bf6fdd">AddParamAndFnBasicAttributes</a>(CB, VMap, InlinedFunctionInfo);</Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal">    <a href="#a81fe0543b342a120ede7c69eeed77729">propagateMemProfMetadata</a>(CalledFunc, CB,</Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><Highlight kind="normal">                             InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a94c735687f007da4731abf87dc9fd8e5">ContainsMemProfMetadata</a>, VMap);</Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Propagate metadata on the callsite if necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal">    <a href="#a74b8b820b4b2d53dd53ba32821887473">PropagateCallSiteMetadata</a>(CB, FirstNewBlock, Caller-&gt;end());</Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Register any cloned assumptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a>)</Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;NewBlock :</Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(FirstNewBlock-&gt;getIterator(), Caller-&gt;end()))</Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : NewBlock)</Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">            IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a>(&#42;Caller).registerAssumption(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ConvergenceControlToken) &#123;</Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;IntrinsicCall = <a href="#aac60599e6b45dd035fa354b12afdd195">getConvergenceEntry</a>(&#42;FirstNewBlock);</Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrinsicCall) &#123;</Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><Highlight kind="normal">      IntrinsicCall-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ConvergenceControlToken);</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal">      IntrinsicCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are any alloca instructions in the block that used to be the entry</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block for the callee, move them to the entry block of the caller.  First</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// calculate which instruction they should be inserted before.  We insert the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions at the end of the current alloca list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><Highlight kind="normal">  &#123;</Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/classes/llvm/irbuilder">InsertPoint</a> = Caller-&gt;begin()-&gt;begin();</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = FirstNewBlock-&gt;begin(),</Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal">         E = FirstNewBlock-&gt;end(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) &#123;</Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++);</Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AI) </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the alloca is now dead, remove it.  This often occurs due to code</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// specialization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AI-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><Highlight kind="normal">        AI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ad19c97a069133d179234826fc95c3bde">allocaWouldBeStaticInEntry</a>(AI))</Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Keep track of the static allocas that we inline into the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">      IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a9c259c76065eb3b4ce3697ce346008ce">StaticAllocas</a>.push&#95;back(AI);</Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Scan for the block of allocas that we can move over, and move them</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// all at once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="normal">             !<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;use&#95;empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="normal">             <a href="#ad19c97a069133d179234826fc95c3bde">allocaWouldBeStaticInEntry</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &#123;</Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="normal">        IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a9c259c76065eb3b4ce3697ce346008ce">StaticAllocas</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="normal">        ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Transfer all of the allocas over in a block.  Using splice means</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that the instructions aren&#39;t removed from the symbol table, then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// reinserted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setTailBit(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="normal">      Caller-&gt;getEntryBlock().splice(<a href="/docs/api/classes/llvm/irbuilder">InsertPoint</a>, &amp;&#42;FirstNewBlock,</Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="normal">                                     AI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;,4&gt;</a> VarArgsToForward;</Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AttributeSet, 4&gt;</a> VarArgsAttrs;</Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>()-&gt;<a href="/docs/api/classes/llvm/functiontype/#a104d6154321899b53e40455e71d8e83a">getNumParams</a>();</Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="normal">       i &lt; CB.<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>(); i++) &#123;</Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="normal">    VarArgsToForward.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CB.<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(i));</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="normal">    VarArgsAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CB.<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>().getParamAttrs(i));</Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InlinedMustTailCalls = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, InlinedDeoptimizeCalls = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a6bbe5e652464ac9213907e3446874900">ContainsCalls</a>) &#123;</Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aef">CallInst::TailCallKind</a> CallSiteTailKind = <a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aefa28bea809e15b48558c89910b7fb924b6">CallInst::TCK&#95;None</a>;</Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;CB))</Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="normal">      CallSiteTailKind = CI-&gt;getTailCallKind();</Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For inlining purposes, the &quot;notail&quot; marker is the same as no marker.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallSiteTailKind == <a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aefa876f2a1fd3dd74831f85634cb14b72fe">CallInst::TCK&#95;NoTail</a>)</Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">      CallSiteTailKind = <a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aefa28bea809e15b48558c89910b7fb924b6">CallInst::TCK&#95;None</a>;</Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> BB = FirstNewBlock, E = Caller-&gt;end(); BB != E;</Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">         ++BB) &#123;</Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI)</Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Forward varargs from inlined call site to calls to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// ForwardVarArgsTo function, if requested, and to musttail calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VarArgsToForward.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><Highlight kind="normal">            ((ForwardVarArgsTo &amp;&amp;</Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal">              CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>() == ForwardVarArgsTo) ||</Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">             CI-&gt;<a href="/docs/api/classes/llvm/callinst/#ad3c897ba734b78e973db4622dff7bdcb">isMustTailCall</a>())) &#123;</Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Collect attributes for non-vararg parameters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal">          AttributeList Attrs = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>();</Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AttributeSet, 8&gt;</a> ArgAttrs;</Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Attrs.isEmpty() || !VarArgsAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgNo = 0;</Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal">                 ArgNo &lt; CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ac3c35bd078a268a207f607d0f57dadba">getFunctionType</a>()-&gt;getNumParams(); ++ArgNo)</Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">              ArgAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Attrs.getParamAttrs(ArgNo));</Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Add VarArg attributes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal">          ArgAttrs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(VarArgsAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), VarArgsAttrs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><Highlight kind="normal">          Attrs = AttributeList::get(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), Attrs.getFnAttrs(),</Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal">                                     Attrs.getRetAttrs(), ArgAttrs);</Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Add VarArgs to existing parameters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 6&gt;</a> Params(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>());</Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal">          Params.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(VarArgsToForward.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), VarArgsToForward.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewCI = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(</Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal">              CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ac3c35bd078a268a207f607d0f57dadba">getFunctionType</a>(), CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>(), Params, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, CI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal">          NewCI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal">          NewCI-&gt;<a href="/docs/api/classes/llvm/callbase/#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(Attrs);</Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal">          NewCI-&gt;<a href="/docs/api/classes/llvm/callbase/#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a3ff92cec76009e859cb0c419d6e8ba5f">getCallingConv</a>());</Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal">          CI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewCI);</Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal">          CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">          CI = NewCI;</Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>())</Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal">          InlinedDeoptimizeCalls |=</Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">              <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIntrinsicID() == Intrinsic::experimental&#95;deoptimize;</Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We need to reduce the strength of any inlined tail calls.  For</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// musttail, we have to avoid introducing potential unbounded stack</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// growth.  For example, if functions &#39;f&#39; and &#39;g&#39; are mutually recursive</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// with musttail, we can inline &#39;g&#39; into &#39;f&#39; so long as we preserve</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// musttail on the cloned call to &#39;f&#39;.  If either the inlined call site</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// or the cloned call site is &#42;not&#42; musttail, the program already has</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// one frame of stack growth, so it&#39;s safe to remove musttail.  Here is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// a table of example transformations:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//    f -&gt; musttail g -&gt; musttail f  ==&gt;  f -&gt; musttail f</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//    f -&gt; musttail g -&gt;     tail f  ==&gt;  f -&gt;     tail f</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//    f -&gt;          g -&gt; musttail f  ==&gt;  f -&gt;          f</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//    f -&gt;          g -&gt;     tail f  ==&gt;  f -&gt;          f</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Inlined notail calls should remain notail calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aef">CallInst::TailCallKind</a> ChildTCK = CI-&gt;<a href="/docs/api/classes/llvm/callinst/#a8f907245246e05c0220934144c013aee">getTailCallKind</a>();</Highlight></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ChildTCK != <a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aefa876f2a1fd3dd74831f85634cb14b72fe">CallInst::TCK&#95;NoTail</a>)</Highlight></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><Highlight kind="normal">          ChildTCK = std::min(CallSiteTailKind, ChildTCK);</Highlight></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><Highlight kind="normal">        CI-&gt;<a href="/docs/api/classes/llvm/callinst/#a68573712cd73746e416002907c9af79b">setTailCallKind</a>(ChildTCK);</Highlight></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><Highlight kind="normal">        InlinedMustTailCalls |= CI-&gt;<a href="/docs/api/classes/llvm/callinst/#ad3c897ba734b78e973db4622dff7bdcb">isMustTailCall</a>();</Highlight></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Call sites inlined through a &#39;nounwind&#39; call site should be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// &#39;nounwind&#39; as well. However, avoid marking call sites explicitly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// where possible. This helps expose more opportunities for CSE after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// inlining, commonly when the callee is an intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MarkNoUnwind &amp;&amp; !CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aa87fae97a8c702741eca5a95748af49d">doesNotThrow</a>())</Highlight></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><Highlight kind="normal">          CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a0b6cef2a78857b0236b1c3a2a6eb857e">setDoesNotThrow</a>();</Highlight></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Leave lifetime markers for the static alloca&#39;s, scoping them to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function we just inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need to insert lifetime intrinsics even at O0 to avoid invalid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// access caused by multithreaded coroutines. The check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#96;Caller-&gt;isPresplitCoroutine()&#96; would affect AlwaysInliner at O0 only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((InsertLifetime || Caller-&gt;isPresplitCoroutine()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><Highlight kind="normal">      !IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a9c259c76065eb3b4ce3697ce346008ce">StaticAllocas</a>.empty()) &#123;</Highlight></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> builder(&amp;&#42;FirstNewBlock, FirstNewBlock-&gt;begin());</Highlight></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI : IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a9c259c76065eb3b4ce3697ce346008ce">StaticAllocas</a>) &#123;</Highlight></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Don&#39;t mark swifterror allocas. They can&#39;t have bitcast uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a3016b467a9ecb5506956f7d029509db5">isSwiftError</a>())</Highlight></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the alloca is already scoped to something smaller than the whole</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// function then there&#39;s no need to add redundant, less accurate markers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#afaa78d0b3224d3175937f997dc2bc688">hasLifetimeMarkers</a>(AI))</Highlight></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Try to determine the size of the allocation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;AllocaSize = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;AIArraySize =</Highlight></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#af4283a4cef4e2b88f565d827d5857e14">getArraySize</a>())) &#123;</Highlight></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Caller-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;AllocaType = AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>();</Highlight></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/typesize">TypeSize</a> AllocaTypeSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(AllocaType);</Highlight></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><Highlight kind="normal">        uint64&#95;t AllocaArraySize = AIArraySize-&gt;getLimitedValue();</Highlight></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Don&#39;t add markers for zero-sized allocas.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllocaArraySize == 0)</Highlight></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Check that array size doesn&#39;t saturate uint64&#95;t and doesn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// overflow when it&#39;s multiplied by type size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllocaTypeSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><Highlight kind="normal">            AllocaArraySize != std::numeric&#95;limits&lt;uint64&#95;t&gt;::max() &amp;&amp;</Highlight></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><Highlight kind="normal">            std::numeric&#95;limits&lt;uint64&#95;t&gt;::max() / AllocaArraySize &gt;=</Highlight></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><Highlight kind="normal">                AllocaTypeSize.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()) &#123;</Highlight></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><Highlight kind="normal">          AllocaSize = ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(AI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()),</Highlight></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><Highlight kind="normal">                                        AllocaArraySize &#42; AllocaTypeSize);</Highlight></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><Highlight kind="normal">      builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3b352de43328e630253fada410d9bc83">CreateLifetimeStart</a>(AI, AllocaSize);</Highlight></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI : Returns) &#123;</Highlight></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Don&#39;t insert llvm.lifetime.end calls between a musttail or deoptimize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// call and a return.  The return kills all local allocas.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedMustTailCalls &amp;&amp;</Highlight></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><Highlight kind="normal">            RI-&gt;getParent()-&gt;getTerminatingMustTailCall())</Highlight></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedDeoptimizeCalls &amp;&amp;</Highlight></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><Highlight kind="normal">            RI-&gt;getParent()-&gt;getTerminatingDeoptimizeCall())</Highlight></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a>(RI).CreateLifetimeEnd(AI, AllocaSize);</Highlight></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the inlined code contained dynamic alloca instructions, wrap the inlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// code with llvm.stacksave/llvm.stackrestore intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a2eea9c7c9cadaa593a7a71c8d44aac25">ContainsDynamicAllocas</a>) &#123;</Highlight></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Insert the llvm.stacksave.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;SavedPtr = <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a>(&amp;&#42;FirstNewBlock, FirstNewBlock-&gt;begin())</Highlight></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><Highlight kind="normal">                             .CreateStackSave(</Highlight><Highlight kind="stringliteral">&quot;savedstack&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Insert a call to llvm.stackrestore before any return instructions in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI : Returns) &#123;</Highlight></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Don&#39;t insert llvm.stackrestore calls between a musttail or deoptimize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// call and a return.  The return will restore the stack pointer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedMustTailCalls &amp;&amp; RI-&gt;getParent()-&gt;getTerminatingMustTailCall())</Highlight></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedDeoptimizeCalls &amp;&amp; RI-&gt;getParent()-&gt;getTerminatingDeoptimizeCall())</Highlight></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder&lt;&gt;</a>(RI).CreateStackRestore(SavedPtr);</Highlight></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we are inlining for an invoke instruction, we must make sure to rewrite</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any call instructions into invoke instructions.  This is sensitive to which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// funclet pads were top-level in the inlinee, so must be done before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// rewriting the &quot;parent pad&quot; links.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(&amp;CB)) &#123;</Highlight></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnwindDest = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest();</Highlight></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> FirstNonPHI = UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</Highlight></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LandingPadInst&gt;</a>(FirstNonPHI)) &#123;</Highlight></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><Highlight kind="normal">      <a href="#a4cbd6aad6f6b93f79dc435feab77550e">HandleInlinedLandingPad</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, &amp;&#42;FirstNewBlock, InlinedFunctionInfo);</Highlight></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><Highlight kind="normal">      <a href="#aac69c9cf4e552a52d5065e94dc023f82">HandleInlinedEHPad</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, &amp;&#42;FirstNewBlock, InlinedFunctionInfo);</Highlight></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the lexical scopes of the new funclets and callsites.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Anything that had &#39;none&#39; as its parent is now nested inside the callsite&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// EHPad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallSiteEHPad) &#123;</Highlight></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function/#a19595c245bd2e3eefa93ce22db5ad15f">Function::iterator</a> BB = FirstNewBlock-&gt;getIterator(),</Highlight></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><Highlight kind="normal">                            E = Caller-&gt;end();</Highlight></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><Highlight kind="normal">         BB != E; ++BB) &#123;</Highlight></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add bundle operands to inlined call sites.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><Highlight kind="normal">      <a href="#af939eab05ffe67221645aab1342156b2">PropagateOperandBundles</a>(BB, CallSiteEHPad);</Highlight></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It is problematic if the inlinee has a cleanupret which unwinds to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// caller and we inline it into a call site which doesn&#39;t unwind but into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// an EH pad that does.  Such an edge must be dynamically unreachable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// As such, we replace the cleanupret with unreachable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CleanupRet = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupReturnInst&gt;</a>(BB-&gt;getTerminator()))</Highlight></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CleanupRet-&gt;unwindsToCaller() &amp;&amp; EHPadForCallUnwindsLocally)</Highlight></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a97370114df349e0996f133e3402c1595">changeToUnreachable</a>(CleanupRet);</Highlight></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;getFirstNonPHIIt();</Highlight></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CatchSwitch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchSwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantTokenNone&gt;</a>(CatchSwitch-&gt;getParentPad()))</Highlight></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><Highlight kind="normal">          CatchSwitch-&gt;setParentPad(CallSiteEHPad);</Highlight></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FPI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FuncletPadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantTokenNone&gt;</a>(FPI-&gt;getParentPad()))</Highlight></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><Highlight kind="normal">          FPI-&gt;setParentPad(CallSiteEHPad);</Highlight></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedDeoptimizeCalls) &#123;</Highlight></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We need to at least remove the deoptimizing returns from the Return set,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// so that the control flow from those returns does not get merged into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// caller (but terminate it instead).  If the caller&#39;s return type does not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// match the callee&#39;s return type, we also need to change the return type of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Caller-&gt;getReturnType() == CB.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</Highlight></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(Returns, &#91;&#93;(<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI) &#123;</Highlight></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getTerminatingDeoptimizeCall() != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ReturnInst &#42;, 8&gt;</a> NormalReturns;</Highlight></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;NewDeoptIntrinsic = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(</Highlight></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><Highlight kind="normal">          Caller-&gt;getParent(), Intrinsic::experimental&#95;deoptimize,</Highlight></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><Highlight kind="normal">          &#123;Caller-&gt;getReturnType()&#125;);</Highlight></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI : Returns) &#123;</Highlight></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;DeoptCall = RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getTerminatingDeoptimizeCall();</Highlight></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DeoptCall) &#123;</Highlight></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><Highlight kind="normal">          NormalReturns.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(RI);</Highlight></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The calling convention on the deoptimize call itself may be bogus,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// since the code we&#39;re inlining may have undefined behavior (and may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// never actually execute at runtime); but all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// @llvm.experimental.deoptimize declarations have to have the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// calling convention in a well-formed module.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv">CallingConv</a> = DeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a5f494edc0a569c7fc9ff4181243be1ed">getCallingConv</a>();</Highlight></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><Highlight kind="normal">        NewDeoptIntrinsic-&gt;<a href="/docs/api/classes/llvm/function/#ae6db8746934e6feae3649a8709fce3cc">setCallingConv</a>(<a href="/docs/api/namespaces/llvm/callingconv">CallingConv</a>);</Highlight></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CurBB = RI-&gt;getParent();</Highlight></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><Highlight kind="normal">        RI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> CallArgs(DeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>());</Highlight></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</Highlight></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><Highlight kind="normal">        DeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a19263fff7f5b3a9d22b48151fa0d85d0">getOperandBundlesAsDefs</a>(OpBundles);</Highlight></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DeoptAttributes = DeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>();</Highlight></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><Highlight kind="normal">        DeoptCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OpBundles.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Expected at least the deopt operand bundle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CurBB);</Highlight></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewDeoptCall =</Highlight></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><Highlight kind="normal">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(NewDeoptIntrinsic, CallArgs, OpBundles);</Highlight></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><Highlight kind="normal">        NewDeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(<a href="/docs/api/namespaces/llvm/callingconv">CallingConv</a>);</Highlight></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><Highlight kind="normal">        NewDeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(DeoptAttributes);</Highlight></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewDeoptCall-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>())</Highlight></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><Highlight kind="normal">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</Highlight></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><Highlight kind="normal">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5d0c52ee1cde6421f98c193e0e42b97d">CreateRet</a>(NewDeoptCall);</Highlight></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Since the ret type is changed, remove the incompatible attributes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><Highlight kind="normal">        NewDeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a2d9fe4a8103a58d5dee8ff09e6fa2152">removeRetAttrs</a>(AttributeFuncs::typeIncompatible(</Highlight></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><Highlight kind="normal">            NewDeoptCall-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), NewDeoptCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a82be2ba8b164fb0cf70e254f9c8a13a3">getRetAttributes</a>()));</Highlight></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Leave behind the normal returns so we can merge control flow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><Highlight kind="normal">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Returns, NormalReturns);</Highlight></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle any inlined musttail call sites.  In order for a new call site to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// musttail, the source of the clone and the inlined call site must have been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// musttail.  Therefore it&#39;s safe to return without merging control into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// phi below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedMustTailCalls) &#123;</Highlight></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if we need to bitcast the result of any musttail calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewRetTy = Caller-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedBitCast = !CB.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp; CB.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != NewRetTy;</Highlight></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle the returns preceded by musttail calls separately.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ReturnInst &#42;, 8&gt;</a> NormalReturns;</Highlight></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI : Returns) &#123;</Highlight></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;ReturnedMustTail =</Highlight></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><Highlight kind="normal">          RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getTerminatingMustTailCall();</Highlight></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ReturnedMustTail) &#123;</Highlight></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><Highlight kind="normal">        NormalReturns.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(RI);</Highlight></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NeedBitCast)</Highlight></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Delete the old return and any preceding bitcast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurBB = RI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OldCast = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;BitCastInst&gt;</a>(RI-&gt;getReturnValue());</Highlight></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><Highlight kind="normal">      RI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldCast)</Highlight></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><Highlight kind="normal">        OldCast-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Insert a new bitcast and return with the right type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CurBB);</Highlight></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5d0c52ee1cde6421f98c193e0e42b97d">CreateRet</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(ReturnedMustTail, NewRetTy));</Highlight></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Leave behind the normal returns so we can merge control flow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Returns, NormalReturns);</Highlight></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that all of the transforms on the inlined code have taken place but</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// before we splice the inlined code into the CFG and lose track of which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// blocks were actually inlined, collect the call sites. We only do this if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// call graph updates weren&#39;t requested, as those provide value handle based</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// tracking of inlined call sites instead. Calls to intrinsics are not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// collected because they are not inlineable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedFunctionInfo.<a href="/docs/api/structs/llvm/clonedcodeinfo/#a6bbe5e652464ac9213907e3446874900">ContainsCalls</a>) &#123;</Highlight></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise just collect the raw call sites that were inlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;NewBB :</Highlight></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(FirstNewBlock-&gt;getIterator(), Caller-&gt;end()))</Highlight></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : NewBB)</Highlight></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!(CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><Highlight kind="normal">                CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a900a32da3983469187b1848189681705">isIntrinsic</a>()))</Highlight></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><Highlight kind="normal">            IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#afee77c39305987451e9495b749863d07">InlinedCallSites</a>.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CB);</Highlight></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we cloned in &#95;exactly one&#95; basic block, and if that block ends in a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// return instruction, we splice the body of the inlined callee directly into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the calling basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Returns.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 &amp;&amp; std::distance(FirstNewBlock, Caller-&gt;end()) == 1) &#123;</Highlight></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Move all of the instructions right before the call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><Highlight kind="normal">    OrigBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(CB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), &amp;&#42;FirstNewBlock, FirstNewBlock-&gt;begin(),</Highlight></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><Highlight kind="normal">                   FirstNewBlock-&gt;end());</Highlight></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove the cloned basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><Highlight kind="normal">    Caller-&gt;back().eraseFromParent();</Highlight></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the call site was an invoke instruction, add a branch to the normal</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// destination.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(&amp;CB)) &#123;</Highlight></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;NewBr = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getNormalDest(), CB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><Highlight kind="normal">      NewBr-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Returns&#91;0&#93;-&gt;<a href="/docs/api/files/lib/lib/codegen/machineinstrbundle-cpp/#af44c9b089359803924e0b92bea3b6d03">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the return instruction returned a value, replace uses of the call with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// uses of the returned value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;R = Returns&#91;0&#93;;</Highlight></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;CB == R-&gt;getReturnValue())</Highlight></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><Highlight kind="normal">        CB.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CB.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><Highlight kind="normal">        CB.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(R-&gt;getReturnValue());</Highlight></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Since we are now done with the Call/Invoke, we can delete it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><Highlight kind="normal">    CB.<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Since we are now done with the return instruction, delete it also.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><Highlight kind="normal">    Returns&#91;0&#93;-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MergeAttributes)</Highlight></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><Highlight kind="normal">      AttributeFuncs::mergeAttributesForInlining(&#42;Caller, &#42;CalledFunc);</Highlight></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We are now done with the inlining.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a364fcb5fb838e7ca83b9fc379bcb4a0a">InlineResult::success</a>();</Highlight></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, we have the normal case, of more than one block to inline or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// multiple return sites.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We want to clone the entire callee function into the hole between the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &quot;starter&quot; and &quot;ender&quot; blocks.  How we accomplish this depends on whether</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this is an invoke instruction or a call instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;AfterCallBB;</Highlight></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;CreatedBranchToNormalDest = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(&amp;CB)) &#123;</Highlight></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add an unconditional branch to make this look like the CallInst case...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><Highlight kind="normal">    CreatedBranchToNormalDest = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getNormalDest(), CB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Split the basic block.  This guarantees that no PHI nodes will have to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// updated due to new incoming edges, and make the invoke case more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// symmetric to the call case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><Highlight kind="normal">    AfterCallBB =</Highlight></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><Highlight kind="normal">        OrigBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CreatedBranchToNormalDest-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(),</Highlight></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><Highlight kind="normal">                                CalledFunc-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.exit&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123; </Highlight><Highlight kind="comment">// It&#39;s a call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is a call instruction, we need to split the basic block that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the call lives in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><Highlight kind="normal">    AfterCallBB = OrigBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(),</Highlight></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><Highlight kind="normal">                                          CalledFunc-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.exit&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#ad01658587132e4b44ba8414b3a87fde5">CallerBFI</a>) &#123;</Highlight></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Copy original BB&#39;s block frequency to AfterCallBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><Highlight kind="normal">    IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#ad01658587132e4b44ba8414b3a87fde5">CallerBFI</a>-&gt;<a href="/docs/api/classes/llvm/blockfrequencyinfo/#a13f090421b36f5795113215ab6c507ce">setBlockFreq</a>(AfterCallBB,</Highlight></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><Highlight kind="normal">                                IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#ad01658587132e4b44ba8414b3a87fde5">CallerBFI</a>-&gt;<a href="/docs/api/classes/llvm/blockfrequencyinfo/#ab8b72c18add22acd827f7a6cd1ff1bff">getBlockFreq</a>(OrigBB));</Highlight></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Change the branch that used to go to AfterCallBB to branch to the first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// basic block of the inlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Br = OrigBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Br &amp;&amp; Br-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Br &amp;&amp;</Highlight></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;splitBasicBlock broken!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><Highlight kind="normal">  Br-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, &amp;&#42;FirstNewBlock);</Highlight></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that the function is correct, make it a little bit nicer.  In</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// particular, move the basic blocks inserted from the end of the function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into the space made by splitting the source basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><Highlight kind="normal">  Caller-&gt;splice(AfterCallBB-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), Caller, FirstNewBlock,</Highlight></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><Highlight kind="normal">                 Caller-&gt;end());</Highlight></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle all of the return instructions that we just cloned in, and eliminate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any users of the original call/invoke instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RTy = CalledFunc-&gt;<a href="/docs/api/classes/llvm/function/#acdd05db170cbfee8a0fcbc047b8504e5">getReturnType</a>();</Highlight></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Returns.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The PHI node should go at the front of the new basic block to merge all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// possible incoming values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(RTy, Returns.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(), CB.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</Highlight></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;insertBefore(AfterCallBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Anything that used the result of the function call should now use the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// PHI node as their operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><Highlight kind="normal">      CB.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</Highlight></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Loop over all of the return instructions adding entries to the PHI node</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as appropriate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>) &#123;</Highlight></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI : Returns) &#123;</Highlight></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI-&gt;getReturnValue()-&gt;getType() == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getType() &amp;&amp;</Highlight></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Ret value not consistent in function!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(RI-&gt;getReturnValue(), RI-&gt;getParent());</Highlight></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add a branch to the merge points and remove return instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a>;</Highlight></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI : Returns) &#123;</Highlight></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(AfterCallBB, RI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/loc">Loc</a> = RI-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><Highlight kind="normal">      BI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>);</Highlight></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><Highlight kind="normal">      RI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We need to set the debug location to &#42;somewhere&#42; inside the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlined function. The line number may be nonsensical, but the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction will at least be associated with the right</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CreatedBranchToNormalDest)</Highlight></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><Highlight kind="normal">      CreatedBranchToNormalDest-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>);</Highlight></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Returns.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, if there is exactly one return value, just replace anything</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// using the return value of the call with the computed value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;CB == Returns&#91;0&#93;-&gt;getReturnValue())</Highlight></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><Highlight kind="normal">        CB.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CB.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><Highlight kind="normal">        CB.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Returns&#91;0&#93;-&gt;getReturnValue());</Highlight></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update PHI nodes that use the ReturnBB to use the AfterCallBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ReturnBB = Returns&#91;0&#93;-&gt;getParent();</Highlight></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><Highlight kind="normal">    ReturnBB-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(AfterCallBB);</Highlight></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Splice the code from the return block into the block that it will return</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to, which contains the code that was after the call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><Highlight kind="normal">    AfterCallBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(AfterCallBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), ReturnBB);</Highlight></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CreatedBranchToNormalDest)</Highlight></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><Highlight kind="normal">      CreatedBranchToNormalDest-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Returns&#91;0&#93;-&gt;<a href="/docs/api/files/lib/lib/codegen/machineinstrbundle-cpp/#af44c9b089359803924e0b92bea3b6d03">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Delete the return instruction now and empty ReturnBB now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><Highlight kind="normal">    Returns&#91;0&#93;-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><Highlight kind="normal">    ReturnBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// No returns, but something is using the return value of the call.  Just</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// nuke the result.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><Highlight kind="normal">    CB.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CB.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</Highlight></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since we are now done with the Call/Invoke, we can delete it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><Highlight kind="normal">  CB.<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we inlined any musttail calls and the original return is now</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unreachable, delete it.  It can only contain a bitcast and ret.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InlinedMustTailCalls &amp;&amp; <a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(AfterCallBB))</Highlight></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><Highlight kind="normal">    AfterCallBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We should always be able to fold the entry block of the function into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// single predecessor of the block...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Br)-&gt;isUnconditional() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;splitBasicBlock broken!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CalleeEntry = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Br)-&gt;getSuccessor(0);</Highlight></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Splice the code entry block into calling block, right before the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unconditional branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><Highlight kind="normal">  CalleeEntry-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(OrigBB);  </Highlight><Highlight kind="comment">// Update PHI nodes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><Highlight kind="normal">  OrigBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(Br-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), CalleeEntry);</Highlight></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove the unconditional branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><Highlight kind="normal">  Br-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now we can remove the CalleeEntry block, which is now empty.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><Highlight kind="normal">  CalleeEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we inserted a phi node, check to see if it has a single value (e.g. all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the entries are the same or undef).  If so, remove the PHI so it doesn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block other optimizations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>) &#123;</Highlight></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC =</Highlight></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><Highlight kind="normal">        IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a> ? &amp;IFI.<a href="/docs/api/classes/llvm/inlinefunctioninfo/#a6d3c3f9f13bd38d8aa6410841d2b99c0">GetAssumptionCache</a>(&#42;Caller) : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Caller-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, &#123;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, AC&#125;)) &#123;</Highlight></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;replaceAllUsesWith(V);</Highlight></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MergeAttributes)</Highlight></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><Highlight kind="normal">    AttributeFuncs::mergeAttributesForInlining(&#42;Caller, &#42;CalledFunc);</Highlight></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inlineresult/#a364fcb5fb838e7ca83b9fc379bcb4a0a">InlineResult::success</a>();</Highlight></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
