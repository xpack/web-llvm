---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `CoroFrame.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="CoroInternal.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/corointernal-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ScopeExit.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/scopeexit-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallString.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallstring-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/StackLifetime.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/stacklifetime-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/OptimizedStructLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/optimizedstructlayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Coroutines/ABI.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/abi-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Coroutines/CoroInstr.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/coroinstr-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Coroutines/MaterializationUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/materializationutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Coroutines/SpillUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/spillutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Coroutines/SuspendCrossingInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/suspendcrossinginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/PromoteMemToReg.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/promotememtoreg-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-coroframe-cpp-">anonymous&#123;CoroFrame.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo">FrameDataInfo</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder">FrameTypeBuilder</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/frametypebuilder/field">Field</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a86c6fee36a1f17461710c01e694ee8df">buildFrameDebugInfo</a> (Function &amp;F, coro::Shape &amp;Shape, FrameDataInfo &amp;FrameData)</>}>
Build artificial debug info for C++ coroutine frames to allow users to inspect the contents of the frame directly. <a href="#a86c6fee36a1f17461710c01e694ee8df">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;</>}
  name={<><a href="#a712c7e27f92253c99bcc20689a4e93b0">buildFrameType</a> (Function &amp;F, coro::Shape &amp;Shape, FrameDataInfo &amp;FrameData, bool OptimizeFrame)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a44d73f71509ec34798d5810859701347">cacheDIVar</a> (FrameDataInfo &amp;FrameData, DenseMap&lt; Value &#42;, DILocalVariable &#42; &gt; &amp;DIVarCache)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a03cdd58b24dc91b4e3819e218a399cbf">cleanupSinglePredPHIs</a> (Function &amp;F)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a49cc8ffa2bb7e7ced148a4acb2d9ea87">dumpAllocas</a> (const SmallVectorImpl&lt; coro::AllocaInfo &gt; &amp;Allocas)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a6f0999556f0dc8e0fb4ccec5b3e121a1">dumpSpills</a> (StringRef Title, const coro::SpillInfo &amp;Spills)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a311a80924f5342813ae67daa5e5ff444">eliminateSwiftError</a> (Function &amp;F, coro::Shape &amp;Shape)</>}>
Eliminate all problematic uses of swifterror arguments and allocas from the function. <a href="#a311a80924f5342813ae67daa5e5ff444">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a55af5cce8eb7833907578e6fc3f0ab5e">eliminateSwiftErrorAlloca</a> (Function &amp;F, AllocaInst &#42;Alloca, coro::Shape &amp;Shape)</>}>
Eliminate a formerly-swifterror alloca by inserting the get/set intrinsics and attempting to MemToReg the alloca away. <a href="#a55af5cce8eb7833907578e6fc3f0ab5e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8356860a8bef082ff15df896ecec7732">eliminateSwiftErrorArgument</a> (Function &amp;F, Argument &amp;Arg, coro::Shape &amp;Shape, SmallVectorImpl&lt; AllocaInst &#42; &gt; &amp;AllocasToPromote)</>}>
&quot;Eliminate&quot; a swifterror argument by reducing it to the alloca case and then loading and storing in the prologue and epilog. <a href="#a8356860a8bef082ff15df896ecec7732">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ad7795d2b31b375031144ce50d0f6fa34">emitGetSwiftErrorValue</a> (IRBuilder&lt;&gt; &amp;Builder, Type &#42;ValueTy, coro::Shape &amp;Shape)</>}>
Get the current swifterror value. <a href="#ad7795d2b31b375031144ce50d0f6fa34">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a43a2acbd71eac7be9bdd1094a21bd6ab">emitSetAndGetSwiftErrorValueAround</a> (Instruction &#42;Call, AllocaInst &#42;Alloca, coro::Shape &amp;Shape)</>}>
Set the swifterror value from the given alloca before a call, then put in back in the alloca afterwards. <a href="#a43a2acbd71eac7be9bdd1094a21bd6ab">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a3d306b9a19fc37d00329692ef499b1b1">emitSetSwiftErrorValue</a> (IRBuilder&lt;&gt; &amp;Builder, Value &#42;V, coro::Shape &amp;Shape)</>}>
Set the given value as the current swifterror value. <a href="#a3d306b9a19fc37d00329692ef499b1b1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af0885df5b78cc732639a9d52a87d040e">insertSpills</a> (const FrameDataInfo &amp;FrameData, coro::Shape &amp;Shape)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a47b0e7da15eccab3545643118aa2f99f">localAllocaNeedsStackSave</a> (CoroAllocaAllocInst &#42;AI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a36b39e8a1384a23b9899d2c9e2e08e72">lowerLocalAllocas</a> (ArrayRef&lt; CoroAllocaAllocInst &#42; &gt; LocalAllocas, SmallVectorImpl&lt; Instruction &#42; &gt; &amp;DeadInsts)</>}>
Turn each of the given local allocas into a normal (dynamic) alloca instruction. <a href="#a36b39e8a1384a23b9899d2c9e2e08e72">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a642ec4238f02650fc1e70d5b4ac8d844">movePHIValuesToInsertedBlock</a> (BasicBlock &#42;SuccBB, BasicBlock &#42;InsertedBB, BasicBlock &#42;PredBB, PHINode &#42;UntilPHI=nullptr)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5a93b5fcf433128b2fd9d563792eb4cd">rewritePHIs</a> (BasicBlock &amp;BB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a0647ca6021ca57224016effde79d4d7e">rewritePHIs</a> (Function &amp;F)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab9fcdedd3580f924cf782f155b549a22">rewritePHIsForCleanupPad</a> (BasicBlock &#42;CleanupPadBB, CleanupPadInst &#42;CleanupPad)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; std::pair&lt; <a href="/docs/api/classes/llvm/value">Value</a> &amp;, <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &amp; &gt; &gt;</>}
  name={<><a href="#a22d247369eb256f74de55d2260c3b82e">salvageDebugInfoImpl</a> (SmallDenseMap&lt; Argument &#42;, AllocaInst &#42;, 4 &gt; &amp;ArgToAllocaMap, bool UseEntryValue, Function &#42;F, Value &#42;Storage, DIExpression &#42;Expr, bool SkipOutermostLoad)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#abb3297c94836debc08248e7ae3f47582">sinkLifetimeStartMarkers</a> (Function &amp;F, coro::Shape &amp;Shape, SuspendCrossingInfo &amp;Checker, const DominatorTree &amp;DT)</>}>
For each local variable that all of its user are only used inside one of suspended region, we sink their lifetime.start markers to the place where after the suspend block. <a href="#abb3297c94836debc08248e7ae3f47582">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/ditype">DIType</a> &#42;</>}
  name={<><a href="#a70c89294063fc90c89bb113d2af8c7c5">solveDIType</a> (DIBuilder &amp;Builder, Type &#42;Ty, const DataLayout &amp;Layout, DIScope &#42;Scope, unsigned LineNum, DenseMap&lt; Type &#42;, DIType &#42; &gt; &amp;DITypeCache)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/stringref">StringRef</a></>}
  name={<><a href="#acdaf5010e3f77d9d6e8ae04f5e0248e8">solveTypeName</a> (Type &#42;Ty)</>}>
Create name for <a href="/docs/api/classes/llvm/type">Type</a>. <a href="#acdaf5010e3f77d9d6e8ae04f5e0248e8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a54c76b23c53f62a58c09936547b2842d">splitAround</a> (Instruction &#42;I, const Twine &amp;Name)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</>}
  name={<><a href="#a973240859e7ff5af51dad8426b400053">splitBlockIfNotFirst</a> (Instruction &#42;I, const Twine &amp;Name)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a711449044c2aef3a8aba56149e421b60">willLeaveFunctionImmediatelyAfter</a> (BasicBlock &#42;BB, unsigned depth=3)</>}>
After we split the coroutine, will the given basic block be along an obvious exit path for the resumption function? <a href="#a711449044c2aef3a8aba56149e421b60">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/arm/armloadstoreoptimizer-cpp/#ab3bfc7321acfbc3619170d5bed907cb3">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aecfc696c759c52249220099347df84da">UseNewDbgInfoFormat</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;coro-frame&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### buildFrameDebugInfo() {#a86c6fee36a1f17461710c01e694ee8df}

<MemberDefinition
  prototype={<>static void buildFrameDebugInfo (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape, FrameDataInfo &amp; FrameData)</>}
  labels = {["static"]}>
Build artificial debug info for C++ coroutine frames to allow users to inspect the contents of the frame directly.

Create Debug information for coroutine frame with debug name &quot;&#95;&#95;coro&#95;frame&quot;. The debug information for the fields of coroutine frame is constructed from the following way:
<ul>
<li>For all the value in the Frame, we search the use of dbg.declare to find the corresponding debug variables for the value. If we can find the debug variable, we can get full and accurate debug information.</li>
<li>If we can&#39;t get debug information in step 1 and 2, we could only try to build the <a href="/docs/api/classes/llvm/ditype">DIType</a> by <a href="/docs/api/classes/llvm/type">Type</a>. We did this in solveDIType. We only handle integer, float, double, integer type and struct type for now.</li>
</ul>

Definition at line <a href="#l00689">689</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### buildFrameType() {#a712c7e27f92253c99bcc20689a4e93b0}

<MemberDefinition
  prototype={<>static StructType &#42; buildFrameType (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape, FrameDataInfo &amp; FrameData, bool OptimizeFrame)</>}
  labels = {["static"]}>

Definition at line <a href="#l00865">865</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### cacheDIVar() {#a44d73f71509ec34798d5810859701347}

<MemberDefinition
  prototype={<>static void cacheDIVar (FrameDataInfo &amp; FrameData, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/dilocalvariable">DILocalVariable</a> &#42; &gt; &amp; DIVarCache)</>}
  labels = {["static"]}>

Definition at line <a href="#l00544">544</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### cleanupSinglePredPHIs() {#a03cdd58b24dc91b4e3819e218a399cbf}

<MemberDefinition
  prototype={<>static void cleanupSinglePredPHIs (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F)</>}
  labels = {["static"]}>

Definition at line <a href="#l01410">1410</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### dumpAllocas() {#a49cc8ffa2bb7e7ced148a4acb2d9ea87}

<MemberDefinition
  prototype={<>static void dumpAllocas (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/structs/llvm/coro/allocainfo">coro::AllocaInfo</a> &gt; &amp; Allocas)</>}
  labels = {["static"]}>

Definition at line <a href="#l00150">150</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### dumpSpills() {#a6f0999556f0dc8e0fb4ccec5b3e121a1}

<MemberDefinition
  prototype={<>static void dumpSpills (<a href="/docs/api/classes/llvm/stringref">StringRef</a> Title, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/namespaces/llvm/coro/#a35a3966816510601e97cb071765f1ed0">coro::SpillInfo</a> &amp; Spills)</>}
  labels = {["static"]}>

Definition at line <a href="#l00140">140</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### eliminateSwiftError() {#a311a80924f5342813ae67daa5e5ff444}

<MemberDefinition
  prototype={<>static void eliminateSwiftError (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape)</>}
  labels = {["static"]}>
Eliminate all problematic uses of swifterror arguments and allocas from the function.

We&#39;ll fix them up later when splitting the function.

Definition at line <a href="#l01740">1740</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### eliminateSwiftErrorAlloca() {#a55af5cce8eb7833907578e6fc3f0ab5e}

<MemberDefinition
  prototype={<>static void eliminateSwiftErrorAlloca (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; Alloca, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape)</>}
  labels = {["static"]}>
Eliminate a formerly-swifterror alloca by inserting the get/set intrinsics and attempting to MemToReg the alloca away.

Definition at line <a href="#l01676">1676</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### eliminateSwiftErrorArgument() {#a8356860a8bef082ff15df896ecec7732}

<MemberDefinition
  prototype={<>static void eliminateSwiftErrorArgument (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/argument">Argument</a> &amp; Arg, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; &gt; &amp; AllocasToPromote)</>}
  labels = {["static"]}>
&quot;Eliminate&quot; a swifterror argument by reducing it to the alloca case and then loading and storing in the prologue and epilog.

The argument keeps the swifterror flag.

Definition at line <a href="#l01702">1702</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### emitGetSwiftErrorValue() {#ad7795d2b31b375031144ce50d0f6fa34}

<MemberDefinition
  prototype={<>static Value &#42; emitGetSwiftErrorValue (<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/classes/llvm/type">Type</a> &#42; ValueTy, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape)</>}
  labels = {["static"]}>
Get the current swifterror value.

Definition at line <a href="#l01613">1613</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### emitSetAndGetSwiftErrorValueAround() {#a43a2acbd71eac7be9bdd1094a21bd6ab}

<MemberDefinition
  prototype={<>static Value &#42; emitSetAndGetSwiftErrorValueAround (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Call, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; Alloca, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape)</>}
  labels = {["static"]}>
Set the swifterror value from the given alloca before a call, then put in back in the alloca afterwards.

Returns an address that will stand in for the swifterror slot until splitting.

Definition at line <a href="#l01646">1646</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### emitSetSwiftErrorValue() {#a3d306b9a19fc37d00329692ef499b1b1}

<MemberDefinition
  prototype={<>static Value &#42; emitSetSwiftErrorValue (<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape)</>}
  labels = {["static"]}>
Set the given value as the current swifterror value.

Returns a slot that can be used as a swifterror slot.

Definition at line <a href="#l01628">1628</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### insertSpills() {#af0885df5b78cc732639a9d52a87d040e}

<MemberDefinition
  prototype={<>static void insertSpills (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> FrameDataInfo &amp; FrameData, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape)</>}
  labels = {["static"]}>

Definition at line <a href="#l01004">1004</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### localAllocaNeedsStackSave() {#a47b0e7da15eccab3545643118aa2f99f}

<MemberDefinition
  prototype={<>static bool localAllocaNeedsStackSave (<a href="/docs/api/classes/llvm/coroallocaallocinst">CoroAllocaAllocInst</a> &#42; AI)</>}
  labels = {["static"]}>

Definition at line <a href="#l01557">1557</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### lowerLocalAllocas() {#a36b39e8a1384a23b9899d2c9e2e08e72}

<MemberDefinition
  prototype={<>static void lowerLocalAllocas (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/coroallocaallocinst">CoroAllocaAllocInst</a> &#42; &gt; LocalAllocas, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; DeadInsts)</>}
  labels = {["static"]}>
Turn each of the given local allocas into a normal (dynamic) alloca instruction.

Definition at line <a href="#l01575">1575</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### movePHIValuesToInsertedBlock() {#a642ec4238f02650fc1e70d5b4ac8d844}

<MemberDefinition
  prototype={<>static void movePHIValuesToInsertedBlock (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; SuccBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; InsertedBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PredBB, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; UntilPHI=nullptr)</>}
  labels = {["static"]}>

Definition at line <a href="#l01317">1317</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### rewritePHIs() {#a5a93b5fcf433128b2fd9d563792eb4cd}

<MemberDefinition
  prototype={<>static void rewritePHIs (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; BB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01427">1427</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### rewritePHIs() {#a0647ca6021ca57224016effde79d4d7e}

<MemberDefinition
  prototype={<>static void rewritePHIs (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F)</>}
  labels = {["static"]}>

Definition at line <a href="#l01503">1503</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### rewritePHIsForCleanupPad() {#ab9fcdedd3580f924cf782f155b549a22}

<MemberDefinition
  prototype={<>static void rewritePHIsForCleanupPad (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; CleanupPadBB, <a href="/docs/api/classes/llvm/cleanuppadinst">CleanupPadInst</a> &#42; CleanupPad)</>}
  labels = {["static"]}>

Definition at line <a href="#l01335">1335</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### salvageDebugInfoImpl() {#a22d247369eb256f74de55d2260c3b82e}

<MemberDefinition
  prototype={<>static std::optional&lt; std::pair&lt; Value &amp;, DIExpression &amp; &gt; &gt; salvageDebugInfoImpl (<a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;, 4 &gt; &amp; ArgToAllocaMap, bool UseEntryValue, <a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Storage, <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42; Expr, bool SkipOutermostLoad)</>}
  labels = {["static"]}>

Definition at line <a href="#l01855">1855</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### sinkLifetimeStartMarkers() {#abb3297c94836debc08248e7ae3f47582}

<MemberDefinition
  prototype={<>static void sinkLifetimeStartMarkers (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp; Shape, <a href="/docs/api/classes/llvm/suspendcrossinginfo">SuspendCrossingInfo</a> &amp; Checker, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT)</>}
  labels = {["static"]}>
For each local variable that all of its user are only used inside one of suspended region, we sink their lifetime.start markers to the place where after the suspend block.

Doing so minimizes the lifetime of each variable, hence minimizing the amount of data we end up putting on the frame.

Definition at line <a href="#l01775">1775</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### solveDIType() {#a70c89294063fc90c89bb113d2af8c7c5}

<MemberDefinition
  prototype={<>static DIType &#42; solveDIType (<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp; Builder, <a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; Layout, <a href="/docs/api/classes/llvm/discope">DIScope</a> &#42; Scope, unsigned LineNum, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/type">Type</a> &#42;, <a href="/docs/api/classes/llvm/ditype">DIType</a> &#42; &gt; &amp; DITypeCache)</>}
  labels = {["static"]}>

Definition at line <a href="#l00602">602</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### solveTypeName() {#acdaf5010e3f77d9d6e8ae04f5e0248e8}

<MemberDefinition
  prototype={<>static StringRef solveTypeName (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty)</>}
  labels = {["static"]}>
Create name for <a href="/docs/api/classes/llvm/type">Type</a>.

It uses <a href="/docs/api/classes/llvm/mdstring">MDString</a> to store new created string to avoid memory leak.

Definition at line <a href="#l00564">564</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### splitAround() {#a54c76b23c53f62a58c09936547b2842d}

<MemberDefinition
  prototype={<>static void splitAround (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name)</>}
  labels = {["static"]}>

Definition at line <a href="#l01530">1530</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### splitBlockIfNotFirst() {#a973240859e7ff5af51dad8426b400053}

<MemberDefinition
  prototype={<>static BasicBlock &#42; splitBlockIfNotFirst (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name)</>}
  labels = {["static"]}>

Definition at line <a href="#l01517">1517</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

### willLeaveFunctionImmediatelyAfter() {#a711449044c2aef3a8aba56149e421b60}

<MemberDefinition
  prototype={<>static bool willLeaveFunctionImmediatelyAfter (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, unsigned depth=3)</>}
  labels = {["static"]}>
After we split the coroutine, will the given basic block be along an obvious exit path for the resumption function?

Definition at line <a href="#l01537">1537</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### UseNewDbgInfoFormat {#aecfc696c759c52249220099347df84da}

<MemberDefinition
  prototype={<>cl::opt&lt;bool&gt; UseNewDbgInfoFormat</>}>

Definition at line <a href="#l00044">44</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;coro-frame&quot;</>}>

Definition at line <a href="#l00046">46</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/coroframe-cpp">CoroFrame.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- CoroFrame.cpp - Builds and manipulates coroutine frame -------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">// This file contains classes used to discover if for a particular value</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// its definition precedes and its uses follow a suspend block. This is</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// referred to as a suspend crossing value.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// Using the information discovered we form a Coroutine Frame structure to</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// contain those values. All uses of those values are replaced with appropriate</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// GEP + load from the coroutine frame. At the point of the definition we spill</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// the value into the coroutine frame.</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/coroutines/corointernal-h">CoroInternal.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/scopeexit-h">llvm/ADT/ScopeExit.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallstring-h">llvm/ADT/SmallString.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/stacklifetime-h">llvm/Analysis/StackLifetime.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h">llvm/IR/InstIterator.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/optimizedstructlayout-h">llvm/Support/OptimizedStructLayout.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/abi-h">llvm/Transforms/Coroutines/ABI.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/coroinstr-h">llvm/Transforms/Coroutines/CoroInstr.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/materializationutils-h">llvm/Transforms/Coroutines/MaterializationUtils.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/spillutils-h">llvm/Transforms/Coroutines/SpillUtils.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/coroutines/suspendcrossinginfo-h">llvm/Transforms/Coroutines/SuspendCrossingInfo.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/promotememtoreg-h">llvm/Transforms/Utils/PromoteMemToReg.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightKeyword">extern</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanagerimpl-h/#a926189935285d6e5df83fc0f45bf9b36">UseNewDbgInfoFormat</a>;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;coro-frame&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48" lineLink="/docs/api/namespaces/anonymous-coroframe-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder">FrameTypeBuilder</a>;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightComment">// Mapping from the to-be-spilled value to all the users that need reload.</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#acceb42f33891bf127aaae587a26eb71e">FrameDataInfo</a> &#123;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All the values (that are not allocas) that needs to be spilled to the</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// frame.</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abaca6c0f1c7ce1f6a79386226a6613a3"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#a35a3966816510601e97cb071765f1ed0">coro::SpillInfo</a> &amp;<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abaca6c0f1c7ce1f6a79386226a6613a3">Spills</a>;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allocas contains all values defined as allocas that need to live in the</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// frame.</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a94c2e55a117d5897cdd1d86b72724012"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;coro::AllocaInfo&gt;</a> &amp;<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a94c2e55a117d5897cdd1d86b72724012">Allocas</a>;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#acceb42f33891bf127aaae587a26eb71e"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#acceb42f33891bf127aaae587a26eb71e">FrameDataInfo</a>(<a href="/docs/api/namespaces/llvm/coro/#a35a3966816510601e97cb071765f1ed0">coro::SpillInfo</a> &amp;<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abaca6c0f1c7ce1f6a79386226a6613a3">Spills</a>,</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;coro::AllocaInfo&gt;</a> &amp;<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a94c2e55a117d5897cdd1d86b72724012">Allocas</a>)</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abaca6c0f1c7ce1f6a79386226a6613a3">Spills</a>(<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abaca6c0f1c7ce1f6a79386226a6613a3">Spills</a>), <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a94c2e55a117d5897cdd1d86b72724012">Allocas</a>(<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a94c2e55a117d5897cdd1d86b72724012">Allocas</a>) &#123;&#125;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ae62c7a803203f703a46e17ee5b06ae9c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 8&gt;</a> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ae62c7a803203f703a46e17ee5b06ae9c">getAllDefs</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 8&gt;</a> Defs;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abaca6c0f1c7ce1f6a79386226a6613a3">Spills</a>)</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlight">      Defs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.first);</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a94c2e55a117d5897cdd1d86b72724012">Allocas</a>)</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">      Defs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca);</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Defs;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#af1727117c5fdf988ef6cfe27acf6859c"><span class="doxyHighlight">  uint32&#95;t <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#af1727117c5fdf988ef6cfe27acf6859c">getFieldIndex</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Itr = FieldIndexMap.find(V);</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Itr != FieldIndexMap.end() &amp;&amp;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Value does not have a frame field index&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Itr-&gt;second;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ac2937b7791f257beb78531d2e649e126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ac2937b7791f257beb78531d2e649e126">setFieldIndex</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, uint32&#95;t Index) &#123;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((LayoutIndexUpdateStarted || FieldIndexMap.count(V) == 0) &amp;&amp;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot set the index for the same field twice.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">    FieldIndexMap&#91;V&#93; = Index;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a6d5a306cc04cbe2844707a7b386bb77e"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a6d5a306cc04cbe2844707a7b386bb77e">getAlign</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = FieldAlignMap.find(V);</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Iter != FieldAlignMap.end());</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Iter-&gt;second;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#af34a80a6554a169439534a4a4290cc41"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#af34a80a6554a169439534a4a4290cc41">setAlign</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/structs/llvm/align">Align</a> AL) &#123;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FieldAlignMap.count(V) == 0);</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">    FieldAlignMap.insert(&#123;V, AL&#125;);</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abfb905f899498bc7097f6162632be548"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abfb905f899498bc7097f6162632be548">getDynamicAlign</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = FieldDynamicAlignMap.find(V);</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Iter != FieldDynamicAlignMap.end());</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Iter-&gt;second;</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#aa031fdec2a6cce7ffe189451cf4b96e5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#aa031fdec2a6cce7ffe189451cf4b96e5">setDynamicAlign</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, uint64&#95;t <a href="/docs/api/structs/llvm/align">Align</a>) &#123;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FieldDynamicAlignMap.count(V) == 0);</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">    FieldDynamicAlignMap.insert(&#123;V, <a href="/docs/api/structs/llvm/align">Align</a>&#125;);</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ad69e14b76926f53e4688a3e6d1f6c42a"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ad69e14b76926f53e4688a3e6d1f6c42a">getOffset</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = FieldOffsetMap.find(V);</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Iter != FieldOffsetMap.end());</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Iter-&gt;second;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ab24d722fd350117391a3ca11c422e0dc"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ab24d722fd350117391a3ca11c422e0dc">setOffset</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &#123;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FieldOffsetMap.count(V) == 0);</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">    FieldOffsetMap.insert(&#123;V, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>&#125;);</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remap the index of every field in the frame, using the final layout index.</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> updateLayoutIndex(<a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder">FrameTypeBuilder</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LayoutIndexUpdateStarted is used to avoid updating the index of any field</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// twice by mistake.</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LayoutIndexUpdateStarted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Map from values to their slot indexes on the frame. They will be first set</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with their original insertion field index. After the frame is built, their</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// indexes will be updated into the final layout index.</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, uint32&#95;t&gt;</a> FieldIndexMap;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Map from values to their alignment on the frame. They would be set after</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the frame is built.</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Align&gt;</a> FieldAlignMap;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, uint64&#95;t&gt;</a> FieldDynamicAlignMap;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Map from values to their offset on the frame. They would be set after</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the frame is built.</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, uint64&#95;t&gt;</a> FieldOffsetMap;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140" lineLink="#a6f0999556f0dc8e0fb4ccec5b3e121a1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a6f0999556f0dc8e0fb4ccec5b3e121a1">dumpSpills</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Title, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a35a3966816510601e97cb071765f1ed0">coro::SpillInfo</a> &amp;Spills) &#123;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;------------- &quot;</span><span class="doxyHighlight"> &lt;&lt; Title &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; --------------\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : Spills) &#123;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first-&gt;dump();</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;   user: &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.second)</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dump();</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150" lineLink="#a49cc8ffa2bb7e7ced148a4acb2d9ea87"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a49cc8ffa2bb7e7ced148a4acb2d9ea87">dumpAllocas</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;coro::AllocaInfo&gt;</a> &amp;Allocas) &#123;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;------------- Allocas --------------\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : Allocas) &#123;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca-&gt;dump();</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159" lineLink="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> = size&#95;t;</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlightComment">// We cannot rely solely on natural alignment of a type when building a</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightComment">// coroutine frame and if the alignment specified on the Alloca instruction</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightComment">// differs from the natural alignment of the alloca type we will need to insert</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightComment">// padding.</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a092114fb63cfb76b89bd59081681814b">FrameTypeBuilder</a> &#123;</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">Field &#123;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> LayoutFieldIndex;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> Alignment;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> TyAlignment;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">    uint64&#95;t DynamicAlignBuffer;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Context;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">  uint64&#95;t StructSize = 0;</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> StructAlign;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFinished = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">  std::optional&lt;Align&gt; MaxFrameAlignment;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Field, 8&gt;</a> Fields;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value&#42;, unsigned&gt;</a> FieldIndexByKey;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a092114fb63cfb76b89bd59081681814b"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a092114fb63cfb76b89bd59081681814b">FrameTypeBuilder</a>(<a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Context, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL,</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">                   std::optional&lt;Align&gt; MaxFrameAlignment)</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">      : DL(DL), Context(Context), MaxFrameAlignment(MaxFrameAlignment) &#123;&#125;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlightComment">  /// Add a field to this structure for the storage of an &#96;alloca&#96;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlightComment">  /// instruction.</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a0644a32bfd97560ac89c5d6e9b0bf7ac"><span class="doxyHighlight">  &#91;&#91;nodiscard&#93;&#93; <a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a0644a32bfd97560ac89c5d6e9b0bf7ac">addFieldForAlloca</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI,</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">                                              </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsHeader = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>();</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make an array type if this is a static array allocation.</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#aea74164514e7164813ab30bcc4b7c557">isArrayAllocation</a>()) &#123;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#af4283a4cef4e2b88f565d827d5857e14">getArraySize</a>()))</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">        Ty = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Ty, CI-&gt;getValue().getZExtValue());</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Coroutines cannot handle non static allocas yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a5c96118e25d97e97ae778fb8084e4154">addField</a>(Ty, AI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), IsHeader);</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlightComment">  /// We want to put the allocas whose lifetime-ranges are not overlapped</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlightComment">  /// into one slot of coroutine frame.</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlightComment">  /// Consider the example at:https://bugs.llvm.org/show&#95;bug.cgi?id=45566</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlightComment">  ///     cppcoro::task&lt;void&gt; alternative&#95;paths(bool cond) &#123;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlightComment">  ///         if (cond) &#123;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlightComment">  ///             big&#95;structure a;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlightComment">  ///             process(a);</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlightComment">  ///             co&#95;await something();</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlightComment">  ///         &#125; else &#123;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlightComment">  ///             big&#95;structure b;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlightComment">  ///             process2(b);</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlightComment">  ///             co&#95;await something();</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlightComment">  ///         &#125;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlightComment">  ///     &#125;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlightComment">  /// We want to put variable a and variable b in the same slot to</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlightComment">  /// reduce the size of coroutine frame.</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlightComment">  /// This function use StackLifetime algorithm to partition the AllocaInsts in</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlightComment">  /// Spills to non-overlapped sets in order to put Alloca in the same</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlightComment">  /// non-overlapped set into the same slot in the Coroutine Frame. Then add</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlightComment">  /// field for the allocas in the same non-overlapped set by using the largest</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlightComment">  /// type as the field type.</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlightComment">  /// Side Effects: Because We sort the allocas, the order of allocas in the</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlightComment">  /// frame may be different with the order in the source code.</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> addFieldForAllocas(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo">FrameDataInfo</a> &amp;FrameData,</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">                          <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimizeFrame);</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlightComment">  /// Add a field to this structure.</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a5c96118e25d97e97ae778fb8084e4154"><span class="doxyHighlight">  &#91;&#91;nodiscard&#93;&#93; <a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a5c96118e25d97e97ae778fb8084e4154">addField</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> MaybeFieldAlignment,</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsHeader = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSpillOfValue = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!IsFinished &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;adding fields to a finished builder&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;must provide a type for a field&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The field size is always the alloc size of the type.</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    uint64&#95;t FieldSize = DL.getTypeAllocSize(Ty);</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For an alloca with size=0, we don&#39;t need to add a field and they</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// can just point to any index in the frame. Use index 0</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FieldSize == 0) &#123;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The field alignment might not be the type alignment, but we need</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to remember the type alignment anyway to build the type.</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are spilling values we don&#39;t need to worry about ABI alignment</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// concerns.</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> ABIAlign = DL.getABITypeAlign(Ty);</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> TyAlignment = ABIAlign;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSpillOfValue &amp;&amp; MaxFrameAlignment &amp;&amp; &#42;MaxFrameAlignment &lt; ABIAlign)</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">      TyAlignment = &#42;MaxFrameAlignment;</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> FieldAlignment = MaybeFieldAlignment.value&#95;or(TyAlignment);</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The field alignment could be bigger than the max frame case, in that case</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we request additional storage to be able to dynamically align the</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointer.</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">    uint64&#95;t DynamicAlignBuffer = 0;</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxFrameAlignment &amp;&amp; (FieldAlignment &gt; &#42;MaxFrameAlignment)) &#123;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">      DynamicAlignBuffer =</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a99cdcecbadc13087f087c61809bb44f1">offsetToAlignment</a>(MaxFrameAlignment-&gt;value(), FieldAlignment);</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">      FieldAlignment = &#42;MaxFrameAlignment;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">      FieldSize = FieldSize + DynamicAlignBuffer;</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Lay out header fields immediately.</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">    uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsHeader) &#123;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(StructSize, FieldAlignment);</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">      StructSize = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + FieldSize;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Everything else has a flexible offset.</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/structs/llvm/optimizedstructlayoutfield/#afd2b6f2791d97f9d64eb5ad7972cd28b">OptimizedStructLayoutField::FlexibleOffset</a>;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    Fields.push&#95;back(&#123;FieldSize, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, Ty, 0, FieldAlignment, TyAlignment,</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">                      DynamicAlignBuffer&#125;);</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Fields.size() - 1;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlightComment">  /// Finish the layout and create the struct type with the given name.</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;finish(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Name);</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#ad6161377f5a2114ed00d462f609aeeca"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#ad6161377f5a2114ed00d462f609aeeca">getStructSize</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsFinished &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;not yet finished!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> StructSize;</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a3db2416990d9de790ecc02fc6370941a"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/align">Align</a> <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a3db2416990d9de790ecc02fc6370941a">getStructAlign</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsFinished &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;not yet finished!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> StructAlign;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a51952520c42ce359fa2835786a5de411"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a51952520c42ce359fa2835786a5de411">getLayoutFieldIndex</a>(<a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> Id)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsFinished &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;not yet finished!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Fields&#91;Id&#93;.LayoutFieldIndex;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#aae731f5966fd5aaaa3fd5960eebeba7c"><span class="doxyHighlight">  Field <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#aae731f5966fd5aaaa3fd5960eebeba7c">getLayoutField</a>(<a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> Id)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsFinished &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;not yet finished!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Fields&#91;Id&#93;;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317" lineLink="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a12fe9348a418f996ac8531fbff60f70c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a12fe9348a418f996ac8531fbff60f70c">FrameDataInfo::updateLayoutIndex</a>(<a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder">FrameTypeBuilder</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Updater = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getLayoutField(<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#af1727117c5fdf988ef6cfe27acf6859c">getFieldIndex</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ac2937b7791f257beb78531d2e649e126">setFieldIndex</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>.LayoutFieldIndex);</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#af34a80a6554a169439534a4a4290cc41">setAlign</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>.Alignment);</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">    uint64&#95;t dynamicAlign =</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>.DynamicAlignBuffer</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">            ? <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>.DynamicAlignBuffer + <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>.Alignment.value()</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">            : 0;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#aa031fdec2a6cce7ffe189451cf4b96e5">setDynamicAlign</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, dynamicAlign);</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#ab24d722fd350117391a3ca11c422e0dc">setOffset</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/optimizedstructlayout-cpp/#a5208f2b0568d811c542f8d8097dbc035">Field</a>.Offset);</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  LayoutIndexUpdateStarted = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;S : <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#abaca6c0f1c7ce1f6a79386226a6613a3">Spills</a>)</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">    Updater(S.first);</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#a94c2e55a117d5897cdd1d86b72724012">Allocas</a>)</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">    Updater(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca);</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  LayoutIndexUpdateStarted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a0ee1f18526ee78ef18612b6a86dc16fc"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a0ee1f18526ee78ef18612b6a86dc16fc">FrameTypeBuilder::addFieldForAllocas</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">                                          <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo">FrameDataInfo</a> &amp;FrameData,</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">                                          <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape,</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimizeFrame) &#123;</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">AllocaSetType = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AllocaInst &#42;, 4&gt;</a>;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AllocaSetType, 4&gt;</a> NonOverlapedAllocas;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to add field for allocas at the end of this function.</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AddFieldForAllocasAtExit = <a href="/docs/api/namespaces/llvm/#a1af45c4dc83c083c5ae914d96fd3ce96">make&#95;scope&#95;exit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AllocaList : NonOverlapedAllocas) &#123;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LargestAI = &#42;AllocaList.begin();</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> Id = <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a0644a32bfd97560ac89c5d6e9b0bf7ac">addFieldForAlloca</a>(LargestAI);</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Alloca : AllocaList)</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">        FrameData.setFieldIndex(Alloca, Id);</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OptimizeFrame) &#123;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : FrameData.Allocas) &#123;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">      NonOverlapedAllocas.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(AllocaSetType(1, Alloca));</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Because there are paths from the lifetime.start to coro.end</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for each alloca, the liferanges for every alloca is overlaped</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the blocks who contain coro.end and the successor blocks.</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// So we choose to skip there blocks when we calculate the liferange</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for each alloca. It should be reasonable since there shouldn&#39;t be uses</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in these blocks and the coroutine frame shouldn&#39;t be used outside the</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// coroutine body.</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that the user of coro.suspend may not be SwitchInst. However, this</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case seems too complex to handle. And it is harmless to skip these</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// patterns since it just prevend putting the allocas to live in the same</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// slot.</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SwitchInst &#42;, BasicBlock &#42;&gt;</a> DefaultSuspendDest;</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/corosuspendinst">CoroSuspendInst</a> : Shape.<a href="/docs/api/structs/llvm/coro/shape/#a5fd0aa934908c837c6d78097a2fd667b">CoroSuspends</a>) &#123;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : <a href="/docs/api/classes/llvm/corosuspendinst">CoroSuspendInst</a>-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ConstSWI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SWI = </span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(ConstSWI);</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">        DefaultSuspendDest&#91;SWI&#93; = SWI-&gt;getDefaultDest();</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">        SWI-&gt;setDefaultDest(SWI-&gt;getSuccessor(1));</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ExtractAllocas = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">    AllocaSetType Allocas;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">    Allocas.reserve(FrameData.Allocas.size());</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : FrameData.Allocas)</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">      Allocas.push&#95;back(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca);</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Allocas;</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stacklifetime">StackLifetime</a> StackLifetimeAnalyzer(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ExtractAllocas(),</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/stacklifetime/#aff0f7b0e4c6e234e72e9569968bdcaffa195fbb57ffe7449796d23466085ce6d8">StackLifetime::LivenessType::May</a>);</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">  StackLifetimeAnalyzer.<a href="/docs/api/classes/llvm/stacklifetime/#a25fa11bd51d7c0fde33cc3534f68abda">run</a>();</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DoAllocasInterfere = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI1, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI2) &#123;</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> StackLifetimeAnalyzer.<a href="/docs/api/classes/llvm/stacklifetime/#ad5ea64f921940edb72d8186f097d549b">getLiveRange</a>(AI1).<a href="/docs/api/classes/llvm/stacklifetime/liverange/#a1cb60057327e8ffe8b5dd9a82aa92464">overlaps</a>(</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">        StackLifetimeAnalyzer.<a href="/docs/api/classes/llvm/stacklifetime/#ad5ea64f921940edb72d8186f097d549b">getLiveRange</a>(AI2));</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetAllocaSize = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/coro/allocainfo">coro::AllocaInfo</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &#123;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    std::optional&lt;TypeSize&gt; RetSize = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca-&gt;getAllocationSize(DL);</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RetSize &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Variable Length Arrays (VLA) are not supported.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!RetSize-&gt;isScalable() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Scalable vectors are not yet supported&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RetSize-&gt;getFixedValue();</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Put larger allocas in the front. So the larger allocas have higher</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// priority to merge, which can save more space potentially. Also each</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// AllocaSet would be ordered. So we can get the largest Alloca in one</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// AllocaSet easily.</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(FrameData.Allocas, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Iter1, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Iter2) &#123;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    return GetAllocaSize(Iter1) &gt; GetAllocaSize(Iter2);</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : FrameData.Allocas) &#123;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Merged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to find if the Alloca does not interfere with any existing</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NonOverlappedAllocaSet. If it is true, insert the alloca to that</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NonOverlappedAllocaSet.</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;AllocaSet : NonOverlapedAllocas) &#123;</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!AllocaSet.empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Processing Alloca Set is not empty.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NoInterference = <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(AllocaSet, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter) &#123;</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DoAllocasInterfere(Alloca, Iter);</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the alignment of A is multiple of the alignment of B, the address</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of A should satisfy the requirement for aligning for B.</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// There may be other more fine-grained strategies to handle the alignment</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// infomation during the merging process. But it seems hard to handle</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// these strategies and benefit little.</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Alignable = &#91;&amp;&#93;() -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LargestAlloca = &#42;AllocaSet.begin();</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LargestAlloca-&gt;getAlign().value() % Alloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>().<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>() ==</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">               0;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">      &#125;();</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CouldMerge = NoInterference &amp;&amp; Alignable;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CouldMerge)</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">      AllocaSet.push&#95;back(Alloca);</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      Merged = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Merged) &#123;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">      NonOverlapedAllocas.emplace&#95;back(AllocaSetType(1, Alloca));</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Recover the default target destination for each Switch statement</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reserved.</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SwitchAndDefaultDest : DefaultSuspendDest) &#123;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;SWI = SwitchAndDefaultDest.first;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = SwitchAndDefaultDest.second;</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">    SWI-&gt;<a href="/docs/api/classes/llvm/switchinst/#aa22bdae1cee3c836f2b4cf8307fc7598">setDefaultDest</a>(DestBB);</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This Debug Info could tell us which allocas are merged into one slot.</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;AllocaSet</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">                  : NonOverlapedAllocas) &#123;</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllocaSet.size() &gt; 1) &#123;</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;In Function:&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Find Union Set &quot;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\tAllocas are \\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Alloca : AllocaSet)</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\t\\t&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Alloca &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466" lineLink="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#abe0dacfb2237ff8fb43d5ad22ac45d5f"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;<a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#abe0dacfb2237ff8fb43d5ad22ac45d5f">FrameTypeBuilder::finish</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Name) &#123;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!IsFinished &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;already finished!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Prepare the optimal-layout field array.</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The Id in the layout field is a pointer to our Field for it.</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OptimizedStructLayoutField, 8&gt;</a> LayoutFields;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  LayoutFields.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(Fields.size());</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Field : Fields) &#123;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">    LayoutFields.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(&amp;Field, Field.Size, Field.Alignment,</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">                              Field.Offset);</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Perform layout.</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SizeAndAlign = <a href="/docs/api/namespaces/llvm/#aae35ec9b920ff3bb892cd872877a89fe">performOptimizedStructLayout</a>(LayoutFields);</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  StructSize = SizeAndAlign.first;</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  StructAlign = SizeAndAlign.second;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> getField = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/optimizedstructlayoutfield">OptimizedStructLayoutField</a> &amp;LayoutField) -&gt; Field &amp; &#123;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">Field &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">&#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(LayoutField.Id));</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to produce a packed struct type if there&#39;s a field whose</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assigned offset isn&#39;t a multiple of its natural type alignment.</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Packed = &#91;&amp;&#93; &#123;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LayoutField : LayoutFields) &#123;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = getField(LayoutField);</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a25f1d7ccf87af8d87fcb950f7ed758b5">isAligned</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.TyAlignment, LayoutField.Offset))</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">  &#125;();</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build the struct body.</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type&#42;, 16&gt;</a> FieldTypes;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  FieldTypes.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(LayoutFields.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &#42; 3 / 2);</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  uint64&#95;t LastOffset = 0;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LayoutField : LayoutFields) &#123;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = getField(LayoutField);</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = LayoutField.Offset;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add a padding field if there&#39;s a padding gap and we&#39;re either</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// building a packed struct or the padding gap is more than we&#39;d</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// get from aligning to the field type&#39;s natural alignment.</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &gt;= LastOffset);</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != LastOffset) &#123;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Packed || <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(LastOffset, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.TyAlignment) != <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">        FieldTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/classes/llvm/type/#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(Context),</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">                                            <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> - LastOffset));</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.Offset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.LayoutFieldIndex = FieldTypes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">    FieldTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.Ty);</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.DynamicAlignBuffer) &#123;</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">      FieldTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/classes/llvm/type/#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(Context), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.DynamicAlignBuffer));</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">    LastOffset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.Size;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;Ty = <a href="/docs/api/classes/llvm/structtype/#a82648246c07eb8a33f628eea28cb988c">StructType::create</a>(Context, FieldTypes, Name, Packed);</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that the IR layout matches the offsets we expect.</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Layout = DL.getStructLayout(Ty);</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : Fields) &#123;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;getElementType(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.LayoutFieldIndex) == <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.Ty);</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Layout-&gt;getElementOffset(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.LayoutFieldIndex) == <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.Offset);</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  IsFinished = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Ty;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544" lineLink="#a44d73f71509ec34798d5810859701347"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a44d73f71509ec34798d5810859701347">cacheDIVar</a>(<a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#acceb42f33891bf127aaae587a26eb71e">FrameDataInfo</a> &amp;FrameData,</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, DILocalVariable &#42;&gt;</a> &amp;DIVarCache) &#123;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : FrameData.getAllDefs()) &#123;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DIVarCache.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(V))</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CacheIt = &#91;&amp;DIVarCache, V&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Container) &#123;</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">llvm::find&#95;if</a>(Container, &#91;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DDI) &#123;</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DDI-&gt;getExpression()-&gt;getNumElements() == 0;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Container.end())</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">        DIVarCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;V, (&#42;I)-&gt;getVariable()&#125;);</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">    CacheIt(<a href="/docs/api/namespaces/llvm/#a19d345e6fa45d60ff4092769417b89b2">findDbgDeclares</a>(V));</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">    CacheIt(<a href="/docs/api/namespaces/llvm/#ac9c256eafdc8fb849f7320bc37120a5c">findDVRDeclares</a>(V));</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlightComment">/// Create name for Type. It uses MDString to store new created string to</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlightComment">/// avoid memory leak.</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564" lineLink="#acdaf5010e3f77d9d6e8ae04f5e0248e8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="#acdaf5010e3f77d9d6e8ae04f5e0248e8">solveTypeName</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isIntegerTy()) &#123;</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The longest name in common may be &#39;&#95;&#95;int&#95;128&#39;, which has 9 bits.</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;16&gt;</a> Buffer;</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-svector-ostream">raw&#95;svector&#95;ostream</a> OS(Buffer);</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">    OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;int&#95;&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(Ty)-&gt;getBitWidth();</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MDName = <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ty-&gt;getContext(), OS.<a href="/docs/api/classes/llvm/raw-svector-ostream/#a9c2cac84e46d3e744aeca03dd3d557d1">str</a>());</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MDName-&gt;getString();</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isFloatingPointTy()) &#123;</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isFloatTy())</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;float&#95;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isDoubleTy())</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;double&#95;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;floating&#95;type&#95;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isPointerTy())</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;PointerType&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isStructTy()) &#123;</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StructType&gt;</a>(Ty)-&gt;hasName())</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;LiteralStructType&#95;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Name = Ty-&gt;getStructName();</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;16&gt;</a> Buffer(Name);</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Iter : Buffer)</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Iter == </span><span class="doxyHighlightCharLiteral">&#39;.&#39;</span><span class="doxyHighlight"> || Iter == </span><span class="doxyHighlightCharLiteral">&#39;:&#39;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">        Iter = </span><span class="doxyHighlightCharLiteral">&#39;&#95;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MDName = <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ty-&gt;getContext(), Buffer.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>());</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MDName-&gt;getString();</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;UnknownType&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602" lineLink="#a70c89294063fc90c89bb113d2af8c7c5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/ditype">DIType</a> &#42;<a href="#a70c89294063fc90c89bb113d2af8c7c5">solveDIType</a>(<a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> &amp;Builder, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty,</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;Layout, <a href="/docs/api/classes/llvm/discope">DIScope</a> &#42;Scope,</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LineNum,</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Type &#42;, DIType &#42;&gt;</a> &amp;DITypeCache) &#123;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/ditype">DIType</a> &#42;DT = DITypeCache.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(Ty))</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DT;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = <a href="#acdaf5010e3f77d9d6e8ae04f5e0248e8">solveTypeName</a>(Ty);</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/ditype">DIType</a> &#42;RetType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isIntegerTy()) &#123;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(Ty)-&gt;getBitWidth();</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">    RetType = Builder.<a href="/docs/api/classes/llvm/dibuilder/#aa7a54c168f44523926f5bcf1f69e3cb4">createBasicType</a>(Name, <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, dwarf::DW&#95;ATE&#95;signed,</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">                                      llvm::DINode::FlagArtificial);</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isFloatingPointTy()) &#123;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">    RetType = Builder.<a href="/docs/api/classes/llvm/dibuilder/#aa7a54c168f44523926f5bcf1f69e3cb4">createBasicType</a>(Name, Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(Ty),</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">                                      dwarf::DW&#95;ATE&#95;float,</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">                                      llvm::DINode::FlagArtificial);</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isPointerTy()) &#123;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Construct PointerType points to null (aka void &#42;) instead of exploring</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointee type to avoid infinite search problem. For example, we would be</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in trouble if we traverse recursively:</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  struct Node &#123;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//      Node&#42; ptr;</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  &#125;;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">    RetType =</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/dibuilder/#a8f163bf8a14c1c7823f6d8fce7fb5ac7">createPointerType</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(Ty),</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">                                  Layout.<a href="/docs/api/classes/llvm/datalayout/#a800e74bec9b78d6739665027c3616a55">getABITypeAlign</a>(Ty).<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>() &#42; CHAR&#95;BIT,</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">                                  </span><span class="doxyHighlightComment">/&#42;DWARFAddressSpace=&#42;/</span><span class="doxyHighlight">std::nullopt, Name);</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isStructTy()) &#123;</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DIStruct = Builder.<a href="/docs/api/classes/llvm/dibuilder/#afe762b489a1c62e1d3baf58b330e6652">createStructType</a>(</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">        Scope, Name, Scope-&gt;getFile(), LineNum, Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(Ty),</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">        Layout.<a href="/docs/api/classes/llvm/datalayout/#af9185c7e96873c6d2c13e1f1b6322cf6">getPrefTypeAlign</a>(Ty).<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>() &#42; CHAR&#95;BIT,</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">        llvm::DINode::FlagArtificial, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, llvm::DINodeArray());</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StructTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StructType&gt;</a>(Ty);</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 16&gt;</a> Elements;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; StructTy-&gt;getNumElements(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/ditype">DIType</a> &#42;DITy = <a href="#a70c89294063fc90c89bb113d2af8c7c5">solveDIType</a>(Builder, StructTy-&gt;getElementType(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Layout,</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">                                 Scope, LineNum, DITypeCache);</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DITy);</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">      Elements.push&#95;back(Builder.<a href="/docs/api/classes/llvm/dibuilder/#adbf77460ca5103d4d0b2708b013a1b88">createMemberType</a>(</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">          Scope, DITy-&gt;<a href="/docs/api/classes/llvm/ditype/#a777848a3e8c10c10721c852d4efb9e3b">getName</a>(), Scope-&gt;getFile(), LineNum,</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">          DITy-&gt;<a href="/docs/api/classes/llvm/ditype/#a8b53bdd5b8f1d8cd12a392c256cb54f3">getSizeInBits</a>(), DITy-&gt;<a href="/docs/api/classes/llvm/ditype/#aafecafc5b47638df4c3080736b1c3934">getAlignInBits</a>(),</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">          Layout.<a href="/docs/api/classes/llvm/datalayout/#a61135fb8666f0b7a37b4e1bbcf1db131">getStructLayout</a>(StructTy)-&gt;<a href="/docs/api/classes/llvm/structlayout/#aa8344d578094fea8b187e046d07d7455">getElementOffsetInBits</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">          llvm::DINode::FlagArtificial, DITy));</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/dibuilder/#afee05194feacd4f95209e840e7242332">replaceArrays</a>(DIStruct, Builder.<a href="/docs/api/classes/llvm/dibuilder/#ac22bd3a0571eb4e961def1c480247296">getOrCreateArray</a>(Elements));</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">    RetType = DIStruct;</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Unresolved Type: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Ty &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/typesize">TypeSize</a> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(Ty);</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CharSizeType = Builder.<a href="/docs/api/classes/llvm/dibuilder/#aa7a54c168f44523926f5bcf1f69e3cb4">createBasicType</a>(</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">        Name, 8, dwarf::DW&#95;ATE&#95;unsigned&#95;char, llvm::DINode::FlagArtificial);</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt;= 8)</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">      RetType = CharSizeType;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> % 8 != 0)</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/classes/llvm/typesize/#a003b4369b4130e669dc9139798e0193c">TypeSize::getFixed</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> + 8 - (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> % 8));</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">      RetType = Builder.<a href="/docs/api/classes/llvm/dibuilder/#ab6cf034bd9dd454892e193bc3340998b">createArrayType</a>(</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, Layout.<a href="/docs/api/classes/llvm/datalayout/#af9185c7e96873c6d2c13e1f1b6322cf6">getPrefTypeAlign</a>(Ty).<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>(), CharSizeType,</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/dibuilder/#ac22bd3a0571eb4e961def1c480247296">getOrCreateArray</a>(Builder.<a href="/docs/api/classes/llvm/dibuilder/#aaec462f93a64e27fa16d1416b1dbbb8b">getOrCreateSubrange</a>(0, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> / 8)));</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">  DITypeCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;Ty, RetType&#125;);</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RetType;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlightComment">/// Build artificial debug info for C++ coroutine frames to allow users to</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlightComment">/// inspect the contents of the frame directly</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlightComment">/// Create Debug information for coroutine frame with debug name &quot;&#95;&#95;coro&#95;frame&quot;.</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlightComment">/// The debug information for the fields of coroutine frame is constructed from</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlightComment">/// the following way:</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlightComment">/// 1 For all the value in the Frame, we search the use of dbg.declare to find</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlightComment">///    the corresponding debug variables for the value. If we can find the</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlightComment">///    debug variable, we can get full and accurate debug information.</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlightComment">/// 2 If we can&#39;t get debug information in step 1 and 2, we could only try to</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlightComment">///    build the DIType by Type. We did this in solveDIType. We only handle</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlightComment">///    integer, float, double, integer type and struct type for now.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689" lineLink="#a86c6fee36a1f17461710c01e694ee8df"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a86c6fee36a1f17461710c01e694ee8df">buildFrameDebugInfo</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape,</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">                                <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#acceb42f33891bf127aaae587a26eb71e">FrameDataInfo</a> &amp;FrameData) &#123;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;DIS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getSubprogram();</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is no DISubprogram for F, it implies the Function are not compiled</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with debug info. So we also don&#39;t need to generate debug info for the frame</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// neither.</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DIS || !DIS-&gt;getUnit() ||</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/dwarf/#aaedb78de657237c48255243a68e1dbc1">dwarf::isCPlusPlus</a>(</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">          (<a href="/docs/api/namespaces/llvm/dwarf/#a78f32f1cfba451a8c3691f00768da230">dwarf::SourceLanguage</a>)DIS-&gt;getUnit()-&gt;getSourceLanguage()) ||</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">      DIS-&gt;getUnit()-&gt;getEmissionKind() != <a href="/docs/api/classes/llvm/dicompileunit/#abbc2b566b9aa870d5b7131017b7ba66daa44087d1fe20ab5e128a0f592b6a85c1">DICompileUnit::DebugEmissionKind::FullDebug</a>)</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">coro::ABI::Switch</a> &amp;&amp;</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;We could only build debug infomation for C++ coroutine now.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> DBuilder(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent(), </span><span class="doxyHighlightComment">/&#42;AllowUnresolved&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#aab0e2582dd592f549f16c9a26b9d5f42">getPromiseAlloca</a>() &amp;&amp;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Coroutine with switch ABI should own Promise alloca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/difile">DIFile</a> &#42;DFile = DIS-&gt;<a href="/docs/api/classes/llvm/discope/#a693505a142c46203bb19ff1f09b5ea22">getFile</a>();</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LineNum = DIS-&gt;getLine();</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dicompositetype">DICompositeType</a> &#42;FrameDITy = DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#afe762b489a1c62e1d3baf58b330e6652">createStructType</a>(</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">      DIS-&gt;getUnit(), <a href="/docs/api/classes/llvm/twine">Twine</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() + </span><span class="doxyHighlightStringLiteral">&quot;.coro&#95;frame&#95;ty&quot;</span><span class="doxyHighlight">).<a href="/docs/api/classes/llvm/twine/#a4c1c1093a7749409c70838678514cc7c">str</a>(),</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">      DFile, LineNum, Shape.<a href="/docs/api/structs/llvm/coro/shape/#a742806b2e667a87817ae171e1ec59826">FrameSize</a> &#42; 8,</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">      Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0a1a8e48ba1e5d845e979d5da8de597d">FrameAlign</a>.<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>() &#42; 8, llvm::DINode::FlagArtificial, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">      llvm::DINodeArray());</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;FrameTy = Shape.<a href="/docs/api/structs/llvm/coro/shape/#a24c5fed9b14aed8a3b4f3828472fbab5">FrameTy</a>;</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 16&gt;</a> Elements;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> Layout = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, DILocalVariable &#42;&gt;</a> DIVarCache;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">  <a href="#a44d73f71509ec34798d5810859701347">cacheDIVar</a>(FrameData, DIVarCache);</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ResumeIndex = <a href="/docs/api/structs/llvm/coro/shape/switchfieldindex/#aef925686aca6c6970964fea2c25bf242a012dd1dc85c718e8159980fa4273d9e6">coro::Shape::SwitchFieldIndex::Resume</a>;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestroyIndex = <a href="/docs/api/structs/llvm/coro/shape/switchfieldindex/#aef925686aca6c6970964fea2c25bf242a0416e9f2fbff942bd66bfa6d7e759d47">coro::Shape::SwitchFieldIndex::Destroy</a>;</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IndexIndex = Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a1640d3af02b4a49eaa3422920056bb6d">IndexField</a>;</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, StringRef&gt;</a> NameCache;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">  NameCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;ResumeIndex, </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;resume&#95;fn&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">  NameCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;DestroyIndex, </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;destroy&#95;fn&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">  NameCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;IndexIndex, </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;coro&#95;index&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ResumeFnTy = FrameTy-&gt;<a href="/docs/api/classes/llvm/structtype/#aee3c78d73273cb8449cd10cc15edcb83">getElementType</a>(ResumeIndex),</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">       &#42;DestroyFnTy = FrameTy-&gt;<a href="/docs/api/classes/llvm/structtype/#aee3c78d73273cb8449cd10cc15edcb83">getElementType</a>(DestroyIndex),</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">       &#42;IndexTy = FrameTy-&gt;<a href="/docs/api/classes/llvm/structtype/#aee3c78d73273cb8449cd10cc15edcb83">getElementType</a>(IndexIndex);</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, DIType &#42;&gt;</a> TyCache;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  TyCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">      &#123;ResumeIndex, DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#a8f163bf8a14c1c7823f6d8fce7fb5ac7">createPointerType</a>(</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(ResumeFnTy))&#125;);</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  TyCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">      &#123;DestroyIndex, DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#a8f163bf8a14c1c7823f6d8fce7fb5ac7">createPointerType</a>(</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(DestroyFnTy))&#125;);</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlightComment">  /// FIXME: If we fill the field &#96;SizeInBits&#96; with the actual size of</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlightComment">  /// &#95;&#95;coro&#95;index in bits, then &#95;&#95;coro&#95;index wouldn&#39;t show in the debugger.</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  TyCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;IndexIndex, DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#aa7a54c168f44523926f5bcf1f69e3cb4">createBasicType</a>(</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;coro&#95;index&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">                                  (Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(IndexTy) &lt; 8)</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">                                      ? 8</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">                                      : Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(IndexTy),</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">                                  dwarf::DW&#95;ATE&#95;unsigned&#95;char)&#125;);</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : FrameData.getAllDefs()) &#123;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DIVarCache.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(V))</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Index = FrameData.getFieldIndex(V);</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">    NameCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;Index, DIVarCache&#91;V&#93;-&gt;getName()&#125;);</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    TyCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;Index, DIVarCache&#91;V&#93;-&gt;getType()&#125;);</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cache from index to (Align, Offset Pair)</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, std::pair&lt;unsigned, unsigned&gt;</a>&gt; OffsetCache;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The Align and Offset of Resume function and Destroy function are fixed.</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  OffsetCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;ResumeIndex, &#123;8, 0&#125;&#125;);</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">  OffsetCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;DestroyIndex, &#123;8, 8&#125;&#125;);</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">  OffsetCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">      &#123;IndexIndex,</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">       &#123;Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a9d132e5f83821984ce6d37cb38a99c24">IndexAlign</a>, Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a1d3459ac1d0c3c498b3a522fbdcb0e7b">IndexOffset</a>&#125;&#125;);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : FrameData.getAllDefs()) &#123;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Index = FrameData.getFieldIndex(V);</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">    OffsetCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">        &#123;Index, &#123;FrameData.getAlign(V).value(), FrameData.getOffset(V)&#125;&#125;);</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Type &#42;, DIType &#42;&gt;</a> DITypeCache;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This counter is used to avoid same type names. e.g., there would be</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// many i32 and i64 types in one coroutine. And we would use i32&#95;0 and</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// i32&#95;1 to avoid the same type. Since it makes no sense the name of the</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fields confilicts with each other.</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UnknownTypeNum = 0;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Index = 0; Index &lt; FrameTy-&gt;<a href="/docs/api/classes/llvm/structtype/#a858efd7b61654c0de28c56f9adafa13d">getNumElements</a>(); Index++) &#123;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OffsetCache.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(Index))</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    std::string Name;</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">    uint64&#95;t SizeInBits;</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    uint32&#95;t AlignInBits;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    uint64&#95;t OffsetInBits;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/ditype">DIType</a> &#42;DITy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = FrameTy-&gt;<a href="/docs/api/classes/llvm/structtype/#aee3c78d73273cb8449cd10cc15edcb83">getElementType</a>(Index);</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;isSized() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We can&#39;t handle type which is not sized.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">    SizeInBits = Layout.<a href="/docs/api/classes/llvm/datalayout/#acf0b1898efd7f81a078e9288befd9290">getTypeSizeInBits</a>(Ty).<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">    AlignInBits = OffsetCache&#91;Index&#93;.first &#42; 8;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    OffsetInBits = OffsetCache&#91;Index&#93;.second &#42; 8;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = NameCache.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Index); It != NameCache.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">      Name = It-&gt;second.str();</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      DITy = TyCache&#91;Index&#93;;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">      DITy = <a href="#a70c89294063fc90c89bb113d2af8c7c5">solveDIType</a>(DBuilder, Ty, Layout, FrameDITy, LineNum, DITypeCache);</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DITy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;SolveDIType shouldn&#39;t return nullptr.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">      Name = DITy-&gt;<a href="/docs/api/classes/llvm/ditype/#a777848a3e8c10c10721c852d4efb9e3b">getName</a>().<a href="/docs/api/classes/llvm/stringref/#a223dd14e7d12bc5cea01889b972a98b2">str</a>();</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">      Name += </span><span class="doxyHighlightStringLiteral">&quot;&#95;&quot;</span><span class="doxyHighlight"> + std::to&#95;string(UnknownTypeNum);</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">      UnknownTypeNum++;</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">    Elements.push&#95;back(DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#adbf77460ca5103d4d0b2708b013a1b88">createMemberType</a>(</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">        FrameDITy, Name, DFile, LineNum, SizeInBits, AlignInBits, OffsetInBits,</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">        llvm::DINode::FlagArtificial, DITy));</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">  DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#afee05194feacd4f95209e840e7242332">replaceArrays</a>(FrameDITy, DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#ac22bd3a0571eb4e961def1c480247296">getOrCreateArray</a>(Elements));</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FrameDIVar =</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">      DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#ae6081972b0560d0f16bd503654924b1b">createAutoVariable</a>(DIS, </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;coro&#95;frame&quot;</span><span class="doxyHighlight">, DFile, LineNum,</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">                                  FrameDITy, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, DINode::FlagArtificial);</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Subprogram would have ContainedNodes field which records the debug</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// variables it contained. So we need to add &#95;&#95;coro&#95;frame to the</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ContainedNodes of it.</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we don&#39;t add &#95;&#95;coro&#95;frame to the RetainedNodes, user may get</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;no symbol &#95;&#95;coro&#95;frame in context&#96; rather than &#96;&#95;&#95;coro&#95;frame&#96;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is optimized out, which is more precise.</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RetainedNodes = DIS-&gt;getRetainedNodes();</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 32&gt;</a> RetainedNodesVec(RetainedNodes.begin(),</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">                                               RetainedNodes.end());</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">  RetainedNodesVec.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FrameDIVar);</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">  DIS-&gt;<a href="/docs/api/classes/llvm/mdnode/#a160e9e1a4fd597f83034c8b2ba316984">replaceOperandWith</a>(7, (<a href="/docs/api/classes/llvm/mdtuple/#aad2e50b107c264353f4de80e03f9f754">MDTuple::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext(), RetainedNodesVec)));</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Construct the location for the frame debug variable. The column number</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is fake but it should be fine.</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;DILoc =</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(DIS-&gt;<a href="/docs/api/classes/llvm/mdnode/#ad2fecba192de6da1578bdcb78d524169">getContext</a>(), LineNum, </span><span class="doxyHighlightComment">/&#42;Column=&#42;/</span><span class="doxyHighlight">1, DIS);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FrameDIVar-&gt;isValidLocationForIntrinsic(DILoc));</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanagerimpl-h/#a926189935285d6e5df83fc0f45bf9b36">UseNewDbgInfoFormat</a>) &#123;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;NewDVR =</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a>(<a href="/docs/api/classes/llvm/valueasmetadata/#a53fc78b63202142110d0e86dd1a71fbe">ValueAsMetadata::get</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#a5eac2988672b484645dcbcd706430967">FramePtr</a>), FrameDIVar,</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">                              DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#ad1d53e81b2b3ddcc4518e816fc89711d">createExpression</a>(), DILoc,</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/dbgvariablerecord/#ae2c3391c27b9fa4f64f9ed1bdbbdea4ca2709046ed364cc54b91f908e85e512ed">DbgVariableRecord::LocationType::Declare</a>);</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = Shape.<a href="/docs/api/structs/llvm/coro/shape/#ac406c2b5a7e2d11174becab5cb27765d">getInsertPtAfterFramePtr</a>();</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">    It-&gt;getParent()-&gt;insertDbgRecordBefore(NewDVR, It);</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">    DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#a9019e662ee1c0c04e06e9871650268c8">insertDeclare</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#a5eac2988672b484645dcbcd706430967">FramePtr</a>, FrameDIVar,</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">                           DBuilder.<a href="/docs/api/classes/llvm/dibuilder/#ad1d53e81b2b3ddcc4518e816fc89711d">createExpression</a>(), DILoc,</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">                           Shape.<a href="/docs/api/structs/llvm/coro/shape/#ac406c2b5a7e2d11174becab5cb27765d">getInsertPtAfterFramePtr</a>());</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlightComment">// Build a struct that will keep state for an active coroutine.</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlightComment">//   struct f.frame &#123;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlightComment">//     ResumeFnTy ResumeFnAddr;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlightComment">//     ResumeFnTy DestroyFnAddr;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlightComment">//     ... promise (if present) ...</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlightComment">//     int ResumeIndex;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlightComment">//     ... spills ...</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlightComment">//   &#125;;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865" lineLink="#a712c7e27f92253c99bcc20689a4e93b0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;<a href="#a712c7e27f92253c99bcc20689a4e93b0">buildFrameType</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape,</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">                                  <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#acceb42f33891bf127aaae587a26eb71e">FrameDataInfo</a> &amp;FrameData,</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimizeFrame) &#123;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext();</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We will use this value to cap the alignment of spilled values.</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">  std::optional&lt;Align&gt; MaxFrameAlignment;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a24aa4117da86c41684ad25742832dfa6">coro::ABI::Async</a>)</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    MaxFrameAlignment = Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0cca043bc17f6f673acb6324db527dae">AsyncLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/asyncloweringstorage/#a12d93f5ae63381caf2a4ef0fdba3a668">getContextAlignment</a>();</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-coroframe-cpp-/frametypebuilder/#a092114fb63cfb76b89bd59081681814b">FrameTypeBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, MaxFrameAlignment);</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;PromiseAlloca = Shape.<a href="/docs/api/structs/llvm/coro/shape/#aab0e2582dd592f549f16c9a26b9d5f42">getPromiseAlloca</a>();</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">  std::optional&lt;FieldIDType&gt; SwitchIndexFieldId;</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">coro::ABI::Switch</a>) &#123;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FnPtrTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add header fields for the resume and destroy functions.</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can rely on these being perfectly packed.</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">    (void)<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.addField(FnPtrTy, std::nullopt, </span><span class="doxyHighlightComment">/&#42;header&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">    (void)<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.addField(FnPtrTy, std::nullopt, </span><span class="doxyHighlightComment">/&#42;header&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PromiseAlloca field needs to be explicitly added here because it&#39;s</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a header field with a fixed offset based on its alignment. Hence it</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// needs special handling and cannot be added to FrameData.Allocas.</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PromiseAlloca)</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">      FrameData.setFieldIndex(</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">          PromiseAlloca, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.addFieldForAlloca(PromiseAlloca, </span><span class="doxyHighlightComment">/&#42;header&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add a field to store the suspend index.  This doesn&#39;t need to</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be in the header.</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IndexBits = std::max(1U, <a href="/docs/api/namespaces/llvm/#a238ef12f09938dac4efe5ca56dc125d9">Log2&#95;64&#95;Ceil</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#a5fd0aa934908c837c6d78097a2fd667b">CoroSuspends</a>.size()));</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;IndexType = <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, IndexBits);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">    SwitchIndexFieldId = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.addField(IndexType, std::nullopt);</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromiseAlloca == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;lowering doesn&#39;t support promises&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Because multiple allocas may own the same field slot,</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we add allocas to field here.</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.addFieldForAllocas(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, FrameData, Shape, OptimizeFrame);</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add PromiseAlloca to Allocas list so that</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 updateLayoutIndex could update its index after</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;performOptimizedStructLayout&#96;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 it is processed in insertSpills.</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">coro::ABI::Switch</a> &amp;&amp; PromiseAlloca)</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We assume that the promise alloca won&#39;t be modified before</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// CoroBegin and no alias will be create before CoroBegin.</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">    FrameData.Allocas.emplace&#95;back(</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">        PromiseAlloca, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, std::optional&lt;APInt&gt;&gt;&#123;&#125;, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create an entry for every spilled value.</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;S : FrameData.Spills) &#123;</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;FieldType = S.first-&gt;getType();</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For byval arguments, we need to store the pointed value in the frame,</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instead of the pointer itself.</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(S.first))</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasByValAttr())</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">        FieldType = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getParamByValType();</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> Id = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.addField(FieldType, std::nullopt, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;header&#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;IsSpillOfValue&#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">    FrameData.setFieldIndex(S.first, Id);</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;FrameTy = &#91;&amp;&#93; &#123;</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;32&gt;</a> Name(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName());</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">    Name.append(</span><span class="doxyHighlightStringLiteral">&quot;.Frame&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.finish(Name);</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  &#125;();</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  FrameData.updateLayoutIndex(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0a1a8e48ba1e5d845e979d5da8de597d">FrameAlign</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getStructAlign();</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  Shape.<a href="/docs/api/structs/llvm/coro/shape/#a742806b2e667a87817ae171e1ec59826">FrameSize</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getStructSize();</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a>) &#123;</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">coro::ABI::Switch</a>: &#123;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In the switch ABI, remember the switch-index field.</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IndexField = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getLayoutField(&#42;SwitchIndexFieldId);</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">    Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a1640d3af02b4a49eaa3422920056bb6d">IndexField</a> = IndexField.LayoutFieldIndex;</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a9d132e5f83821984ce6d37cb38a99c24">IndexAlign</a> = IndexField.Alignment.value();</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a1d3459ac1d0c3c498b3a522fbdcb0e7b">IndexOffset</a> = IndexField.Offset;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Also round the frame size up to a multiple of its alignment, as is</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// generally expected in C/C++.</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">    Shape.<a href="/docs/api/structs/llvm/coro/shape/#a742806b2e667a87817ae171e1ec59826">FrameSize</a> = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#a742806b2e667a87817ae171e1ec59826">FrameSize</a>, Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0a1a8e48ba1e5d845e979d5da8de597d">FrameAlign</a>);</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the retcon ABI, remember whether the frame is inline in the storage.</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380aad9d7f07127e321d1358b695c8720166">coro::ABI::Retcon</a>:</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a6ec6c15fe79ec2274d2c3e79ae4bcc41">coro::ABI::RetconOnce</a>: &#123;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Id = Shape.<a href="/docs/api/structs/llvm/coro/shape/#a2acb69a078f9bb3184aa59c6d4966861">getRetconCoroId</a>();</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">    Shape.<a href="/docs/api/structs/llvm/coro/shape/#ace1508259ecd37ceaafb9162d3768fff">RetconLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/retconloweringstorage/#a4df922b446b5bfca3248510df728539b">IsFrameInlineInStorage</a></span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">      = (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getStructSize() &lt;= Id-&gt;getStorageSize() &amp;&amp;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getStructAlign() &lt;= Id-&gt;getStorageAlignment());</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a24aa4117da86c41684ad25742832dfa6">coro::ABI::Async</a>: &#123;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">    Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0cca043bc17f6f673acb6324db527dae">AsyncLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/asyncloweringstorage/#a257b93881a8ca56ed33f4326672b738d">FrameOffset</a> =</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0cca043bc17f6f673acb6324db527dae">AsyncLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/asyncloweringstorage/#a3bf2569bd6f6975476d99b67f036a0e7">ContextHeaderSize</a>, Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0a1a8e48ba1e5d845e979d5da8de597d">FrameAlign</a>);</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Also make the final context size a multiple of the context alignment to</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// make allocation easier for allocators.</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">    Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0cca043bc17f6f673acb6324db527dae">AsyncLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/asyncloweringstorage/#a6b353e50aa2fb0fadf3c46ad81a28e00">ContextSize</a> =</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0cca043bc17f6f673acb6324db527dae">AsyncLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/asyncloweringstorage/#a257b93881a8ca56ed33f4326672b738d">FrameOffset</a> + Shape.<a href="/docs/api/structs/llvm/coro/shape/#a742806b2e667a87817ae171e1ec59826">FrameSize</a>,</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">                Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0cca043bc17f6f673acb6324db527dae">AsyncLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/asyncloweringstorage/#a12d93f5ae63381caf2a4ef0fdba3a668">getContextAlignment</a>());</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0cca043bc17f6f673acb6324db527dae">AsyncLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/asyncloweringstorage/#a12d93f5ae63381caf2a4ef0fdba3a668">getContextAlignment</a>() &lt; Shape.<a href="/docs/api/structs/llvm/coro/shape/#a0a1a8e48ba1e5d845e979d5da8de597d">FrameAlign</a>) &#123;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;The alignment requirment of frame variables cannot be higher than &quot;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;the alignment of the async function context&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FrameTy;</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlightComment">// Replace all alloca and SSA values that are accessed across suspend points</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlightComment">// with GetElementPointer from coroutine frame + loads and stores. Create an</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlightComment">// AllocaSpillBB that will become the new entry block for the resume parts of</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlightComment">// the coroutine:</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlightComment">//    %hdl = coro.begin(...)</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlightComment">//    whatever</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlightComment">// becomes:</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlightComment">//    %hdl = coro.begin(...)</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlightComment">//    br label %AllocaSpillBB</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlightComment">//  AllocaSpillBB:</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlightComment">//    ; geps corresponding to allocas that were moved to coroutine frame</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlightComment">//    br label PostSpill</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlightComment">//  PostSpill:</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlightComment">//    whatever</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004" lineLink="#af0885df5b78cc732639a9d52a87d040e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#af0885df5b78cc732639a9d52a87d040e">insertSpills</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-coroframe-cpp-/framedatainfo/#acceb42f33891bf127aaae587a26eb71e">FrameDataInfo</a> &amp;FrameData, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape) &#123;</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = Shape.<a href="/docs/api/structs/llvm/coro/shape/#abfb56acef5d60fefb2edc417f0bfbda0">CoroBegin</a>-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>();</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Shape.<a href="/docs/api/structs/llvm/coro/shape/#abfb56acef5d60fefb2edc417f0bfbda0">CoroBegin</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;FrameTy = Shape.<a href="/docs/api/structs/llvm/coro/shape/#a24c5fed9b14aed8a3b4f3828472fbab5">FrameTy</a>;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = Shape.<a href="/docs/api/structs/llvm/coro/shape/#a5eac2988672b484645dcbcd706430967">FramePtr</a>;</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> DT(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Argument &#42;, AllocaInst &#42;, 4&gt;</a> ArgToAllocaMap;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a GEP with the given index into the coroutine frame for the original</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value Orig. Appends an extra 0 index for array-allocas, preserving the</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// original type.</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetFramePointer = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Orig) -&gt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &#123;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-coroframe-cpp-/#aaed8c890d2dd79d46216c25b185c2943">FieldIDType</a> Index = FrameData.getFieldIndex(Orig);</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 3&gt;</a> Indices = &#123;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">        ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>), 0),</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">        ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>), Index),</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(Orig)) &#123;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(AI-&gt;getArraySize())) &#123;</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = CI-&gt;getValue().getZExtValue();</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> &gt; 1) &#123;</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">          Indices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>), 0));</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Coroutines cannot handle non static allocas yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(FrameTy, <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, Indices));</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(Orig)) &#123;</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FrameData.getDynamicAlign(Orig) != 0) &#123;</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FrameData.getDynamicAlign(Orig) == AI-&gt;getAlign().value());</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;M = AI-&gt;getModule();</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IntPtrTy = M-&gt;getDataLayout().getIntPtrType(AI-&gt;getType());</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PtrValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, IntPtrTy);</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AlignMask =</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">            ConstantInt::get(IntPtrTy, AI-&gt;getAlign().value() - 1);</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">        PtrValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(PtrValue, AlignMask);</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">        PtrValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(PtrValue, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(AlignMask));</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a53541ed6f92b18419f937f1f969aa0f6">CreateIntToPtr</a>(PtrValue, AI-&gt;getType());</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the type of GEP is not equal to the type of AllocaInst, it implies</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// that the AllocaInst may be reused in the Frame slot of other</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// AllocaInst. So We cast GEP to the AllocaInst here to re-use</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the Frame storage.</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note: If we change the strategy dealing with alignment, we need to refine</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this casting.</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType() != Orig-&gt;getType())</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aeb6ccc122c2f6868fc3a1e68e1ae157c">CreateAddrSpaceCast</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, Orig-&gt;getType(),</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">                                           Orig-&gt;getName() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.cast&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : FrameData.Spills) &#123;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Def = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SpillAlignment = <a href="/docs/api/structs/llvm/align">Align</a>(FrameData.getAlign(Def));</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a store instruction storing the value into the</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// coroutine frame.</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = <a href="/docs/api/namespaces/llvm/coro/#a58bcd428c0ca38b723b8ef938868ec4a">coro::getSpillInsertionPt</a>(Shape, Def, DT);</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ByValTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Arg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(Def)) &#123;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we&#39;re spilling an Argument, make sure we clear &#39;nocapture&#39;</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// from the coroutine function.</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">      Arg-&gt;getParent()-&gt;removeParamAttr(Arg-&gt;getArgNo(), Attribute::NoCapture);</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg-&gt;hasByValAttr())</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">        ByValTy = Arg-&gt;getParamByValType();</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Index = FrameData.getFieldIndex(Def);</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(InsertPt-&gt;getParent(), InsertPt);</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">        FrameTy, <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, 0, Index, Def-&gt;getName() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.spill.addr&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ByValTy) &#123;</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For byval arguments, we need to store the pointed value in the frame,</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instead of the pointer itself.</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/value">Value</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(ByValTy, Def);</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(<a href="/docs/api/classes/llvm/value">Value</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>, SpillAlignment);</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(Def, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>, SpillAlignment);</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrentBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CurrentReload = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.second) &#123;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we have not seen the use block, create a load instruction to reload</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the spilled value from the coroutine frame. Populates the Value pointer</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// reference provided with the frame GEP.</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentBlock != U-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()) &#123;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">        CurrentBlock = U-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CurrentBlock,</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">                               CurrentBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = GetFramePointer(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first);</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;setName(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first-&gt;getName() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.reload.addr&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ByValTy)</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">          CurrentReload = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">          CurrentReload = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3313ae2d314fb689cebdaf062d86eec5">CreateAlignedLoad</a>(</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">              FrameTy-&gt;<a href="/docs/api/classes/llvm/structtype/#aee3c78d73273cb8449cd10cc15edcb83">getElementType</a>(FrameData.getFieldIndex(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first)), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">              SpillAlignment, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first-&gt;getName() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.reload&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/tinyptrvector">TinyPtrVector&lt;DbgDeclareInst &#42;&gt;</a> DIs = <a href="/docs/api/namespaces/llvm/#a19d345e6fa45d60ff4092769417b89b2">findDbgDeclares</a>(Def);</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/tinyptrvector">TinyPtrVector&lt;DbgVariableRecord &#42;&gt;</a> DVRs = <a href="/docs/api/namespaces/llvm/#ac9c256eafdc8fb849f7320bc37120a5c">findDVRDeclares</a>(Def);</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Try best to find dbg.declare. If the spill is a temp, there may not</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// be a direct dbg.declare. Walk up the load chain to find one from an</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// alias.</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getSubprogram()) &#123;</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CurDef = Def;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (DIs.<a href="/docs/api/classes/llvm/tinyptrvector/#a9dc659b723e6725130ad354ed821d400">empty</a>() &amp;&amp; DVRs.<a href="/docs/api/classes/llvm/tinyptrvector/#a9dc659b723e6725130ad354ed821d400">empty</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(CurDef)) &#123;</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LdInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(CurDef);</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Only consider ptr to ptr same type load.</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LdInst-&gt;getPointerOperandType() != LdInst-&gt;getType())</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">            CurDef = LdInst-&gt;getPointerOperand();</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst, LoadInst&gt;</a>(CurDef))</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">            DIs = <a href="/docs/api/namespaces/llvm/#a19d345e6fa45d60ff4092769417b89b2">findDbgDeclares</a>(CurDef);</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">            DVRs = <a href="/docs/api/namespaces/llvm/#ac9c256eafdc8fb849f7320bc37120a5c">findDVRDeclares</a>(CurDef);</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SalvageOne = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DDI) &#123;</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowUnresolved = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// This dbg.declare is preserved for all coro-split function</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// fragments. It will be unreachable in the main function, and</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// processed by coro::salvageDebugInfo() by the Cloner.</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanagerimpl-h/#a926189935285d6e5df83fc0f45bf9b36">UseNewDbgInfoFormat</a>) &#123;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;NewDVR = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a>(</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/valueasmetadata/#a53fc78b63202142110d0e86dd1a71fbe">ValueAsMetadata::get</a>(CurrentReload), DDI-&gt;getVariable(),</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">                DDI-&gt;getExpression(), DDI-&gt;getDebugLoc(),</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/dbgvariablerecord/#ae2c3391c27b9fa4f64f9ed1bdbbdea4ca2709046ed364cc54b91f908e85e512ed">DbgVariableRecord::LocationType::Declare</a>);</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>()-&gt;getParent()-&gt;insertDbgRecordBefore(</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">                NewDVR, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>());</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a>(&#42;CurrentBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>(), AllowUnresolved)</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">                .<a href="/docs/api/classes/llvm/dibuilder/#a9019e662ee1c0c04e06e9871650268c8">insertDeclare</a>(CurrentReload, DDI-&gt;getVariable(),</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">                               DDI-&gt;getExpression(), DDI-&gt;getDebugLoc(),</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">                               Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>());</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// This dbg.declare is for the main function entry point.  It</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// will be deleted in all coro-split functions.</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/coro/#a14553297713bc2c6012758ee13a2b917">coro::salvageDebugInfo</a>(ArgToAllocaMap, &#42;DDI, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;UseEntryValue&#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(DIs, SalvageOne);</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(DVRs, SalvageOne);</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we have a single edge PHINode, remove it and replace it with a</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// reload from the coroutine frame. (We already took care of multi edge</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// PHINodes by normalizing them in the rewritePHIs function).</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PN-&gt;getNumIncomingValues() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;unexpected number of incoming &quot;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;values in the PHINode&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">        PN-&gt;replaceAllUsesWith(CurrentReload);</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">        PN-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Replace all uses of CurrentValue in the current instruction with</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// reload.</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">      U-&gt;replaceUsesOfWith(Def, CurrentReload);</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Instructions are added to Def&#39;s user list if the attached</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// debug records use Def. Update those now.</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR : <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(U-&gt;getDbgRecordRange()))</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">        DVR.replaceVariableLocationOp(Def, CurrentReload, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FramePtrBB = Shape.<a href="/docs/api/structs/llvm/coro/shape/#ac406c2b5a7e2d11174becab5cb27765d">getInsertPtAfterFramePtr</a>()-&gt;getParent();</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SpillBlock = FramePtrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">      Shape.<a href="/docs/api/structs/llvm/coro/shape/#ac406c2b5a7e2d11174becab5cb27765d">getInsertPtAfterFramePtr</a>(), </span><span class="doxyHighlightStringLiteral">&quot;AllocaSpillBB&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  SpillBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(&amp;SpillBlock-&gt;front(), </span><span class="doxyHighlightStringLiteral">&quot;PostSpill&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">  Shape.<a href="/docs/api/structs/llvm/coro/shape/#ae3a9a76ce45cff6c0385091993bccdcc">AllocaSpillBlock</a> = SpillBlock;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// retcon and retcon.once lowering assumes all uses have been sunk.</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380aad9d7f07127e321d1358b695c8720166">coro::ABI::Retcon</a> || Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a6ec6c15fe79ec2274d2c3e79ae4bcc41">coro::ABI::RetconOnce</a> ||</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">      Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a24aa4117da86c41684ad25742832dfa6">coro::ABI::Async</a>) &#123;</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we found any allocas, replace all of their remaining uses with Geps.</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(SpillBlock, SpillBlock-&gt;begin());</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : FrameData.Allocas) &#123;</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.Alloca;</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a> = GetFramePointer(Alloca);</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We are not using ReplaceInstWithInst(P.first, cast&lt;Instruction&gt;(G))</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// here, as we are changing location of the instruction.</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>-&gt;takeName(Alloca);</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">      Alloca-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>);</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">      Alloca-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we found any alloca, replace all of their remaining uses with GEP</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions. To remain debugbility, we replace the uses of allocas for</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dbg.declares and dbg.values with the reload from the frame.</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: We cannot replace the alloca with GEP instructions indiscriminately,</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as some of the uses may not be dominated by CoroBegin.</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#ae3a9a76ce45cff6c0385091993bccdcc">AllocaSpillBlock</a>,</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">                         Shape.<a href="/docs/api/structs/llvm/coro/shape/#ae3a9a76ce45cff6c0385091993bccdcc">AllocaSpillBlock</a>-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> UsersToUpdate;</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : FrameData.Allocas) &#123;</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca;</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">    UsersToUpdate.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Alloca-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#abfb56acef5d60fefb2edc417f0bfbda0">CoroBegin</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">        UsersToUpdate.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsersToUpdate.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a> = GetFramePointer(Alloca);</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>-&gt;setName(Alloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.reload.addr&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 4&gt;</a> DIs;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;&gt;</a> DbgVariableRecords;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a26bad0f6e5435a5a4dc50850c5b8f628">findDbgUsers</a>(DIs, Alloca, &amp;DbgVariableRecords);</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DVI : DIs)</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">      DVI-&gt;replaceUsesOfWith(Alloca, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>);</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DVR : DbgVariableRecords)</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">      DVR-&gt;replaceVariableLocationOp(Alloca, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>);</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : UsersToUpdate) &#123;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// It is meaningless to retain the lifetime intrinsics refer for the</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// member of coroutine frames and the meaningless lifetime intrinsics</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// are possible to block further optimizations.</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isLifetimeStartOrEnd()) &#123;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceUsesOfWith(Alloca, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>);</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;&#42;Shape.<a href="/docs/api/structs/llvm/coro/shape/#ac406c2b5a7e2d11174becab5cb27765d">getInsertPtAfterFramePtr</a>());</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : FrameData.Allocas) &#123;</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Alloca;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.MayWriteBeforeCoroBegin) &#123;</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// isEscaped really means potentially modified before CoroBegin.</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Alloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#aea74164514e7164813ab30bcc4b7c557">isArrayAllocation</a>())</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;Coroutines cannot handle copying of array allocas yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a> = GetFramePointer(Alloca);</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/value">Value</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Alloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), Alloca);</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(<a href="/docs/api/classes/llvm/value">Value</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>);</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each alias to Alloca created before CoroBegin but used after</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// CoroBegin, we recreate them after CoroBegin by applying the offset</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to the pointer in the frame.</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Alias : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Aliases) &#123;</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a> = GetFramePointer(Alloca);</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/value">Value</a> = &#42;Alias.second;</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ITy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/value">Value</a>.getBitWidth());</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AliasPtr =</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5b416a8603ccb844165c8df22454ac05">CreatePtrAdd</a>(<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcoreframelowering-cpp/#a64f8c7400de58c117c5af250f000675f">FramePtr</a>, ConstantInt::get(ITy, <a href="/docs/api/classes/llvm/value">Value</a>));</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">      Alias.first-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">          AliasPtr, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(Shape.<a href="/docs/api/structs/llvm/coro/shape/#abfb56acef5d60fefb2edc417f0bfbda0">CoroBegin</a>, U); &#125;);</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PromiseAlloca is not collected in FrameData.Allocas. So we don&#39;t handle</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the case that the PromiseAlloca may have writes before CoroBegin in the</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// above codes. And it may be problematic in edge cases. See</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// https://github.com/llvm/llvm-project/issues/57861 for an example.</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shape.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">coro::ABI::Switch</a> &amp;&amp; Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a6af0b7b0e5d0e8f4b8b4f4199a885204">PromiseAlloca</a>) &#123;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;PA = Shape.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a6af0b7b0e5d0e8f4b8b4f4199a885204">PromiseAlloca</a>;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is memory accessing to promise alloca before CoroBegin;</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasAccessingPromiseBeforeCB = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">llvm::any&#95;of</a>(PA-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">      auto &#42;Inst = dyn&#95;cast&lt;Instruction&gt;(U.getUser());</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">      if (!Inst || DT.dominates(Shape.CoroBegin, Inst))</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">        return false;</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">      if (auto &#42;CI = dyn&#95;cast&lt;CallInst&gt;(Inst)) &#123;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// It is fine if the call wouldn&#39;t write to the Promise.</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This is possible for @llvm.coro.id intrinsics, which</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// would take the promise as the second argument as a</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// marker.</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">        if (CI-&gt;onlyReadsMemory() ||</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">            CI-&gt;onlyReadsMemory(CI-&gt;getArgOperandNo(&amp;U)))</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">          return false;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">        return true;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(Inst) ||</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">// It may take too much time to track the uses.</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">// Be conservative about the case the use may escape.</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(Inst) ||</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">// There would always be a bitcast for the promise alloca</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">// before we enabled Opaque pointers. And now given</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">// opaque pointers are enabled by default. This should be</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">// fine.</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(Inst);</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasAccessingPromiseBeforeCB) &#123;</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;&#42;Shape.<a href="/docs/api/structs/llvm/coro/shape/#ac406c2b5a7e2d11174becab5cb27765d">getInsertPtAfterFramePtr</a>());</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a> = GetFramePointer(PA);</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/value">Value</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(PA-&gt;getAllocatedType(), PA);</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(<a href="/docs/api/classes/llvm/value">Value</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>);</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlightComment">// Moves the values in the PHIs in SuccBB that correspong to PredBB into a new</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlightComment">// PHI in InsertedBB.</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317" lineLink="#a642ec4238f02650fc1e70d5b4ac8d844"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a642ec4238f02650fc1e70d5b4ac8d844">movePHIValuesToInsertedBlock</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB,</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertedBB,</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB,</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;UntilPHI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(&amp;SuccBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>());</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Index = PN-&gt;getBasicBlockIndex(InsertedBB);</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = PN-&gt;getIncomingValue(Index);</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;InputV = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">        V-&gt;getType(), 1, V-&gt;getName() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">) + SuccBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">    InputV-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(InsertedBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">    InputV-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(V, PredBB);</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">    PN-&gt;setIncomingValue(Index, InputV);</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">    PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(PN-&gt;getNextNode());</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PN != UntilPHI);</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlightComment">// Rewrites the PHI Nodes in a cleanuppad.</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335" lineLink="#ab9fcdedd3580f924cf782f155b549a22"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ab9fcdedd3580f924cf782f155b549a22">rewritePHIsForCleanupPad</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CleanupPadBB,</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/cleanuppadinst">CleanupPadInst</a> &#42;CleanupPad) &#123;</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For every incoming edge to a CleanupPad we will create a new block holding</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all incoming values in single-value PHI nodes. We will then create another</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block to act as a dispather (as all unwind edges for related EH blocks</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// must be the same).</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cleanuppad:</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %2 = phi i32&#91;%0, %catchswitch&#93;, &#91;%1, %catch.1&#93;</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %3 = cleanuppad within none &#91;&#93;</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It will create:</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cleanuppad.corodispatch</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %2 = phi i8&#91;0, %catchswitch&#93;, &#91;1, %catch.1&#93;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %3 = cleanuppad within none &#91;&#93;</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    switch i8 % 2, label %unreachable</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//            &#91;i8 0, label %cleanuppad.from.catchswitch</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//             i8 1, label %cleanuppad.from.catch.1&#93;</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cleanuppad.from.catchswitch:</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %4 = phi i32 &#91;%0, %catchswitch&#93;</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    br %label cleanuppad</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cleanuppad.from.catch.1:</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %6 = phi i32 &#91;%1, %catch.1&#93;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    br %label cleanuppad</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cleanuppad:</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %8 = phi i32 &#91;%4, %cleanuppad.from.catchswitch&#93;,</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                 &#91;%6, %cleanuppad.from.catch.1&#93;</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unreachable BB, in case switching on an invalid value in the dispatcher.</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UnreachBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">      CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;unreachable&quot;</span><span class="doxyHighlight">, CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(UnreachBB);</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a new cleanuppad which will be the dispatcher.</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewCleanupPadBB =</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(),</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">                         CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.corodispatch&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">                         CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), CleanupPadBB);</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(NewCleanupPadBB);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SwitchType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>();</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SetDispatchValuePN =</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(SwitchType, <a href="/docs/api/namespaces/llvm/#a3f211484edf604716a6c80030b0a0375">pred&#95;size</a>(CleanupPadBB));</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">  CleanupPad-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">  CleanupPad-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(SetDispatchValuePN-&gt;getIterator());</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SwitchOnDispatch = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8b123015de85b2f41b0deda2aeaad9d3">CreateSwitch</a>(SetDispatchValuePN, UnreachBB,</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">                                                <a href="/docs/api/namespaces/llvm/#a3f211484edf604716a6c80030b0a0375">pred&#95;size</a>(CleanupPadBB));</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SwitchIndex = 0;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> Preds(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(CleanupPadBB));</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : Preds) &#123;</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a new cleanuppad and move the PHI values to there.</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CaseBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(),</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">                                      CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() +</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.from.&quot;</span><span class="doxyHighlight">) + Pred-&gt;getName(),</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">                                      CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), CleanupPadBB);</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac1ced98ffeb2b6991821751661b136d6">updatePhiNodes</a>(CleanupPadBB, Pred, CaseBB);</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    CaseBB-&gt;setName(CleanupPadBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.from.&quot;</span><span class="doxyHighlight">) +</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">                    Pred-&gt;getName());</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CaseBB);</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(CleanupPadBB);</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">    <a href="#a642ec4238f02650fc1e70d5b4ac8d844">movePHIValuesToInsertedBlock</a>(CleanupPadBB, CaseBB, NewCleanupPadBB);</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update this Pred to the new unwind point.</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ae2c2758db51113863d0114f08c4b482a">setUnwindEdgeTo</a>(Pred-&gt;getTerminator(), NewCleanupPadBB);</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Setup the switch in the dispatcher.</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SwitchConstant = ConstantInt::get(SwitchType, SwitchIndex);</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">    SetDispatchValuePN-&gt;addIncoming(SwitchConstant, Pred);</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">    SwitchOnDispatch-&gt;addCase(SwitchConstant, CaseBB);</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">    SwitchIndex++;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410" lineLink="#a03cdd58b24dc91b4e3819e218a399cbf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a03cdd58b24dc91b4e3819e218a399cbf">cleanupSinglePredPHIs</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 32&gt;</a> Worklist;</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Phi : BB.phis()) &#123;</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi.getNumIncomingValues() == 1) &#123;</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;Phi);</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OriginalValue = Phi-&gt;getIncomingValue(0);</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">    Phi-&gt;replaceAllUsesWith(OriginalValue);</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427" lineLink="#a5a93b5fcf433128b2fd9d563792eb4cd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a5a93b5fcf433128b2fd9d563792eb4cd">rewritePHIs</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB) &#123;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For every incoming edge we will create a block holding all</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// incoming values in a single PHI nodes.</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop:</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %n.val = phi i32&#91;%n, %entry&#93;, &#91;%inc, %loop&#93;</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It will create:</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop.from.entry:</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %n.loop.pre = phi i32 &#91;%n, %entry&#93;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    br %label loop</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop.from.loop:</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %inc.loop.pre = phi i32 &#91;%inc, %loop&#93;</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    br %label loop</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After this rewrite, further analysis will ignore any phi nodes with more</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// than one incoming edge.</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Simplify PHINodes in the basic block to remove duplicate</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors.</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Special case for CleanupPad: all EH blocks must have the same unwind edge</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so we need to create an additional &quot;dispatcher&quot; block.</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB.<a href="/docs/api/classes/llvm/basicblock/#a266367eb01c634406b32f816d2d9c6bf">empty</a>()) &#123;</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CleanupPad =</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CleanupPadInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>())) &#123;</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> Preds(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(&amp;BB));</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : Preds) &#123;</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/catchswitchinst">CatchSwitchInst</a> &#42;CS =</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchSwitchInst&gt;</a>(Pred-&gt;getTerminator())) &#123;</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// CleanupPad with a CatchSwitch predecessor: therefore this is an</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// unwind destination that needs to be handle specially.</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CS-&gt;getUnwindDest() == &amp;BB);</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">          (void)CS;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">          <a href="#ab9fcdedd3580f924cf782f155b549a22">rewritePHIsForCleanupPad</a>(&amp;BB, CleanupPad);</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;LandingPad = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;ReplPHI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB.<a href="/docs/api/classes/llvm/basicblock/#a266367eb01c634406b32f816d2d9c6bf">empty</a>()) &#123;</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((LandingPad =</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;LandingPadInst&gt;</a>(BB.<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>()))) &#123;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// ehAwareSplitEdge will clone the LandingPad in all the edge blocks.</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We replace the original landing pad with a PHINode that will collect the</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// results from all of them.</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">      ReplPHI = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(LandingPad-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 1, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">      ReplPHI-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(LandingPad-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">      ReplPHI-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(LandingPad);</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">      LandingPad-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ReplPHI);</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We will erase the original landing pad at the end of this function after</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// ehAwareSplitEdge cloned it in the transition blocks.</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> Preds(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(&amp;BB));</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : Preds) &#123;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingBB = <a href="/docs/api/namespaces/llvm/#a833a6084a93d5900e8bdd493b37bbbc7">ehAwareSplitEdge</a>(Pred, &amp;BB, LandingPad, ReplPHI);</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">    IncomingBB-&gt;setName(BB.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;.from.&quot;</span><span class="doxyHighlight">) + Pred-&gt;getName());</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Stop the moving of values at ReplPHI, as this is either null or the PHI</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that replaced the landing pad.</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    <a href="#a642ec4238f02650fc1e70d5b4ac8d844">movePHIValuesToInsertedBlock</a>(&amp;BB, IncomingBB, Pred, ReplPHI);</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LandingPad) &#123;</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Calls to ehAwareSplitEdge function cloned the original lading pad.</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// No longer need it.</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">    LandingPad-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503" lineLink="#a0647ca6021ca57224016effde79d4d7e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a5a93b5fcf433128b2fd9d563792eb4cd">rewritePHIs</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> WorkList;</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;BB.front()))</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;getNumIncomingValues() &gt; 1)</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">        WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;BB);</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : WorkList)</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">    <a href="#a5a93b5fcf433128b2fd9d563792eb4cd">rewritePHIs</a>(&#42;BB);</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlightComment">// Splits the block at a particular instruction unless it is the first</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlightComment">// instruction in the block with a single predecessor.</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517" lineLink="#a973240859e7ff5af51dad8426b400053"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="#a973240859e7ff5af51dad8426b400053">splitBlockIfNotFirst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;BB-&gt;front() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;getSinglePredecessor()) &#123;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">      BB-&gt;setName(Name);</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BB;</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BB-&gt;splitBasicBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Name);</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlightComment">// Split above and below a particular instruction so that it</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlightComment">// will be all alone by itself in a block.</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530" lineLink="#a54c76b23c53f62a58c09936547b2842d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a54c76b23c53f62a58c09936547b2842d">splitAround</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">  <a href="#a973240859e7ff5af51dad8426b400053">splitBlockIfNotFirst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Name);</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">  <a href="#a973240859e7ff5af51dad8426b400053">splitBlockIfNotFirst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode(), </span><span class="doxyHighlightStringLiteral">&quot;After&quot;</span><span class="doxyHighlight"> + Name);</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlightComment">/// After we split the coroutine, will the given basic block be along</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlightComment">/// an obvious exit path for the resumption function?</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537" lineLink="#a711449044c2aef3a8aba56149e421b60"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a711449044c2aef3a8aba56149e421b60">willLeaveFunctionImmediatelyAfter</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">                                              </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> depth = 3) &#123;</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;ve bottomed out our depth count, stop searching and assume</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that the path might loop back.</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (depth == 0) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a suspend block, we&#39;re about to exit the resumption function.</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/coro/#a64f8e14ffe5fb52d552fcb9058286ad3">coro::isSuspendBlock</a>(BB))</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Recurse into the successors.</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB)) &#123;</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a711449044c2aef3a8aba56149e421b60">willLeaveFunctionImmediatelyAfter</a>(Succ, depth - 1))</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If none of the successors leads back in a loop, we&#39;re on an exit/abort.</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557" lineLink="#a47b0e7da15eccab3545643118aa2f99f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a47b0e7da15eccab3545643118aa2f99f">localAllocaNeedsStackSave</a>(<a href="/docs/api/classes/llvm/coroallocaallocinst">CoroAllocaAllocInst</a> &#42;AI) &#123;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for a free that isn&#39;t sufficiently obviously followed by</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// either a suspend or a termination, i.e. something that will leave</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the coro resumption frame.</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CoroAllocaFreeInst&gt;</a>(U);</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FI) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a711449044c2aef3a8aba56149e421b60">willLeaveFunctionImmediatelyAfter</a>(FI-&gt;getParent()))</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we never found one, we don&#39;t need a stack save.</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlightComment">/// Turn each of the given local allocas into a normal (dynamic) alloca</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlightComment">/// instruction.</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575" lineLink="#a36b39e8a1384a23b9899d2c9e2e08e72"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a36b39e8a1384a23b9899d2c9e2e08e72">lowerLocalAllocas</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;CoroAllocaAllocInst&#42;&gt;</a> LocalAllocas,</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction&#42;&gt;</a> &amp;DeadInsts) &#123;</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AI : LocalAllocas) &#123;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(AI);</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the stack depth.  Try to avoid doing this if the stackrestore</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is going to immediately precede a return or something.</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;StackSave = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a47b0e7da15eccab3545643118aa2f99f">localAllocaNeedsStackSave</a>(AI))</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">      StackSave = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1f41fdcdad0b0b862da8b557701b4bff">CreateStackSave</a>();</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Allocate memory.</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Alloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>(), AI-&gt;getSize());</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">    Alloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(AI-&gt;getAlignment());</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : AI-&gt;users()) &#123;</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Replace gets with the allocation.</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CoroAllocaGetInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">        U-&gt;replaceAllUsesWith(Alloca);</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Replace frees with stackrestores.  This is safe because</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// alloca.alloc is required to obey a stack discipline, although we</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// don&#39;t enforce that structurally.</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CoroAllocaFreeInst&gt;</a>(U);</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StackSave) &#123;</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(FI);</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#acd200f2f1bf30751d0489584a0565243">CreateStackRestore</a>(StackSave);</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">      DeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">    DeadInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(AI);</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlightComment">/// Get the current swifterror value.</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613" lineLink="#ad7795d2b31b375031144ce50d0f6fa34"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ad7795d2b31b375031144ce50d0f6fa34">emitGetSwiftErrorValue</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ValueTy,</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">                                     <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape) &#123;</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make a fake function pointer as a sort of intrinsic.</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FnTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(ValueTy, &#123;&#125;, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Fn = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(FnTy, Fn, &#123;&#125;);</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  Shape.<a href="/docs/api/structs/llvm/coro/shape/#ae290085a52a8df4810b4e7f48dbe1ac5">SwiftErrorOps</a>.push&#95;back(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlightComment">/// Set the given value as the current swifterror value.</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlightComment">/// Returns a slot that can be used as a swifterror slot.</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628" lineLink="#a3d306b9a19fc37d00329692ef499b1b1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a3d306b9a19fc37d00329692ef499b1b1">emitSetSwiftErrorValue</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">                                     <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape) &#123;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make a fake function pointer as a sort of intrinsic.</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FnTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">                                &#123;V-&gt;getType()&#125;, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Fn = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(FnTy, Fn, &#123; V &#125;);</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">  Shape.<a href="/docs/api/structs/llvm/coro/shape/#ae290085a52a8df4810b4e7f48dbe1ac5">SwiftErrorOps</a>.push&#95;back(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlightComment">/// Set the swifterror value from the given alloca before a call,</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlightComment">/// then put in back in the alloca afterwards.</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlightComment">/// Returns an address that will stand in for the swifterror slot</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlightComment">/// until splitting.</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646" lineLink="#a43a2acbd71eac7be9bdd1094a21bd6ab"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a43a2acbd71eac7be9bdd1094a21bd6ab">emitSetAndGetSwiftErrorValueAround</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>,</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca,</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">                                                 <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape) &#123;</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ValueTy = Alloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>();</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Load the current value from the alloca and set it as the</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// swifterror value.</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ValueBeforeCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(ValueTy, Alloca);</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Addr = <a href="#a3d306b9a19fc37d00329692ef499b1b1">emitSetSwiftErrorValue</a>(Builder, ValueBeforeCall, Shape);</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move to after the call.  Since swifterror only has a guaranteed</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value on normal exits, we can ignore implicit and explicit unwind</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// edges.</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>)) &#123;</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getNextNode());</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Invoke = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InvokeInst&gt;</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Invoke-&gt;getNormalDest()-&gt;getFirstNonPHIOrDbg());</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the current swifterror value and store it to the alloca.</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ValueAfterCall = <a href="#ad7795d2b31b375031144ce50d0f6fa34">emitGetSwiftErrorValue</a>(Builder, ValueTy, Shape);</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ValueAfterCall, Alloca);</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Addr;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlightComment">/// Eliminate a formerly-swifterror alloca by inserting the get/set</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlightComment">/// intrinsics and attempting to MemToReg the alloca away.</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676" lineLink="#a55af5cce8eb7833907578e6fc3f0ab5e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a55af5cce8eb7833907578e6fc3f0ab5e">eliminateSwiftErrorAlloca</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Alloca,</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">                                      <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape) &#123;</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/classes/llvm/use">Use</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(Alloca-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>())) &#123;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// swifterror values can only be used in very specific ways.</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We take advantage of that here.</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/classes/llvm/use">Use</a>.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>();</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>));</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Addr = <a href="#a43a2acbd71eac7be9bdd1094a21bd6ab">emitSetAndGetSwiftErrorValueAround</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, Alloca, Shape);</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Use the returned slot address as the call argument.</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a>.<a href="/docs/api/classes/llvm/use/#a40360b4fa7b8e6920a68e5a8a0814f1f">set</a>(Addr);</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All the uses should be loads and stores now.</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a5023b360abc7a5d1612061fba30003a6">isAllocaPromotable</a>(Alloca));</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlightComment">/// &quot;Eliminate&quot; a swifterror argument by reducing it to the alloca case</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlightComment">/// and then loading and storing in the prologue and epilog.</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlightComment">/// The argument keeps the swifterror flag.</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702" lineLink="#a8356860a8bef082ff15df896ecec7732"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8356860a8bef082ff15df896ecec7732">eliminateSwiftErrorArgument</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;Arg,</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">                                        <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape,</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;AllocaInst&#42;&gt;</a> &amp;AllocasToPromote) &#123;</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock(),</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">                      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock().getFirstNonPHIOrDbg());</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ArgTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PointerType&gt;</a>(Arg.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ValueTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext());</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reduce to the alloca case:</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create an alloca and replace all uses of the arg with it.</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Alloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ValueTy, ArgTy-&gt;getAddressSpace());</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">  Arg.<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Alloca);</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set an initial value in the alloca.  swifterror is always null on entry.</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InitialValue = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(ValueTy);</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(InitialValue, Alloca);</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find all the suspends in the function and save and restore around them.</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Suspend : Shape.<a href="/docs/api/structs/llvm/coro/shape/#a5fd0aa934908c837c6d78097a2fd667b">CoroSuspends</a>) &#123;</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    (void) <a href="#a43a2acbd71eac7be9bdd1094a21bd6ab">emitSetAndGetSwiftErrorValueAround</a>(Suspend, Alloca, Shape);</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find all the coro.ends in the function and restore the error value.</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;End : Shape.<a href="/docs/api/structs/llvm/coro/shape/#adc470e92d3cd5fb8d54d7b9179841463">CoroEnds</a>) &#123;</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(End);</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FinalValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(ValueTy, Alloca);</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">    (void) <a href="#a3d306b9a19fc37d00329692ef499b1b1">emitSetSwiftErrorValue</a>(Builder, FinalValue, Shape);</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we can use the alloca logic.</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">  AllocasToPromote.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Alloca);</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  <a href="#a55af5cce8eb7833907578e6fc3f0ab5e">eliminateSwiftErrorAlloca</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Alloca, Shape);</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlightComment">/// Eliminate all problematic uses of swifterror arguments and allocas</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlightComment">/// from the function.  We&#39;ll fix them up later when splitting the function.</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740" lineLink="#a311a80924f5342813ae67daa5e5ff444"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a311a80924f5342813ae67daa5e5ff444">eliminateSwiftError</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape) &#123;</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AllocaInst&#42;, 4&gt;</a> AllocasToPromote;</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for a swifterror argument.</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Arg : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.args()) &#123;</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Arg.hasSwiftErrorAttr()) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">    <a href="#a8356860a8bef082ff15df896ecec7732">eliminateSwiftErrorArgument</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Arg, Shape, AllocasToPromote);</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for swifterror allocas.</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Inst : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock()) &#123;</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Alloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(&amp;Inst);</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Alloca || !Alloca-&gt;isSwiftError()) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clear the swifterror flag.</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">    Alloca-&gt;setSwiftError(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">    AllocasToPromote.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Alloca);</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">    <a href="#a55af5cce8eb7833907578e6fc3f0ab5e">eliminateSwiftErrorAlloca</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Alloca, Shape);</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have any allocas to promote, compute a dominator tree and</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// promote them en masse.</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllocasToPromote.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> DT(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a1a4cac84457299517e69ff9764fed2db">PromoteMemToReg</a>(AllocasToPromote, DT);</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlightComment">/// For each local variable that all of its user are only used inside one of</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlightComment">/// suspended region, we sink their lifetime.start markers to the place where</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlightComment">/// after the suspend block. Doing so minimizes the lifetime of each variable,</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlightComment">/// hence minimizing the amount of data we end up putting on the frame.</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775" lineLink="#abb3297c94836debc08248e7ae3f47582"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#abb3297c94836debc08248e7ae3f47582">sinkLifetimeStartMarkers</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;Shape,</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/suspendcrossinginfo">SuspendCrossingInfo</a> &amp;Checker,</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT) &#123;</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasOptNone())</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect all possible basic blocks which may dominate all uses of allocas.</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 4&gt;</a> DomSet;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  DomSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock());</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CSI : Shape.<a href="/docs/api/structs/llvm/coro/shape/#a5fd0aa934908c837c6d78097a2fd667b">CoroSuspends</a>) &#123;</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuspendBlock = CSI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/coro/#a64f8e14ffe5fb52d552fcb9058286ad3">coro::isSuspendBlock</a>(SuspendBlock) &amp;&amp;</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">           SuspendBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() &amp;&amp;</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;should have split coro.suspend into its own block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">    DomSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(SuspendBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>());</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a>&#42; AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AI)</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DomBB : DomSet) &#123;</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Valid = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 1&gt;</a> Lifetimes;</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/gvn-cpp/#ab1faa49b43014e07caaf2bf2d3db07e4">isLifetimeStart</a> = &#91;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a>&#42; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight">&#42; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::lifetime&#95;start;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> collectLifetimeStart = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;U, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI) &#123;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/gvn-cpp/#ab1faa49b43014e07caaf2bf2d3db07e4">isLifetimeStart</a>(U)) &#123;</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">          Lifetimes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(U);</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!U-&gt;hasOneUse() || U-&gt;stripPointerCasts() != AI)</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/gvn-cpp/#ab1faa49b43014e07caaf2bf2d3db07e4">isLifetimeStart</a>(U-&gt;user&#95;back())) &#123;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">          Lifetimes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(U-&gt;user&#95;back());</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For all users except lifetime.start markers, if they are all</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// dominated by one of the basic blocks and do not cross</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// suspend points as well, then there is no need to spill the</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// instruction.</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(DomBB, UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) ||</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">            Checker.<a href="/docs/api/classes/llvm/suspendcrossinginfo/#a184a65eb9ac1cd8093ea44d3490b3e70">isDefinitionAcrossSuspend</a>(DomBB, UI)) &#123;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Skip lifetime.start, GEP and bitcast used by lifetime.start</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// markers.</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (collectLifetimeStart(UI, AI))</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">          Valid = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Sink lifetime.start markers to dominate block when they are</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// only used outside the region.</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Valid &amp;&amp; Lifetimes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 0) &#123;</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewLifetime = Lifetimes&#91;0&#93;-&gt;clone();</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">        NewLifetime-&gt;replaceUsesOfWith(NewLifetime-&gt;getOperand(1), AI);</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">        NewLifetime-&gt;insertBefore(DomBB-&gt;getTerminator()-&gt;getIterator());</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// All the outsided lifetime.start markers are no longer necessary.</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;S : Lifetimes)</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">          S-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;std::pair&lt;Value &amp;, DIExpression &amp;&gt;&gt;</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855" lineLink="#a22d247369eb256f74de55d2260c3b82e"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#a99356c6b92999b95181b5d79c03868ee">salvageDebugInfoImpl</a>(<a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Argument &#42;, AllocaInst &#42;, 4&gt;</a> &amp;ArgToAllocaMap,</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseEntryValue, <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Storage,</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;Expr, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipOutermostLoad) &#123;</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext());</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertPt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().getFirstInsertionPt();</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(InsertPt))</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">    ++InsertPt;</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock(), InsertPt);</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(Storage)) &#123;</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LdInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">      Storage = LdInst-&gt;getPointerOperand();</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: This is a heuristic that works around the fact that</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// LLVM IR debug intrinsics cannot yet distinguish between</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// memory and value locations: Because a dbg.declare(alloca) is</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// implicitly a memory location no DW&#95;OP&#95;deref operation for the</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// last direct load from an alloca is necessary.  This condition</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// effectively drops the &#42;last&#42; DW&#95;OP&#95;deref in the expression.</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SkipOutermostLoad)</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">        Expr = <a href="/docs/api/classes/llvm/diexpression/#ab804b15bb92ff685d7c1464b2816d608">DIExpression::prepend</a>(Expr, <a href="/docs/api/classes/llvm/diexpression/#a6472489551b8960cc115a93d95eef9f6a18f3c7099f5b8bfe10361a97ee34a5c9">DIExpression::DerefBefore</a>);</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">      Storage = StInst-&gt;getValueOperand();</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 16&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 0&gt;</a> AdditionalValues;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a99356c6b92999b95181b5d79c03868ee">llvm::salvageDebugInfoImpl</a>(</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">          &#42;Inst, Expr ? Expr-&gt;<a href="/docs/api/classes/llvm/diexpression/#a9aef6cbb464a57070a26cf422b979df9">getNumLocationOperands</a>() : 0, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">          AdditionalValues);</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> || !AdditionalValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If salvaging failed or salvaging produced more than one location</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// operand, give up.</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">      Storage = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">      Expr = <a href="/docs/api/classes/llvm/diexpression/#a5f48305fa7d23161515c94bca7c2beb6">DIExpression::appendOpsToArg</a>(Expr, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, 0, </span><span class="doxyHighlightComment">/&#42;StackValue&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">    SkipOutermostLoad = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Storage)</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StorageAsArg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(Storage);</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSwiftAsyncArg =</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">      StorageAsArg &amp;&amp; StorageAsArg-&gt;hasAttribute(Attribute::SwiftAsync);</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Swift async arguments are described by an entry value of the ABI-defined</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register containing the coroutine context.</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Entry values in variadic expressions are not supported.</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSwiftAsyncArg &amp;&amp; UseEntryValue &amp;&amp; !Expr-&gt;<a href="/docs/api/classes/llvm/diexpression/#a012168d44e49d5120cf8919cd096fd3b">isEntryValue</a>() &amp;&amp;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">      Expr-&gt;<a href="/docs/api/classes/llvm/diexpression/#ac9a4fe1aa8e698aa8cd6a24751a80d91">isSingleLocationExpression</a>())</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">    Expr = <a href="/docs/api/classes/llvm/diexpression/#ab804b15bb92ff685d7c1464b2816d608">DIExpression::prepend</a>(Expr, <a href="/docs/api/classes/llvm/diexpression/#a6472489551b8960cc115a93d95eef9f6a732b32a9387e1f0a0b49cd59b96905ae">DIExpression::EntryValue</a>);</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the coroutine frame is an Argument, store it in an alloca to improve</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// its availability (e.g. registers may be clobbered).</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid this if the value is guaranteed to be available through other means</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (e.g. swift ABI guarantees).</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StorageAsArg &amp;&amp; !IsSwiftAsyncArg) &#123;</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Cached = ArgToAllocaMap&#91;StorageAsArg&#93;;</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cached) &#123;</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">      Cached = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Storage-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">                                    Storage-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.debug&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Storage, Cached);</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">    Storage = Cached;</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: LLVM lacks nuanced semantics to differentiate between</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// memory and direct locations at the IR level. The backend will</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// turn a dbg.declare(alloca, ..., DIExpression()) into a memory</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// location. Thus, if there are deref and offset operations in the</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// expression, we need to add a DW&#95;OP&#95;deref at the &#42;start&#42; of the</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// expression to first load the contents of the alloca before</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// adjusting it with the expression.</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">    Expr = <a href="/docs/api/classes/llvm/diexpression/#ab804b15bb92ff685d7c1464b2816d608">DIExpression::prepend</a>(Expr, <a href="/docs/api/classes/llvm/diexpression/#a6472489551b8960cc115a93d95eef9f6a18f3c7099f5b8bfe10361a97ee34a5c9">DIExpression::DerefBefore</a>);</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">  Expr = Expr-&gt;<a href="/docs/api/classes/llvm/diexpression/#a804421879fbddb541d8393ec3c3730ee">foldConstantMath</a>();</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#123;&#42;Storage, &#42;Expr&#125;&#125;;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933" lineLink="/docs/api/namespaces/llvm/coro/#a14553297713bc2c6012758ee13a2b917"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a14553297713bc2c6012758ee13a2b917">coro::salvageDebugInfo</a>(</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Argument &#42;, AllocaInst &#42;, 4&gt;</a> &amp;ArgToAllocaMap,</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &amp;DVI, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseEntryValue) &#123;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = DVI.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Follow the pointer arithmetic all the way to the incoming</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function argument and convert into a DIExpression.</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipOutermostLoad = !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgValueInst&gt;</a>(DVI);</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;OriginalStorage = DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a5702a1d09ac6ee86196a38b3f682a570">getVariableLocationOp</a>(0);</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SalvagedInfo =</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a99356c6b92999b95181b5d79c03868ee">::salvageDebugInfoImpl</a>(ArgToAllocaMap, UseEntryValue, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, OriginalStorage,</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">                             DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#ad1707c1c1ab1f3278424f265893c87fb">getExpression</a>(), SkipOutermostLoad);</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SalvagedInfo)</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Storage = &amp;SalvagedInfo-&gt;first;</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;Expr = &amp;SalvagedInfo-&gt;second;</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">  DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a3d995a069d73ebebbd6a4aace342ef76">replaceVariableLocationOp</a>(OriginalStorage, Storage);</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">  DVI.<a href="/docs/api/classes/llvm/dbgvariableintrinsic/#a71808acf992f787300ec18d5700f09cc">setExpression</a>(Expr);</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only hoist dbg.declare today since it doesn&#39;t make sense to hoist</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dbg.value since it does not have the same function wide guarantees that</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dbg.declare does.</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgDeclareInst&gt;</a>(DVI)) &#123;</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    std::optional&lt;BasicBlock::iterator&gt; InsertPt;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Storage)) &#123;</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">      InsertPt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getInsertionPointAfterDef();</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update DILocation only if variable was not inlined.</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> ILoc = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DVILoc = DVI.<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ILoc &amp;&amp; DVILoc &amp;&amp;</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">          DVILoc-&gt;getScope()-&gt;getSubprogram() ==</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">              ILoc-&gt;getScope()-&gt;getSubprogram())</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">        DVI.<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(Storage))</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">      InsertPt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().begin();</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InsertPt)</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">      DVI.<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&#42;(&#42;InsertPt)-&gt;getParent(), &#42;InsertPt);</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975" lineLink="/docs/api/namespaces/llvm/coro/#afa1f83e099867326b23c359030bbb103"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a14553297713bc2c6012758ee13a2b917">coro::salvageDebugInfo</a>(</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Argument &#42;, AllocaInst &#42;, 4&gt;</a> &amp;ArgToAllocaMap,</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseEntryValue) &#123;</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = DVR.<a href="/docs/api/classes/llvm/dbgrecord/#a0c770bec150810f68fb4a4eacceec263">getFunction</a>();</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Follow the pointer arithmetic all the way to the incoming</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function argument and convert into a DIExpression.</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SkipOutermostLoad = DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#ac1678dcac1aa0255429f8dcee4ffabd2">isDbgDeclare</a>();</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;OriginalStorage = DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a99dac64e3a954ffbcbf1fc6726a743a2">getVariableLocationOp</a>(0);</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SalvagedInfo =</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a99356c6b92999b95181b5d79c03868ee">::salvageDebugInfoImpl</a>(ArgToAllocaMap, UseEntryValue, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, OriginalStorage,</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">                             DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8ec5a479378113fc24b647afa2f06ee5">getExpression</a>(), SkipOutermostLoad);</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SalvagedInfo)</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Storage = &amp;SalvagedInfo-&gt;first;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/diexpression">DIExpression</a> &#42;Expr = &amp;SalvagedInfo-&gt;second;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">  DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#ae0ac412244054beacd97e316ded0fed3">replaceVariableLocationOp</a>(OriginalStorage, Storage);</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">  DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8e803431f2ec29d9982f5cd7815712ee">setExpression</a>(Expr);</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only hoist dbg.declare today since it doesn&#39;t make sense to hoist</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dbg.value since it does not have the same function wide guarantees that</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dbg.declare does.</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a1adb590f8f0ceed777898888ed5db7ac">getType</a>() == <a href="/docs/api/classes/llvm/dbgvariablerecord/#ae2c3391c27b9fa4f64f9ed1bdbbdea4ca2709046ed364cc54b91f908e85e512ed">DbgVariableRecord::LocationType::Declare</a>) &#123;</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">    std::optional&lt;BasicBlock::iterator&gt; InsertPt;</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Storage)) &#123;</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">      InsertPt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getInsertionPointAfterDef();</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update DILocation only if variable was not inlined.</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> ILoc = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DVRLoc = DVR.<a href="/docs/api/classes/llvm/dbgrecord/#a3a0f4e00c3f6345c52c6acd178b3fca3">getDebugLoc</a>();</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ILoc &amp;&amp; DVRLoc &amp;&amp;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">          DVRLoc-&gt;getScope()-&gt;getSubprogram() ==</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">              ILoc-&gt;getScope()-&gt;getSubprogram())</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">        DVR.<a href="/docs/api/classes/llvm/dbgrecord/#a8c0c4e84ab4014447f294a22100126db">setDebugLoc</a>(ILoc);</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(Storage))</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">      InsertPt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().begin();</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InsertPt) &#123;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">      DVR.<a href="/docs/api/classes/llvm/dbgrecord/#a04a8b2dc4d72db72e1f87bdec4074973">removeFromParent</a>();</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">      (&#42;InsertPt)-&gt;getParent()-&gt;insertDbgRecordBefore(&amp;DVR, &#42;InsertPt);</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019" lineLink="/docs/api/namespaces/llvm/coro/#a8bd87bda26e6aac77644f79dbd06c340"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coro/#a8bd87bda26e6aac77644f79dbd06c340">coro::normalizeCoroutine</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/structs/llvm/coro/shape">coro::Shape</a> &amp;<a href="/docs/api/structs/llvm/coro/shape">Shape</a>,</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t eliminate swifterror in async functions that won&#39;t be split.</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/coro/shape">Shape</a>.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> != <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a24aa4117da86c41684ad25742832dfa6">coro::ABI::Async</a> || !<a href="/docs/api/structs/llvm/coro/shape">Shape</a>.<a href="/docs/api/structs/llvm/coro/shape/#a5fd0aa934908c837c6d78097a2fd667b">CoroSuspends</a>.empty())</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">    <a href="#a311a80924f5342813ae67daa5e5ff444">eliminateSwiftError</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/structs/llvm/coro/shape">Shape</a>);</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/coro/shape">Shape</a>.<a href="/docs/api/structs/llvm/coro/shape/#a4e554c60419835fc3c74b91b28ca31c8">ABI</a> == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">coro::ABI::Switch</a> &amp;&amp;</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/coro/shape">Shape</a>.<a href="/docs/api/structs/llvm/coro/shape/#abe8f7906a8618f90e2a75109a778054a">SwitchLowering</a>.<a href="/docs/api/structs/llvm/coro/shape/switchloweringstorage/#a6af0b7b0e5d0e8f4b8b4f4199a885204">PromiseAlloca</a>) &#123;</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/coro/shape">Shape</a>.<a href="/docs/api/structs/llvm/coro/shape/#a3660324b8035c8b52afd23e54623ddf8">getSwitchCoroId</a>()-&gt;<a href="/docs/api/classes/llvm/coroidinst/#ab330f042033636da90859626bc4dc542">clearPromise</a>();</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure that all coro.save, coro.suspend and the fallthrough coro.end</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsics are in their own blocks to simplify the logic of building up</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SuspendCrossing data.</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CSI : <a href="/docs/api/structs/llvm/coro/shape">Shape</a>.<a href="/docs/api/structs/llvm/coro/shape/#a5fd0aa934908c837c6d78097a2fd667b">CoroSuspends</a>) &#123;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Save = CSI-&gt;getCoroSave())</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">      <a href="#a54c76b23c53f62a58c09936547b2842d">splitAround</a>(Save, </span><span class="doxyHighlightStringLiteral">&quot;CoroSave&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">    <a href="#a54c76b23c53f62a58c09936547b2842d">splitAround</a>(CSI, </span><span class="doxyHighlightStringLiteral">&quot;CoroSuspend&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Put CoroEnds into their own blocks.</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/anycoroendinst">AnyCoroEndInst</a> &#42;CE : <a href="/docs/api/structs/llvm/coro/shape">Shape</a>.<a href="/docs/api/structs/llvm/coro/shape/#adc470e92d3cd5fb8d54d7b9179841463">CoroEnds</a>) &#123;</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">    <a href="#a54c76b23c53f62a58c09936547b2842d">splitAround</a>(CE, </span><span class="doxyHighlightStringLiteral">&quot;CoroEnd&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit the musttail call function in a new block before the CoroEnd.</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We do this here so that the right suspend crossing info is computed for</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the uses of the musttail call function call. (Arguments to the coro.end</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions would be ignored)</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AsyncEnd = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CoroAsyncEndInst&gt;</a>(CE)) &#123;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MustTailCallFn = AsyncEnd-&gt;getMustTailCallFunction();</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MustTailCallFn)</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(AsyncEnd);</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 8&gt;</a> Args(AsyncEnd-&gt;args());</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowerkernelarguments-cpp/#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a> = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;Value &#42;&gt;</a>(Args).drop&#95;front(3);</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/namespaces/llvm/coro/#aa0d499612ac66539c8daf29c8eb142a5">coro::createMustTailCall</a>(</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">          AsyncEnd-&gt;getDebugLoc(), MustTailCallFn, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowerkernelarguments-cpp/#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a>, Builder);</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">      <a href="#a54c76b23c53f62a58c09936547b2842d">splitAround</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, </span><span class="doxyHighlightStringLiteral">&quot;MustTailCall.Before.CoroEnd&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Later code makes structural assumptions about single predecessors phis e.g</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that they are not live across a suspend point.</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">  <a href="#a03cdd58b24dc91b4e3819e218a399cbf">cleanupSinglePredPHIs</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transforms multi-edge PHI Nodes, so that any value feeding into a PHI will</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// never have its definition separated from the PHI by the suspend point.</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">  <a href="#a5a93b5fcf433128b2fd9d563792eb4cd">rewritePHIs</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069" lineLink="/docs/api/classes/llvm/coro/baseabi/#ab47fb8dadd631b1c67a285b16607e4c5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/coro/baseabi/#ab47fb8dadd631b1c67a285b16607e4c5">coro::BaseABI::buildCoroutineFrame</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptimizeFrame) &#123;</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/suspendcrossinginfo">SuspendCrossingInfo</a> Checker(<a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.CoroSuspends, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.CoroEnds);</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#ad3bf571f4743d886275638484d6a3389">doRematerializations</a>(<a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, Checker, <a href="/docs/api/classes/llvm/coro/baseabi/#a350ba487cfc141b796c12f38ea7a9355">IsMaterializable</a>);</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> DT(<a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>);</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.ABI != <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a24aa4117da86c41684ad25742832dfa6">coro::ABI::Async</a> &amp;&amp; <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.ABI != <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380aad9d7f07127e321d1358b695c8720166">coro::ABI::Retcon</a> &amp;&amp;</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.ABI != <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a6ec6c15fe79ec2274d2c3e79ae4bcc41">coro::ABI::RetconOnce</a>)</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">    <a href="#abb3297c94836debc08248e7ae3f47582">sinkLifetimeStartMarkers</a>(<a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>, Checker, DT);</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All values (that are not allocas) that needs to be spilled to the frame.</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#a35a3966816510601e97cb071765f1ed0">coro::SpillInfo</a> Spills;</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All values defined as allocas that need to live in the frame.</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;coro::AllocaInfo, 8&gt;</a> Allocas;</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the spills for arguments and other not-materializable values.</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#aee11dcf213f8b5c3fecab6894b0b6517">coro::collectSpillsFromArgs</a>(Spills, <a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, Checker);</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> DeadInstructions;</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;CoroAllocaAllocInst &#42;, 4&gt;</a> LocalAllocas;</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#afee39cae7ff99ef86d9f4ed0ee4282f0">coro::collectSpillsAndAllocasFromInsts</a>(Spills, Allocas, DeadInstructions,</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">                                         LocalAllocas, <a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, Checker, DT, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>);</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#af6a9c51da634a8036f03c22a6036caaf">coro::collectSpillsFromDbgInfo</a>(Spills, <a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, Checker);</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a49cc8ffa2bb7e7ced148a4acb2d9ea87">dumpAllocas</a>(Allocas));</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a6f0999556f0dc8e0fb4ccec5b3e121a1">dumpSpills</a>(</span><span class="doxyHighlightStringLiteral">&quot;Spills&quot;</span><span class="doxyHighlight">, Spills));</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.ABI == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380aad9d7f07127e321d1358b695c8720166">coro::ABI::Retcon</a> || <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.ABI == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a6ec6c15fe79ec2274d2c3e79ae4bcc41">coro::ABI::RetconOnce</a> ||</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.ABI == <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380a24aa4117da86c41684ad25742832dfa6">coro::ABI::Async</a>)</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/coro/#aa725413bc28036ce9c795a24503f654b">sinkSpillUsesAfterCoroBegin</a>(DT, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.CoroBegin, Spills, Allocas);</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build frame</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">  FrameDataInfo FrameData(Spills, Allocas);</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.FrameTy = <a href="#a712c7e27f92253c99bcc20689a4e93b0">buildFrameType</a>(<a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>, FrameData, OptimizeFrame);</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.FramePtr = <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>.CoroBegin;</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For now, this works for C++ programs only.</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">  <a href="#a86c6fee36a1f17461710c01e694ee8df">buildFrameDebugInfo</a>(<a href="/docs/api/classes/llvm/coro/baseabi/#a5128305f9a3ef54320d10266e529489c">F</a>, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>, FrameData);</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert spills and reloads</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">  <a href="#af0885df5b78cc732639a9d52a87d040e">insertSpills</a>(FrameData, <a href="/docs/api/classes/llvm/coro/baseabi/#ae208c041056adf7cd77a649cadfb07c1">Shape</a>);</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">  <a href="#a36b39e8a1384a23b9899d2c9e2e08e72">lowerLocalAllocas</a>(LocalAllocas, DeadInstructions);</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DeadInstructions)</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
