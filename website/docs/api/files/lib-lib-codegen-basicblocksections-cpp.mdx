---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/basicblocksections-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `BasicBlockSections.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/BasicBlockSectionUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/BasicBlockSectionsProfileReader.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionsprofilereader-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunctionPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachinePostDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinepostdominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/Passes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/passes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetInstrInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-basicblocksections-cpp-">anonymous&#123;BasicBlockSections.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections">BasicBlockSections</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a59db5d89fd98ad566ef2159ec3450f0d">assignSections</a> (MachineFunction &amp;MF, const DenseMap&lt; UniqueBBID, BBClusterInfo &gt; &amp;FuncClusterInfo)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ae6a302780ed34373cb384b67a94940f5">INITIALIZE&#95;PASS&#95;BEGIN</a> (BasicBlockSections, &quot;bbsections-prepare&quot;, &quot;Prepares for basic block sections, by splitting functions &quot; &quot;into clusters of basic blocks.&quot;, false, false) INITIALIZE&#95;PASS&#95;END(BasicBlockSections</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>bbsections Prepares <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> basic <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> by splitting <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> into clusters of basic static false void</>}
  name={<><a href="#a927aecb431f82466a89596d4ef11608e">updateBranches</a> (MachineFunction &amp;MF, const SmallVector&lt; MachineBasicBlock &#42; &gt; &amp;PreLayoutFallThroughs)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a60aabc0aa9efc24ce6aa1ae42f363804">BBSectionsDetectSourceDrift</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>bbsections Prepares <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> basic <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> by splitting <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> into clusters of basic</>}
  name={<><a href="#a6b480a971048f2d9cc342c18046d7774">blocks</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>bbsections Prepares <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> basic <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> by splitting <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> into clusters of basic</>}
  name={<><a href="#add7ead10074b888229a003a53aca643e">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="bbsections"
  name={<><a href="#acc01b07763ec8c4b7acd6ffaa69b1c0c">prepare</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>bbsections Prepares <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> basic <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a></>}
  name={<><a href="#ad9bfff4f6c093ce614da964288d832c9">sections</a></>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### assignSections() {#a59db5d89fd98ad566ef2159ec3450f0d}

<MemberDefinition
  prototype={<>static void assignSections (<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; MF, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/structs/llvm/uniquebbid">UniqueBBID</a>, <a href="/docs/api/structs/llvm/bbclusterinfo">BBClusterInfo</a> &gt; &amp; FuncClusterInfo)</>}
  labels = {["static"]}>

Definition at line <a href="#l00188">188</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#ae6a302780ed34373cb384b67a94940f5}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (BasicBlockSections, &quot;bbsections-prepare&quot;, &quot;Prepares <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> basic <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> sections, by splitting <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> &quot; &quot;into clusters of basic blocks.&quot;, false, false)</>}>

Definition at line <a href="#l00132">132</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

### updateBranches() {#a927aecb431f82466a89596d4ef11608e}

<MemberDefinition
  prototype={<>bbsections Prepares for basic block by splitting functions into clusters of basic static false void updateBranches (<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; MF, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; &gt; &amp; PreLayoutFallThroughs)</>}
  labels = {["static"]}>

Definition at line <a href="#l00146">146</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### BBSectionsDetectSourceDrift {#a60aabc0aa9efc24ce6aa1ae42f363804}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; BBSectionsDetectSourceDrift(&quot;bbsections-detect-source-drift&quot;, cl::desc(&quot;This checks if there is a fdo instr. profile hash &quot; &quot;mismatch for this function&quot;), cl::init(true), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00096">96</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

### blocks {#a6b480a971048f2d9cc342c18046d7774}

<MemberDefinition
  prototype="split region exit SPIRV split region exit blocks">

Definition at line <a href="#l00140">140</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

### false {#add7ead10074b888229a003a53aca643e}

<MemberDefinition
  prototype="bbsections Prepares for basic block by splitting functions into clusters of basic false">

Definition at line <a href="#l00141">141</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

### prepare {#acc01b07763ec8c4b7acd6ffaa69b1c0c}

<MemberDefinition
  prototype="bbsections prepare">

Definition at line <a href="#l00138">138</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

### sections {#ad9bfff4f6c093ce614da964288d832c9}

<MemberDefinition
  prototype="bbsections Prepares for basic block sections">

Definition at line <a href="#l00139">139</a> of file <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp">BasicBlockSections.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===-- BasicBlockSections.cpp ---=========--------------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// BasicBlockSections implementation.</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// The purpose of this pass is to assign sections to basic blocks when</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// -fbasic-block-sections= option is used. Further, with profile information</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// only the subset of basic blocks with profiles are placed in separate sections</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// and the rest are grouped in a cold section. The exception handling blocks are</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// treated specially to ensure they are all in one seciton.</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">// Basic Block Sections</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">// ====================</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">// With option, -fbasic-block-sections=list, every function may be split into</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">// clusters of basic blocks. Every cluster will be emitted into a separate</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">// section with its basic blocks sequenced in the given order. To get the</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">// optimized performance, the clusters must form an optimal BB layout for the</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">// function. We insert a symbol at the beginning of every cluster&#39;s section to</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">// allow the linker to reorder the sections in any arbitrary sequence. A global</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">// order of these sections would encapsulate the function layout.</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">// For example, consider the following clusters for a function foo (consisting</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">// of 6 basic blocks 0, 1, ..., 5).</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightComment">// 0 2</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightComment">// 1 3 5</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightComment">// &#42; Basic blocks 0 and 2 are placed in one section with symbol &#96;foo&#96;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightComment">//   referencing the beginning of this section.</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightComment">// &#42; Basic blocks 1, 3, 5 are placed in a separate section. A new symbol</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightComment">//   &#96;foo.&#95;&#95;part.1&#96; will reference the beginning of this section.</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightComment">// &#42; Basic block 4 (note that it is not referenced in the list) is placed in</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightComment">//   one section, and a new symbol &#96;foo.cold&#96; will point to it.</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">// There are a couple of challenges to be addressed:</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightComment">// 1 The last basic block of every cluster should not have any implicit</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightComment">//    fallthrough to its next basic block, as it can be reordered by the linker.</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightComment">//    The compiler should make these fallthroughs explicit by adding</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightComment">//    unconditional jumps..</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightComment">// 2 All inter-cluster branch targets would now need to be resolved by the</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightComment">//    linker as they cannot be calculated during compile time. This is done</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightComment">//    using static relocations. Further, the compiler tries to use short branch</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightComment">//    instructions on some ISAs for small branch offsets. This is not possible</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightComment">//    for inter-cluster branches as the offset is not determined at compile</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightComment">//    time, and therefore, long branch instructions have to be used for those.</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightComment">// 3 Debug Information (DebugInfo) and Call Frame Information (CFI) emission</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightComment">//    needs special handling with basic block sections. DebugInfo needs to be</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightComment">//    emitted with more relocations as basic block sections can break a</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightComment">//    function into potentially several disjoint pieces, and CFI needs to be</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightComment">//    emitted per cluster. This also bloats the object file and binary sizes.</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightComment">// Basic Block Address Map</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightComment">// ==================</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightComment">// With -fbasic-block-address-map, we emit the offsets of BB addresses of</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightComment">// every function into the .llvm&#95;bb&#95;addr&#95;map section. Along with the function</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightComment">// symbols, this allows for mapping of virtual addresses in PMU profiles back to</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightComment">// the corresponding basic blocks. This logic is implemented in AsmPrinter. This</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightComment">// pass only assigns the BBSectionType of every function to &#96;&#96;labels&#96;&#96;.</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionutils-h">llvm/CodeGen/BasicBlockSectionUtils.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/basicblocksectionsprofilereader-h">llvm/CodeGen/BasicBlockSectionsProfileReader.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedominators-h">llvm/CodeGen/MachineDominators.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinepostdominators-h">llvm/CodeGen/MachinePostDominators.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/passes-h">llvm/CodeGen/Passes.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h">llvm/CodeGen/TargetInstrInfo.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightComment">// Placing the cold clusters in a separate section mitigates against poor</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightComment">// profiles and allows optimizations such as hugepage mapping to be applied at a</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightComment">// section granularity. Defaults to &quot;.text.split.&quot; which is recognized by lld</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightComment">// via the &#96;-z keep-text-section-prefix&#96; flag.</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;std::string&gt;</a> <a href="/docs/api/namespaces/llvm/#ada47e93839622848d23e6495c448161f">llvm::BBSectionsColdTextPrefix</a>(</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;bbsections-cold-text-prefix&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;The text prefix to use for cold basic block clusters&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightStringLiteral">&quot;.text.split.&quot;</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96" lineLink="#a60aabc0aa9efc24ce6aa1ae42f363804"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a60aabc0aa9efc24ce6aa1ae42f363804">BBSectionsDetectSourceDrift</a>(</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;bbsections-detect-source-drift&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;This checks if there is a fdo instr. profile hash &quot;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;mismatch for this function&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="/docs/api/namespaces/anonymous-basicblocksections-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104" lineLink="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#ad9f31ce8e3479d0eacbc2bb95fa85fc4">BasicBlockSections</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106" lineLink="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#acbc6aaea1a1079215627bfaa4d382977"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#acbc6aaea1a1079215627bfaa4d382977">ID</a>;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108" lineLink="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#a3b973ec1c722b36baf0658df50ece6e7"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderwrapperpass">BasicBlockSectionsProfileReaderWrapperPass</a> &#42;<a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#a3b973ec1c722b36baf0658df50ece6e7">BBSectionsProfileReader</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#ad9f31ce8e3479d0eacbc2bb95fa85fc4"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#ad9f31ce8e3479d0eacbc2bb95fa85fc4">BasicBlockSections</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#acbc6aaea1a1079215627bfaa4d382977">ID</a>) &#123;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa0d2314a668f0ec788a393f088eb479d">initializeBasicBlockSectionsPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#a09b69b865a65a98b12d65681b83bb8aa"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#a09b69b865a65a98b12d65681b83bb8aa">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;Basic Block Sections Analysis&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> getAnalysisUsage(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU) </span><span class="doxyHighlightKeyword">const override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightComment">  /// Identify basic blocks that need separate sections and prepare to emit them</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightComment">  /// accordingly.</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnMachineFunction(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleBBSections(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF);</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleBBAddrMap(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF);</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#acbc6aaea1a1079215627bfaa4d382977">BasicBlockSections::ID</a> = 0;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132" lineLink="#ae6a302780ed34373cb384b67a94940f5"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#ad9f31ce8e3479d0eacbc2bb95fa85fc4">BasicBlockSections</a>, </span><span class="doxyHighlightStringLiteral">&quot;bbsections-prepare&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Prepares for basic block sections, by splitting functions &quot;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;into clusters of basic blocks.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderwrapperpass">BasicBlockSectionsProfileReaderWrapperPass</a>)</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138" lineLink="#acc01b07763ec8c4b7acd6ffaa69b1c0c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#ad9f31ce8e3479d0eacbc2bb95fa85fc4">BasicBlockSections</a>, </span><span class="doxyHighlightStringLiteral">&quot;bbsections-prepare&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139" lineLink="#ad9bfff4f6c093ce614da964288d832c9"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;Prepares for basic block sections, by splitting functions &quot;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140" lineLink="#a6b480a971048f2d9cc342c18046d7774"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;into clusters of basic blocks.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141" lineLink="#add7ead10074b888229a003a53aca643e"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlightComment">// This function updates and optimizes the branching instructions of every basic</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">// block in a given function to account for changes in the layout.</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">static </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146" lineLink="#a927aecb431f82466a89596d4ef11608e"><span class="doxyHighlight"><a href="#a927aecb431f82466a89596d4ef11608e">updateBranches</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">               <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt;<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;&gt; &amp;PreLayoutFallThroughs) &#123;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a> = MF.getSubtarget().getInstrInfo();</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NextMBBI = std::next(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getIterator());</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FTMBB = PreLayoutFallThroughs&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getNumber()&#93;;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this block had a fallthrough before we need an explicit unconditional</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branch to that block if either</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     1- the block ends a section, which means its next block may be</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//        reorderd by the linker, or</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     2- the fallthrough block is not adjacent to the block in the new</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//        order.</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FTMBB &amp;&amp; (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEndSection() || &amp;&#42;NextMBBI != FTMBB))</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;insertUnconditionalBranch(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, FTMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.findBranchDebugLoc());</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We do not optimize branches for machine basic blocks ending sections, as</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// their adjacent block might be reordered by the linker.</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEndSection())</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It might be possible to optimize branches by flipping the branch</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// condition.</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;FBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// For analyzeBranch.</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.updateTerminator(FTMBB);</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlightComment">// This function sorts basic blocks according to the cluster&#39;s information.</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlightComment">// All explicitly specified clusters of basic blocks will be ordered</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlightComment">// accordingly. All non-specified BBs go into a separate &quot;Cold&quot; section.</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlightComment">// Additionally, if exception handling landing pads end up in more than one</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlightComment">// clusters, they are moved into a single &quot;Exception&quot; section. Eventually,</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlightComment">// clusters are ordered in increasing order of their IDs, with the &quot;Exception&quot;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlightComment">// and &quot;Cold&quot; succeeding all other clusters.</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlightComment">// FuncClusterInfo represents the cluster information for basic blocks. It</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlightComment">// maps from BBID of basic blocks to their cluster information. If this is</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlightComment">// empty, it means unique sections for all basic blocks in the function.</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188" lineLink="#a59db5d89fd98ad566ef2159ec3450f0d"><span class="doxyHighlight"><a href="#a59db5d89fd98ad566ef2159ec3450f0d">assignSections</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;UniqueBBID, BBClusterInfo&gt;</a> &amp;FuncClusterInfo) &#123;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a74e97fc3012191edf10e8c51291da4a7">hasBBSections</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;BB Sections is not set for function.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This variable stores the section ID of the cluster containing eh&#95;pads (if</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all eh&#95;pads are one cluster). If more than one cluster contain eh&#95;pads, we</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// set it equal to ExceptionSectionID.</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">  std::optional&lt;MBBSectionID&gt; EHPadsSectionID;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// With the &#39;all&#39; option, every basic block is placed in a unique section.</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// With the &#39;list&#39; option, every basic block is placed in a section</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// associated with its cluster, unless we want individual unique sections</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for every basic block in this function (if FuncClusterInfo is empty).</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afab3c5f91842d5dd9f6aaf78a1ff34a9">getBBSectionsType</a>() == <a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8ab1c94ca2fbc3e78fc30069c8d0f01680">llvm::BasicBlockSection::All</a> ||</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">        FuncClusterInfo.<a href="/docs/api/classes/llvm/densemapbase/#a49c487a9395a6c384be8544cfb2cfccf">empty</a>()) &#123;</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If unique sections are desired for all basic blocks of the function, we</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// set every basic block&#39;s section ID equal to its original position in</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the layout (which is equal to its number). This ensures that basic</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// blocks are ordered canonically.</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.setSectionID(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getNumber());</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = FuncClusterInfo.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getBBID());</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != FuncClusterInfo.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.setSectionID(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.ClusterID);</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a> =</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">            &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent()-&gt;getSubtarget().getInstrInfo();</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>.isMBBSafeToSplitToCold(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &#123;</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// BB goes into the special cold section if it is not specified in the</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// cluster info map.</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.setSectionID(<a href="/docs/api/structs/llvm/mbbsectionid/#a2cbbe04f568b5890eeb2b58c0cbf6d71">MBBSectionID::ColdSectionID</a>);</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEHPad() &amp;&amp; EHPadsSectionID != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getSectionID() &amp;&amp;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">        EHPadsSectionID != <a href="/docs/api/structs/llvm/mbbsectionid/#a27940a53407c67036b8292fa9bf4721d">MBBSectionID::ExceptionSectionID</a>) &#123;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we already have one cluster containing eh&#95;pads, this must be updated</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to ExceptionSectionID. Otherwise, we set it equal to the current</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// section ID.</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">      EHPadsSectionID = EHPadsSectionID ? <a href="/docs/api/structs/llvm/mbbsectionid/#a27940a53407c67036b8292fa9bf4721d">MBBSectionID::ExceptionSectionID</a></span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">                                        : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getSectionID();</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If EHPads are in more than one section, this places all of them in the</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// special exception section.</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EHPadsSectionID == <a href="/docs/api/structs/llvm/mbbsectionid/#a27940a53407c67036b8292fa9bf4721d">MBBSectionID::ExceptionSectionID</a>)</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF)</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEHPad())</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.setSectionID(&#42;EHPadsSectionID);</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242" lineLink="/docs/api/namespaces/llvm/#afad2bbe677ba3de73946c95070c7cdb1"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#afad2bbe677ba3de73946c95070c7cdb1">llvm::sortBasicBlocksAndUpdateBranches</a>(</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF, <a href="/docs/api/namespaces/llvm/#aed739b3ed37812f00feeec05c0c89c8a">MachineBasicBlockComparator</a> MBBCmp) &#123;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">  &#91;&#91;maybe&#95;unused&#93;&#93; </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;EntryBlock = &amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#ac8ca28de0f4dcee651340e7ef0c45233">front</a>();</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;&gt;</a> PreLayoutFallThroughs(MF.<a href="/docs/api/classes/llvm/machinefunction/#aa22424ba23740b6a748e8d0c239b7e4c">getNumBlockIDs</a>());</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF)</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    PreLayoutFallThroughs&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getNumber()&#93; =</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getFallThrough(</span><span class="doxyHighlightComment">/&#42;JumpToFallThrough=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#abec99bdadc37a927560bd49cda61b5a1">sort</a>(MBBCmp);</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#ac8ca28de0f4dcee651340e7ef0c45233">front</a>() == EntryBlock &amp;&amp;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Entry block should not be displaced by basic block sections&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set IsBeginSection and IsEndSection according to the assigned section IDs.</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#af588c66ab3fcfe66fd0c99bcd645ee36">assignBeginEndSections</a>();</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After reordering basic blocks, we must update basic block branches to</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// insert explicit fallthrough branches when required and optimize branches</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when possible.</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  <a href="#a927aecb431f82466a89596d4ef11608e">updateBranches</a>(MF, PreLayoutFallThroughs);</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlightComment">// If the exception section begins with a landing pad, that landing pad will</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlightComment">// assume a zero offset (relative to @LPStart) in the LSDA. However, a value of</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlightComment">// zero implies &quot;no landing pad.&quot; This function inserts a NOP just before the EH</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlightComment">// pad label to ensure a nonzero offset.</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267" lineLink="/docs/api/namespaces/llvm/#ad42ea8aa2115313dc7f1b793b049e0b1"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ad42ea8aa2115313dc7f1b793b049e0b1">llvm::avoidZeroOffsetLandingPad</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isBeginSection() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isEHPad()) &#123;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin();</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;isEHLabel())</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#acd858ed72f11db9444617740c3622608">getInstrInfo</a>()-&gt;<a href="/docs/api/classes/llvm/targetinstrinfo/#a4ee57d5d6295dfeb44f3b55301b20020">insertNoop</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278" lineLink="/docs/api/namespaces/llvm/#a9758dcba3499ba13d2756537ffe9474b"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a9758dcba3499ba13d2756537ffe9474b">llvm::hasInstrProfHashMismatch</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a60aabc0aa9efc24ce6aa1ae42f363804">BBSectionsDetectSourceDrift</a>)</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> MetadataName&#91;&#93; = </span><span class="doxyHighlightStringLiteral">&quot;instr&#95;prof&#95;hash&#95;mismatch&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Existing = MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/globalobject/#aef569d822dbf572ae71954d6831ce8a9">getMetadata</a>(LLVMContext::MD&#95;annotation);</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Existing) &#123;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdtuple">MDTuple</a> &#42;Tuple = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDTuple&gt;</a>(Existing);</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> : Tuple-&gt;operands())</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>.equalsStr(MetadataName))</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlightComment">// Identify, arrange, and modify basic blocks which need separate sections</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlightComment">// according to the specification provided by the -fbasic-block-sections flag.</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BasicBlockSections::handleBBSections(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBSectionsType = MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#afab3c5f91842d5dd9f6aaf78a1ff34a9">getBBSectionsType</a>();</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBSectionsType == <a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8a6adf97f83acf6453d4a6a4b1070f3754">BasicBlockSection::None</a>)</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for source drift. If the source has changed since the profiles</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// were obtained, optimizing basic blocks might be sub-optimal.</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This only applies to BasicBlockSection::List as it creates</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// clusters of basic blocks using basic block ids. Source drift can</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// invalidate these groupings leading to sub-optimal code generation with</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// regards to performance.</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBSectionsType == <a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8a4ee29ca12c7d126654bd0e5275de6135">BasicBlockSection::List</a> &amp;&amp;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a9758dcba3499ba13d2756537ffe9474b">hasInstrProfHashMismatch</a>(MF))</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Renumber blocks before sorting them. This is useful for accessing the</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// original layout positions and finding the original fallthroughs.</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#ac85349aab432e6b7d8b2e8926048a6de">RenumberBlocks</a>();</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;UniqueBBID, BBClusterInfo&gt;</a> FuncClusterInfo;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBSectionsType == <a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8a4ee29ca12c7d126654bd0e5275de6135">BasicBlockSection::List</a>) &#123;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;HasProfile, ClusterInfo&#93; =</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">        getAnalysis&lt;BasicBlockSectionsProfileReaderWrapperPass&gt;()</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">            .getClusterInfoForFunction(MF.<a href="/docs/api/classes/llvm/machinefunction/#a3d142c9e7c066059e15232c56dec9e2e">getName</a>());</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasProfile)</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/structs/llvm/bbclusterinfo">BBClusterInfo</a> : ClusterInfo) &#123;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">      FuncClusterInfo.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(<a href="/docs/api/structs/llvm/bbclusterinfo">BBClusterInfo</a>.<a href="/docs/api/structs/llvm/bbclusterinfo/#a856e22c7d8c576f4628291689b605620">BBID</a>, <a href="/docs/api/structs/llvm/bbclusterinfo">BBClusterInfo</a>);</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#a0b33ee771a8f9b7f684ffd266040d89f">setBBSectionsType</a>(BBSectionsType);</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">  <a href="#a59db5d89fd98ad566ef2159ec3450f0d">assignSections</a>(MF, FuncClusterInfo);</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;EntryBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#ac8ca28de0f4dcee651340e7ef0c45233">front</a>();</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EntryBBSectionID = EntryBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a87ee39ccabd6fa5abe6302ebffd768c9">getSectionID</a>();</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Helper function for ordering BB sections as follows:</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#42; Entry section (section including the entry block).</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#42; Regular sections (in increasing order of their Number).</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ...</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#42; Exception section</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#42; Cold section</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MBBSectionOrder = &#91;EntryBBSectionID&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/mbbsectionid">MBBSectionID</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/mbbsectionid">MBBSectionID</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We make sure that the section containing the entry block precedes all the</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other sections.</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == EntryBBSectionID || <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> == EntryBBSectionID)</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == EntryBBSectionID;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.Type == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.Type ? <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.Number &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.Number : <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.Type &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.Type;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We sort all basic blocks to make sure the basic blocks of every cluster are</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// contiguous and ordered accordingly. Furthermore, clusters are ordered in</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// increasing order of their section IDs, with the exception and the</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cold section placed at the end of the function.</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Also, we force the entry block of the function to be placed at the</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// beginning of the function, regardless of the requested order.</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Comparator = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>,</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &#123;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> XSectionID = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.getSectionID();</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> YSectionID = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>.getSectionID();</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XSectionID != YSectionID)</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MBBSectionOrder(XSectionID, YSectionID);</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure that the entry block is placed at the beginning.</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> == &amp;EntryBB || &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> == &amp;EntryBB)</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> == &amp;EntryBB;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the two basic block are in the same section, the order is decided by</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// their position within the section.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XSectionID.Type == <a href="/docs/api/structs/llvm/mbbsectionid/#ab1720aee7515c00604560487e182f97badc9d167ee49f96cf4b146959849eac66">MBBSectionID::SectionType::Default</a>)</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FuncClusterInfo.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(&#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.getBBID()).PositionInCluster &lt;</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">             FuncClusterInfo.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(&#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>.getBBID()).PositionInCluster;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.getNumber() &lt; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>.getNumber();</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#afad2bbe677ba3de73946c95070c7cdb1">sortBasicBlocksAndUpdateBranches</a>(MF, Comparator);</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ad42ea8aa2115313dc7f1b793b049e0b1">avoidZeroOffsetLandingPad</a>(MF);</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlightComment">// When the BB address map needs to be generated, this renumbers basic blocks to</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlightComment">// make them appear in increasing order of their IDs in the function. This</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlightComment">// avoids the need to store basic block IDs in the BB address map section, since</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlightComment">// they can be determined implicitly.</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BasicBlockSections::handleBBAddrMap(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#ab1fb67187fc37e569cc5171cbebba873">Options</a>.<a href="/docs/api/classes/llvm/targetoptions/#a4602186a8472e7bff53bd7a433b521e4">BBAddrMap</a>)</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#ac85349aab432e6b7d8b2e8926048a6de">RenumberBlocks</a>();</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386" lineLink="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#a977d864b83223a6ae106ddc332dba144"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#a977d864b83223a6ae106ddc332dba144">BasicBlockSections::runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First handle the basic block sections.</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> R1 = handleBBSections(MF);</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle basic block address map after basic block sections are finalized.</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h/#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> = handleBBAddrMap(MF);</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We renumber blocks, so update the dominator tree we want to preserve.</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WP = <a href="/docs/api/classes/llvm/pass/#af94c014e968489e96c7d4353a84ad7f5">getAnalysisIfAvailable&lt;MachineDominatorTreeWrapperPass&gt;</a>())</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">    WP-&gt;getDomTree().updateBlockNumbers();</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WP = <a href="/docs/api/classes/llvm/pass/#af94c014e968489e96c7d4353a84ad7f5">getAnalysisIfAvailable&lt;MachinePostDominatorTreeWrapperPass&gt;</a>())</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">    WP-&gt;getPostDomTree().updateBlockNumbers();</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R1 || <a href="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h/#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a>;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401" lineLink="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#af2caf856b1f9546f0855b33391857973"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#af2caf856b1f9546f0855b33391857973">BasicBlockSections::getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  AU.<a href="/docs/api/classes/llvm/analysisusage/#af22b06a6a4f9df80454071685a0d6a02">setPreservesAll</a>();</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/basicblocksectionsprofilereaderwrapperpass">BasicBlockSectionsProfileReaderWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  AU.<a href="/docs/api/classes/llvm/analysisusage/#aaeddaf79040291b6f3e0db57943aac39">addUsedIfAvailable</a>&lt;<a href="/docs/api/classes/llvm/machinedominatortreewrapperpass">MachineDominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  AU.<a href="/docs/api/classes/llvm/analysisusage/#aaeddaf79040291b6f3e0db57943aac39">addUsedIfAvailable</a>&lt;<a href="/docs/api/classes/llvm/machinepostdominatortreewrapperpass">MachinePostDominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409" lineLink="/docs/api/namespaces/llvm/#a2faa277005be0bd935477313247f9a6b"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machinefunctionpass">MachineFunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm/#a2faa277005be0bd935477313247f9a6b">llvm::createBasicBlockSectionsPass</a>() &#123;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-basicblocksections-cpp-/basicblocksections/#ad9f31ce8e3479d0eacbc2bb95fa85fc4">BasicBlockSections</a>();</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
