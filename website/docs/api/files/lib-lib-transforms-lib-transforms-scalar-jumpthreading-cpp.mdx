---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `JumpThreading.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Scalar/JumpThreading.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/jumpthreading-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BranchProbabilityInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ConstantFolding.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GlobalsModRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GuardUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/guardutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LazyValueInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/lazyvalueinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/Loads.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemoryLocation.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memorylocation-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/PostDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/postdominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ConstantRange.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ProfDataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BlockFrequency.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Cloning.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SSAUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ssaupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ValueMapper.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/valuemapper-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a77ce0ad30f134042ba819a49315238d8">addPHINodeEntriesForMappedBlock</a> (BasicBlock &#42;PHIBB, BasicBlock &#42;OldPred, BasicBlock &#42;NewPred, ValueToValueMapTy &amp;ValueMap)</>}>
addPHINodeEntriesForMappedBlock - We&#39;re adding &#39;NewPred&#39; as a new predecessor to the PHIBB block. <a href="#a77ce0ad30f134042ba819a49315238d8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</>}
  name={<><a href="#a784829cd61b59ff78b262cfeb52bea9b">findMostPopularDest</a> (BasicBlock &#42;BB, const SmallVectorImpl&lt; std::pair&lt; BasicBlock &#42;, BasicBlock &#42; &gt; &gt; &amp;PredToDestList)</>}>
findMostPopularDest - The specified list contains multiple possible threadable destinations. <a href="#a784829cd61b59ff78b262cfeb52bea9b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a089d9b5caf2479e6b87f94c73e5b1f70">getBestDestForJumpOnUndef</a> (BasicBlock &#42;BB)</>}>
GetBestDestForBranchOnUndef - If we determine that the specified block ends in an undefined jump, decide which block is best to revector to. <a href="#a089d9b5caf2479e6b87f94c73e5b1f70">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a65facbdd55e486cbcef04a12de132c9c">getJumpThreadDuplicationCost</a> (const TargetTransformInfo &#42;TTI, BasicBlock &#42;BB, Instruction &#42;StopAt, unsigned Threshold)</>}>
Return the cost of duplicating a piece of this block from first non-phi and before StopAt instruction to thread across it. <a href="#a65facbdd55e486cbcef04a12de132c9c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</>}
  name={<><a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a> (Value &#42;Val, ConstantPreference Preference)</>}>
getKnownConstant - Helper method to determine if we can thread over a terminator with the given value as its condition, and if so what value to use for that. <a href="#a7dd0ca6accd47d876a191473b33feacb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae6fa18c5b7272e2bdd00c26da8041358">hasAddressTakenAndUsed</a> (BasicBlock &#42;BB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad67c03658611a6ae7dc39f84346f18bd">isOpDefinedInBlock</a> (Value &#42;Op, BasicBlock &#42;BB)</>}>
Return true if <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> is an instruction defined in the given block. <a href="#ad67c03658611a6ae7dc39f84346f18bd">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0e7841803a620fb47c7cd3086debaf54">replaceFoldableUses</a> (Instruction &#42;Cond, Value &#42;ToVal, BasicBlock &#42;KnownAtEndOfBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a47e236c06b4266b70935906c4fdac68e">STATISTIC</a> (NumThreads, &quot;Number of jumps threaded&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ae1a8a5d21a7cec4dfe351279ae944f73">STATISTIC</a> (NumFolds, &quot;Number of terminators folded&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a474043c88ee1bf318e0a04d7698e989f">STATISTIC</a> (NumDupes, &quot;Number of branch blocks duplicated to eliminate phi&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae5a9dfd216e7560889e2366f34ddd9f1">updatePredecessorProfileMetadata</a> (PHINode &#42;PN, BasicBlock &#42;BB)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a173d0a748cab1f97fe3ac99cfc24e033">BBDuplicateThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a863fab1a863c22322d683b7b34d0b6ba">ImplicationSearchThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a0d09015dce7d16b0d2387c1e053d6159">PhiDuplicateThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a18cca5bbfb2aaa3839657074a59beb5c">ThreadAcrossLoopHeaders</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;jump-threading&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### addPHINodeEntriesForMappedBlock() {#a77ce0ad30f134042ba819a49315238d8}

<MemberDefinition
  prototype={<>static void addPHINodeEntriesForMappedBlock (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PHIBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; OldPred, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; NewPred, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp; ValueMap)</>}
  labels = {["static"]}>
addPHINodeEntriesForMappedBlock - We&#39;re adding &#39;NewPred&#39; as a new predecessor to the PHIBB block.

If it has PHI nodes, add entries for NewPred using the entries from OldPred (suitably mapped).

Definition at line <a href="#l01867">1867</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### findMostPopularDest() {#a784829cd61b59ff78b262cfeb52bea9b}

<MemberDefinition
  prototype={<>static BasicBlock &#42; findMostPopularDest (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; PredToDestList)</>}
  labels = {["static"]}>
findMostPopularDest - The specified list contains multiple possible threadable destinations.

Pick the one that occurs the most frequently in the list.

Definition at line <a href="#l01466">1466</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### getBestDestForJumpOnUndef() {#a089d9b5caf2479e6b87f94c73e5b1f70}

<MemberDefinition
  prototype={<>static unsigned getBestDestForJumpOnUndef (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
GetBestDestForBranchOnUndef - If we determine that the specified block ends in an undefined jump, decide which block is best to revector to.

Since we can pick an arbitrary destination, we pick the successor with the fewest predecessors. This should reduce the in-degree of the others.

Definition at line <a href="#l00918">918</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### getJumpThreadDuplicationCost() {#a65facbdd55e486cbcef04a12de132c9c}

<MemberDefinition
  prototype={<>static unsigned getJumpThreadDuplicationCost (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; StopAt, unsigned Threshold)</>}
  labels = {["static"]}>
Return the cost of duplicating a piece of this block from first non-phi and before StopAt instruction to thread across it.

Stop scanning the block when exceeding the threshold. If duplication is impossible, returns ~0U.

Definition at line <a href="#l00426">426</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### getKnownConstant() {#a7dd0ca6accd47d876a191473b33feacb}

<MemberDefinition
  prototype={<>static Constant &#42; getKnownConstant (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0">ConstantPreference</a> Preference)</>}
  labels = {["static"]}>
getKnownConstant - Helper method to determine if we can thread over a terminator with the given value as its condition, and if so what value to use for that.

What kind of value this is depends on whether we want an integer or a block address, but an undef is always accepted. Returns null if Val is null or not an appropriate constant.

Definition at line <a href="#l00538">538</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### hasAddressTakenAndUsed() {#ae6fa18c5b7272e2bdd00c26da8041358}

<MemberDefinition
  prototype={<>static bool hasAddressTakenAndUsed (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>

Definition at line <a href="#l00936">936</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### isOpDefinedInBlock() {#ad67c03658611a6ae7dc39f84346f18bd}

<MemberDefinition
  prototype={<>static bool isOpDefinedInBlock (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Op, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
Return true if <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> is an instruction defined in the given block.

Definition at line <a href="#l01211">1211</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### replaceFoldableUses() {#a0e7841803a620fb47c7cd3086debaf54}

<MemberDefinition
  prototype={<>static bool replaceFoldableUses (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Cond, <a href="/docs/api/classes/llvm/value">Value</a> &#42; ToVal, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; KnownAtEndOfBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l00392">392</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a47e236c06b4266b70935906c4fdac68e}

<MemberDefinition
  prototype={<>STATISTIC (NumThreads, &quot;Number of jumps threaded&quot;)</>}>

Definition at line <a href="#l00082">82</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ae1a8a5d21a7cec4dfe351279ae944f73}

<MemberDefinition
  prototype={<>STATISTIC (NumFolds, &quot;Number of terminators folded&quot;)</>}>

Definition at line <a href="#l00083">83</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a474043c88ee1bf318e0a04d7698e989f}

<MemberDefinition
  prototype={<>STATISTIC (NumDupes, &quot;Number of branch <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a> duplicated to eliminate phi&quot;)</>}>

Definition at line <a href="#l00084">84</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### updatePredecessorProfileMetadata() {#ae5a9dfd216e7560889e2366f34ddd9f1}

<MemberDefinition
  prototype={<>static void updatePredecessorProfileMetadata (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>

Definition at line <a href="#l00147">147</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### BBDuplicateThreshold {#a173d0a748cab1f97fe3ac99cfc24e033}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; BBDuplicateThreshold(&quot;jump-threading-threshold&quot;, cl::desc(&quot;Max block size to duplicate for jump threading&quot;), cl::init(6), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00087">87</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### ImplicationSearchThreshold {#a863fab1a863c22322d683b7b34d0b6ba}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ImplicationSearchThreshold(&quot;jump-threading-implication-search-threshold&quot;, cl::desc(&quot;The number of predecessors to search for a stronger &quot; &quot;condition to use to thread over a weaker condition&quot;), cl::init(3), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00092">92</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### PhiDuplicateThreshold {#a0d09015dce7d16b0d2387c1e053d6159}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; PhiDuplicateThreshold(&quot;jump-threading-phi-threshold&quot;, cl::desc(&quot;Max PHIs in BB to duplicate for jump threading&quot;), cl::init(76), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00098">98</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

### ThreadAcrossLoopHeaders {#a18cca5bbfb2aaa3839657074a59beb5c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ThreadAcrossLoopHeaders(&quot;jump-threading-across-loop-headers&quot;, cl::desc(&quot;Allow JumpThreading to thread across loop headers, for testing&quot;), cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00103">103</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;jump-threading&quot;</>}>

Definition at line <a href="#l00080">80</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/jumpthreading-cpp">JumpThreading.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- JumpThreading.cpp - Thread control through conditional blocks ------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file implements the Jump Threading pass.</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/jumpthreading-h">llvm/Transforms/Scalar/JumpThreading.h</a>&quot;</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h">llvm/Analysis/AliasAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h">llvm/Analysis/BranchProbabilityInfo.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h">llvm/Analysis/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h">llvm/Analysis/ConstantFolding.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h">llvm/Analysis/GlobalsModRef.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/guardutils-h">llvm/Analysis/GuardUtils.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/lazyvalueinfo-h">llvm/Analysis/LazyValueInfo.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h">llvm/Analysis/Loads.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memorylocation-h">llvm/Analysis/MemoryLocation.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/postdominators-h">llvm/Analysis/PostDominators.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h">llvm/IR/ConstantRange.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h">llvm/IR/ProfDataUtils.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h">llvm/Support/BlockFrequency.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h">llvm/Transforms/Utils/Cloning.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/ssaupdater-h">llvm/Transforms/Utils/SSAUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/valuemapper-h">llvm/Transforms/Utils/ValueMapper.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &lt;memory&gt;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/jumpthreading">jumpthreading</a>;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;jump-threading&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82" lineLink="#a47e236c06b4266b70935906c4fdac68e"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumThreads, </span><span class="doxyHighlightStringLiteral">&quot;Number of jumps threaded&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83" lineLink="#ae1a8a5d21a7cec4dfe351279ae944f73"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFolds,   </span><span class="doxyHighlightStringLiteral">&quot;Number of terminators folded&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84" lineLink="#a474043c88ee1bf318e0a04d7698e989f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDupes,   </span><span class="doxyHighlightStringLiteral">&quot;Number of branch blocks duplicated to eliminate phi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="#a173d0a748cab1f97fe3ac99cfc24e033"><span class="doxyHighlight"><a href="#a173d0a748cab1f97fe3ac99cfc24e033">BBDuplicateThreshold</a>(</span><span class="doxyHighlightStringLiteral">&quot;jump-threading-threshold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max block size to duplicate for jump threading&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(6), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92" lineLink="#a863fab1a863c22322d683b7b34d0b6ba"><span class="doxyHighlight"><a href="#a863fab1a863c22322d683b7b34d0b6ba">ImplicationSearchThreshold</a>(</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">  </span><span class="doxyHighlightStringLiteral">&quot;jump-threading-implication-search-threshold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;The number of predecessors to search for a stronger &quot;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;condition to use to thread over a weaker condition&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(3), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="#a0d09015dce7d16b0d2387c1e053d6159"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a0d09015dce7d16b0d2387c1e053d6159">PhiDuplicateThreshold</a>(</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;jump-threading-phi-threshold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max PHIs in BB to duplicate for jump threading&quot;</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(76),</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103" lineLink="#a18cca5bbfb2aaa3839657074a59beb5c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a18cca5bbfb2aaa3839657074a59beb5c">ThreadAcrossLoopHeaders</a>(</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;jump-threading-across-loop-headers&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow JumpThreading to thread across loop headers, for testing&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a3cd21bd06a36557dd863c554b7b10205"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/jumpthreadingpass/#a3cd21bd06a36557dd863c554b7b10205">JumpThreadingPass::JumpThreadingPass</a>(</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>) &#123;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">  DefaultBBDupThreshold = (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> == -1) ? <a href="#a173d0a748cab1f97fe3ac99cfc24e033">BBDuplicateThreshold</a> : unsigned(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightComment">// Update branch probability information according to conditional</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlightComment">// branch probability. This is usually made possible for cloned branches</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlightComment">// in inline instances by the context specific profile in the caller.</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlightComment">// For instance,</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlightComment">//  &#91;Block PredBB&#93;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightComment">//  &#91;Branch PredBr&#93;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlightComment">//  if (t) &#123;</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightComment">//     Block A;</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightComment">//  &#125; else &#123;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlightComment">//     Block B;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlightComment">//  &#125;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlightComment">//  &#91;Block BB&#93;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightComment">//  cond = PN(&#91;true, %A&#93;, &#91;..., %B&#93;); // PHI node</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightComment">//  &#91;Branch CondBr&#93;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightComment">//  if (cond) &#123;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightComment">//    ...  // P(cond == true) = 1%</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightComment">//  &#125;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlightComment">//  Here we know that when block A is taken, cond must be true, which means</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightComment">//      P(cond == true | A) = 1</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlightComment">//  Given that P(cond == true) = P(cond == true | A) &#42; P(A) +</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlightComment">//                               P(cond == true | B) &#42; P(B)</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlightComment">//  we get:</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlightComment">//     P(cond == true ) = P(A) + P(cond == true | B) &#42; P(B)</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlightComment">//  which gives us:</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlightComment">//     P(A) is less than P(cond == true), i.e.</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlightComment">//     P(t == true) &lt;= P(cond == true)</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">//  In other words, if we know P(cond == true) is unlikely, we know</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightComment">//  that P(t == true) is also unlikely.</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147" lineLink="#ae5a9dfd216e7560889e2366f34ddd9f1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ae5a9dfd216e7560889e2366f34ddd9f1">updatePredecessorProfileMetadata</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;CondBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CondBr)</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">  uint64&#95;t TrueWeight, FalseWeight;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;CondBr, TrueWeight, FalseWeight))</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueWeight + FalseWeight == 0)</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Zero branch&#95;weights do not give a hint for getting branch probabilities.</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Technically it would result in division by zero denominator, which is</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TrueWeight + FalseWeight.</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns the outgoing edge of the dominating predecessor block</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that leads to the PhiNode&#39;s incoming block:</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetPredOutEdge =</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">      &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncomingBB,</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PhiBB) -&gt; std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt; &#123;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredBB = IncomingBB;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SuccBB = PhiBB;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> Visited;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PredBB-&gt;getTerminator());</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBr &amp;&amp; PredBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>())</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;PredBB, SuccBB&#125;;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">      Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PredBB);</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SinglePredBB = PredBB-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SinglePredBB)</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Stop searching when SinglePredBB has been visited. It means we see</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// an unreachable loop.</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(SinglePredBB))</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">      SuccBB = PredBB;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">      PredBB = SinglePredBB;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;PhiOpnd = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i);</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(PhiOpnd);</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI || !CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(1))</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> BP =</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">        (CI-&gt;<a href="/docs/api/classes/llvm/constantint/#a244bfbe5aae876e56cf5e62f0f27867a">isOne</a>() ? <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">                           TrueWeight, TrueWeight + FalseWeight)</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">                     : <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">                           FalseWeight, TrueWeight + FalseWeight));</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PredOutEdge = GetPredOutEdge(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i), BB);</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredOutEdge.first)</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = PredOutEdge.first;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredBr)</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">    uint64&#95;t PredTrueWeight, PredFalseWeight;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: We currently only set the profile data when it is missing.</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// With PGO, this can be used to refine even existing profile data with</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// context information. This needs to be done after more performance</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// testing.</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;PredBr, PredTrueWeight, PredFalseWeight))</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can not infer anything useful when BP &gt;= 50%, because BP is the</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// upper bound probability value.</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BP &gt;= <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(50, 100))</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    uint32&#95;t Weights&#91;2&#93;;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == PredOutEdge.second) &#123;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">      Weights&#91;0&#93; = BP.<a href="/docs/api/classes/llvm/branchprobability/#a7be5759bf75c903d1695fa97eca6f139">getNumerator</a>();</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">      Weights&#91;1&#93; = BP.<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>().<a href="/docs/api/classes/llvm/branchprobability/#a7be5759bf75c903d1695fa97eca6f139">getNumerator</a>();</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">      Weights&#91;0&#93; = BP.<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>().<a href="/docs/api/classes/llvm/branchprobability/#a7be5759bf75c903d1695fa97eca6f139">getNumerator</a>();</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">      Weights&#91;1&#93; = BP.<a href="/docs/api/classes/llvm/branchprobability/#a7be5759bf75c903d1695fa97eca6f139">getNumerator</a>();</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(&#42;PredBr, Weights, <a href="/docs/api/namespaces/llvm/#a4a3bd60427b33355559566bdec3c9f90">hasBranchWeightOrigin</a>(&#42;PredBr));</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a48dd43ef05b66261790497edbdac92d9"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a48dd43ef05b66261790497edbdac92d9">JumpThreadingPass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;F,</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">                                         <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;TTI = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(F);</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Jump Threading has no sense for the targets with divergent CF</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TTI.hasBranchDivergence(&amp;F))</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;TLI = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;(F);</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LVI = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/lazyvalueanalysis">LazyValueAnalysis</a>&gt;(F);</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;AA = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/aamanager">AAManager</a>&gt;(F);</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;DT = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(F);</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> =</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/jumpthreadingpass/#a5b6fe6d57aa5475337994b0daec8cc54">runImpl</a>(F, &amp;AM, &amp;TLI, &amp;TTI, &amp;LVI, &amp;AA,</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">              std::make&#95;unique&lt;DomTreeUpdater&gt;(</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">                  &amp;DT, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DomTreeUpdater::UpdateStrategy::Lazy),</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">              std::nullopt, std::nullopt);</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#a83a7d77e1a11d106eb7e583f5e33f745">getDomTreeUpdater</a>()-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a43c80a160270d75d99cfeb080c165694">flush</a>();</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlightPreprocessor">#if defined(EXPENSIVE&#95;CHECKS)</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/jumpthreadingpass/#a83a7d77e1a11d106eb7e583f5e33f745">getDomTreeUpdater</a>()-&gt;getDomTree().<a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a>(</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">             DominatorTree::VerificationLevel::Full) &amp;&amp;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;DT broken after JumpThreading&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/classes/llvm/jumpthreadingpass/#a83a7d77e1a11d106eb7e583f5e33f745">getDomTreeUpdater</a>()-&gt;hasPostDomTree() ||</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/jumpthreadingpass/#a83a7d77e1a11d106eb7e583f5e33f745">getDomTreeUpdater</a>()-&gt;getPostDomTree().<a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a>(</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">              PostDominatorTree::VerificationLevel::Full)) &amp;&amp;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;PDT broken after JumpThreading&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightPreprocessor">#else</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/jumpthreadingpass/#a83a7d77e1a11d106eb7e583f5e33f745">getDomTreeUpdater</a>()-&gt;getDomTree().<a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a>(</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">             DominatorTree::VerificationLevel::Fast) &amp;&amp;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;DT broken after JumpThreading&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/classes/llvm/jumpthreadingpass/#a83a7d77e1a11d106eb7e583f5e33f745">getDomTreeUpdater</a>()-&gt;hasPostDomTree() ||</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/jumpthreadingpass/#a83a7d77e1a11d106eb7e583f5e33f745">getDomTreeUpdater</a>()-&gt;getPostDomTree().<a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcctrloopsverify-cpp/#a593cc2f204f7b2edc16ee222c37c3196">verify</a>(</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">              PostDominatorTree::VerificationLevel::Fast)) &amp;&amp;</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;PDT broken after JumpThreading&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getPreservedAnalysis();</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a5b6fe6d57aa5475337994b0daec8cc54"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a5b6fe6d57aa5475337994b0daec8cc54">JumpThreadingPass::runImpl</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;F&#95;, <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &#42;FAM&#95;,</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI&#95;,</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI&#95;, <a href="/docs/api/classes/llvm/lazyvalueinfo">LazyValueInfo</a> &#42;LVI&#95;,</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">                                <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42;AA&#95;,</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">                                std::unique&#95;ptr&lt;DomTreeUpdater&gt; DTU&#95;,</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">                                std::optional&lt;BlockFrequencyInfo &#42;&gt; BFI&#95;,</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">                                std::optional&lt;BranchProbabilityInfo &#42;&gt; BPI&#95;) &#123;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Jump threading on function &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; F&#95;.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">  F = &amp;F&#95;;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  FAM = FAM&#95;;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  TLI = TLI&#95;;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  TTI = TTI&#95;;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  LVI = LVI&#95;;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  AA = AA&#95;;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">  DTU = std::move(DTU&#95;);</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">  BFI = BFI&#95;;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">  BPI = BPI&#95;;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GuardDecl = <a href="/docs/api/namespaces/llvm/intrinsic/#aa1731508126b77035ab3ba9d71d5374b">Intrinsic::getDeclarationIfExists</a>(</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">      F-&gt;getParent(), Intrinsic::experimental&#95;guard);</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">  HasGuards = GuardDecl &amp;&amp; !GuardDecl-&gt;use&#95;empty();</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reduce the number of instructions duplicated when optimizing strictly for</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size.</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a173d0a748cab1f97fe3ac99cfc24e033">BBDuplicateThreshold</a>.getNumOccurrences())</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">    BBDupThreshold = <a href="#a173d0a748cab1f97fe3ac99cfc24e033">BBDuplicateThreshold</a>;</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (F-&gt;hasFnAttribute(Attribute::MinSize))</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    BBDupThreshold = 3;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">    BBDupThreshold = DefaultBBDupThreshold;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// JumpThreading must not processes blocks unreachable from entry. It&#39;s a</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// waste of compute time and can potentially lead to hangs.</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> Unreachable;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DTU &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;DTU isn&#39;t passed into JumpThreading before using it.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DTU-&gt;hasDomTree() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;JumpThreading relies on DomTree to proceed.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT = DTU-&gt;getDomTree();</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : &#42;F)</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT.<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(&amp;BB))</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">      Unreachable.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;BB);</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a18cca5bbfb2aaa3839657074a59beb5c">ThreadAcrossLoopHeaders</a>)</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/jumpthreadingpass/#a29e73c6c256c3fbdd7dacf8095210d5b">findLoopHeaders</a>(&#42;F);</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EverChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : &#42;F) &#123;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Unreachable.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;BB))</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#abbc2deb942b00a9d0d19a6613e374168">processBlock</a>(&amp;BB)) </span><span class="doxyHighlightComment">// Thread all of the branches we can over BB.</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = ChangedSinceLastAnalysisUpdate = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Stop processing BB if it&#39;s the entry or is now deleted. The following</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// routines attempt to eliminate BB and locating a suitable replacement</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for the entry is non-trivial.</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;BB == &amp;F-&gt;getEntryBlock() || DTU-&gt;isBBPendingDeletion(&amp;BB))</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(&amp;BB)) &#123;</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// When processBlock makes BB unreachable it doesn&#39;t bother to fix up</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the instructions in it. We must remove BB to prevent invalid IR.</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  JT: Deleting dead block &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB.getName()</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; with terminator: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB.getTerminator()</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">        LoopHeaders.erase(&amp;BB);</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">        LVI-&gt;eraseBlock(&amp;BB);</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(&amp;BB, DTU.get());</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = ChangedSinceLastAnalysisUpdate = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// processBlock doesn&#39;t thread BBs with unconditional TIs. However, if BB</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// is &quot;almost empty&quot;, we attempt to merge BB with its sole successor.</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB.getTerminator());</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI &amp;&amp; BI-&gt;isUnconditional()) &#123;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = BI-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// The terminator must be the only non-phi instruction in BB.</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">            BB.getFirstNonPHIOrDbg(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)-&gt;isTerminator() &amp;&amp;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Don&#39;t alter Loop headers and latches to ensure another pass can</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// detect and transform nested loops later.</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">            !LoopHeaders.count(&amp;BB) &amp;&amp; !LoopHeaders.count(Succ) &amp;&amp;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a67474fe1bb82a093f3ad2e9ad2d7f7c4">TryToSimplifyUncondBranchFromEmptyBlock</a>(&amp;BB, DTU.get())) &#123;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// BB is valid for cleanup here because we passed in DTU. F remains</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// BB&#39;s parent until a DTU-&gt;getDomTree() event.</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">          LVI-&gt;eraseBlock(&amp;BB);</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = ChangedSinceLastAnalysisUpdate = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">    EverChanged |= <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>);</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Jump threading may have introduced redundant debug values into F which</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// should be removed.</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EverChanged)</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : &#42;F) &#123;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a08f3f942afc0ee9115a8f9fa87e9191d">RemoveRedundantDbgInstrs</a>(&amp;BB);</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  LoopHeaders.clear();</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EverChanged;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlightComment">// Replace uses of Cond with ToVal when safe to do so. If all uses are</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlightComment">// replaced, we can remove Cond. We cannot blindly replace all uses of Cond</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlightComment">// because we may incorrectly replace uses when guards/assumes are uses of</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlightComment">// of &#96;Cond&#96; and we used the guards/assume to reason about the &#96;Cond&#96; value</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlightComment">// at the end of block. RAUW unconditionally replaces all uses</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlightComment">// including the guards/assumes themselves and the uses before the</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlightComment">// guard/assume.</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392" lineLink="#a0e7841803a620fb47c7cd3086debaf54"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a0e7841803a620fb47c7cd3086debaf54">replaceFoldableUses</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;ToVal,</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;KnownAtEndOfBB) &#123;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType() == ToVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can unconditionally replace all uses in non-local blocks (i.e. uses</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// strictly dominated by BB), since LVI information is true from the</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// terminator of BB.</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getParent() == KnownAtEndOfBB)</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#a22deed11f251c5761b2b4bf021eff4ac">replaceNonLocalUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, ToVal);</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;KnownAtEndOfBB)) &#123;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace any debug-info record users of Cond with ToVal.</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR : <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDbgRecordRange()))</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">      DVR.replaceVariableLocationOp(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, ToVal, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reached the Cond whose uses we are trying to replace, so there are no</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// more uses.</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We only replace uses in instructions that are guaranteed to reach the end</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of BB, where we know Cond is ToVal.</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.replaceUsesOfWith(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, ToVal);</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;use&#95;empty() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;mayHaveSideEffects()) &#123;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlightComment">/// Return the cost of duplicating a piece of this block from first non-phi</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlightComment">/// and before StopAt instruction to thread across it. Stop scanning the block</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlightComment">/// when exceeding the threshold. If duplication is impossible, returns ~0U.</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426" lineLink="#a65facbdd55e486cbcef04a12de132c9c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a65facbdd55e486cbcef04a12de132c9c">getJumpThreadDuplicationCost</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StopAt,</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Threshold) &#123;</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StopAt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Not an instruction from proper BB?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not duplicate the BB if it has a lot of PHI nodes.</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If a threadable chain is too long then the number of PHI nodes can add up,</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// leading to a substantial increase in compile time when rewriting the SSA.</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PhiCount = 0;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FirstNonPHI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">      FirstNonPHI = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (++PhiCount &gt; <a href="#a0d09015dce7d16b0d2387c1e053d6159">PhiDuplicateThreshold</a>)</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ~0U;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlightComment">  /// Ignore PHI nodes, these will be flattened when duplication happens.</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a42a7d51fdde6913db72d098356c2c019">BasicBlock::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>(FirstNonPHI);</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: THREADING will delete values that are just used to compute the</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch, so they shouldn&#39;t count against the duplication cost.</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bonus = 0;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>() == StopAt) &#123;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Threading through a switch statement is particularly profitable.  If this</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block ends in a switch, decrease its cost to make it more likely to</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// happen.</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SwitchInst&gt;</a>(StopAt))</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">      Bonus = 6;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The same holds for indirect branches, but slightly more so.</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(StopAt))</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">      Bonus = 8;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bump the threshold up so the early exit from the loop doesn&#39;t skip the</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// terminator-based Size adjustment at the end.</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  Threshold += Bonus;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sum up the cost of each instruction until we get to the terminator.  Don&#39;t</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// include the terminator because the copy won&#39;t include it.</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = 0;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != StopAt; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Stop scanning the block if we&#39;ve reached the threshold.</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; Threshold)</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bail out if this instruction gives back a token type, it is not possible</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to duplicate it if it is used outside this BB.</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isTokenTy() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isUsedOutsideOfBlock(BB))</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ~0U;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Blocks with NoDuplicate are modelled as having infinite cost, so they</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// are never duplicated.</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;cannotDuplicate() || CI-&gt;isConvergent())</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ~0U;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getInstructionCost(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>) ==</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">TargetTransformInfo::TCC&#95;Free</a>)</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All other instructions count for at least one unit.</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    ++<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Calls are more expensive.  If they are non-intrinsic calls, we model them</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as having cost of 4  If they are a non-vector intrinsic, we model them</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as having cost of 2 total, and if they are a vector intrinsic, we model</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// them as having cost 1</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(CI))</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> += 3;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI-&gt;getType()-&gt;isVectorTy())</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> += 1;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; Bonus ? <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> - Bonus : 0;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlightComment">/// findLoopHeaders - We do not want jump threading to turn proper loop</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlightComment">/// structures into irreducible loops.  Doing this breaks up the loop nesting</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlightComment">/// hierarchy and pessimizes later transformations.  To prevent this from</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlightComment">/// happening, we first have to find the loop headers.  Here we approximate this</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlightComment">/// by finding targets of backedges in the CFG.</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">/// Note that there definitely are cases when we want to allow threading of</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">/// edges across a loop header.  For example, threading a jump from outside the</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlightComment">/// loop (the preheader) to an exit block of the loop is definitely profitable.</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlightComment">/// It is also almost always profitable to thread backedges from within the loop</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlightComment">/// to exit blocks, and is often profitable to thread backedges to other blocks</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlightComment">/// within the loop (forming a nested loop).  This simple analysis is not rich</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlightComment">/// enough to track all of these properties and keep it up-to-date as the CFG</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlightComment">/// mutates, so we don&#39;t allow any of these transformations.</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a29e73c6c256c3fbdd7dacf8095210d5b"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a29e73c6c256c3fbdd7dacf8095210d5b">JumpThreadingPass::findLoopHeaders</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;F) &#123;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;const BasicBlock&#42;,const BasicBlock&#42;&gt;</a>, 32&gt; Edges;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aec1d6e397956b9f5fa62416d0beba785">FindFunctionBackedges</a>(F, Edges);</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Edge : Edges)</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">    LoopHeaders.insert(Edge.second);</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlightComment">/// getKnownConstant - Helper method to determine if we can thread over a</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlightComment">/// terminator with the given value as its condition, and if so what value to</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlightComment">/// use for that. What kind of value this is depends on whether we want an</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlightComment">/// integer or a block address, but an undef is always accepted.</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlightComment">/// Returns null if Val is null or not an appropriate constant.</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538" lineLink="#a7dd0ca6accd47d876a191473b33feacb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0">ConstantPreference</a> Preference) &#123;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Val)</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Undef is &quot;known&quot; enough.</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/undefvalue">UndefValue</a> &#42;U = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;UndefValue&gt;</a>(Val))</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> U;</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Preference == <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0a14d7faebe69e48290ea9c8aa9a0b40fc">WantBlockAddress</a>)</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BlockAddress&gt;</a>(Val-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>());</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Val);</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlightComment">/// computeValueKnownInPredecessors - Given a basic block BB and a value V, see</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlightComment">/// if we can infer that the value is a known ConstantInt/BlockAddress or undef</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlightComment">/// in any of our predecessors.  If so, return the known list of value and pred</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlightComment">/// BB in the result vector.</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlightComment">/// This returns true if there were any known values.</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">JumpThreadingPass::computeValueKnownInPredecessorsImpl</a>(</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7f5ace88163fa52d6a28d0bb1832755d">PredValueInfo</a> &amp;Result,</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0">ConstantPreference</a> Preference, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 4&gt;</a> &amp;RecursionSet,</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CxtI) &#123;</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This method walks up use-def chains recursively.  Because of this, we could</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// get into an infinite loop going around loops in the use-def chain.  To</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// prevent this, keep track of what (value, block) pairs we&#39;ve already visited</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and terminate the search if we loop back to them</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RecursionSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(V).second)</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If V is a constant, then it is known in all predecessors.</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(V, Preference)) &#123;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">      Result.emplace&#95;back(KC, Pred);</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If V is a non-instruction value, or an instruction in a different block,</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then it can&#39;t be derived from a PHI.</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != BB) &#123;</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, if this is a live-in value, see if it has a known value at the any</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// edge from our predecessors.</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the value is known by LazyValueInfo to be a constant in a</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// predecessor, use that information to try to thread this block.</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;PredCst = LVI-&gt;getConstantOnEdge(V, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, BB, CxtI);</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If I is a non-local compare-with-constant instruction, use more-rich</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#39;getPredicateOnEdge&#39; method. This would be able to handle value</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// inequalities better, for example if the compare is &quot;X &lt; 4&quot; and &quot;X &lt; 3&quot;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// is known true but &quot;X &lt; 4&quot; itself is not available.</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cst;</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredCst &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a7d9ab823fe85606fa795c0c6fc75aca6">m&#95;Cmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Val), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Cst))))</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">        PredCst = LVI-&gt;getPredicateOnEdge(Pred, Val, Cst, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, BB, CxtI);</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(PredCst, Preference))</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">        Result.emplace&#95;back(KC, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlightComment">  /// If I is a PHI node, then we know the incoming values for any constants.</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;getNumIncomingValues(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = PN-&gt;getIncomingValue(i);</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(InVal, Preference)) &#123;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">        Result.emplace&#95;back(KC, PN-&gt;getIncomingBlock(i));</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CI = LVI-&gt;getConstantOnEdge(InVal,</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">                                              PN-&gt;getIncomingBlock(i),</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">                                              BB, CxtI);</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(CI, Preference))</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">          Result.emplace&#95;back(KC, PN-&gt;getIncomingBlock(i));</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle Cast instructions.</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Source = CI-&gt;getOperand(0);</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/jumpthreading/#a310d384c91fa9546bfe564901c38345b">PredValueInfoTy</a> Vals;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(Source, BB, Vals, Preference,</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">                                        RecursionSet, CxtI);</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Vals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Convert the known values.</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Val : Vals)</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Folded = <a href="/docs/api/namespaces/llvm/#a8bf77c90e2fb57af4d4d4aab084f7052">ConstantFoldCastOperand</a>(CI-&gt;getOpcode(), Val.first,</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">                                                     CI-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">        Result.emplace&#95;back(Folded, Val.second);</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FreezeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Source = FI-&gt;getOperand(0);</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(Source, BB, Result, Preference,</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">                                        RecursionSet, CxtI);</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">erase&#95;if</a>(Result, &#91;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair) &#123;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(Pair.first);</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle some boolean conditions.</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;getPrimitiveSizeInBits() == 1) &#123;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Preference != <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>)</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// X | true -&gt; true</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// X &amp; false -&gt; false</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0, &#42;Op1;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1))) ||</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1)))) &#123;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/jumpthreading/#a310d384c91fa9546bfe564901c38345b">PredValueInfoTy</a> LHSVals, RHSVals;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(Op0, BB, LHSVals, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>,</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">                                          RecursionSet, CxtI);</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(Op1, BB, RHSVals, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>,</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">                                          RecursionSet, CxtI);</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LHSVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; RHSVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;InterestingVal;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>()))</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">        InterestingVal = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext());</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">        InterestingVal = <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext());</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock&#42;, 4&gt;</a> LHSKnownBBs;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Scan for the sentinel.  If we find an undef, force it to the</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// interesting value: x|undef -&gt; true and x&amp;undef -&gt; false.</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LHSVal : LHSVals)</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LHSVal.first == InterestingVal || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(LHSVal.first)) &#123;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">          Result.emplace&#95;back(InterestingVal, LHSVal.second);</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">          LHSKnownBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(LHSVal.second);</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RHSVal : RHSVals)</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RHSVal.first == InterestingVal || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(RHSVal.first)) &#123;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If we already inferred a value for this block on the LHS, don&#39;t</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// re-add it.</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LHSKnownBBs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(RHSVal.second))</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">            Result.emplace&#95;back(InterestingVal, RHSVal.second);</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle the NOT form of XOR.</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::Xor &amp;&amp;</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)) &amp;&amp;</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1))-&gt;isOne()) &#123;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), BB, Result,</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">                                          <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>, RecursionSet, CxtI);</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result.empty())</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Invert the known values.</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;R : Result)</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">        R.first = <a href="/docs/api/classes/llvm/constantexpr/#a5b43a866f0fca605556f0f69f70c522a">ConstantExpr::getNot</a>(R.first);</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to simplify some other binary operator values.</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Preference != <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>)</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(BO-&gt;getOperand(1))) &#123;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/jumpthreading/#a310d384c91fa9546bfe564901c38345b">PredValueInfoTy</a> LHSVals;</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(BO-&gt;getOperand(0), BB, LHSVals,</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">                                          <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>, RecursionSet, CxtI);</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Try to use constant folding to simplify the binary operator.</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LHSVal : LHSVals) &#123;</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;V = LHSVal.first;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Folded =</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(BO-&gt;getOpcode(), V, CI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(Folded, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>))</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">          Result.emplace&#95;back(KC, LHSVal.second);</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle compare with phi operand, where the PHI is defined in this block.</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Preference != <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>)</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;CmpType = Cmp-&gt;getType();</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpLHS = Cmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpRHS = Cmp-&gt;getOperand(1);</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(CmpLHS);</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN)</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">      PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(CmpRHS);</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not perform phi translation across a loop header phi, because this</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// may result in comparison of values from two different loop iterations.</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: This check is broken if LoopHeaders is not populated.</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN &amp;&amp; PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB &amp;&amp; !LoopHeaders.contains(BB)) &#123;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = PN-&gt;<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We can do this simplification if any comparisons fold to true or false.</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// See if any do.</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i);</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS, &#42;RHS;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN == CmpLHS) &#123;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">          LHS = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i);</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">          RHS = CmpRHS-&gt;<a href="/docs/api/classes/llvm/value/#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(BB, PredBB);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">          LHS = CmpLHS-&gt;<a href="/docs/api/classes/llvm/value/#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(BB, PredBB);</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">          RHS = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i);</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Res = <a href="/docs/api/namespaces/llvm/#adccdd5d6b0c85f7917306e296b27c4cd">simplifyCmpInst</a>(Pred, LHS, RHS, &#123;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>&#125;);</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Res) &#123;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(RHS))</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// getPredicateOnEdge call will make no sense if LHS is defined in BB.</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LHSInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(LHS);</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LHSInst &amp;&amp; LHSInst-&gt;getParent() == BB)</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">          Res = LVI-&gt;getPredicateOnEdge(Pred, LHS, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(RHS), PredBB,</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">                                        BB, CxtI ? CxtI : Cmp);</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(Res, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>))</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">          Result.emplace&#95;back(KC, PredBB);</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If comparing a live-in value against a constant, see if we know the</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// live-in value on any predecessors.</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(CmpRHS) &amp;&amp; !CmpType-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>()) &#123;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CmpConst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(CmpRHS);</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(CmpLHS) ||</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(CmpLHS)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() != BB) &#123;</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the value is known by LazyValueInfo to be a constant in a</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// predecessor, use that information to try to thread this block.</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Res = LVI-&gt;getPredicateOnEdge(Pred, CmpLHS, CmpConst, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, BB,</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">                                                  CxtI ? CxtI : Cmp);</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(Res, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>))</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">            Result.emplace&#95;back(KC, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// InstCombine can fold some forms of constant range checks into</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (icmp (add (x, C1)), C2). See if we have we have such a thing with</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// x as a live-in.</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">      &#123;</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;AddLHS;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;AddConst;</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(CmpConst) &amp;&amp;</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CmpLHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(AddLHS), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(AddConst)))) &#123;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(AddLHS) ||</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AddLHS)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() != BB) &#123;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// If the value is known by LazyValueInfo to be a ConstantRange in</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// a predecessor, use that information to try to thread this</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/constantrange">ConstantRange</a> CR = LVI-&gt;getConstantRangeOnEdge(</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">                  AddLHS, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, BB, CxtI ? CxtI : <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(CmpLHS));</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// Propagate the range through the addition.</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">              CR = CR.<a href="/docs/api/classes/llvm/constantrange/#a04b4ad79ea8ce56e62e0e0323d302eec">add</a>(AddConst-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>());</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// Get the range where the compare returns true.</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/constantrange">ConstantRange</a> CmpRange = <a href="/docs/api/classes/llvm/constantrange/#aa89e9cec92a0b38d2f47a077bf12cc98">ConstantRange::makeExactICmpRegion</a>(</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">                  Pred, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(CmpConst)-&gt;getValue());</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ResC;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CmpRange.<a href="/docs/api/classes/llvm/constantrange/#aaca3a4d2b25c24b11179cbd01079b73c">contains</a>(CR))</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">                ResC = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(CmpType);</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CmpRange.<a href="/docs/api/classes/llvm/constantrange/#aaaa2f5e2c6c3122d2b484f9e50950e18">inverse</a>().<a href="/docs/api/classes/llvm/constantrange/#aaca3a4d2b25c24b11179cbd01079b73c">contains</a>(CR))</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">                ResC = <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(CmpType);</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">              Result.emplace&#95;back(ResC, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Try to find a constant value for the LHS of a comparison,</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and evaluate it statically if we can.</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/jumpthreading/#a310d384c91fa9546bfe564901c38345b">PredValueInfoTy</a> LHSVals;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), BB, LHSVals,</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">                                          <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>, RecursionSet, CxtI);</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LHSVal : LHSVals) &#123;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;V = LHSVal.first;</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Folded =</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a3cd3a3ec28036937ecebe767498ba55d">ConstantFoldCompareInstOperands</a>(Pred, V, CmpConst, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(Folded, <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>))</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">          Result.emplace&#95;back(KC, LHSVal.second);</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle select instructions where at least one operand is a known constant</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and we can figure out the condition value for any predecessor block.</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;TrueVal = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue(), Preference);</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;FalseVal = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue(), Preference);</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/jumpthreading/#a310d384c91fa9546bfe564901c38345b">PredValueInfoTy</a> Conds;</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((TrueVal || FalseVal) &amp;&amp;</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7524dbb403a24e9e73d4bca80baa768d">computeValueKnownInPredecessorsImpl</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), BB, Conds,</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">                                            <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>, RecursionSet, CxtI)) &#123;</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : Conds) &#123;</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.first;</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Figure out what value to use for the condition.</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> KnownCond;</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// A known boolean.</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">          KnownCond = CI-&gt;isOne();</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected condition value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Either operand will do, so be sure to pick the one that&#39;s a known</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// constant.</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// FIXME: Do this more cleverly if both values are known constants?</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">          KnownCond = (TrueVal != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// See if the select has a known constant value for this predecessor.</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Val = KnownCond ? TrueVal : FalseVal)</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">          Result.emplace&#95;back(Val, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.second);</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all else fails, see if LVI can figure out a constant value for us.</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CxtI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;CxtI should be in BB&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CI = LVI-&gt;getConstant(V, CxtI);</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;KC = <a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(CI, Preference)) &#123;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">      Result.emplace&#95;back(KC, Pred);</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Result.empty();</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlightComment">/// GetBestDestForBranchOnUndef - If we determine that the specified block ends</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlightComment">/// in an undefined jump, decide which block is best to revector to.</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlightComment">/// Since we can pick an arbitrary destination, we pick the successor with the</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlightComment">/// fewest predecessors.  This should reduce the in-degree of the others.</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918" lineLink="#a089d9b5caf2479e6b87f94c73e5b1f70"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a089d9b5caf2479e6b87f94c73e5b1f70">getBestDestForJumpOnUndef</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BBTerm = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinSucc = 0;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TestBB = BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(MinSucc);</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the successor with the minimum number of predecessors.</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinNumPreds = <a href="/docs/api/namespaces/llvm/#a3f211484edf604716a6c80030b0a0375">pred&#95;size</a>(TestBB);</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1, e = BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">    TestBB = BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(i);</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPreds = <a href="/docs/api/namespaces/llvm/#a3f211484edf604716a6c80030b0a0375">pred&#95;size</a>(TestBB);</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumPreds &lt; MinNumPreds) &#123;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      MinSucc = i;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      MinNumPreds = NumPreds;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MinSucc;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936" lineLink="#ae6fa18c5b7272e2bdd00c26da8041358"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ae6fa18c5b7272e2bdd00c26da8041358">hasAddressTakenAndUsed</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the block has its address taken, it may be a tree of dead constants</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hanging off of it.  These shouldn&#39;t keep the block alive.</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockaddress">BlockAddress</a> &#42;BA = <a href="/docs/api/classes/llvm/blockaddress/#af6e2f535824d8f9b4bf1b1a75e5ab57c">BlockAddress::get</a>(BB);</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  BA-&gt;<a href="/docs/api/classes/llvm/constant/#a960620248182018e566b095f06a605df">removeDeadConstantUsers</a>();</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !BA-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>();</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlightComment">/// processBlock - If there are any predecessors whose control can be threaded</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlightComment">/// through to a successor, transform them now.</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#abbc2deb942b00a9d0d19a6613e374168"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#abbc2deb942b00a9d0d19a6613e374168">JumpThreadingPass::processBlock</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the block is trivially dead, just return and let the caller nuke it.</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This simplifies other transformations.</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU-&gt;isBBPendingDeletion(BB) ||</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(BB) &amp;&amp; BB != &amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>()))</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this block has a single predecessor, and if that pred has a single</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor, merge the blocks.  This encourages recursive jump threading</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because now the condition in this block can be threaded through</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors of our predecessor block.</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#a30207ff92cc09d50e4f6e188de0f59ed">maybeMergeBasicBlockIntoOnlyPred</a>(BB))</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#af1fb897c419e6a5080ecf54baf13f169">tryToUnfoldSelectInCurrBB</a>(BB))</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look if we can propagate guards to predecessors.</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasGuards &amp;&amp; <a href="/docs/api/classes/llvm/jumpthreadingpass/#a080bc28b084ddc6539dda7e94a300da7">processGuards</a>(BB))</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// What kind of constant we&#39;re looking for.</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0">ConstantPreference</a> Preference = <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look to see if the terminator is a conditional branch, switch or indirect</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch, if not we can&#39;t thread it.</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Condition;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Terminator = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Terminator)) &#123;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t thread an unconditional jump.</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;isUnconditional()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">    Condition = BI-&gt;getCondition();</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(Terminator)) &#123;</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">    Condition = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/indirectbrinst">IndirectBrInst</a> &#42;IB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IndirectBrInst&gt;</a>(Terminator)) &#123;</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t thread indirect branch with no successors.</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IB-&gt;getNumSuccessors() == 0) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">    Condition = IB-&gt;getAddress()-&gt;stripPointerCasts();</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">    Preference = <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0a14d7faebe69e48290ea9c8aa9a0b40fc">WantBlockAddress</a>;</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Must be an invoke or callbr.</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track if we constant folded the condition in this invocation.</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ConstantFolded = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Run constant folding to see if we can reduce the condition to a simple</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constant.</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Condition)) &#123;</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;SimpleVal =</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab6be6270337c6f7620007555247401ce">ConstantFoldInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>(), TLI);</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SimpleVal) &#123;</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(SimpleVal);</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLI))</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">      Condition = SimpleVal;</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">      ConstantFolded = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the terminator is branching on an undef or freeze undef, we can pick any</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the successors to branch to.  Let getBestDestForJumpOnUndef decide.</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FreezeInst&gt;</a>(Condition);</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Condition) ||</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">      (FI &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(FI-&gt;getOperand(0)) &amp;&amp; FI-&gt;hasOneUse())) &#123;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BestSucc = <a href="#a089d9b5caf2479e6b87f94c73e5b1f70">getBestDestForJumpOnUndef</a>(BB);</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fold the branch/switch.</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BBTerm = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">    Updates.reserve(BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>());</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (i == BestSucc) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(i);</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">      Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, Succ&#125;);</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  In block &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; folding undef terminator: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BBTerm &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewBI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(BestSucc), BBTerm-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">    NewBI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">    ++NumFolds;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    BBTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    DTU-&gt;applyUpdatesPermissive(Updates);</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FI)</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">      FI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the terminator of this block is branching on a constant, simplify the</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// terminator to an unconditional branch.  This can occur due to threading in</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other blocks.</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7dd0ca6accd47d876a191473b33feacb">getKnownConstant</a>(Condition, Preference)) &#123;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  In block &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; folding terminator: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">    ++NumFolds;</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a152d8c380cc937c9dceb402ceec943b6">ConstantFoldTerminator</a>(BB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DTU.get());</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getBPI())</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">      BPI-&gt;eraseBlock(BB);</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CondInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Condition);</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All the rest of our checks depend on the condition being an instruction.</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CondInst) &#123;</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Unify this with code below.</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#a96191c096e61f77ea0a6771263bdb5e1">processThreadableEdges</a>(Condition, BB, Preference, Terminator))</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstantFolded;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Some of the following optimization can safely work on the unfrozen cond.</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CondWithoutFreeze = CondInst;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FreezeInst&gt;</a>(CondInst))</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    CondWithoutFreeze = FI-&gt;getOperand(0);</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;CondCmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(CondWithoutFreeze)) &#123;</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re branching on a conditional, LVI might be able to determine</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it&#39;s value at the branch instruction.  We only handle comparisons</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// against a constant at this time.</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CondConst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(CondCmp-&gt;getOperand(1))) &#123;</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Res =</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">          LVI-&gt;getPredicateAt(CondCmp-&gt;getPredicate(), CondCmp-&gt;getOperand(0),</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">                              CondConst, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;UseBlockValue=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Res) &#123;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We can safely replace &#42;some&#42; uses of the CondInst if it has</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// exactly one value as returned by LVI. RAUW is incorrect in the</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// presence of guards and assumes, that have the &#96;Cond&#96; as the use. This</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// is because we use the guards/assume to reason about the &#96;Cond&#96; value</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// at the end of block, but RAUW unconditionally replaces all uses</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// including the guards/assumes themselves and the uses before the</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// guard/assume.</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a0e7841803a620fb47c7cd3086debaf54">replaceFoldableUses</a>(CondCmp, Res, BB))</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We did not manage to simplify this branch, try to see whether</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// CondCmp depends on a known phi-select pattern.</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#ae4ca9bfe94c6cc3d952413c7907db47f">tryToUnfoldSelect</a>(CondCmp, BB))</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#ae4ca9bfe94c6cc3d952413c7907db47f">tryToUnfoldSelect</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, BB))</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for some cases that are worth simplifying.  Right now we want to look</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for loads that are used by a switch or by the condition for the branch.  If</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we see one, check to see if it&#39;s partially redundant.  If so, insert a PHI</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which can then be used to thread the values.</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SimplifyValue = CondWithoutFreeze;</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;CondCmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(SimplifyValue))</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(CondCmp-&gt;getOperand(1)))</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">      SimplifyValue = CondCmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: There are other places where load PRE would be profitable, such as</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// more complex comparisons.</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LoadI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(SimplifyValue))</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#a064ce69a10374b5342954d481e21fa25">simplifyPartiallyRedundantLoad</a>(LoadI))</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Before threading, try to propagate profile data backwards:</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(CondInst))</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;getParent() == BB &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">      <a href="#ae5a9dfd216e7560889e2366f34ddd9f1">updatePredecessorProfileMetadata</a>(PN, BB);</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle a variety of cases where we are branching on something derived from</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a PHI node in the current block.  If we can prove that any predecessors</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compute a predictable value based on a PHI node, thread those predecessors.</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#a96191c096e61f77ea0a6771263bdb5e1">processThreadableEdges</a>(CondInst, BB, Preference, Terminator))</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is an otherwise-unfoldable branch on a phi node or freeze(phi) in</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the current block, see if we can simplify.</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(CondWithoutFreeze);</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN &amp;&amp; PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a66f4dcea5cb859a1234e2b71901a1031">processBranchOnPHI</a>(PN);</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is an otherwise-unfoldable branch on a XOR, see if we can simplify.</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CondInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Xor &amp;&amp;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">      CondInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a071cd98d76a1c63f215ad16388bfdfe2">processBranchOnXOR</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(CondInst));</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Search for a stronger dominating condition that can be used to simplify a</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conditional branch leaving BB.</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#ac06e19670a4cb86b0c885cf67bdb1bc4">processImpliedCondition</a>(BB))</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#ac06e19670a4cb86b0c885cf67bdb1bc4"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#ac06e19670a4cb86b0c885cf67bdb1bc4">JumpThreadingPass::processImpliedCondition</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || !BI-&gt;isConditional())</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI-&gt;getCondition();</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assuming that predecessor&#39;s branch was taken, if pred&#39;s branch condition</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (V) implies Cond, Cond can be either true, undef, or poison. In this case,</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// freeze(Cond) is either true or a nondeterministic value.</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If freeze(Cond) has only one use, we can freely fold freeze(Cond) to true</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// without affecting other instructions.</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FICond = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FreezeInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FICond &amp;&amp; FICond-&gt;hasOneUse())</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = FICond-&gt;getOperand(0);</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">    FICond = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrentBB = BB;</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrentPred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Iter = 0;</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CurrentPred &amp;&amp; Iter++ &lt; <a href="#a863fab1a863c22322d683b7b34d0b6ba">ImplicationSearchThreshold</a>) &#123;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(CurrentPred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PBI || !PBI-&gt;isConditional())</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;getSuccessor(0) != CurrentBB &amp;&amp; PBI-&gt;getSuccessor(1) != CurrentBB)</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CondIsTrue = PBI-&gt;getSuccessor(0) == CurrentBB;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">    std::optional&lt;bool&gt; Implication =</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#af7f2eb961a542779e97c0b3ec7fa6623">isImpliedCondition</a>(PBI-&gt;getCondition(), <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CondIsTrue);</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the branch condition of BB (which is Cond) and CurrentPred are</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exactly the same freeze instruction, Cond can be folded into CondIsTrue.</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Implication &amp;&amp; FICond &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FreezeInst&gt;</a>(PBI-&gt;getCondition())) &#123;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FreezeInst&gt;</a>(PBI-&gt;getCondition())-&gt;getOperand(0) ==</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">          FICond-&gt;getOperand(0))</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">        Implication = CondIsTrue;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Implication) &#123;</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;KeepSucc = BI-&gt;getSuccessor(&#42;Implication ? 0 : 1);</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RemoveSucc = BI-&gt;getSuccessor(&#42;Implication ? 1 : 0);</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">      RemoveSucc-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB);</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;UncondBI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(KeepSucc, BI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">      UncondBI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(BI-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">      ++NumFolds;</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">      BI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FICond)</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">        FICond-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">      DTU-&gt;applyUpdatesPermissive(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, RemoveSucc&#125;&#125;);</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getBPI())</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">        BPI-&gt;eraseBlock(BB);</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">    CurrentBB = CurrentPred;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">    CurrentPred = CurrentBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlightComment">/// Return true if Op is an instruction defined in the given block.</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211" lineLink="#ad67c03658611a6ae7dc39f84346f18bd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ad67c03658611a6ae7dc39f84346f18bd">isOpDefinedInBlock</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpInst-&gt;getParent() == BB)</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlightComment">/// simplifyPartiallyRedundantLoad - If LoadI is an obviously partially</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlightComment">/// redundant load instruction, eliminate it by replacing it with a PHI node.</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlightComment">/// This is an important optimization that encourages jump threading, and needs</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlightComment">/// to be run interlaced with other jump threading tasks.</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a064ce69a10374b5342954d481e21fa25"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a064ce69a10374b5342954d481e21fa25">JumpThreadingPass::simplifyPartiallyRedundantLoad</a>(<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LoadI) &#123;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t hack volatile and ordered loads.</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadI-&gt;<a href="/docs/api/classes/llvm/loadinst/#ac072f8698be17d52f20bb63d59e6ce41">isUnordered</a>()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the load is defined in a block with exactly one predecessor, it can&#39;t be</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// partially redundant.</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoadBB = LoadI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the load is defined in an EH pad, it can&#39;t be partially redundant,</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because the edges between the invoke and the EH pad cannot have other</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions between them.</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac9c170fde1808bbd4436a0dbd6d5e755">isEHPad</a>())</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoadedPtr = LoadI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the loaded operand is defined in the LoadBB and its not a phi,</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it can&#39;t be available in predecessors.</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ad67c03658611a6ae7dc39f84346f18bd">isOpDefinedInBlock</a>(LoadedPtr, LoadBB) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(LoadedPtr))</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan a few instructions up from the load, to see if it is obviously live at</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the entry to its block.</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBIt(LoadI);</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLoadCSE;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/batchaaresults">BatchAAResults</a> BatchAA(&#42;AA);</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The dominator tree is updated lazily and may not be valid at this point.</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">  BatchAA.<a href="/docs/api/classes/llvm/batchaaresults/#a939798bd527ba3029bf75f2671b815ac">disableDominatorTree</a>();</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;AvailableVal = <a href="/docs/api/namespaces/llvm/#a459b627931605e520bf7d14e074af7c1">FindAvailableLoadedValue</a>(</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">          LoadI, LoadBB, BBIt, <a href="/docs/api/namespaces/llvm/#a92ac27b929f0de70e1336a7ab5248861">DefMaxInstsToScan</a>, &amp;BatchAA, &amp;IsLoadCSE)) &#123;</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the value of the load is locally available within the block, just use</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it.  This frequently occurs for reg2mem&#39;d allocas.</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsLoadCSE) &#123;</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;NLoadI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(AvailableVal);</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a9b43098c569ea8289ed1ab70ee9a00af">combineMetadataForCSE</a>(NLoadI, LoadI, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">      LVI-&gt;forgetValue(NLoadI);</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the returned value is the load itself, replace with poison. This can</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// only happen in dead loops.</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AvailableVal == LoadI)</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">      AvailableVal = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AvailableVal-&gt;getType() != LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">      AvailableVal = <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">          AvailableVal, LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, LoadI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AvailableVal)-&gt;setDebugLoc(LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">    LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(AvailableVal);</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">    LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, if we scanned the whole block and got to the top of the block,</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we know the block is locally transparent to the load.  If not, something</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// might clobber its value.</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBIt != LoadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all of the loads and stores that feed the value have the same AA tags,</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then we can propagate them onto any newly inserted loads.</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> AATags = LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock&#42;, 8&gt;</a> PredsScanned;</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">AvailablePredsTy = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;BasicBlock &#42;, Value &#42;&gt;</a>, 8&gt;;</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  AvailablePredsTy AvailablePreds;</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OneUnavailablePred = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;LoadInst&#42;, 8&gt;</a> CSELoads;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we got here, the loaded value is transparent through to the start of the</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block.  Check to see if it is available in any of the predecessor blocks.</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(LoadBB)) &#123;</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we already scanned this predecessor, skip it.</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredsScanned.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PredBB).second)</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">    BBIt = PredBB-&gt;end();</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumScanedInst = 0;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;PredAvailable = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NOTE: We don&#39;t CSE load that is volatile or anything stronger than</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unordered, that should have been checked when we entered the function.</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoadI-&gt;<a href="/docs/api/classes/llvm/loadinst/#ac072f8698be17d52f20bb63d59e6ce41">isUnordered</a>() &amp;&amp;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Attempting to CSE volatile or atomic loads&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a load on a phi pointer, phi-translate it and search</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for available load/store to the pointer in predecessors.</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;AccessTy = LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memorylocation">MemoryLocation</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a>(LoadedPtr-&gt;<a href="/docs/api/classes/llvm/value/#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(LoadBB, PredBB),</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/locationsize/#a131715ceeb92fb803a329d6b76d14e0d">LocationSize::precise</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(AccessTy)),</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">                       AATags);</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">    PredAvailable = <a href="/docs/api/namespaces/llvm/#a3b303a16e5a77e48c8e724c52a3abbff">findAvailablePtrLoadStore</a>(</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/loc">Loc</a>, AccessTy, LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>(), PredBB, BBIt, <a href="/docs/api/namespaces/llvm/#a92ac27b929f0de70e1336a7ab5248861">DefMaxInstsToScan</a>,</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">        &amp;BatchAA, &amp;IsLoadCSE, &amp;NumScanedInst);</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If PredBB has a single predecessor, continue scanning through the</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// single predecessor.</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SinglePredBB = PredBB;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!PredAvailable &amp;&amp; SinglePredBB &amp;&amp; BBIt == SinglePredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>() &amp;&amp;</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">           NumScanedInst &lt; <a href="/docs/api/namespaces/llvm/#a92ac27b929f0de70e1336a7ab5248861">DefMaxInstsToScan</a>) &#123;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">      SinglePredBB = SinglePredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinglePredBB) &#123;</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">        BBIt = SinglePredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">        PredAvailable = <a href="/docs/api/namespaces/llvm/#a3b303a16e5a77e48c8e724c52a3abbff">findAvailablePtrLoadStore</a>(</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/loc">Loc</a>, AccessTy, LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>(), SinglePredBB, BBIt,</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">            (<a href="/docs/api/namespaces/llvm/#a92ac27b929f0de70e1336a7ab5248861">DefMaxInstsToScan</a> - NumScanedInst), &amp;BatchAA, &amp;IsLoadCSE,</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">            &amp;NumScanedInst);</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredAvailable) &#123;</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">      OneUnavailablePred = PredBB;</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsLoadCSE)</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      CSELoads.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(PredAvailable));</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If so, this load is partially redundant.  Remember this info so that we</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// can create a PHI node.</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">    AvailablePreds.emplace&#95;back(PredBB, PredAvailable);</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the loaded value isn&#39;t available in any predecessor, it isn&#39;t partially</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// redundant.</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AvailablePreds.empty()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, the loaded value is available in at least one (and maybe all!)</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors.  If the value is unavailable in more than one unique</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor, we want to insert a merge block for those common predecessors.</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This ensures that we only have to insert one reload, thus not increasing</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code size.</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnavailablePred = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the value is unavailable in one of predecessors, we will end up</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inserting a new instruction into them. It is only valid if all the</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions before LoadI are guaranteed to pass execution to its</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor, or if LoadI is safe to speculate.</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: If this logic becomes more complex, and we will perform PRE insertion</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// farther than to a predecessor, we need to reuse the code from GVN&#39;s PRE.</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It requires domination tree analysis, so for this simple case it is an</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// overkill.</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredsScanned.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() != AvailablePreds.size() &amp;&amp;</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(LoadI))</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = LoadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != LoadI; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is exactly one predecessor where the value is unavailable, the</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// already computed &#39;OneUnavailablePred&#39; block is it.  If it ends in an</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unconditional branch, we know that it isn&#39;t a critical edge.</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredsScanned.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == AvailablePreds.size()+1 &amp;&amp;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">      OneUnavailablePred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1) &#123;</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">    UnavailablePred = OneUnavailablePred;</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredsScanned.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() != AvailablePreds.size()) &#123;</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, we had multiple unavailable predecessors or we had a critical</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// edge from the one.</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 8&gt;</a> PredsToSplit;</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock&#42;, 8&gt;</a> AvailablePredSet;</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;AvailablePred : AvailablePreds)</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">      AvailablePredSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(AvailablePred.first);</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add all the unavailable predecessors to the PredsToSplit list.</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(LoadBB)) &#123;</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the predecessor is an indirect goto, we can&#39;t split the edge.</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;getTerminator()))</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AvailablePredSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>))</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">        PredsToSplit.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Split them out to their own block.</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">    UnavailablePred = splitBlockPreds(LoadBB, PredsToSplit, </span><span class="doxyHighlightStringLiteral">&quot;thread-pre-split&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the value isn&#39;t available in all predecessors, then there will be</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exactly one where it isn&#39;t available.  Insert a load on that edge and add</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it to the AvailablePreds list.</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnavailablePred) &#123;</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnavailablePred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t handle critical edge here!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;NewVal = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loadinst">LoadInst</a>(</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">        LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), LoadedPtr-&gt;<a href="/docs/api/classes/llvm/value/#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(LoadBB, UnavailablePred),</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">        LoadI-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.pr&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, LoadI-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(),</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">        LoadI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>(), LoadI-&gt;<a href="/docs/api/classes/llvm/loadinst/#aca6c2de6950cb093f509ed2b67e02da2">getSyncScopeID</a>(),</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">        UnavailablePred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    NewVal-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags)</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">      NewVal-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(AATags);</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">    AvailablePreds.emplace&#95;back(UnavailablePred, NewVal);</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we know that each predecessor of this block has a value in</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// AvailablePreds, sort them for efficient access as we&#39;re walking the preds.</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(AvailablePreds.begin(), AvailablePreds.end());</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a PHI node at the start of the block for the PRE&#39;d load value.</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/namespaces/llvm/#a3f211484edf604716a6c80030b0a0375">pred&#95;size</a>(LoadBB), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">  PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(LoadBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">  PN-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(LoadI);</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">  PN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert new entries into the PHI for each predecessor.  A single block may</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have multiple entries here.</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(LoadBB)) &#123;</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">    AvailablePredsTy::iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aa81eb67f09ee4944eaeeddbc54c0c0de">llvm::lower&#95;bound</a>(AvailablePreds, std::make&#95;pair(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, (<a href="/docs/api/classes/llvm/value">Value</a> &#42;)</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != AvailablePreds.end() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first == <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> &amp;&amp;</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Didn&#39;t find entry for predecessor!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have an available predecessor but it requires casting, insert the</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cast in the predecessor and use the cast. Note that we have to update the</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AvailablePreds vector as we go so that all of the PHI entries for this</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessor use the same bitcast.</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;PredV = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">      PredV = <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">          PredV, LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;getTerminator()-&gt;getIterator());</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PredV, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first);</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;PredLoadI : CSELoads) &#123;</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9b43098c569ea8289ed1ab70ee9a00af">combineMetadataForCSE</a>(PredLoadI, LoadI, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">    LVI-&gt;forgetValue(PredLoadI);</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">  LoadI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(PN);</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">  LoadI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlightComment">/// findMostPopularDest - The specified list contains multiple possible</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlightComment">/// threadable destinations.  Pick the one that occurs the most frequently in</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlightComment">/// the list.</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466" lineLink="#a784829cd61b59ff78b262cfeb52bea9b"><span class="doxyHighlight"><a href="#a784829cd61b59ff78b262cfeb52bea9b">findMostPopularDest</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;,</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&gt;&gt; &amp;PredToDestList) &#123;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!PredToDestList.empty());</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine popularity.  If there are multiple possible destinations, we</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// explicitly choose to ignore &#39;undef&#39; destinations.  We prefer to thread</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks with known and real destinations to threading undef.  We&#39;ll handle</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them later if interesting.</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;BasicBlock &#42;, unsigned&gt;</a> DestPopularity;</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate DestPopularity with the successors in the order they appear in the</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor list.  This way, we ensure determinism by iterating it in the</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same order in llvm::max&#95;element below.  We map nullptr to 0 so that we can</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return nullptr when PredToDestList contains nullptr only.</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  DestPopularity&#91;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">&#93; = 0;</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SuccBB : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB))</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    DestPopularity&#91;SuccBB&#93; = 0;</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PredToDest : PredToDestList)</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredToDest.second)</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">      DestPopularity&#91;PredToDest.second&#93;++;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the most popular dest.</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MostPopular = <a href="/docs/api/namespaces/llvm/#ab4e6de707bff0fe8081c4da0711bba07">llvm::max&#95;element</a>(DestPopularity, <a href="/docs/api/structs/llvm/less-second">llvm::less&#95;second</a>());</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we have finally picked the most popular destination.</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MostPopular-&gt;first;</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlightComment">// Try to evaluate the value of V when the control flows from PredPredBB to</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlightComment">// BB-&gt;getSinglePredecessor() and then on to BB.</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a6039b71ec6a83438538f637df2080cd7"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/classes/llvm/jumpthreadingpass/#a6039b71ec6a83438538f637df2080cd7">JumpThreadingPass::evaluateOnPredecessorEdge</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">                                                       <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredPredBB,</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">                                                       <a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">                                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PredBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a single predecessor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Cst;</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consult LVI if V is not an instruction in BB or PredBB.</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != BB &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != PredBB)) &#123;</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LVI-&gt;getConstantOnEdge(V, PredPredBB, PredBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look into a PHI argument.</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent() == PredBB)</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValueForBlock(PredPredBB));</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have a CmpInst, try to fold it for each incoming edge into PredBB.</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;CondCmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CondCmp-&gt;getParent() == BB) &#123;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Op0 =</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/jumpthreadingpass/#a6039b71ec6a83438538f637df2080cd7">evaluateOnPredecessorEdge</a>(BB, PredPredBB, CondCmp-&gt;getOperand(0), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Op1 =</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/jumpthreadingpass/#a6039b71ec6a83438538f637df2080cd7">evaluateOnPredecessorEdge</a>(BB, PredPredBB, CondCmp-&gt;getOperand(1), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Op0 &amp;&amp; Op1) &#123;</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a3cd3a3ec28036937ecebe767498ba55d">ConstantFoldCompareInstOperands</a>(CondCmp-&gt;getPredicate(), Op0,</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">                                               Op1, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a96191c096e61f77ea0a6771263bdb5e1"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a96191c096e61f77ea0a6771263bdb5e1">JumpThreadingPass::processThreadableEdges</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">                                               <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0">ConstantPreference</a> Preference,</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CxtI) &#123;</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If threading this would thread across a loop header, don&#39;t even try to</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// thread the edge.</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopHeaders.count(BB))</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/jumpthreading/#a310d384c91fa9546bfe564901c38345b">PredValueInfoTy</a> PredValues;</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/jumpthreadingpass/#a28dad71829aab0b3840ba905a138a009">computeValueKnownInPredecessors</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, BB, PredValues, Preference,</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">                                       CxtI)) &#123;</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We don&#39;t have known values in predecessors.  See if we can thread through</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BB and its sole predecessor.</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a710878a88d68a9169313249bfd52862a">maybethreadThroughTwoBasicBlocks</a>(BB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!PredValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;computeValueKnownInPredecessors returned true with no values&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;IN BB: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">             </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PredValue : PredValues) &#123;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  BB &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39;: FOUND condition = &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PredValue.first</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for pred &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; PredValue.second-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39;.\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Decide what we want to thread through.  Convert our list of known values to</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a list of known destinations for each pred.  This also discards duplicate</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors and keeps track of the undefined inputs (which are represented</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as a null dest in the PredToDestList).</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock&#42;, 16&gt;</a> SeenPreds;</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;BasicBlock&#42;, BasicBlock&#42;&gt;</a>, 16&gt; PredToDestList;</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OnlyDest = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MultipleDestSentinel = (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>&#42;)(intptr&#95;t)~0ULL;</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OnlyVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;MultipleVal = (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;)(intptr&#95;t)~0ULL;</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PredValue : PredValues) &#123;</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = PredValue.second;</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SeenPreds.insert(Pred).second)</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;  </span><span class="doxyHighlightComment">// Duplicate predecessor entry.</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Val = PredValue.first;</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB;</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Val))</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">      DestBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Val) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting a constant integer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">      DestBB = BI-&gt;getSuccessor(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(Val)-&gt;<a href="/docs/api/files/lib/lib/analysis/lint-cpp/#a45005634b54e2126cb3e6ec0dbc9ade4">isZero</a>());</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Val) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting a constant integer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">      DestBB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(Val))-&gt;getCaseSuccessor();</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">              &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected terminator&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(Val) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting a constant blockaddress&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">      DestBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BlockAddress&gt;</a>(Val)-&gt;getBasicBlock();</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have exactly one destination, remember it for efficiency below.</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredToDestList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">      OnlyDest = DestBB;</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">      OnlyVal = Val;</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OnlyDest != DestBB)</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">        OnlyDest = MultipleDestSentinel;</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// It possible we have same destination, but different value, e.g. default</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// case in switchinst.</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Val != OnlyVal)</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">        OnlyVal = MultipleVal;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the predecessor ends with an indirect goto, we can&#39;t change its</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// destination.</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(Pred-&gt;getTerminator()))</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">    PredToDestList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Pred, DestBB);</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all edges were unthreadable, we fail.</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredToDestList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all the predecessors go to a single known successor, we want to fold,</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not thread. By doing so, we do not need to duplicate the current block and</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// also miss potential opportunities in case we dont/cant duplicate.</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OnlyDest &amp;&amp; OnlyDest != MultipleDestSentinel) &#123;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a526630ff85b48f29ac5b4c519c6c2243">hasNPredecessors</a>(PredToDestList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>())) &#123;</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SeenFirstBranchToOnlyDest = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">      std::vector &lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">      Updates.reserve(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() - 1);</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB)) &#123;</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB == OnlyDest &amp;&amp; !SeenFirstBranchToOnlyDest) &#123;</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">          SeenFirstBranchToOnlyDest = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Don&#39;t modify the first branch.</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">          SuccBB-&gt;removePredecessor(BB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">); </span><span class="doxyHighlightComment">// This is unreachable successor.</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">          Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, SuccBB&#125;);</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Finally update the terminator.</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewBI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(OnlyDest, Term-&gt;getIterator());</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">      NewBI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Term-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">      ++NumFolds;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">      Term-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">      DTU-&gt;applyUpdatesPermissive(Updates);</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getBPI())</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">        BPI-&gt;eraseBlock(BB);</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the condition is now dead due to the removal of the old terminator,</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// erase it.</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CondInst-&gt;use&#95;empty() &amp;&amp; !CondInst-&gt;mayHaveSideEffects())</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">          CondInst-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We can safely replace &#42;some&#42; uses of the CondInst if it has</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// exactly one value as returned by LVI. RAUW is incorrect in the</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// presence of guards and assumes, that have the &#96;Cond&#96; as the use. This</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// is because we use the guards/assume to reason about the &#96;Cond&#96; value</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// at the end of block, but RAUW unconditionally replaces all uses</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// including the guards/assumes themselves and the uses before the</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// guard/assume.</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OnlyVal &amp;&amp; OnlyVal != MultipleVal)</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">          <a href="#a0e7841803a620fb47c7cd3086debaf54">replaceFoldableUses</a>(CondInst, OnlyVal, BB);</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine which is the most common successor.  If we have many inputs and</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this block is a switch, we want to start by threading the batch that goes</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the most popular destination first.  If we only know about one</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// threadable destination (the common case) we can avoid this.</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MostPopularDest = OnlyDest;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MostPopularDest == MultipleDestSentinel) &#123;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove any loop headers from the Dest list, threadEdge conservatively</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// won&#39;t process them, but we might have other destination that are eligible</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and we still want to process.</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">erase&#95;if</a>(PredToDestList,</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">             &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt; &amp;PredToDest) &#123;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">               </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopHeaders.contains(PredToDest.second);</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">             &#125;);</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredToDestList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">    MostPopularDest = <a href="#a784829cd61b59ff78b262cfeb52bea9b">findMostPopularDest</a>(BB, PredToDestList);</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we know what the most popular destination is, factor all</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors that will jump to it into a single predecessor.</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 16&gt;</a> PredsToFactor;</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PredToDest : PredToDestList)</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredToDest.second == MostPopularDest) &#123;</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = PredToDest.first;</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This predecessor may be a switch or something else that has multiple</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// edges to the block.  Factor each of these edges by listing them</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// according to # occurrences in PredsToFactor.</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Pred))</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == BB)</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">          PredsToFactor.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Pred);</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the threadable edges are branching on an undefined value, we get to pick</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the destination that these predecessors should get to.</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MostPopularDest)</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">    MostPopularDest = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">                            getSuccessor(<a href="#a089d9b5caf2479e6b87f94c73e5b1f70">getBestDestForJumpOnUndef</a>(BB));</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, try to thread it!</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#ad67aa9d5f2effed17239ab3fad098999">tryThreadEdge</a>(BB, PredsToFactor, MostPopularDest);</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlightComment">/// processBranchOnPHI - We have an otherwise unthreadable conditional branch on</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlightComment">/// a PHI node (or freeze PHI) in the current block.  See if there are any</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlightComment">/// simplifications we can do based on inputs to the phi node.</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a66f4dcea5cb859a1234e2b71901a1031"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a66f4dcea5cb859a1234e2b71901a1031">JumpThreadingPass::processBranchOnPHI</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123;</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We could make use of this to do it once for blocks with common PHI</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 1&gt;</a> PredBBs;</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">  PredBBs.<a href="/docs/api/classes/llvm/smallvectorimpl/#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(1);</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If any of the predecessor blocks end in an unconditional branch, we can</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#42;duplicate&#42; the conditional branch into that block in order to further</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// encourage jump threading and to eliminate cases where we have branch on a</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// phi of an icmp (branch on icmp is much better).</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is still beneficial when a frozen phi is used as the branch condition</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because it allows CodeGenPrepare to further canonicalize br(freeze(icmp))</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to br(icmp(freeze ...)).</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i);</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBr-&gt;isUnconditional()) &#123;</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">        PredBBs&#91;0&#93; = PredBB;</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Try to duplicate BB into PredBB.</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/jumpthreadingpass/#ac14ea98bd0e870e467ae0ddc75a9fa87">duplicateCondBranchOnPHIIntoPred</a>(BB, PredBBs))</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlightComment">/// processBranchOnXOR - We have an otherwise unthreadable conditional branch on</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlightComment">/// a xor instruction in the current block.  See if there are any</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlightComment">/// simplifications we can do based on inputs to the xor.</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a071cd98d76a1c63f215ad16388bfdfe2"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a071cd98d76a1c63f215ad16388bfdfe2">JumpThreadingPass::processBranchOnXOR</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO) &#123;</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BO-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If either the LHS or RHS of the xor is a constant, don&#39;t do this</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimization.</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)) ||</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the first instruction in BB isn&#39;t a phi, we won&#39;t be able to infer</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// anything special about any particular predecessor.</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>()))</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this BB is a landing pad, we won&#39;t be able to split the edge into it.</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac9c170fde1808bbd4436a0dbd6d5e755">isEHPad</a>())</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have a xor as the branch input to this block, and we know that the</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LHS or RHS of the xor in any predecessor is true/false, then we can clone</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the condition into the predecessor and fix that value to true, saving some</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// logical ops on that path and encouraging other paths to simplify.</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This copies something like this:</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  BB:</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %X = phi i1 &#91;1&#93;,  &#91;%X&#39;&#93;</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %Y = icmp eq i32 %A, %B</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %Z = xor i1 %X, %Y</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    br i1 %Z, ...</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Into:</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  BB&#39;:</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %Y = icmp ne i32 %A, %B</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    br i1 %Y, ...</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/jumpthreading/#a310d384c91fa9546bfe564901c38345b">PredValueInfoTy</a> XorOpValues;</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isLHS = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/jumpthreadingpass/#a28dad71829aab0b3840ba905a138a009">computeValueKnownInPredecessors</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), BB, XorOpValues,</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">                                       <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>, BO)) &#123;</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(XorOpValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>());</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/jumpthreadingpass/#a28dad71829aab0b3840ba905a138a009">computeValueKnownInPredecessors</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), BB, XorOpValues,</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">                                         <a href="/docs/api/namespaces/llvm/jumpthreading/#a7bd584a1977827b11c76096bebbb38a0ae706b769cc98b156d9e22dfbac8aa62b">WantInteger</a>, BO))</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">    isLHS = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!XorOpValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;computeValueKnownInPredecessors returned true with no values&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan the information to see which is most popular: true or false.  The</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors can be of the set true, false, or undef.</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumTrue = 0, NumFalse = 0;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;XorOpValue : XorOpValues) &#123;</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(XorOpValue.first))</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ignore undefs for the count.</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(XorOpValue.first)-&gt;isZero())</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">      ++NumFalse;</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">      ++NumTrue;</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine which value to split on, true, false, or undef if neither.</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;SplitVal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumTrue &gt; NumFalse)</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">    SplitVal = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>());</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumTrue != 0 || NumFalse != 0)</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">    SplitVal = <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>());</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect all of the blocks that this can be folded into so that we can</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// factor this once and clone it once.</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;, 8&gt;</a> BlocksToFoldInto;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;XorOpValue : XorOpValues) &#123;</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XorOpValue.first != SplitVal &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(XorOpValue.first))</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">    BlocksToFoldInto.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(XorOpValue.second);</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we inferred a value for all of the predecessors, then duplication won&#39;t</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// help us.  However, we can just replace the LHS or RHS with the constant.</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BlocksToFoldInto.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() ==</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>()).getNumIncomingValues()) &#123;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SplitVal) &#123;</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If all preds provide undef, just nuke the xor, because it is undef too.</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">      BO-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(BO-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">      BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SplitVal-&gt;<a href="/docs/api/classes/llvm/constantint/#a882d55a6aa2028e1a5ad708b275334e0">isZero</a>() &amp;&amp; BO != BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(isLHS)) &#123;</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If all preds provide 0, replace the xor with the other input.</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">      BO-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(BO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(isLHS));</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">      BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If all preds provide 1, set the computed value to 1</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">      BO-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(!isLHS, SplitVal);</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If any of predecessors end with an indirect goto, we can&#39;t change its</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// destination.</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(BlocksToFoldInto, &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred) &#123;</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">      &#125;))</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to duplicate BB into PredBB.</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#ac14ea98bd0e870e467ae0ddc75a9fa87">duplicateCondBranchOnPHIIntoPred</a>(BB, BlocksToFoldInto);</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlightComment">/// addPHINodeEntriesForMappedBlock - We&#39;re adding &#39;NewPred&#39; as a new</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlightComment">/// predecessor to the PHIBB block.  If it has PHI nodes, add entries for</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlightComment">/// NewPred using the entries from OldPred (suitably mapped).</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867" lineLink="#a77ce0ad30f134042ba819a49315238d8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a77ce0ad30f134042ba819a49315238d8">addPHINodeEntriesForMappedBlock</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBB,</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OldPred,</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewPred,</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">                                            <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;<a href="/docs/api/classes/llvm/valuemap">ValueMap</a>) &#123;</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : PHIBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ok, we have a PHI node.  Figure out what the incoming value was for the</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// DestBlock.</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = PN.getIncomingValueForBlock(OldPred);</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remap the value if necessary.</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>)) &#123;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/valuemap/#a1ac0e866aa7870ec9d1439e829e8e901">ValueToValueMapTy::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/valuemap">ValueMap</a>.<a href="/docs/api/classes/llvm/valuemap/#a7629b8c5f6a6802ee0fdc5c290769692">find</a>(Inst);</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/classes/llvm/valuemap">ValueMap</a>.<a href="/docs/api/classes/llvm/valuemap/#ab871e2d0ebded563edfebd6766fc1a04">end</a>())</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">    PN.addIncoming(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, NewPred);</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlightComment">/// Merge basic block BB into its sole predecessor if possible.</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a30207ff92cc09d50e4f6e188de0f59ed"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a30207ff92cc09d50e4f6e188de0f59ed">JumpThreadingPass::maybeMergeBasicBlockIntoOnlyPred</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SinglePred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SinglePred)</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = SinglePred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TI-&gt;<a href="/docs/api/classes/llvm/instruction/#afcb56ab491984549c6f734b0f5b4f925">isSpecialTerminator</a>() || TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() != 1 ||</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">      SinglePred == BB || <a href="#ae6fa18c5b7272e2bdd00c26da8041358">hasAddressTakenAndUsed</a>(BB))</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If SinglePred was a loop header, BB becomes one.</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopHeaders.erase(SinglePred))</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">    LoopHeaders.insert(BB);</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">  LVI-&gt;eraseBlock(SinglePred);</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa16cddaa1497dc3248fc105467671e82">MergeBasicBlockIntoOnlyPred</a>(BB, DTU.get());</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that BB is merged into SinglePred (i.e. SinglePred code followed by</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB code within one basic block &#96;BB&#96;), we need to invalidate the LVI</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// information associated with BB, because the LVI information need not be</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// true for all of BB after the merge. For example,</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Before the merge, LVI info and code is as follows:</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SinglePred: &lt;LVI info1 for %p val&gt;</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %y = use of %p</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call @exit() // need not transfer execution to successor.</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assume(%p) // from this point on %p is true</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// br label %BB</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB: &lt;LVI info2 for %p val, i.e. %p is true&gt;</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %x = use of %p</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// br label exit</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that this LVI info for blocks BB and SinglPred is correct for %p</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (info2 and info1 respectively). After the merge and the deletion of the</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LVI info1 for SinglePred. We have the following code:</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB: &lt;LVI info2 for %p val&gt;</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %y = use of %p</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call @exit()</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assume(%p)</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %x = use of %p &lt;-- LVI info2 is correct from here onwards.</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// br label exit</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LVI info2 for BB is incorrect at the beginning of BB.</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Invalidate LVI information for BB if the LVI is not provably true for</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all of BB.</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(BB))</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">    LVI-&gt;eraseBlock(BB);</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlightComment">/// Update the SSA form.  NewBB contains instructions that are copied from BB.</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlightComment">/// ValueMapping maps old values in BB to new ones in NewBB.</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a26d6acb7d8248e5d25f190b5d8fecbd3"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a26d6acb7d8248e5d25f190b5d8fecbd3">JumpThreadingPass::updateSSA</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB,</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;ValueMapping) &#123;</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there were values defined in BB that are used outside the block, then we</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// now have to update all uses of the value to use either the original value,</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the cloned value, or some PHI derived value.  This can require arbitrary</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI insertion, of which we are prepared to do, clean these up now.</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/ssaupdater">SSAUpdater</a> SSAUpdate;</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Use &#42;, 16&gt;</a> UsesToRename;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgValueInst &#42;, 4&gt;</a> DbgValues;</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 4&gt;</a> DbgVariableRecords;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scan all uses of this instruction to see if it is used outside of its</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block, and if so, record them in UsesToRename.</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.uses()) &#123;</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;UserPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserPN-&gt;getIncomingBlock(U) == BB)</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent() == BB)</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">      UsesToRename.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;U);</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find debug values outside of the block</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a4d7448a42ae4db532d3ba40e250ec825">findDbgValues</a>(DbgValues, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;DbgVariableRecords);</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(DbgValues, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvalueinst">DbgValueInst</a> &#42;DbgVal) &#123;</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DbgVal-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB;</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(DbgVariableRecords, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DbgVarRec) &#123;</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DbgVarRec-&gt;<a href="/docs/api/classes/llvm/dbgrecord/#afdc6ce41b68f4d534a5263fc529ae3d1">getParent</a>() == BB;</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are no uses outside the block, we&#39;re done with this instruction.</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsesToRename.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; DbgValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; DbgVariableRecords.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;JT: Renaming non-local uses of: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We found a use of I outside of BB.  Rename all uses of I that are outside</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// its block to be uses of the appropriate PHI node etc.  See ValuesInBlocks</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with the two values we know.</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">    SSAUpdate.<a href="/docs/api/classes/llvm/ssaupdater/#a4fe3279aae4f726813a672d4a9b26cb1">Initialize</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getName());</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">    SSAUpdate.<a href="/docs/api/classes/llvm/ssaupdater/#af0d1a82b4e629e834c2ed53e5cbe22ef">AddAvailableValue</a>(BB, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">    SSAUpdate.<a href="/docs/api/classes/llvm/ssaupdater/#af0d1a82b4e629e834c2ed53e5cbe22ef">AddAvailableValue</a>(NewBB, ValueMapping&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!UsesToRename.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">      SSAUpdate.<a href="/docs/api/classes/llvm/ssaupdater/#a05c4f6837ee786e83246beeb01e3aa8d">RewriteUse</a>(&#42;UsesToRename.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>());</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DbgValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() || !DbgVariableRecords.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">      SSAUpdate.<a href="/docs/api/classes/llvm/ssaupdater/#aa3e6b78bbdd6959f19055f44fa4b7021">UpdateDebugValues</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DbgValues);</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">      SSAUpdate.<a href="/docs/api/classes/llvm/ssaupdater/#aa3e6b78bbdd6959f19055f44fa4b7021">UpdateDebugValues</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DbgVariableRecords);</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">      DbgValues.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">      DbgVariableRecords.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlightComment">/// Clone instructions in range &#91;BI, BE) to NewBB.  For PHI nodes, we only clone</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlightComment">/// arguments that come from PredBB.  Return the map from the variables in the</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlightComment">/// source basic block to the variables in the newly created basic block.</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a44f91224211f7d2538f311f9a916264d"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a44f91224211f7d2538f311f9a916264d">JumpThreadingPass::cloneInstructions</a>(<a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;ValueMapping,</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BI,</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BE,</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB,</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB) &#123;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are going to have to map operands from the source basic block to the new</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// copy of the block &#39;NewBB&#39;.  If there are PHI nodes in the source basic</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block, evaluate them to account for entry from PredBB.</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Retargets llvm.dbg.value to any renamed variables.</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RetargetDbgValueIfPossible = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewInst) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DbgInstruction = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgValueInst&gt;</a>(NewInst);</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DbgInstruction)</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;std::pair&lt;Value &#42;, Value &#42;&gt;</a>, 16&gt; OperandsToRemap;</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DbgOperand : DbgInstruction-&gt;location&#95;ops()) &#123;</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DbgOperandInstruction = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(DbgOperand);</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DbgOperandInstruction)</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#a7629b8c5f6a6802ee0fdc5c290769692">find</a>(DbgOperandInstruction);</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#ab871e2d0ebded563edfebd6766fc1a04">end</a>()) &#123;</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">        OperandsToRemap.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">            std::pair&lt;Value &#42;, Value &#42;&gt;(DbgOperand, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second));</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;OldOp, MappedOp&#93; : OperandsToRemap)</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">      DbgInstruction-&gt;replaceVariableLocationOp(OldOp, MappedOp);</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Duplicate implementation of the above dbg.value code, using</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DbgVariableRecords instead.</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RetargetDbgVariableRecordIfPossible = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR) &#123;</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;std::pair&lt;Value &#42;, Value &#42;&gt;</a>, 16&gt; OperandsToRemap;</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : DVR-&gt;location&#95;ops()) &#123;</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OpInst)</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#a7629b8c5f6a6802ee0fdc5c290769692">find</a>(OpInst);</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#ab871e2d0ebded563edfebd6766fc1a04">end</a>())</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">        OperandsToRemap.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(&#123;OpInst, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second&#125;);</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;OldOp, MappedOp&#93; : OperandsToRemap)</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">      DVR-&gt;replaceVariableLocationOp(OldOp, MappedOp);</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RangeBB = BI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clone the phi nodes of the source basic block into NewBB.  The resulting</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// phi nodes are trivial since NewBB only has one predecessor, but SSAUpdater</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// might need to rewrite the operand of the cloned phi.</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BI); ++BI) &#123;</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(PN-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 1, PN-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(), NewBB);</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(PredBB), PredBB);</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">    ValueMapping&#91;PN&#93; = NewPN;</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clone noalias scope declarations in the threaded block. When threading a</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop exit, we would otherwise end up with two idential scope declarations</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// visible at the same time.</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MDNode &#42;&gt;</a> NoAliasScopes;</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;MDNode &#42;, MDNode &#42;&gt;</a> ClonedScopes;</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Context = PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>();</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ade9551bcb1121539a279452fec71f9eb">identifyNoAliasScopesToClone</a>(BI, BE, NoAliasScopes);</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8eade0f2933d0684681065b3960122e2">cloneNoAliasScopes</a>(NoAliasScopes, ClonedScopes, </span><span class="doxyHighlightStringLiteral">&quot;thread&quot;</span><span class="doxyHighlight">, Context);</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CloneAndRemapDbgInfo = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;From) &#123;</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DVRRange = NewInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a2c89a7c3adbeaf3cc5d02a41401801fb">cloneDebugInfoFrom</a>(From);</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR : <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(DVRRange))</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">      RetargetDbgVariableRecordIfPossible(&amp;DVR);</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clone the non-phi instructions of the source basic block into NewBB,</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// keeping track of the mapping and using it to remap operands in the cloned</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions.</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; BI != BE; ++BI) &#123;</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;New = BI-&gt;clone();</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    New-&gt;setName(BI-&gt;getName());</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">    New-&gt;insertInto(NewBB, NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">    ValueMapping&#91;&amp;&#42;BI&#93; = New;</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab1c40e35dfc36395c37921107003128b">adaptNoAliasScopes</a>(New, ClonedScopes, Context);</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">    CloneAndRemapDbgInfo(New, &amp;&#42;BI);</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RetargetDbgValueIfPossible(New))</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remap operands to patch up intra-block references.</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = New-&gt;getNumOperands(); i != e; ++i)</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(New-&gt;getOperand(i))) &#123;</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/valuemap/#a1ac0e866aa7870ec9d1439e829e8e901">ValueToValueMapTy::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#a7629b8c5f6a6802ee0fdc5c290769692">find</a>(Inst);</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#ab871e2d0ebded563edfebd6766fc1a04">end</a>())</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">          New-&gt;setOperand(i, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There may be DbgVariableRecords on the terminator, clone directly from</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// marker to marker as there isn&#39;t an instruction there.</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BE != RangeBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>() &amp;&amp; BE-&gt;hasDbgRecords()) &#123;</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Dump them at the end.</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dbgmarker">DbgMarker</a> &#42;Marker = RangeBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a952da10b9a7ffd3b3bdeefae13c525a3">getMarker</a>(BE);</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dbgmarker">DbgMarker</a> &#42;EndMarker = NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a27413d863d6f6e778b34b1369b10ecf6">createMarker</a>(NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DVRRange = EndMarker-&gt;<a href="/docs/api/classes/llvm/dbgmarker/#a4d1ce6143d40c11fda669dd0a3a7fd4f">cloneDebugInfoFrom</a>(Marker, std::nullopt);</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR : <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(DVRRange))</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">      RetargetDbgVariableRecordIfPossible(&amp;DVR);</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlightComment">/// Attempt to thread through two successive basic blocks.</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a710878a88d68a9169313249bfd52862a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a710878a88d68a9169313249bfd52862a">JumpThreadingPass::maybethreadThroughTwoBasicBlocks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">                                                         <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &#123;</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consider:</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredBB:</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %var = phi i32&#42; &#91; null, %bb1 &#93;, &#91; @a, %bb2 &#93;</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %tobool = icmp eq i32 %cond, 0</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br i1 %tobool, label %BB, label ...</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB:</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   %cmp = icmp eq i32&#42; %var, null</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br i1 %cmp, label ..., label ...</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t know the value of %var at BB even if we know which incoming edge</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we take to BB.  However, once we duplicate PredBB for each of its incoming</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// edges (say, PredBB1 and PredBB2), we know the value of %var in each copy of</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredBB.  Then we can thread edges PredBB1-&gt;BB and PredBB2-&gt;BB through BB.</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Require that BB end with a Branch for simplicity.</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;CondBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CondBr)</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB must have exactly one predecessor.</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredBB)</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Require that PredBB end with a conditional Branch. If PredBB ends with an</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unconditional branch, we should be merging PredBB and BB instead. For</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplicity, we don&#39;t deal with a switch.</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredBBBranch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredBBBranch || PredBBBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If PredBB has exactly one incoming edge, we don&#39;t gain anything by copying</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredBB.</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t thread through PredBB if it contains a successor edge to itself, in</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which case we would infinite loop.  Suppose we are threading an edge from</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredPredBB through PredBB and BB to SuccBB with PredBB containing a</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor edge to itself.  If we allowed jump threading in this case, we</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// could duplicate PredBB and BB as, say, PredBB.thread and BB.thread.  Since</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredBB.thread has a successor edge to PredBB, we would immediately come up</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with another jump threading opportunity from PredBB.thread through PredBB</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and BB to SuccBB.  This jump threading would repeatedly occur.  That is, we</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would keep peeling one iteration from PredBB.</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(PredBB), PredBB))</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t thread across a loop header.</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopHeaders.count(PredBB))</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid complication with duplicating EH pads.</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac9c170fde1808bbd4436a0dbd6d5e755">isEHPad</a>())</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find a predecessor that we can thread.  For simplicity, we only consider a</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor edge out of BB to which we thread exactly one incoming edge into</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredBB.</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ZeroCount = 0;</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OneCount = 0;</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ZeroPred = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OnePred = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(PredBB)) &#123;</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If PredPred ends with IndirectBrInst, we can&#39;t handle it.</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;getTerminator()))</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;ConstantInt&gt;</a>(</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/jumpthreadingpass/#a6039b71ec6a83438538f637df2080cd7">evaluateOnPredecessorEdge</a>(BB, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))) &#123;</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;isZero()) &#123;</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">        ZeroCount++;</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">        ZeroPred = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>;</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;isOne()) &#123;</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">        OneCount++;</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">        OnePred = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>;</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disregard complicated cases where we have to thread multiple edges.</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredPredBB;</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ZeroCount == 1) &#123;</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">    PredPredBB = ZeroPred;</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OneCount == 1) &#123;</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">    PredPredBB = OnePred;</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB = CondBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(PredPredBB == ZeroPred);</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If threading to the same block as we come from, we would infinite loop.</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB == BB) &#123;</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not threading across BB &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - would thread to self!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If threading this would thread across a loop header, don&#39;t thread the edge.</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See the comments above findLoopHeaders for justifications and caveats.</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopHeaders.count(BB) || LoopHeaders.count(SuccBB)) &#123;</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BBIsHeader = LoopHeaders.count(BB);</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SuccIsHeader = LoopHeaders.count(SuccBB);</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not threading across &quot;</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">             &lt;&lt; (BBIsHeader ? </span><span class="doxyHighlightStringLiteral">&quot;loop header BB &#39;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;block BB &#39;&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">             &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; to dest &quot;</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">             &lt;&lt; (SuccIsHeader ? </span><span class="doxyHighlightStringLiteral">&quot;loop header BB &#39;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;block BB &#39;&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">             &lt;&lt; SuccBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - it might create an irreducible loop!\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the cost of duplicating BB and PredBB.</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BBCost = <a href="#a65facbdd55e486cbcef04a12de132c9c">getJumpThreadDuplicationCost</a>(</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">      TTI, BB, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), BBDupThreshold);</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PredBBCost = <a href="#a65facbdd55e486cbcef04a12de132c9c">getJumpThreadDuplicationCost</a>(</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">      TTI, PredBB, PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), BBDupThreshold);</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up if costs are too high.  We need to check BBCost and PredBBCost</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// individually before checking their sum because getJumpThreadDuplicationCost</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return (unsigned)~0 for those basic blocks that cannot be duplicated.</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBCost &gt; BBDupThreshold || PredBBCost &gt; BBDupThreshold ||</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">      BBCost + PredBBCost &gt; BBDupThreshold) &#123;</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not threading BB &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - Cost is too high: &quot;</span><span class="doxyHighlight"> &lt;&lt; PredBBCost</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for PredBB, &quot;</span><span class="doxyHighlight"> &lt;&lt; BBCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;for BB\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we are ready to duplicate PredBB.</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#accef1dd983ed3831858fe41c90fcc214">threadThroughTwoBasicBlocks</a>(PredPredBB, PredBB, BB, SuccBB);</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#accef1dd983ed3831858fe41c90fcc214"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#accef1dd983ed3831858fe41c90fcc214">JumpThreadingPass::threadThroughTwoBasicBlocks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredPredBB,</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB,</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB) &#123;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Threading through &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; PredBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; and &#39;&quot;</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">                    &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build BPI/BFI before any changes are made to IR.</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasProfile = doesBlockHaveProfileData(BB);</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BFI = getOrCreateBFI(HasProfile);</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getOrCreateBPI(BFI != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;CondBr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredBBBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB =</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), PredBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.thread&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">                         PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), PredBB);</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">  NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a507bb47fc498540c91fec0bf95c25907">moveAfter</a>(PredBB);</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the block frequency of NewBB.</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BFI) &#123;</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BPI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;It&#39;s expected BPI to exist along with BFI&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NewBBFreq = BFI-&gt;getBlockFreq(PredPredBB) &#42;</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">                     BPI-&gt;getEdgeProbability(PredPredBB, PredBB);</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">    BFI-&gt;setBlockFreq(NewBB, NewBBFreq);</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are going to have to map operands from the original BB block to the new</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// copy of the block &#39;NewBB&#39;.  If there are PHI nodes in PredBB, evaluate them</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to account for entry from PredPredBB.</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> ValueMapping;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#a44f91224211f7d2538f311f9a916264d">cloneInstructions</a>(ValueMapping, PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(), NewBB,</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">                    PredPredBB);</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy the edge probabilities from PredBB to NewBB.</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BPI)</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">    BPI-&gt;copyEdgeProbabilities(PredBB, NewBB);</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the terminator of PredPredBB to jump to NewBB instead of PredBB.</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This eliminates predecessors from PredPredBB, which requires us to simplify</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any PHI nodes in PredBB.</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredPredTerm = PredPredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PredPredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(); i != e; ++i)</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredPredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(i) == PredBB) &#123;</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">      PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(PredPredBB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">      PredPredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#ae959364e4640ac025bbc046d3d7c7e61">setSuccessor</a>(i, NewBB);</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">  <a href="#a77ce0ad30f134042ba819a49315238d8">addPHINodeEntriesForMappedBlock</a>(PredBBBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0), PredBB, NewBB,</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">                                  ValueMapping);</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">  <a href="#a77ce0ad30f134042ba819a49315238d8">addPHINodeEntriesForMappedBlock</a>(PredBBBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1), PredBB, NewBB,</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">                                  ValueMapping);</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">  DTU-&gt;applyUpdatesPermissive(</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">      &#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, NewBB, CondBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)&#125;,</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">       &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, NewBB, CondBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)&#125;,</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">       &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, PredPredBB, NewBB&#125;,</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">       &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredPredBB, PredBB&#125;&#125;);</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#a26d6acb7d8248e5d25f190b5d8fecbd3">updateSSA</a>(PredBB, NewBB, ValueMapping);</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clean up things like PHI nodes with single operands, dead instructions,</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// etc.</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a42108fe3c2695cb429e6fe312908fa0d">SimplifyInstructionsInBlock</a>(NewBB, TLI);</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a42108fe3c2695cb429e6fe312908fa0d">SimplifyInstructionsInBlock</a>(PredBB, TLI);</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 1&gt;</a> PredsToFactor;</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">  PredsToFactor.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NewBB);</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#afe4c82c6f42e62e67ce856488751517d">threadEdge</a>(BB, PredsToFactor, SuccBB);</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlightComment">/// tryThreadEdge - Thread an edge if it&#39;s safe and profitable to do so.</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#ad67aa9d5f2effed17239ab3fad098999"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#ad67aa9d5f2effed17239ab3fad098999">JumpThreadingPass::tryThreadEdge</a>(</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;PredBBs,</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB) &#123;</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If threading to the same block as we come from, we would infinite loop.</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB == BB) &#123;</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not threading across BB &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - would thread to self!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If threading this would thread across a loop header, don&#39;t thread the edge.</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See the comments above findLoopHeaders for justifications and caveats.</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopHeaders.count(BB) || LoopHeaders.count(SuccBB)) &#123;</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BBIsHeader = LoopHeaders.count(BB);</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SuccIsHeader = LoopHeaders.count(SuccBB);</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not threading across &quot;</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">          &lt;&lt; (BBIsHeader ? </span><span class="doxyHighlightStringLiteral">&quot;loop header BB &#39;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;block BB &#39;&quot;</span><span class="doxyHighlight">) &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; to dest &quot;</span><span class="doxyHighlight"> &lt;&lt; (SuccIsHeader ? </span><span class="doxyHighlightStringLiteral">&quot;loop header BB &#39;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;block BB &#39;&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">          &lt;&lt; SuccBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - it might create an irreducible loop!\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> JumpThreadCost = <a href="#a65facbdd55e486cbcef04a12de132c9c">getJumpThreadDuplicationCost</a>(</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">      TTI, BB, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), BBDupThreshold);</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (JumpThreadCost &gt; BBDupThreshold) &#123;</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not threading BB &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - Cost is too high: &quot;</span><span class="doxyHighlight"> &lt;&lt; JumpThreadCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#afe4c82c6f42e62e67ce856488751517d">threadEdge</a>(BB, PredBBs, SuccBB);</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlightComment">/// threadEdge - We have decided that it is safe and profitable to factor the</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlightComment">/// blocks in PredBBs to one predecessor, then thread an edge from it to SuccBB</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><span class="doxyHighlightComment">/// across BB.  Transform the IR to reflect this change.</span></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#afe4c82c6f42e62e67ce856488751517d"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#afe4c82c6f42e62e67ce856488751517d">JumpThreadingPass::threadEdge</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">                                   </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;PredBBs,</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB) &#123;</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SuccBB != BB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Don&#39;t create an infinite loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LoopHeaders.count(BB) &amp;&amp; !LoopHeaders.count(SuccBB) &amp;&amp;</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Don&#39;t thread across loop headers&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build BPI/BFI before any changes are made to IR.</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasProfile = doesBlockHaveProfileData(BB);</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BFI = getOrCreateBFI(HasProfile);</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getOrCreateBPI(BFI != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And finally, do it!  Start by factoring the predecessors if needed.</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB;</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1)</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">    PredBB = PredBBs&#91;0&#93;;</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Factoring out &quot;</span><span class="doxyHighlight"> &lt;&lt; PredBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>()</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; common predecessors.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><span class="doxyHighlight">    PredBB = splitBlockPreds(BB, PredBBs, </span><span class="doxyHighlightStringLiteral">&quot;.thr&#95;comm&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And finally, do it!</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Threading edge from &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; PredBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; to &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; SuccBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, across block:\\n    &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">  LVI-&gt;threadEdge(PredBB, BB, SuccBB);</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(),</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">                                         BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()+</span><span class="doxyHighlightStringLiteral">&quot;.thread&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">                                         BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), BB);</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">  NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a507bb47fc498540c91fec0bf95c25907">moveAfter</a>(PredBB);</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the block frequency of NewBB.</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BFI) &#123;</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BPI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;It&#39;s expected BPI to exist along with BFI&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NewBBFreq =</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">        BFI-&gt;getBlockFreq(PredBB) &#42; BPI-&gt;getEdgeProbability(PredBB, BB);</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><span class="doxyHighlight">    BFI-&gt;setBlockFreq(NewBB, NewBBFreq);</span></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy all the instructions from BB to NewBB except the terminator.</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> ValueMapping;</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#a44f91224211f7d2538f311f9a916264d">cloneInstructions</a>(ValueMapping, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), std::prev(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()), NewBB,</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">                    PredBB);</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We didn&#39;t copy the terminator from BB over to NewBB, because there is now</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// an unconditional jump to SuccBB.  Insert the unconditional jump.</span></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;NewBI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(SuccBB, NewBB);</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">  NewBI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if SuccBB has PHI nodes. If so, we need to add entries to the</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI nodes for NewBB now.</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">  <a href="#a77ce0ad30f134042ba819a49315238d8">addPHINodeEntriesForMappedBlock</a>(SuccBB, BB, NewBB, ValueMapping);</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the terminator of PredBB to jump to NewBB instead of BB.  This</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// eliminates predecessors from BB, which requires us to simplify any PHI</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nodes in BB.</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredTerm = PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(); i != e; ++i)</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(i) == BB) &#123;</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(PredBB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">      PredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#ae959364e4640ac025bbc046d3d7c7e61">setSuccessor</a>(i, NewBB);</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Enqueue required DT updates.</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">  DTU-&gt;applyUpdatesPermissive(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, NewBB, SuccBB&#125;,</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">                               &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, PredBB, NewBB&#125;,</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">                               &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredBB, BB&#125;&#125;);</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#a26d6acb7d8248e5d25f190b5d8fecbd3">updateSSA</a>(BB, NewBB, ValueMapping);</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point, the IR is fully up to date and consistent.  Do a quick scan</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// over the new instructions and zap any that are constants or dead.  This</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// frequently happens because of phi translation.</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a42108fe3c2695cb429e6fe312908fa0d">SimplifyInstructionsInBlock</a>(NewBB, TLI);</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the edge weight from BB to SuccBB, which should be less than before.</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">  updateBlockFreqAndEdgeWeight(PredBB, BB, NewBB, SuccBB, BFI, BPI, HasProfile);</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Threaded an edge!</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">  ++NumThreads;</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlightComment">/// Create a new basic block that will be the predecessor of BB and successor of</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlightComment">/// all blocks in Preds. When profile data is available, update the frequency of</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlightComment">/// this new block.</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;JumpThreadingPass::splitBlockPreds(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> Preds,</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &#42;Suffix) &#123;</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> NewBBs;</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the frequencies of all predecessors of BB, which will be used to</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// update the edge weight of the result of splitting predecessors.</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BlockFrequency&gt;</a> FreqMap;</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BFI = getBFI();</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BFI) &#123;</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getOrCreateBPI(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : Preds)</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">      FreqMap.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">          Pred, BFI-&gt;getBlockFreq(Pred) &#42; BPI-&gt;getEdgeProbability(Pred, BB)));</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the case when BB is a LandingPad block we create 2 new predecessors</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instead of just one.</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac3a2a666b5703b8c9bda318ef18c731c">isLandingPad</a>()) &#123;</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">    std::string NewName = std::string(Suffix) + </span><span class="doxyHighlightStringLiteral">&quot;.split-lp&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a949b0428c89b8ccf62d469bd325244ed">SplitLandingPadPredecessors</a>(BB, Preds, Suffix, NewName.c&#95;str(), NewBBs);</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">    NewBBs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(BB, Preds, Suffix));</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">  Updates.reserve((2 &#42; Preds.size()) + NewBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewBB : NewBBs) &#123;</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">    BlockFrequency NewBBFreq(0);</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, NewBB, BB&#125;);</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(NewBB)) &#123;</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Pred, BB&#125;);</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, NewBB&#125;);</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BFI) </span><span class="doxyHighlightComment">// Update frequencies between Pred -&gt; NewBB.</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlight">        NewBBFreq += FreqMap.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(Pred);</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BFI) </span><span class="doxyHighlightComment">// Apply the summed frequency to NewBB.</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">      BFI-&gt;setBlockFreq(NewBB, NewBBFreq);</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">  DTU-&gt;applyUpdatesPermissive(Updates);</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewBBs&#91;0&#93;;</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> JumpThreadingPass::doesBlockHaveProfileData(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;TI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TI || TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() &lt; 2)</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a763fc760b3f95cdd3389fdb004122381">hasValidBranchWeightMD</a>(&#42;TI);</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlightComment">/// Update the block frequency of BB and branch weight and the metadata on the</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlightComment">/// edge BB-&gt;SuccBB. This is done by scaling the weight of BB-&gt;SuccBB by 1 -</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlightComment">/// Freq(PredBB-&gt;BB) / Freq(BB-&gt;SuccBB).</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> JumpThreadingPass::updateBlockFreqAndEdgeWeight(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB,</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB,</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB,</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI,</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42;BPI,</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">                                                     </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasProfile) &#123;</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(((BFI &amp;&amp; BPI) || (!BFI &amp;&amp; !BFI)) &amp;&amp;</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Both BFI &amp; BPI should either be set or unset&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BFI) &#123;</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!HasProfile &amp;&amp;</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;It&#39;s expected to have BFI/BPI when profile info exists&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// As the edge from PredBB to BB is deleted, we have to update the block</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// frequency of BB.</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBOrigFreq = BFI-&gt;getBlockFreq(BB);</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NewBBFreq = BFI-&gt;getBlockFreq(NewBB);</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BB2SuccBBFreq = BBOrigFreq &#42; BPI-&gt;getEdgeProbability(BB, SuccBB);</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBNewFreq = BBOrigFreq - NewBBFreq;</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">  BFI-&gt;setBlockFreq(BB, BBNewFreq);</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect updated outgoing edges&#39; frequencies from BB and use them to update</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// edge probabilities.</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">  SmallVector&lt;uint64&#95;t, 4&gt; BBSuccFreq;</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB)) &#123;</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SuccFreq = (Succ == SuccBB)</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">                        ? BB2SuccBBFreq - NewBBFreq</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">                        : BBOrigFreq &#42; BPI-&gt;getEdgeProbability(BB, Succ);</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">    BBSuccFreq.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SuccFreq.getFrequency());</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlight">  uint64&#95;t MaxBBSuccFreq = &#42;<a href="/docs/api/namespaces/llvm/#ab4e6de707bff0fe8081c4da0711bba07">llvm::max&#95;element</a>(BBSuccFreq);</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BranchProbability, 4&gt;</a> BBSuccProbs;</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxBBSuccFreq == 0)</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">    BBSuccProbs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(BBSuccFreq.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(),</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">                       &#123;1, static&#95;cast&lt;unsigned&gt;(BBSuccFreq.size())&#125;);</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (uint64&#95;t Freq : BBSuccFreq)</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">      BBSuccProbs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(Freq, MaxBBSuccFreq));</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Normalize edge probabilities so that they sum up to one.</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchprobability/#afff2bab6bb7f206bbacad5dd589a6186">BranchProbability::normalizeProbabilities</a>(BBSuccProbs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">                                              BBSuccProbs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update edge probabilities in BPI.</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">  BPI-&gt;setEdgeProbability(BB, BBSuccProbs);</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the profile metadata as well.</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t do this if the profile of the transformed blocks was statically</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// estimated.  (This could occur despite the function having an entry</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// frequency in completely cold parts of the CFG.)</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In this case we don&#39;t want to suggest to subsequent passes that the</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// calculated weights are fully consistent.  Consider this graph:</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                 check&#95;1</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//             50% /  |</span></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//             eq&#95;1   | 50%</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                 \\  |</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                 check&#95;2</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//             50% /  |</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//             eq&#95;2   | 50%</span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                 \\  |</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                 check&#95;3</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//             50% /  |</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//             eq&#95;3   | 50%</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                 \\  |</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assuming the blocks check&#95;&#42; all compare the same value against 1, 2 and 3,</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the overall probabilities are inconsistent; the total probability that the</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value is either 1, 2 or 3 is 150%.</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// As a consequence if we thread eq&#95;1 -&gt; check&#95;2 to check&#95;3, check&#95;2-&gt;check&#95;3</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// becomes 0%.  This is even worse if the edge whose probability becomes 0% is</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop exit edge.  Then based solely on static estimation we would assume</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop was extremely hot.</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME this locally as well so that BPI and BFI are consistent as well.  We</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// shouldn&#39;t make edges extremely likely or unlikely based solely on static</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// estimation.</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBSuccProbs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt;= 2 &amp;&amp; HasProfile) &#123;</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">    SmallVector&lt;uint32&#95;t, 4&gt; Weights;</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Prob : BBSuccProbs)</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">      Weights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Prob.getNumerator());</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(&#42;TI, Weights, <a href="/docs/api/namespaces/llvm/#a4a3bd60427b33355559566bdec3c9f90">hasBranchWeightOrigin</a>(&#42;TI));</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlightComment">/// duplicateCondBranchOnPHIIntoPred - PredBB contains an unconditional branch</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlightComment">/// to BB which contains an i1 PHI node and a conditional branch on that PHI.</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlightComment">/// If we can duplicate the contents of BB up into PredBB do so now, this</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlightComment">/// improves the odds that the branch will be on an analyzable instruction like</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlightComment">/// a compare.</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#ac14ea98bd0e870e467ae0ddc75a9fa87"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#ac14ea98bd0e870e467ae0ddc75a9fa87">JumpThreadingPass::duplicateCondBranchOnPHIIntoPred</a>(</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;PredBBs) &#123;</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!PredBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t handle an empty set&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If BB is a loop header, then duplicating this block outside the loop would</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cause us to transform this into an irreducible loop, don&#39;t do this.</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See the comments above findLoopHeaders for justifications and caveats.</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopHeaders.count(BB)) &#123;</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not duplicating loop header &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; into predecessor block &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; PredBBs&#91;0&#93;-&gt;getName()</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - it might create an irreducible loop!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DuplicationCost = <a href="#a65facbdd55e486cbcef04a12de132c9c">getJumpThreadDuplicationCost</a>(</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">      TTI, BB, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), BBDupThreshold);</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DuplicationCost &gt; BBDupThreshold) &#123;</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Not duplicating BB &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; - Cost is too high: &quot;</span><span class="doxyHighlight"> &lt;&lt; DuplicationCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And finally, do it!  Start by factoring the predecessors if needed.</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB;</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1)</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">    PredBB = PredBBs&#91;0&#93;;</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Factoring out &quot;</span><span class="doxyHighlight"> &lt;&lt; PredBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>()</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; common predecessors.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">    PredBB = splitBlockPreds(BB, PredBBs, </span><span class="doxyHighlightStringLiteral">&quot;.thr&#95;comm&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">  Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredBB, BB&#125;);</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we decided to do this!  Clone all the instructions in BB onto the end</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of PredBB.</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Duplicating block &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; into end of &#39;&quot;</span><span class="doxyHighlight"> &lt;&lt; PredBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; to eliminate branch on phi.  Cost: &quot;</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">                    &lt;&lt; DuplicationCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; block is:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unless PredBB ends with an unconditional branch, split the edge so that we</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can just clone the bits from BB into the end of the new PredBB.</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;OldPredBranch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OldPredBranch || !OldPredBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>()) &#123;</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OldPredBB = PredBB;</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">    PredBB = <a href="/docs/api/namespaces/llvm/#adf83581f514774264d616eef5706cf6e">SplitEdge</a>(OldPredBB, BB);</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, OldPredBB, PredBB&#125;);</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, PredBB, BB&#125;);</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, OldPredBB, BB&#125;);</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">    OldPredBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are going to have to map operands from the original BB block into the</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredBB block.  Evaluate PHI nodes in BB.</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> ValueMapping;</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BI); ++BI)</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">    ValueMapping&#91;PN&#93; = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(PredBB);</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clone the non-phi instructions of BB into PredBB, keeping track of the</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mapping and using it to remap operands in the cloned instructions.</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; BI != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); ++BI) &#123;</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;New = BI-&gt;clone();</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">    New-&gt;insertInto(PredBB, OldPredBranch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remap operands to patch up intra-block references.</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = New-&gt;getNumOperands(); i != e; ++i)</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(New-&gt;getOperand(i))) &#123;</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/valuemap/#a1ac0e866aa7870ec9d1439e829e8e901">ValueToValueMapTy::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#a7629b8c5f6a6802ee0fdc5c290769692">find</a>(Inst);</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ValueMapping.<a href="/docs/api/classes/llvm/valuemap/#ab871e2d0ebded563edfebd6766fc1a04">end</a>())</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">          New-&gt;setOperand(i, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remap debug variable operands.</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a3bc23a6f4df3d833013de35759651112">remapDebugVariable</a>(ValueMapping, New);</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this instruction can be simplified after the operands are updated,</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// just use the simplified value instead.  This frequently happens due to</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// phi translation.</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">            New,</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">            &#123;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>(), TLI, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, New&#125;)) &#123;</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">      ValueMapping&#91;&amp;&#42;BI&#93; = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>;</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!New-&gt;mayHaveSideEffects()) &#123;</span></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">        New-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">        New = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Clone debug-info on the elided instruction to the destination</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// position.</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">        OldPredBranch-&gt;<a href="/docs/api/classes/llvm/instruction/#a2c89a7c3adbeaf3cc5d02a41401801fb">cloneDebugInfoFrom</a>(&amp;&#42;BI, std::nullopt, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">      ValueMapping&#91;&amp;&#42;BI&#93; = New;</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (New) &#123;</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise, insert the new instruction into the block.</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">      New-&gt;setName(BI-&gt;getName());</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Clone across any debug-info attached to the old instruction.</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">      New-&gt;cloneDebugInfoFrom(&amp;&#42;BI);</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update Dominance from simplified New instruction operands.</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = New-&gt;getNumOperands(); i != e; ++i)</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BasicBlock&gt;</a>(New-&gt;getOperand(i)))</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">          Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, PredBB, SuccBB&#125;);</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if the targets of the branch had PHI nodes. If so, we need to</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// add entries to the PHI nodes for branch from PredBB now.</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BBBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">  <a href="#a77ce0ad30f134042ba819a49315238d8">addPHINodeEntriesForMappedBlock</a>(BBBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0), BB, PredBB,</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlight">                                  ValueMapping);</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">  <a href="#a77ce0ad30f134042ba819a49315238d8">addPHINodeEntriesForMappedBlock</a>(BBBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1), BB, PredBB,</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">                                  ValueMapping);</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/jumpthreadingpass/#a26d6acb7d8248e5d25f190b5d8fecbd3">updateSSA</a>(BB, PredBB, ValueMapping);</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredBB no longer jumps to BB, remove entries in the PHI node for the edge</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that we nuked.</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight">  BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(PredBB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the unconditional branch at the end of the PredBB block.</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">  OldPredBranch-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getBPI())</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">    BPI-&gt;copyEdgeProbabilities(BB, PredBB);</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlight">  DTU-&gt;applyUpdatesPermissive(Updates);</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">  ++NumDupes;</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlightComment">// Pred is a predecessor of BB with an unconditional branch to BB. SI is</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlightComment">// a Select instruction in Pred. BB has other predecessors and SI is used in</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlightComment">// a PHI node in BB. SI has no other use.</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlightComment">// A new basic block, NewBB, is created and SI is converted to compare and</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlightComment">// conditional branch. SI is erased from parent.</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a7f1482a3531f0a99f5481d84bae6127e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7f1482a3531f0a99f5481d84bae6127e">JumpThreadingPass::unfoldSelectInstr</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;SIUse,</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx) &#123;</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Expand the select.</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pred --</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  |    v</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  |  NewBB</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  |    |</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  |-----</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  v</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredTerm = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;select.unfold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">                                         BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), BB);</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move the unconditional branch to NewBB.</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">  PredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">  PredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#afcd9d2ea284c4d90541291ff9c47d332">insertInto</a>(NewBB, NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a conditional branch and update PHI nodes.</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(NewBB, BB, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), Pred);</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">  BI-&gt;applyMergedLocation(PredTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">  BI-&gt;copyMetadata(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, &#123;LLVMContext::MD&#95;prof&#125;);</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">  SIUse-&gt;<a href="/docs/api/classes/llvm/phinode/#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(Idx, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue());</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">  SIUse-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue(), NewBB);</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">  uint64&#95;t TrueWeight = 1;</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">  uint64&#95;t FalseWeight = 1;</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy probabilities from &#39;SI&#39; to created conditional branch in &#39;Pred&#39;.</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, TrueWeight, FalseWeight) &amp;&amp;</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">      (TrueWeight + FalseWeight) != 0) &#123;</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BranchProbability, 2&gt;</a> BP;</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">    BP.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(<a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">        TrueWeight, TrueWeight + FalseWeight));</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlight">    BP.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(<a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">        FalseWeight, TrueWeight + FalseWeight));</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update BPI if exists.</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BPI = getBPI())</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">      BPI-&gt;setEdgeProbability(Pred, BP);</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the block frequency of NewBB.</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BFI = getBFI()) &#123;</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((TrueWeight + FalseWeight) == 0) &#123;</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">      TrueWeight = 1;</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">      FalseWeight = 1;</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> PredToNewBBProb = <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">        TrueWeight, TrueWeight + FalseWeight);</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NewBBFreq = BFI-&gt;getBlockFreq(Pred) &#42; PredToNewBBProb;</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">    BFI-&gt;setBlockFreq(NewBB, NewBBFreq);</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The select is now dead.</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">  DTU-&gt;applyUpdatesPermissive(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, NewBB, BB&#125;,</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">                               &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, NewBB&#125;&#125;);</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update any other PHI nodes in BB.</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BI); ++BI)</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi != SIUse)</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlight">      Phi-&gt;addIncoming(Phi-&gt;getIncomingValueForBlock(Pred), NewBB);</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#aa0555f067de530264e995e433ebb7e42"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#ae4ca9bfe94c6cc3d952413c7907db47f">JumpThreadingPass::tryToUnfoldSelect</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CondPHI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CondPHI || CondPHI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB)</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = CondPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = CondPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;PredSI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(CondPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The second and third condition can be potentially relaxed. Currently</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the conditions help to simplify the code and allow us to reuse existing</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// code, developed for tryToUnfoldSelect(CmpInst &#42;, BasicBlock &#42;)</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredSI || PredSI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Pred || !PredSI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredTerm = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredTerm || !PredTerm-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7f1482a3531f0a99f5481d84bae6127e">unfoldSelectInstr</a>(Pred, BB, PredSI, CondPHI, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlightComment">/// tryToUnfoldSelect - Look for blocks of the form</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlightComment">/// bb1:</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlightComment">///   %a = select</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><span class="doxyHighlightComment">///   br bb2</span></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlightComment">/// bb2:</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlightComment">///   %p = phi &#91;%a, %bb1&#93; ...</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlightComment">///   %c = icmp %p</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlightComment">///   br i1 %c</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlightComment">/// And expand the select into a branch structure if one of its arms allows %c</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlightComment">/// to be folded. This later enables threading from bb1 over bb2.</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#ae4ca9bfe94c6cc3d952413c7907db47f"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#ae4ca9bfe94c6cc3d952413c7907db47f">JumpThreadingPass::tryToUnfoldSelect</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> &#42;CondCmp, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;CondBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CondLHS = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(CondCmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CondRHS = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(CondCmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CondBr || !CondBr-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() || !CondLHS ||</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight">      CondLHS-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB)</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = CondLHS-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = CondLHS-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(CondLHS-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look if one of the incoming values is a select in the corresponding</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessor.</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a> || <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent() != Pred || !<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PredTerm = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredTerm || !PredTerm-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now check if one of the select values would allow us to constant fold the</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// terminator in BB. We don&#39;t do the transform if both sides fold, those</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cases will be threaded in any case.</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;LHSRes =</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">        LVI-&gt;getPredicateOnEdge(CondCmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(1),</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">                                CondRHS, Pred, BB, CondCmp);</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;RHSRes =</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><span class="doxyHighlight">        LVI-&gt;getPredicateOnEdge(CondCmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getOperand(2),</span></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">                                CondRHS, Pred, BB, CondCmp);</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((LHSRes || RHSRes) &amp;&amp; LHSRes != RHSRes) &#123;</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/jumpthreadingpass/#a7f1482a3531f0a99f5481d84bae6127e">unfoldSelectInstr</a>(Pred, BB, <a href="/docs/api/namespaces/llvm/si">SI</a>, CondLHS, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlightComment">/// tryToUnfoldSelectInCurrBB - Look for PHI/Select or PHI/CMP/Select in the</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlightComment">/// same BB in the form</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlightComment">/// bb:</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlightComment">///   %p = phi &#91;false, %bb1&#93;, &#91;true, %bb2&#93;, &#91;false, %bb3&#93;, &#91;true, %bb4&#93;, ...</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlightComment">///   %s = select %p, trueval, falseval</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlightComment">/// or</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlightComment">/// bb:</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlightComment">///   %p = phi &#91;0, %bb1&#93;, &#91;1, %bb2&#93;, &#91;0, %bb3&#93;, &#91;1, %bb4&#93;, ...</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlightComment">///   %c = cmp %p, 0</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlightComment">///   %s = select %c, trueval, falseval</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlightComment">/// And expand the select into a branch structure. This later enables</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlightComment">/// jump-threading over bb in this pass.</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlightComment">/// Using the similar approach of SimplifyCFG::FoldCondBranchOnPHI(), unfold</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlightComment">/// select if the associated PHI has at least one constant.  If the unfolded</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><span class="doxyHighlightComment">/// select is not jump-threaded, it will be folded again in the later</span></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlightComment">/// optimizations.</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#af1fb897c419e6a5080ecf54baf13f169"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#af1fb897c419e6a5080ecf54baf13f169">JumpThreadingPass::tryToUnfoldSelectInCurrBB</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This transform would reduce the quality of msan diagnostics.</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disable this transform under MemorySanitizer.</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::SanitizeMemory))</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If threading this would thread across a loop header, don&#39;t thread the edge.</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See the comments above findLoopHeaders for justifications and caveats.</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopHeaders.count(BB))</span></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BI); ++BI) &#123;</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for a Phi having at least one constant incoming value.</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(PN-&gt;incoming&#95;values(),</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlight">                     &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123; return !isa&lt;ConstantInt&gt;(V); &#125;))</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> isUnfoldCandidate = &#91;BB&#93;(<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if SI is in BB and use V as condition.</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent() != BB)</span></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsAndOr = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>()));</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> == V &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType()-&gt;isIntegerTy(1) &amp;&amp; !IsAndOr;</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : PN-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(U.getUser())) &#123;</span></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Look for a ICmp in BB that compares PN with a constant and is the</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// condition of a Select.</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp-&gt;getParent() == BB &amp;&amp; Cmp-&gt;hasOneUse() &amp;&amp;</span></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Cmp-&gt;getOperand(1 - U.getOperandNo())))</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;SelectI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Cmp-&gt;user&#95;back()))</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isUnfoldCandidate(SelectI, Cmp-&gt;use&#95;begin()-&gt;get())) &#123;</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/si">SI</a> = SelectI;</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;SelectI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(U.getUser())) &#123;</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Look for a Select in BB that uses PN as condition.</span></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isUnfoldCandidate(SelectI, U.get())) &#123;</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/si">SI</a> = SelectI;</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>)</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Expand the select.</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/si">SI</a>))</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </span><span class="doxyHighlightStringLiteral">&quot;cond.fr&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getIterator());</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;BranchWeights = <a href="/docs/api/namespaces/llvm/#a3475c6d4bdcc4da34ea01a05f01becf2">getBranchWeightMDNode</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term =</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ad957413955739c91204c96e33e0cc933">SplitBlockAndInsertIfThen</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, BranchWeights);</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SplitBB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = Term-&gt;getParent();</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getType(), 2, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getIterator());</span></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue(), Term-&gt;getParent());</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue(), BB);</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;replaceAllUsesWith(NewPN);</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NewBB and SplitBB are newly created blocks which require insertion.</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlight">    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">    Updates.reserve((2 &#42; SplitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>()) + 3);</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, SplitBB&#125;);</span></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, NewBB&#125;);</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, NewBB, SplitBB&#125;);</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BB&#39;s successors were moved to SplitBB, update DTU accordingly.</span></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(SplitBB)) &#123;</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, Succ&#125;);</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, SplitBB, Succ&#125;);</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlight">    DTU-&gt;applyUpdatesPermissive(Updates);</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlightComment">/// Try to propagate a guard from the current BB into one of its predecessors</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlightComment">/// in case if another branch of execution implies that the condition of this</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><span class="doxyHighlightComment">/// guard is always true. Currently we only process the simplest case that</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlightComment">/// looks like:</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><span class="doxyHighlightComment">/// Start:</span></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlightComment">///   %cond = ...</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><span class="doxyHighlightComment">///   br i1 %cond, label %T1, label %F1</span></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlightComment">/// T1:</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlightComment">///   br label %Merge</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlightComment">/// F1:</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><span class="doxyHighlightComment">///   br label %Merge</span></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><span class="doxyHighlightComment">/// Merge:</span></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><span class="doxyHighlightComment">///   %condGuard = ...</span></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlightComment">///   call void(i1, ...) @llvm.experimental.guard( i1 %condGuard )&#91; &quot;deopt&quot;() &#93;</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlightComment">/// And cond either implies condGuard or !condGuard. In this case all the</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlightComment">/// instructions before the guard can be duplicated in both branches, and the</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><span class="doxyHighlightComment">/// guard is then threaded to one of them.</span></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#a080bc28b084ddc6539dda7e94a300da7"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#a080bc28b084ddc6539dda7e94a300da7">JumpThreadingPass::processGuards</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only want to deal with two predecessors.</span></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred1, &#42;Pred2;</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PI = <a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), PE = <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB);</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PI == PE)</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><span class="doxyHighlight">  Pred1 = &#42;PI++;</span></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PI == PE)</span></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">  Pred2 = &#42;PI++;</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PI != PE)</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred1 == Pred2)</span></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to thread one of the guards of the block.</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Look up deeper than to immediate predecessor?</span></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Parent = Pred1-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Parent || Parent != Pred2-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Parent-&gt;getTerminator()))</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a656efdcee3deb029763304d3e741a2d1">isGuard</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/classes/llvm/jumpthreadingpass/#afed5e8a79fa550920f638708cc257bdf">threadGuard</a>(BB, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), BI))</span></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><span class="doxyHighlightComment">/// Try to propagate the guard from BB which is the lower block of a diamond</span></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><span class="doxyHighlightComment">/// to one of its branches, in case if diamond&#39;s condition implies guard&#39;s</span></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><span class="doxyHighlightComment">/// condition.</span></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047" lineLink="/docs/api/classes/llvm/jumpthreadingpass/#afed5e8a79fa550920f638708cc257bdf"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/jumpthreadingpass/#afed5e8a79fa550920f638708cc257bdf">JumpThreadingPass::threadGuard</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;Guard,</span></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI) &#123;</span></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a96b8f11f6f21ca0321294669dab83b35">getNumSuccessors</a>() == 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Wrong number of successors?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unconditional branch has 2 successors?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;GuardCond = Guard-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0);</span></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;BranchCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TrueDestIsSafe = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FalseDestIsSafe = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// True dest is safe if BranchCond =&gt; GuardCond.</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Impl = <a href="/docs/api/namespaces/llvm/#af7f2eb961a542779e97c0b3ec7fa6623">isImpliedCondition</a>(BranchCond, GuardCond, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Impl &amp;&amp; &#42;Impl)</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><span class="doxyHighlight">    TrueDestIsSafe = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// False dest is safe if !BranchCond =&gt; GuardCond.</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><span class="doxyHighlight">    Impl = <a href="/docs/api/namespaces/llvm/#af7f2eb961a542779e97c0b3ec7fa6623">isImpliedCondition</a>(BranchCond, GuardCond, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightComment">/&#42; LHSIsTrue &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Impl &amp;&amp; &#42;Impl)</span></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><span class="doxyHighlight">      FalseDestIsSafe = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TrueDestIsSafe &amp;&amp; !FalseDestIsSafe)</span></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredUnguardedBlock = TrueDestIsSafe ? TrueDest : FalseDest;</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredGuardedBlock = FalseDestIsSafe ? TrueDest : FalseDest;</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> UnguardedMapping, GuardedMapping;</span></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;AfterGuard = Guard-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>();</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> =</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><span class="doxyHighlight">      <a href="#a65facbdd55e486cbcef04a12de132c9c">getJumpThreadDuplicationCost</a>(TTI, BB, AfterGuard, BBDupThreshold);</span></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; BBDupThreshold)</span></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Duplicate all instructions before the guard and the guard itself to the</span></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch where implication is not proved.</span></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;GuardedBlock = <a href="/docs/api/namespaces/llvm/#a4cd89ca702a817aac3a4521dd2462a2e">DuplicateInstructionsInSplitBetween</a>(</span></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><span class="doxyHighlight">      BB, PredGuardedBlock, AfterGuard, GuardedMapping, &#42;DTU);</span></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GuardedBlock &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not create the guarded block?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Duplicate all instructions before the guard in the unguarded branch.</span></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we have successfully duplicated the guarded block and this block</span></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// has fewer instructions, we expect it to succeed.</span></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnguardedBlock = <a href="/docs/api/namespaces/llvm/#a4cd89ca702a817aac3a4521dd2462a2e">DuplicateInstructionsInSplitBetween</a>(</span></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><span class="doxyHighlight">      BB, PredUnguardedBlock, Guard, UnguardedMapping, &#42;DTU);</span></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnguardedBlock &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not create the unguarded block?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Moved guard &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Guard &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to block &quot;</span></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><span class="doxyHighlight">                    &lt;&lt; GuardedBlock-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Some instructions before the guard may still have uses. For them, we need</span></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to create Phi nodes merging their copies in both guarded and unguarded</span></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branches. Those instructions that have no uses can be just removed.</span></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>;</span></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); &amp;&#42;BI != AfterGuard; ++BI)</span></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(&amp;&#42;BI))</span></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>.push&#95;back(&amp;&#42;BI);</span></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/structs/insertionpoint">InsertionPoint</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/insertionpoint">InsertionPoint</a> != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Empty block?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Substitute with Phis &amp; remove.</span></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>)) &#123;</span></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst-&gt;use&#95;empty()) &#123;</span></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(Inst-&gt;getType(), 2);</span></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><span class="doxyHighlight">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(UnguardedMapping&#91;Inst&#93;, UnguardedBlock);</span></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><span class="doxyHighlight">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(GuardedMapping&#91;Inst&#93;, GuardedBlock);</span></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><span class="doxyHighlight">      NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Inst-&gt;getDebugLoc());</span></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><span class="doxyHighlight">      NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(<a href="/docs/api/structs/insertionpoint">InsertionPoint</a>);</span></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><span class="doxyHighlight">      Inst-&gt;replaceAllUsesWith(NewPN);</span></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><span class="doxyHighlight">    Inst-&gt;dropDbgRecords();</span></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><span class="doxyHighlight">    Inst-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> JumpThreadingPass::getPreservedAnalysis()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</span></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/lazyvalueanalysis">LazyValueAnalysis</a>&gt;();</span></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;();</span></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We would like to preserve BPI/BFI. Enable once all paths update them.</span></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Would be nice to verify BPI/BFI consistency as well.</span></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> AnalysisT&gt;</span></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> AnalysisT::Result &#42;JumpThreadingPass::runExternalAnalysis() &#123;</span></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t run external analysis without FunctionAnalysisManager&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there were no changes since last call to &#39;runExternalAnalysis&#39; then all</span></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// analysis is either up to date or explicitly invalidated. Just go ahead and</span></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// run the &quot;external&quot; analysis.</span></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ChangedSinceLastAnalysisUpdate) &#123;</span></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!DTU-&gt;hasPendingUpdates() &amp;&amp;</span></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Lost update of &#39;ChangedSinceLastAnalysisUpdate&#39;?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Run the &quot;external&quot; analysis.</span></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>-&gt;getResult&lt;AnalysisT&gt;(&#42;F);</span></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><span class="doxyHighlight">  ChangedSinceLastAnalysisUpdate = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PA = getPreservedAnalysis();</span></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: This shouldn&#39;t be needed once &#39;getPreservedAnalysis&#39; reports BPI/BFI</span></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as preserved.</span></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><span class="doxyHighlight">  PA.preserve&lt;BranchProbabilityAnalysis&gt;();</span></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><span class="doxyHighlight">  PA.preserve&lt;BlockFrequencyAnalysis&gt;();</span></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Report everything except explicitly preserved as invalid.</span></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><span class="doxyHighlight">  FAM-&gt;invalidate(&#42;F, PA);</span></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update DT/PDT.</span></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><span class="doxyHighlight">  DTU-&gt;flush();</span></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure DT/PDT are valid before running &quot;external&quot; analysis.</span></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DTU-&gt;getDomTree().verify(DominatorTree::VerificationLevel::Fast));</span></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!DTU-&gt;hasPostDomTree() ||</span></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><span class="doxyHighlight">          DTU-&gt;getPostDomTree().verify(</span></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><span class="doxyHighlight">              PostDominatorTree::VerificationLevel::Fast)));</span></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Run the &quot;external&quot; analysis.</span></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = &amp;FAM-&gt;getResult&lt;AnalysisT&gt;(&#42;F);</span></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update analysis JumpThreading depends on and not explicitly preserved.</span></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><span class="doxyHighlight">  TTI = &amp;FAM-&gt;getResult&lt;TargetIRAnalysis&gt;(&#42;F);</span></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><span class="doxyHighlight">  TLI = &amp;FAM-&gt;getResult&lt;TargetLibraryAnalysis&gt;(&#42;F);</span></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><span class="doxyHighlight">  AA = &amp;FAM-&gt;getResult&lt;AAManager&gt;(&#42;F);</span></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</span></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42;JumpThreadingPass::getBPI() &#123;</span></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BPI) &#123;</span></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FAM &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t create BPI without FunctionAnalysisManager&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><span class="doxyHighlight">    BPI = FAM-&gt;getCachedResult&lt;BranchProbabilityAnalysis&gt;(&#42;F);</span></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;BPI;</span></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;JumpThreadingPass::getBFI() &#123;</span></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BFI) &#123;</span></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FAM &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t create BFI without FunctionAnalysisManager&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><span class="doxyHighlight">    BFI = FAM-&gt;getCachedResult&lt;BlockFrequencyAnalysis&gt;(&#42;F);</span></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;BFI;</span></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><span class="doxyHighlightComment">// Important note on validity of BPI/BFI. JumpThreading tries to preserve</span></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><span class="doxyHighlightComment">// BPI/BFI as it goes. Thus if cached instance exists it will be updated.</span></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><span class="doxyHighlightComment">// Otherwise, new instance of BPI/BFI is created (up to date by definition).</span></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42;JumpThreadingPass::getOrCreateBPI(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Force) &#123;</span></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Res = getBPI();</span></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Res)</span></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Force)</span></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><span class="doxyHighlight">    BPI = runExternalAnalysis&lt;BranchProbabilityAnalysis&gt;();</span></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;BPI;</span></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;JumpThreadingPass::getOrCreateBFI(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Force) &#123;</span></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Res = getBFI();</span></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Res)</span></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Force)</span></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><span class="doxyHighlight">    BFI = runExternalAnalysis&lt;BlockFrequencyAnalysis&gt;();</span></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;BFI;</span></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
